<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nmap Training Lab - Dark Arts Vault | Hexworth Prime</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a0a1a 0%, #2d0a2d 100%);
            min-height: 100vh;
            padding: 20px;
            color: #e0e0e0;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(26, 10, 26, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 2px solid rgba(168, 85, 247, 0.3);
        }

        .header {
            background: linear-gradient(135deg, #7c3aed 0%, #dc2626 100%);
            padding: 30px;
            text-align: center;
            border-bottom: 3px solid #a855f7;
        }

        .header h1 {
            color: #ffffff;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            color: #f0e0f0;
            font-size: 1.1em;
        }

        .header .warning-banner {
            background: rgba(220, 38, 38, 0.3);
            border: 2px solid #dc2626;
            border-radius: 8px;
            padding: 12px 20px;
            margin-top: 15px;
            color: #fca5a5;
            font-weight: 600;
        }

        .back-link {
            display: inline-block;
            margin-top: 15px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .back-link:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 0;
            min-height: calc(100vh - 200px);
        }

        .workspace {
            display: flex;
            flex-direction: column;
            border-right: 2px solid rgba(168, 85, 247, 0.3);
        }

        .tab-container {
            display: flex;
            background: rgba(26, 10, 26, 0.9);
            border-bottom: 2px solid rgba(168, 85, 247, 0.3);
            padding: 10px 20px 0;
            gap: 5px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 20px;
            background: rgba(124, 58, 237, 0.3);
            color: #a855f7;
            border: none;
            cursor: pointer;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s ease;
            font-size: 0.95em;
            font-weight: 500;
            border: 2px solid transparent;
            border-bottom: none;
        }

        .tab:hover {
            background: rgba(168, 85, 247, 0.3);
            color: #e0e0e0;
        }

        .tab.active {
            background: rgba(124, 58, 237, 0.6);
            color: #ffffff;
            border-color: #a855f7;
        }

        .tab-content {
            display: none;
            flex: 1;
            overflow: hidden;
            flex-direction: column;
        }

        .tab-content.active {
            display: flex;
        }

        /* Learn Tab Styles */
        .learn-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .learn-section {
            margin-bottom: 30px;
        }

        .learn-section h2 {
            color: #a855f7;
            font-size: 1.8em;
            margin-bottom: 15px;
            border-bottom: 2px solid #dc2626;
            padding-bottom: 10px;
        }

        .learn-section h3 {
            color: #dc2626;
            font-size: 1.3em;
            margin: 20px 0 10px;
        }

        .learn-section p {
            line-height: 1.8;
            margin-bottom: 15px;
            color: #d0d0d0;
        }

        .learn-section ul, .learn-section ol {
            margin-left: 25px;
            margin-bottom: 15px;
        }

        .learn-section li {
            line-height: 1.8;
            margin-bottom: 8px;
            color: #d0d0d0;
        }

        .info-box {
            background: rgba(168, 85, 247, 0.15);
            border-left: 4px solid #a855f7;
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        .info-box.warning {
            background: rgba(220, 38, 38, 0.15);
            border-left-color: #dc2626;
        }

        .info-box.success {
            background: rgba(34, 197, 94, 0.15);
            border-left-color: #22c55e;
        }

        .info-box.critical {
            background: rgba(239, 68, 68, 0.2);
            border-left-color: #ef4444;
            border: 2px solid #ef4444;
            border-left-width: 4px;
        }

        .info-box strong {
            color: #a855f7;
            display: block;
            margin-bottom: 5px;
        }

        .info-box.warning strong {
            color: #dc2626;
        }

        .info-box.success strong {
            color: #22c55e;
        }

        .info-box.critical strong {
            color: #ef4444;
        }

        code {
            background: rgba(124, 58, 237, 0.3);
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #a855f7;
        }

        .code-block {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
            border: 1px solid rgba(168, 85, 247, 0.3);
        }

        .code-block .comment {
            color: #6b7280;
        }

        .code-block .command {
            color: #22c55e;
        }

        .code-block .option {
            color: #fb923c;
        }

        .code-block .target {
            color: #60a5fa;
        }

        /* Scanner Lab Styles */
        .scanner-lab {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .scan-controls {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            border-bottom: 2px solid rgba(168, 85, 247, 0.3);
        }

        .control-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            flex: 1;
            min-width: 200px;
        }

        .control-group label {
            display: block;
            color: #a855f7;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .control-group input,
        .control-group select {
            width: 100%;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(168, 85, 247, 0.3);
            color: #e0e0e0;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 0.95em;
            font-family: 'Courier New', monospace;
        }

        .control-group input:focus,
        .control-group select:focus {
            outline: none;
            border-color: #a855f7;
            box-shadow: 0 0 10px rgba(168, 85, 247, 0.3);
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            color: #d0d0d0;
            cursor: pointer;
            font-size: 0.9em;
            margin: 0;
        }

        .scan-btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #dc2626 0%, #7c3aed 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1em;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .scan-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
        }

        .scan-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .scenario-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .scenario-btn {
            padding: 8px 15px;
            background: rgba(124, 58, 237, 0.3);
            border: 2px solid #a855f7;
            color: #a855f7;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s ease;
        }

        .scenario-btn:hover {
            background: rgba(168, 85, 247, 0.3);
            color: #ffffff;
        }

        .output-display {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .output-container {
            flex: 1;
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .output-line {
            margin-bottom: 5px;
            color: #d0d0d0;
        }

        .output-line.header {
            color: #a855f7;
            font-weight: 600;
        }

        .output-line.open-port {
            color: #22c55e;
        }

        .output-line.closed-port {
            color: #dc2626;
        }

        .output-line.filtered-port {
            color: #fb923c;
        }

        .output-line.service {
            color: #60a5fa;
        }

        .output-line.warning {
            color: #fbbf24;
        }

        .output-line.error {
            color: #ef4444;
        }

        /* Challenges Styles */
        .challenges-container {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .challenge-card {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(168, 85, 247, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .challenge-card:hover {
            border-color: #a855f7;
            box-shadow: 0 4px 15px rgba(168, 85, 247, 0.2);
        }

        .challenge-card.completed {
            border-color: #22c55e;
            background: rgba(34, 197, 94, 0.1);
        }

        .challenge-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .challenge-title {
            color: #a855f7;
            font-size: 1.2em;
            font-weight: 600;
        }

        .challenge-card.completed .challenge-title {
            color: #22c55e;
        }

        .challenge-points {
            background: rgba(124, 58, 237, 0.3);
            color: #a855f7;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .challenge-card.completed .challenge-points {
            background: rgba(34, 197, 94, 0.3);
            color: #22c55e;
        }

        .challenge-description {
            color: #d0d0d0;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .challenge-input-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .challenge-input {
            flex: 1;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(168, 85, 247, 0.3);
            color: #e0e0e0;
            padding: 10px 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
        }

        .challenge-input:focus {
            outline: none;
            border-color: #a855f7;
        }

        .check-btn {
            padding: 10px 25px;
            background: linear-gradient(135deg, #7c3aed 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .check-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(124, 58, 237, 0.4);
        }

        .hint-btn {
            padding: 8px 15px;
            background: rgba(251, 146, 60, 0.2);
            border: 2px solid #fb923c;
            color: #fb923c;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            margin-top: 10px;
        }

        .hint-btn:hover {
            background: rgba(251, 146, 60, 0.3);
        }

        .hint-text {
            display: none;
            background: rgba(251, 146, 60, 0.15);
            border-left: 4px solid #fb923c;
            padding: 12px 15px;
            margin-top: 10px;
            border-radius: 0 6px 6px 0;
            color: #d0d0d0;
        }

        .hint-text.show {
            display: block;
        }

        .feedback {
            margin-top: 10px;
            padding: 12px 15px;
            border-radius: 6px;
            font-weight: 600;
            display: none;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 2px solid #22c55e;
        }

        .feedback.incorrect {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 2px solid #ef4444;
        }

        /* Reference Styles */
        .reference-container {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .ref-category {
            margin-bottom: 30px;
        }

        .ref-category h3 {
            color: #a855f7;
            font-size: 1.4em;
            margin-bottom: 15px;
            border-bottom: 2px solid #dc2626;
            padding-bottom: 10px;
        }

        .ref-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }

        .ref-item {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(168, 85, 247, 0.3);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ref-item:hover {
            border-color: #a855f7;
            background: rgba(124, 58, 237, 0.2);
            transform: translateY(-2px);
        }

        .command-syntax {
            color: #22c55e;
            font-family: 'Courier New', monospace;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .command-explanation {
            color: #d0d0d0;
            font-size: 0.85em;
        }

        /* Settings Styles */
        .settings-container {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .settings-section {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(168, 85, 247, 0.3);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .settings-section h3 {
            color: #a855f7;
            font-size: 1.3em;
            margin-bottom: 20px;
            border-bottom: 2px solid #dc2626;
            padding-bottom: 10px;
        }

        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(168, 85, 247, 0.1);
        }

        .settings-row:last-child {
            border-bottom: none;
        }

        .settings-row label {
            color: #d0d0d0;
            font-weight: 500;
        }

        .settings-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #7c3aed 0%, #dc2626 100%);
            color: white;
        }

        .settings-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(124, 58, 237, 0.4);
        }

        .settings-btn.secondary {
            background: rgba(124, 58, 237, 0.2);
            border: 2px solid #7c3aed;
        }

        /* Progress tracker */
        .progress-section {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .progress-bar-container {
            background: rgba(124, 58, 237, 0.2);
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-bar {
            background: linear-gradient(90deg, #22c55e 0%, #a855f7 100%);
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: #888;
        }

        /* Sidebar */
        .sidebar {
            background: rgba(0, 0, 0, 0.3);
            padding: 25px;
            overflow-y: auto;
            border-left: 2px solid rgba(168, 85, 247, 0.3);
        }

        .sidebar h3 {
            color: #a855f7;
            font-size: 1.3em;
            margin-bottom: 20px;
            border-bottom: 2px solid #dc2626;
            padding-bottom: 10px;
        }

        .sidebar h4 {
            color: #dc2626;
            font-size: 1.1em;
            margin: 20px 0 10px;
        }

        .sidebar p {
            color: #d0d0d0;
            line-height: 1.6;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .tip-box {
            background: rgba(168, 85, 247, 0.15);
            border-left: 4px solid #a855f7;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin: 15px 0;
        }

        .tip-box strong {
            color: #a855f7;
            display: block;
            margin-bottom: 8px;
        }

        .quick-commands {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .quick-command-btn {
            padding: 10px 15px;
            background: rgba(124, 58, 237, 0.3);
            border: 2px solid #a855f7;
            color: #a855f7;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            transition: all 0.3s ease;
            text-align: left;
        }

        .quick-command-btn:hover {
            background: rgba(168, 85, 247, 0.3);
            color: #ffffff;
            transform: translateX(5px);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .sidebar {
                border-left: none;
                border-top: 2px solid rgba(168, 85, 247, 0.3);
                max-height: 350px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(26, 10, 26, 0.5);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(124, 58, 237, 0.5);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a855f7;
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .scanning {
            animation: pulse 1s infinite;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .output-line {
            animation: slideIn 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üó∫Ô∏è Nmap Training Lab</h1>
            <p>Master Network Reconnaissance & Security Scanning</p>
            <div class="warning-banner">
                ‚ö†Ô∏è AUTHORIZED TESTING ONLY - Never scan networks without explicit permission!
            </div>
            <a href="../index.html" class="back-link">‚Üê Back to Dark Arts Vault</a>
        </div>

        <div class="main-content">
            <div class="workspace">
                <div class="tab-container">
                    <button class="tab active" onclick="switchTab('learn')">üìö Learn</button>
                    <button class="tab" onclick="switchTab('scanner-lab')">üî¨ Scanner Lab</button>
                    <button class="tab" onclick="switchTab('challenges')">üéØ Challenges</button>
                    <button class="tab" onclick="switchTab('reference')">üìñ Reference</button>
                    <button class="tab" onclick="switchTab('settings')">‚öôÔ∏è Settings</button>
                </div>

                <!-- LEARN TAB -->
                <div id="learn" class="tab-content active">
                    <div class="learn-content">
                        <div class="learn-section">
                            <h2>What is Nmap?</h2>
                            <p>Nmap (Network Mapper) is the world's leading network discovery and security scanning tool. It's an open-source powerhouse used by security professionals, penetration testers, and system administrators to discover hosts, services, and vulnerabilities across networks. Think of it as a <strong>"network X-ray machine"</strong> that reveals what's running on target systems.</p>

                            <div class="info-box critical">
                                <strong>‚ö†Ô∏è CRITICAL LEGAL WARNING</strong>
                                <p>Scanning networks without authorization is ILLEGAL in most jurisdictions and can result in criminal prosecution. ONLY scan:</p>
                                <ul>
                                    <li>Networks you own or manage</li>
                                    <li>Systems where you have written permission</li>
                                    <li>This training lab's simulated environments</li>
                                </ul>
                                <p>Unauthorized scanning can be prosecuted under the Computer Fraud and Abuse Act (USA), Computer Misuse Act (UK), and similar laws worldwide.</p>
                            </div>

                            <h3>Why Do We Need Nmap?</h3>
                            <ul>
                                <li><strong>Network Inventory:</strong> Discover all devices on your network (servers, IoT devices, forgotten systems)</li>
                                <li><strong>Security Auditing:</strong> Find open ports and services that could be exploited</li>
                                <li><strong>Vulnerability Assessment:</strong> Identify outdated services with known vulnerabilities</li>
                                <li><strong>Penetration Testing:</strong> Essential reconnaissance phase for ethical hacking</li>
                                <li><strong>Network Troubleshooting:</strong> Verify firewall rules and service availability</li>
                            </ul>

                            <h3>The Three Core Capabilities</h3>
                            <ol>
                                <li><strong>Host Discovery:</strong> Find active devices on a network</li>
                                <li><strong>Port Scanning:</strong> Determine which ports are open, closed, or filtered</li>
                                <li><strong>Service/OS Detection:</strong> Identify what's running and the operating system</li>
                            </ol>
                        </div>

                        <div class="learn-section">
                            <h2>Understanding Ports & Services</h2>
                            <p>Before scanning, you must understand what you're looking for.</p>

                            <h3>What Are Ports?</h3>
                            <p>Ports are logical endpoints for network communication. Think of an IP address as a building address, and ports as individual apartment numbers. There are 65,535 ports (0-65535) divided into three ranges:</p>

                            <div class="code-block">
                                <span class="comment"># Well-Known Ports (0-1023)</span><br>
                                <span class="target">22</span>  - SSH (Secure Shell)<br>
                                <span class="target">80</span>  - HTTP (Web traffic)<br>
                                <span class="target">443</span> - HTTPS (Encrypted web)<br>
                                <span class="target">21</span>  - FTP (File Transfer)<br>
                                <span class="target">25</span>  - SMTP (Email)<br>
                                <span class="target">53</span>  - DNS (Domain Name System)<br><br>
                                <span class="comment"># Registered Ports (1024-49151)</span><br>
                                <span class="target">3306</span> - MySQL Database<br>
                                <span class="target">3389</span> - RDP (Remote Desktop)<br>
                                <span class="target">8080</span> - Alternative HTTP<br><br>
                                <span class="comment"># Dynamic/Private Ports (49152-65535)</span><br>
                                Used for temporary client connections
                            </div>

                            <h3>Port States in Nmap</h3>
                            <ul>
                                <li><strong>open:</strong> Service is actively accepting connections (vulnerable attack surface)</li>
                                <li><strong>closed:</strong> Port is accessible but no service listening (host is up, but nothing there)</li>
                                <li><strong>filtered:</strong> Nmap can't determine if open (firewall blocking probes)</li>
                                <li><strong>unfiltered:</strong> Port is accessible but state unclear (rare, ACK scan)</li>
                                <li><strong>open|filtered:</strong> Nmap can't tell if open or filtered</li>
                                <li><strong>closed|filtered:</strong> Nmap can't tell if closed or filtered</li>
                            </ul>

                            <div class="info-box warning">
                                <strong>‚ö†Ô∏è Security Insight</strong>
                                <p>Every open port is a potential attack vector. Security best practice: Close all ports except those absolutely necessary, and firewall the rest.</p>
                            </div>
                        </div>

                        <div class="learn-section">
                            <h2>TCP vs UDP Scanning</h2>
                            <p>Understanding the difference between TCP and UDP is crucial for effective scanning.</p>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                                <div style="background: rgba(34, 197, 94, 0.1); padding: 20px; border-radius: 10px; border: 2px solid #22c55e;">
                                    <h4 style="color: #22c55e; margin-bottom: 10px;">TCP (Transmission Control Protocol)</h4>
                                    <ul style="font-size: 0.9em;">
                                        <li>Connection-oriented (handshake)</li>
                                        <li>Reliable delivery guaranteed</li>
                                        <li>Easier to scan (SYN/ACK responses)</li>
                                        <li>Most common services use TCP</li>
                                        <li>Examples: HTTP, SSH, FTP, SMTP</li>
                                    </ul>
                                </div>
                                <div style="background: rgba(251, 146, 60, 0.1); padding: 20px; border-radius: 10px; border: 2px solid #fb923c;">
                                    <h4 style="color: #fb923c; margin-bottom: 10px;">UDP (User Datagram Protocol)</h4>
                                    <ul style="font-size: 0.9em;">
                                        <li>Connectionless (no handshake)</li>
                                        <li>No delivery guarantee</li>
                                        <li>Harder to scan (often no response)</li>
                                        <li>Used for speed-critical apps</li>
                                        <li>Examples: DNS, DHCP, VoIP, VPN</li>
                                    </ul>
                                </div>
                            </div>

                            <h3>The TCP Three-Way Handshake</h3>
                            <div class="code-block">
                                Client         Server<br>
                                  |              |<br>
                                  |--- <span class="command">SYN</span> --------->|  (Client initiates)<br>
                                  |              |<br>
                                  |<-- <span class="command">SYN-ACK</span> ------|  (Server accepts)<br>
                                  |              |<br>
                                  |--- <span class="command">ACK</span> --------->|  (Connection established)<br>
                            </div>

                            <p>Nmap exploits this handshake for various scan types. A <strong>SYN scan</strong> sends SYN packets and analyzes responses without completing the handshake (stealthier).</p>
                        </div>

                        <div class="learn-section">
                            <h2>Nmap Scan Types</h2>
                            <p>Different scan types have different stealth levels, speed, and accuracy. Choose based on your needs and authorization level.</p>

                            <h3>TCP SYN Scan (-sS) - "Stealth Scan"</h3>
                            <div class="code-block">
                                <span class="command">nmap</span> <span class="option">-sS</span> <span class="target">192.168.1.1</span>
                            </div>
                            <ul>
                                <li><strong>How it works:</strong> Sends SYN packets, analyzes SYN-ACK responses, never completes handshake</li>
                                <li><strong>Advantages:</strong> Fast, stealthy (doesn't complete connections), default scan</li>
                                <li><strong>Disadvantages:</strong> Requires root/admin privileges</li>
                                <li><strong>When to use:</strong> Default choice for most scans (if you have permissions)</li>
                            </ul>

                            <h3>TCP Connect Scan (-sT)</h3>
                            <div class="code-block">
                                <span class="command">nmap</span> <span class="option">-sT</span> <span class="target">192.168.1.1</span>
                            </div>
                            <ul>
                                <li><strong>How it works:</strong> Completes full TCP connection using OS connect() call</li>
                                <li><strong>Advantages:</strong> Doesn't need root, works everywhere</li>
                                <li><strong>Disadvantages:</strong> Slower, more easily logged/detected</li>
                                <li><strong>When to use:</strong> When you don't have root or -sS is blocked</li>
                            </ul>

                            <h3>UDP Scan (-sU)</h3>
                            <div class="code-block">
                                <span class="command">nmap</span> <span class="option">-sU</span> <span class="target">192.168.1.1</span>
                            </div>
                            <ul>
                                <li><strong>How it works:</strong> Sends UDP packets, waits for ICMP "port unreachable" or service response</li>
                                <li><strong>Advantages:</strong> Finds UDP services (DNS, DHCP, VPN)</li>
                                <li><strong>Disadvantages:</strong> VERY slow (no responses from open ports), often rate-limited</li>
                                <li><strong>When to use:</strong> When looking for UDP services specifically</li>
                            </ul>

                            <div class="info-box">
                                <strong>üí° Pro Tip: Combine TCP and UDP</strong>
                                <p>Use <code>nmap -sS -sU 192.168.1.1</code> to scan both TCP and UDP. This is comprehensive but slow.</p>
                            </div>

                            <h3>ACK Scan (-sA) - Firewall Detection</h3>
                            <div class="code-block">
                                <span class="command">nmap</span> <span class="option">-sA</span> <span class="target">192.168.1.1</span>
                            </div>
                            <ul>
                                <li><strong>How it works:</strong> Sends ACK packets to detect firewall rules</li>
                                <li><strong>Purpose:</strong> Doesn't determine open/closed, only filtered/unfiltered</li>
                                <li><strong>When to use:</strong> Mapping firewall rulesets</li>
                            </ul>

                            <h3>FIN, Xmas, Null Scans (-sF, -sX, -sN)</h3>
                            <div class="code-block">
                                <span class="command">nmap</span> <span class="option">-sF</span> <span class="target">192.168.1.1</span>  <span class="comment"># FIN scan</span><br>
                                <span class="command">nmap</span> <span class="option">-sX</span> <span class="target">192.168.1.1</span>  <span class="comment"># Xmas scan (FIN, PSH, URG flags)</span><br>
                                <span class="command">nmap</span> <span class="option">-sN</span> <span class="target">192.168.1.1</span>  <span class="comment"># Null scan (no flags)</span>
                            </div>
                            <ul>
                                <li><strong>How they work:</strong> Exploit TCP RFC loophole (closed ports respond with RST, open ports don't respond)</li>
                                <li><strong>Advantages:</strong> Can bypass some firewalls, very stealthy</li>
                                <li><strong>Disadvantages:</strong> Don't work against Windows, unreliable, mainly for evading detection</li>
                                <li><strong>When to use:</strong> Evading stateless firewalls, advanced evasion scenarios</li>
                            </ul>
                        </div>

                        <div class="learn-section">
                            <h2>Service & Version Detection</h2>

                            <h3>Service Detection (-sV)</h3>
                            <div class="code-block">
                                <span class="command">nmap</span> <span class="option">-sV</span> <span class="target">192.168.1.1</span>
                            </div>
                            <p>Probes open ports to determine the actual service and version running. This is CRITICAL for security assessments because:</p>
                            <ul>
                                <li>Port 80 might be running a vulnerable version of Apache 2.2.x</li>
                                <li>Outdated versions often have known CVEs (Common Vulnerabilities and Exposures)</li>
                                <li>Verifies the service matches the expected port (detecting backdoors)</li>
                            </ul>

                            <div class="code-block">
                                <span class="comment"># Example output:</span><br>
                                PORT    STATE SERVICE VERSION<br>
                                22/tcp  open  ssh     <span class="option">OpenSSH 7.4</span> (protocol 2.0)<br>
                                80/tcp  open  http    <span class="option">Apache httpd 2.4.6</span> ((CentOS))<br>
                                443/tcp open  ssl/http <span class="option">nginx 1.14.0</span>
                            </div>

                            <h3>OS Detection (-O)</h3>
                            <div class="code-block">
                                <span class="command">nmap</span> <span class="option">-O</span> <span class="target">192.168.1.1</span>
                            </div>
                            <p>Uses TCP/IP stack fingerprinting to guess the operating system. Analyzes subtle differences in how OSes implement networking.</p>
                            <ul>
                                <li>Helps prioritize targets (Windows vs Linux have different attack vectors)</li>
                                <li>Identifies unexpected OSes (server running Windows when you expected Linux)</li>
                                <li>Requires root privileges and at least one open and one closed port</li>
                            </ul>

                            <h3>Aggressive Scan (-A)</h3>
                            <div class="code-block">
                                <span class="command">nmap</span> <span class="option">-A</span> <span class="target">192.168.1.1</span>
                            </div>
                            <p>Enables OS detection (-O), version detection (-sV), script scanning (-sC), and traceroute. Very thorough but LOUD and easily detected.</p>

                            <div class="info-box warning">
                                <strong>‚ö†Ô∏è Detectability Warning</strong>
                                <p>Aggressive scans (-A, -sV with high intensity) generate significant network traffic and are easily detected by IDS/IPS systems. Use only on authorized targets during approved testing windows.</p>
                            </div>
                        </div>

                        <div class="learn-section">
                            <h2>NSE: Nmap Scripting Engine</h2>
                            <p>NSE scripts extend Nmap's capabilities with vulnerability detection, advanced discovery, and exploitation checks.</p>

                            <h3>Basic Script Usage</h3>
                            <div class="code-block">
                                <span class="command">nmap</span> <span class="option">--script</span>=<span class="target">vuln</span> 192.168.1.1      <span class="comment"># Run vulnerability scripts</span><br>
                                <span class="command">nmap</span> <span class="option">--script</span>=<span class="target">default</span> 192.168.1.1   <span class="comment"># Run default safe scripts</span><br>
                                <span class="command">nmap</span> <span class="option">--script</span>=<span class="target">http-*</span> 192.168.1.1    <span class="comment"># All HTTP-related scripts</span><br>
                                <span class="command">nmap</span> <span class="option">--script</span>=<span class="target">smb-enum-shares</span> 192.168.1.1  <span class="comment"># Specific script</span>
                            </div>

                            <h3>Useful Script Categories</h3>
                            <ul>
                                <li><strong>auth:</strong> Authentication testing (bypass, brute force)</li>
                                <li><strong>broadcast:</strong> Discover hosts via broadcast</li>
                                <li><strong>brute:</strong> Brute force password attacks</li>
                                <li><strong>default:</strong> Safe, commonly useful scripts (-sC shortcut)</li>
                                <li><strong>discovery:</strong> Advanced host/service discovery</li>
                                <li><strong>exploit:</strong> Attempt to exploit vulnerabilities (DANGEROUS - authorized only!)</li>
                                <li><strong>vuln:</strong> Check for known vulnerabilities</li>
                            </ul>

                            <div class="info-box success">
                                <strong>‚úÖ Powerful Examples</strong>
                                <div class="code-block" style="margin-top: 10px;">
                                    <span class="comment"># Check for MS17-010 (EternalBlue) on Windows hosts</span><br>
                                    <span class="command">nmap</span> <span class="option">--script</span>=<span class="target">smb-vuln-ms17-010</span> 192.168.1.0/24<br><br>
                                    <span class="comment"># Enumerate web application technologies</span><br>
                                    <span class="command">nmap</span> <span class="option">--script</span>=<span class="target">http-enum</span> example.com<br><br>
                                    <span class="comment"># Check for SSL/TLS vulnerabilities</span><br>
                                    <span class="command">nmap</span> <span class="option">--script</span>=<span class="target">ssl-*</span> 192.168.1.1
                                </div>
                            </div>
                        </div>

                        <div class="learn-section">
                            <h2>Timing & Performance</h2>
                            <p>Nmap's timing templates (-T) control scan speed vs stealth. Choose based on your scenario.</p>

                            <div class="code-block">
                                <span class="command">nmap</span> <span class="option">-T0</span> <span class="target">192.168.1.1</span>  <span class="comment"># Paranoid - Extremely slow, IDS evasion</span><br>
                                <span class="command">nmap</span> <span class="option">-T1</span> <span class="target">192.168.1.1</span>  <span class="comment"># Sneaky - Very slow, evades IDS</span><br>
                                <span class="command">nmap</span> <span class="option">-T2</span> <span class="target">192.168.1.1</span>  <span class="comment"># Polite - Slower, low bandwidth</span><br>
                                <span class="command">nmap</span> <span class="option">-T3</span> <span class="target">192.168.1.1</span>  <span class="comment"># Normal - Default, balanced</span><br>
                                <span class="command">nmap</span> <span class="option">-T4</span> <span class="target">192.168.1.1</span>  <span class="comment"># Aggressive - Fast, assumes good network</span><br>
                                <span class="command">nmap</span> <span class="option">-T5</span> <span class="target">192.168.1.1</span>  <span class="comment"># Insane - Very fast, may miss results</span>
                            </div>

                            <h3>When to Use Each Timing</h3>
                            <ul>
                                <li><strong>T0-T1:</strong> Penetration testing where stealth is paramount</li>
                                <li><strong>T2:</strong> Scanning production systems (minimizes impact)</li>
                                <li><strong>T3:</strong> Default, works for most scenarios</li>
                                <li><strong>T4:</strong> Internal scans, pentests with time constraints</li>
                                <li><strong>T5:</strong> Only on isolated lab networks (unreliable on real networks)</li>
                            </ul>

                            <div class="info-box">
                                <strong>üí° Pro Tip</strong>
                                <p>Combine with parallelism: <code>nmap -T4 --min-parallelism 100 192.168.1.0/24</code> scans an entire /24 network very quickly.</p>
                            </div>
                        </div>

                        <div class="learn-section">
                            <h2>Port Specification Techniques</h2>
                            <p>By default, Nmap scans the 1000 most common ports. Customize for thorough or targeted scans.</p>

                            <div class="code-block">
                                <span class="command">nmap</span> <span class="option">-p</span> <span class="target">22</span> 192.168.1.1                <span class="comment"># Single port</span><br>
                                <span class="command">nmap</span> <span class="option">-p</span> <span class="target">22,80,443</span> 192.168.1.1         <span class="comment"># Multiple specific ports</span><br>
                                <span class="command">nmap</span> <span class="option">-p</span> <span class="target">1-1000</span> 192.168.1.1            <span class="comment"># Port range</span><br>
                                <span class="command">nmap</span> <span class="option">-p-</span> 192.168.1.1                  <span class="comment"># ALL 65535 ports (slow!)</span><br>
                                <span class="command">nmap</span> <span class="option">-p</span> <span class="target">T:22,80,U:53,161</span> 192.168.1.1 <span class="comment"># TCP and UDP specific</span><br>
                                <span class="command">nmap</span> <span class="option">--top-ports</span> <span class="target">100</span> 192.168.1.1     <span class="comment"># Scan top 100 most common ports</span><br>
                                <span class="command">nmap</span> <span class="option">-F</span> 192.168.1.1                   <span class="comment"># Fast mode (100 most common)</span>
                            </div>

                            <div class="info-box warning">
                                <strong>‚ö†Ô∏è Full Port Scan Warning</strong>
                                <p>Scanning all 65535 ports (-p-) takes significantly longer. On slow networks, combine with -T4 or limit parallelism. Always consider if the time investment is justified.</p>
                            </div>
                        </div>

                        <div class="learn-section">
                            <h2>Target Specification</h2>
                            <p>Nmap supports flexible target formats for single hosts or entire networks.</p>

                            <div class="code-block">
                                <span class="command">nmap</span> <span class="target">192.168.1.1</span>                      <span class="comment"># Single IP</span><br>
                                <span class="command">nmap</span> <span class="target">example.com</span>                      <span class="comment"># Hostname (resolves to IP)</span><br>
                                <span class="command">nmap</span> <span class="target">192.168.1.0/24</span>                   <span class="comment"># CIDR notation (entire subnet)</span><br>
                                <span class="command">nmap</span> <span class="target">192.168.1.1-50</span>                   <span class="comment"># Range (IPs 1 through 50)</span><br>
                                <span class="command">nmap</span> <span class="target">192.168.1.*</span>                      <span class="comment"># Wildcard (entire /24)</span><br>
                                <span class="command">nmap</span> <span class="target">192.168.1.1 192.168.1.5</span>          <span class="comment"># Multiple targets space-separated</span><br>
                                <span class="command">nmap</span> <span class="option">-iL</span> <span class="target">targets.txt</span>                 <span class="comment"># Read targets from file</span><br>
                                <span class="command">nmap</span> <span class="option">--exclude</span> <span class="target">192.168.1.5</span> 192.168.1.0/24 <span class="comment"># Exclude specific IP</span>
                            </div>
                        </div>

                        <div class="learn-section">
                            <h2>Output Formats & Saving Results</h2>
                            <p>Always save scan results for reporting, comparison, and legal documentation.</p>

                            <div class="code-block">
                                <span class="command">nmap</span> <span class="option">-oN</span> <span class="target">scan.txt</span> 192.168.1.1       <span class="comment"># Normal output (human-readable)</span><br>
                                <span class="command">nmap</span> <span class="option">-oX</span> <span class="target">scan.xml</span> 192.168.1.1       <span class="comment"># XML output (for tools)</span><br>
                                <span class="command">nmap</span> <span class="option">-oG</span> <span class="target">scan.gnmap</span> 192.168.1.1     <span class="comment"># Grepable output (parsing)</span><br>
                                <span class="command">nmap</span> <span class="option">-oA</span> <span class="target">scan</span> 192.168.1.1            <span class="comment"># All formats (scan.nmap, .xml, .gnmap)</span>
                            </div>

                            <div class="info-box success">
                                <strong>‚úÖ Best Practice</strong>
                                <p>Always use <code>-oA basename</code> to save all three formats. XML is required for importing into vulnerability management tools, while normal output is easier for manual review.</p>
                            </div>
                        </div>

                        <div class="learn-section">
                            <h2>Ethical & Legal Considerations</h2>

                            <div class="info-box critical">
                                <strong>üö® YOU MUST UNDERSTAND THIS</strong>
                                <p><strong>Unauthorized network scanning is a CRIME.</strong> Before scanning ANY network:</p>
                                <ol>
                                    <li>Get explicit written authorization from the network owner</li>
                                    <li>Define the scope (what IPs/networks are in scope)</li>
                                    <li>Agree on testing windows (time of day, duration)</li>
                                    <li>Document everything (authorization, scope, findings)</li>
                                    <li>Respect scope boundaries (never scan out-of-scope targets)</li>
                                </ol>
                            </div>

                            <h3>Legal Frameworks</h3>
                            <ul>
                                <li><strong>USA:</strong> Computer Fraud and Abuse Act (CFAA) - Unauthorized access is federal crime</li>
                                <li><strong>UK:</strong> Computer Misuse Act 1990 - Up to 10 years imprisonment</li>
                                <li><strong>EU:</strong> GDPR + national laws - Data breach penalties + criminal charges</li>
                                <li><strong>International:</strong> Council of Europe Convention on Cybercrime</li>
                            </ul>

                            <h3>Real-World Consequences</h3>
                            <div class="info-box warning">
                                <strong>Case Studies</strong>
                                <ul>
                                    <li>Security researcher scanned hospital network "to help" - arrested, lost job, criminal record</li>
                                    <li>Student scanned university "for thesis research" - expelled, sued for damages</li>
                                    <li>Pentester exceeded authorized scope by one IP - contract terminated, lawsuit</li>
                                </ul>
                            </div>

                            <h3>Safe Practice Environments</h3>
                            <p>Learn Nmap safely in these authorized environments:</p>
                            <ul>
                                <li>This training lab (simulated targets)</li>
                                <li>Your own home network (devices you own)</li>
                                <li>Intentionally vulnerable VMs (HackTheBox, TryHackMe, DVWA)</li>
                                <li>Cloud instances YOU created (AWS, Azure, etc.)</li>
                                <li>Employer networks with written authorization</li>
                            </ul>
                        </div>

                        <div class="learn-section">
                            <h2>Ready to Practice?</h2>
                            <p>Head to the <strong>Scanner Lab</strong> tab to practice scanning simulated targets with realistic responses. Then test your skills in the <strong>Challenges</strong> section!</p>

                            <div class="info-box success">
                                <strong>üéÆ Interactive Learning</strong>
                                <p>The Scanner Lab provides multiple simulated target scenarios (web servers, Windows hosts, firewalled systems). Build real-world scanning skills in a safe, legal environment!</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SCANNER LAB TAB -->
                <div id="scanner-lab" class="tab-content">
                    <div class="scanner-lab">
                        <div class="scan-controls">
                            <div class="control-row">
                                <div class="control-group" style="flex: 2;">
                                    <label>Target IP/Hostname</label>
                                    <input type="text" id="targetInput" placeholder="192.168.1.1 or example.com" value="192.168.1.100">
                                </div>
                                <div class="control-group">
                                    <label>Scan Type</label>
                                    <select id="scanTypeSelect">
                                        <option value="-sS">SYN Scan (-sS) - Stealth</option>
                                        <option value="-sT">Connect Scan (-sT)</option>
                                        <option value="-sU">UDP Scan (-sU)</option>
                                        <option value="-sA">ACK Scan (-sA)</option>
                                        <option value="-sF">FIN Scan (-sF)</option>
                                        <option value="-sX">Xmas Scan (-sX)</option>
                                        <option value="-sN">Null Scan (-sN)</option>
                                    </select>
                                </div>
                                <div class="control-group">
                                    <label>Port Range</label>
                                    <input type="text" id="portInput" placeholder="22,80,443 or 1-1000" value="1-1000">
                                </div>
                            </div>

                            <div class="control-row">
                                <div class="control-group">
                                    <label>Timing Template</label>
                                    <select id="timingSelect">
                                        <option value="-T0">T0 - Paranoid</option>
                                        <option value="-T1">T1 - Sneaky</option>
                                        <option value="-T2">T2 - Polite</option>
                                        <option value="-T3" selected>T3 - Normal</option>
                                        <option value="-T4">T4 - Aggressive</option>
                                        <option value="-T5">T5 - Insane</option>
                                    </select>
                                </div>
                            </div>

                            <div class="options-grid">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="optionSV">
                                    <label for="optionSV">-sV (Version Detection)</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="optionO">
                                    <label for="optionO">-O (OS Detection)</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="optionA">
                                    <label for="optionA">-A (Aggressive)</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="optionScript">
                                    <label for="optionScript">--script=default</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="optionV">
                                    <label for="optionV">-v (Verbose)</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="optionPn">
                                    <label for="optionPn">-Pn (No Ping)</label>
                                </div>
                            </div>

                            <button class="scan-btn" id="scanButton" onclick="runScan()">‚ñ∂Ô∏è Run Scan</button>

                            <div class="scenario-buttons">
                                <strong style="color: #a855f7; margin-right: 10px;">Pre-configured Scenarios:</strong>
                                <button class="scenario-btn" onclick="loadScenario('webserver')">Web Server (Linux)</button>
                                <button class="scenario-btn" onclick="loadScenario('windows')">Windows Desktop</button>
                                <button class="scenario-btn" onclick="loadScenario('firewall')">Firewalled Host</button>
                                <button class="scenario-btn" onclick="loadScenario('vulnerable')">Vulnerable Server</button>
                                <button class="scenario-btn" onclick="loadScenario('router')">Network Router</button>
                            </div>
                        </div>

                        <div class="output-display">
                            <div class="output-container" id="scanOutput">
                                <div class="output-line" style="color: #a855f7; font-weight: 600;">
                                    Nmap Training Lab - Simulated Scanner
                                </div>
                                <div class="output-line" style="color: #888;">
                                    Configure scan parameters above and click "Run Scan" or select a pre-configured scenario.
                                </div>
                                <div class="output-line" style="color: #888; margin-top: 10px;">
                                    All scans are SIMULATED - no actual network traffic is generated.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CHALLENGES TAB -->
                <div id="challenges" class="tab-content">
                    <div class="challenges-container">
                        <div class="progress-section">
                            <h3 style="color: #a855f7; margin-bottom: 10px;">Your Progress</h3>
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progressBar" style="width: 0%;"></div>
                            </div>
                            <div class="progress-text">
                                <span><span id="completedCount">0</span> of <span id="totalChallenges">10</span> challenges completed</span>
                                <span id="totalPoints">0 points</span>
                            </div>
                        </div>

                        <div id="challengeList"></div>
                    </div>
                </div>

                <!-- REFERENCE TAB -->
                <div id="reference" class="tab-content">
                    <div class="reference-container">
                        <div class="ref-category">
                            <h3>üéØ Basic Scan Types</h3>
                            <div class="ref-grid">
                                <div class="ref-item" onclick="insertCommand('nmap -sS ')">
                                    <div class="command-syntax">nmap -sS [target]</div>
                                    <div class="command-explanation">SYN scan (stealth, default)</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -sT ')">
                                    <div class="command-syntax">nmap -sT [target]</div>
                                    <div class="command-explanation">TCP Connect scan (no root needed)</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -sU ')">
                                    <div class="command-syntax">nmap -sU [target]</div>
                                    <div class="command-explanation">UDP scan (slow but thorough)</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -sA ')">
                                    <div class="command-syntax">nmap -sA [target]</div>
                                    <div class="command-explanation">ACK scan (firewall detection)</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -sF ')">
                                    <div class="command-syntax">nmap -sF [target]</div>
                                    <div class="command-explanation">FIN scan (stealth, bypasses some firewalls)</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -sX ')">
                                    <div class="command-syntax">nmap -sX [target]</div>
                                    <div class="command-explanation">Xmas scan (FIN, PSH, URG flags)</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -sN ')">
                                    <div class="command-syntax">nmap -sN [target]</div>
                                    <div class="command-explanation">Null scan (no flags set)</div>
                                </div>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>üîç Port Specification</h3>
                            <div class="ref-grid">
                                <div class="ref-item" onclick="insertCommand('nmap -p 22 ')">
                                    <div class="command-syntax">nmap -p 22 [target]</div>
                                    <div class="command-explanation">Scan single port</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -p 22,80,443 ')">
                                    <div class="command-syntax">nmap -p 22,80,443 [target]</div>
                                    <div class="command-explanation">Scan specific ports</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -p 1-1000 ')">
                                    <div class="command-syntax">nmap -p 1-1000 [target]</div>
                                    <div class="command-explanation">Scan port range</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -p- ')">
                                    <div class="command-syntax">nmap -p- [target]</div>
                                    <div class="command-explanation">Scan ALL 65535 ports</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap --top-ports 100 ')">
                                    <div class="command-syntax">nmap --top-ports 100 [target]</div>
                                    <div class="command-explanation">Scan top 100 most common ports</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -F ')">
                                    <div class="command-syntax">nmap -F [target]</div>
                                    <div class="command-explanation">Fast scan (100 common ports)</div>
                                </div>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>üîé Service & OS Detection</h3>
                            <div class="ref-grid">
                                <div class="ref-item" onclick="insertCommand('nmap -sV ')">
                                    <div class="command-syntax">nmap -sV [target]</div>
                                    <div class="command-explanation">Detect service versions</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -O ')">
                                    <div class="command-syntax">nmap -O [target]</div>
                                    <div class="command-explanation">Detect operating system</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -A ')">
                                    <div class="command-syntax">nmap -A [target]</div>
                                    <div class="command-explanation">Aggressive scan (OS, version, scripts, traceroute)</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap --version-intensity 5 ')">
                                    <div class="command-syntax">nmap --version-intensity 5 [target]</div>
                                    <div class="command-explanation">Set version detection intensity (0-9)</div>
                                </div>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>‚ö° Timing & Performance</h3>
                            <div class="ref-grid">
                                <div class="ref-item" onclick="insertCommand('nmap -T0 ')">
                                    <div class="command-syntax">nmap -T0 [target]</div>
                                    <div class="command-explanation">Paranoid timing (extremely slow, IDS evasion)</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -T1 ')">
                                    <div class="command-syntax">nmap -T1 [target]</div>
                                    <div class="command-explanation">Sneaky timing (very slow)</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -T2 ')">
                                    <div class="command-syntax">nmap -T2 [target]</div>
                                    <div class="command-explanation">Polite timing (slower, reduces load)</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -T3 ')">
                                    <div class="command-syntax">nmap -T3 [target]</div>
                                    <div class="command-explanation">Normal timing (default)</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -T4 ')">
                                    <div class="command-syntax">nmap -T4 [target]</div>
                                    <div class="command-explanation">Aggressive timing (fast, good networks)</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -T5 ')">
                                    <div class="command-syntax">nmap -T5 [target]</div>
                                    <div class="command-explanation">Insane timing (very fast, may lose accuracy)</div>
                                </div>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>üìú NSE Scripts</h3>
                            <div class="ref-grid">
                                <div class="ref-item" onclick="insertCommand('nmap --script=default ')">
                                    <div class="command-syntax">nmap --script=default [target]</div>
                                    <div class="command-explanation">Run default safe scripts</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap --script=vuln ')">
                                    <div class="command-syntax">nmap --script=vuln [target]</div>
                                    <div class="command-explanation">Run vulnerability detection scripts</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap --script=http-enum ')">
                                    <div class="command-syntax">nmap --script=http-enum [target]</div>
                                    <div class="command-explanation">Enumerate web directories</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap --script=smb-enum-shares ')">
                                    <div class="command-syntax">nmap --script=smb-enum-shares [target]</div>
                                    <div class="command-explanation">Enumerate SMB shares</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap --script=ssl-* ')">
                                    <div class="command-syntax">nmap --script=ssl-* [target]</div>
                                    <div class="command-explanation">Run all SSL/TLS scripts</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap --script=discovery ')">
                                    <div class="command-syntax">nmap --script=discovery [target]</div>
                                    <div class="command-explanation">Run discovery scripts</div>
                                </div>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>üéØ Target Specification</h3>
                            <div class="ref-grid">
                                <div class="ref-item" onclick="insertCommand('nmap 192.168.1.1')">
                                    <div class="command-syntax">nmap 192.168.1.1</div>
                                    <div class="command-explanation">Scan single IP</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap example.com')">
                                    <div class="command-syntax">nmap example.com</div>
                                    <div class="command-explanation">Scan hostname</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap 192.168.1.0/24')">
                                    <div class="command-syntax">nmap 192.168.1.0/24</div>
                                    <div class="command-explanation">Scan entire subnet (CIDR)</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap 192.168.1.1-50')">
                                    <div class="command-syntax">nmap 192.168.1.1-50</div>
                                    <div class="command-explanation">Scan IP range</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -iL targets.txt')">
                                    <div class="command-syntax">nmap -iL targets.txt</div>
                                    <div class="command-explanation">Scan targets from file</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap --exclude 192.168.1.5 ')">
                                    <div class="command-syntax">nmap --exclude 192.168.1.5 [target]</div>
                                    <div class="command-explanation">Exclude specific IP</div>
                                </div>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>üíæ Output Options</h3>
                            <div class="ref-grid">
                                <div class="ref-item" onclick="insertCommand('nmap -oN scan.txt ')">
                                    <div class="command-syntax">nmap -oN scan.txt [target]</div>
                                    <div class="command-explanation">Normal output to file</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -oX scan.xml ')">
                                    <div class="command-syntax">nmap -oX scan.xml [target]</div>
                                    <div class="command-explanation">XML output to file</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -oG scan.gnmap ')">
                                    <div class="command-syntax">nmap -oG scan.gnmap [target]</div>
                                    <div class="command-explanation">Grepable output to file</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -oA scan ')">
                                    <div class="command-syntax">nmap -oA scan [target]</div>
                                    <div class="command-explanation">Output in all formats</div>
                                </div>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>‚öôÔ∏è Other Useful Options</h3>
                            <div class="ref-grid">
                                <div class="ref-item" onclick="insertCommand('nmap -v ')">
                                    <div class="command-syntax">nmap -v [target]</div>
                                    <div class="command-explanation">Verbose output</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -vv ')">
                                    <div class="command-syntax">nmap -vv [target]</div>
                                    <div class="command-explanation">Very verbose output</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -Pn ')">
                                    <div class="command-syntax">nmap -Pn [target]</div>
                                    <div class="command-explanation">Skip host discovery (no ping)</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -n ')">
                                    <div class="command-syntax">nmap -n [target]</div>
                                    <div class="command-explanation">No DNS resolution</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -R ')">
                                    <div class="command-syntax">nmap -R [target]</div>
                                    <div class="command-explanation">Always resolve DNS</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap --reason ')">
                                    <div class="command-syntax">nmap --reason [target]</div>
                                    <div class="command-explanation">Show why port is in particular state</div>
                                </div>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>üî• Common Combinations</h3>
                            <div class="ref-grid">
                                <div class="ref-item" onclick="insertCommand('nmap -sS -sV -O -T4 ')">
                                    <div class="command-syntax">nmap -sS -sV -O -T4 [target]</div>
                                    <div class="command-explanation">Fast comprehensive scan</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -p- -T4 -A ')">
                                    <div class="command-syntax">nmap -p- -T4 -A [target]</div>
                                    <div class="command-explanation">Full port aggressive scan</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -sU -sV --top-ports 100 ')">
                                    <div class="command-syntax">nmap -sU -sV --top-ports 100 [target]</div>
                                    <div class="command-explanation">Top 100 UDP ports with version detection</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -sS -Pn -p- -vv ')">
                                    <div class="command-syntax">nmap -sS -Pn -p- -vv [target]</div>
                                    <div class="command-explanation">Stealth full port scan, no ping</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap --script vuln -sV ')">
                                    <div class="command-syntax">nmap --script vuln -sV [target]</div>
                                    <div class="command-explanation">Vulnerability scan with version detection</div>
                                </div>
                                <div class="ref-item" onclick="insertCommand('nmap -sS -sU -p U:53,111,137,T:21-25,80,443 ')">
                                    <div class="command-syntax">nmap -sS -sU -p U:53,111,137,T:21-25,80,443 [target]</div>
                                    <div class="command-explanation">Combined TCP and UDP on specific ports</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SETTINGS TAB -->
                <div id="settings" class="tab-content">
                    <div class="settings-container">
                        <div class="settings-section">
                            <h3>üíæ Progress Management</h3>
                            <div class="settings-row">
                                <label>Export your progress (challenges, statistics)</label>
                                <button class="settings-btn" onclick="exportProgress()">Export Progress</button>
                            </div>
                            <div class="settings-row">
                                <label>Import previously saved progress</label>
                                <button class="settings-btn secondary" onclick="importProgress()">Import Progress</button>
                            </div>
                            <div class="settings-row">
                                <label>Reset all progress and statistics</label>
                                <button class="settings-btn secondary" onclick="resetProgress()">Reset All Progress</button>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>üìä Statistics</h3>
                            <div class="settings-row">
                                <label>Challenges Completed</label>
                                <span id="statsChallenges" style="color: #22c55e; font-weight: 600;">0 / 10</span>
                            </div>
                            <div class="settings-row">
                                <label>Total Points Earned</label>
                                <span id="statsPoints" style="color: #fbbf24; font-weight: 600;">0</span>
                            </div>
                            <div class="settings-row">
                                <label>Scans Executed</label>
                                <span id="statsScans" style="color: #a855f7; font-weight: 600;">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SIDEBAR -->
            <div class="sidebar" id="sidebar">
                <h3>üìñ Learning Panel</h3>
                <div id="learningContent">
                    <h4>Welcome to Nmap Training!</h4>
                    <p>This interactive lab will teach you how to use Nmap for network reconnaissance and security scanning like a professional penetration tester.</p>

                    <div class="tip-box">
                        <strong>üí° Getting Started</strong>
                        <p>Start with the <strong>Learn</strong> tab for fundamentals, then practice in the <strong>Scanner Lab</strong>!</p>
                    </div>

                    <h4>Quick Commands</h4>
                    <p>Click to insert into target field:</p>
                    <div class="quick-commands">
                        <button class="quick-command-btn" onclick="setTarget('192.168.1.100')">192.168.1.100</button>
                        <button class="quick-command-btn" onclick="setTarget('10.0.0.5')">10.0.0.5</button>
                        <button class="quick-command-btn" onclick="setTarget('192.168.1.0/24')">192.168.1.0/24</button>
                    </div>

                    <h4>Common Port Ranges</h4>
                    <div class="quick-commands">
                        <button class="quick-command-btn" onclick="setPorts('22,80,443')">22,80,443 (Common)</button>
                        <button class="quick-command-btn" onclick="setPorts('1-1000')">1-1000 (Well-known)</button>
                        <button class="quick-command-btn" onclick="setPorts('1-65535')">1-65535 (All ports)</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== STATE MANAGEMENT ====================
        let scanCount = 0;
        let currentScenario = null;

        // Challenge state
        let challenges = [];
        let completedChallenges = new Set();
        let totalPoints = 0;

        // ==================== CHALLENGES DEFINITION ====================
        const challengeDefinitions = [
            {
                id: 1,
                title: 'Basic SYN Scan',
                description: 'Write a command to perform a basic SYN scan on target 192.168.1.100',
                hint: 'Use the -sS flag for SYN scan. Format: nmap -sS [target]',
                points: 10,
                check: (cmd) => cmd.includes('-sS') && cmd.includes('192.168.1.100')
            },
            {
                id: 2,
                title: 'Scan Specific Ports',
                description: 'Scan ports 22, 80, and 443 on target 10.0.0.5',
                hint: 'Use -p flag with comma-separated ports. Format: nmap -p 22,80,443 [target]',
                points: 15,
                check: (cmd) => cmd.includes('-p') && (cmd.includes('22,80,443') || cmd.includes('22-443')) && cmd.includes('10.0.0.5')
            },
            {
                id: 3,
                title: 'Service Version Detection',
                description: 'Run a scan with service version detection on 192.168.1.50',
                hint: 'Use the -sV flag for version detection',
                points: 15,
                check: (cmd) => cmd.includes('-sV') && cmd.includes('192.168.1.50')
            },
            {
                id: 4,
                title: 'Operating System Detection',
                description: 'Perform OS detection on target 10.0.0.10',
                hint: 'Use the -O flag for OS detection',
                points: 15,
                check: (cmd) => cmd.includes('-O') && cmd.includes('10.0.0.10')
            },
            {
                id: 5,
                title: 'UDP Scan',
                description: 'Run a UDP scan on the top 100 ports of 192.168.1.1',
                hint: 'Combine -sU (UDP scan) with --top-ports 100',
                points: 20,
                check: (cmd) => cmd.includes('-sU') && cmd.includes('--top-ports') && cmd.includes('192.168.1.1')
            },
            {
                id: 6,
                title: 'Aggressive Scan',
                description: 'Perform an aggressive scan (-A) on 10.0.0.20',
                hint: 'Use the -A flag which enables OS detection, version detection, script scanning, and traceroute',
                points: 15,
                check: (cmd) => cmd.includes('-A') && cmd.includes('10.0.0.20')
            },
            {
                id: 7,
                title: 'Scan Port Range with Timing',
                description: 'Scan ports 1-1000 on 192.168.1.100 using T4 (aggressive) timing',
                hint: 'Combine -p 1-1000 with -T4 timing template',
                points: 20,
                check: (cmd) => cmd.includes('-p') && (cmd.includes('1-1000') || cmd.includes('1000')) && cmd.includes('-T4') && cmd.includes('192.168.1.100')
            },
            {
                id: 8,
                title: 'NSE Vulnerability Scan',
                description: 'Run NSE vulnerability scripts against 10.0.0.5',
                hint: 'Use --script=vuln or --script vuln',
                points: 25,
                check: (cmd) => cmd.includes('--script') && (cmd.includes('vuln') || cmd.includes('default')) && cmd.includes('10.0.0.5')
            },
            {
                id: 9,
                title: 'No Ping Scan',
                description: 'Scan 192.168.1.200 without sending ping probes (useful if ICMP is blocked)',
                hint: 'Use the -Pn flag to skip host discovery',
                points: 20,
                check: (cmd) => cmd.includes('-Pn') && cmd.includes('192.168.1.200')
            },
            {
                id: 10,
                title: 'Comprehensive Scan',
                description: 'Create a comprehensive scan: SYN scan, all ports, service version detection, OS detection, aggressive timing on 10.0.0.100',
                hint: 'Combine -sS, -p-, -sV, -O, and -T4 flags',
                points: 30,
                check: (cmd) => {
                    return cmd.includes('-sS') &&
                           cmd.includes('-p-') &&
                           cmd.includes('-sV') &&
                           cmd.includes('-O') &&
                           cmd.includes('-T4') &&
                           cmd.includes('10.0.0.100');
                }
            }
        ];

        // ==================== SCENARIO DEFINITIONS ====================
        const scenarios = {
            webserver: {
                name: 'Web Server (Linux)',
                target: '192.168.1.100',
                os: 'Linux 3.10 - 4.11',
                ports: [
                    { port: 22, state: 'open', service: 'ssh', version: 'OpenSSH 7.4 (protocol 2.0)' },
                    { port: 80, state: 'open', service: 'http', version: 'Apache httpd 2.4.6 ((CentOS))' },
                    { port: 443, state: 'open', service: 'ssl/http', version: 'Apache httpd 2.4.6 ((CentOS))' },
                    { port: 3306, state: 'open', service: 'mysql', version: 'MySQL 5.7.34' },
                    { port: 8080, state: 'open', service: 'http-proxy', version: 'Squid http proxy 3.5.20' }
                ]
            },
            windows: {
                name: 'Windows Desktop',
                target: '10.0.0.5',
                os: 'Microsoft Windows 10 Pro (build 19044)',
                ports: [
                    { port: 135, state: 'open', service: 'msrpc', version: 'Microsoft Windows RPC' },
                    { port: 139, state: 'open', service: 'netbios-ssn', version: 'Microsoft Windows netbios-ssn' },
                    { port: 445, state: 'open', service: 'microsoft-ds', version: 'Windows 10 Pro microsoft-ds' },
                    { port: 3389, state: 'open', service: 'ms-wbt-server', version: 'Microsoft Terminal Services' },
                    { port: 5357, state: 'open', service: 'http', version: 'Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)' }
                ]
            },
            firewall: {
                name: 'Firewalled Host',
                target: '192.168.1.50',
                os: 'Unknown (firewall prevents OS detection)',
                ports: [
                    { port: 80, state: 'open', service: 'http', version: 'Apache httpd' },
                    { port: 443, state: 'open', service: 'ssl/http', version: 'Apache httpd' },
                    { port: 22, state: 'filtered', service: 'ssh', version: null },
                    { port: 23, state: 'filtered', service: 'telnet', version: null },
                    { port: 21, state: 'filtered', service: 'ftp', version: null },
                    { port: 25, state: 'filtered', service: 'smtp', version: null }
                ]
            },
            vulnerable: {
                name: 'Vulnerable Server',
                target: '10.0.0.20',
                os: 'Linux 2.6.32 (Ubuntu 10.04)',
                ports: [
                    { port: 21, state: 'open', service: 'ftp', version: 'vsftpd 2.3.4 (BACKDOORED!)' },
                    { port: 22, state: 'open', service: 'ssh', version: 'OpenSSH 4.7p1 (VULNERABLE)' },
                    { port: 23, state: 'open', service: 'telnet', version: 'Linux telnetd' },
                    { port: 80, state: 'open', service: 'http', version: 'Apache httpd 2.2.8 (OUTDATED)' },
                    { port: 139, state: 'open', service: 'netbios-ssn', version: 'Samba smbd 3.X - 4.X' },
                    { port: 445, state: 'open', service: 'netbios-ssn', version: 'Samba smbd 3.0.20 (MS08-067 VULNERABLE)' },
                    { port: 3306, state: 'open', service: 'mysql', version: 'MySQL 5.0.51a-3ubuntu5' }
                ]
            },
            router: {
                name: 'Network Router',
                target: '192.168.1.1',
                os: 'Linux-based router firmware',
                ports: [
                    { port: 23, state: 'open', service: 'telnet', version: 'Busybox telnetd' },
                    { port: 53, state: 'open', service: 'domain', version: 'dnsmasq 2.76' },
                    { port: 80, state: 'open', service: 'http', version: 'lighttpd 1.4.35' },
                    { port: 443, state: 'open', service: 'ssl/http', version: 'lighttpd 1.4.35' },
                    { port: 8080, state: 'open', service: 'http-proxy', version: 'Boa httpd 0.94.14rc21' }
                ]
            }
        };

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', () => {
            initializeChallenges();
            loadProgress();
            updateStats();
        });

        function initializeChallenges() {
            challenges = [...challengeDefinitions];
            renderChallenges();
        }

        // ==================== TAB SWITCHING ====================
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab content
            document.getElementById(tabName).classList.add('active');

            // Add active class to clicked tab
            event.target.classList.add('active');

            // Update learning panel based on active tab
            updateLearningPanel(tabName);
        }

        function updateLearningPanel(tabName) {
            const panel = document.getElementById('learningContent');

            const content = {
                'learn': `
                    <h4>Welcome to Nmap Training!</h4>
                    <p>This interactive lab will teach you how to use Nmap for network reconnaissance and security scanning like a professional penetration tester.</p>
                    <div class="tip-box">
                        <strong>üí° Getting Started</strong>
                        <p>Start with the <strong>Learn</strong> tab for fundamentals, then practice in the <strong>Scanner Lab</strong>!</p>
                    </div>
                `,
                'scanner-lab': `
                    <h4>Scanner Lab</h4>
                    <p>Practice running simulated Nmap scans against various target types. All scans are simulated - no actual network traffic is generated.</p>
                    <div class="tip-box">
                        <strong>üí° Try This</strong>
                        <p>Load a pre-configured scenario and experiment with different scan types and options!</p>
                    </div>
                    <h4>Quick Commands</h4>
                    <div class="quick-commands">
                        <button class="quick-command-btn" onclick="setTarget('192.168.1.100')">192.168.1.100</button>
                        <button class="quick-command-btn" onclick="setTarget('10.0.0.5')">10.0.0.5</button>
                        <button class="quick-command-btn" onclick="setTarget('192.168.1.0/24')">192.168.1.0/24</button>
                    </div>
                    <h4>Common Port Ranges</h4>
                    <div class="quick-commands">
                        <button class="quick-command-btn" onclick="setPorts('22,80,443')">22,80,443</button>
                        <button class="quick-command-btn" onclick="setPorts('1-1000')">1-1000</button>
                        <button class="quick-command-btn" onclick="setPorts('1-65535')">All ports</button>
                    </div>
                `,
                'challenges': `
                    <h4>Challenges</h4>
                    <p>Test your Nmap knowledge with these progressively difficult challenges. Each correct answer earns points!</p>
                    <div class="tip-box">
                        <strong>üí° Stuck?</strong>
                        <p>Click the "Show Hint" button on any challenge for guidance. Reference the <strong>Learn</strong> tab or <strong>Reference</strong> section for syntax help.</p>
                    </div>
                `,
                'reference': `
                    <h4>Command Reference</h4>
                    <p>Quick reference for all Nmap commands covered in this lab. Click any command to copy it to your clipboard.</p>
                    <div class="tip-box">
                        <strong>üí° Pro Tip</strong>
                        <p>Click any reference item to insert the command into the Scanner Lab!</p>
                    </div>
                `,
                'settings': `
                    <h4>Settings & Progress</h4>
                    <p>Manage your training progress, export/import data, and view your statistics.</p>
                    <div class="tip-box">
                        <strong>üí° Save Your Work</strong>
                        <p>Export your progress regularly to avoid losing your achievements!</p>
                    </div>
                `
            };

            panel.innerHTML = content[tabName] || content['learn'];
        }

        // ==================== SCANNER LAB FUNCTIONS ====================
        function loadScenario(scenarioName) {
            currentScenario = scenarios[scenarioName];
            if (!currentScenario) return;

            document.getElementById('targetInput').value = currentScenario.target;

            const output = document.getElementById('scanOutput');
            output.innerHTML = `
                <div class="output-line header">Scenario Loaded: ${currentScenario.name}</div>
                <div class="output-line" style="color: #888;">Target: ${currentScenario.target}</div>
                <div class="output-line" style="color: #888;">Configure your scan parameters and click "Run Scan"</div>
            `;
        }

        function runScan() {
            const target = document.getElementById('targetInput').value.trim();
            if (!target) {
                alert('Please enter a target IP or hostname');
                return;
            }

            const scanType = document.getElementById('scanTypeSelect').value;
            const ports = document.getElementById('portInput').value.trim();
            const timing = document.getElementById('timingSelect').value;

            const optionSV = document.getElementById('optionSV').checked;
            const optionO = document.getElementById('optionO').checked;
            const optionA = document.getElementById('optionA').checked;
            const optionScript = document.getElementById('optionScript').checked;
            const optionV = document.getElementById('optionV').checked;
            const optionPn = document.getElementById('optionPn').checked;

            // Build command string
            let command = 'nmap';
            command += ' ' + scanType;
            if (ports) command += ' -p ' + ports;
            command += ' ' + timing;
            if (optionSV) command += ' -sV';
            if (optionO) command += ' -O';
            if (optionA) command += ' -A';
            if (optionScript) command += ' --script=default';
            if (optionV) command += ' -v';
            if (optionPn) command += ' -Pn';
            command += ' ' + target;

            // Simulate scan
            simulateScan(command, target, scanType, optionSV, optionO, optionA);
            scanCount++;
            updateStats();
        }

        function simulateScan(command, target, scanType, versionDetect, osDetect, aggressive) {
            const output = document.getElementById('scanOutput');
            const scanBtn = document.getElementById('scanButton');

            scanBtn.disabled = true;
            scanBtn.textContent = '‚è≥ Scanning...';
            scanBtn.classList.add('scanning');

            output.innerHTML = '';
            addOutputLine('Starting Nmap 7.94 ( https://nmap.org ) at ' + new Date().toUTCString(), 'header');
            addOutputLine('Nmap scan command: ' + command, '');
            addOutputLine('', '');

            // Find matching scenario or generate generic results
            let scenarioData = null;
            for (let key in scenarios) {
                if (scenarios[key].target === target) {
                    scenarioData = scenarios[key];
                    break;
                }
            }

            setTimeout(() => {
                if (scenarioData) {
                    generateScenarioOutput(scenarioData, versionDetect, osDetect, aggressive);
                } else {
                    generateGenericOutput(target, scanType, versionDetect, osDetect);
                }

                addOutputLine('', '');
                addOutputLine('Nmap done: 1 IP address (1 host up) scanned in ' + (Math.random() * 30 + 5).toFixed(2) + ' seconds', 'header');

                scanBtn.disabled = false;
                scanBtn.textContent = '‚ñ∂Ô∏è Run Scan';
                scanBtn.classList.remove('scanning');
            }, 2000);
        }

        function generateScenarioOutput(scenario, versionDetect, osDetect, aggressive) {
            addOutputLine('Nmap scan report for ' + scenario.target, 'header');
            addOutputLine('Host is up (0.0012s latency).', '');
            addOutputLine('', '');
            addOutputLine('PORT      STATE    SERVICE       VERSION', 'header');

            scenario.ports.forEach(p => {
                let line = `${p.port}/tcp`.padEnd(10) + p.state.padEnd(9);
                line += p.service.padEnd(14);

                if ((versionDetect || aggressive) && p.version) {
                    line += p.version;
                }

                addOutputLine(line, p.state === 'open' ? 'open-port' : (p.state === 'filtered' ? 'filtered-port' : 'closed-port'));
            });

            if (osDetect || aggressive) {
                addOutputLine('', '');
                addOutputLine('OS detection results:', 'service');
                addOutputLine('OS: ' + scenario.os, 'service');
            }

            if (aggressive) {
                addOutputLine('', '');
                addOutputLine('NSE: Script scanning.', 'service');
                addOutputLine('NSE: Starting runlevel 1 (of 3) scan.', '');

                if (scenario.name.includes('Vulnerable')) {
                    addOutputLine('', '');
                    addOutputLine('‚ö†Ô∏è VULNERABILITIES DETECTED:', 'warning');
                    addOutputLine('| smb-vuln-ms08-067: VULNERABLE', 'error');
                    addOutputLine('| ftp-vsftpd-backdoor: VULNERABLE (vsftpd 2.3.4 backdoor)', 'error');
                    addOutputLine('| ssh-cve2018-15473: Server vulnerable to user enumeration', 'warning');
                }
            }
        }

        function generateGenericOutput(target, scanType, versionDetect, osDetect) {
            addOutputLine('Nmap scan report for ' + target, 'header');
            addOutputLine('Host is up (0.032s latency).', '');
            addOutputLine('', '');

            if (scanType === '-sU') {
                addOutputLine('PORT      STATE         SERVICE', 'header');
                addOutputLine('53/udp    open          domain', 'open-port');
                addOutputLine('67/udp    open|filtered dhcps', 'filtered-port');
                addOutputLine('123/udp   open          ntp', 'open-port');
                addOutputLine('161/udp   open          snmp', 'open-port');
            } else {
                addOutputLine('PORT      STATE    SERVICE' + (versionDetect ? '       VERSION' : ''), 'header');
                addOutputLine('22/tcp    open     ssh' + (versionDetect ? '         OpenSSH 8.2p1' : ''), 'open-port');
                addOutputLine('80/tcp    open     http' + (versionDetect ? '        nginx 1.18.0' : ''), 'open-port');
                addOutputLine('443/tcp   open     ssl/http' + (versionDetect ? '    nginx 1.18.0' : ''), 'open-port');
            }

            if (osDetect) {
                addOutputLine('', '');
                addOutputLine('OS detection results:', 'service');
                addOutputLine('OS: Linux 4.15 - 5.6', 'service');
            }
        }

        function addOutputLine(text, className) {
            const output = document.getElementById('scanOutput');
            const line = document.createElement('div');
            line.className = 'output-line ' + className;
            line.textContent = text || '\u00A0'; // Non-breaking space for empty lines
            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }

        function setTarget(target) {
            document.getElementById('targetInput').value = target;
        }

        function setPorts(ports) {
            document.getElementById('portInput').value = ports;
        }

        // ==================== CHALLENGES FUNCTIONS ====================
        function renderChallenges() {
            const container = document.getElementById('challengeList');
            container.innerHTML = challenges.map(ch => `
                <div class="challenge-card ${completedChallenges.has(ch.id) ? 'completed' : ''}" id="challenge-${ch.id}">
                    <div class="challenge-header">
                        <div class="challenge-title">${completedChallenges.has(ch.id) ? '‚úì ' : ''}${ch.title}</div>
                        <div class="challenge-points">${ch.points} points</div>
                    </div>
                    <div class="challenge-description">${ch.description}</div>
                    ${!completedChallenges.has(ch.id) ? `
                        <div class="challenge-input-group">
                            <input type="text" class="challenge-input" id="input-${ch.id}" placeholder="Enter nmap command...">
                            <button class="check-btn" onclick="checkChallenge(${ch.id})">Check</button>
                        </div>
                        <button class="hint-btn" onclick="toggleHint(${ch.id})">üí° Show Hint</button>
                        <div class="hint-text" id="hint-${ch.id}">${ch.hint}</div>
                        <div class="feedback" id="feedback-${ch.id}"></div>
                    ` : '<div class="feedback correct show">‚úì Challenge completed!</div>'}
                </div>
            `).join('');

            updateProgress();
        }

        function checkChallenge(id) {
            const challenge = challenges.find(ch => ch.id === id);
            const input = document.getElementById(`input-${id}`).value.trim().toLowerCase();
            const feedback = document.getElementById(`feedback-${id}`);

            if (challenge.check(input)) {
                feedback.textContent = '‚úì Correct! +' + challenge.points + ' points';
                feedback.className = 'feedback correct show';
                completedChallenges.add(id);
                totalPoints += challenge.points;

                setTimeout(() => {
                    renderChallenges();
                    saveProgress();
                    updateStats();
                }, 1500);
            } else {
                feedback.textContent = '‚úó Incorrect. Try again or check the hint.';
                feedback.className = 'feedback incorrect show';
            }
        }

        function toggleHint(id) {
            const hint = document.getElementById(`hint-${id}`);
            hint.classList.toggle('show');
        }

        function updateProgress() {
            const completed = completedChallenges.size;
            const total = challenges.length;
            const percentage = (completed / total) * 100;

            document.getElementById('progressBar').style.width = percentage + '%';
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('totalChallenges').textContent = total;
            document.getElementById('totalPoints').textContent = totalPoints + ' points';
        }

        // ==================== REFERENCE FUNCTIONS ====================
        function insertCommand(command) {
            // Switch to Scanner Lab tab
            switchTab('scanner-lab');

            // Insert command into target input (removing [target] placeholder)
            const cleanCommand = command.replace('[target]', '').trim();
            document.getElementById('targetInput').focus();

            // Show notification
            showNotification('Command reference copied! Configure target and run scan.');
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #7c3aed 0%, #dc2626 100%);
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // ==================== SETTINGS FUNCTIONS ====================
        function exportProgress() {
            const data = {
                completedChallenges: Array.from(completedChallenges),
                totalPoints: totalPoints,
                scanCount: scanCount,
                exportDate: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'nmap-training-progress.json';
            a.click();
            URL.revokeObjectURL(url);

            showNotification('Progress exported successfully!');
        }

        function importProgress() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';

            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();

                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        completedChallenges = new Set(data.completedChallenges || []);
                        totalPoints = data.totalPoints || 0;
                        scanCount = data.scanCount || 0;

                        renderChallenges();
                        saveProgress();
                        updateStats();

                        showNotification('Progress imported successfully!');
                    } catch (err) {
                        alert('Error importing progress file: ' + err.message);
                    }
                };

                reader.readAsText(file);
            };

            input.click();
        }

        function resetProgress() {
            if (confirm('Are you sure you want to reset ALL progress? This cannot be undone!')) {
                completedChallenges.clear();
                totalPoints = 0;
                scanCount = 0;

                renderChallenges();
                saveProgress();
                updateStats();

                showNotification('Progress reset successfully!');
            }
        }

        function saveProgress() {
            const data = {
                completedChallenges: Array.from(completedChallenges),
                totalPoints: totalPoints,
                scanCount: scanCount
            };
            localStorage.setItem('nmapTrainingProgress', JSON.stringify(data));
        }

        function loadProgress() {
            const saved = localStorage.getItem('nmapTrainingProgress');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    completedChallenges = new Set(data.completedChallenges || []);
                    totalPoints = data.totalPoints || 0;
                    scanCount = data.scanCount || 0;

                    renderChallenges();
                } catch (err) {
                    console.error('Error loading progress:', err);
                }
            }
        }

        function updateStats() {
            document.getElementById('statsChallenges').textContent = `${completedChallenges.size} / ${challenges.length}`;
            document.getElementById('statsPoints').textContent = totalPoints;
            document.getElementById('statsScans').textContent = scanCount;
        }
    </script>
</body>
</html>
