<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Arts Mastery Challenge - The Vault</title>
    <link rel="stylesheet" href="../../../styles/quiz-engine.css">
    <style>
        /* Dark Arts Page Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #0d0a1a 0%, #1a0a2e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .page-container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* Header */
        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #9333ea;
            text-decoration: none;
            font-size: 0.9rem;
            margin-bottom: 20px;
            transition: all 0.2s ease;
        }

        .back-link:hover {
            color: #a855f7;
            transform: translateX(-5px);
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, #9333ea, #7e22ce);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .page-subtitle {
            color: #888;
            font-size: 1.1rem;
        }

        /* Quiz Container */
        #quiz-container {
            margin-bottom: 40px;
        }

        /* Footer */
        .page-footer {
            text-align: center;
            color: #555;
            font-size: 0.85rem;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .page-footer a {
            color: #9333ea;
            text-decoration: none;
        }

        .page-footer a:hover {
            text-decoration: underline;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- Header -->
        <div class="page-header">
            <a href="../index.html" class="back-link">
                ← Back to The Vault
            </a>
            <h1 class="page-title">Dark Arts Mastery Challenge</h1>
            <p class="page-subtitle">Prove your knowledge of malware analysis and threat intelligence</p>
        </div>

        <!-- Quiz Container -->
        <div id="quiz-container">
            <div class="loading">Preparing quiz</div>
        </div>

        <!-- Footer -->
        <div class="page-footer">
            <p>Part of <strong>The Dark Arts</strong> • Hexworth Prime</p>
            <p>Need to review? Check the <a href="../modules/">modules</a> before retaking.</p>
        </div>
    </div>

    <!-- QuizEngine Component -->
    <script src="../../../components/QuizEngine.js"></script>

    <!-- Quiz Configuration & Initialization -->
    <script>
        /**
         * Dark Arts Mastery Challenge
         * Comprehensive quiz covering malware analysis, threat intelligence, and security tools
         */

        const darkArtsQuestions = [
            // ============================================
            // STATIC ANALYSIS (5 questions)
            // ============================================
            {
                question: "What does the 'MZ' signature at the beginning of a Windows executable indicate?",
                options: [
                    "The file is compressed",
                    "The file is a valid DOS/Windows executable",
                    "The file contains malware",
                    "The file is digitally signed"
                ],
                correct: 1,
                explanation: "The 'MZ' signature (0x4D5A in hex) marks the start of a DOS executable header. These are the initials of Mark Zbikowski, one of the original MS-DOS developers. This signature is present in all valid Windows PE files."
            },
            {
                question: "Which Windows API function is most commonly used for process injection attacks?",
                options: [
                    "CreateFile()",
                    "WriteProcessMemory()",
                    "MessageBox()",
                    "GetSystemInfo()"
                ],
                correct: 1,
                explanation: "WriteProcessMemory() is a key API for process injection. It allows malware to write malicious code into another process's memory space. This is often combined with VirtualAllocEx() and CreateRemoteThread() in injection attacks."
            },
            {
                question: "In PE file analysis, what does high entropy typically indicate?",
                options: [
                    "The file is very old",
                    "The file is compressed or encrypted",
                    "The file has many imports",
                    "The file is safe to execute"
                ],
                correct: 1,
                explanation: "High entropy (close to 8.0) indicates data that appears random, suggesting encryption or compression. Malware often uses packing/encryption to hide its true nature. Legitimate files typically have entropy between 5.0-7.0."
            },
            {
                question: "When analyzing strings in a binary, which pattern is most suspicious?",
                options: [
                    "'Copyright Microsoft Corporation'",
                    "'127.0.0.1' with 'POST' and 'cmd.exe'",
                    "'Windows NT 10.0'",
                    "'System32'"
                ],
                correct: 1,
                explanation: "The combination of an IP address (especially localhost), HTTP method (POST), and command shell (cmd.exe) strongly suggests command-and-control (C2) communication capabilities. These strings together indicate remote command execution functionality."
            },
            {
                question: "Which magic bytes identify a Linux ELF executable?",
                options: [
                    "0x4D5A (MZ)",
                    "0x7F454C46 (\\x7FELF)",
                    "0x504B0304 (PK..)",
                    "0xCAFEBABE"
                ],
                correct: 1,
                explanation: "ELF (Executable and Linkable Format) files start with 0x7F followed by 'ELF' in ASCII (0x454C46). This signature identifies Linux executables, similar to how 'MZ' identifies Windows PE files. The 0x7F makes it non-printable ASCII."
            },

            // ============================================
            // BEHAVIORAL ANALYSIS (5 questions)
            // ============================================
            {
                question: "What is the primary difference between reflective DLL injection and classic DLL injection?",
                options: [
                    "Reflective injection doesn't require LoadLibrary()",
                    "Reflective injection only works on Linux",
                    "Reflective injection is slower",
                    "Reflective injection requires administrator privileges"
                ],
                correct: 0,
                explanation: "Reflective DLL injection loads a DLL from memory without using LoadLibrary() or touching disk. The DLL contains its own loader that manually maps sections and resolves imports. This technique is stealthier as it doesn't leave traditional injection artifacts."
            },
            {
                question: "Which registry key is most commonly abused for malware persistence?",
                options: [
                    "HKLM\\SYSTEM\\CurrentControlSet\\Services",
                    "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run",
                    "HKLM\\SOFTWARE\\Classes",
                    "HKCU\\Control Panel\\Desktop"
                ],
                correct: 1,
                explanation: "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run (and its HKLM equivalent) is the most common persistence location. Programs listed here execute automatically at user login. It's favored by malware for its simplicity and reliability."
            },
            {
                question: "What characterizes a 'process hollowing' attack?",
                options: [
                    "Creating many empty processes to exhaust resources",
                    "Replacing legitimate process code with malicious code",
                    "Monitoring all running processes",
                    "Terminating security software processes"
                ],
                correct: 1,
                explanation: "Process hollowing creates a legitimate process in suspended state, unmaps its memory, injects malicious code, then resumes execution. The process appears legitimate (e.g., svchost.exe) but runs malicious code. This technique evades process name-based detection."
            },
            {
                question: "In C2 communications, what does 'beaconing' refer to?",
                options: [
                    "Broadcasting the bot's IP to all network hosts",
                    "Periodic check-ins to a command server at regular intervals",
                    "Using Bluetooth for communication",
                    "Encrypting all network traffic"
                ],
                correct: 1,
                explanation: "Beaconing is when malware regularly 'phones home' to its C2 server (e.g., every 60 seconds). This pattern creates distinctive network traffic that can be detected through traffic analysis. Consistent timing intervals are a strong indicator of automated malware behavior."
            },
            {
                question: "Why is monitoring the CreateRemoteThread() API important in behavioral analysis?",
                options: [
                    "It indicates normal multithreading",
                    "It's commonly used for code injection into other processes",
                    "It shows the program is well-optimized",
                    "It prevents race conditions"
                ],
                correct: 1,
                explanation: "CreateRemoteThread() creates a thread in another process's address space, a classic injection technique. While legitimate software occasionally uses this, it's a strong behavioral indicator when combined with VirtualAllocEx() and WriteProcessMemory(). Security tools monitor this API closely."
            },

            // ============================================
            // MALWARE FAMILIES (5 questions)
            // ============================================
            {
                question: "What made WannaCry particularly devastating in 2017?",
                options: [
                    "It targeted mobile devices",
                    "It used the EternalBlue exploit to spread automatically",
                    "It was the first ransomware ever created",
                    "It only affected government systems"
                ],
                correct: 1,
                explanation: "WannaCry weaponized EternalBlue (NSA-leaked SMBv1 exploit) enabling wormlike propagation without user interaction. This allowed it to spread rapidly across networks, infecting over 200,000 computers in 150 countries in days. The combination of ransomware + worm was unprecedented at scale."
            },
            {
                question: "How does the EMOTET malware typically gain initial access?",
                options: [
                    "Through physical USB drives",
                    "Via malicious email attachments and macros",
                    "By exploiting router vulnerabilities",
                    "Through mobile app stores"
                ],
                correct: 1,
                explanation: "EMOTET spreads primarily through spearphishing emails with malicious Word/Excel documents. When macros are enabled, it downloads the payload. EMOTET is particularly dangerous because it acts as a loader/dropper for other malware like TrickBot and ransomware."
            },
            {
                question: "What was the unique target of the Stuxnet worm?",
                options: [
                    "Banking systems worldwide",
                    "Social media platforms",
                    "Industrial control systems (specifically Iranian nuclear facilities)",
                    "Healthcare databases"
                ],
                correct: 2,
                explanation: "Stuxnet targeted Siemens SCADA systems controlling uranium enrichment centrifuges at Iran's Natanz facility. It's considered the first cyber weapon causing physical destruction. Stuxnet used four zero-days, was highly sophisticated, and demonstrated nation-state offensive cyber capabilities."
            },
            {
                question: "Which indicator is most characteristic of ransomware?",
                options: [
                    "Silent data exfiltration over months",
                    "Rapid file encryption and ransom note display",
                    "Cryptocurrency mining",
                    "Password harvesting"
                ],
                correct: 1,
                explanation: "Ransomware's defining characteristic is rapid, widespread file encryption followed by ransom demands (typically in cryptocurrency). Modern ransomware often uses 'double extortion' - encrypting AND exfiltrating data. The visible ransom note differentiates it from stealthy malware."
            },
            {
                question: "What does RAT stand for in malware terminology, and what is its primary capability?",
                options: [
                    "Rapid Attack Tool - launches DDoS attacks",
                    "Remote Access Trojan - provides full system control",
                    "Random Access Terminal - encrypts files",
                    "Recursive Analysis Tool - maps networks"
                ],
                correct: 1,
                explanation: "RAT (Remote Access Trojan) provides attackers full control over infected systems - keylogging, screen capture, file access, webcam access. Examples include DarkComet, njRAT, and Poison Ivy. RATs are used in APT campaigns for long-term espionage and lateral movement."
            },

            // ============================================
            // THREAT INTELLIGENCE (5 questions)
            // ============================================
            {
                question: "In the MITRE ATT&CK framework, what does 'ATT&CK' stand for?",
                options: [
                    "Advanced Threat Tactics & Common Knowledge",
                    "Adversarial Tactics, Techniques & Common Knowledge",
                    "Automated Threat Testing & Classification Kit",
                    "Active Threat Tracking & Control"
                ],
                correct: 1,
                explanation: "ATT&CK stands for Adversarial Tactics, Techniques, and Common Knowledge. It's a globally-accessible knowledge base of adversary tactics based on real-world observations. The framework organizes attack behaviors into 14 tactics (Initial Access, Execution, Persistence, etc.)."
            },
            {
                question: "Which type of Indicator of Compromise (IOC) is most reliable over time?",
                options: [
                    "IP addresses",
                    "Domain names",
                    "File hashes (SHA-256)",
                    "YARA rules based on code patterns"
                ],
                correct: 3,
                explanation: "YARA rules detecting code patterns/behaviors are most durable because they identify malware characteristics rather than artifacts. IPs and domains change frequently (fast-flux). File hashes change with any modification. Behavioral patterns persist across malware variants and updates."
            },
            {
                question: "What is the primary challenge in malware attribution?",
                options: [
                    "Lack of technical evidence",
                    "False flags and evidence planting by sophisticated actors",
                    "International laws prevent investigation",
                    "Malware is always anonymous"
                ],
                correct: 1,
                explanation: "Attribution is difficult because sophisticated actors deliberately plant false flags - using language strings, time zones, known tools from other groups, etc. Nation-state actors study each other's TTPs to create deception. Technical evidence can be fabricated; true attribution requires multiple intelligence sources."
            },
            {
                question: "What does 'APT' stand for, and what distinguishes APT groups from common cybercriminals?",
                options: [
                    "Automated Penetration Testing - they use tools",
                    "Advanced Persistent Threat - long-term, targeted, resourced campaigns",
                    "Anonymous Phishing Team - they hide their identity",
                    "Active Payload Transmission - they spread malware"
                ],
                correct: 1,
                explanation: "APT (Advanced Persistent Threat) refers to sophisticated threat actors (often nation-state sponsored) conducting long-term campaigns against specific targets. Key characteristics: persistent access, advanced techniques, significant resources, clear objectives (espionage, sabotage), and operational security."
            },
            {
                question: "In threat intelligence, what are the phases of the Cyber Kill Chain in order?",
                options: [
                    "Scan, Exploit, Persist, Exfiltrate",
                    "Reconnaissance, Weaponization, Delivery, Exploitation, Installation, C2, Actions",
                    "Access, Execute, Escalate, Move, Extract",
                    "Phish, Infect, Control, Profit"
                ],
                correct: 1,
                explanation: "The Lockheed Martin Cyber Kill Chain has 7 stages: Reconnaissance, Weaponization, Delivery, Exploitation, Installation, Command & Control, and Actions on Objectives. Understanding these phases helps defenders identify and break the attack chain at any stage."
            },

            // ============================================
            // TOOLS & TECHNIQUES (5 questions)
            // ============================================
            {
                question: "What is the primary purpose of a malware sandbox?",
                options: [
                    "To permanently store malware samples",
                    "To safely execute and observe malware behavior in isolation",
                    "To remove malware from infected systems",
                    "To encrypt malware for storage"
                ],
                correct: 1,
                explanation: "Sandboxes (like Cuckoo, ANY.RUN, Joe Sandbox) provide isolated environments to safely detonate malware and observe behavior - network connections, file modifications, registry changes, process creation. This dynamic analysis reveals runtime behaviors that static analysis cannot detect."
            },
            {
                question: "What information does Process Monitor (Procmon) capture?",
                options: [
                    "Only network traffic",
                    "File system, registry, process/thread activity in real-time",
                    "Only CPU and memory usage",
                    "Keyboard and mouse input only"
                ],
                correct: 1,
                explanation: "Process Monitor is a Sysinternals tool capturing real-time file system, registry, process/thread, and network activity. It's invaluable for malware analysis - showing exactly what a process touches. Filters help isolate suspicious behavior from normal system noise."
            },
            {
                question: "When analyzing malware with Wireshark, which filter would show potential C2 communication?",
                options: [
                    "http.request or dns or tcp.flags.syn==1",
                    "ip.src == 127.0.0.1",
                    "ethernet.type == 0x0800",
                    "frame.len > 1500"
                ],
                correct: 0,
                explanation: "Filtering for HTTP requests, DNS queries, or TCP SYN packets helps identify outbound connection attempts typical of C2 communication. Malware often uses HTTP/HTTPS for blending with normal traffic or DNS for data exfiltration. Monitoring new connections reveals beaconing patterns."
            },
            {
                question: "What is the primary use of a debugger (like x64dbg or WinDbg) in malware analysis?",
                options: [
                    "To fix bugs in the malware code",
                    "To step through code execution, set breakpoints, and examine memory/registers",
                    "To automatically remove malware",
                    "To compile malware from source code"
                ],
                correct: 1,
                explanation: "Debuggers allow analysts to execute malware instruction-by-instruction, pause at specific points (breakpoints), examine registers and memory, and understand program logic. This is critical for unpacking, reverse engineering algorithms, and understanding anti-analysis techniques."
            },
            {
                question: "What do YARA rules enable security analysts to do?",
                options: [
                    "Automatically remove malware from systems",
                    "Identify and classify malware based on patterns and characteristics",
                    "Encrypt sensitive files",
                    "Block all network traffic"
                ],
                correct: 1,
                explanation: "YARA is a pattern-matching tool for identifying malware based on textual or binary patterns. Rules can detect specific malware families, behaviors, or suspicious characteristics. YARA is used in sandboxes, endpoint detection, threat hunting, and incident response for scalable malware identification."
            }
        ];

        // Initialize Quiz Engine
        document.addEventListener('DOMContentLoaded', function() {
            const quiz = new QuizEngine({
                containerId: 'quiz-container',
                title: 'Dark Arts Mastery Challenge',
                description: 'Prove your knowledge of malware analysis and threat intelligence',
                questions: darkArtsQuestions,
                passingScore: 70,
                showFeedback: true,
                randomize: true,
                timeLimit: null, // Untimed - let them think through complex concepts
                theme: 'dark-arts',
                achievement: 'dark-arts-master',
                retryAllowed: true,
                onComplete: function(results) {
                    console.log('Quiz completed:', results);

                    // Store results in localStorage for tracking
                    const quizHistory = JSON.parse(localStorage.getItem('darkarts_quiz_history') || '[]');
                    quizHistory.push({
                        date: new Date().toISOString(),
                        score: results.score,
                        total: results.total,
                        percentage: results.percentage,
                        passed: results.passed,
                        duration: results.duration,
                        attempts: results.attempts
                    });

                    // Keep only last 10 attempts
                    if (quizHistory.length > 10) {
                        quizHistory.shift();
                    }

                    localStorage.setItem('darkarts_quiz_history', JSON.stringify(quizHistory));

                    // If passed, mark module as complete
                    if (results.passed) {
                        const completedModules = JSON.parse(localStorage.getItem('darkarts_completed_modules') || '[]');
                        if (!completedModules.includes('mastery-quiz')) {
                            completedModules.push('mastery-quiz');
                            localStorage.setItem('darkarts_completed_modules', JSON.stringify(completedModules));
                        }
                    }
                },
                onQuestionAnswer: function(data) {
                    // Optional: Track individual question performance
                    console.log('Question answered:', data.isCorrect ? 'Correct' : 'Incorrect');
                }
            });

            // Start the quiz
            quiz.start();
        });
    </script>
</body>
</html>
