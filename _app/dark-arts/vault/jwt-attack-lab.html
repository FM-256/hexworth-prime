<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JWT Attack Lab - Dark Arts Vault | Hexworth Prime</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a1a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #1a0a1a 0%, #2a0a2a 100%);
            border: 2px solid #a855f7;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(168, 85, 247, 0.3);
        }

        h1 {
            color: #a855f7;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(168, 85, 247, 0.5);
        }

        .subtitle {
            color: #dc2626;
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .back-link {
            display: inline-block;
            color: #a855f7;
            text-decoration: none;
            padding: 10px 20px;
            border: 1px solid #a855f7;
            border-radius: 5px;
            transition: all 0.3s;
            margin-top: 15px;
        }

        .back-link:hover {
            background: #a855f7;
            color: #000;
        }

        .ethical-warning {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            border: 2px solid #fca5a5;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 0 20px rgba(220, 38, 38, 0.3);
        }

        .ethical-warning h3 {
            color: #fca5a5;
            margin-bottom: 10px;
        }

        .ethical-warning p {
            color: #fef2f2;
            line-height: 1.6;
        }

        .section {
            background: rgba(30, 10, 40, 0.6);
            border: 1px solid #a855f7;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .section h2 {
            color: #a855f7;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 2px solid #a855f7;
            padding-bottom: 10px;
        }

        .section h3 {
            color: #c084fc;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .section p, .section li {
            line-height: 1.8;
            color: #d1d5db;
            margin-bottom: 10px;
        }

        .section ul {
            margin-left: 20px;
            margin-bottom: 20px;
        }

        code {
            background: #1a0a2a;
            color: #10b981;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }

        pre {
            background: #0a0a1a;
            border: 1px solid #a855f7;
            border-radius: 8px;
            padding: 20px;
            overflow-x: auto;
            margin: 15px 0;
            font-size: 0.9em;
            line-height: 1.6;
        }

        pre code {
            background: none;
            padding: 0;
        }

        /* JWT Visualizer */
        .jwt-visualizer {
            background: rgba(10, 10, 20, 0.8);
            border: 1px solid #a855f7;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .jwt-input-area {
            margin-bottom: 20px;
        }

        .jwt-input-area textarea {
            width: 100%;
            min-height: 80px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid #555;
            border-radius: 8px;
            color: #10b981;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            word-break: break-all;
            resize: vertical;
        }

        .jwt-input-area textarea:focus {
            outline: none;
            border-color: #a855f7;
        }

        .jwt-parts {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .jwt-part {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            overflow: hidden;
        }

        .jwt-part-header {
            padding: 10px 15px;
            font-weight: bold;
            font-size: 0.85em;
        }

        .jwt-part.header .jwt-part-header {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .jwt-part.payload .jwt-part-header {
            background: rgba(168, 85, 247, 0.2);
            color: #a855f7;
        }

        .jwt-part.signature .jwt-part-header {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .jwt-part-content {
            padding: 15px;
        }

        .jwt-part-raw {
            font-family: monospace;
            font-size: 0.75em;
            color: #9ca3af;
            word-break: break-all;
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        .jwt-part-decoded {
            font-family: monospace;
            font-size: 0.85em;
            white-space: pre-wrap;
        }

        .jwt-part.header .jwt-part-decoded { color: #ef4444; }
        .jwt-part.payload .jwt-part-decoded { color: #a855f7; }
        .jwt-part.signature .jwt-part-decoded { color: #3b82f6; }

        /* Attack Buttons */
        .attack-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .attack-btn {
            padding: 10px 20px;
            background: rgba(220, 38, 38, 0.2);
            border: 1px solid #dc2626;
            border-radius: 6px;
            color: #fca5a5;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s;
        }

        .attack-btn:hover {
            background: rgba(220, 38, 38, 0.4);
            box-shadow: 0 0 15px rgba(220, 38, 38, 0.3);
        }

        .success-badge {
            display: inline-block;
            padding: 3px 8px;
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
            border-radius: 4px;
            color: #10b981;
            font-size: 0.75em;
            margin-left: 10px;
        }

        /* Attack Result */
        .attack-result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }

        .attack-result.success {
            display: block;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid #10b981;
        }

        .attack-result.error {
            display: block;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
        }

        .attack-result h4 {
            margin-bottom: 10px;
        }

        .attack-result.success h4 { color: #10b981; }
        .attack-result.error h4 { color: #ef4444; }

        /* Claim Editor */
        .claim-editor {
            margin-top: 20px;
        }

        .claim-row {
            display: grid;
            grid-template-columns: 150px 1fr auto;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .claim-key, .claim-value {
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid #555;
            border-radius: 4px;
            color: #e0e0e0;
            font-family: monospace;
        }

        .claim-key:focus, .claim-value:focus {
            outline: none;
            border-color: #a855f7;
        }

        .claim-delete {
            padding: 8px 12px;
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            border-radius: 4px;
            color: #ef4444;
            cursor: pointer;
        }

        .add-claim-btn {
            padding: 8px 16px;
            background: rgba(168, 85, 247, 0.2);
            border: 1px dashed #a855f7;
            border-radius: 4px;
            color: #a855f7;
            cursor: pointer;
            margin-top: 10px;
        }

        .generate-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #a855f7, #7c3aed);
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            margin-top: 15px;
            transition: all 0.3s;
        }

        .generate-btn:hover {
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.5);
        }

        /* Quiz */
        .quiz-question {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .quiz-question h4 {
            color: #c084fc;
            margin-bottom: 15px;
        }

        .quiz-option {
            display: block;
            padding: 12px 15px;
            margin: 8px 0;
            background: rgba(168, 85, 247, 0.1);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quiz-option:hover {
            background: rgba(168, 85, 247, 0.2);
        }

        .quiz-option.correct {
            background: rgba(16, 185, 129, 0.2);
            border-color: #10b981;
        }

        .quiz-option.incorrect {
            background: rgba(239, 68, 68, 0.2);
            border-color: #ef4444;
        }

        @media (max-width: 768px) {
            h1 { font-size: 1.8em; }
            .jwt-parts { grid-template-columns: 1fr; }
            .claim-row { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>JWT Attack Lab</h1>
            <p class="subtitle">JSON Web Token Exploitation</p>
            <a href="index.html" class="back-link">Back to Vault</a>
        </header>

        <div class="ethical-warning">
            <h3>Educational Purpose Only</h3>
            <p>JWT attacks can compromise authentication systems. This lab teaches recognition and defense of JWT vulnerabilities. Only test on systems you own or have explicit permission to assess.</p>
        </div>

        <!-- JWT Structure -->
        <div class="section">
            <h2>Understanding JWT Structure</h2>
            <p>JSON Web Tokens consist of three Base64URL-encoded parts separated by dots:</p>

            <pre><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiam9obiIsInJvbGUiOiJ1c2VyIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
   └────────── Header ──────────┘.└─────────────── Payload ───────────────────────────────────┘.└────────── Signature ──────────┘</code></pre>

            <h3>1. Header</h3>
            <p>Contains the token type and signing algorithm:</p>
            <pre><code>{
  "alg": "HS256",  // Signing algorithm
  "typ": "JWT"     // Token type
}</code></pre>

            <h3>2. Payload (Claims)</h3>
            <p>Contains the actual data - user info, permissions, expiration:</p>
            <pre><code>{
  "sub": "1234567890",    // Subject (user ID)
  "name": "John Doe",     // Custom claim
  "role": "user",         // Authorization level
  "iat": 1516239022,      // Issued at timestamp
  "exp": 1516242622       // Expiration timestamp
}</code></pre>

            <h3>3. Signature</h3>
            <p>Ensures token integrity - created using the header, payload, and secret:</p>
            <pre><code>HMACSHA256(
  base64UrlEncode(header) + "." + base64UrlEncode(payload),
  secret
)</code></pre>
        </div>

        <!-- Interactive JWT Decoder -->
        <div class="section">
            <h2>JWT Decoder & Attack Simulator</h2>
            <p>Paste a JWT token to decode it, or modify the payload to simulate attacks:</p>

            <div class="jwt-visualizer">
                <div class="jwt-input-area">
                    <textarea id="jwtInput" placeholder="Paste a JWT token here...">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiam9obiIsInJvbGUiOiJ1c2VyIiwiaWF0IjoxNzAzNDgwMDAwLCJleHAiOjE3MDM1NjY0MDB9.dGVzdF9zaWduYXR1cmVfaGVyZQ</textarea>
                </div>

                <div class="jwt-parts">
                    <div class="jwt-part header">
                        <div class="jwt-part-header">HEADER</div>
                        <div class="jwt-part-content">
                            <div class="jwt-part-raw" id="headerRaw">-</div>
                            <div class="jwt-part-decoded" id="headerDecoded">-</div>
                        </div>
                    </div>
                    <div class="jwt-part payload">
                        <div class="jwt-part-header">PAYLOAD</div>
                        <div class="jwt-part-content">
                            <div class="jwt-part-raw" id="payloadRaw">-</div>
                            <div class="jwt-part-decoded" id="payloadDecoded">-</div>
                        </div>
                    </div>
                    <div class="jwt-part signature">
                        <div class="jwt-part-header">SIGNATURE</div>
                        <div class="jwt-part-content">
                            <div class="jwt-part-raw" id="signatureRaw">-</div>
                            <div class="jwt-part-decoded" id="signatureDecoded">Cannot decode - binary data</div>
                        </div>
                    </div>
                </div>

                <div class="attack-buttons">
                    <button class="attack-btn" onclick="decodeJWT()">Decode JWT</button>
                    <button class="attack-btn" onclick="algoNoneAttack()">Algorithm "none" Attack</button>
                    <button class="attack-btn" onclick="modifyRole()">Modify Role to Admin</button>
                    <button class="attack-btn" onclick="removeExpiry()">Remove Expiry</button>
                </div>

                <div class="attack-result" id="attackResult">
                    <h4></h4>
                    <p></p>
                    <pre><code id="attackCode"></code></pre>
                </div>
            </div>
        </div>

        <!-- Attack Types -->
        <div class="section">
            <h2>Common JWT Attacks</h2>

            <h3>1. Algorithm "none" Attack</h3>
            <p>Some libraries accept tokens with <code>"alg": "none"</code>, allowing unsigned tokens:</p>
            <pre><code>// Original header
{"alg": "HS256", "typ": "JWT"}

// Malicious header
{"alg": "none", "typ": "JWT"}

// The token now has NO signature requirement!
// Just modify the payload and leave signature empty</code></pre>

            <h3>2. Algorithm Confusion (RS256 → HS256)</h3>
            <p>If server expects RS256 (asymmetric) but accepts HS256 (symmetric):</p>
            <pre><code>// Server's public key (meant for verification only)
// Attacker uses it as HMAC secret

// Original: RS256 with private key signature
// Attack: HS256 signed with PUBLIC key as secret

// If server uses public key for both algorithms,
// attacker can forge valid signatures!</code></pre>

            <h3>3. Weak Secret Brute Force</h3>
            <p>If the secret is weak (like "secret", "password", etc.):</p>
            <pre><code># Using jwt-cracker or hashcat
hashcat -a 0 -m 16500 jwt.txt wordlist.txt

# Common weak secrets:
# secret, password, 123456, jwt_secret, key</code></pre>

            <h3>4. Claim Manipulation</h3>
            <p>Modifying claims without proper signature verification:</p>
            <pre><code>// Original payload
{"user": "john", "role": "user", "id": 1001}

// Modified payload (privilege escalation)
{"user": "john", "role": "admin", "id": 1}</code></pre>

            <h3>5. Token Replay</h3>
            <p>Using stolen tokens before expiration, or if no expiration is set:</p>
            <pre><code>// Token without expiry - valid forever!
{"user": "john", "role": "user"}

// Proper token with expiry
{"user": "john", "role": "user", "exp": 1703566400}</code></pre>
        </div>

        <!-- Payload Editor -->
        <div class="section">
            <h2>JWT Forge (Payload Editor)</h2>
            <p>Modify claims and generate a new (unsigned) token to understand the attack:</p>

            <div class="claim-editor" id="claimEditor">
                <div class="claim-row">
                    <input type="text" class="claim-key" value="user" readonly>
                    <input type="text" class="claim-value" value="john">
                    <button class="claim-delete" onclick="deleteClaim(this)">×</button>
                </div>
                <div class="claim-row">
                    <input type="text" class="claim-key" value="role">
                    <input type="text" class="claim-value" value="admin">
                    <button class="claim-delete" onclick="deleteClaim(this)">×</button>
                </div>
                <div class="claim-row">
                    <input type="text" class="claim-key" value="id">
                    <input type="text" class="claim-value" value="1">
                    <button class="claim-delete" onclick="deleteClaim(this)">×</button>
                </div>
            </div>
            <button class="add-claim-btn" onclick="addClaim()">+ Add Claim</button>
            <br>
            <button class="generate-btn" onclick="generateForgedJWT()">Generate Forged JWT</button>

            <div id="forgedOutput" style="margin-top: 20px; display: none;">
                <h4 style="color: #10b981; margin-bottom: 10px;">Forged Token (alg: none)</h4>
                <pre><code id="forgedToken"></code></pre>
                <p style="font-size: 0.85em; color: #f59e0b; margin-top: 10px;">
                    Note: This token has no valid signature. It only works against vulnerable servers that accept "alg": "none"
                </p>
            </div>
        </div>

        <!-- Defense -->
        <div class="section">
            <h2>Defense Mechanisms</h2>

            <h3>1. Always Verify Signatures</h3>
            <pre><code>// Python example with PyJWT
import jwt

try:
    # ALWAYS specify the expected algorithm!
    decoded = jwt.decode(token, SECRET_KEY, algorithms=["HS256"])
except jwt.InvalidSignatureError:
    return "Invalid signature"
except jwt.ExpiredSignatureError:
    return "Token expired"</code></pre>

            <h3>2. Reject "alg": "none"</h3>
            <pre><code>// Explicitly whitelist allowed algorithms
const options = {
    algorithms: ['HS256', 'RS256'],  // Only these!
    // Never include 'none'
};
jwt.verify(token, secret, options);</code></pre>

            <h3>3. Use Strong Secrets</h3>
            <pre><code># Generate a cryptographically secure secret
import secrets
SECRET_KEY = secrets.token_hex(32)  # 256 bits

# Or use RS256 with proper key pair</code></pre>

            <h3>4. Implement Proper Expiration</h3>
            <pre><code>{
  "sub": "user123",
  "iat": 1703480000,        // Issued at
  "exp": 1703483600,        // Expires in 1 hour
  "nbf": 1703480000         // Not valid before
}</code></pre>

            <h3>5. Token Revocation (Blacklist/Whitelist)</h3>
            <pre><code># Maintain a blacklist of revoked tokens (by jti claim)
revoked_tokens = redis.get("revoked_tokens")

if token.jti in revoked_tokens:
    return "Token has been revoked"</code></pre>
        </div>

        <!-- Quiz -->
        <div class="section">
            <h2>Knowledge Check</h2>

            <div class="quiz-question">
                <h4>1. What makes the "alg: none" attack possible?</h4>
                <div class="quiz-option" onclick="checkAnswer(this, true)">A) Libraries that accept unsigned tokens when algorithm is "none"</div>
                <div class="quiz-option" onclick="checkAnswer(this, false)">B) Weak encryption algorithms</div>
                <div class="quiz-option" onclick="checkAnswer(this, false)">C) Missing HTTPS</div>
                <div class="quiz-option" onclick="checkAnswer(this, false)">D) Short token length</div>
            </div>

            <div class="quiz-question">
                <h4>2. How does the RS256 to HS256 confusion attack work?</h4>
                <div class="quiz-option" onclick="checkAnswer(this, false)">A) By cracking the RSA private key</div>
                <div class="quiz-option" onclick="checkAnswer(this, true)">B) Using the public key as the HMAC secret</div>
                <div class="quiz-option" onclick="checkAnswer(this, false)">C) By downgrading to weaker encryption</div>
                <div class="quiz-option" onclick="checkAnswer(this, false)">D) By intercepting the token in transit</div>
            </div>

            <div class="quiz-question">
                <h4>3. What is the BEST defense against JWT attacks?</h4>
                <div class="quiz-option" onclick="checkAnswer(this, false)">A) Using longer tokens</div>
                <div class="quiz-option" onclick="checkAnswer(this, false)">B) Encrypting the entire token</div>
                <div class="quiz-option" onclick="checkAnswer(this, true)">C) Explicitly whitelisting allowed algorithms and verifying signatures</div>
                <div class="quiz-option" onclick="checkAnswer(this, false)">D) Storing tokens in cookies only</div>
            </div>
        </div>
    </div>

    <script>
        // Base64URL encode/decode functions
        function base64UrlEncode(str) {
            return btoa(str)
                .replace(/\+/g, '-')
                .replace(/\//g, '_')
                .replace(/=+$/, '');
        }

        function base64UrlDecode(str) {
            str = str.replace(/-/g, '+').replace(/_/g, '/');
            while (str.length % 4) str += '=';
            return atob(str);
        }

        function decodeJWT() {
            const jwt = document.getElementById('jwtInput').value.trim();
            const parts = jwt.split('.');

            if (parts.length !== 3) {
                showAttackResult('error', 'Invalid JWT', 'JWT must have exactly 3 parts separated by dots.');
                return;
            }

            try {
                const header = JSON.parse(base64UrlDecode(parts[0]));
                const payload = JSON.parse(base64UrlDecode(parts[1]));

                document.getElementById('headerRaw').textContent = parts[0];
                document.getElementById('headerDecoded').textContent = JSON.stringify(header, null, 2);

                document.getElementById('payloadRaw').textContent = parts[1];
                document.getElementById('payloadDecoded').textContent = JSON.stringify(payload, null, 2);

                document.getElementById('signatureRaw').textContent = parts[2];

                showAttackResult('success', 'JWT Decoded Successfully', `Algorithm: ${header.alg}\nUser: ${payload.user || payload.sub || 'N/A'}\nRole: ${payload.role || 'N/A'}`);

            } catch (e) {
                showAttackResult('error', 'Decode Failed', e.message);
            }
        }

        function algoNoneAttack() {
            const jwt = document.getElementById('jwtInput').value.trim();
            const parts = jwt.split('.');

            if (parts.length !== 3) return;

            try {
                let header = JSON.parse(base64UrlDecode(parts[0]));
                const payload = JSON.parse(base64UrlDecode(parts[1]));

                // Change algorithm to none
                header.alg = 'none';

                const newHeader = base64UrlEncode(JSON.stringify(header));
                const newPayload = base64UrlEncode(JSON.stringify(payload));

                // Empty signature for "none" algorithm
                const forgedToken = `${newHeader}.${newPayload}.`;

                document.getElementById('jwtInput').value = forgedToken;
                decodeJWT();

                showAttackResult('success', 'Algorithm "none" Attack',
                    `Modified header to use "alg": "none"\n\nForged token:\n${forgedToken}\n\nIf the server accepts this, it won't verify the signature!`);

            } catch (e) {
                showAttackResult('error', 'Attack Failed', e.message);
            }
        }

        function modifyRole() {
            const jwt = document.getElementById('jwtInput').value.trim();
            const parts = jwt.split('.');

            if (parts.length !== 3) return;

            try {
                const header = JSON.parse(base64UrlDecode(parts[0]));
                let payload = JSON.parse(base64UrlDecode(parts[1]));

                // Modify role to admin
                const originalRole = payload.role;
                payload.role = 'admin';
                payload.id = 1;

                const newPayload = base64UrlEncode(JSON.stringify(payload));
                const forgedToken = `${parts[0]}.${newPayload}.`;

                document.getElementById('jwtInput').value = forgedToken;
                decodeJWT();

                showAttackResult('success', 'Role Escalation Attack',
                    `Modified payload:\n- role: "${originalRole}" → "admin"\n- id: 1 (admin user)\n\nNote: Signature is now invalid unless server doesn't verify!`);

            } catch (e) {
                showAttackResult('error', 'Attack Failed', e.message);
            }
        }

        function removeExpiry() {
            const jwt = document.getElementById('jwtInput').value.trim();
            const parts = jwt.split('.');

            if (parts.length !== 3) return;

            try {
                const header = JSON.parse(base64UrlDecode(parts[0]));
                let payload = JSON.parse(base64UrlDecode(parts[1]));

                // Remove expiry
                delete payload.exp;
                delete payload.nbf;

                const newPayload = base64UrlEncode(JSON.stringify(payload));
                const forgedToken = `${parts[0]}.${newPayload}.`;

                document.getElementById('jwtInput').value = forgedToken;
                decodeJWT();

                showAttackResult('success', 'Expiry Removal Attack',
                    `Removed "exp" and "nbf" claims.\n\nIf the server accepts modified tokens, this token would never expire!`);

            } catch (e) {
                showAttackResult('error', 'Attack Failed', e.message);
            }
        }

        function showAttackResult(type, title, message) {
            const result = document.getElementById('attackResult');
            result.className = `attack-result ${type}`;
            result.querySelector('h4').textContent = title;
            result.querySelector('pre code').textContent = message;
            result.style.display = 'block';
        }

        function addClaim() {
            const editor = document.getElementById('claimEditor');
            const row = document.createElement('div');
            row.className = 'claim-row';
            row.innerHTML = `
                <input type="text" class="claim-key" placeholder="key">
                <input type="text" class="claim-value" placeholder="value">
                <button class="claim-delete" onclick="deleteClaim(this)">×</button>
            `;
            editor.appendChild(row);
        }

        function deleteClaim(btn) {
            btn.parentElement.remove();
        }

        function generateForgedJWT() {
            const rows = document.querySelectorAll('.claim-row');
            const payload = {};

            rows.forEach(row => {
                const key = row.querySelector('.claim-key').value;
                const value = row.querySelector('.claim-value').value;
                if (key) {
                    // Try to parse as number or boolean
                    if (value === 'true') payload[key] = true;
                    else if (value === 'false') payload[key] = false;
                    else if (!isNaN(value) && value !== '') payload[key] = Number(value);
                    else payload[key] = value;
                }
            });

            const header = { alg: 'none', typ: 'JWT' };
            const forgedToken = `${base64UrlEncode(JSON.stringify(header))}.${base64UrlEncode(JSON.stringify(payload))}.`;

            document.getElementById('forgedToken').textContent = forgedToken;
            document.getElementById('forgedOutput').style.display = 'block';
        }

        function checkAnswer(element, isCorrect) {
            const options = element.parentElement.querySelectorAll('.quiz-option');
            options.forEach(opt => opt.classList.remove('correct', 'incorrect'));

            element.classList.add(isCorrect ? 'correct' : 'incorrect');

            if (!isCorrect) {
                options.forEach(opt => {
                    if (opt.onclick.toString().includes('true')) {
                        opt.classList.add('correct');
                    }
                });
            }
        }

        // Auto-decode on load
        document.addEventListener('DOMContentLoaded', decodeJWT);

        // Console message
        console.log('%c JWT Attack Lab', 'color: #a855f7; font-size: 14px;');
        console.log('%c Educational Purpose Only', 'color: #dc2626; font-size: 10px;');
    </script>
</body>
</html>
