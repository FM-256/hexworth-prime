<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steganography & Steganalysis Lab - Hexworth Prime Dark Arts Vault</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #a855f7;
            --accent: #dc2626;
            --bg: #0a0a0f;
            --surface: #1a1a2e;
            --surface-light: #252538;
            --text: #e0e0e0;
            --text-dim: #a0a0a0;
            --border: #333344;
            --success: #10b981;
            --warning: #f59e0b;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--surface) 0%, var(--bg) 100%);
            border-bottom: 2px solid var(--primary);
            padding: 1.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(168, 85, 247, 0.2);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header h1 {
            font-size: 1.8rem;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(168, 85, 247, 0.3);
        }

        .xp-badge {
            background: var(--surface-light);
            padding: 0.5rem 1.5rem;
            border-radius: 20px;
            border: 1px solid var(--primary);
            font-weight: bold;
            color: var(--primary);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 10px rgba(168, 85, 247, 0.3); }
            50% { box-shadow: 0 0 20px rgba(168, 85, 247, 0.6); }
        }

        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: var(--surface);
            color: var(--text);
            border: 1px solid var(--border);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .nav-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.4);
        }

        .section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .section h2 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-size: 1.6rem;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 0.5rem;
        }

        .section h3 {
            color: var(--accent);
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            border-bottom: 2px solid var(--border);
        }

        .tab {
            background: var(--surface-light);
            color: var(--text-dim);
            border: none;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 8px 8px 0 0;
            font-size: 1rem;
        }

        .tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 -2px 10px rgba(168, 85, 247, 0.4);
        }

        .tab:hover:not(.active) {
            background: var(--surface);
            color: var(--text);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .demo-area {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .canvas-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .canvas-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .canvas-label {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        canvas {
            border: 2px solid var(--border);
            border-radius: 8px;
            max-width: 100%;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-group label {
            color: var(--text);
            font-weight: 500;
            font-size: 0.95rem;
        }

        input[type="text"],
        input[type="password"],
        textarea,
        select {
            background: var(--surface-light);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 0.75rem;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(168, 85, 247, 0.3);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn:hover {
            background: #9333ea;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(168, 85, 247, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--accent);
        }

        .btn-secondary:hover {
            background: #b91c1c;
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .info-box {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(220, 38, 38, 0.1));
            border-left: 4px solid var(--primary);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 6px;
        }

        .warning-box {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(220, 38, 38, 0.1));
            border-left: 4px solid var(--warning);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 6px;
        }

        .success-box {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(168, 85, 247, 0.1));
            border-left: 4px solid var(--success);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 6px;
        }

        .code-block {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 1rem;
            margin: 1rem 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .code-block code {
            color: var(--success);
        }

        .pixel-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 2px;
            margin: 1rem 0;
            padding: 1rem;
            background: var(--bg);
            border-radius: 6px;
        }

        .pixel {
            aspect-ratio: 1;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-family: monospace;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 2px;
        }

        .pixel:hover {
            transform: scale(1.2);
            z-index: 10;
            box-shadow: 0 0 10px rgba(168, 85, 247, 0.5);
        }

        .binary-display {
            font-family: 'Courier New', monospace;
            background: var(--bg);
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
            word-break: break-all;
            font-size: 0.85rem;
            line-height: 1.8;
        }

        .binary-display .lsb {
            color: var(--accent);
            font-weight: bold;
        }

        .binary-display .msb {
            color: var(--text-dim);
        }

        .comparison-slider {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 1.5rem auto;
            overflow: hidden;
            border-radius: 8px;
            border: 2px solid var(--border);
        }

        .slider-images {
            position: relative;
            width: 100%;
            aspect-ratio: 1;
        }

        .slider-images canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        .slider-overlay {
            position: absolute;
            top: 0;
            right: 0;
            width: 50%;
            height: 100%;
            overflow: hidden;
            z-index: 2;
        }

        .slider-handle {
            position: absolute;
            top: 0;
            left: 50%;
            width: 4px;
            height: 100%;
            background: var(--primary);
            cursor: ew-resize;
            z-index: 3;
            box-shadow: 0 0 10px rgba(168, 85, 247, 0.8);
        }

        .slider-handle::before {
            content: '‚¨å';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--primary);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.6);
        }

        .tool-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .tool-card {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.3s;
        }

        .tool-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 20px rgba(168, 85, 247, 0.3);
            transform: translateY(-4px);
        }

        .tool-card h4 {
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .tool-card .tool-type {
            color: var(--accent);
            font-size: 0.85rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .quiz-container {
            margin-top: 1.5rem;
        }

        .question {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .question-text {
            color: var(--text);
            margin-bottom: 1rem;
            font-size: 1.05rem;
            font-weight: 500;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .option {
            background: var(--surface-light);
            border: 2px solid var(--border);
            padding: 0.75rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .option:hover {
            border-color: var(--primary);
            background: var(--surface);
        }

        .option.selected {
            border-color: var(--primary);
            background: rgba(168, 85, 247, 0.2);
        }

        .option.correct {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.2);
        }

        .option.incorrect {
            border-color: var(--accent);
            background: rgba(220, 38, 38, 0.2);
        }

        .option input[type="radio"] {
            cursor: pointer;
        }

        .quiz-results {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
            margin-top: 1.5rem;
            animation: slideIn 0.5s;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .quiz-results h3 {
            color: white;
            margin-bottom: 1rem;
            font-size: 1.8rem;
        }

        .score-display {
            font-size: 3rem;
            font-weight: bold;
            margin: 1rem 0;
        }

        .progress-bar {
            background: var(--surface-light);
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--primary), var(--accent));
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .challenge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .challenge-card {
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .challenge-card:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(168, 85, 247, 0.4);
        }

        .challenge-card.completed {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }

        .challenge-title {
            color: var(--primary);
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .challenge-difficulty {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .difficulty-easy {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .difficulty-medium {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .difficulty-hard {
            background: rgba(220, 38, 38, 0.2);
            color: var(--accent);
            border: 1px solid var(--accent);
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .stat-card {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-dim);
            font-size: 0.9rem;
        }

        .whitespace-viewer {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            margin: 1rem 0;
            position: relative;
        }

        .whitespace-viewer.reveal-mode {
            background: #000;
            color: #0f0;
        }

        .whitespace-viewer.reveal-mode .space {
            background: rgba(168, 85, 247, 0.3);
        }

        .whitespace-viewer.reveal-mode .tab {
            background: rgba(220, 38, 38, 0.3);
        }

        .footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-dim);
            border-top: 1px solid var(--border);
            margin-top: 3rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }

            .header h1 {
                font-size: 1.4rem;
            }

            .section {
                padding: 1.5rem;
            }

            .canvas-container {
                grid-template-columns: 1fr;
            }

            .tool-grid,
            .challenge-grid {
                grid-template-columns: 1fr;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>üé≠ Steganography & Steganalysis Lab</h1>
            <div class="xp-badge">‚ö° 70 XP Available</div>
        </div>
    </div>

    <div class="container">
        <div class="nav-buttons">
            <a href="../dark-arts-index.html" class="nav-btn">‚Üê Back to Dark Arts Vault</a>
            <a href="../../index.html" class="nav-btn">üè∞ Hexworth Prime Home</a>
            <a href="../../keyhouse/index.html" class="nav-btn">üîë Visit Key House (Cryptography)</a>
        </div>

        <!-- Introduction Section -->
        <div class="section">
            <h2>üé≠ The Art of Hidden Communication</h2>
            <div class="info-box">
                <p><strong>Steganography</strong> is the practice of concealing messages or information within other non-secret data. Unlike encryption which scrambles data, steganography <em>hides</em> the very existence of the secret message.</p>
            </div>

            <div class="stat-grid">
                <div class="stat-card">
                    <div class="stat-value">~500 BC</div>
                    <div class="stat-label">First Known Use (Ancient Greece)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">LSB</div>
                    <div class="stat-label">Most Common Method</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">0.001%</div>
                    <div class="stat-label">Typical Image Change</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">4</div>
                    <div class="stat-label">Main Cover Types</div>
                </div>
            </div>

            <h3>Steganography vs Cryptography</h3>
            <div class="tool-grid">
                <div class="tool-card">
                    <h4>üîê Cryptography</h4>
                    <div class="tool-type">Makes data unreadable</div>
                    <p>Scrambles the message so it cannot be understood without the key. The message's existence is obvious, but its contents are protected.</p>
                    <div class="code-block"><code>Hello ‚Üí 3ncrypt3d_m3ss4g3</code></div>
                </div>
                <div class="tool-card">
                    <h4>üé≠ Steganography</h4>
                    <div class="tool-type">Hides data existence</div>
                    <p>Conceals the message within ordinary-looking data. No one suspects a secret message exists at all.</p>
                    <div class="code-block"><code>Beautiful sunset photo.jpg ‚Üí (contains hidden message)</code></div>
                </div>
            </div>

            <div class="warning-box">
                <strong>‚ö†Ô∏è Security Through Obscurity:</strong> Steganography works best when combined with cryptography. Always encrypt sensitive data before hiding it!
            </div>
        </div>

        <!-- Interactive Demos Section -->
        <div class="section">
            <h2>üß™ Interactive Steganography Labs</h2>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('lsb-demo')">LSB Image Steganography</button>
                <button class="tab" onclick="switchTab('text-stego')">Text Steganography</button>
                <button class="tab" onclick="switchTab('comparison')">Visual Comparison</button>
                <button class="tab" onclick="switchTab('steganalysis')">Steganalysis Challenge</button>
            </div>

            <!-- LSB Demo -->
            <div id="lsb-demo" class="tab-content active">
                <h3>Least Significant Bit (LSB) Encoding</h3>
                <div class="info-box">
                    <p>LSB steganography works by replacing the least significant bit of each color channel in an image with bits from your secret message. Since changing the LSB only alters the color value by ¬±1, the change is imperceptible to the human eye.</p>
                </div>

                <div class="demo-area">
                    <div class="controls">
                        <div class="control-group">
                            <label>Secret Message to Hide:</label>
                            <textarea id="lsb-message" placeholder="Enter your secret message...">CEH</textarea>
                        </div>
                        <div class="control-group">
                            <label>Cover Image Pattern:</label>
                            <select id="lsb-pattern">
                                <option value="gradient">Gradient</option>
                                <option value="noise">Random Noise</option>
                                <option value="checkerboard">Checkerboard</option>
                                <option value="circles">Circles</option>
                            </select>
                        </div>
                        <div class="btn-group">
                            <button class="btn" onclick="embedLSB()">üîí Embed Message</button>
                            <button class="btn btn-secondary" onclick="extractLSB()">üîì Extract Message</button>
                            <button class="btn" onclick="analyzeLSB()">üîç Analyze LSB</button>
                        </div>
                    </div>

                    <div class="canvas-container">
                        <div class="canvas-wrapper">
                            <div class="canvas-label">Original Image</div>
                            <canvas id="original-canvas" width="300" height="300"></canvas>
                        </div>
                        <div class="canvas-wrapper">
                            <div class="canvas-label">Stego Image (with hidden data)</div>
                            <canvas id="stego-canvas" width="300" height="300"></canvas>
                        </div>
                        <div class="canvas-wrapper">
                            <div class="canvas-label">LSB Visualization</div>
                            <canvas id="lsb-visual-canvas" width="300" height="300"></canvas>
                        </div>
                    </div>

                    <div id="lsb-result" style="margin-top: 1rem;"></div>

                    <h4>Binary Data Visualization</h4>
                    <div class="info-box">
                        <p>Below you can see how pixel data is modified. The <span class="lsb" style="color: var(--accent);">LSB (rightmost bit)</span> is changed to encode your message, while the <span style="color: var(--text-dim);">MSB (leftmost bits)</span> remain unchanged.</p>
                    </div>
                    <div id="binary-visualization" class="binary-display"></div>
                </div>
            </div>

            <!-- Text Steganography Demo -->
            <div id="text-stego" class="tab-content">
                <h3>Whitespace Steganography</h3>
                <div class="info-box">
                    <p>Text steganography hides data using invisible characters like spaces, tabs, zero-width characters, or by manipulating whitespace. This technique was used by tools like <strong>Snow</strong> and <strong>stegsnow</strong>.</p>
                </div>

                <div class="demo-area">
                    <div class="controls">
                        <div class="control-group">
                            <label>Cover Text (visible):</label>
                            <textarea id="cover-text" placeholder="Enter normal-looking text...">This is a perfectly normal document.
Nothing suspicious here at all.
Just regular business communications.</textarea>
                        </div>
                        <div class="control-group">
                            <label>Secret Message:</label>
                            <input type="text" id="secret-text" placeholder="Message to hide..." value="EXFIL">
                        </div>
                        <div class="control-group">
                            <label>Encoding Method:</label>
                            <select id="text-method">
                                <option value="trailing">Trailing Whitespace (Binary)</option>
                                <option value="unicode">Zero-Width Characters</option>
                                <option value="case">Letter Case Encoding</option>
                            </select>
                        </div>
                        <div class="btn-group">
                            <button class="btn" onclick="embedText()">üîí Embed in Text</button>
                            <button class="btn btn-secondary" onclick="extractText()">üîì Extract from Text</button>
                            <button class="btn" onclick="toggleWhitespaceReveal()">üëÅÔ∏è Toggle Whitespace View</button>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>Stego Text Output:</label>
                        <div id="stego-text-output" class="whitespace-viewer"></div>
                    </div>

                    <div id="text-result" style="margin-top: 1rem;"></div>
                </div>

                <h4>Command Reference: stegsnow</h4>
                <div class="code-block">
<code># Embed message in ASCII text file
stegsnow -C -p "password" -m "secret message" infile.txt outfile.txt

# Extract message
stegsnow -C -p "password" outfile.txt

# Line mode (one bit per line)
stegsnow -C -l -m "secret" input.txt output.txt</code>
                </div>
            </div>

            <!-- Visual Comparison -->
            <div id="comparison" class="tab-content">
                <h3>Before/After Comparison Slider</h3>
                <div class="info-box">
                    <p>Drag the slider to compare the original image with the stego image. Notice how imperceptible the changes are to the human eye, even though data has been embedded.</p>
                </div>

                <div class="demo-area">
                    <div class="comparison-slider" id="comparison-slider">
                        <div class="slider-images">
                            <canvas id="compare-original" width="400" height="400"></canvas>
                            <div class="slider-overlay" id="slider-overlay">
                                <canvas id="compare-stego" width="400" height="400"></canvas>
                            </div>
                            <div class="slider-handle" id="slider-handle"></div>
                        </div>
                    </div>

                    <div class="stat-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="diff-pixels">0</div>
                            <div class="stat-label">Pixels Changed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="diff-percent">0%</div>
                            <div class="stat-label">Visual Difference</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="capacity">0</div>
                            <div class="stat-label">Bytes Hidden</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="max-capacity">0</div>
                            <div class="stat-label">Max Capacity</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Steganalysis Challenge -->
            <div id="steganalysis" class="tab-content">
                <h3>Steganalysis Challenge</h3>
                <div class="warning-box">
                    <strong>üîç Mission:</strong> Detect and extract hidden messages from suspicious files using steganalysis techniques.
                </div>

                <div class="challenge-grid">
                    <div class="challenge-card" onclick="startChallenge(1)">
                        <div class="challenge-title">Challenge 1: LSB Detection</div>
                        <div class="challenge-difficulty difficulty-easy">Easy</div>
                        <p>Analyze an image for LSB anomalies and extract the hidden message.</p>
                    </div>
                    <div class="challenge-card" onclick="startChallenge(2)">
                        <div class="challenge-title">Challenge 2: Text Analysis</div>
                        <div class="challenge-difficulty difficulty-easy">Easy</div>
                        <p>Find whitespace-encoded data in a text document.</p>
                    </div>
                    <div class="challenge-card" onclick="startChallenge(3)">
                        <div class="challenge-title">Challenge 3: Statistical Attack</div>
                        <div class="challenge-difficulty difficulty-medium">Medium</div>
                        <p>Use chi-square analysis to detect steganography presence.</p>
                    </div>
                    <div class="challenge-card" onclick="startChallenge(4)">
                        <div class="challenge-title">Challenge 4: Multi-Layer</div>
                        <div class="challenge-difficulty difficulty-hard">Hard</div>
                        <p>Extract a message that's been encrypted then hidden.</p>
                    </div>
                </div>

                <div id="challenge-area" class="demo-area" style="display: none; margin-top: 2rem;">
                    <h4 id="challenge-title-display"></h4>
                    <div id="challenge-content"></div>
                    <div class="controls">
                        <div class="control-group">
                            <label>Your Answer:</label>
                            <input type="text" id="challenge-answer" placeholder="Enter the hidden message...">
                        </div>
                        <div class="btn-group">
                            <button class="btn" onclick="submitChallenge()">Submit Answer</button>
                            <button class="btn btn-secondary" onclick="showHint()">üí° Hint</button>
                        </div>
                    </div>
                    <div id="challenge-feedback"></div>
                </div>
            </div>
        </div>

        <!-- Tools Reference Section -->
        <div class="section">
            <h2>üõ†Ô∏è Steganography & Steganalysis Tools</h2>

            <div class="tool-grid">
                <div class="tool-card">
                    <h4>steghide</h4>
                    <div class="tool-type">Image/Audio Steganography</div>
                    <p>Embed and extract data from JPEG, BMP, WAV, and AU files.</p>
                    <div class="code-block"><code># Embed
steghide embed -ef secret.txt -cf image.jpg -sf stego.jpg -p password

# Extract
steghide extract -sf stego.jpg -p password</code></div>
                </div>

                <div class="tool-card">
                    <h4>stegsnow</h4>
                    <div class="tool-type">Text Steganography</div>
                    <p>Conceals messages in ASCII text by appending whitespace to the end of lines.</p>
                    <div class="code-block"><code>stegsnow -C -p "pass" -m "msg" in.txt out.txt</code></div>
                </div>

                <div class="tool-card">
                    <h4>OpenStego</h4>
                    <div class="tool-type">Open Source Suite</div>
                    <p>Java-based tool for data hiding and watermarking with GUI interface.</p>
                    <div class="code-block"><code>java -jar openstego.jar embed -mf secret.txt -cf cover.png -sf stego.png</code></div>
                </div>

                <div class="tool-card">
                    <h4>zsteg</h4>
                    <div class="tool-type">Steganalysis Tool</div>
                    <p>Detect hidden data in PNG and BMP images, multiple detection methods.</p>
                    <div class="code-block"><code># Analyze image
zsteg suspicious.png

# Verbose mode
zsteg -a suspicious.png</code></div>
                </div>

                <div class="tool-card">
                    <h4>StegExpose</h4>
                    <div class="tool-type">LSB Detection</div>
                    <p>Detects LSB steganography in images using statistical analysis.</p>
                    <div class="code-block"><code>java -jar StegExpose.jar image.png</code></div>
                </div>

                <div class="tool-card">
                    <h4>Steghunt</h4>
                    <div class="tool-type">Multi-Format Analysis</div>
                    <p>Comprehensive steganalysis tool for multiple file formats.</p>
                    <div class="code-block"><code>steghunt -f image.jpg -t all</code></div>
                </div>

                <div class="tool-card">
                    <h4>OutGuess</h4>
                    <div class="tool-type">Statistical Steganography</div>
                    <p>Preserves statistical properties to resist analysis.</p>
                    <div class="code-block"><code>outguess -k "key" -d hidden.txt cover.jpg stego.jpg</code></div>
                </div>

                <div class="tool-card">
                    <h4>Invisible Secrets</h4>
                    <div class="tool-type">Commercial Suite</div>
                    <p>Windows application with encryption and steganography features.</p>
                    <div class="code-block"><code>GUI-based tool with strong encryption</code></div>
                </div>
            </div>

            <h3>Cover Medium Types</h3>
            <div class="info-box">
                <ul style="margin-left: 2rem; margin-top: 0.5rem;">
                    <li><strong>Images (JPEG, PNG, BMP):</strong> LSB modification, palette manipulation, DCT coefficient changes</li>
                    <li><strong>Audio (WAV, MP3):</strong> Echo hiding, phase coding, spread spectrum</li>
                    <li><strong>Video (MP4, AVI):</strong> Frame manipulation, motion vector encoding</li>
                    <li><strong>Text:</strong> Whitespace encoding, synonym substitution, format-based encoding</li>
                    <li><strong>Network:</strong> Covert channels in TCP/IP headers, timing channels</li>
                </ul>
            </div>
        </div>

        <!-- Knowledge Quiz Section -->
        <div class="section">
            <h2>üìù Steganography Knowledge Assessment</h2>
            <div class="info-box">
                <p>Test your understanding of steganography concepts and techniques. Score 80% or higher to earn full XP!</p>
            </div>

            <div class="quiz-container" id="quiz-container"></div>

            <div class="btn-group" style="margin-top: 1.5rem;">
                <button class="btn" onclick="submitQuiz()">Submit Answers</button>
                <button class="btn btn-secondary" onclick="resetQuiz()">Reset Quiz</button>
            </div>

            <div id="quiz-results-container"></div>
        </div>

        <!-- Use Cases Section -->
        <div class="section">
            <h2>üéØ Real-World Applications</h2>

            <div class="tool-grid">
                <div class="tool-card">
                    <h4>‚ö†Ô∏è Data Exfiltration</h4>
                    <div class="tool-type">Offensive Security</div>
                    <p>Attackers hide stolen data in images, documents, or network traffic to bypass DLP systems and exfiltrate information undetected.</p>
                </div>

                <div class="tool-card">
                    <h4>üïµÔ∏è Covert Communication</h4>
                    <div class="tool-type">Intelligence Operations</div>
                    <p>Agents communicate secretly by embedding messages in seemingly innocent photos, social media posts, or emails.</p>
                </div>

                <div class="tool-card">
                    <h4>ü¶† Malware Hiding</h4>
                    <div class="tool-type">Advanced Threats</div>
                    <p>Malicious code concealed in image files, downloaded by legitimate-looking documents to evade antivirus detection.</p>
                </div>

                <div class="tool-card">
                    <h4>¬©Ô∏è Digital Watermarking</h4>
                    <div class="tool-type">Legitimate Use</div>
                    <p>Copyright protection by embedding invisible ownership information in digital media - images, videos, audio files.</p>
                </div>

                <div class="tool-card">
                    <h4>üîê Privacy Protection</h4>
                    <div class="tool-type">Personal Security</div>
                    <p>Journalists and activists hide sensitive information to protect sources and communications from surveillance.</p>
                </div>

                <div class="tool-card">
                    <h4>üåê Network Covert Channels</h4>
                    <div class="tool-type">Advanced Techniques</div>
                    <p>Data hidden in unused protocol fields, timing patterns, or packet ordering to create secret communication channels.</p>
                </div>
            </div>

            <div class="warning-box">
                <strong>‚ö†Ô∏è Ethical Considerations:</strong> Steganography is a dual-use technology. While it has legitimate applications in privacy and security, it can also be abused for malicious purposes. Always use these techniques responsibly and within legal boundaries.
            </div>

            <h3>Detection and Defense</h3>
            <div class="success-box">
                <strong>üõ°Ô∏è Defense Strategies:</strong>
                <ul style="margin-left: 2rem; margin-top: 0.5rem;">
                    <li>Monitor for unusual file transfers and network patterns</li>
                    <li>Deploy steganalysis tools on email gateways and file servers</li>
                    <li>Analyze statistical properties of images and documents</li>
                    <li>Implement DLP policies that scan for hidden data</li>
                    <li>Regular security awareness training on steganography threats</li>
                    <li>Use format-specific validators to detect anomalies</li>
                </ul>
            </div>
        </div>

        <div class="footer">
            <p>üé≠ Hexworth Prime - Dark Arts Vault: Steganography & Steganalysis Lab</p>
            <p style="margin-top: 0.5rem;">Master the art of hiding in plain sight | Crossover with Key House (Cryptography)</p>
        </div>
    </div>

    <script>
        // Quiz Questions Database
        const quizQuestions = [
            {
                question: "What is the primary difference between steganography and cryptography?",
                options: [
                    "Steganography is stronger than cryptography",
                    "Steganography hides the existence of data, cryptography makes it unreadable",
                    "Cryptography is older than steganography",
                    "Steganography only works with images"
                ],
                correct: 1
            },
            {
                question: "What does LSB stand for in image steganography?",
                options: [
                    "Large Scale Bitmap",
                    "Least Significant Byte",
                    "Least Significant Bit",
                    "Low Security Baseline"
                ],
                correct: 2
            },
            {
                question: "Which tool is specifically designed for embedding data in ASCII text files using whitespace?",
                options: [
                    "steghide",
                    "OpenStego",
                    "stegsnow",
                    "zsteg"
                ],
                correct: 2
            },
            {
                question: "What is steganalysis?",
                options: [
                    "The process of creating steganographic content",
                    "The detection and analysis of hidden data",
                    "A type of encryption algorithm",
                    "A steganography tool for Linux"
                ],
                correct: 1
            },
            {
                question: "In LSB steganography, changing the least significant bit of a pixel color value changes it by at most:",
                options: [
                    "¬±1",
                    "¬±10",
                    "¬±50",
                    "¬±255"
                ],
                correct: 0
            },
            {
                question: "Which file type is NOT commonly used for steganography?",
                options: [
                    "JPEG images",
                    "WAV audio files",
                    "EXE executables",
                    "PNG images"
                ],
                correct: 2
            },
            {
                question: "What is a covert channel in network steganography?",
                options: [
                    "An encrypted VPN connection",
                    "A hidden communication path using protocol fields or timing",
                    "A dedicated network cable",
                    "A type of wireless frequency"
                ],
                correct: 1
            },
            {
                question: "Which command extracts hidden data using steghide?",
                options: [
                    "steghide embed -sf stego.jpg",
                    "steghide extract -sf stego.jpg -p password",
                    "steghide decrypt -f stego.jpg",
                    "steghide analyze stego.jpg"
                ],
                correct: 1
            },
            {
                question: "What is the main advantage of combining steganography with encryption?",
                options: [
                    "It makes the file smaller",
                    "It's faster to process",
                    "Even if discovered, the data remains protected",
                    "It works on more file types"
                ],
                correct: 2
            },
            {
                question: "Which steganalysis technique uses statistical analysis to detect hidden data?",
                options: [
                    "Visual inspection",
                    "Chi-square analysis",
                    "File size comparison",
                    "Manual decryption"
                ],
                correct: 1
            }
        ];

        // Challenge database
        const challenges = {
            1: {
                title: "Challenge 1: LSB Detection",
                message: "HEXWORTH",
                hint: "Analyze the LSB plane - the hidden message uses standard ASCII encoding.",
                difficulty: "easy"
            },
            2: {
                title: "Challenge 2: Text Analysis",
                message: "STEGO",
                hint: "Look at trailing whitespace after each line - space=0, tab=1.",
                difficulty: "easy"
            },
            3: {
                title: "Challenge 3: Statistical Attack",
                message: "HIDDEN",
                hint: "Check for unusual patterns in color distribution - LSB should be random.",
                difficulty: "medium"
            },
            4: {
                title: "Challenge 4: Multi-Layer",
                message: "DARKARTS",
                hint: "First extract from LSB, then apply ROT13 cipher to the result.",
                difficulty: "hard"
            }
        };

        let currentChallenge = null;
        let userAnswers = {};
        let comparisonSliderActive = false;

        // Initialize on page load
        window.addEventListener('load', function() {
            generateQuiz();
            initializeLSBDemo();
            initializeComparisonSlider();
            loadProgress();
        });

        // Tab Switching
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // Deactivate all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab content
            document.getElementById(tabName).classList.add('active');

            // Activate selected tab
            event.target.classList.add('active');

            // Reinitialize comparison slider if that tab is selected
            if (tabName === 'comparison') {
                updateComparison();
            }
        }

        // LSB Steganography Functions
        function initializeLSBDemo() {
            const canvas = document.getElementById('original-canvas');
            generateCoverImage(canvas, 'gradient');
        }

        function generateCoverImage(canvas, pattern) {
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            switch(pattern) {
                case 'gradient':
                    const gradient = ctx.createLinearGradient(0, 0, width, height);
                    gradient.addColorStop(0, '#a855f7');
                    gradient.addColorStop(0.5, '#dc2626');
                    gradient.addColorStop(1, '#10b981');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, width, height);
                    break;

                case 'noise':
                    const imageData = ctx.createImageData(width, height);
                    for(let i = 0; i < imageData.data.length; i += 4) {
                        imageData.data[i] = Math.random() * 255;
                        imageData.data[i + 1] = Math.random() * 255;
                        imageData.data[i + 2] = Math.random() * 255;
                        imageData.data[i + 3] = 255;
                    }
                    ctx.putImageData(imageData, 0, 0);
                    break;

                case 'checkerboard':
                    const squareSize = 30;
                    for(let y = 0; y < height; y += squareSize) {
                        for(let x = 0; x < width; x += squareSize) {
                            ctx.fillStyle = ((x/squareSize + y/squareSize) % 2) ? '#a855f7' : '#dc2626';
                            ctx.fillRect(x, y, squareSize, squareSize);
                        }
                    }
                    break;

                case 'circles':
                    ctx.fillStyle = '#0a0a0f';
                    ctx.fillRect(0, 0, width, height);
                    for(let i = 0; i < 20; i++) {
                        ctx.fillStyle = `rgba(${Math.random()*255}, ${Math.random()*255}, ${Math.random()*255}, 0.6)`;
                        ctx.beginPath();
                        ctx.arc(Math.random()*width, Math.random()*height, Math.random()*50 + 20, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    break;
            }
        }

        function embedLSB() {
            const message = document.getElementById('lsb-message').value;
            const pattern = document.getElementById('lsb-pattern').value;

            if (!message) {
                showResult('lsb-result', 'Please enter a message to hide.', 'error');
                return;
            }

            const originalCanvas = document.getElementById('original-canvas');
            const stegoCanvas = document.getElementById('stego-canvas');

            // Generate fresh cover image
            generateCoverImage(originalCanvas, pattern);

            // Copy to stego canvas
            const originalCtx = originalCanvas.getContext('2d');
            const stegoCtx = stegoCanvas.getContext('2d');
            stegoCtx.drawImage(originalCanvas, 0, 0);

            // Get image data
            const imageData = stegoCtx.getImageData(0, 0, stegoCanvas.width, stegoCanvas.height);
            const data = imageData.data;

            // Convert message to binary
            const messageBinary = textToBinary(message);

            // Add length header (32 bits for message length)
            const lengthBinary = (messageBinary.length).toString(2).padStart(32, '0');
            const fullBinary = lengthBinary + messageBinary;

            // Embed in LSB
            let bitIndex = 0;
            for(let i = 0; i < data.length && bitIndex < fullBinary.length; i += 4) {
                // Skip alpha channel, use RGB
                for(let j = 0; j < 3 && bitIndex < fullBinary.length; j++) {
                    const bit = parseInt(fullBinary[bitIndex]);
                    data[i + j] = (data[i + j] & 0xFE) | bit; // Clear LSB and set new bit
                    bitIndex++;
                }
            }

            stegoCtx.putImageData(imageData, 0, 0);

            // Visualize LSB plane
            visualizeLSB(imageData);

            // Show binary visualization
            showBinaryVisualization(originalCanvas, stegoCanvas);

            showResult('lsb-result',
                `‚úÖ Successfully embedded ${message.length} characters (${messageBinary.length} bits) into image. The visual change is imperceptible!`,
                'success');

            // Update comparison
            updateComparison();
        }

        function extractLSB() {
            const stegoCanvas = document.getElementById('stego-canvas');
            const ctx = stegoCanvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, stegoCanvas.width, stegoCanvas.height);
            const data = imageData.data;

            // Extract length (first 32 bits)
            let lengthBinary = '';
            for(let i = 0; i < 32 * 4; i += 4) {
                for(let j = 0; j < 3 && lengthBinary.length < 32; j++) {
                    lengthBinary += (data[i + j] & 1).toString();
                }
            }

            const messageLength = parseInt(lengthBinary, 2);

            if(messageLength > 100000 || messageLength <= 0) {
                showResult('lsb-result', '‚ùå No valid hidden message found in this image.', 'error');
                return;
            }

            // Extract message
            let messageBinary = '';
            let bitIndex = 32 * 3; // Skip length header
            for(let i = Math.ceil(32 / 3) * 4; messageBinary.length < messageLength; i += 4) {
                for(let j = 0; j < 3 && messageBinary.length < messageLength; j++) {
                    if(i + j < data.length) {
                        messageBinary += (data[i + j] & 1).toString();
                    }
                }
            }

            const message = binaryToText(messageBinary);

            showResult('lsb-result',
                `üîì <strong>Extracted Message:</strong> "${message}"<br>Message length: ${message.length} characters`,
                'success');
        }

        function analyzeLSB() {
            const stegoCanvas = document.getElementById('stego-canvas');
            const ctx = stegoCanvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, stegoCanvas.width, stegoCanvas.height);

            visualizeLSB(imageData);

            showResult('lsb-result',
                `üîç <strong>LSB Analysis Complete:</strong><br>
                - LSB plane visualization generated<br>
                - Check for patterns or non-random distribution<br>
                - Random LSB = likely no steganography<br>
                - Patterns in LSB = potential hidden data`,
                'success');
        }

        function visualizeLSB(imageData) {
            const lsbCanvas = document.getElementById('lsb-visual-canvas');
            const ctx = lsbCanvas.getContext('2d');
            const lsbImageData = ctx.createImageData(lsbCanvas.width, lsbCanvas.height);

            for(let i = 0; i < imageData.data.length; i += 4) {
                // Extract LSB from each channel
                const r = (imageData.data[i] & 1) * 255;
                const g = (imageData.data[i + 1] & 1) * 255;
                const b = (imageData.data[i + 2] & 1) * 255;

                lsbImageData.data[i] = r;
                lsbImageData.data[i + 1] = g;
                lsbImageData.data[i + 2] = b;
                lsbImageData.data[i + 3] = 255;
            }

            ctx.putImageData(lsbImageData, 0, 0);
        }

        function showBinaryVisualization(originalCanvas, stegoCanvas) {
            const container = document.getElementById('binary-visualization');
            const originalCtx = originalCanvas.getContext('2d');
            const stegoCtx = stegoCanvas.getContext('2d');

            const origData = originalCtx.getImageData(0, 0, 1, 1).data;
            const stegoData = stegoCtx.getImageData(0, 0, 1, 1).data;

            let html = '<p><strong>Sample Pixel (0,0) Binary Comparison:</strong></p>';

            for(let i = 0; i < 3; i++) {
                const channel = ['Red', 'Green', 'Blue'][i];
                const origBinary = origData[i].toString(2).padStart(8, '0');
                const stegoBinary = stegoData[i].toString(2).padStart(8, '0');

                html += `<p><strong>${channel} Channel:</strong><br>`;
                html += `Original: <span class="msb">${origBinary.slice(0, 7)}</span><span class="lsb">${origBinary.slice(7)}</span> (${origData[i]})<br>`;
                html += `Stego: <span class="msb">${stegoBinary.slice(0, 7)}</span><span class="lsb">${stegoBinary.slice(7)}</span> (${stegoData[i]})</p>`;
            }

            container.innerHTML = html;
        }

        // Text Steganography Functions
        let whitespaceRevealMode = false;

        function embedText() {
            const coverText = document.getElementById('cover-text').value;
            const secretMessage = document.getElementById('secret-text').value;
            const method = document.getElementById('text-method').value;

            if (!coverText || !secretMessage) {
                showResult('text-result', 'Please provide both cover text and secret message.', 'error');
                return;
            }

            let stegoText = '';

            switch(method) {
                case 'trailing':
                    stegoText = embedTrailingWhitespace(coverText, secretMessage);
                    break;
                case 'unicode':
                    stegoText = embedZeroWidth(coverText, secretMessage);
                    break;
                case 'case':
                    stegoText = embedCase(coverText, secretMessage);
                    break;
            }

            document.getElementById('stego-text-output').textContent = stegoText;

            showResult('text-result',
                `‚úÖ Successfully embedded "${secretMessage}" using ${method} encoding.<br>
                The stego text looks identical but contains hidden data!`,
                'success');
        }

        function embedTrailingWhitespace(coverText, secret) {
            const lines = coverText.split('\n');
            const binary = textToBinary(secret);
            let bitIndex = 0;

            const stegoLines = lines.map(line => {
                if (bitIndex >= binary.length) return line;

                let trailing = '';
                for(let i = 0; i < 8 && bitIndex < binary.length; i++) {
                    trailing += binary[bitIndex] === '1' ? '\t' : ' ';
                    bitIndex++;
                }
                return line + trailing;
            });

            return stegoLines.join('\n');
        }

        function embedZeroWidth(coverText, secret) {
            const binary = textToBinary(secret);
            const zwChars = {
                '0': '\u200B', // Zero-width space
                '1': '\u200C'  // Zero-width non-joiner
            };

            let hidden = '';
            for(let bit of binary) {
                hidden += zwChars[bit];
            }

            // Insert after first word
            const words = coverText.split(' ');
            words[0] += hidden;
            return words.join(' ');
        }

        function embedCase(coverText, secret) {
            const binary = textToBinary(secret);
            let result = '';
            let bitIndex = 0;

            for(let char of coverText) {
                if(char.match(/[a-zA-Z]/) && bitIndex < binary.length) {
                    result += binary[bitIndex] === '1' ? char.toUpperCase() : char.toLowerCase();
                    bitIndex++;
                } else {
                    result += char;
                }
            }

            return result;
        }

        function extractText() {
            const stegoText = document.getElementById('stego-text-output').textContent;
            const method = document.getElementById('text-method').value;

            if (!stegoText) {
                showResult('text-result', 'No stego text to extract from.', 'error');
                return;
            }

            let extracted = '';

            switch(method) {
                case 'trailing':
                    extracted = extractTrailingWhitespace(stegoText);
                    break;
                case 'unicode':
                    extracted = extractZeroWidth(stegoText);
                    break;
                case 'case':
                    extracted = extractCase(stegoText);
                    break;
            }

            if(extracted) {
                showResult('text-result',
                    `üîì <strong>Extracted Message:</strong> "${extracted}"`,
                    'success');
            } else {
                showResult('text-result', 'No hidden message found.', 'error');
            }
        }

        function extractTrailingWhitespace(text) {
            const lines = text.split('\n');
            let binary = '';

            for(let line of lines) {
                const trailing = line.match(/[ \t]+$/);
                if(trailing) {
                    for(let char of trailing[0]) {
                        binary += char === '\t' ? '1' : '0';
                    }
                }
            }

            return binaryToText(binary);
        }

        function extractZeroWidth(text) {
            const zwPattern = /[\u200B\u200C]+/g;
            const matches = text.match(zwPattern);

            if(!matches) return '';

            let binary = '';
            for(let match of matches) {
                for(let char of match) {
                    binary += char === '\u200C' ? '1' : '0';
                }
            }

            return binaryToText(binary);
        }

        function extractCase(text) {
            let binary = '';

            for(let char of text) {
                if(char.match(/[a-zA-Z]/)) {
                    binary += char === char.toUpperCase() ? '1' : '0';
                }
            }

            return binaryToText(binary);
        }

        function toggleWhitespaceReveal() {
            whitespaceRevealMode = !whitespaceRevealMode;
            const viewer = document.getElementById('stego-text-output');

            if(whitespaceRevealMode) {
                viewer.classList.add('reveal-mode');
                const text = viewer.textContent;
                let html = '';
                for(let char of text) {
                    if(char === ' ') {
                        html += '<span class="space">¬∑</span>';
                    } else if(char === '\t') {
                        html += '<span class="tab">‚Üí</span>';
                    } else if(char === '\n') {
                        html += '‚Üµ\n';
                    } else {
                        html += char;
                    }
                }
                viewer.innerHTML = html;
            } else {
                viewer.classList.remove('reveal-mode');
                viewer.textContent = viewer.textContent.replace(/[¬∑‚Üí‚Üµ]/g, m => {
                    return m === '¬∑' ? ' ' : m === '‚Üí' ? '\t' : '\n';
                });
            }
        }

        // Comparison Slider Functions
        function initializeComparisonSlider() {
            const slider = document.getElementById('slider-handle');
            const overlay = document.getElementById('slider-overlay');
            const container = document.getElementById('comparison-slider');

            let isDragging = false;

            slider.addEventListener('mousedown', () => isDragging = true);
            document.addEventListener('mouseup', () => isDragging = false);

            container.addEventListener('mousemove', (e) => {
                if(!isDragging) return;

                const rect = container.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const percent = (x / rect.width) * 100;

                if(percent >= 0 && percent <= 100) {
                    slider.style.left = percent + '%';
                    overlay.style.width = (100 - percent) + '%';
                }
            });

            // Touch support
            slider.addEventListener('touchstart', () => isDragging = true);
            document.addEventListener('touchend', () => isDragging = false);

            container.addEventListener('touchmove', (e) => {
                if(!isDragging) return;

                const rect = container.getBoundingClientRect();
                const x = e.touches[0].clientX - rect.left;
                const percent = (x / rect.width) * 100;

                if(percent >= 0 && percent <= 100) {
                    slider.style.left = percent + '%';
                    overlay.style.width = (100 - percent) + '%';
                }
            });
        }

        function updateComparison() {
            const originalCanvas = document.getElementById('original-canvas');
            const stegoCanvas = document.getElementById('stego-canvas');
            const compareOriginal = document.getElementById('compare-original');
            const compareStego = document.getElementById('compare-stego');

            // Copy canvases to comparison view
            const ctx1 = compareOriginal.getContext('2d');
            const ctx2 = compareStego.getContext('2d');

            ctx1.drawImage(originalCanvas, 0, 0, compareOriginal.width, compareOriginal.height);
            ctx2.drawImage(stegoCanvas, 0, 0, compareStego.width, compareStego.height);

            // Calculate statistics
            calculateImageStats(originalCanvas, stegoCanvas);
        }

        function calculateImageStats(original, stego) {
            const origCtx = original.getContext('2d');
            const stegoCtx = stego.getContext('2d');

            const origData = origCtx.getImageData(0, 0, original.width, original.height);
            const stegoData = stegoCtx.getImageData(0, 0, stego.width, stego.height);

            let changedPixels = 0;
            let totalDiff = 0;

            for(let i = 0; i < origData.data.length; i += 4) {
                const rDiff = Math.abs(origData.data[i] - stegoData.data[i]);
                const gDiff = Math.abs(origData.data[i+1] - stegoData.data[i+1]);
                const bDiff = Math.abs(origData.data[i+2] - stegoData.data[i+2]);

                if(rDiff > 0 || gDiff > 0 || bDiff > 0) {
                    changedPixels++;
                    totalDiff += rDiff + gDiff + bDiff;
                }
            }

            const totalPixels = original.width * original.height;
            const maxCapacity = Math.floor((totalPixels * 3) / 8); // 3 bits per pixel / 8 bits per byte

            const message = document.getElementById('lsb-message').value;
            const hiddenBytes = message.length;

            document.getElementById('diff-pixels').textContent = changedPixels;
            document.getElementById('diff-percent').textContent =
                ((totalDiff / (origData.data.length * 255)) * 100).toFixed(4) + '%';
            document.getElementById('capacity').textContent = hiddenBytes;
            document.getElementById('max-capacity').textContent = maxCapacity;
        }

        // Challenge Functions
        function startChallenge(challengeId) {
            currentChallenge = challenges[challengeId];
            const challengeArea = document.getElementById('challenge-area');
            const titleDisplay = document.getElementById('challenge-title-display');
            const contentDiv = document.getElementById('challenge-content');

            titleDisplay.textContent = currentChallenge.title;
            challengeArea.style.display = 'block';

            // Generate challenge-specific content
            let content = '';

            switch(challengeId) {
                case 1:
                    content = generateLSBChallenge();
                    break;
                case 2:
                    content = generateTextChallenge();
                    break;
                case 3:
                    content = generateStatisticalChallenge();
                    break;
                case 4:
                    content = generateMultiLayerChallenge();
                    break;
            }

            contentDiv.innerHTML = content;
            document.getElementById('challenge-answer').value = '';
            document.getElementById('challenge-feedback').innerHTML = '';

            // Scroll to challenge
            challengeArea.scrollIntoView({ behavior: 'smooth' });
        }

        function generateLSBChallenge() {
            const canvas = document.createElement('canvas');
            canvas.width = 200;
            canvas.height = 200;
            canvas.style.maxWidth = '100%';
            const ctx = canvas.getContext('2d');

            // Generate gradient
            const gradient = ctx.createLinearGradient(0, 0, 200, 200);
            gradient.addColorStop(0, '#667eea');
            gradient.addColorStop(1, '#764ba2');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 200, 200);

            // Embed message
            const imageData = ctx.getImageData(0, 0, 200, 200);
            const messageBinary = textToBinary(currentChallenge.message);
            const lengthBinary = messageBinary.length.toString(2).padStart(32, '0');
            const fullBinary = lengthBinary + messageBinary;

            let bitIndex = 0;
            for(let i = 0; i < imageData.data.length && bitIndex < fullBinary.length; i += 4) {
                for(let j = 0; j < 3 && bitIndex < fullBinary.length; j++) {
                    imageData.data[i + j] = (imageData.data[i + j] & 0xFE) | parseInt(fullBinary[bitIndex]);
                    bitIndex++;
                }
            }

            ctx.putImageData(imageData, 0, 0);

            const container = document.createElement('div');
            container.style.textAlign = 'center';
            container.innerHTML = '<p>Analyze this image for hidden LSB data:</p>';
            container.appendChild(canvas);

            return container.outerHTML;
        }

        function generateTextChallenge() {
            const coverText = "Welcome to Hexworth Prime\nDark Arts Division\nSteganography Lab";
            const stego = embedTrailingWhitespace(coverText, currentChallenge.message);

            return `
                <p>The following text contains a hidden message using trailing whitespace encoding:</p>
                <div class="code-block"><code>${stego}</code></div>
                <p>Hint: Use spaces (0) and tabs (1) to encode binary data.</p>
            `;
        }

        function generateStatisticalChallenge() {
            return `
                <p>This image has been analyzed for steganography. The LSB distribution shows:</p>
                <div class="stat-grid">
                    <div class="stat-card">
                        <div class="stat-value">52.3%</div>
                        <div class="stat-label">LSB = 1</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">47.7%</div>
                        <div class="stat-label">LSB = 0</div>
                    </div>
                </div>
                <p>Chi-square test result: <strong>0.0023</strong> (p-value)</p>
                <p>What message is hidden? (Hint: Distribution shows presence of hidden data)</p>
            `;
        }

        function generateMultiLayerChallenge() {
            return `
                <p>This challenge involves multiple layers:</p>
                <ol style="margin-left: 2rem; margin-top: 1rem;">
                    <li>Extract LSB data from the image</li>
                    <li>Apply ROT13 cipher to the extracted text</li>
                    <li>Submit the final decrypted message</li>
                </ol>
                <p>Intermediate LSB extraction gives: <code>QNEXNEGF</code></p>
                <p>What is the final message after ROT13 decryption?</p>
            `;
        }

        function submitChallenge() {
            const answer = document.getElementById('challenge-answer').value.toUpperCase();
            const feedback = document.getElementById('challenge-feedback');

            if(answer === currentChallenge.message) {
                feedback.innerHTML = `
                    <div class="success-box">
                        <strong>‚úÖ Correct!</strong> You successfully extracted the hidden message: "${currentChallenge.message}"
                        <br>Challenge completed! +15 XP
                    </div>
                `;
                updateProgress(15);
            } else {
                feedback.innerHTML = `
                    <div class="warning-box">
                        <strong>‚ùå Incorrect.</strong> Try again or use a hint.
                    </div>
                `;
            }
        }

        function showHint() {
            const feedback = document.getElementById('challenge-feedback');
            feedback.innerHTML = `
                <div class="info-box">
                    <strong>üí° Hint:</strong> ${currentChallenge.hint}
                </div>
            `;
        }

        // Quiz Functions
        function generateQuiz() {
            const container = document.getElementById('quiz-container');
            let html = '';

            quizQuestions.forEach((q, index) => {
                html += `
                    <div class="question">
                        <div class="question-text">${index + 1}. ${q.question}</div>
                        <div class="options">
                            ${q.options.map((option, optIndex) => `
                                <label class="option">
                                    <input type="radio" name="q${index}" value="${optIndex}">
                                    <span>${option}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function submitQuiz() {
            let correct = 0;
            const totalQuestions = quizQuestions.length;

            quizQuestions.forEach((q, index) => {
                const selected = document.querySelector(`input[name="q${index}"]:checked`);
                const options = document.querySelectorAll(`input[name="q${index}"]`);

                options.forEach((option, optIndex) => {
                    const label = option.closest('.option');
                    label.classList.remove('correct', 'incorrect', 'selected');

                    if(optIndex === q.correct) {
                        label.classList.add('correct');
                    }

                    if(selected && option === selected) {
                        label.classList.add('selected');
                        if(optIndex === q.correct) {
                            correct++;
                        } else {
                            label.classList.add('incorrect');
                        }
                    }
                });
            });

            const percentage = (correct / totalQuestions) * 100;
            const xpEarned = percentage >= 80 ? 70 : Math.floor(percentage * 0.7);

            const resultsContainer = document.getElementById('quiz-results-container');
            resultsContainer.innerHTML = `
                <div class="quiz-results">
                    <h3>Quiz Results</h3>
                    <div class="score-display">${correct}/${totalQuestions}</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${percentage}%">${percentage.toFixed(1)}%</div>
                    </div>
                    <p style="font-size: 1.2rem; margin-top: 1rem;">
                        ${percentage >= 80 ?
                            `üéâ Excellent work! You've mastered steganography concepts!<br>+${xpEarned} XP earned!` :
                            `Keep studying! You earned ${xpEarned} XP. Review the material and try again for full credit.`
                        }
                    </p>
                </div>
            `;

            updateProgress(xpEarned);
            resultsContainer.scrollIntoView({ behavior: 'smooth' });
        }

        function resetQuiz() {
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.checked = false;
            });

            document.querySelectorAll('.option').forEach(option => {
                option.classList.remove('correct', 'incorrect', 'selected');
            });

            document.getElementById('quiz-results-container').innerHTML = '';
        }

        // Utility Functions
        function textToBinary(text) {
            let binary = '';
            for(let i = 0; i < text.length; i++) {
                binary += text.charCodeAt(i).toString(2).padStart(8, '0');
            }
            return binary;
        }

        function binaryToText(binary) {
            let text = '';
            for(let i = 0; i < binary.length; i += 8) {
                const byte = binary.substr(i, 8);
                if(byte.length === 8) {
                    const charCode = parseInt(byte, 2);
                    if(charCode >= 32 && charCode <= 126) {
                        text += String.fromCharCode(charCode);
                    }
                }
            }
            return text;
        }

        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            const className = type === 'success' ? 'success-box' : type === 'error' ? 'warning-box' : 'info-box';
            element.innerHTML = `<div class="${className}">${message}</div>`;
        }

        // Progress Tracking
        function updateProgress(xp) {
            const currentXP = parseInt(localStorage.getItem('stego-lab-xp') || '0');
            const newXP = Math.min(currentXP + xp, 70);
            localStorage.setItem('stego-lab-xp', newXP);

            if(newXP >= 70) {
                localStorage.setItem('stego-lab-complete', 'true');
            }
        }

        function loadProgress() {
            const xp = parseInt(localStorage.getItem('stego-lab-xp') || '0');
            if(xp > 0) {
                console.log(`Progress loaded: ${xp}/70 XP`);
            }
        }
    </script>
</body>
</html>