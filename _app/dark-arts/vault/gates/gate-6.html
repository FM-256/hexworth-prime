<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gate VI - The First Sample</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: #0a0508;
            font-family: 'Courier New', monospace;
            color: #8a6a9a;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(ellipse at 20% 30%, rgba(100, 50, 120, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 70%, rgba(80, 40, 100, 0.04) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        /* Header */
        .gate-header {
            padding: 20px 40px;
            border-bottom: 1px solid rgba(100, 60, 130, 0.15);
            background: rgba(10, 5, 15, 0.95);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 10;
        }

        .gate-title {
            font-size: 0.8rem;
            letter-spacing: 0.3em;
            color: #6a4a7a;
            text-transform: uppercase;
        }

        .gate-progress {
            display: flex;
            gap: 8px;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(60, 40, 80, 0.3);
            border: 1px solid rgba(100, 70, 130, 0.3);
            transition: all 0.3s ease;
        }

        .progress-dot.complete {
            background: #6a9a6a;
            border-color: #7aaa7a;
            box-shadow: 0 0 10px rgba(100, 150, 100, 0.4);
        }

        .progress-dot.active {
            background: #9a7aaa;
            border-color: #b090c0;
            box-shadow: 0 0 10px rgba(150, 120, 170, 0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Main content */
        .gate-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px;
            position: relative;
            z-index: 10;
        }

        .challenge-intro {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(15, 8, 20, 0.6);
            border: 1px solid rgba(80, 50, 100, 0.2);
            border-radius: 8px;
        }

        .challenge-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .challenge-title {
            font-size: 1.4rem;
            color: #b090c0;
            letter-spacing: 0.1em;
            margin-bottom: 10px;
        }

        .challenge-subtitle {
            font-size: 0.8rem;
            color: #6a4a7a;
            line-height: 1.6;
        }

        /* Step sections */
        .step-section {
            background: rgba(15, 8, 20, 0.5);
            border: 1px solid rgba(80, 50, 100, 0.2);
            border-radius: 8px;
            margin-bottom: 25px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .step-section.locked {
            opacity: 0.4;
            filter: grayscale(0.5);
            pointer-events: none;
        }

        .step-section.complete {
            border-color: rgba(100, 150, 100, 0.3);
        }

        .step-header {
            padding: 15px 20px;
            background: rgba(20, 12, 28, 0.6);
            border-bottom: 1px solid rgba(80, 50, 100, 0.15);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .step-label {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .step-number {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(80, 50, 100, 0.3);
            border: 1px solid rgba(120, 80, 150, 0.4);
            font-size: 0.75rem;
            color: #9a7aaa;
        }

        .step-section.complete .step-number {
            background: rgba(80, 120, 80, 0.3);
            border-color: rgba(100, 150, 100, 0.5);
            color: #8aba8a;
        }

        .step-title {
            font-size: 0.85rem;
            color: #9a7aaa;
            letter-spacing: 0.05em;
        }

        .step-status {
            font-size: 0.65rem;
            padding: 4px 10px;
            border-radius: 10px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .step-status.pending {
            background: rgba(80, 50, 100, 0.2);
            color: #7a5a8a;
        }

        .step-status.complete {
            background: rgba(60, 100, 60, 0.2);
            color: #6a9a6a;
        }

        .step-body {
            padding: 20px;
        }

        .step-description {
            font-size: 0.75rem;
            color: #6a4a7a;
            line-height: 1.7;
            margin-bottom: 20px;
        }

        /* Data display */
        .data-block {
            background: #0c0810;
            border: 1px solid rgba(60, 40, 80, 0.3);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.7rem;
            line-height: 1.8;
            color: #7a9a7a;
            overflow-x: auto;
        }

        .data-block .label {
            color: #5a6a8a;
            margin-bottom: 8px;
            display: block;
            font-size: 0.65rem;
            letter-spacing: 0.1em;
        }

        .data-block .hex {
            color: #8a9a6a;
            word-break: break-all;
        }

        .data-block .highlight {
            color: #c0a070;
            background: rgba(180, 140, 80, 0.1);
            padding: 1px 4px;
            border-radius: 2px;
        }

        /* Reference table */
        .reference-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            font-size: 0.7rem;
        }

        .reference-table th {
            background: rgba(40, 25, 55, 0.5);
            color: #8a6a9a;
            padding: 10px;
            text-align: left;
            border: 1px solid rgba(80, 50, 100, 0.2);
            font-weight: normal;
            letter-spacing: 0.05em;
        }

        .reference-table td {
            padding: 8px 10px;
            border: 1px solid rgba(80, 50, 100, 0.15);
            color: #7a8a7a;
        }

        .reference-table tr:nth-child(even) {
            background: rgba(20, 12, 28, 0.3);
        }

        /* Input area */
        .input-area {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .step-input {
            flex: 1;
            background: #0c0810;
            border: 1px solid rgba(80, 50, 100, 0.3);
            border-radius: 6px;
            padding: 12px 15px;
            color: #b0a0c0;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .step-input:focus {
            border-color: rgba(140, 100, 170, 0.5);
            box-shadow: 0 0 15px rgba(120, 80, 150, 0.2);
        }

        .step-input::placeholder {
            color: #4a3a5a;
        }

        .verify-btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, rgba(80, 50, 100, 0.4), rgba(60, 30, 80, 0.3));
            border: 1px solid rgba(120, 80, 150, 0.4);
            border-radius: 6px;
            color: #b090c0;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .verify-btn:hover {
            background: linear-gradient(135deg, rgba(100, 70, 120, 0.5), rgba(80, 50, 100, 0.4));
            border-color: rgba(150, 110, 180, 0.5);
            box-shadow: 0 0 20px rgba(120, 80, 150, 0.3);
        }

        .verify-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Feedback */
        .feedback {
            margin-top: 12px;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 0.75rem;
            display: none;
        }

        .feedback.error {
            display: block;
            background: rgba(120, 60, 60, 0.2);
            border: 1px solid rgba(150, 80, 80, 0.3);
            color: #aa6a6a;
        }

        .feedback.success {
            display: block;
            background: rgba(60, 100, 60, 0.2);
            border: 1px solid rgba(80, 130, 80, 0.3);
            color: #7aaa7a;
        }

        /* Hint system */
        .hint-toggle {
            font-size: 0.7rem;
            color: #5a4a6a;
            cursor: pointer;
            margin-top: 15px;
            display: inline-block;
            transition: color 0.3s ease;
        }

        .hint-toggle:hover {
            color: #8a7a9a;
        }

        .hint-content {
            display: none;
            margin-top: 10px;
            padding: 12px 15px;
            background: rgba(40, 30, 50, 0.3);
            border-left: 2px solid rgba(100, 70, 130, 0.4);
            font-size: 0.7rem;
            color: #6a5a7a;
            line-height: 1.6;
        }

        .hint-content.visible {
            display: block;
        }

        /* Final section */
        .final-section {
            background: linear-gradient(135deg, rgba(25, 15, 35, 0.7), rgba(15, 8, 22, 0.8));
            border: 1px solid rgba(100, 70, 130, 0.3);
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin-top: 30px;
        }

        .final-section.locked {
            opacity: 0.4;
            filter: grayscale(0.5);
            pointer-events: none;
        }

        .final-title {
            font-size: 1rem;
            color: #b090c0;
            letter-spacing: 0.1em;
            margin-bottom: 15px;
        }

        .final-description {
            font-size: 0.75rem;
            color: #6a4a7a;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .final-input {
            width: 100%;
            max-width: 400px;
            background: #0c0810;
            border: 1px solid rgba(100, 70, 130, 0.3);
            border-radius: 6px;
            padding: 15px;
            color: #c0b0d0;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            text-align: center;
            letter-spacing: 0.1em;
            outline: none;
            margin-bottom: 15px;
        }

        .final-input:focus {
            border-color: rgba(150, 110, 180, 0.5);
            box-shadow: 0 0 20px rgba(120, 80, 150, 0.3);
        }

        .unlock-btn {
            display: inline-block;
            padding: 15px 40px;
            background: linear-gradient(135deg, rgba(100, 60, 130, 0.4), rgba(80, 40, 110, 0.3));
            border: 1px solid rgba(140, 100, 170, 0.5);
            border-radius: 25px;
            color: #c0a0d0;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            letter-spacing: 0.15em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .unlock-btn:hover {
            background: linear-gradient(135deg, rgba(120, 80, 150, 0.5), rgba(100, 60, 130, 0.4));
            border-color: rgba(170, 130, 200, 0.6);
            box-shadow: 0 0 30px rgba(130, 90, 160, 0.4);
            transform: translateY(-2px);
        }

        /* Success overlay */
        .success-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(5, 3, 8, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .success-overlay.visible {
            display: flex;
        }

        .success-content {
            text-align: center;
            padding: 50px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .success-icon {
            font-size: 4rem;
            margin-bottom: 25px;
            animation: glow 2s infinite;
        }

        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(100, 150, 100, 0.5)); }
            50% { filter: drop-shadow(0 0 40px rgba(120, 180, 120, 0.7)); }
        }

        .success-title {
            font-size: 1.5rem;
            color: #8aca8a;
            letter-spacing: 0.2em;
            margin-bottom: 15px;
        }

        .success-message {
            font-size: 0.85rem;
            color: #6a9a6a;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .continue-btn {
            display: inline-block;
            padding: 15px 50px;
            background: linear-gradient(135deg, rgba(80, 130, 80, 0.4), rgba(60, 100, 60, 0.3));
            border: 1px solid rgba(110, 160, 110, 0.5);
            border-radius: 25px;
            color: #a0d0a0;
            font-size: 0.8rem;
            letter-spacing: 0.15em;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .continue-btn:hover {
            background: linear-gradient(135deg, rgba(100, 150, 100, 0.5), rgba(80, 120, 80, 0.4));
            box-shadow: 0 0 30px rgba(100, 160, 100, 0.4);
        }

        /* Back link */
        .back-link {
            display: inline-block;
            margin-top: 30px;
            color: #5a4a6a;
            font-size: 0.75rem;
            text-decoration: none;
            letter-spacing: 0.1em;
            transition: color 0.3s ease;
        }

        .back-link:hover {
            color: #9a7aaa;
        }
    </style>
</head>
<body>
    <header class="gate-header">
        <div class="gate-title">Gate VI // The First Sample</div>
        <div class="gate-progress">
            <div class="progress-dot active" id="dot1"></div>
            <div class="progress-dot" id="dot2"></div>
            <div class="progress-dot" id="dot3"></div>
            <div class="progress-dot" id="dot4"></div>
        </div>
    </header>

    <main class="gate-content">
        <section class="challenge-intro">
            <div class="challenge-icon">ðŸ”¬</div>
            <h1 class="challenge-title">The First Sample</h1>
            <p class="challenge-subtitle">
                A suspicious file has been captured. Your static analysis skills will be tested.<br>
                Extract the truth from the binary. No execution. Only observation.
            </p>
        </section>

        <!-- STEP 1: PE Header Analysis -->
        <section class="step-section" id="step1">
            <div class="step-header">
                <div class="step-label">
                    <div class="step-number">1</div>
                    <span class="step-title">PE Header Analysis</span>
                </div>
                <span class="step-status pending" id="status1">Pending</span>
            </div>
            <div class="step-body">
                <p class="step-description">
                    The captured file's PE header has been extracted. Analyze the Optional Header
                    to find the <strong>AddressOfEntryPoint</strong> - where execution would begin.
                </p>

                <div class="data-block">
                    <span class="label">// PE Optional Header (partial) - Little Endian</span>
                    <div class="hex">
                        <span class="highlight">0B 01</span> 00 00 00 00 00 00 00 00 00 00 00 00 00 00<br>
                        00 00 00 00 00 00 00 00 <span class="highlight">00 14 00 00</span> 00 00 00 00<br>
                        00 00 40 00 00 00 00 00 00 00 00 00 00 00 00 00
                    </div>
                </div>

                <table class="reference-table">
                    <tr>
                        <th>Offset</th>
                        <th>Field</th>
                        <th>Size</th>
                    </tr>
                    <tr>
                        <td>0x00</td>
                        <td>Magic (PE32: 0x10B, PE32+: 0x20B)</td>
                        <td>2 bytes</td>
                    </tr>
                    <tr>
                        <td>0x10</td>
                        <td>AddressOfEntryPoint</td>
                        <td>4 bytes</td>
                    </tr>
                    <tr>
                        <td>0x1C</td>
                        <td>ImageBase</td>
                        <td>4 bytes</td>
                    </tr>
                </table>

                <p class="step-description" style="margin-top: 15px; font-style: italic;">
                    Remember: x86 uses little-endian byte order. The bytes <code>00 14 00 00</code>
                    at offset 0x10 represent the entry point.
                </p>

                <div class="input-area">
                    <input type="text" class="step-input" id="input1" placeholder="Enter entry point (e.g., 0x1234)">
                    <button class="verify-btn" onclick="verifyStep1()">Verify</button>
                </div>
                <div class="feedback" id="feedback1"></div>

                <span class="hint-toggle" onclick="toggleHint(1)">Need a hint?</span>
                <div class="hint-content" id="hint1">
                    Little-endian means the least significant byte comes first.
                    So <code>00 14 00 00</code> in little-endian is actually <code>0x00001400</code>.
                    Convert this to the standard hex format.
                </div>
            </div>
        </section>

        <!-- STEP 2: String Decoding -->
        <section class="step-section locked" id="step2">
            <div class="step-header">
                <div class="step-label">
                    <div class="step-number">2</div>
                    <span class="step-title">Obfuscated String Recovery</span>
                </div>
                <span class="step-status pending" id="status2">Locked</span>
            </div>
            <div class="step-body">
                <p class="step-description">
                    A suspicious string was found in the data section. It appears to be XOR-encoded.
                    The XOR key is derived from the <strong>last byte of the entry point</strong> you found.
                </p>

                <div class="data-block">
                    <span class="label">// Encoded string bytes (ASCII values after XOR)</span>
                    <div class="hex" id="xorBytes">
                        -- Unlock Step 1 first --
                    </div>
                </div>

                <p class="step-description">
                    XOR each byte with the key to reveal the hidden word.<br>
                    <em>Formula: decoded_char = encoded_byte XOR key</em>
                </p>

                <div class="input-area">
                    <input type="text" class="step-input" id="input2" placeholder="Enter decoded word (lowercase)">
                    <button class="verify-btn" onclick="verifyStep2()">Verify</button>
                </div>
                <div class="feedback" id="feedback2"></div>

                <span class="hint-toggle" onclick="toggleHint(2)">Need a hint?</span>
                <div class="hint-content" id="hint2">
                    The last byte of 0x1400 is 0x00. Wait, that would mean no change...
                    Actually, use the last non-zero nibble as your key. In this case, that's 0x14 (20 decimal).
                    XOR each byte: 0x76 XOR 0x14 = ?
                </div>
            </div>
        </section>

        <!-- STEP 3: Entropy Analysis -->
        <section class="step-section locked" id="step3">
            <div class="step-header">
                <div class="step-label">
                    <div class="step-number">3</div>
                    <span class="step-title">Entropy Analysis</span>
                </div>
                <span class="step-status pending" id="status3">Locked</span>
            </div>
            <div class="step-body">
                <p class="step-description">
                    The file has multiple sections. High entropy (close to 8.0) often indicates
                    encryption or packing. Identify the section most likely to contain packed code.
                </p>

                <table class="reference-table" id="entropyTable">
                    <tr>
                        <th>Section</th>
                        <th>Virtual Size</th>
                        <th>Entropy</th>
                        <th>Characteristics</th>
                    </tr>
                    <tr>
                        <td>.text</td>
                        <td>0x4200</td>
                        <td id="textEntropy">--</td>
                        <td>CODE, EXECUTE, READ</td>
                    </tr>
                    <tr>
                        <td>.rdata</td>
                        <td>0x1800</td>
                        <td id="rdataEntropy">--</td>
                        <td>INITIALIZED_DATA, READ</td>
                    </tr>
                    <tr>
                        <td>.data</td>
                        <td>0x0C00</td>
                        <td id="dataEntropy">--</td>
                        <td>INITIALIZED_DATA, READ, WRITE</td>
                    </tr>
                    <tr>
                        <td>.rsrc</td>
                        <td>0x2400</td>
                        <td id="rsrcEntropy">--</td>
                        <td>INITIALIZED_DATA, READ</td>
                    </tr>
                </table>

                <p class="step-description">
                    Which section shows signs of being packed or encrypted?
                </p>

                <div class="input-area">
                    <input type="text" class="step-input" id="input3" placeholder="Enter section name (e.g., .text)">
                    <button class="verify-btn" onclick="verifyStep3()">Verify</button>
                </div>
                <div class="feedback" id="feedback3"></div>

                <span class="hint-toggle" onclick="toggleHint(3)">Need a hint?</span>
                <div class="hint-content" id="hint3">
                    Normal compiled code typically has entropy between 5.0-6.5.
                    Packed or encrypted content usually exceeds 7.0, often approaching 7.8-8.0.
                    Look for the outlier.
                </div>
            </div>
        </section>

        <!-- FINAL: Synthesis -->
        <section class="final-section locked" id="finalSection">
            <h2 class="final-title">Synthesize Your Findings</h2>
            <p class="final-description">
                Combine your discoveries into the final passphrase.<br>
                Format: <code>ENTRY_WORD_SECTION</code><br>
                Example: <code>0x1234_shadow_.text</code>
            </p>
            <input type="text" class="final-input" id="finalInput" placeholder="Enter final passphrase">
            <br>
            <button class="unlock-btn" onclick="verifyFinal()">UNLOCK TIER II</button>
            <div class="feedback" id="finalFeedback" style="max-width: 400px; margin: 15px auto 0;"></div>
        </section>

        <a href="../index.html" class="back-link">&larr; Return to Vault</a>
    </main>

    <!-- Success Overlay -->
    <div class="success-overlay" id="successOverlay">
        <div class="success-content">
            <div class="success-icon">ðŸŒ“</div>
            <h2 class="success-title">TIER II UNLOCKED</h2>
            <p class="success-message">
                You have proven your understanding of static analysis.<br>
                The Journeyman tier awaits. New knowledge is now accessible.
            </p>
            <a href="../index.html" class="continue-btn">ENTER THE VAULT</a>
        </div>
    </div>

    <script>
        // ============================================
        // CHALLENGE DATA (calculated, not hardcoded answers)
        // ============================================

        // Step 1: Entry point calculation
        // PE header bytes at offset 0x10: 00 14 00 00 (little endian)
        // Little endian conversion: 0x00001400
        const ENTRY_POINT = '0x1400';
        const ENTRY_POINT_ALT = '0x00001400';

        // Step 2: XOR decoding
        // Key is 0x14 (20 decimal) - derived from entry point
        // Target word: "beacon" (common C2 term)
        // 'b'=98, 'e'=101, 'a'=97, 'c'=99, 'o'=111, 'n'=110
        // XOR with 0x14: 98^20=118(v), 101^20=113(q), 97^20=117(u), 99^20=119(w), 111^20=123({), 110^20=122(z)
        // Encoded bytes: 0x76, 0x71, 0x75, 0x77, 0x7B, 0x7A
        const XOR_KEY = 0x14;
        const ENCODED_BYTES = [0x76, 0x71, 0x75, 0x77, 0x7B, 0x7A];
        const DECODED_WORD = 'beacon';

        // Step 3: Entropy values
        const ENTROPY_VALUES = {
            '.text': 6.21,
            '.rdata': 4.87,
            '.data': 3.42,
            '.rsrc': 7.89  // This is the packed section
        };
        const PACKED_SECTION = '.rsrc';

        // Final answer
        const FINAL_ANSWER = `${ENTRY_POINT}_${DECODED_WORD}_${PACKED_SECTION}`;
        const FINAL_ANSWER_ALT = `${ENTRY_POINT_ALT}_${DECODED_WORD}_${PACKED_SECTION}`;

        // State tracking
        let step1Complete = false;
        let step2Complete = false;
        let step3Complete = false;

        // ============================================
        // GOD MODE BYPASS
        // ============================================

        function godModeBypass() {
            if (window.godMode !== true) return false;

            // Complete all steps
            completeStep(1);
            unlockStep(2);
            showXORBytes();
            completeStep(2);
            unlockStep(3);
            showEntropyValues();
            completeStep(3);
            unlockFinal();

            // Show success message
            setTimeout(() => {
                document.getElementById('finalFeedback').className = 'feedback success';
                document.getElementById('finalFeedback').textContent = 'God Mode: All steps bypassed';
            }, 500);

            return true;
        }

        // ============================================
        // STEP VERIFICATION
        // ============================================

        function verifyStep1() {
            if (godModeBypass()) return;
            const input = document.getElementById('input1').value.trim().toLowerCase();
            const feedback = document.getElementById('feedback1');

            if (input === ENTRY_POINT.toLowerCase() || input === ENTRY_POINT_ALT.toLowerCase() ||
                input === '1400' || input === '0x01400' || input === '00001400') {
                feedback.className = 'feedback success';
                feedback.textContent = 'Correct! Entry point identified: ' + ENTRY_POINT;
                completeStep(1);
                unlockStep(2);
                showXORBytes();
            } else {
                feedback.className = 'feedback error';
                feedback.textContent = 'Incorrect. Remember: little-endian byte order. The bytes need to be reversed.';
            }
        }

        function verifyStep2() {
            const input = document.getElementById('input2').value.trim().toLowerCase();
            const feedback = document.getElementById('feedback2');

            if (input === DECODED_WORD) {
                feedback.className = 'feedback success';
                feedback.textContent = 'Correct! The hidden word is: ' + DECODED_WORD;
                completeStep(2);
                unlockStep(3);
                showEntropyValues();
            } else {
                feedback.className = 'feedback error';
                feedback.textContent = 'Incorrect. XOR each byte with the key (0x14 = 20 decimal).';
            }
        }

        function verifyStep3() {
            const input = document.getElementById('input3').value.trim().toLowerCase();
            const feedback = document.getElementById('feedback3');

            // Accept with or without the dot
            const normalizedInput = input.startsWith('.') ? input : '.' + input;

            if (normalizedInput === PACKED_SECTION) {
                feedback.className = 'feedback success';
                feedback.textContent = 'Correct! ' + PACKED_SECTION + ' shows signs of packing with entropy ' + ENTROPY_VALUES[PACKED_SECTION];
                completeStep(3);
                unlockFinal();
            } else {
                feedback.className = 'feedback error';
                feedback.textContent = 'Incorrect. Look for entropy values above 7.0 - that indicates possible packing.';
            }
        }

        function verifyFinal() {
            const input = document.getElementById('finalInput').value.trim().toLowerCase();
            const feedback = document.getElementById('finalFeedback');

            // Normalize the input for comparison
            const normalizedInput = input.replace(/\s+/g, '');
            const normalizedAnswer = FINAL_ANSWER.toLowerCase();
            const normalizedAnswerAlt = FINAL_ANSWER_ALT.toLowerCase();

            if (normalizedInput === normalizedAnswer || normalizedInput === normalizedAnswerAlt ||
                normalizedInput === '0x1400_beacon_.rsrc' || normalizedInput === '0x1400_beacon_rsrc' ||
                normalizedInput === '1400_beacon_.rsrc' || normalizedInput === '1400_beacon_rsrc') {
                // Success! Unlock Tier 2
                localStorage.setItem('gate6_complete', 'true');
                localStorage.setItem('gate6_timestamp', Date.now().toString());

                // Show success overlay
                document.getElementById('successOverlay').classList.add('visible');
            } else {
                feedback.className = 'feedback error';
                feedback.textContent = 'Incorrect format. Remember: ENTRY_WORD_SECTION (e.g., 0x1234_word_.text)';
            }
        }

        // ============================================
        // UI HELPERS
        // ============================================

        function completeStep(stepNum) {
            const section = document.getElementById('step' + stepNum);
            const status = document.getElementById('status' + stepNum);
            const dot = document.getElementById('dot' + stepNum);

            section.classList.add('complete');
            status.textContent = 'Complete';
            status.className = 'step-status complete';
            dot.classList.remove('active');
            dot.classList.add('complete');

            if (stepNum === 1) step1Complete = true;
            if (stepNum === 2) step2Complete = true;
            if (stepNum === 3) step3Complete = true;
        }

        function unlockStep(stepNum) {
            const section = document.getElementById('step' + stepNum);
            const status = document.getElementById('status' + stepNum);
            const dot = document.getElementById('dot' + stepNum);

            section.classList.remove('locked');
            status.textContent = 'Pending';
            dot.classList.add('active');
        }

        function unlockFinal() {
            const section = document.getElementById('finalSection');
            const dot = document.getElementById('dot4');

            section.classList.remove('locked');
            dot.classList.add('active');
        }

        function showXORBytes() {
            const bytesEl = document.getElementById('xorBytes');
            bytesEl.innerHTML = ENCODED_BYTES.map(b => '0x' + b.toString(16).toUpperCase()).join(' ') +
                '<br><br><span style="color: #5a6a8a;">XOR Key: 0x14 (derived from entry point)</span>';
        }

        function showEntropyValues() {
            document.getElementById('textEntropy').textContent = ENTROPY_VALUES['.text'].toFixed(2);
            document.getElementById('rdataEntropy').textContent = ENTROPY_VALUES['.rdata'].toFixed(2);
            document.getElementById('dataEntropy').textContent = ENTROPY_VALUES['.data'].toFixed(2);
            document.getElementById('rsrcEntropy').textContent = ENTROPY_VALUES['.rsrc'].toFixed(2);
        }

        function toggleHint(stepNum) {
            const hint = document.getElementById('hint' + stepNum);
            hint.classList.toggle('visible');
        }

        // ============================================
        // INITIALIZATION
        // ============================================

        // Check if already completed (for returning users)
        if (localStorage.getItem('gate6_complete') === 'true') {
            // Already completed - show success or redirect
            document.getElementById('successOverlay').classList.add('visible');
        }

        // Console breadcrumb
        console.log('%cðŸšª Gate VI: The First Sample', 'color: #9a7aaa; font-size: 12px;');
        console.log('%cStatic analysis separates the observer from the careless.', 'color: #6a4a7a; font-size: 10px;');
    </script>
</body>
</html>
