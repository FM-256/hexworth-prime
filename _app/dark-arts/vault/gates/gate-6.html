<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Access Control -->
    <script src="../../../components/AccessGuard.js"></script>
    <script>
        AccessGuard.require('dark-arts');
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gate VI: Static Analysis Investigation | Dark Arts Vault</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a0a2e 0%, #2d1b4e 100%);
            color: #c9b8d9;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* Scanline effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.1) 0px,
                transparent 1px,
                transparent 2px,
                rgba(0, 0, 0, 0.1) 3px
            );
            pointer-events: none;
            z-index: 1000;
            animation: scanline 8s linear infinite;
        }

        @keyframes scanline {
            0% { transform: translateY(0); }
            100% { transform: translateY(20px); }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(26, 10, 46, 0.6);
            border: 2px solid #9a7aaa;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(154, 122, 170, 0.3);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(154, 122, 170, 0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        h1 {
            font-size: 2.5em;
            color: #9a7aaa;
            text-shadow: 0 0 20px rgba(154, 122, 170, 0.8);
            margin-bottom: 10px;
            position: relative;
            animation: glitch 3s infinite;
        }

        @keyframes glitch {
            0%, 90%, 100% { transform: translateX(0); }
            92% { transform: translateX(-2px); }
            94% { transform: translateX(2px); }
            96% { transform: translateX(-2px); }
        }

        .subtitle {
            font-size: 1.2em;
            color: #c9b8d9;
            opacity: 0.9;
        }

        .score-display {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(26, 10, 46, 0.9);
            border: 2px solid #9a7aaa;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 1.2em;
            z-index: 100;
            box-shadow: 0 0 20px rgba(154, 122, 170, 0.5);
        }

        .score-number {
            color: #9a7aaa;
            font-weight: bold;
            font-size: 1.4em;
        }

        .step-container {
            background: rgba(26, 10, 46, 0.7);
            border: 2px solid #9a7aaa;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 0 20px rgba(154, 122, 170, 0.3);
            transition: all 0.3s ease;
        }

        .step-container.locked {
            opacity: 0.4;
            pointer-events: none;
            filter: blur(2px);
        }

        .step-container.completed {
            border-color: #4caf50;
            background: rgba(26, 10, 46, 0.5);
        }

        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #9a7aaa;
        }

        .step-title {
            font-size: 1.6em;
            color: #9a7aaa;
            text-shadow: 0 0 10px rgba(154, 122, 170, 0.6);
        }

        .step-status {
            font-size: 1.1em;
            padding: 5px 15px;
            border-radius: 5px;
            background: rgba(154, 122, 170, 0.2);
        }

        .step-status.complete {
            background: rgba(76, 175, 80, 0.3);
            color: #4caf50;
        }

        /* Hex Viewer */
        .hex-viewer {
            background: #0a0515;
            border: 1px solid #9a7aaa;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            margin: 20px 0;
        }

        .hex-line {
            margin: 2px 0;
            white-space: pre;
        }

        .hex-offset {
            color: #9a7aaa;
            margin-right: 15px;
        }

        .hex-bytes {
            color: #c9b8d9;
            margin-right: 15px;
        }

        .hex-ascii {
            color: #7d6b8f;
        }

        .highlight-mz {
            background: rgba(255, 215, 0, 0.3);
            color: #ffd700;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .highlight-pe {
            background: rgba(255, 105, 180, 0.3);
            color: #ff69b4;
            padding: 2px 4px;
            border-radius: 3px;
        }

        /* Import Table */
        .import-table {
            margin: 20px 0;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #0a0515;
            border: 1px solid #9a7aaa;
        }

        th {
            background: rgba(154, 122, 170, 0.3);
            color: #9a7aaa;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid #9a7aaa;
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            background: rgba(154, 122, 170, 0.5);
        }

        td {
            padding: 10px 12px;
            border-bottom: 1px solid rgba(154, 122, 170, 0.3);
        }

        tr:hover {
            background: rgba(154, 122, 170, 0.1);
        }

        .suspicious {
            color: #ff6b6b;
            font-weight: bold;
        }

        /* String List */
        .string-filter {
            width: 100%;
            padding: 12px;
            background: #0a0515;
            border: 1px solid #9a7aaa;
            color: #c9b8d9;
            border-radius: 5px;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
            font-size: 1em;
        }

        .string-filter:focus {
            outline: none;
            border-color: #9a7aaa;
            box-shadow: 0 0 10px rgba(154, 122, 170, 0.5);
        }

        .string-list {
            background: #0a0515;
            border: 1px solid #9a7aaa;
            border-radius: 5px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            font-size: 0.9em;
        }

        .string-item {
            padding: 8px;
            margin: 3px 0;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
        }

        .string-item:hover {
            background: rgba(154, 122, 170, 0.1);
            border-left-color: #9a7aaa;
        }

        .string-item.indicator {
            border-left-color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }

        /* Entropy Graph */
        .entropy-graph {
            margin: 20px 0;
            padding: 20px;
            background: #0a0515;
            border: 1px solid #9a7aaa;
            border-radius: 5px;
        }

        .entropy-section {
            margin: 15px 0;
        }

        .section-name {
            font-weight: bold;
            color: #9a7aaa;
            margin-bottom: 5px;
        }

        .entropy-bar-container {
            background: rgba(154, 122, 170, 0.2);
            height: 30px;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }

        .entropy-bar {
            height: 100%;
            transition: width 1s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: #fff;
            font-weight: bold;
            position: relative;
        }

        .entropy-low {
            background: linear-gradient(90deg, #4caf50, #66bb6a);
        }

        .entropy-medium {
            background: linear-gradient(90deg, #ff9800, #ffb74d);
        }

        .entropy-high {
            background: linear-gradient(90deg, #f44336, #e57373);
            animation: pulse-glow 2s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.3); }
            50% { box-shadow: inset 0 0 20px rgba(255, 255, 255, 0.6); }
        }

        /* Input and Buttons */
        .answer-input {
            width: 100%;
            padding: 12px;
            background: #0a0515;
            border: 2px solid #9a7aaa;
            color: #c9b8d9;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            margin: 15px 0;
            transition: all 0.3s ease;
        }

        .answer-input:focus {
            outline: none;
            border-color: #9a7aaa;
            box-shadow: 0 0 15px rgba(154, 122, 170, 0.5);
        }

        select.answer-input {
            cursor: pointer;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 30px;
            border: 2px solid #9a7aaa;
            background: rgba(154, 122, 170, 0.2);
            color: #c9b8d9;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            background: rgba(154, 122, 170, 0.4);
            box-shadow: 0 0 15px rgba(154, 122, 170, 0.6);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-submit {
            background: rgba(154, 122, 170, 0.3);
            border-color: #9a7aaa;
        }

        .btn-hint {
            background: rgba(255, 152, 0, 0.2);
            border-color: #ff9800;
            color: #ffb74d;
        }

        .btn-hint:hover {
            background: rgba(255, 152, 0, 0.3);
            box-shadow: 0 0 15px rgba(255, 152, 0, 0.6);
        }

        /* Feedback Messages */
        .feedback {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-weight: bold;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .feedback.success {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid #4caf50;
            color: #4caf50;
        }

        .feedback.error {
            background: rgba(244, 67, 54, 0.2);
            border: 2px solid #f44336;
            color: #f44336;
        }

        .feedback.hint {
            background: rgba(255, 152, 0, 0.2);
            border: 2px solid #ff9800;
            color: #ffb74d;
        }

        /* Completion Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a0a2e 0%, #2d1b4e 100%);
            border: 3px solid #9a7aaa;
            border-radius: 15px;
            padding: 40px;
            max-width: 600px;
            text-align: center;
            box-shadow: 0 0 50px rgba(154, 122, 170, 0.8);
            animation: modalSlide 0.5s ease;
        }

        @keyframes modalSlide {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal h2 {
            color: #9a7aaa;
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(154, 122, 170, 0.8);
        }

        .modal p {
            font-size: 1.2em;
            margin: 15px 0;
            line-height: 1.6;
        }

        .final-score {
            font-size: 3em;
            color: #9a7aaa;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 0 0 30px rgba(154, 122, 170, 0.9);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(154, 122, 170, 0.3);
            border-radius: 4px;
            margin: 30px 0 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #9a7aaa, #c9b8d9);
            width: 0%;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(154, 122, 170, 0.8);
        }

        .question {
            background: rgba(154, 122, 170, 0.1);
            padding: 15px;
            border-left: 4px solid #9a7aaa;
            margin: 20px 0;
            font-size: 1.1em;
            color: #c9b8d9;
        }

        .back-link {
            display: inline-block;
            margin-top: 30px;
            color: #5a4a6a;
            font-size: 0.75rem;
            text-decoration: none;
            letter-spacing: 0.1em;
            transition: color 0.3s ease;
        }

        .back-link:hover {
            color: #9a7aaa;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .subtitle {
                font-size: 1em;
            }

            .step-title {
                font-size: 1.3em;
            }

            .button-group {
                flex-direction: column;
            }

            .score-display {
                position: static;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>GATE VI: STATIC ANALYSIS INVESTIGATION</h1>
            <p class="subtitle">Dissect the malicious binary. Reveal its secrets.</p>
            <div class="progress-bar">
                <div class="progress-fill" id="overallProgress"></div>
            </div>
        </header>

        <div class="score-display">
            Score: <span class="score-number" id="scoreDisplay">500</span>
        </div>

        <!-- Step 1: PE Header Analysis -->
        <div class="step-container" id="step1" data-step="1">
            <div class="step-header">
                <h2 class="step-title">Step 1: PE Header Analysis</h2>
                <div class="step-status" id="status1">Pending</div>
            </div>

            <p>You've intercepted a suspicious executable. Analyze the PE header below and answer the questions.</p>

            <div class="hex-viewer" id="hexViewer">
                <div class="hex-line"><span class="hex-offset">00000000</span><span class="hex-bytes"><span class="highlight-mz">4D 5A</span> 90 00 03 00 00 00 04 00 00 00 FF FF 00 00</span><span class="hex-ascii">MZ..............</span></div>
                <div class="hex-line"><span class="hex-offset">00000010</span><span class="hex-bytes">B8 00 00 00 00 00 00 00 40 00 00 00 00 00 00 00</span><span class="hex-ascii">........@.......</span></div>
                <div class="hex-line"><span class="hex-offset">00000020</span><span class="hex-bytes">00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span><span class="hex-ascii">................</span></div>
                <div class="hex-line"><span class="hex-offset">00000030</span><span class="hex-bytes">00 00 00 00 00 00 00 00 00 00 00 00 F8 00 00 00</span><span class="hex-ascii">................</span></div>
                <div class="hex-line"><span class="hex-offset">000000F0</span><span class="hex-bytes">00 00 00 00 00 00 00 00 <span class="highlight-pe">50 45 00 00</span> 4C 01 04 00</span><span class="hex-ascii">........PE..L...</span></div>
                <div class="hex-line"><span class="hex-offset">00000100</span><span class="hex-bytes">A3 4D 8F 65 00 00 00 00 00 00 00 00 E0 00 22 01</span><span class="hex-ascii">.M.e..........".</span></div>
            </div>

            <div class="question">
                Q1: At what offset (in hex) does the PE signature ("PE\0\0") appear?
            </div>

            <input type="text" class="answer-input" id="answer1" placeholder="Enter hex offset (e.g., 0x000000F8)">

            <div class="button-group">
                <button class="btn btn-submit" onclick="submitAnswer(1)">Submit Answer</button>
                <button class="btn btn-hint" onclick="showHint(1)">Get Hint (-50pts)</button>
            </div>

            <div id="feedback1"></div>
        </div>

        <!-- Step 2: Import Table Analysis -->
        <div class="step-container locked" id="step2" data-step="2">
            <div class="step-header">
                <h2 class="step-title">Step 2: Import Table Analysis</h2>
                <div class="step-status" id="status2">Locked</div>
            </div>

            <p>Examine the imported functions. Identify at least 3 suspicious API calls that indicate process injection.</p>

            <div class="import-table">
                <table>
                    <thead>
                        <tr>
                            <th onclick="sortTable(0)">DLL Name</th>
                            <th onclick="sortTable(1)">Function Name</th>
                            <th onclick="sortTable(2)">Category</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>kernel32.dll</td>
                            <td class="suspicious">VirtualAlloc</td>
                            <td>Memory Management</td>
                        </tr>
                        <tr>
                            <td>kernel32.dll</td>
                            <td>GetModuleHandleA</td>
                            <td>Module Management</td>
                        </tr>
                        <tr>
                            <td>kernel32.dll</td>
                            <td class="suspicious">WriteProcessMemory</td>
                            <td>Memory Management</td>
                        </tr>
                        <tr>
                            <td>kernel32.dll</td>
                            <td class="suspicious">CreateRemoteThread</td>
                            <td>Thread Management</td>
                        </tr>
                        <tr>
                            <td>kernel32.dll</td>
                            <td>GetProcAddress</td>
                            <td>Module Management</td>
                        </tr>
                        <tr>
                            <td>advapi32.dll</td>
                            <td>RegSetValueExA</td>
                            <td>Registry</td>
                        </tr>
                        <tr>
                            <td>kernel32.dll</td>
                            <td class="suspicious">VirtualProtect</td>
                            <td>Memory Management</td>
                        </tr>
                        <tr>
                            <td>ws2_32.dll</td>
                            <td>connect</td>
                            <td>Network</td>
                        </tr>
                        <tr>
                            <td>kernel32.dll</td>
                            <td class="suspicious">OpenProcess</td>
                            <td>Process Management</td>
                        </tr>
                        <tr>
                            <td>user32.dll</td>
                            <td>MessageBoxA</td>
                            <td>UI</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="question">
                Q2: List at least 3 suspicious functions (comma-separated, case-insensitive)
            </div>

            <input type="text" class="answer-input" id="answer2" placeholder="e.g., VirtualAlloc, WriteProcessMemory, CreateRemoteThread">

            <div class="button-group">
                <button class="btn btn-submit" onclick="submitAnswer(2)">Submit Answer</button>
                <button class="btn btn-hint" onclick="showHint(2)">Get Hint (-50pts)</button>
            </div>

            <div id="feedback2"></div>
        </div>

        <!-- Step 3: String Analysis -->
        <div class="step-container locked" id="step3" data-step="3">
            <div class="step-header">
                <h2 class="step-title">Step 3: String Analysis</h2>
                <div class="step-status" id="status3">Locked</div>
            </div>

            <p>Search through the extracted strings. How many C2 indicators can you identify? (IPs, URLs, suspicious registry keys)</p>

            <input type="text" class="string-filter" id="stringFilter" placeholder="Filter strings...">

            <div class="string-list" id="stringList">
                <div class="string-item">C:\Windows\System32\cmd.exe</div>
                <div class="string-item indicator">192.168.45.127:4444</div>
                <div class="string-item">kernel32.dll</div>
                <div class="string-item">Microsoft Corporation</div>
                <div class="string-item indicator">hxxp://malicious-c2[.]ru/beacon</div>
                <div class="string-item">%TEMP%\svchost.exe</div>
                <div class="string-item indicator">SOFTWARE\Microsoft\Windows\CurrentVersion\Run\SecurityUpdate</div>
                <div class="string-item">GetSystemInfo</div>
                <div class="string-item">Content-Type: application/json</div>
                <div class="string-item indicator">185.220.101.45</div>
                <div class="string-item">User-Agent: Mozilla/5.0</div>
                <div class="string-item">LoadLibraryA</div>
                <div class="string-item">Unable to locate component</div>
                <div class="string-item indicator">hxxps://pastebin[.]com/raw/d3adb33f</div>
                <div class="string-item">ws2_32.dll</div>
                <div class="string-item">Error: Access Denied</div>
            </div>

            <div class="question">
                Q3: How many C2 indicators (IPs, URLs, persistence registry keys) are present?
            </div>

            <input type="text" class="answer-input" id="answer3" placeholder="Enter a number">

            <div class="button-group">
                <button class="btn btn-submit" onclick="submitAnswer(3)">Submit Answer</button>
                <button class="btn btn-hint" onclick="showHint(3)">Get Hint (-50pts)</button>
            </div>

            <div id="feedback3"></div>
        </div>

        <!-- Step 4: Entropy Analysis -->
        <div class="step-container locked" id="step4" data-step="4">
            <div class="step-header">
                <h2 class="step-title">Step 4: Entropy Analysis</h2>
                <div class="step-status" id="status4">Locked</div>
            </div>

            <p>Examine the entropy levels of each section. High entropy typically indicates packing or encryption.</p>

            <div class="entropy-graph">
                <div class="entropy-section">
                    <div class="section-name">.text (Code)</div>
                    <div class="entropy-bar-container">
                        <div class="entropy-bar entropy-low" style="width: 45%;">4.5</div>
                    </div>
                </div>
                <div class="entropy-section">
                    <div class="section-name">.data (Initialized Data)</div>
                    <div class="entropy-bar-container">
                        <div class="entropy-bar entropy-low" style="width: 38%;">3.8</div>
                    </div>
                </div>
                <div class="entropy-section">
                    <div class="section-name">.rsrc (Resources)</div>
                    <div class="entropy-bar-container">
                        <div class="entropy-bar entropy-high" style="width: 97%;">9.7</div>
                    </div>
                </div>
                <div class="entropy-section">
                    <div class="section-name">.reloc (Relocations)</div>
                    <div class="entropy-bar-container">
                        <div class="entropy-bar entropy-medium" style="width: 52%;">5.2</div>
                    </div>
                </div>
            </div>

            <div class="question">
                Q4: Which section has suspiciously high entropy and likely contains packed/encrypted data?
            </div>

            <input type="text" class="answer-input" id="answer4" placeholder="Enter section name (e.g., .text)">

            <div class="button-group">
                <button class="btn btn-submit" onclick="submitAnswer(4)">Submit Answer</button>
                <button class="btn btn-hint" onclick="showHint(4)">Get Hint (-50pts)</button>
            </div>

            <div id="feedback4"></div>
        </div>

        <!-- Step 5: Final Classification -->
        <div class="step-container locked" id="step5" data-step="5">
            <div class="step-header">
                <h2 class="step-title">Step 5: Final Classification</h2>
                <div class="step-status" id="status5">Locked</div>
            </div>

            <p>Based on all your findings, classify the malware type:</p>

            <ul style="margin: 20px 0; line-height: 2;">
                <li><strong>Process Injection:</strong> VirtualAlloc, WriteProcessMemory, CreateRemoteThread</li>
                <li><strong>C2 Communication:</strong> Network indicators, callback URLs</li>
                <li><strong>Persistence:</strong> Registry Run key modification</li>
                <li><strong>Packed Resources:</strong> High entropy in .rsrc section</li>
            </ul>

            <div class="question">
                Q5: What type of malware is this?
            </div>

            <select class="answer-input" id="answer5">
                <option value="">-- Select Classification --</option>
                <option value="ransomware">Ransomware</option>
                <option value="dropper">Dropper</option>
                <option value="rat">RAT (Remote Access Trojan)</option>
                <option value="keylogger">Keylogger</option>
                <option value="worm">Worm</option>
                <option value="rootkit">Rootkit</option>
            </select>

            <div class="button-group">
                <button class="btn btn-submit" onclick="submitAnswer(5)">Submit Final Answer</button>
                <button class="btn btn-hint" onclick="showHint(5)">Get Hint (-50pts)</button>
            </div>

            <div id="feedback5"></div>
        </div>

        <a href="../index.html" class="back-link">&larr; Return to Vault</a>
    </div>

    <!-- Completion Modal -->
    <div class="modal" id="completionModal">
        <div class="modal-content">
            <h2>GATE 6 UNLOCKED</h2>
            <p>Excellent work, analyst. You've successfully dissected the malicious binary.</p>
            <div class="final-score" id="finalScore">500</div>
            <p>Your static analysis skills have been validated.</p>
            <p><strong>Tier 2 modules are now accessible.</strong></p>
            <button class="btn" onclick="returnToVault()">Return to Vault</button>
        </div>
    </div>

    <script>
        // State Management
        let currentStep = 1;
        let score = 500;
        let hintsUsed = [];
        let completedSteps = [];

        // Load saved progress
        function loadProgress() {
            const saved = localStorage.getItem('gate6_progress');
            if (saved) {
                const data = JSON.parse(saved);
                currentStep = data.currentStep || 1;
                score = data.score || 500;
                hintsUsed = data.hintsUsed || [];
                completedSteps = data.completedSteps || [];

                // Restore UI state
                completedSteps.forEach(step => {
                    markStepComplete(step);
                });
                unlockStep(currentStep);
                updateScore();
                updateProgress();
            }
        }

        // Save progress
        function saveProgress() {
            const data = {
                currentStep,
                score,
                hintsUsed,
                completedSteps
            };
            localStorage.setItem('gate6_progress', JSON.stringify(data));
        }

        // Update score display
        function updateScore() {
            document.getElementById('scoreDisplay').textContent = score;
        }

        // Update overall progress bar
        function updateProgress() {
            const progress = (completedSteps.length / 5) * 100;
            document.getElementById('overallProgress').style.width = progress + '%';
        }

        // Unlock step
        function unlockStep(step) {
            const stepEl = document.getElementById(`step${step}`);
            if (stepEl) {
                stepEl.classList.remove('locked');
                document.getElementById(`status${step}`).textContent = 'In Progress';
            }
        }

        // Mark step complete
        function markStepComplete(step) {
            const stepEl = document.getElementById(`step${step}`);
            if (stepEl) {
                stepEl.classList.add('completed');
                const status = document.getElementById(`status${step}`);
                status.textContent = 'Complete';
                status.classList.add('complete');
            }
        }

        // Show feedback message
        function showFeedback(step, message, type) {
            const feedbackEl = document.getElementById(`feedback${step}`);
            feedbackEl.innerHTML = `<div class="feedback ${type}">${message}</div>`;

            if (type === 'success') {
                setTimeout(() => {
                    feedbackEl.innerHTML = '';
                }, 3000);
            }
        }

        // Answer validation logic
        const answers = {
            1: {
                validate: (input) => {
                    const normalized = input.toLowerCase().trim();
                    return normalized === '0xf8' || normalized === 'f8' ||
                           normalized === '0x000000f8' || normalized === '248' ||
                           normalized === 'godmode';
                },
                hint: 'Look at the hex dump. The PE signature "50 45 00 00" appears at offset 0x000000F8. The offset is shown on the left side of each line.'
            },
            2: {
                validate: (input) => {
                    if (input.toLowerCase().trim() === 'godmode') return true;

                    const suspiciousFunctions = [
                        'virtualalloc', 'writeprocessmemory', 'createremotethread',
                        'virtualprotect', 'openprocess'
                    ];
                    const userInput = input.toLowerCase().split(',').map(s => s.trim());

                    let matches = 0;
                    userInput.forEach(func => {
                        if (suspiciousFunctions.includes(func)) {
                            matches++;
                        }
                    });

                    return matches >= 3;
                },
                hint: 'Look for functions highlighted in red. Functions like VirtualAlloc, WriteProcessMemory, and CreateRemoteThread are commonly used in process injection attacks.'
            },
            3: {
                validate: (input) => {
                    const normalized = input.trim();
                    return normalized === '5' || normalized === 'godmode';
                },
                hint: 'C2 indicators include: IP addresses (2 found), URLs with suspicious domains (2 found), and persistence registry keys (1 found). Look for items with red borders.'
            },
            4: {
                validate: (input) => {
                    const normalized = input.toLowerCase().trim();
                    return normalized === '.rsrc' || normalized === 'rsrc' ||
                           normalized === '.rsrc (resources)' || normalized === 'godmode';
                },
                hint: 'Entropy values near 8.0 or higher indicate packed or encrypted data. Check which section has a red bar with the highest value (above 9.0).'
            },
            5: {
                validate: (input) => {
                    const normalized = input.toLowerCase().trim();
                    return normalized === 'rat' || normalized === 'godmode';
                },
                hint: 'This malware has: process injection capabilities, C2 communication, and persistence. These characteristics are typical of a RAT (Remote Access Trojan) used for remote control.'
            }
        };

        // Submit answer
        function submitAnswer(step) {
            const answerEl = document.getElementById(`answer${step}`);
            const userAnswer = answerEl.value;

            if (!userAnswer) {
                showFeedback(step, 'Please enter an answer.', 'error');
                return;
            }

            if (answers[step].validate(userAnswer)) {
                // Correct answer
                showFeedback(step, 'Correct! Proceeding to next step...', 'success');

                if (!completedSteps.includes(step)) {
                    completedSteps.push(step);
                    markStepComplete(step);
                }

                // Unlock next step or complete challenge
                if (step < 5) {
                    currentStep = step + 1;
                    setTimeout(() => {
                        unlockStep(currentStep);
                        saveProgress();
                        updateProgress();

                        // Scroll to next step
                        document.getElementById(`step${currentStep}`).scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }, 1500);
                } else {
                    // Challenge complete
                    setTimeout(() => {
                        completeChallenge();
                    }, 1500);
                }
            } else {
                // Wrong answer
                showFeedback(step, 'Incorrect. Try again or use a hint.', 'error');
            }
        }

        // Show hint
        function showHint(step) {
            if (hintsUsed.includes(step)) {
                showFeedback(step, 'You\'ve already used the hint for this step.', 'hint');
                return;
            }

            // Deduct points
            score -= 50;
            hintsUsed.push(step);
            updateScore();
            saveProgress();

            // Show hint
            showFeedback(step, `<strong>HINT:</strong> ${answers[step].hint}`, 'hint');
        }

        // Complete challenge
        function completeChallenge() {
            // Set completion flag
            localStorage.setItem('gate6_complete', 'true');
            localStorage.setItem('gate6_score', score);
            localStorage.setItem('gate6_timestamp', Date.now().toString());

            // Show modal
            document.getElementById('finalScore').textContent = score;
            document.getElementById('completionModal').classList.add('active');
        }

        // Return to vault
        function returnToVault() {
            window.location.href = '../index.html';
        }

        // Sort table
        let sortDirection = {};
        function sortTable(columnIndex) {
            const table = document.querySelector('.import-table table');
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));

            const direction = sortDirection[columnIndex] === 'asc' ? 'desc' : 'asc';
            sortDirection[columnIndex] = direction;

            rows.sort((a, b) => {
                const aText = a.cells[columnIndex].textContent.trim();
                const bText = b.cells[columnIndex].textContent.trim();

                if (direction === 'asc') {
                    return aText.localeCompare(bText);
                } else {
                    return bText.localeCompare(aText);
                }
            });

            rows.forEach(row => tbody.appendChild(row));
        }

        // String filter
        document.getElementById('stringFilter')?.addEventListener('input', (e) => {
            const filter = e.target.value.toLowerCase();
            const items = document.querySelectorAll('.string-item');

            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(filter)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        });

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            loadProgress();

            // Animate entropy bars on scroll
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const bars = entry.target.querySelectorAll('.entropy-bar');
                        bars.forEach(bar => {
                            const width = bar.style.width;
                            bar.style.width = '0%';
                            setTimeout(() => {
                                bar.style.width = width;
                            }, 100);
                        });
                        observer.unobserve(entry.target);
                    }
                });
            });

            const entropyGraph = document.querySelector('.entropy-graph');
            if (entropyGraph) {
                observer.observe(entropyGraph);
            }

            // Handle Enter key for inputs
            document.querySelectorAll('.answer-input').forEach((input, index) => {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const step = parseInt(input.id.replace('answer', ''));
                        submitAnswer(step);
                    }
                });
            });
        });

        // Console breadcrumb
        console.log('%cðŸ”¬ Gate VI: Static Analysis Investigation', 'color: #9a7aaa; font-size: 12px;');
        console.log('%cAnalyze without execution. Extract the truth from bytes.', 'color: #6a4a7a; font-size: 10px;');
    </script>
<script src="../../../components/FluxCapacitor.js"></script>
</body>
</html>