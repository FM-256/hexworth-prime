<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ansible Playbook Visualizer | Code House</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
            min-height: 100vh;
            color: #e2e8f0;
            padding: 2rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #6366f1, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: #94a3b8;
            font-size: 1.1rem;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #6366f1;
            text-decoration: none;
            margin-bottom: 1rem;
            transition: color 0.2s;
        }

        .back-link:hover {
            color: #818cf8;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            overflow: hidden;
        }

        .panel-header {
            background: rgba(99, 102, 241, 0.2);
            padding: 1rem 1.5rem;
            border-bottom: 1px solid rgba(99, 102, 241, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-header h2 {
            font-size: 1.1rem;
            color: #a5b4fc;
        }

        .panel-content {
            padding: 1.5rem;
        }

        .editor-area {
            width: 100%;
            min-height: 400px;
            background: #0f172a;
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9rem;
            color: #e2e8f0;
            resize: vertical;
            line-height: 1.6;
        }

        .editor-area:focus {
            outline: none;
            border-color: #6366f1;
        }

        .btn-row {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: rgba(99, 102, 241, 0.2);
            color: #a5b4fc;
            border: 1px solid rgba(99, 102, 241, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(99, 102, 241, 0.3);
        }

        .example-btns {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .example-btn {
            padding: 0.4rem 0.8rem;
            background: rgba(99, 102, 241, 0.15);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 4px;
            color: #a5b4fc;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .example-btn:hover {
            background: rgba(99, 102, 241, 0.3);
        }

        /* Visualization Area */
        .viz-container {
            min-height: 400px;
        }

        .play-block {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid rgba(16, 185, 129, 0.4);
            border-radius: 12px;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }

        .play-header {
            background: rgba(16, 185, 129, 0.2);
            padding: 1rem 1.25rem;
            border-bottom: 1px solid rgba(16, 185, 129, 0.3);
        }

        .play-title {
            font-size: 1.1rem;
            color: #34d399;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .play-meta {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
            flex-wrap: wrap;
        }

        .meta-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .badge-hosts {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }

        .badge-become {
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }

        .badge-vars {
            background: rgba(168, 85, 247, 0.2);
            color: #c084fc;
        }

        .badge-handlers {
            background: rgba(236, 72, 153, 0.2);
            color: #f472b6;
        }

        .play-body {
            padding: 1.25rem;
        }

        .section-label {
            font-size: 0.8rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.75rem;
            margin-top: 1rem;
        }

        .section-label:first-child {
            margin-top: 0;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .task-item {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 8px;
            padding: 1rem;
            transition: all 0.2s;
        }

        .task-item:hover {
            border-color: rgba(99, 102, 241, 0.6);
            transform: translateX(4px);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }

        .task-name {
            color: #e2e8f0;
            font-weight: 500;
        }

        .task-module {
            font-size: 0.75rem;
            padding: 0.2rem 0.5rem;
            background: rgba(99, 102, 241, 0.3);
            color: #a5b4fc;
            border-radius: 4px;
            white-space: nowrap;
        }

        .task-details {
            margin-top: 0.75rem;
            font-size: 0.85rem;
            color: #94a3b8;
        }

        .task-detail-row {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.3rem;
        }

        .detail-key {
            color: #6366f1;
            min-width: 80px;
        }

        .detail-value {
            color: #a5b4fc;
            font-family: 'Fira Code', monospace;
            font-size: 0.8rem;
        }

        .task-conditionals {
            margin-top: 0.5rem;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .cond-badge {
            font-size: 0.7rem;
            padding: 0.15rem 0.4rem;
            border-radius: 3px;
        }

        .cond-when {
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }

        .cond-loop {
            background: rgba(168, 85, 247, 0.2);
            color: #c084fc;
        }

        .cond-notify {
            background: rgba(236, 72, 153, 0.2);
            color: #f472b6;
        }

        .cond-register {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }

        .cond-tags {
            background: rgba(16, 185, 129, 0.2);
            color: #34d399;
        }

        /* Handlers */
        .handler-item {
            background: rgba(236, 72, 153, 0.1);
            border: 1px solid rgba(236, 72, 153, 0.3);
        }

        .handler-item:hover {
            border-color: rgba(236, 72, 153, 0.6);
        }

        /* Variables Section */
        .vars-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 0.75rem;
        }

        .var-item {
            background: rgba(168, 85, 247, 0.1);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 6px;
            padding: 0.75rem;
        }

        .var-name {
            color: #c084fc;
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
            margin-bottom: 0.3rem;
        }

        .var-value {
            color: #94a3b8;
            font-size: 0.8rem;
            word-break: break-all;
        }

        /* Error display */
        .error-box {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.4);
            border-radius: 8px;
            padding: 1rem;
            color: #fca5a5;
        }

        .error-box h3 {
            color: #f87171;
            margin-bottom: 0.5rem;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #64748b;
        }

        .empty-state .icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Reference Section */
        .reference-section {
            margin-top: 2rem;
        }

        .ref-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        .ref-card {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 8px;
            padding: 1rem;
        }

        .ref-card h3 {
            color: #a5b4fc;
            font-size: 0.95rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .ref-card ul {
            list-style: none;
            font-size: 0.85rem;
            color: #94a3b8;
        }

        .ref-card li {
            padding: 0.3rem 0;
            display: flex;
            gap: 0.5rem;
        }

        .ref-card code {
            background: rgba(99, 102, 241, 0.2);
            padding: 0.1rem 0.4rem;
            border-radius: 3px;
            font-family: 'Fira Code', monospace;
            font-size: 0.8rem;
            color: #c084fc;
        }

        /* Stats bar */
        .stats-bar {
            display: flex;
            gap: 1.5rem;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 8px;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #6366f1;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #94a3b8;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">
            <span>&larr;</span> Back to Code House
        </a>

        <div class="header">
            <h1>Ansible Playbook Visualizer</h1>
            <p>Parse and visualize Ansible playbook structure - plays, tasks, handlers, and variables</p>
        </div>

        <div class="main-layout">
            <!-- Input Panel -->
            <div class="panel">
                <div class="panel-header">
                    <h2>YAML Input</h2>
                    <div class="example-btns">
                        <button class="example-btn" onclick="loadExample('webserver')">Web Server</button>
                        <button class="example-btn" onclick="loadExample('docker')">Docker Deploy</button>
                        <button class="example-btn" onclick="loadExample('users')">User Management</button>
                        <button class="example-btn" onclick="loadExample('lamp')">LAMP Stack</button>
                    </div>
                </div>
                <div class="panel-content">
                    <textarea id="yamlInput" class="editor-area" placeholder="Paste your Ansible playbook YAML here...

Example:
---
- name: Configure web servers
  hosts: webservers
  become: true

  tasks:
    - name: Install nginx
      apt:
        name: nginx
        state: present"></textarea>
                    <div class="btn-row">
                        <button class="btn btn-primary" onclick="visualize()">
                            <span>Visualize Playbook</span>
                        </button>
                        <button class="btn btn-secondary" onclick="clearAll()">
                            Clear
                        </button>
                    </div>
                </div>
            </div>

            <!-- Visualization Panel -->
            <div class="panel">
                <div class="panel-header">
                    <h2>Playbook Structure</h2>
                </div>
                <div class="panel-content">
                    <div id="vizOutput" class="viz-container">
                        <div class="empty-state">
                            <div class="icon">ðŸ“‹</div>
                            <p>Paste a playbook and click "Visualize" to see its structure</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reference Section -->
        <div class="reference-section">
            <div class="panel">
                <div class="panel-header">
                    <h2>Ansible Playbook Reference</h2>
                </div>
                <div class="panel-content">
                    <div class="ref-grid">
                        <div class="ref-card">
                            <h3>Play Keywords</h3>
                            <ul>
                                <li><code>name</code> - Play description</li>
                                <li><code>hosts</code> - Target hosts/groups</li>
                                <li><code>become</code> - Privilege escalation</li>
                                <li><code>vars</code> - Play-level variables</li>
                                <li><code>tasks</code> - List of tasks to run</li>
                                <li><code>handlers</code> - Event-triggered tasks</li>
                                <li><code>roles</code> - Include roles</li>
                            </ul>
                        </div>
                        <div class="ref-card">
                            <h3>Task Keywords</h3>
                            <ul>
                                <li><code>name</code> - Task description</li>
                                <li><code>module:</code> - Module to execute</li>
                                <li><code>when</code> - Conditional execution</li>
                                <li><code>loop</code> - Iterate over items</li>
                                <li><code>register</code> - Store result</li>
                                <li><code>notify</code> - Trigger handlers</li>
                                <li><code>tags</code> - Task tags</li>
                            </ul>
                        </div>
                        <div class="ref-card">
                            <h3>Common Modules</h3>
                            <ul>
                                <li><code>apt/yum</code> - Package management</li>
                                <li><code>service</code> - Service control</li>
                                <li><code>copy/template</code> - File operations</li>
                                <li><code>file</code> - File properties</li>
                                <li><code>user</code> - User management</li>
                                <li><code>command/shell</code> - Run commands</li>
                                <li><code>debug</code> - Print variables</li>
                            </ul>
                        </div>
                        <div class="ref-card">
                            <h3>Variables</h3>
                            <ul>
                                <li><code>{{ var }}</code> - Jinja2 template</li>
                                <li><code>vars:</code> - Play variables</li>
                                <li><code>vars_files:</code> - External var files</li>
                                <li><code>register:</code> - Task output</li>
                                <li><code>hostvars</code> - Host variables</li>
                                <li><code>ansible_facts</code> - Gathered facts</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simple YAML parser (handles common Ansible structures)
        function parseYAML(yaml) {
            const lines = yaml.split('\n');
            const result = [];
            let currentPlay = null;
            let currentSection = null;
            let currentTask = null;
            let currentHandler = null;
            let indentStack = [];
            let inMultilineValue = false;
            let multilineKey = '';
            let multilineValue = '';

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                const trimmed = line.trim();

                // Skip empty lines and comments
                if (!trimmed || trimmed.startsWith('#')) continue;
                if (trimmed === '---') continue;

                // Calculate indent level
                const indent = line.search(/\S/);

                // New play (top-level list item)
                if (indent === 0 && trimmed.startsWith('- ')) {
                    if (currentPlay) {
                        if (currentTask) {
                            currentPlay.tasks.push(currentTask);
                            currentTask = null;
                        }
                        if (currentHandler) {
                            currentPlay.handlers.push(currentHandler);
                            currentHandler = null;
                        }
                        result.push(currentPlay);
                    }
                    currentPlay = {
                        name: '',
                        hosts: '',
                        become: false,
                        vars: {},
                        tasks: [],
                        handlers: [],
                        roles: []
                    };
                    currentSection = 'play';

                    // Parse inline key-value
                    const inlineMatch = trimmed.match(/^-\s+(\w+):\s*(.*)$/);
                    if (inlineMatch) {
                        const [, key, value] = inlineMatch;
                        if (key === 'name') currentPlay.name = value;
                        else if (key === 'hosts') currentPlay.hosts = value;
                        else if (key === 'become') currentPlay.become = value === 'true' || value === 'yes';
                    }
                    continue;
                }

                // Play-level properties
                if (currentPlay && indent === 2) {
                    const keyMatch = trimmed.match(/^(\w+):\s*(.*)$/);
                    if (keyMatch) {
                        const [, key, value] = keyMatch;
                        if (key === 'name') currentPlay.name = value;
                        else if (key === 'hosts') currentPlay.hosts = value;
                        else if (key === 'become') currentPlay.become = value === 'true' || value === 'yes';
                        else if (key === 'tasks') {
                            currentSection = 'tasks';
                            if (currentTask) {
                                currentPlay.tasks.push(currentTask);
                                currentTask = null;
                            }
                        }
                        else if (key === 'handlers') {
                            currentSection = 'handlers';
                            if (currentHandler) {
                                currentPlay.handlers.push(currentHandler);
                                currentHandler = null;
                            }
                        }
                        else if (key === 'vars') {
                            currentSection = 'vars';
                        }
                        else if (key === 'roles') {
                            currentSection = 'roles';
                        }
                    }
                    continue;
                }

                // Variables
                if (currentSection === 'vars' && indent === 4) {
                    const varMatch = trimmed.match(/^(\w+):\s*(.*)$/);
                    if (varMatch) {
                        currentPlay.vars[varMatch[1]] = varMatch[2] || '(complex)';
                    }
                    continue;
                }

                // Tasks
                if (currentSection === 'tasks' && trimmed.startsWith('- ')) {
                    if (currentTask) {
                        currentPlay.tasks.push(currentTask);
                    }
                    currentTask = {
                        name: '',
                        module: '',
                        args: {},
                        when: null,
                        loop: null,
                        register: null,
                        notify: null,
                        tags: []
                    };

                    // Check for inline name
                    const nameMatch = trimmed.match(/^-\s+name:\s*(.*)$/);
                    if (nameMatch) {
                        currentTask.name = nameMatch[1];
                    }
                    continue;
                }

                // Handlers
                if (currentSection === 'handlers' && trimmed.startsWith('- ')) {
                    if (currentHandler) {
                        currentPlay.handlers.push(currentHandler);
                    }
                    currentHandler = {
                        name: '',
                        module: '',
                        args: {}
                    };

                    const nameMatch = trimmed.match(/^-\s+name:\s*(.*)$/);
                    if (nameMatch) {
                        currentHandler.name = nameMatch[1];
                    }
                    continue;
                }

                // Task/Handler properties
                if ((currentTask || currentHandler) && indent >= 4) {
                    const target = currentSection === 'handlers' ? currentHandler : currentTask;
                    const propMatch = trimmed.match(/^(\w+):\s*(.*)$/);

                    if (propMatch) {
                        const [, key, value] = propMatch;

                        if (key === 'name') target.name = value;
                        else if (key === 'when') target.when = value;
                        else if (key === 'loop' || key === 'with_items') target.loop = value || 'items';
                        else if (key === 'register') target.register = value;
                        else if (key === 'notify') target.notify = value;
                        else if (key === 'tags') target.tags = value ? [value] : [];
                        else if (!['name', 'when', 'loop', 'with_items', 'register', 'notify', 'tags', 'become', 'become_user'].includes(key)) {
                            // This is a module
                            target.module = key;
                            if (value) {
                                target.args._inline = value;
                            }
                        }
                    }

                    // Module arguments (nested under module)
                    if (target.module && indent >= 6) {
                        const argMatch = trimmed.match(/^(\w+):\s*(.*)$/);
                        if (argMatch) {
                            target.args[argMatch[1]] = argMatch[2];
                        }
                    }
                }
            }

            // Don't forget the last items
            if (currentTask && currentPlay) {
                currentPlay.tasks.push(currentTask);
            }
            if (currentHandler && currentPlay) {
                currentPlay.handlers.push(currentHandler);
            }
            if (currentPlay) {
                result.push(currentPlay);
            }

            return result;
        }

        function visualize() {
            const yaml = document.getElementById('yamlInput').value;
            const output = document.getElementById('vizOutput');

            if (!yaml.trim()) {
                output.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ðŸ“‹</div>
                        <p>Paste a playbook and click "Visualize" to see its structure</p>
                    </div>
                `;
                return;
            }

            try {
                const plays = parseYAML(yaml);

                if (plays.length === 0) {
                    throw new Error('No plays found in playbook');
                }

                // Calculate stats
                const totalTasks = plays.reduce((sum, p) => sum + p.tasks.length, 0);
                const totalHandlers = plays.reduce((sum, p) => sum + p.handlers.length, 0);
                const totalVars = plays.reduce((sum, p) => sum + Object.keys(p.vars).length, 0);

                let html = `
                    <div class="stats-bar">
                        <div class="stat-item">
                            <span class="stat-value">${plays.length}</span>
                            <span class="stat-label">Play${plays.length !== 1 ? 's' : ''}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">${totalTasks}</span>
                            <span class="stat-label">Task${totalTasks !== 1 ? 's' : ''}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">${totalHandlers}</span>
                            <span class="stat-label">Handler${totalHandlers !== 1 ? 's' : ''}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">${totalVars}</span>
                            <span class="stat-label">Variable${totalVars !== 1 ? 's' : ''}</span>
                        </div>
                    </div>
                `;

                plays.forEach((play, playIndex) => {
                    html += `
                        <div class="play-block">
                            <div class="play-header">
                                <div class="play-title">
                                    <span>Play ${playIndex + 1}:</span>
                                    ${play.name || '(unnamed)'}
                                </div>
                                <div class="play-meta">
                                    ${play.hosts ? `<span class="meta-badge badge-hosts">hosts: ${play.hosts}</span>` : ''}
                                    ${play.become ? `<span class="meta-badge badge-become">become: yes</span>` : ''}
                                    ${Object.keys(play.vars).length > 0 ? `<span class="meta-badge badge-vars">${Object.keys(play.vars).length} vars</span>` : ''}
                                    ${play.handlers.length > 0 ? `<span class="meta-badge badge-handlers">${play.handlers.length} handlers</span>` : ''}
                                </div>
                            </div>
                            <div class="play-body">
                    `;

                    // Variables
                    if (Object.keys(play.vars).length > 0) {
                        html += `<div class="section-label">Variables</div>`;
                        html += `<div class="vars-grid">`;
                        for (const [name, value] of Object.entries(play.vars)) {
                            html += `
                                <div class="var-item">
                                    <div class="var-name">${name}</div>
                                    <div class="var-value">${escapeHtml(String(value))}</div>
                                </div>
                            `;
                        }
                        html += `</div>`;
                    }

                    // Tasks
                    if (play.tasks.length > 0) {
                        html += `<div class="section-label">Tasks</div>`;
                        html += `<div class="task-list">`;
                        play.tasks.forEach((task, taskIndex) => {
                            html += renderTask(task, taskIndex);
                        });
                        html += `</div>`;
                    }

                    // Handlers
                    if (play.handlers.length > 0) {
                        html += `<div class="section-label">Handlers</div>`;
                        html += `<div class="task-list">`;
                        play.handlers.forEach((handler, handlerIndex) => {
                            html += renderTask(handler, handlerIndex, true);
                        });
                        html += `</div>`;
                    }

                    html += `
                            </div>
                        </div>
                    `;
                });

                output.innerHTML = html;

            } catch (e) {
                output.innerHTML = `
                    <div class="error-box">
                        <h3>Parse Error</h3>
                        <p>${escapeHtml(e.message)}</p>
                        <p style="margin-top: 0.5rem; font-size: 0.85rem;">
                            Tip: Ensure your YAML is properly formatted with consistent indentation (2 spaces recommended).
                        </p>
                    </div>
                `;
            }
        }

        function renderTask(task, index, isHandler = false) {
            const args = Object.entries(task.args || {})
                .filter(([k]) => k !== '_inline')
                .map(([k, v]) => `<div class="task-detail-row"><span class="detail-key">${k}:</span><span class="detail-value">${escapeHtml(String(v))}</span></div>`)
                .join('');

            const inlineArg = task.args?._inline
                ? `<div class="task-detail-row"><span class="detail-value">${escapeHtml(task.args._inline)}</span></div>`
                : '';

            const conditionals = [];
            if (task.when) conditionals.push(`<span class="cond-badge cond-when">when: ${escapeHtml(task.when)}</span>`);
            if (task.loop) conditionals.push(`<span class="cond-badge cond-loop">loop</span>`);
            if (task.notify) conditionals.push(`<span class="cond-badge cond-notify">notify: ${escapeHtml(task.notify)}</span>`);
            if (task.register) conditionals.push(`<span class="cond-badge cond-register">register: ${task.register}</span>`);
            if (task.tags && task.tags.length) conditionals.push(`<span class="cond-badge cond-tags">tags: ${task.tags.join(', ')}</span>`);

            return `
                <div class="task-item ${isHandler ? 'handler-item' : ''}">
                    <div class="task-header">
                        <span class="task-name">${index + 1}. ${task.name || '(unnamed task)'}</span>
                        ${task.module ? `<span class="task-module">${task.module}</span>` : ''}
                    </div>
                    ${(args || inlineArg) ? `
                        <div class="task-details">
                            ${inlineArg}
                            ${args}
                        </div>
                    ` : ''}
                    ${conditionals.length > 0 ? `
                        <div class="task-conditionals">
                            ${conditionals.join('')}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function clearAll() {
            document.getElementById('yamlInput').value = '';
            document.getElementById('vizOutput').innerHTML = `
                <div class="empty-state">
                    <div class="icon">ðŸ“‹</div>
                    <p>Paste a playbook and click "Visualize" to see its structure</p>
                </div>
            `;
        }

        // Example playbooks
        const examples = {
            webserver: `---
- name: Configure Web Servers
  hosts: webservers
  become: true

  vars:
    http_port: 80
    doc_root: /var/www/html

  tasks:
    - name: Install nginx
      apt:
        name: nginx
        state: present
        update_cache: yes

    - name: Start nginx service
      service:
        name: nginx
        state: started
        enabled: yes

    - name: Copy website files
      copy:
        src: ./site/
        dest: "{{ doc_root }}"
        owner: www-data
        group: www-data
      notify: Restart nginx

    - name: Configure firewall
      ufw:
        rule: allow
        port: "{{ http_port }}"
        proto: tcp

  handlers:
    - name: Restart nginx
      service:
        name: nginx
        state: restarted`,

            docker: `---
- name: Deploy Docker Container
  hosts: docker_hosts
  become: true

  vars:
    container_name: myapp
    image_name: myapp:latest
    container_port: 8080

  tasks:
    - name: Install Docker dependencies
      apt:
        name:
          - apt-transport-https
          - ca-certificates
          - curl
        state: present

    - name: Pull Docker image
      docker_image:
        name: "{{ image_name }}"
        source: pull

    - name: Stop existing container
      docker_container:
        name: "{{ container_name }}"
        state: absent
      when: force_redeploy | default(false)

    - name: Start application container
      docker_container:
        name: "{{ container_name }}"
        image: "{{ image_name }}"
        state: started
        restart_policy: unless-stopped
        ports:
          - "{{ container_port }}:8080"
      register: container_result

    - name: Verify container is running
      debug:
        msg: "Container started: {{ container_result.container.Id }}"
      when: container_result.changed`,

            users: `---
- name: User Account Management
  hosts: all
  become: true

  vars:
    admin_group: wheel
    shell: /bin/bash

  tasks:
    - name: Ensure admin group exists
      group:
        name: "{{ admin_group }}"
        state: present

    - name: Create admin users
      user:
        name: "{{ item.name }}"
        groups: "{{ admin_group }}"
        shell: "{{ shell }}"
        create_home: yes
        state: present
      loop:
        - { name: alice }
        - { name: bob }
        - { name: charlie }
      tags: users

    - name: Add SSH keys for admin users
      authorized_key:
        user: "{{ item.name }}"
        key: "{{ item.key }}"
        state: present
      loop:
        - { name: alice, key: "ssh-rsa AAAA..." }
        - { name: bob, key: "ssh-rsa BBBB..." }
      tags: ssh

    - name: Configure sudo access
      lineinfile:
        path: /etc/sudoers.d/admins
        line: "%{{ admin_group }} ALL=(ALL) NOPASSWD: ALL"
        create: yes
        validate: visudo -cf %s`,

            lamp: `---
- name: Install LAMP Stack
  hosts: webservers
  become: true

  vars:
    mysql_root_password: secure_password
    php_packages:
      - php
      - php-mysql
      - php-fpm

  tasks:
    - name: Install Apache
      apt:
        name: apache2
        state: present
      notify: Start Apache

    - name: Install MySQL
      apt:
        name: mysql-server
        state: present

    - name: Start MySQL
      service:
        name: mysql
        state: started
        enabled: yes

    - name: Install PHP packages
      apt:
        name: "{{ php_packages }}"
        state: present
      loop: "{{ php_packages }}"
      notify: Restart Apache

    - name: Deploy info.php
      copy:
        content: "<?php phpinfo(); ?>"
        dest: /var/www/html/info.php
      tags: deploy

    - name: Remove default index.html
      file:
        path: /var/www/html/index.html
        state: absent
      when: remove_default | default(true)

  handlers:
    - name: Start Apache
      service:
        name: apache2
        state: started
        enabled: yes

    - name: Restart Apache
      service:
        name: apache2
        state: restarted`
        };

        function loadExample(name) {
            document.getElementById('yamlInput').value = examples[name];
            visualize();
        }
    </script>
</body>
</html>
