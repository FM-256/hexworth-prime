<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Access Control -->
    <script src="../../../components/AccessGuard.js"></script>
    <script>
        AccessGuard.require('sorted');
    </script>
    <!-- Achievement & Progress Integration -->
    <script src="../../../components/AchievementManager.js"></script>
    <script src="../../../components/ModuleProgress.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudFormation Fundamentals - House of the Code</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --house-color: #6366F1;
            --house-glow: rgba(99, 102, 241, 0.4);
            --bg-dark: #0a0a12;
            --bg-card: rgba(15, 15, 25, 0.8);
            --text-primary: #e8e8f0;
            --text-secondary: #8888aa;
            --aws-orange: #FF9900;
            --aws-glow: rgba(255, 153, 0, 0.4);
        }

        body {
            min-height: 100vh;
            background: var(--bg-dark);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* Header */
        .module-header {
            padding: 20px 30px;
            background: rgba(10, 10, 18, 0.95);
            border-bottom: 1px solid rgba(99, 102, 241, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 1px solid rgba(99, 102, 241, 0.3);
            background: transparent;
            color: var(--house-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .back-btn:hover {
            background: rgba(99, 102, 241, 0.1);
        }

        .module-title {
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .house-badge {
            font-size: 0.7rem;
            padding: 4px 12px;
            background: rgba(99, 102, 241, 0.15);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 20px;
            color: var(--house-color);
            letter-spacing: 0.1em;
        }

        /* Main Content */
        .module-content {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 30px;
        }

        .intro-section {
            text-align: center;
            margin-bottom: 50px;
        }

        .intro-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .intro-title {
            font-size: 2.2rem;
            font-weight: 300;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #fff, var(--aws-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .intro-subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Section Headers */
        .section-header {
            font-size: 1.4rem;
            font-weight: 400;
            margin-bottom: 25px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-header::before {
            content: '';
            width: 4px;
            height: 24px;
            background: var(--aws-orange);
            border-radius: 2px;
        }

        /* Benefits Grid */
        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 50px;
        }

        .benefit-card {
            background: var(--bg-card);
            border: 1px solid rgba(255, 153, 0, 0.15);
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .benefit-card:hover {
            border-color: var(--aws-orange);
            transform: translateY(-5px);
            box-shadow: 0 5px 20px var(--aws-glow);
        }

        .benefit-icon {
            font-size: 2rem;
            margin-bottom: 12px;
        }

        .benefit-card h3 {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--aws-orange);
        }

        .benefit-card p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Template Anatomy */
        .template-container {
            background: var(--bg-card);
            border: 1px solid rgba(255, 153, 0, 0.2);
            border-radius: 12px;
            padding: 40px;
            margin-bottom: 50px;
        }

        .template-section {
            background: rgba(255, 153, 0, 0.05);
            border: 2px solid rgba(255, 153, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .template-section:hover {
            border-color: var(--aws-orange);
            background: rgba(255, 153, 0, 0.1);
        }

        .template-section.active {
            border-color: var(--aws-orange);
            background: rgba(255, 153, 0, 0.15);
            box-shadow: 0 5px 25px var(--aws-glow);
        }

        .section-name {
            font-size: 1rem;
            font-weight: 600;
            color: var(--aws-orange);
            margin-bottom: 5px;
        }

        .section-desc {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .section-detail {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .template-section.active .section-detail {
            max-height: 400px;
            margin-top: 15px;
        }

        .detail-example {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 6px;
            margin-top: 12px;
            border-left: 3px solid var(--aws-orange);
        }

        .detail-example code {
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: #7dd3fc;
            display: block;
            line-height: 1.6;
        }

        /* Code Examples */
        .code-container {
            background: var(--bg-card);
            border: 1px solid rgba(255, 153, 0, 0.2);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 50px;
        }

        .code-block {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 153, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.8;
            color: #7dd3fc;
            overflow-x: auto;
        }

        .code-block .comment {
            color: #6b7280;
        }

        .code-block .keyword {
            color: #fb923c;
            font-weight: bold;
        }

        .code-block .string {
            color: #a78bfa;
        }

        .code-block .number {
            color: #10b981;
        }

        /* Intrinsic Functions Grid */
        .functions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 18px;
            margin-bottom: 50px;
        }

        .function-card {
            background: var(--bg-card);
            border: 1px solid rgba(255, 153, 0, 0.15);
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .function-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--aws-orange);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .function-card:hover::before {
            transform: scaleY(1);
        }

        .function-card:hover {
            border-color: var(--aws-orange);
            transform: translateX(5px);
            box-shadow: 0 5px 20px var(--aws-glow);
        }

        .function-card.expanded {
            border-color: var(--aws-orange);
            box-shadow: 0 5px 25px var(--aws-glow);
        }

        .function-name {
            font-size: 1rem;
            font-weight: 600;
            color: var(--aws-orange);
            font-family: 'Courier New', monospace;
            margin-bottom: 8px;
        }

        .function-desc {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .function-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .function-card.expanded .function-details {
            max-height: 300px;
        }

        .function-example {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 6px;
            margin-top: 12px;
            border-left: 3px solid var(--aws-orange);
        }

        .function-example code {
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: #7dd3fc;
            display: block;
            line-height: 1.6;
        }

        .example-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 6px;
        }

        /* Comparison Table */
        .comparison-container {
            background: var(--bg-card);
            border: 1px solid rgba(255, 153, 0, 0.2);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 50px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 153, 0, 0.1);
        }

        .comparison-table th {
            color: var(--aws-orange);
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .comparison-table td {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .comparison-table tr:hover {
            background: rgba(255, 153, 0, 0.05);
        }

        /* Action Buttons */
        .action-section {
            background: var(--bg-card);
            border: 1px solid rgba(255, 153, 0, 0.2);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin-top: 40px;
        }

        .action-section h3 {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .action-section p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .action-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 30px;
            background: linear-gradient(135deg, var(--aws-orange), #e88a00);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            margin: 5px;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px var(--aws-glow);
        }

        .action-btn.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        /* Info Box */
        .info-box {
            background: rgba(255, 153, 0, 0.05);
            border: 1px solid rgba(255, 153, 0, 0.3);
            border-left: 4px solid var(--aws-orange);
            border-radius: 8px;
            padding: 15px 20px;
            margin: 20px 0;
        }

        .info-box strong {
            color: var(--aws-orange);
            font-size: 0.9rem;
        }

        .info-box p, .info-box ul {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-top: 8px;
            line-height: 1.6;
        }

        .info-box code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #7dd3fc;
        }

        /* Footer */
        .module-footer {
            text-align: center;
            padding: 30px;
            border-top: 1px solid rgba(255, 153, 0, 0.1);
            margin-top: 50px;
        }

        .footer-text {
            font-size: 0.75rem;
            color: var(--text-secondary);
            letter-spacing: 0.1em;
        }

        /* Animations */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .benefits-grid {
                grid-template-columns: 1fr;
            }

            .functions-grid {
                grid-template-columns: 1fr;
            }

            .intro-title {
                font-size: 1.8rem;
            }

            .comparison-table {
                font-size: 0.8rem;
            }

            .comparison-table th,
            .comparison-table td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <header class="module-header">
        <div class="header-left">
            <button class="back-btn" onclick="goBack()">‚Üê</button>
            <span class="module-title">CloudFormation Fundamentals</span>
        </div>
        <span class="house-badge">HOUSE OF THE CODE</span>
    </header>

    <main class="module-content">
        <section class="intro-section">
            <div class="intro-icon">‚òÅÔ∏è</div>
            <h1 class="intro-title">AWS CloudFormation Fundamentals</h1>
            <p class="intro-subtitle">
                Master AWS-native Infrastructure as Code with CloudFormation. Define, provision, and manage
                AWS resources using declarative templates. Version control your cloud infrastructure with JSON or YAML.
            </p>
        </section>

        <!-- What is CloudFormation -->
        <h2 class="section-header">What is AWS CloudFormation?</h2>
        <div class="benefits-grid">
            <div class="benefit-card">
                <div class="benefit-icon">üèóÔ∏è</div>
                <h3>AWS-Native IaC</h3>
                <p>First-party AWS service for infrastructure automation. Deep integration with all AWS services, instant support for new features.</p>
            </div>
            <div class="benefit-card">
                <div class="benefit-icon">üìù</div>
                <h3>Declarative Templates</h3>
                <p>Describe your desired infrastructure state in JSON or YAML. CloudFormation handles the provisioning and configuration.</p>
            </div>
            <div class="benefit-card">
                <div class="benefit-icon">üîÑ</div>
                <h3>Stack Management</h3>
                <p>Group resources into stacks. Update, delete, or rollback entire environments as a single unit with dependency handling.</p>
            </div>
            <div class="benefit-card">
                <div class="benefit-icon">üí∞</div>
                <h3>No Additional Cost</h3>
                <p>CloudFormation itself is free. You only pay for the AWS resources it provisions - no extra charges for automation.</p>
            </div>
        </div>

        <!-- Template Anatomy -->
        <h2 class="section-header">CloudFormation Template Anatomy</h2>
        <div class="template-container">
            <p style="color: var(--text-secondary); margin-bottom: 25px;">
                CloudFormation templates have a well-defined structure. Click each section to learn more.
            </p>

            <div class="template-section" onclick="toggleSection(this)">
                <div class="section-name">AWSTemplateFormatVersion</div>
                <div class="section-desc">Specifies the template format version (currently "2010-09-09")</div>
                <div class="section-detail">
                    <p style="margin-top: 10px; font-size: 0.85rem; color: var(--text-secondary);">
                        The template format version identifies the capabilities of the template. This is always set to
                        "2010-09-09" and is the only valid value currently.
                    </p>
                    <div class="detail-example">
                        <div class="example-label">Example</div>
                        <code>AWSTemplateFormatVersion: '2010-09-09'</code>
                    </div>
                </div>
            </div>

            <div class="template-section" onclick="toggleSection(this)">
                <div class="section-name">Description</div>
                <div class="section-desc">A text string that describes the template (optional)</div>
                <div class="section-detail">
                    <p style="margin-top: 10px; font-size: 0.85rem; color: var(--text-secondary);">
                        Provides a human-readable description of what the template does. Shown in the AWS Console
                        when viewing stacks. Maximum 1024 bytes.
                    </p>
                    <div class="detail-example">
                        <div class="example-label">Example</div>
                        <code>Description: 'Web application stack with EC2, RDS, and S3'</code>
                    </div>
                </div>
            </div>

            <div class="template-section" onclick="toggleSection(this)">
                <div class="section-name">Parameters</div>
                <div class="section-desc">Input values to customize templates at runtime</div>
                <div class="section-detail">
                    <p style="margin-top: 10px; font-size: 0.85rem; color: var(--text-secondary);">
                        Parameters allow you to pass custom values into your template when creating or updating a stack.
                        Make templates reusable across environments (dev, staging, prod).
                    </p>
                    <div class="detail-example">
                        <div class="example-label">Example</div>
                        <code>Parameters:</code>
                        <code>  InstanceType:</code>
                        <code>    Type: String</code>
                        <code>    Default: t2.micro</code>
                        <code>    AllowedValues: [t2.micro, t2.small, t2.medium]</code>
                    </div>
                </div>
            </div>

            <div class="template-section" onclick="toggleSection(this)">
                <div class="section-name">Mappings</div>
                <div class="section-desc">Key-value lookup tables for conditional values</div>
                <div class="section-detail">
                    <p style="margin-top: 10px; font-size: 0.85rem; color: var(--text-secondary);">
                        Mappings are like lookup tables. Use them to set values based on regions, environments, or
                        instance types. Accessed with the Fn::FindInMap intrinsic function.
                    </p>
                    <div class="detail-example">
                        <div class="example-label">Example</div>
                        <code>Mappings:</code>
                        <code>  RegionMap:</code>
                        <code>    us-east-1:</code>
                        <code>      AMI: ami-0c55b159cbfafe1f0</code>
                        <code>    us-west-2:</code>
                        <code>      AMI: ami-0d1cd67c26f5fca19</code>
                    </div>
                </div>
            </div>

            <div class="template-section" onclick="toggleSection(this)">
                <div class="section-name">Resources</div>
                <div class="section-desc">AWS resources to create (REQUIRED - the only mandatory section)</div>
                <div class="section-detail">
                    <p style="margin-top: 10px; font-size: 0.85rem; color: var(--text-secondary);">
                        The heart of your template. Declares the AWS resources you want to create. Each resource must
                        have a Type (like AWS::EC2::Instance) and Properties specific to that resource type.
                    </p>
                    <div class="detail-example">
                        <div class="example-label">Example</div>
                        <code>Resources:</code>
                        <code>  MyEC2Instance:</code>
                        <code>    Type: AWS::EC2::Instance</code>
                        <code>    Properties:</code>
                        <code>      ImageId: ami-0c55b159cbfafe1f0</code>
                        <code>      InstanceType: t2.micro</code>
                    </div>
                </div>
            </div>

            <div class="template-section" onclick="toggleSection(this)">
                <div class="section-name">Outputs</div>
                <div class="section-desc">Values to export or display after stack creation</div>
                <div class="section-detail">
                    <p style="margin-top: 10px; font-size: 0.85rem; color: var(--text-secondary);">
                        Outputs return values from your stack, like resource IDs, DNS names, or IP addresses. Can be
                        exported for use in other stacks via cross-stack references.
                    </p>
                    <div class="detail-example">
                        <div class="example-label">Example</div>
                        <code>Outputs:</code>
                        <code>  InstancePublicIP:</code>
                        <code>    Description: Public IP of EC2 instance</code>
                        <code>    Value: !GetAtt MyEC2Instance.PublicIp</code>
                        <code>    Export:</code>
                        <code>      Name: !Sub ${AWS::StackName}-InstanceIP</code>
                    </div>
                </div>
            </div>
        </div>

        <!-- Intrinsic Functions -->
        <h2 class="section-header">Intrinsic Functions</h2>
        <div class="functions-grid">
            <div class="function-card" onclick="toggleFunction(this)">
                <div class="function-name">Ref (or !Ref)</div>
                <div class="function-desc">Returns the value of a parameter or resource</div>
                <div class="function-details">
                    <p style="margin-top: 10px; font-size: 0.85rem; color: var(--text-secondary);">
                        For parameters, returns the parameter value. For resources, returns the logical ID or primary identifier
                        (depends on resource type - EC2 instance returns instance ID, S3 bucket returns bucket name).
                    </p>
                    <div class="function-example">
                        <div class="example-label">Example</div>
                        <code>InstanceType: !Ref InstanceTypeParameter</code>
                        <code>VpcId: !Ref MyVPC</code>
                    </div>
                </div>
            </div>

            <div class="function-card" onclick="toggleFunction(this)">
                <div class="function-name">GetAtt (or !GetAtt)</div>
                <div class="function-desc">Returns an attribute value from a resource</div>
                <div class="function-details">
                    <p style="margin-top: 10px; font-size: 0.85rem; color: var(--text-secondary);">
                        Resources expose multiple attributes beyond their primary identifier. Use GetAtt to access
                        properties like PublicIp, Arn, or DnsName. Each resource type has specific available attributes.
                    </p>
                    <div class="function-example">
                        <div class="example-label">Example</div>
                        <code>PublicIP: !GetAtt MyInstance.PublicIp</code>
                        <code>BucketArn: !GetAtt MyBucket.Arn</code>
                    </div>
                </div>
            </div>

            <div class="function-card" onclick="toggleFunction(this)">
                <div class="function-name">Sub (or !Sub)</div>
                <div class="function-desc">Substitutes variables in a string</div>
                <div class="function-details">
                    <p style="margin-top: 10px; font-size: 0.85rem; color: var(--text-secondary);">
                        String interpolation function. Use ${VarName} syntax to inject values. Supports pseudo parameters
                        like ${AWS::Region}, ${AWS::StackName}, and ${AWS::AccountId}.
                    </p>
                    <div class="function-example">
                        <div class="example-label">Example</div>
                        <code>!Sub 'arn:aws:s3:::${BucketName}/*'</code>
                        <code>!Sub '${AWS::StackName}-web-server'</code>
                    </div>
                </div>
            </div>

            <div class="function-card" onclick="toggleFunction(this)">
                <div class="function-name">Join (or !Join)</div>
                <div class="function-desc">Appends values into a single string with delimiter</div>
                <div class="function-details">
                    <p style="margin-top: 10px; font-size: 0.85rem; color: var(--text-secondary);">
                        Concatenates a list of values with a specified delimiter. First argument is the delimiter,
                        second is the list of values to join. Use empty string '' for no delimiter.
                    </p>
                    <div class="function-example">
                        <div class="example-label">Example</div>
                        <code>!Join [':', [arn, aws, s3, '', '', mybucket]]</code>
                        <code>!Join ['-', [!Ref Environment, webserver]]</code>
                    </div>
                </div>
            </div>

            <div class="function-card" onclick="toggleFunction(this)">
                <div class="function-name">FindInMap (or !FindInMap)</div>
                <div class="function-desc">Returns a value from a mapping</div>
                <div class="function-details">
                    <p style="margin-top: 10px; font-size: 0.85rem; color: var(--text-secondary);">
                        Retrieves a value from a Mappings section. Takes three arguments: MapName, TopLevelKey,
                        SecondLevelKey. Returns the corresponding value.
                    </p>
                    <div class="function-example">
                        <div class="example-label">Example</div>
                        <code>!FindInMap [RegionMap, !Ref 'AWS::Region', AMI]</code>
                    </div>
                </div>
            </div>

            <div class="function-card" onclick="toggleFunction(this)">
                <div class="function-name">Select (or !Select)</div>
                <div class="function-desc">Returns a single value from a list by index</div>
                <div class="function-details">
                    <p style="margin-top: 10px; font-size: 0.85rem; color: var(--text-secondary);">
                        Gets an item from an array by zero-based index. First argument is the index number,
                        second is the list. Useful with GetAZs to select specific availability zones.
                    </p>
                    <div class="function-example">
                        <div class="example-label">Example</div>
                        <code>!Select [0, !GetAZs '']</code>
                        <code>!Select [1, [us-east-1a, us-east-1b]]</code>
                    </div>
                </div>
            </div>

            <div class="function-card" onclick="toggleFunction(this)">
                <div class="function-name">GetAZs (or !GetAZs)</div>
                <div class="function-desc">Returns an array of availability zones for a region</div>
                <div class="function-details">
                    <p style="margin-top: 10px; font-size: 0.85rem; color: var(--text-secondary);">
                        Returns a list of availability zones for the specified region. Use empty string '' or
                        AWS::Region pseudo parameter for current region. Combine with Select to pick specific AZs.
                    </p>
                    <div class="function-example">
                        <div class="example-label">Example</div>
                        <code>AvailabilityZone: !Select [0, !GetAZs '']</code>
                    </div>
                </div>
            </div>

            <div class="function-card" onclick="toggleFunction(this)">
                <div class="function-name">If (or !If)</div>
                <div class="function-desc">Returns one value if condition is true, another if false</div>
                <div class="function-details">
                    <p style="margin-top: 10px; font-size: 0.85rem; color: var(--text-secondary);">
                        Conditional logic in templates. Takes three arguments: condition name, value if true, value if false.
                        Conditions must be defined in the Conditions section.
                    </p>
                    <div class="function-example">
                        <div class="example-label">Example</div>
                        <code>!If [IsProduction, t3.large, t3.micro]</code>
                    </div>
                </div>
            </div>

            <div class="function-card" onclick="toggleFunction(this)">
                <div class="function-name">Base64 (or !Base64)</div>
                <div class="function-desc">Returns the Base64 encoding of a string</div>
                <div class="function-details">
                    <p style="margin-top: 10px; font-size: 0.85rem; color: var(--text-secondary);">
                        Encodes input string to Base64. Commonly used for UserData in EC2 instances, which expects
                        Base64-encoded data. Can combine with Sub for dynamic user data scripts.
                    </p>
                    <div class="function-example">
                        <div class="example-label">Example</div>
                        <code>UserData:</code>
                        <code>  !Base64 |</code>
                        <code>    #!/bin/bash</code>
                        <code>    yum update -y</code>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stack Operations -->
        <h2 class="section-header">Stack Operations & Change Sets</h2>
        <div class="code-container">
            <p style="color: var(--text-secondary); margin-bottom: 15px;">
                CloudFormation manages infrastructure through stack operations. Change sets let you preview changes before applying them.
            </p>

            <div class="info-box">
                <strong>Core Stack Operations:</strong>
                <ul style="padding-left: 20px; margin-top: 8px;">
                    <li><code>CreateStack</code> - Create a new stack from a template</li>
                    <li><code>UpdateStack</code> - Modify existing resources or add/remove resources</li>
                    <li><code>DeleteStack</code> - Delete all resources in the stack</li>
                    <li><code>CreateChangeSet</code> - Preview changes before updating</li>
                    <li><code>ExecuteChangeSet</code> - Apply previewed changes to stack</li>
                    <li><code>RollbackStack</code> - Revert to previous working state on failure</li>
                </ul>
            </div>

            <div class="code-block" style="margin-top: 20px;">
<span class="comment"># Create a stack</span>
aws cloudformation create-stack \
  --stack-name my-web-app \
  --template-body file://template.yaml \
  --parameters ParameterKey=InstanceType,ParameterValue=t2.micro

<span class="comment"># Create change set to preview updates</span>
aws cloudformation create-change-set \
  --stack-name my-web-app \
  --change-set-name my-changes \
  --template-body file://updated-template.yaml

<span class="comment"># View change set details</span>
aws cloudformation describe-change-set \
  --stack-name my-web-app \
  --change-set-name my-changes

<span class="comment"># Execute change set if changes look good</span>
aws cloudformation execute-change-set \
  --stack-name my-web-app \
  --change-set-name my-changes

<span class="comment"># Delete a stack</span>
aws cloudformation delete-stack --stack-name my-web-app
            </div>
        </div>

        <!-- Nested Stacks -->
        <h2 class="section-header">Nested Stacks</h2>
        <div class="code-container">
            <p style="color: var(--text-secondary); margin-bottom: 15px;">
                Nested stacks allow you to break large templates into smaller, reusable components. The parent stack references
                child stacks, creating a hierarchy of infrastructure.
            </p>

            <div class="info-box">
                <strong>Benefits of Nested Stacks:</strong>
                <ul style="padding-left: 20px; margin-top: 8px;">
                    <li>Break complex infrastructure into manageable pieces</li>
                    <li>Reuse common patterns (network layer, database layer, etc.)</li>
                    <li>Overcome 500-resource limit per stack</li>
                    <li>Update components independently</li>
                    <li>Share templates across teams and projects</li>
                </ul>
            </div>

            <div class="code-block" style="margin-top: 20px;">
<span class="comment"># Parent stack referencing nested stacks</span>
<span class="keyword">Resources</span>:
  NetworkStack:
    <span class="keyword">Type</span>: AWS::CloudFormation::Stack
    <span class="keyword">Properties</span>:
      TemplateURL: https://s3.amazonaws.com/bucket/network.yaml
      Parameters:
        VPCCidr: <span class="string">"10.0.0.0/16"</span>

  ApplicationStack:
    <span class="keyword">Type</span>: AWS::CloudFormation::Stack
    <span class="keyword">Properties</span>:
      TemplateURL: https://s3.amazonaws.com/bucket/application.yaml
      Parameters:
        VPCId: !GetAtt NetworkStack.Outputs.VPCId
        SubnetId: !GetAtt NetworkStack.Outputs.PublicSubnetId
            </div>
        </div>

        <!-- Comparison with Terraform -->
        <h2 class="section-header">CloudFormation vs Terraform</h2>
        <div class="comparison-container">
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Both are excellent IaC tools with different strengths. Choose based on your cloud strategy and team expertise.
            </p>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Feature</th>
                        <th>CloudFormation</th>
                        <th>Terraform</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Cloud Support</strong></td>
                        <td>AWS only (native integration)</td>
                        <td>Multi-cloud (AWS, Azure, GCP, etc.)</td>
                    </tr>
                    <tr>
                        <td><strong>Language</strong></td>
                        <td>JSON or YAML</td>
                        <td>HCL (HashiCorp Configuration Language)</td>
                    </tr>
                    <tr>
                        <td><strong>State Management</strong></td>
                        <td>Managed by AWS (no files to manage)</td>
                        <td>Explicit state file (local or remote)</td>
                    </tr>
                    <tr>
                        <td><strong>Cost</strong></td>
                        <td>Free (pay only for resources)</td>
                        <td>Free (open source) or paid (Terraform Cloud)</td>
                    </tr>
                    <tr>
                        <td><strong>New AWS Features</strong></td>
                        <td>Immediate support (1st party)</td>
                        <td>Delayed (provider must update)</td>
                    </tr>
                    <tr>
                        <td><strong>Preview Changes</strong></td>
                        <td>Change Sets</td>
                        <td>terraform plan</td>
                    </tr>
                    <tr>
                        <td><strong>Modularity</strong></td>
                        <td>Nested stacks</td>
                        <td>Modules</td>
                    </tr>
                    <tr>
                        <td><strong>Learning Curve</strong></td>
                        <td>Moderate (verbose YAML/JSON)</td>
                        <td>Moderate (learn HCL syntax)</td>
                    </tr>
                    <tr>
                        <td><strong>Best For</strong></td>
                        <td>AWS-only environments, deep AWS integration</td>
                        <td>Multi-cloud, hybrid infrastructure</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Complete Example -->
        <h2 class="section-header">Complete CloudFormation Example</h2>
        <div class="code-container">
            <p style="color: var(--text-secondary); margin-bottom: 15px;">
                A complete web application stack with VPC, security group, EC2 instance, and S3 bucket.
            </p>

            <div class="code-block">
<span class="keyword">AWSTemplateFormatVersion</span>: <span class="string">'2010-09-09'</span>
<span class="keyword">Description</span>: <span class="string">'Simple web application stack'</span>

<span class="keyword">Parameters</span>:
  InstanceType:
    <span class="keyword">Type</span>: String
    <span class="keyword">Default</span>: t2.micro
    <span class="keyword">AllowedValues</span>: [t2.micro, t2.small, t2.medium]
    <span class="keyword">Description</span>: EC2 instance type

  KeyName:
    <span class="keyword">Type</span>: AWS::EC2::KeyPair::KeyName
    <span class="keyword">Description</span>: EC2 key pair for SSH access

<span class="keyword">Mappings</span>:
  RegionMap:
    us-east-1:
      <span class="keyword">AMI</span>: ami-0c55b159cbfafe1f0
    us-west-2:
      <span class="keyword">AMI</span>: ami-0d1cd67c26f5fca19

<span class="keyword">Resources</span>:
  VPC:
    <span class="keyword">Type</span>: AWS::EC2::VPC
    <span class="keyword">Properties</span>:
      CidrBlock: <span class="string">'10.0.0.0/16'</span>
      EnableDnsHostnames: <span class="keyword">true</span>
      Tags:
        - Key: Name
          Value: !Sub <span class="string">'${AWS::StackName}-VPC'</span>

  InternetGateway:
    <span class="keyword">Type</span>: AWS::EC2::InternetGateway

  AttachGateway:
    <span class="keyword">Type</span>: AWS::EC2::VPCGatewayAttachment
    <span class="keyword">Properties</span>:
      VpcId: !Ref VPC
      InternetGatewayId: !Ref InternetGateway

  PublicSubnet:
    <span class="keyword">Type</span>: AWS::EC2::Subnet
    <span class="keyword">Properties</span>:
      VpcId: !Ref VPC
      CidrBlock: <span class="string">'10.0.1.0/24'</span>
      AvailabilityZone: !Select [<span class="number">0</span>, !GetAZs <span class="string">''</span>]
      MapPublicIpOnLaunch: <span class="keyword">true</span>

  WebServerSecurityGroup:
    <span class="keyword">Type</span>: AWS::EC2::SecurityGroup
    <span class="keyword">Properties</span>:
      GroupDescription: Allow HTTP and SSH
      VpcId: !Ref VPC
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: <span class="number">80</span>
          ToPort: <span class="number">80</span>
          CidrIp: <span class="string">'0.0.0.0/0'</span>
        - IpProtocol: tcp
          FromPort: <span class="number">22</span>
          ToPort: <span class="number">22</span>
          CidrIp: <span class="string">'0.0.0.0/0'</span>

  WebServerInstance:
    <span class="keyword">Type</span>: AWS::EC2::Instance
    <span class="keyword">Properties</span>:
      ImageId: !FindInMap [RegionMap, !Ref <span class="string">'AWS::Region'</span>, AMI]
      InstanceType: !Ref InstanceType
      KeyName: !Ref KeyName
      NetworkInterfaces:
        - AssociatePublicIpAddress: <span class="keyword">true</span>
          DeviceIndex: <span class="number">0</span>
          GroupSet:
            - !Ref WebServerSecurityGroup
          SubnetId: !Ref PublicSubnet
      UserData:
        !Base64 |
          #!/bin/bash
          yum update -y
          yum install -y httpd
          systemctl start httpd
          systemctl enable httpd
          echo "<span class="string">&lt;h1&gt;Hello from CloudFormation!&lt;/h1&gt;</span>" > /var/www/html/index.html
      Tags:
        - Key: Name
          Value: !Sub <span class="string">'${AWS::StackName}-WebServer'</span>

  WebsiteBucket:
    <span class="keyword">Type</span>: AWS::S3::Bucket
    <span class="keyword">Properties</span>:
      BucketName: !Sub <span class="string">'${AWS::StackName}-website-${AWS::AccountId}'</span>
      PublicAccessBlockConfiguration:
        BlockPublicAcls: <span class="keyword">true</span>
        BlockPublicPolicy: <span class="keyword">true</span>
        IgnorePublicAcls: <span class="keyword">true</span>
        RestrictPublicBuckets: <span class="keyword">true</span>

<span class="keyword">Outputs</span>:
  WebsiteURL:
    <span class="keyword">Description</span>: URL of the web server
    <span class="keyword">Value</span>: !Sub <span class="string">'http://${WebServerInstance.PublicIp}'</span>
    <span class="keyword">Export</span>:
      Name: !Sub <span class="string">'${AWS::StackName}-WebsiteURL'</span>

  BucketName:
    <span class="keyword">Description</span>: S3 bucket name
    <span class="keyword">Value</span>: !Ref WebsiteBucket

  InstanceId:
    <span class="keyword">Description</span>: EC2 instance ID
    <span class="keyword">Value</span>: !Ref WebServerInstance
            </div>
        </div>

        <!-- Practice Resources -->
        <section class="action-section" style="background: rgba(255, 153, 0, 0.05); border-color: rgba(255, 153, 0, 0.3);">
            <h3>Ready to Design?</h3>
            <p>Try our interactive CloudFormation designer to build AWS stacks visually and generate templates.</p>
            <a href="../applets/cloudformation-designer.html" class="action-btn">
                Launch CloudFormation Designer ‚Üí
            </a>
        </section>

        <section class="action-section">
            <h3>Hands-On Lab Exercise</h3>
            <p>Work through real-world CloudFormation scenarios with step-by-step guidance.</p>
            <a href="../labs/cloudformation-lab.html" class="action-btn">
                Start Lab Exercise ‚Üí
            </a>
        </section>

        <section class="action-section">
            <h3>Test Your Knowledge</h3>
            <p>Take the CloudFormation fundamentals quiz to validate your understanding.</p>
            <a href="../quizzes/cloudformation-quiz.html" class="action-btn">
                Take Quiz ‚Üí
            </a>
        </section>

        <!-- Module Completion -->
        <section class="action-section" style="background: var(--bg-card); border: 1px solid rgba(255, 153, 0, 0.3); margin-top: 20px;">
            <h3>Finished Reviewing?</h3>
            <p>Mark this module as complete to track your progress and unlock achievements.</p>
            <button class="action-btn success" onclick="completeModule()">
                ‚úì Mark as Complete
            </button>
        </section>
    </main>

    <footer class="module-footer">
        <div class="footer-text">HOUSE OF THE CODE ‚Ä¢ HEXWORTH PRIME</div>
    </footer>

    <script>
        // Toggle template section details
        function toggleSection(section) {
            const isActive = section.classList.contains('active');

            // Close all sections
            document.querySelectorAll('.template-section').forEach(s => {
                s.classList.remove('active');
            });

            // Toggle current section
            if (!isActive) {
                section.classList.add('active');
            }
        }

        // Toggle function card details
        function toggleFunction(card) {
            const isExpanded = card.classList.contains('expanded');

            // Close all cards
            document.querySelectorAll('.function-card').forEach(c => {
                c.classList.remove('expanded');
            });

            // Toggle current card
            if (!isExpanded) {
                card.classList.add('expanded');
            }
        }

        // Navigation functions
        function goBack() {
            if (window.history.length > 1) {
                window.history.back();
            } else {
                window.location.href = '../../../dashboard.html';
            }
        }

        function completeModule() {
            ModuleProgress.complete('code', 'code-cloudformation-fundamentals', {
                returnToDashboard: true
            });
        }

        // Initialize - activate first template section
        document.addEventListener('DOMContentLoaded', () => {
            const firstSection = document.querySelector('.template-section');
            if (firstSection) {
                firstSection.classList.add('active');
            }
        });
    </script>
</body>
</html>
