<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Network Traffic Analysis Lab - Eye House | Hexworth Prime</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0f0a1e 0%, #1a0b2e 100%);
      color: #e0e0e0;
      line-height: 1.6;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    header {
      background: linear-gradient(135deg, #c084fc 0%, #06b6d4 100%);
      padding: 30px;
      text-align: center;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(192, 132, 252, 0.3);
      margin-bottom: 30px;
    }

    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      color: white;
    }

    .subtitle {
      font-size: 1.2em;
      color: #f0f0f0;
    }

    .progress-section {
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      border: 2px solid rgba(192, 132, 252, 0.3);
    }

    .progress-bar {
      width: 100%;
      height: 30px;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 15px;
      overflow: hidden;
      margin-top: 10px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #c084fc 0%, #06b6d4 100%);
      width: 0%;
      transition: width 0.5s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    .exercise-list {
      display: grid;
      gap: 15px;
      margin-bottom: 30px;
    }

    .exercise-card {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(192, 132, 252, 0.3);
      border-radius: 10px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .exercise-card:hover {
      border-color: #c084fc;
      background: rgba(192, 132, 252, 0.1);
      transform: translateX(5px);
    }

    .exercise-card.active {
      border-color: #06b6d4;
      background: rgba(6, 182, 212, 0.15);
    }

    .exercise-card.completed {
      border-color: #00ff7f;
      background: rgba(0, 255, 127, 0.1);
    }

    .exercise-title {
      font-size: 1.2em;
      color: #c084fc;
      font-weight: 600;
    }

    .exercise-status {
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: 600;
    }

    .status-locked {
      background: rgba(128, 128, 128, 0.3);
      color: #888;
    }

    .status-available {
      background: rgba(6, 182, 212, 0.3);
      color: #06b6d4;
    }

    .status-completed {
      background: rgba(0, 255, 127, 0.3);
      color: #00ff7f;
    }

    .lab-panel {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(192, 132, 252, 0.3);
      border-radius: 10px;
      padding: 30px;
      margin-bottom: 20px;
      display: none;
    }

    .lab-panel.active {
      display: block;
    }

    .lab-panel h2 {
      color: #c084fc;
      font-size: 2em;
      margin-bottom: 20px;
      border-bottom: 3px solid #06b6d4;
      padding-bottom: 15px;
    }

    .lab-panel h3 {
      color: #06b6d4;
      font-size: 1.4em;
      margin: 25px 0 15px 0;
    }

    .scenario-box {
      background: rgba(6, 182, 212, 0.1);
      border-left: 4px solid #06b6d4;
      padding: 20px;
      margin: 20px 0;
      border-radius: 5px;
    }

    .scenario-box h4 {
      color: #06b6d4;
      margin-bottom: 10px;
    }

    .pcap-viewer {
      background: rgba(0, 0, 0, 0.6);
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      max-height: 400px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
    }

    .packet-row {
      padding: 10px;
      margin: 5px 0;
      background: rgba(192, 132, 252, 0.1);
      border-left: 4px solid #c084fc;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .packet-row:hover {
      background: rgba(192, 132, 252, 0.2);
      transform: translateX(5px);
    }

    .packet-row.selected {
      border-left-color: #06b6d4;
      background: rgba(6, 182, 212, 0.2);
    }

    .task-list {
      margin: 20px 0;
    }

    .task-item {
      background: rgba(0, 0, 0, 0.4);
      padding: 15px;
      margin: 10px 0;
      border-radius: 8px;
      border-left: 4px solid #c084fc;
      display: flex;
      align-items: flex-start;
      gap: 15px;
    }

    .task-checkbox {
      width: 24px;
      height: 24px;
      border: 2px solid #c084fc;
      border-radius: 5px;
      cursor: pointer;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .task-checkbox.checked {
      background: #00ff7f;
      border-color: #00ff7f;
    }

    .task-checkbox.checked::after {
      content: 'âœ“';
      color: #0f0a1e;
      font-weight: bold;
      font-size: 1.2em;
    }

    .answer-input {
      width: 100%;
      background: rgba(0, 0, 0, 0.4);
      border: 2px solid rgba(192, 132, 252, 0.3);
      color: #e0e0e0;
      padding: 12px;
      border-radius: 8px;
      font-size: 1em;
      font-family: 'Courier New', monospace;
      margin: 10px 0;
    }

    .answer-input:focus {
      outline: none;
      border-color: #c084fc;
      box-shadow: 0 0 10px rgba(192, 132, 252, 0.3);
    }

    button {
      background: linear-gradient(135deg, #c084fc 0%, #06b6d4 100%);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(192, 132, 252, 0.3);
      margin: 5px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(192, 132, 252, 0.5);
    }

    .hint-btn {
      background: rgba(255, 165, 0, 0.2);
      border: 2px solid #ffa500;
      color: #ffa500;
    }

    .verify-btn {
      background: linear-gradient(135deg, #00ff7f 0%, #00cc66 100%);
    }

    .next-btn {
      background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
    }

    .hint-box {
      background: rgba(255, 165, 0, 0.1);
      border: 2px solid #ffa500;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      display: none;
    }

    .hint-box.visible {
      display: block;
    }

    .hint-box h4 {
      color: #ffa500;
      margin-bottom: 10px;
    }

    .feedback-box {
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      display: none;
    }

    .feedback-box.visible {
      display: block;
    }

    .feedback-correct {
      background: rgba(0, 255, 127, 0.1);
      border: 2px solid #00ff7f;
      color: #00ff7f;
    }

    .feedback-incorrect {
      background: rgba(255, 68, 68, 0.1);
      border: 2px solid #ff4444;
      color: #ff4444;
    }

    .explanation-box {
      background: rgba(192, 132, 252, 0.1);
      border-left: 4px solid #c084fc;
      padding: 20px;
      margin: 20px 0;
      border-radius: 5px;
    }

    .explanation-box h4 {
      color: #c084fc;
      margin-bottom: 10px;
    }

    .code-block {
      background: rgba(0, 0, 0, 0.6);
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      font-family: 'Courier New', monospace;
      border-left: 4px solid #06b6d4;
      overflow-x: auto;
    }

    .ioc-tag {
      display: inline-block;
      background: rgba(255, 68, 68, 0.2);
      border: 1px solid #ff4444;
      color: #ff4444;
      padding: 5px 10px;
      border-radius: 5px;
      margin: 5px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }

    .completion-banner {
      background: linear-gradient(135deg, #00ff7f 0%, #00cc66 100%);
      color: #0f0a1e;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      margin: 30px 0;
      display: none;
    }

    .completion-banner.visible {
      display: block;
    }

    .completion-banner h2 {
      font-size: 2.5em;
      margin-bottom: 15px;
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 2em;
      }

      .lab-panel h2 {
        font-size: 1.5em;
      }
    }

    ::-webkit-scrollbar {
      width: 10px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 5px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #c084fc 0%, #06b6d4 100%);
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Network Traffic Analysis Lab</h1>
      <div class="subtitle">Hands-On Packet Analysis Exercises</div>
    </header>

    <div class="progress-section">
      <h3 style="color: #c084fc; margin-bottom: 10px;">Lab Progress</h3>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill">0%</div>
      </div>
      <p style="margin-top: 10px; color: #888;">Complete all 7 exercises to master traffic analysis</p>
    </div>

    <div class="exercise-list">
      <div class="exercise-card active" onclick="loadExercise(0)">
        <div>
          <div class="exercise-title">Exercise 1: Protocol Identification</div>
          <div style="color: #888; font-size: 0.9em;">Identify protocols in a mixed traffic capture</div>
        </div>
        <div class="exercise-status status-available">Available</div>
      </div>

      <div class="exercise-card" onclick="loadExercise(1)">
        <div>
          <div class="exercise-title">Exercise 2: TCP Stream Analysis</div>
          <div style="color: #888; font-size: 0.9em;">Follow a TCP stream to extract data</div>
        </div>
        <div class="exercise-status status-locked">Locked</div>
      </div>

      <div class="exercise-card" onclick="loadExercise(2)">
        <div>
          <div class="exercise-title">Exercise 3: Port Scan Detection</div>
          <div style="color: #888; font-size: 0.9em;">Identify port scanning activity patterns</div>
        </div>
        <div class="exercise-status status-locked">Locked</div>
      </div>

      <div class="exercise-card" onclick="loadExercise(3)">
        <div>
          <div class="exercise-title">Exercise 4: DNS Tunneling Investigation</div>
          <div style="color: #888; font-size: 0.9em;">Detect DNS tunneling indicators</div>
        </div>
        <div class="exercise-status status-locked">Locked</div>
      </div>

      <div class="exercise-card" onclick="loadExercise(4)">
        <div>
          <div class="exercise-title">Exercise 5: SMB Lateral Movement</div>
          <div style="color: #888; font-size: 0.9em;">Analyze SMB traffic for lateral movement</div>
        </div>
        <div class="exercise-status status-locked">Locked</div>
      </div>

      <div class="exercise-card" onclick="loadExercise(5)">
        <div>
          <div class="exercise-title">Exercise 6: Data Exfiltration Detection</div>
          <div style="color: #888; font-size: 0.9em;">Identify data exfiltration patterns</div>
        </div>
        <div class="exercise-status status-locked">Locked</div>
      </div>

      <div class="exercise-card" onclick="loadExercise(6)">
        <div>
          <div class="exercise-title">Exercise 7: IOC Extraction</div>
          <div style="color: #888; font-size: 0.9em;">Extract indicators of compromise from traffic</div>
        </div>
        <div class="exercise-status status-locked">Locked</div>
      </div>
    </div>

    <!-- Exercise 1: Protocol Identification -->
    <div class="lab-panel active" id="exercise0">
      <h2>Exercise 1: Protocol Identification</h2>

      <div class="scenario-box">
        <h4>Scenario</h4>
        <p>You've captured network traffic from a workstation. Your task is to identify the protocols present and understand what each conversation represents. This is fundamental for any traffic analysis investigation.</p>
      </div>

      <h3>Packet Capture</h3>
      <div class="pcap-viewer" id="pcap0">
        <div class="packet-row" data-proto="DNS">1  0.000000  192.168.1.100 â†’ 8.8.8.8  DNS  Query A github.com</div>
        <div class="packet-row" data-proto="DNS">2  0.045231  8.8.8.8 â†’ 192.168.1.100  DNS  Response A 140.82.121.4</div>
        <div class="packet-row" data-proto="TCP">3  0.050123  192.168.1.100 â†’ 140.82.121.4  TCP  [SYN] 54321â†’443</div>
        <div class="packet-row" data-proto="TCP">4  0.098456  140.82.121.4 â†’ 192.168.1.100  TCP  [SYN,ACK] 443â†’54321</div>
        <div class="packet-row" data-proto="TLS">5  0.098765  192.168.1.100 â†’ 140.82.121.4  TLS  Client Hello</div>
        <div class="packet-row" data-proto="TLS">6  0.152341  140.82.121.4 â†’ 192.168.1.100  TLS  Server Hello</div>
        <div class="packet-row" data-proto="ICMP">7  1.500000  192.168.1.100 â†’ 8.8.8.8  ICMP  Echo request</div>
        <div class="packet-row" data-proto="ICMP">8  1.523456  8.8.8.8 â†’ 192.168.1.100  ICMP  Echo reply</div>
        <div class="packet-row" data-proto="ARP">9  2.000000  Broadcast  ARP  Who has 192.168.1.1?</div>
        <div class="packet-row" data-proto="ARP">10 2.001234  192.168.1.1 â†’ 192.168.1.100  ARP  192.168.1.1 is at aa:bb:cc:dd:ee:ff</div>
      </div>

      <h3>Tasks</h3>
      <div class="task-list">
        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 1:</strong> How many different protocols are present in this capture?
            <input type="text" class="answer-input" id="ex1_q1" placeholder="Enter a number">
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 2:</strong> What domain is the user connecting to via HTTPS?
            <input type="text" class="answer-input" id="ex1_q2" placeholder="Enter the domain name">
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 3:</strong> Which protocol is used to resolve the domain name to an IP address?
            <input type="text" class="answer-input" id="ex1_q3" placeholder="Enter protocol name">
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 4:</strong> What is the purpose of packets 9-10 (ARP)?
            <select class="answer-input" id="ex1_q4">
              <option value="">Select an answer...</option>
              <option value="wrong1">Routing packets across the internet</option>
              <option value="correct">Resolving IP address to MAC address on local network</option>
              <option value="wrong2">Encrypting network traffic</option>
              <option value="wrong3">Testing network connectivity</option>
            </select>
          </div>
        </div>
      </div>

      <div style="margin-top: 20px;">
        <button class="hint-btn" onclick="showHint(0)">Show Hint</button>
        <button class="verify-btn" onclick="verifyExercise(0)">Verify Answers</button>
      </div>

      <div class="hint-box" id="hint0">
        <h4>Hint</h4>
        <ul>
          <li>Count each unique protocol mentioned in the packet list</li>
          <li>DNS queries show the domain being resolved (look at packet 1)</li>
          <li>DNS = Domain Name System</li>
          <li>ARP operates at Layer 2 to map IP addresses to physical MAC addresses</li>
        </ul>
      </div>

      <div class="feedback-box" id="feedback0"></div>
    </div>

    <!-- Exercise 2: TCP Stream Analysis -->
    <div class="lab-panel" id="exercise1">
      <h2>Exercise 2: TCP Stream Analysis</h2>

      <div class="scenario-box">
        <h4>Scenario</h4>
        <p>You've captured HTTP traffic before it was encrypted. Your task is to follow the TCP stream and extract the data being transmitted. This technique is crucial for understanding application-layer communications.</p>
      </div>

      <h3>TCP Stream Data</h3>
      <div class="code-block">
GET /admin/config.php HTTP/1.1
Host: internal-server.local
User-Agent: Mozilla/5.0
Accept: text/html
Cookie: session=a3f8d9e2c1b4

HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 156

{
  "database": "mysql://dbserver.local:3306",
  "admin_user": "sysadmin",
  "api_key": "sk-prod-9f8e7d6c5b4a3210",
  "backup_server": "10.50.100.25"
}
      </div>

      <h3>Tasks</h3>
      <div class="task-list">
        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 1:</strong> What sensitive file is being accessed?
            <input type="text" class="answer-input" id="ex2_q1" placeholder="Enter filename with path">
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 2:</strong> What is the IP address of the backup server revealed in the response?
            <input type="text" class="answer-input" id="ex2_q2" placeholder="Enter IP address">
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 3:</strong> Why is this traffic a security concern?
            <select class="answer-input" id="ex2_q3">
              <option value="">Select the primary concern...</option>
              <option value="wrong1">The server is using the wrong port</option>
              <option value="correct">Sensitive configuration data is transmitted in cleartext (HTTP)</option>
              <option value="wrong2">The content type is incorrect</option>
              <option value="wrong3">The request method should be POST</option>
            </select>
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 4:</strong> What Wireshark feature would you use to reconstruct this conversation?
            <input type="text" class="answer-input" id="ex2_q4" placeholder="Feature name">
          </div>
        </div>
      </div>

      <div style="margin-top: 20px;">
        <button class="hint-btn" onclick="showHint(1)">Show Hint</button>
        <button class="verify-btn" onclick="verifyExercise(1)">Verify Answers</button>
      </div>

      <div class="hint-box" id="hint1">
        <h4>Hint</h4>
        <ul>
          <li>The GET request shows the full path to the file</li>
          <li>Look in the JSON response for "backup_server"</li>
          <li>HTTP (port 80) sends data in cleartext, HTTPS (port 443) encrypts it</li>
          <li>Right-click on a packet â†’ "Follow" â†’ ?</li>
        </ul>
      </div>

      <div class="feedback-box" id="feedback1"></div>
    </div>

    <!-- Exercise 3: Port Scan Detection -->
    <div class="lab-panel" id="exercise2">
      <h2>Exercise 3: Port Scan Detection</h2>

      <div class="scenario-box">
        <h4>Scenario</h4>
        <p>Your IDS has flagged suspicious activity from IP 203.0.113.45. Analyze the traffic pattern to determine if this is a port scan and identify the scanning technique being used.</p>
      </div>

      <h3>Captured Traffic Pattern</h3>
      <div class="pcap-viewer">
        <div class="packet-row">1  0.000000  203.0.113.45 â†’ 192.168.1.100  TCP  [SYN] â†’22</div>
        <div class="packet-row">2  0.050000  203.0.113.45 â†’ 192.168.1.100  TCP  [SYN] â†’23</div>
        <div class="packet-row">3  0.100000  203.0.113.45 â†’ 192.168.1.100  TCP  [SYN] â†’80</div>
        <div class="packet-row">4  0.105231  192.168.1.100 â†’ 203.0.113.45  TCP  [SYN,ACK] 80â†’</div>
        <div class="packet-row">5  0.106000  203.0.113.45 â†’ 192.168.1.100  TCP  [RST]</div>
        <div class="packet-row">6  0.150000  203.0.113.45 â†’ 192.168.1.100  TCP  [SYN] â†’443</div>
        <div class="packet-row">7  0.155987  192.168.1.100 â†’ 203.0.113.45  TCP  [SYN,ACK] 443â†’</div>
        <div class="packet-row">8  0.156500  203.0.113.45 â†’ 192.168.1.100  TCP  [RST]</div>
        <div class="packet-row">9  0.200000  203.0.113.45 â†’ 192.168.1.100  TCP  [SYN] â†’3389</div>
        <div class="packet-row">10 0.250000  203.0.113.45 â†’ 192.168.1.100  TCP  [SYN] â†’8080</div>
        <div class="packet-row">11 0.300000  203.0.113.45 â†’ 192.168.1.100  TCP  [SYN] â†’1433</div>
        <div class="packet-row">12 0.305654  192.168.1.100 â†’ 203.0.113.45  TCP  [SYN,ACK] 1433â†’</div>
        <div class="packet-row">13 0.306000  203.0.113.45 â†’ 192.168.1.100  TCP  [RST]</div>
      </div>

      <h3>Tasks</h3>
      <div class="task-list">
        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 1:</strong> Is this a port scan? (Yes/No)
            <input type="text" class="answer-input" id="ex3_q1" placeholder="Yes or No">
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 2:</strong> What type of scan is being performed?
            <select class="answer-input" id="ex3_q2">
              <option value="">Select scan type...</option>
              <option value="correct">TCP SYN scan (half-open)</option>
              <option value="wrong1">TCP Connect scan (full connection)</option>
              <option value="wrong2">UDP scan</option>
              <option value="wrong3">NULL scan</option>
            </select>
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 3:</strong> Which ports were found to be OPEN on the target?
            <input type="text" class="answer-input" id="ex3_q3" placeholder="Comma-separated list (e.g., 80,443,1433)">
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 4:</strong> What is the key indicator that makes packet 5 part of a SYN scan rather than normal traffic?
            <select class="answer-input" id="ex3_q4">
              <option value="">Select the indicator...</option>
              <option value="wrong1">The source IP address</option>
              <option value="correct">RST sent immediately after receiving SYN-ACK (connection not completed)</option>
              <option value="wrong2">The packet size</option>
              <option value="wrong3">The time interval between packets</option>
            </select>
          </div>
        </div>
      </div>

      <div style="margin-top: 20px;">
        <button class="hint-btn" onclick="showHint(2)">Show Hint</button>
        <button class="verify-btn" onclick="verifyExercise(2)">Verify Answers</button>
      </div>

      <div class="hint-box" id="hint2">
        <h4>Hint</h4>
        <ul>
          <li>Port scanning attempts connections to multiple sequential ports</li>
          <li>SYN scans send SYN, receive SYN-ACK, then send RST (don't complete handshake)</li>
          <li>Open ports respond with SYN-ACK, closed ports respond with RST</li>
          <li>Look for which ports received SYN-ACK responses</li>
        </ul>
      </div>

      <div class="feedback-box" id="feedback2"></div>
    </div>

    <!-- Exercise 4: DNS Tunneling -->
    <div class="lab-panel" id="exercise3">
      <h2>Exercise 4: DNS Tunneling Investigation</h2>

      <div class="scenario-box">
        <h4>Scenario</h4>
        <p>A security alert has triggered for unusual DNS activity from workstation 192.168.1.75. Investigate the DNS queries to determine if data is being exfiltrated through DNS tunneling.</p>
      </div>

      <h3>DNS Query Log</h3>
      <div class="pcap-viewer">
        <div class="packet-row">1  0.000000  192.168.1.75 â†’ 8.8.8.8  DNS  Query A www.google.com</div>
        <div class="packet-row">2  0.045000  192.168.1.75 â†’ 8.8.8.8  DNS  Query A AABBCCDDEEFFGGHHIIJJKKLLMMNNOOPPQQRRSSTTUUVVWWXXYYZZ.exfil.badguy.com</div>
        <div class="packet-row">3  0.046000  8.8.8.8 â†’ 192.168.1.75  DNS  Response TXT "NEXT"</div>
        <div class="packet-row">4  0.100000  192.168.1.75 â†’ 8.8.8.8  DNS  Query A 3q2w1e4r5t6y7u8i9o0p.exfil.badguy.com</div>
        <div class="packet-row">5  0.101000  8.8.8.8 â†’ 192.168.1.75  DNS  Response TXT "ACK"</div>
        <div class="packet-row">6  0.150000  192.168.1.75 â†’ 8.8.8.8  DNS  Query A zxcvbnmasdfghjklqwertyuiop123456.exfil.badguy.com</div>
        <div class="packet-row">7  0.200000  192.168.1.75 â†’ 8.8.8.8  DNS  Query TXT base64data1234567890abcdef.exfil.badguy.com</div>
        <div class="packet-row">8  0.201500  8.8.8.8 â†’ 192.168.1.75  DNS  Response TXT "OK"</div>
      </div>

      <h3>Tasks</h3>
      <div class="task-list">
        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 1:</strong> What is the suspicious domain being used for tunneling?
            <input type="text" class="answer-input" id="ex4_q1" placeholder="Enter domain">
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 2:</strong> What is a key indicator of DNS tunneling in this traffic? (Select all that apply)
            <div style="margin-top: 10px;">
              <label style="display: block; margin: 5px 0;">
                <input type="checkbox" id="ex4_q2a" style="margin-right: 10px;">
                Unusually long subdomain names
              </label>
              <label style="display: block; margin: 5px 0;">
                <input type="checkbox" id="ex4_q2b" style="margin-right: 10px;">
                High frequency of queries to same domain
              </label>
              <label style="display: block; margin: 5px 0;">
                <input type="checkbox" id="ex4_q2c" style="margin-right: 10px;">
                Use of TXT record queries (uncommon)
              </label>
              <label style="display: block; margin: 5px 0;">
                <input type="checkbox" id="ex4_q2d" style="margin-right: 10px;">
                Queries to legitimate domains like google.com
              </label>
            </div>
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 3:</strong> What Wireshark filter would show only DNS queries longer than 50 characters?
            <input type="text" class="answer-input" id="ex4_q3" placeholder="dns.qry.name.len ...">
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 4:</strong> What immediate action should be taken?
            <select class="answer-input" id="ex4_q4">
              <option value="">Select action...</option>
              <option value="wrong1">Delete all DNS logs</option>
              <option value="correct">Isolate workstation 192.168.1.75 and block exfil.badguy.com</option>
              <option value="wrong2">Restart the DNS server</option>
              <option value="wrong3">Ignore it as false positive</option>
            </select>
          </div>
        </div>
      </div>

      <div style="margin-top: 20px;">
        <button class="hint-btn" onclick="showHint(3)">Show Hint</button>
        <button class="verify-btn" onclick="verifyExercise(3)">Verify Answers</button>
      </div>

      <div class="hint-box" id="hint3">
        <h4>Hint</h4>
        <ul>
          <li>Look for the common base domain in packets 2, 4, 6, 7</li>
          <li>DNS tunneling uses long, random-looking subdomains to encode data</li>
          <li>TXT records are rarely used in normal DNS queries</li>
          <li>Wireshark syntax: <code>dns.qry.name.len > 50</code></li>
        </ul>
      </div>

      <div class="feedback-box" id="feedback3"></div>
    </div>

    <!-- Exercise 5: SMB Lateral Movement -->
    <div class="lab-panel" id="exercise4">
      <h2>Exercise 5: SMB Lateral Movement Analysis</h2>

      <div class="scenario-box">
        <h4>Scenario</h4>
        <p>A compromised workstation is attempting to spread laterally across the network using SMB. Analyze the traffic pattern to identify the attack behavior and compromised systems.</p>
      </div>

      <h3>SMB Traffic Analysis</h3>
      <div class="pcap-viewer">
        <div class="packet-row">1  0.000000  192.168.1.150 â†’ 192.168.1.10  TCP  [SYN] â†’445 (SMB)</div>
        <div class="packet-row">2  0.010000  192.168.1.10 â†’ 192.168.1.150  TCP  [SYN,ACK]</div>
        <div class="packet-row">3  0.011000  192.168.1.150 â†’ 192.168.1.10  SMB2  Negotiate Protocol</div>
        <div class="packet-row">4  0.020000  192.168.1.150 â†’ 192.168.1.10  SMB2  Session Setup (NTLM)</div>
        <div class="packet-row">5  0.030000  192.168.1.150 â†’ 192.168.1.10  SMB2  Tree Connect \\192.168.1.10\ADMIN$</div>
        <div class="packet-row">6  0.100000  192.168.1.150 â†’ 192.168.1.11  TCP  [SYN] â†’445 (SMB)</div>
        <div class="packet-row">7  0.110000  192.168.1.11 â†’ 192.168.1.150  TCP  [SYN,ACK]</div>
        <div class="packet-row">8  0.120000  192.168.1.150 â†’ 192.168.1.11  SMB2  Tree Connect \\192.168.1.11\C$</div>
        <div class="packet-row">9  0.200000  192.168.1.150 â†’ 192.168.1.12  TCP  [SYN] â†’445 (SMB)</div>
        <div class="packet-row">10 0.210000  192.168.1.12 â†’ 192.168.1.150  TCP  [SYN,ACK]</div>
        <div class="packet-row">11 0.220000  192.168.1.150 â†’ 192.168.1.12  SMB2  Tree Connect \\192.168.1.12\ADMIN$</div>
        <div class="packet-row">12 0.300000  192.168.1.150 â†’ 192.168.1.13  TCP  [SYN] â†’445 (SMB)</div>
        <div class="packet-row">13 0.350000  192.168.1.150 â†’ 192.168.1.14  TCP  [SYN] â†’445 (SMB)</div>
      </div>

      <h3>Tasks</h3>
      <div class="task-list">
        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 1:</strong> What is the source IP of the compromised system performing lateral movement?
            <input type="text" class="answer-input" id="ex5_q1" placeholder="Enter IP address">
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 2:</strong> How many different systems is the attacker attempting to access?
            <input type="text" class="answer-input" id="ex5_q2" placeholder="Enter number">
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 3:</strong> What administrative shares are being accessed? (Check all that apply)
            <div style="margin-top: 10px;">
              <label style="display: block; margin: 5px 0;">
                <input type="checkbox" id="ex5_q3a" style="margin-right: 10px;">
                ADMIN$ (Windows admin share)
              </label>
              <label style="display: block; margin: 5px 0;">
                <input type="checkbox" id="ex5_q3b" style="margin-right: 10px;">
                C$ (C drive share)
              </label>
              <label style="display: block; margin: 5px 0;">
                <input type="checkbox" id="ex5_q3c" style="margin-right: 10px;">
                IPC$ (Inter-process communication)
              </label>
            </div>
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 4:</strong> This lateral movement pattern is consistent with which attack technique?
            <select class="answer-input" id="ex5_q4">
              <option value="">Select technique...</option>
              <option value="wrong1">SQL injection</option>
              <option value="correct">Worm-like spread or Pass-the-Hash attack via SMB</option>
              <option value="wrong2">Cross-site scripting</option>
              <option value="wrong3">Buffer overflow</option>
            </select>
          </div>
        </div>
      </div>

      <div style="margin-top: 20px;">
        <button class="hint-btn" onclick="showHint(4)">Show Hint</button>
        <button class="verify-btn" onclick="verifyExercise(4)">Verify Answers</button>
      </div>

      <div class="hint-box" id="hint4">
        <h4>Hint</h4>
        <ul>
          <li>The source IP is consistent across all connections - it's the initiator</li>
          <li>Count unique destination IPs (192.168.1.10, .11, .12, .13, .14)</li>
          <li>Look for \\hostname\SHARENAME in the SMB packets</li>
          <li>Rapid SMB connections to multiple hosts using admin shares is classic lateral movement</li>
        </ul>
      </div>

      <div class="feedback-box" id="feedback4"></div>
    </div>

    <!-- Exercise 6: Data Exfiltration -->
    <div class="lab-panel" id="exercise5">
      <h2>Exercise 6: Data Exfiltration Detection</h2>

      <div class="scenario-box">
        <h4>Scenario</h4>
        <p>You're investigating a potential data breach. Network monitoring shows unusual outbound traffic patterns from a database server. Analyze the traffic to determine if data exfiltration is occurring.</p>
      </div>

      <h3>Network Flow Summary</h3>
      <div class="code-block">
Time: 02:15:00 AM (Off-hours)
Source: 10.50.10.20 (DB-SERVER-01)
Destination: 185.220.101.99 (External - Romania)
Protocol: HTTPS (TCP/443)
Duration: 45 minutes
Bytes Sent: 4.7 GB
Bytes Received: 125 KB
Session Pattern: Continuous upload stream

Connection Timeline:
02:15:00 - TLS handshake established
02:15:05 - Large data transfer begins (continuous PSH,ACK)
02:20:00 - 1 GB transferred
02:30:00 - 2.5 GB transferred
02:45:00 - 4.2 GB transferred
03:00:00 - Connection closed (FIN)

Normal Baseline for DB-SERVER-01:
- Typical outbound: < 50 MB/day
- Standard connections: Internal network only
- Off-hours activity: Minimal (automated backups to 10.50.100.25)
      </div>

      <h3>Tasks</h3>
      <div class="task-list">
        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 1:</strong> Is this likely data exfiltration? (Yes/No)
            <input type="text" class="answer-input" id="ex6_q1" placeholder="Yes or No">
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 2:</strong> What indicators support your conclusion? (Check all that apply)
            <div style="margin-top: 10px;">
              <label style="display: block; margin: 5px 0;">
                <input type="checkbox" id="ex6_q2a" style="margin-right: 10px;">
                Transfer occurred during off-hours (2 AM)
              </label>
              <label style="display: block; margin: 5px 0;">
                <input type="checkbox" id="ex6_q2b" style="margin-right: 10px;">
                Volume (4.7 GB) far exceeds normal baseline (50 MB/day)
              </label>
              <label style="display: block; margin: 5px 0;">
                <input type="checkbox" id="ex6_q2c" style="margin-right: 10px;">
                Destination is external IP in foreign country
              </label>
              <label style="display: block; margin: 5px 0;">
                <input type="checkbox" id="ex6_q2d" style="margin-right: 10px;">
                Asymmetric traffic (mostly upload, little download)
              </label>
            </div>
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 3:</strong> Why is the traffic encrypted (HTTPS) a concern in this context?
            <select class="answer-input" id="ex6_q3">
              <option value="">Select answer...</option>
              <option value="wrong1">HTTPS is always suspicious</option>
              <option value="correct">Encryption hides the actual data being exfiltrated from inspection</option>
              <option value="wrong2">HTTPS is slower than HTTP</option>
              <option value="wrong3">Encryption causes packet loss</option>
            </select>
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 4:</strong> What is the external IP that received the data?
            <input type="text" class="answer-input" id="ex6_q4" placeholder="Enter IP address">
          </div>
        </div>
      </div>

      <div style="margin-top: 20px;">
        <button class="hint-btn" onclick="showHint(5)">Show Hint</button>
        <button class="verify-btn" onclick="verifyExercise(5)">Verify Answers</button>
      </div>

      <div class="hint-box" id="hint5">
        <h4>Hint</h4>
        <ul>
          <li>Compare observed behavior against the stated normal baseline</li>
          <li>Multiple red flags together increase confidence in detection</li>
          <li>Encrypted traffic prevents DLP inspection of content</li>
          <li>Look for "Destination:" field in the flow summary</li>
        </ul>
      </div>

      <div class="feedback-box" id="feedback5"></div>
    </div>

    <!-- Exercise 7: IOC Extraction -->
    <div class="lab-panel" id="exercise6">
      <h2>Exercise 7: IOC Extraction from Malicious Traffic</h2>

      <div class="scenario-box">
        <h4>Scenario</h4>
        <p>You've identified confirmed malicious traffic in your network. Your task is to extract Indicators of Compromise (IOCs) that can be used to detect this threat across the organization and shared with threat intelligence platforms.</p>
      </div>

      <h3>Malicious Traffic Capture</h3>
      <div class="code-block">
DNS Queries:
- malware-c2-server.badactors.net â†’ 203.0.113.66
- update-check.legitlooking-domain.org â†’ 198.51.100.88
- cdn-resources.fake-cdn.biz â†’ 192.0.2.150

HTTP User-Agents:
- Mozilla/5.0 (Malware/1.0; Backdoor)
- python-requests/2.28.0
- CustomLoader/3.2

Destination IPs:
- 203.0.113.66:8443 (C2 server)
- 198.51.100.88:443 (Update server)
- 192.0.2.150:80 (Payload delivery)

File Downloads:
- GET /payload/update.exe (MD5: d41d8cd98f00b204e9800998ecf8427e)
- GET /tools/scanner.dll (MD5: 098f6bcd4621d373cade4e832627b4f6)

TLS Certificate (on 203.0.113.66):
- Issuer: CN=Fake CA, O=Malicious Org
- Subject: CN=*.badactors.net
- Serial: 13:37:de:ad:be:ef
- Valid: 2024-01-01 to 2025-12-31 (long validity - suspicious)

Network Behavior:
- Beaconing interval: 60 seconds exactly
- Beacon size: 128 bytes consistently
- Encrypted payload: Always 128 bytes
      </div>

      <h3>Tasks</h3>
      <div class="task-list">
        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 1:</strong> List all malicious domain IOCs (comma-separated):
            <input type="text" class="answer-input" id="ex7_q1" placeholder="domain1.com,domain2.org,...">
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 2:</strong> List all malicious IP addresses (comma-separated):
            <input type="text" class="answer-input" id="ex7_q2" placeholder="1.2.3.4,5.6.7.8,...">
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 3:</strong> What is the beaconing interval that could be used as a detection signature?
            <input type="text" class="answer-input" id="ex7_q3" placeholder="Enter number of seconds">
          </div>
        </div>

        <div class="task-item">
          <div class="task-checkbox" onclick="toggleTask(this)"></div>
          <div style="flex: 1;">
            <strong>Task 4:</strong> Which of these IOC types are most useful for long-term detection? (Rank 1-4, 1=best)
            <div style="margin-top: 10px;">
              <label style="display: block; margin: 5px 0;">
                IP addresses: <input type="number" id="ex7_q4a" min="1" max="4" style="width: 60px; margin-left: 10px;">
              </label>
              <label style="display: block; margin: 5px 0;">
                Domain names: <input type="number" id="ex7_q4b" min="1" max="4" style="width: 60px; margin-left: 10px;">
              </label>
              <label style="display: block; margin: 5px 0;">
                File hashes: <input type="number" id="ex7_q4c" min="1" max="4" style="width: 60px; margin-left: 10px;">
              </label>
              <label style="display: block; margin: 5px 0;">
                Network behavior (beaconing): <input type="number" id="ex7_q4d" min="1" max="4" style="width: 60px; margin-left: 10px;">
              </label>
            </div>
          </div>
        </div>
      </div>

      <div style="margin-top: 20px;">
        <button class="hint-btn" onclick="showHint(6)">Show Hint</button>
        <button class="verify-btn" onclick="verifyExercise(6)">Verify Answers</button>
      </div>

      <div class="hint-box" id="hint6">
        <h4>Hint</h4>
        <ul>
          <li>Extract all domains from the DNS queries section</li>
          <li>Extract all IPs from the "Destination IPs" section</li>
          <li>Beaconing interval is clearly stated in Network Behavior</li>
          <li>Consider: IPs change easily, domains can rotate, but hashes and behaviors are harder for attackers to change</li>
        </ul>
      </div>

      <div class="feedback-box" id="feedback6"></div>
    </div>

    <!-- Completion Banner -->
    <div class="completion-banner" id="completionBanner">
      <h2>ðŸŽ‰ Congratulations! ðŸŽ‰</h2>
      <p style="font-size: 1.3em; margin: 15px 0;">
        You've completed all 7 Network Traffic Analysis exercises!
      </p>
      <p style="font-size: 1.1em; color: rgba(15, 10, 30, 0.8);">
        You now have practical hands-on experience with packet analysis, protocol identification, threat detection, and IOC extraction - essential skills for any SOC analyst.
      </p>
      <button onclick="window.location.href='../quizzes/traffic-quiz.html'" style="margin-top: 20px; font-size: 1.2em; background: #0f0a1e; color: white;">
        Proceed to Final Quiz
      </button>
    </div>
  </div>

  <script>
    // Exercise state management
    const totalExercises = 7;
    let completedExercises = 0;
    let exerciseStates = new Array(totalExercises).fill(false);

    // Answer keys
    const answers = {
      0: { q1: '5', q2: 'github.com', q3: 'dns', q4: 'correct' },
      1: { q1: '/admin/config.php', q2: '10.50.100.25', q3: 'correct', q4: 'follow tcp stream' },
      2: { q1: 'yes', q2: 'correct', q3: '80,443,1433', q4: 'correct' },
      3: { q1: 'exfil.badguy.com', q2: ['ex4_q2a', 'ex4_q2b', 'ex4_q2c'], q3: 'dns.qry.name.len > 50', q4: 'correct' },
      4: { q1: '192.168.1.150', q2: '5', q3: ['ex5_q3a', 'ex5_q3b'], q4: 'correct' },
      5: { q1: 'yes', q2: ['ex6_q2a', 'ex6_q2b', 'ex6_q2c', 'ex6_q2d'], q3: 'correct', q4: '185.220.101.99' },
      6: {
        q1: 'malware-c2-server.badactors.net,update-check.legitlooking-domain.org,cdn-resources.fake-cdn.biz',
        q2: '203.0.113.66,198.51.100.88,192.0.2.150',
        q3: '60',
        q4: { a: 4, b: 3, c: 2, d: 1 } // Correct ranking: Behavior=1 (best), Hash=2, Domain=3, IP=4 (worst for long-term)
      }
    };

    function loadExercise(index) {
      // Check if exercise is unlocked
      if (index > 0 && !exerciseStates[index - 1]) {
        alert('Complete the previous exercise first!');
        return;
      }

      // Hide all panels
      document.querySelectorAll('.lab-panel').forEach(panel => {
        panel.classList.remove('active');
      });

      // Show selected panel
      document.getElementById(`exercise${index}`).classList.add('active');

      // Update exercise cards
      document.querySelectorAll('.exercise-card').forEach((card, i) => {
        card.classList.remove('active');
        if (i === index) {
          card.classList.add('active');
        }
      });

      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function toggleTask(checkbox) {
      checkbox.classList.toggle('checked');
    }

    function showHint(exerciseNum) {
      const hint = document.getElementById(`hint${exerciseNum}`);
      hint.classList.toggle('visible');
    }

    function verifyExercise(exerciseNum) {
      const answerKey = answers[exerciseNum];
      let correct = true;
      let feedback = '';

      // Exercise-specific verification
      switch(exerciseNum) {
        case 0: // Protocol Identification
          const q1 = document.getElementById('ex1_q1').value.trim();
          const q2 = document.getElementById('ex1_q2').value.trim().toLowerCase();
          const q3 = document.getElementById('ex1_q3').value.trim().toLowerCase();
          const q4 = document.getElementById('ex1_q4').value;

          if (q1 !== answerKey.q1 || q2 !== answerKey.q2 || q3 !== answerKey.q3 || q4 !== answerKey.q4) {
            correct = false;
          }
          break;

        case 1: // TCP Stream
          const ex2_q1 = document.getElementById('ex2_q1').value.trim();
          const ex2_q2 = document.getElementById('ex2_q2').value.trim();
          const ex2_q3 = document.getElementById('ex2_q3').value;
          const ex2_q4 = document.getElementById('ex2_q4').value.trim().toLowerCase();

          if (!ex2_q1.includes('config.php') || ex2_q2 !== answerKey.q2 || ex2_q3 !== answerKey.q3 || !ex2_q4.includes('tcp') || !ex2_q4.includes('stream')) {
            correct = false;
          }
          break;

        case 2: // Port Scan
          const ex3_q1 = document.getElementById('ex3_q1').value.trim().toLowerCase();
          const ex3_q2 = document.getElementById('ex3_q2').value;
          const ex3_q3 = document.getElementById('ex3_q3').value.trim();
          const ex3_q4 = document.getElementById('ex3_q4').value;

          const ports = ex3_q3.split(',').map(p => p.trim()).sort().join(',');

          if (ex3_q1 !== 'yes' || ex3_q2 !== answerKey.q2 || ports !== '1433,443,80' || ex3_q4 !== answerKey.q4) {
            correct = false;
          }
          break;

        case 3: // DNS Tunneling
          const ex4_q1 = document.getElementById('ex4_q1').value.trim().toLowerCase();
          const ex4_q2 = answerKey.q2.every(id => document.getElementById(id).checked) && !document.getElementById('ex4_q2d').checked;
          const ex4_q3 = document.getElementById('ex4_q3').value.trim();
          const ex4_q4 = document.getElementById('ex4_q4').value;

          if (!ex4_q1.includes('exfil.badguy.com') || !ex4_q2 || !ex4_q3.includes('> 50') || ex4_q4 !== answerKey.q4) {
            correct = false;
          }
          break;

        case 4: // SMB Lateral Movement
          const ex5_q1 = document.getElementById('ex5_q1').value.trim();
          const ex5_q2 = document.getElementById('ex5_q2').value.trim();
          const ex5_q3 = answerKey.q3.every(id => document.getElementById(id).checked) && !document.getElementById('ex5_q3c').checked;
          const ex5_q4 = document.getElementById('ex5_q4').value;

          if (ex5_q1 !== answerKey.q1 || ex5_q2 !== answerKey.q2 || !ex5_q3 || ex5_q4 !== answerKey.q4) {
            correct = false;
          }
          break;

        case 5: // Data Exfiltration
          const ex6_q1 = document.getElementById('ex6_q1').value.trim().toLowerCase();
          const ex6_q2 = answerKey.q2.every(id => document.getElementById(id).checked);
          const ex6_q3 = document.getElementById('ex6_q3').value;
          const ex6_q4 = document.getElementById('ex6_q4').value.trim();

          if (ex6_q1 !== 'yes' || !ex6_q2 || ex6_q3 !== answerKey.q3 || ex6_q4 !== answerKey.q4) {
            correct = false;
          }
          break;

        case 6: // IOC Extraction
          const ex7_q1 = document.getElementById('ex7_q1').value.trim().toLowerCase();
          const ex7_q2 = document.getElementById('ex7_q2').value.trim();
          const ex7_q3 = document.getElementById('ex7_q3').value.trim();

          const domains = ex7_q1.split(',').map(d => d.trim()).sort();
          const expectedDomains = answerKey.q1.toLowerCase().split(',').sort();

          const ips = ex7_q2.split(',').map(ip => ip.trim()).sort();
          const expectedIPs = answerKey.q2.split(',').sort();

          if (JSON.stringify(domains) !== JSON.stringify(expectedDomains) ||
              JSON.stringify(ips) !== JSON.stringify(expectedIPs) ||
              ex7_q3 !== answerKey.q3) {
            correct = false;
          }
          break;
      }

      // Display feedback
      const feedbackBox = document.getElementById(`feedback${exerciseNum}`);
      feedbackBox.classList.add('visible');

      if (correct) {
        feedbackBox.className = 'feedback-box visible feedback-correct';
        feedbackBox.innerHTML = `
          <h3>âœ“ Correct!</h3>
          <p>Excellent work! You've successfully completed this exercise.</p>
          ${getExplanation(exerciseNum)}
          <button class="next-btn" onclick="completeExercise(${exerciseNum})">Continue to Next Exercise</button>
        `;
      } else {
        feedbackBox.className = 'feedback-box visible feedback-incorrect';
        feedbackBox.innerHTML = `
          <h3>âœ— Not Quite Right</h3>
          <p>Review your answers and try again. Use the hint button if you need guidance.</p>
          <button onclick="this.parentElement.classList.remove('visible')">Try Again</button>
        `;
      }
    }

    function getExplanation(exerciseNum) {
      const explanations = {
        0: `<div class="explanation-box">
          <h4>Explanation</h4>
          <p><strong>5 protocols:</strong> DNS, TCP, TLS, ICMP, ARP</p>
          <p><strong>github.com:</strong> Shown in the DNS query (packet 1)</p>
          <p><strong>DNS:</strong> Domain Name System resolves names to IPs</p>
          <p><strong>ARP:</strong> Address Resolution Protocol maps IP to MAC addresses on the local network</p>
        </div>`,
        1: `<div class="explanation-box">
          <h4>Explanation</h4>
          <p>This HTTP request accesses <strong>/admin/config.php</strong>, which contains sensitive configuration data including database credentials and API keys.</p>
          <p>The traffic is unencrypted (HTTP not HTTPS), allowing anyone on the network to read this sensitive data in cleartext.</p>
          <p>Use <strong>Follow TCP Stream</strong> (right-click packet â†’ Follow â†’ TCP Stream) to reconstruct the entire conversation.</p>
        </div>`,
        2: `<div class="explanation-box">
          <h4>Explanation</h4>
          <p><strong>SYN scan</strong> sends SYN packets and waits for SYN-ACK (open) or RST (closed). The attacker then sends RST to avoid completing the connection, making it stealthier.</p>
          <p><strong>Open ports:</strong> 80, 443, 1433 (responded with SYN-ACK)</p>
          <p>This pattern of scanning sequential ports from a single source is a clear indicator of reconnaissance activity.</p>
        </div>`,
        3: `<div class="explanation-box">
          <h4>Explanation</h4>
          <p>DNS tunneling uses DNS queries to encode and exfiltrate data, bypassing many firewalls that allow DNS traffic.</p>
          <p><strong>Indicators:</strong> Long subdomains (50+ chars), high query frequency, TXT records, encoded data in queries</p>
          <p>The domain <strong>exfil.badguy.com</strong> is the attacker's infrastructure receiving the tunneled data.</p>
          <p><strong>Wireshark filter:</strong> <code>dns.qry.name.len > 50</code> shows queries with long names.</p>
        </div>`,
        4: `<div class="explanation-box">
          <h4>Explanation</h4>
          <p>Lateral movement via SMB involves connecting to administrative shares (ADMIN$, C$) on multiple systems.</p>
          <p><strong>Compromised host:</strong> 192.168.1.150 is the source of all connections</p>
          <p><strong>Targets:</strong> 192.168.1.10, .11, .12, .13, .14 (5 systems)</p>
          <p>This behavior is consistent with worms, ransomware, or manual attacker movement using stolen credentials (Pass-the-Hash).</p>
        </div>`,
        5: `<div class="explanation-box">
          <h4>Explanation</h4>
          <p>Multiple indicators confirm data exfiltration:</p>
          <ul>
            <li><strong>Volume:</strong> 4.7 GB vs. 50 MB baseline (94x normal)</li>
            <li><strong>Timing:</strong> 2 AM (off-hours when fewer people are watching)</li>
            <li><strong>Destination:</strong> External IP in Romania (no business justification)</li>
            <li><strong>Asymmetric:</strong> Mostly upload (4.7 GB out, 125 KB in)</li>
          </ul>
          <p>The use of HTTPS encryption prevents content inspection, but metadata analysis reveals the attack.</p>
        </div>`,
        6: `<div class="explanation-box">
          <h4>Explanation</h4>
          <p><strong>IOC Extraction:</strong></p>
          <p><strong>Domains:</strong> malware-c2-server.badactors.net, update-check.legitlooking-domain.org, cdn-resources.fake-cdn.biz</p>
          <p><strong>IPs:</strong> 203.0.113.66, 198.51.100.88, 192.0.2.150</p>
          <p><strong>Beaconing:</strong> 60 seconds (exact interval is a strong behavioral signature)</p>
          <p><strong>Durability:</strong> Behavioral patterns and file hashes are most valuable long-term, as IPs and domains change frequently.</p>
        </div>`
      };
      return explanations[exerciseNum] || '';
    }

    function completeExercise(exerciseNum) {
      if (!exerciseStates[exerciseNum]) {
        exerciseStates[exerciseNum] = true;
        completedExercises++;
        updateProgress();

        // Update exercise card appearance
        const cards = document.querySelectorAll('.exercise-card');
        cards[exerciseNum].classList.add('completed');
        cards[exerciseNum].querySelector('.exercise-status').textContent = 'Completed';
        cards[exerciseNum].querySelector('.exercise-status').className = 'exercise-status status-completed';

        // Unlock next exercise
        if (exerciseNum < totalExercises - 1) {
          cards[exerciseNum + 1].querySelector('.exercise-status').textContent = 'Available';
          cards[exerciseNum + 1].querySelector('.exercise-status').className = 'exercise-status status-available';
          loadExercise(exerciseNum + 1);
        } else {
          // All exercises completed
          document.getElementById('completionBanner').classList.add('visible');
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      }
    }

    function updateProgress() {
      const percentage = (completedExercises / totalExercises) * 100;
      const progressFill = document.getElementById('progressFill');
      progressFill.style.width = percentage + '%';
      progressFill.textContent = Math.round(percentage) + '%';
    }

    // Initialize
    updateProgress();
  </script>
</body>
</html>