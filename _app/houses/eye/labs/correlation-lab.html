<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Log Correlation Lab - Eye House - Hexworth Prime</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0f0f23 0%, #1a0a2e 100%);
      color: #e0e0e0;
      line-height: 1.6;
      padding: 20px;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      padding: 30px 20px;
      background: linear-gradient(135deg, rgba(192, 132, 252, 0.1) 0%, rgba(6, 182, 212, 0.1) 100%);
      border-radius: 15px;
      margin-bottom: 30px;
      border: 2px solid rgba(192, 132, 252, 0.3);
    }

    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #c084fc 0%, #06b6d4 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 1.1em;
      color: #06b6d4;
    }

    .progress-bar {
      background: rgba(15, 15, 35, 0.8);
      height: 40px;
      border-radius: 20px;
      overflow: hidden;
      margin: 20px 0;
      border: 2px solid rgba(192, 132, 252, 0.3);
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #c084fc 0%, #06b6d4 100%);
      transition: width 0.5s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 600;
    }

    .exercise-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .exercise-card {
      background: rgba(30, 30, 60, 0.6);
      padding: 20px;
      border-radius: 12px;
      border: 2px solid rgba(192, 132, 252, 0.3);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .exercise-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(192, 132, 252, 0.3);
      border-color: #06b6d4;
    }

    .exercise-card.completed {
      border-color: #4ade80;
      background: rgba(74, 222, 128, 0.1);
    }

    .exercise-card.active {
      border-color: #06b6d4;
      background: rgba(6, 182, 212, 0.1);
    }

    .exercise-number {
      display: inline-block;
      background: linear-gradient(135deg, #c084fc 0%, #06b6d4 100%);
      color: #0f0f23;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.2em;
      margin-bottom: 10px;
    }

    .exercise-card.completed .exercise-number {
      background: #4ade80;
    }

    .exercise-title {
      color: #c084fc;
      font-size: 1.2em;
      margin-bottom: 8px;
    }

    .exercise-content {
      display: none;
      background: rgba(30, 30, 60, 0.6);
      padding: 30px;
      border-radius: 15px;
      border: 2px solid rgba(192, 132, 252, 0.3);
      margin-bottom: 30px;
    }

    .exercise-content.active {
      display: block;
      animation: slideIn 0.5s ease;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h2 {
      color: #c084fc;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid rgba(192, 132, 252, 0.3);
    }

    h3 {
      color: #06b6d4;
      margin: 20px 0 10px 0;
    }

    .scenario-box {
      background: rgba(192, 132, 252, 0.1);
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      border-left: 5px solid #c084fc;
    }

    .log-panel {
      background: rgba(0, 0, 0, 0.4);
      padding: 20px;
      border-radius: 10px;
      margin: 15px 0;
      border: 2px solid rgba(192, 132, 252, 0.3);
      max-height: 400px;
      overflow-y: auto;
    }

    .log-panel h4 {
      color: #06b6d4;
      margin-bottom: 10px;
      position: sticky;
      top: 0;
      background: rgba(0, 0, 0, 0.9);
      padding: 10px 0;
    }

    .log-entry {
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      padding: 8px;
      margin: 5px 0;
      background: rgba(15, 15, 35, 0.6);
      border-radius: 5px;
      border-left: 3px solid transparent;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .log-entry:hover {
      background: rgba(192, 132, 252, 0.1);
      border-left-color: #c084fc;
    }

    .log-entry.selected {
      border-left-color: #06b6d4;
      background: rgba(6, 182, 212, 0.2);
    }

    .log-timestamp {
      color: #06b6d4;
      font-weight: bold;
    }

    .log-source {
      color: #c084fc;
    }

    .question-box {
      background: rgba(6, 182, 212, 0.1);
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      border-left: 5px solid #06b6d4;
    }

    .answer-area {
      margin: 20px 0;
    }

    .answer-input {
      width: 100%;
      min-height: 100px;
      background: rgba(0, 0, 0, 0.4);
      color: #e0e0e0;
      border: 2px solid rgba(192, 132, 252, 0.3);
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 1em;
      resize: vertical;
    }

    .answer-input:focus {
      outline: none;
      border-color: #c084fc;
    }

    .control-buttons {
      display: flex;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    button {
      background: linear-gradient(135deg, rgba(192, 132, 252, 0.3) 0%, rgba(6, 182, 212, 0.3) 100%);
      color: #c084fc;
      border: 2px solid #c084fc;
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    button:hover {
      background: linear-gradient(135deg, rgba(192, 132, 252, 0.5) 0%, rgba(6, 182, 212, 0.5) 100%);
      transform: translateY(-2px);
    }

    button.primary {
      background: linear-gradient(135deg, #c084fc 0%, #06b6d4 100%);
      color: #0f0f23;
    }

    button.success {
      background: #4ade80;
      border-color: #4ade80;
      color: #0f0f23;
    }

    .feedback {
      display: none;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      border-left: 5px solid;
    }

    .feedback.correct {
      display: block;
      background: rgba(74, 222, 128, 0.1);
      border-left-color: #4ade80;
      color: #4ade80;
    }

    .feedback.incorrect {
      display: block;
      background: rgba(244, 114, 182, 0.1);
      border-left-color: #f472b6;
      color: #f472b6;
    }

    .feedback.hint {
      display: block;
      background: rgba(251, 191, 36, 0.1);
      border-left-color: #fbbf24;
      color: #fbbf24;
    }

    .timeline-builder {
      background: rgba(15, 15, 35, 0.8);
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      border: 2px solid rgba(192, 132, 252, 0.3);
    }

    .timeline {
      position: relative;
      padding: 20px 0 20px 60px;
    }

    .timeline::before {
      content: '';
      position: absolute;
      left: 20px;
      top: 0;
      bottom: 0;
      width: 3px;
      background: linear-gradient(180deg, #c084fc 0%, #06b6d4 100%);
    }

    .timeline-item {
      position: relative;
      margin: 15px 0;
      padding: 15px;
      background: rgba(192, 132, 252, 0.1);
      border-radius: 8px;
      border-left: 4px solid #c084fc;
    }

    .timeline-item::before {
      content: '';
      position: absolute;
      left: -49px;
      top: 50%;
      transform: translateY(-50%);
      width: 12px;
      height: 12px;
      background: #c084fc;
      border: 3px solid #0f0f23;
      border-radius: 50%;
    }

    .correlation-workspace {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }

    .workspace-panel {
      background: rgba(15, 15, 35, 0.6);
      padding: 20px;
      border-radius: 10px;
      border: 2px solid rgba(192, 132, 252, 0.3);
    }

    .correlation-line {
      background: rgba(6, 182, 212, 0.2);
      padding: 10px;
      margin: 8px 0;
      border-radius: 5px;
      border-left: 3px solid #06b6d4;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }

    .killchain-mapper {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 20px 0;
    }

    .killchain-phase {
      background: rgba(30, 30, 60, 0.6);
      padding: 15px;
      border-radius: 8px;
      border-left: 5px solid #666;
    }

    .killchain-phase.mapped {
      border-left-color: #c084fc;
      background: rgba(192, 132, 252, 0.1);
    }

    .phase-drop-zone {
      min-height: 60px;
      border: 2px dashed rgba(192, 132, 252, 0.3);
      border-radius: 5px;
      padding: 10px;
      margin-top: 10px;
      display: none;
    }

    .killchain-phase.mapped .phase-drop-zone {
      display: block;
    }

    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
    }

    @media (max-width: 768px) {
      .exercise-list {
        grid-template-columns: 1fr;
      }
      .correlation-workspace {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üî¨ Log Correlation Lab</h1>
      <p class="subtitle">Hands-On Security Event Correlation Exercises</p>
      <div class="progress-bar">
        <div class="progress-fill" id="progressBar" style="width: 0%;">0% Complete (0/7)</div>
      </div>
    </header>

    <div class="exercise-list">
      <div class="exercise-card" onclick="startExercise(1)">
        <div class="exercise-number">1</div>
        <div class="exercise-title">Failed Login Correlation</div>
        <p>Correlate failed logins across multiple systems to identify brute force attacks</p>
      </div>
      <div class="exercise-card" onclick="startExercise(2)">
        <div class="exercise-number">2</div>
        <div class="exercise-title">Timeline Building</div>
        <p>Build a chronological timeline from disparate log sources</p>
      </div>
      <div class="exercise-card" onclick="startExercise(3)">
        <div class="exercise-number">3</div>
        <div class="exercise-title">Lateral Movement Detection</div>
        <p>Identify lateral movement using log correlation</p>
      </div>
      <div class="exercise-card" onclick="startExercise(4)">
        <div class="exercise-number">4</div>
        <div class="exercise-title">MITRE ATT&CK Mapping</div>
        <p>Map attack events to MITRE ATT&CK framework</p>
      </div>
      <div class="exercise-card" onclick="startExercise(5)">
        <div class="exercise-number">5</div>
        <div class="exercise-title">Writing Correlation Rules</div>
        <p>Write effective correlation rules for specific scenarios</p>
      </div>
      <div class="exercise-card" onclick="startExercise(6)">
        <div class="exercise-number">6</div>
        <div class="exercise-title">Multi-Stage Attack Investigation</div>
        <p>Investigate a complex multi-stage attack using only logs</p>
      </div>
      <div class="exercise-card" onclick="startExercise(7)">
        <div class="exercise-number">7</div>
        <div class="exercise-title">Time Zone Handling</div>
        <p>Handle time zone discrepancies in correlation</p>
      </div>
    </div>

    <!-- Exercise 1: Failed Login Correlation -->
    <div class="exercise-content" id="exercise1">
      <h2>Exercise 1: Failed Login Correlation</h2>

      <div class="scenario-box">
        <h3>Scenario</h3>
        <p>Your SIEM has flagged unusual authentication activity. You need to correlate failed login attempts across multiple systems to identify potential brute force attacks.</p>
        <p><strong>Objective:</strong> Identify which source IPs are conducting brute force attacks based on failed login patterns.</p>
      </div>

      <div class="log-panel">
        <h4>üîê Authentication Logs (Multiple Systems)</h4>
        <div class="log-entry" data-ip="203.0.113.42" data-user="admin">
          <span class="log-timestamp">10:15:22</span> [<span class="log-source">WEB-01</span>] FAIL - SSH login user=admin from=203.0.113.42
        </div>
        <div class="log-entry" data-ip="203.0.113.42" data-user="admin">
          <span class="log-timestamp">10:15:25</span> [<span class="log-source">WEB-01</span>] FAIL - SSH login user=admin from=203.0.113.42
        </div>
        <div class="log-entry" data-ip="10.0.1.50" data-user="jsmith">
          <span class="log-timestamp">10:15:30</span> [<span class="log-source">DB-01</span>] SUCCESS - Login user=jsmith from=10.0.1.50
        </div>
        <div class="log-entry" data-ip="203.0.113.42" data-user="root">
          <span class="log-timestamp">10:15:33</span> [<span class="log-source">WEB-01</span>] FAIL - SSH login user=root from=203.0.113.42
        </div>
        <div class="log-entry" data-ip="198.51.100.23" data-user="admin">
          <span class="log-timestamp">10:16:10</span> [<span class="log-source">MAIL-01</span>] FAIL - SMTP auth user=admin from=198.51.100.23
        </div>
        <div class="log-entry" data-ip="203.0.113.42" data-user="admin">
          <span class="log-timestamp">10:15:41</span> [<span class="log-source">WEB-01</span>] FAIL - SSH login user=admin from=203.0.113.42
        </div>
        <div class="log-entry" data-ip="203.0.113.42" data-user="admin">
          <span class="log-timestamp">10:15:48</span> [<span class="log-source">WEB-01</span>] FAIL - SSH login user=admin from=203.0.113.42
        </div>
        <div class="log-entry" data-ip="203.0.113.42" data-user="ubuntu">
          <span class="log-timestamp">10:15:55</span> [<span class="log-source">WEB-01</span>] FAIL - SSH login user=ubuntu from=203.0.113.42
        </div>
        <div class="log-entry" data-ip="192.0.2.15" data-user="alice">
          <span class="log-timestamp">10:16:20</span> [<span class="log-source">VPN</span>] SUCCESS - VPN login user=alice from=192.0.2.15
        </div>
        <div class="log-entry" data-ip="203.0.113.42" data-user="admin">
          <span class="log-timestamp">10:16:02</span> [<span class="log-source">WEB-01</span>] FAIL - SSH login user=admin from=203.0.113.42
        </div>
        <div class="log-entry" data-ip="203.0.113.42" data-user="admin">
          <span class="log-timestamp">10:16:18</span> [<span class="log-source">WEB-01</span>] SUCCESS - SSH login user=admin from=203.0.113.42
        </div>
        <div class="log-entry" data-ip="203.0.113.42" data-user="root">
          <span class="log-timestamp">10:18:33</span> [<span class="log-source">DB-01</span>] FAIL - SSH login user=root from=203.0.113.42
        </div>
        <div class="log-entry" data-ip="203.0.113.42" data-user="root">
          <span class="log-timestamp">10:18:40</span> [<span class="log-source">DB-01</span>] FAIL - SSH login user=root from=203.0.113.42
        </div>
      </div>

      <div class="question-box">
        <h3>Questions:</h3>
        <ol>
          <li>Which IP address(es) show brute force attack patterns?</li>
          <li>How many failed login attempts occurred before the successful login from 203.0.113.42?</li>
          <li>Is the attacker targeting multiple systems or just one?</li>
          <li>What correlation rule would you write to detect this?</li>
        </ol>
      </div>

      <div class="answer-area">
        <h3>Your Analysis:</h3>
        <textarea class="answer-input" id="answer1" placeholder="Enter your correlation analysis here..."></textarea>
      </div>

      <div class="control-buttons">
        <button onclick="checkAnswer(1)">Submit Answer</button>
        <button onclick="showHint(1)">Show Hint</button>
        <button onclick="showSolution(1)">Show Solution</button>
      </div>

      <div class="feedback" id="feedback1"></div>

      <div class="nav-buttons">
        <button onclick="closeExercise()">Back to List</button>
        <button class="primary" onclick="completeExercise(1); startExercise(2)">Complete & Next ‚Üí</button>
      </div>
    </div>

    <!-- Exercise 2: Timeline Building -->
    <div class="exercise-content" id="exercise2">
      <h2>Exercise 2: Timeline Building</h2>

      <div class="scenario-box">
        <h3>Scenario</h3>
        <p>An incident has been reported. You have logs from multiple sources with different timestamp formats. Build a chronological timeline to understand the attack sequence.</p>
        <p><strong>Objective:</strong> Arrange events in chronological order and identify the attack chain.</p>
      </div>

      <div class="correlation-workspace">
        <div class="workspace-panel">
          <h4>üìã Unsorted Events (Click to select)</h4>
          <div class="log-entry" data-time="2024-03-15T14:35:48Z" onclick="selectTimelineEvent(this)">
            <strong>Firewall:</strong> Outbound HTTPS to 185.220.101.42:443
          </div>
          <div class="log-entry" data-time="2024-03-15T14:22:15Z" onclick="selectTimelineEvent(this)">
            <strong>Email:</strong> Attachment invoice.exe delivered
          </div>
          <div class="log-entry" data-time="2024-03-15T15:30:10Z" onclick="selectTimelineEvent(this)">
            <strong>EDR:</strong> Mass file encryption detected
          </div>
          <div class="log-entry" data-time="2024-03-15T14:35:50Z" onclick="selectTimelineEvent(this)">
            <strong>IDS:</strong> Cobalt Strike beacon signature
          </div>
          <div class="log-entry" data-time="2024-03-15T14:35:44Z" onclick="selectTimelineEvent(this)">
            <strong>Endpoint:</strong> invoice.exe executed from Downloads
          </div>
          <div class="log-entry" data-time="2024-03-15T15:22:33Z" onclick="selectTimelineEvent(this)">
            <strong>File:</strong> Bulk file access (1,247 files)
          </div>
          <div class="log-entry" data-time="2024-03-15T14:36:00Z" onclick="selectTimelineEvent(this)">
            <strong>Network:</strong> Periodic beacons every 60 seconds
          </div>
        </div>

        <div class="workspace-panel">
          <h4>‚è±Ô∏è Your Timeline (Chronological Order)</h4>
          <div class="timeline-builder" id="userTimeline">
            <p style="color: #888; text-align: center;">Click events on the left to build your timeline...</p>
          </div>
          <button onclick="verifyTimeline()">Verify Timeline</button>
        </div>
      </div>

      <div class="question-box">
        <h3>Analysis Questions:</h3>
        <ol>
          <li>What was the initial attack vector?</li>
          <li>How long between initial compromise and encryption?</li>
          <li>What MITRE ATT&CK phases are represented?</li>
        </ol>
      </div>

      <div class="answer-area">
        <textarea class="answer-input" id="answer2" placeholder="Enter your timeline analysis..."></textarea>
      </div>

      <div class="control-buttons">
        <button onclick="checkAnswer(2)">Submit Analysis</button>
        <button onclick="showSolution(2)">Show Solution</button>
      </div>

      <div class="feedback" id="feedback2"></div>

      <div class="nav-buttons">
        <button onclick="closeExercise()">Back to List</button>
        <button class="primary" onclick="completeExercise(2); startExercise(3)">Complete & Next ‚Üí</button>
      </div>
    </div>

    <!-- Exercise 3: Lateral Movement Detection -->
    <div class="exercise-content" id="exercise3">
      <h2>Exercise 3: Lateral Movement Detection</h2>

      <div class="scenario-box">
        <h3>Scenario</h3>
        <p>A workstation (WS-042) has been compromised. You need to identify if the attacker performed lateral movement to other systems.</p>
        <p><strong>Objective:</strong> Correlate events to detect lateral movement and identify all affected systems.</p>
      </div>

      <div class="log-panel">
        <h4>üî• Firewall Logs</h4>
        <div class="log-entry">10:32:15 ALLOW WS-042 ‚Üí SRV-DB-01:445 (SMB)</div>
        <div class="log-entry">10:33:22 ALLOW WS-042 ‚Üí SRV-WEB-01:3389 (RDP)</div>
        <div class="log-entry">10:35:10 ALLOW WS-042 ‚Üí SRV-FILE-01:445 (SMB)</div>
        <div class="log-entry">11:15:30 ALLOW WS-042 ‚Üí DC-01:389 (LDAP)</div>
      </div>

      <div class="log-panel">
        <h4>üîê Authentication Logs</h4>
        <div class="log-entry">10:32:18 SUCCESS - Login to SRV-DB-01 from WS-042 (user: admin)</div>
        <div class="log-entry">10:33:25 SUCCESS - RDP login to SRV-WEB-01 from WS-042 (user: admin)</div>
        <div class="log-entry">10:35:12 SUCCESS - Login to SRV-FILE-01 from WS-042 (user: admin)</div>
        <div class="log-entry">11:15:35 SUCCESS - Login to DC-01 from WS-042 (user: admin)</div>
      </div>

      <div class="log-panel">
        <h4>üíª Endpoint EDR Logs</h4>
        <div class="log-entry">10:30:10 [WS-042] Credential dumping detected (Mimikatz signature)</div>
        <div class="log-entry">10:32:45 [SRV-DB-01] Unusual process: cmd.exe spawned by wmiprvse.exe</div>
        <div class="log-entry">10:33:50 [SRV-WEB-01] New scheduled task created: "WindowsUpdate"</div>
        <div class="log-entry">10:36:22 [SRV-FILE-01] PowerShell execution with encoded command</div>
        <div class="log-entry">11:16:10 [DC-01] DCSync attack detected (AD replication request)</div>
      </div>

      <div class="question-box">
        <h3>Investigation Tasks:</h3>
        <ol>
          <li>Create a lateral movement map showing the attack progression</li>
          <li>Identify the stolen credentials used for lateral movement</li>
          <li>What techniques did the attacker use on each compromised system?</li>
          <li>What is the likely objective of reaching DC-01?</li>
        </ol>
      </div>

      <div class="answer-area">
        <h3>Your Investigation:</h3>
        <textarea class="answer-input" id="answer3" placeholder="Document your lateral movement analysis..."></textarea>
      </div>

      <div class="control-buttons">
        <button onclick="checkAnswer(3)">Submit Investigation</button>
        <button onclick="showHint(3)">Show Hint</button>
        <button onclick="showSolution(3)">Show Solution</button>
      </div>

      <div class="feedback" id="feedback3"></div>

      <div class="nav-buttons">
        <button onclick="closeExercise()">Back to List</button>
        <button class="primary" onclick="completeExercise(3); startExercise(4)">Complete & Next ‚Üí</button>
      </div>
    </div>

    <!-- Exercise 4: MITRE ATT&CK Mapping -->
    <div class="exercise-content" id="exercise4">
      <h2>Exercise 4: MITRE ATT&CK Mapping</h2>

      <div class="scenario-box">
        <h3>Scenario</h3>
        <p>Map the following attack events to appropriate MITRE ATT&CK tactics and techniques. This helps standardize threat intelligence and communication.</p>
        <p><strong>Objective:</strong> Correctly categorize each event into MITRE ATT&CK framework phases.</p>
      </div>

      <div class="killchain-mapper">
        <div class="killchain-phase" data-phase="initial-access">
          <h4>Initial Access (TA0001)</h4>
          <p>How the attacker gained initial entry</p>
          <div class="phase-drop-zone" id="phase-initial-access"></div>
        </div>

        <div class="killchain-phase" data-phase="execution">
          <h4>Execution (TA0002)</h4>
          <p>Running malicious code</p>
          <div class="phase-drop-zone" id="phase-execution"></div>
        </div>

        <div class="killchain-phase" data-phase="persistence">
          <h4>Persistence (TA0003)</h4>
          <p>Maintaining presence in the system</p>
          <div class="phase-drop-zone" id="phase-persistence"></div>
        </div>

        <div class="killchain-phase" data-phase="credential-access">
          <h4>Credential Access (TA0006)</h4>
          <p>Stealing credentials</p>
          <div class="phase-drop-zone" id="phase-credential-access"></div>
        </div>

        <div class="killchain-phase" data-phase="lateral-movement">
          <h4>Lateral Movement (TA0008)</h4>
          <p>Moving through the network</p>
          <div class="phase-drop-zone" id="phase-lateral-movement"></div>
        </div>

        <div class="killchain-phase" data-phase="exfiltration">
          <h4>Exfiltration (TA0010)</h4>
          <p>Stealing data</p>
          <div class="phase-drop-zone" id="phase-exfiltration"></div>
        </div>
      </div>

      <div class="log-panel">
        <h4>üéØ Events to Categorize (Click and drag to phases above)</h4>
        <div class="log-entry" draggable="true" data-correct="initial-access">
          Phishing email with malicious attachment delivered
        </div>
        <div class="log-entry" draggable="true" data-correct="execution">
          PowerShell script executed with encoded payload
        </div>
        <div class="log-entry" draggable="true" data-correct="persistence">
          Registry Run key created: HKLM\...\Run\WindowsUpdate
        </div>
        <div class="log-entry" draggable="true" data-correct="credential-access">
          LSASS memory dump detected (Mimikatz)
        </div>
        <div class="log-entry" draggable="true" data-correct="lateral-movement">
          RDP connection from compromised workstation to server
        </div>
        <div class="log-entry" draggable="true" data-correct="exfiltration">
          2.3GB upload to external cloud storage
        </div>
      </div>

      <div class="control-buttons">
        <button onclick="checkMitreMapping()">Check Mapping</button>
        <button onclick="resetMitreMapping()">Reset</button>
        <button onclick="showSolution(4)">Show Solution</button>
      </div>

      <div class="feedback" id="feedback4"></div>

      <div class="nav-buttons">
        <button onclick="closeExercise()">Back to List</button>
        <button class="primary" onclick="completeExercise(4); startExercise(5)">Complete & Next ‚Üí</button>
      </div>
    </div>

    <!-- Exercise 5: Writing Correlation Rules -->
    <div class="exercise-content" id="exercise5">
      <h2>Exercise 5: Writing Correlation Rules</h2>

      <div class="scenario-box">
        <h3>Scenario</h3>
        <p>You need to write SIEM correlation rules to detect specific attack patterns. Write rules using proper syntax and logic.</p>
        <p><strong>Objective:</strong> Create effective correlation rules for three different scenarios.</p>
      </div>

      <div class="question-box">
        <h3>Rule 1: Detect Successful Brute Force</h3>
        <p>Detect when an attacker successfully logs in after multiple failed attempts from the same IP.</p>
        <textarea class="answer-input" id="rule1" placeholder="Write your correlation rule here...

Example format:
IF (condition)
  FOLLOWED BY
  another_condition
  WITHIN time_window
THEN alert"></textarea>
      </div>

      <div class="question-box">
        <h3>Rule 2: Detect Data Exfiltration</h3>
        <p>Detect when a user transfers unusually large amounts of data to external sites.</p>
        <textarea class="answer-input" id="rule2" placeholder="Write your correlation rule..."></textarea>
      </div>

      <div class="question-box">
        <h3>Rule 3: Detect Credential Theft + Lateral Movement</h3>
        <p>Detect credential dumping followed by connections to multiple internal systems.</p>
        <textarea class="answer-input" id="rule3" placeholder="Write your correlation rule..."></textarea>
      </div>

      <div class="control-buttons">
        <button onclick="checkRules()">Check All Rules</button>
        <button onclick="showSolution(5)">Show Solutions</button>
      </div>

      <div class="feedback" id="feedback5"></div>

      <div class="nav-buttons">
        <button onclick="closeExercise()">Back to List</button>
        <button class="primary" onclick="completeExercise(5); startExercise(6)">Complete & Next ‚Üí</button>
      </div>
    </div>

    <!-- Exercise 6: Multi-Stage Attack Investigation -->
    <div class="exercise-content" id="exercise6">
      <h2>Exercise 6: Multi-Stage Attack Investigation</h2>

      <div class="scenario-box">
        <h3>Scenario</h3>
        <p>A sophisticated APT attack has been detected. You have 8 days worth of logs. Correlate events to build a complete attack narrative.</p>
        <p><strong>Objective:</strong> Identify all attack stages, techniques used, and create a comprehensive incident report.</p>
      </div>

      <div class="log-panel">
        <h4>üìÖ Day 1 Logs</h4>
        <div class="log-entry">14:23:17 [Email] Spearphishing email to CFO</div>
        <div class="log-entry">14:31:05 [Endpoint] Excel macro enabled by user</div>
        <div class="log-entry">14:31:22 [EDR] Suspicious PowerShell download from 185.220.101.42</div>
        <div class="log-entry">14:32:01 [Registry] New Run key added</div>
        <div class="log-entry">14:35:12 [Network] HTTPS connection to 185.220.101.42:443 established</div>
      </div>

      <div class="log-panel">
        <h4>üìÖ Day 2-7 Logs</h4>
        <div class="log-entry">Day 2-7 [Network] Periodic C2 beacons every 4 hours to 185.220.101.42</div>
        <div class="log-entry">Day 3 15:12:33 [EDR] Network enumeration commands detected</div>
        <div class="log-entry">Day 5 02:15:44 [Auth] Admin login from CFO workstation (unusual time)</div>
      </div>

      <div class="log-panel">
        <h4>üìÖ Day 8 Logs</h4>
        <div class="log-entry">02:15:44 [Auth] Admin account login from WS-CFO</div>
        <div class="log-entry">02:18:20 [Network] SMB connections to 15 servers from WS-CFO</div>
        <div class="log-entry">02:22:55 [File] New file on \\FileServer\Share\update.exe</div>
        <div class="log-entry">03:00:00 [Multiple] update.exe executed on 47 systems</div>
        <div class="log-entry">03:00:15 [EDR] Mass file encryption detected across network</div>
        <div class="log-entry">03:45:22 [File] Ransom notes created in all directories</div>
      </div>

      <div class="question-box">
        <h3>Investigation Questions:</h3>
        <ol>
          <li>What is the complete attack timeline (initial access to impact)?</li>
          <li>What was the dwell time (time attacker was in network before detection)?</li>
          <li>Map all events to MITRE ATT&CK kill chain</li>
          <li>What detection opportunities were missed?</li>
          <li>Write an executive summary of the incident</li>
        </ol>
      </div>

      <div class="answer-area">
        <h3>Your Complete Investigation Report:</h3>
        <textarea class="answer-input" id="answer6" style="min-height: 200px;" placeholder="Write your comprehensive investigation report..."></textarea>
      </div>

      <div class="control-buttons">
        <button onclick="checkAnswer(6)">Submit Report</button>
        <button onclick="showHint(6)">Show Hint</button>
        <button onclick="showSolution(6)">Show Solution</button>
      </div>

      <div class="feedback" id="feedback6"></div>

      <div class="nav-buttons">
        <button onclick="closeExercise()">Back to List</button>
        <button class="primary" onclick="completeExercise(6); startExercise(7)">Complete & Next ‚Üí</button>
      </div>
    </div>

    <!-- Exercise 7: Time Zone Handling -->
    <div class="exercise-content" id="exercise7">
      <h2>Exercise 7: Time Zone Handling</h2>

      <div class="scenario-box">
        <h3>Scenario</h3>
        <p>Your organization has offices in New York (EST), London (GMT), and Tokyo (JST). Logs from different locations have different time zones. Normalize and correlate them.</p>
        <p><strong>Objective:</strong> Convert all timestamps to UTC and determine the correct event sequence.</p>
      </div>

      <div class="log-panel">
        <h4>üåç Multi-Timezone Logs</h4>
        <div class="log-entry" data-tz="EST" data-time="10:15:22">
          <strong>[New York - EST]</strong> 10:15:22 - Failed VPN login from 203.0.113.42
        </div>
        <div class="log-entry" data-tz="GMT" data-time="15:18:10">
          <strong>[London - GMT]</strong> 15:18:10 - Failed email login from 203.0.113.42
        </div>
        <div class="log-entry" data-tz="JST" data-time="00:22:45">
          <strong>[Tokyo - JST]</strong> 00:22:45 - Successful login from 203.0.113.42
        </div>
        <div class="log-entry" data-tz="EST" data-time="10:20:15">
          <strong>[New York - EST]</strong> 10:20:15 - File access: Confidential_Data.zip
        </div>
        <div class="log-entry" data-tz="GMT" data-time="15:22:50">
          <strong>[London - GMT]</strong> 15:22:50 - Large file upload detected
        </div>
      </div>

      <div class="question-box">
        <h3>Time Zone Reference:</h3>
        <ul>
          <li>EST (Eastern): UTC -5 hours</li>
          <li>GMT (Greenwich): UTC +0 hours</li>
          <li>JST (Japan): UTC +9 hours</li>
        </ul>

        <h3>Tasks:</h3>
        <ol>
          <li>Convert all timestamps to UTC</li>
          <li>Arrange events in chronological order</li>
          <li>Identify the attack progression</li>
          <li>Calculate time between first and last event</li>
        </ol>
      </div>

      <div class="answer-area">
        <h3>Your Normalized Timeline (in UTC):</h3>
        <textarea class="answer-input" id="answer7" placeholder="List events in chronological order with UTC timestamps...

Example format:
15:15:22 UTC - [New York] Failed VPN login
..."></textarea>
      </div>

      <div class="control-buttons">
        <button onclick="checkAnswer(7)">Submit Timeline</button>
        <button onclick="showHint(7)">Show Hint</button>
        <button onclick="showSolution(7)">Show Solution</button>
      </div>

      <div class="feedback" id="feedback7"></div>

      <div class="nav-buttons">
        <button onclick="closeExercise()">Back to List</button>
        <button class="primary" onclick="completeExercise(7)">Complete Lab</button>
      </div>
    </div>
  </div>

  <script>
    let completedExercises = new Set();
    let selectedTimelineEvents = [];

    function startExercise(num) {
      document.querySelectorAll('.exercise-content').forEach(ex => ex.classList.remove('active'));
      document.querySelectorAll('.exercise-card').forEach(card => card.classList.remove('active'));

      document.getElementById(`exercise${num}`).classList.add('active');
      document.querySelectorAll('.exercise-card')[num - 1].classList.add('active');

      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function closeExercise() {
      document.querySelectorAll('.exercise-content').forEach(ex => ex.classList.remove('active'));
      document.querySelectorAll('.exercise-card').forEach(card => card.classList.remove('active'));
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function completeExercise(num) {
      completedExercises.add(num);
      document.querySelectorAll('.exercise-card')[num - 1].classList.add('completed');
      updateProgress();
    }

    function updateProgress() {
      const total = 7;
      const completed = completedExercises.size;
      const percentage = Math.round((completed / total) * 100);

      const progressBar = document.getElementById('progressBar');
      progressBar.style.width = percentage + '%';
      progressBar.textContent = `${percentage}% Complete (${completed}/${total})`;

      if (completed === total) {
        setTimeout(() => {
          alert('üéâ Congratulations! You\'ve completed the Log Correlation Lab!\n\nYou\'ve mastered practical correlation techniques.');
        }, 500);
      }
    }

    function checkAnswer(exerciseNum) {
      const answerId = `answer${exerciseNum}`;
      const answer = document.getElementById(answerId)?.value.trim();

      if (!answer || answer.length < 20) {
        showFeedback(exerciseNum, 'incorrect', 'Please provide a more detailed answer before submitting.');
        return;
      }

      showFeedback(exerciseNum, 'correct', '‚úì Good analysis! Review the solution to compare your approach.');
    }

    function showHint(exerciseNum) {
      const hints = {
        1: 'Look for IP addresses with multiple failed login attempts in a short time window. Count how many failures occurred before the successful login from 203.0.113.42. A correlation rule should use COUNT and FOLLOWED BY operators.',
        3: 'Start with the credential dumping on WS-042, then trace the admin account being used to connect to other systems. Each system shows different post-compromise activities.',
        6: 'Calculate dwell time from Day 1 initial compromise (14:23) to Day 8 impact (03:00). That\'s approximately 7 days 13 hours.',
        7: 'Convert EST times by adding 5 hours, GMT times stay the same, JST times by subtracting 9 hours to get UTC.'
      };

      showFeedback(exerciseNum, 'hint', `üí° Hint: ${hints[exerciseNum] || 'Review the scenario carefully and look for patterns in the logs.'}`);
    }

    function showSolution(exerciseNum) {
      const solutions = {
        1: `SOLUTION:

1. Brute Force IP: 203.0.113.42
   - 6 failed login attempts (10:15:22 to 10:16:02)
   - 1 successful login at 10:16:18
   - Total time: ~56 seconds

2. Failed attempts before success: 6

3. Targeting: Initially WEB-01, then moved to DB-01 (lateral movement)

4. Correlation Rule:
IF (
  COUNT(failed_login) >= 5
  WHERE source_ip = SAME AND username = SAME
  WITHIN 5 minutes

  FOLLOWED BY

  successful_login
  WHERE source_ip = SAME AND username = SAME
  WITHIN 5 minutes
)
THEN
  alert = "Successful brute force attack"
  severity = "HIGH"`,

        2: `SOLUTION:

Chronological Timeline (UTC):
1. 14:22:15 - Email: invoice.exe delivered (Initial Access)
2. 14:35:44 - Endpoint: invoice.exe executed (Execution)
3. 14:35:48 - Firewall: Outbound HTTPS connection (C2)
4. 14:35:50 - IDS: Cobalt Strike beacon (C2 Confirmed)
5. 14:36:00 - Network: Periodic beacons (C2 Communication)
6. 15:22:33 - File: Bulk file access (Collection)
7. 15:30:10 - EDR: Mass encryption (Impact)

Analysis:
- Initial vector: Phishing email
- Time to encryption: 1 hour 8 minutes
- MITRE ATT&CK: Initial Access ‚Üí Execution ‚Üí C2 ‚Üí Collection ‚Üí Impact`,

        3: `SOLUTION:

Lateral Movement Map:
WS-042 (compromised) ‚Üí SRV-DB-01 ‚Üí SRV-WEB-01 ‚Üí SRV-FILE-01 ‚Üí DC-01

Timeline:
1. 10:30:10 - Credential dumping on WS-042 (stole admin credentials)
2. 10:32:15-18 - SMB connection + login to SRV-DB-01
3. 10:33:22-25 - RDP to SRV-WEB-01
4. 10:35:10-12 - SMB to SRV-FILE-01
5. 11:15:30-35 - LDAP connection to DC-01 (Domain Controller)

Techniques Used:
- WS-042: Credential Access (T1003 - Mimikatz)
- SRV-DB-01: WMI execution
- SRV-WEB-01: Scheduled task persistence
- SRV-FILE-01: PowerShell execution
- DC-01: DCSync (AD credential theft)

Objective: Reaching DC-01 allows the attacker to:
- Dump all domain credentials
- Create persistent backdoor accounts
- Achieve complete domain compromise`,

        4: `SOLUTION:

MITRE ATT&CK Mapping:
- Initial Access: Phishing email with attachment (T1566.001)
- Execution: PowerShell script (T1059.001)
- Persistence: Registry Run key (T1547.001)
- Credential Access: LSASS dump/Mimikatz (T1003.001)
- Lateral Movement: RDP connection (T1021.001)
- Exfiltration: Upload to cloud storage (T1567.002)`,

        5: `SOLUTION:

Rule 1: Successful Brute Force
IF (
  COUNT(failed_login) >= 5
  WHERE source_ip = SAME AND username = SAME
  WITHIN 10 minutes

  FOLLOWED BY

  successful_login
  WHERE source_ip = SAME AND username = SAME
  WITHIN 5 minutes
)
THEN alert = "Successful brute force attack"

Rule 2: Data Exfiltration
IF (
  outbound_data_transfer > user_baseline_avg * 3
  AND destination_ip NOT IN internal_networks
  AND file_size > 1GB
  WITHIN 1 hour
)
THEN alert = "Potential data exfiltration"

Rule 3: Credential Theft + Lateral Movement
IF (
  credential_dumping_detected ON host_A

  FOLLOWED BY

  COUNT(internal_connections) >= 3
  WHERE source_host = host_A
  AND destination_port IN (445, 3389, 22)
  WITHIN 30 minutes
)
THEN alert = "Lateral movement after credential theft"`,

        6: `SOLUTION:

INCIDENT REPORT: Ransomware Attack via Spearphishing

Timeline:
Day 1, 14:23:17 - Initial compromise via spearphishing
Day 1, 14:31:05 - Macro execution, malware deployed
Day 1, 14:32:01 - Persistence established
Day 1, 14:35:12 - C2 communication begins
Day 2-7 - Reconnaissance and planning (patient attacker)
Day 8, 02:15:44 - Lateral movement begins
Day 8, 03:00:00 - Ransomware deployed network-wide
Day 8, 03:45:22 - Ransom demands delivered

Dwell Time: 7 days, 13 hours, 22 minutes

MITRE ATT&CK Mapping:
- TA0001 Initial Access: T1566.001 (Spearphishing)
- TA0002 Execution: T1204.002 (Malicious File)
- TA0003 Persistence: T1547.001 (Registry)
- TA0007 Discovery: T1018 (Network enumeration)
- TA0008 Lateral Movement: T1021.002 (SMB)
- TA0040 Impact: T1486 (Ransomware)

Missed Detection Opportunities:
1. Day 1, 14:31:22 - Suspicious PowerShell download (should have triggered alert)
2. Day 5, 02:15:44 - Off-hours admin login (baseline deviation)
3. Day 8, 02:18:20 - Mass SMB connections (clear lateral movement)

Executive Summary:
A sophisticated ransomware attack compromised 47 systems after a 7-day dwell time. The attacker used spearphishing to gain initial access, established persistence, and patiently conducted reconnaissance before executing a coordinated ransomware deployment. Critical detection gaps allowed the attacker to operate undetected during the reconnaissance phase.`,

        7: `SOLUTION:

Normalized Timeline (UTC):
1. 15:15:22 UTC - [New York EST] Failed VPN login from 203.0.113.42
2. 15:18:10 UTC - [London GMT] Failed email login from 203.0.113.42
3. 15:20:15 UTC - [New York EST] File access: Confidential_Data.zip
4. 15:22:45 UTC - [Tokyo JST] Successful login from 203.0.113.42
5. 15:22:50 UTC - [London GMT] Large file upload detected

Time Calculations:
- New York 10:15:22 EST = 15:15:22 UTC (10:15:22 + 5 hours)
- London 15:18:10 GMT = 15:18:10 UTC (no change)
- New York 10:20:15 EST = 15:20:15 UTC (10:20:15 + 5 hours)
- Tokyo 00:22:45 JST = 15:22:45 UTC (00:22:45 - 9 hours + 24 hours)
- London 15:22:50 GMT = 15:22:50 UTC (no change)

Attack Analysis:
- Total attack duration: 7 minutes 28 seconds (15:15:22 to 15:22:50 UTC)
- Attacker targeted multiple global offices
- Successfully compromised Tokyo office after failed attempts in NY and London
- Data exfiltration occurred immediately after successful login

This demonstrates the importance of time normalization in correlation!`
      };

      showFeedback(exerciseNum, 'correct', solutions[exerciseNum] || 'Solution not available.');
    }

    function showFeedback(exerciseNum, type, message) {
      const feedback = document.getElementById(`feedback${exerciseNum}`);
      feedback.className = `feedback ${type}`;
      feedback.innerHTML = message.replace(/\n/g, '<br>');
    }

    // Timeline Builder Functions
    function selectTimelineEvent(element) {
      const time = element.getAttribute('data-time');
      const text = element.textContent.trim();

      selectedTimelineEvents.push({ time, text });
      element.style.opacity = '0.5';
      element.style.pointerEvents = 'none';

      updateUserTimeline();
    }

    function updateUserTimeline() {
      const timeline = document.getElementById('userTimeline');

      if (selectedTimelineEvents.length === 0) {
        timeline.innerHTML = '<p style="color: #888; text-align: center;">Click events on the left to build your timeline...</p>';
        return;
      }

      timeline.innerHTML = '<div class="timeline">' +
        selectedTimelineEvents.map(event => `
          <div class="timeline-item">
            <strong>${new Date(event.time).toLocaleTimeString()}</strong><br>
            ${event.text}
          </div>
        `).join('') +
        '</div>';
    }

    function verifyTimeline() {
      const sorted = [...selectedTimelineEvents].sort((a, b) =>
        new Date(a.time) - new Date(b.time)
      );

      const isCorrect = JSON.stringify(selectedTimelineEvents) === JSON.stringify(sorted);

      if (isCorrect) {
        showFeedback(2, 'correct', '‚úì Perfect! Your timeline is in correct chronological order.');
      } else {
        showFeedback(2, 'incorrect', '‚úó The timeline is not in correct chronological order. Try rearranging the events.');
      }
    }

    // Rule checking
    function checkRules() {
      const rule1 = document.getElementById('rule1').value;
      const rule2 = document.getElementById('rule2').value;
      const rule3 = document.getElementById('rule3').value;

      let feedback = '';
      let allGood = true;

      if (rule1.includes('FOLLOWED BY') && rule1.includes('WITHIN')) {
        feedback += '‚úì Rule 1: Good structure with temporal logic<br>';
      } else {
        feedback += '‚úó Rule 1: Missing temporal operators (FOLLOWED BY, WITHIN)<br>';
        allGood = false;
      }

      if (rule2.includes('baseline') || rule2.includes('>')) {
        feedback += '‚úì Rule 2: Includes baseline comparison<br>';
      } else {
        feedback += '‚úó Rule 2: Should compare against baseline or threshold<br>';
        allGood = false;
      }

      if (rule3.includes('credential') && rule3.includes('connection')) {
        feedback += '‚úì Rule 3: Correlates credential access with network activity<br>';
      } else {
        feedback += '‚úó Rule 3: Should correlate credential theft with lateral movement<br>';
        allGood = false;
      }

      showFeedback(5, allGood ? 'correct' : 'hint', feedback);
    }

    // MITRE ATT&CK mapping
    function checkMitreMapping() {
      showFeedback(4, 'correct', '‚úì Good mapping! Review the solution to see the specific technique IDs (T-numbers) for each event.');
    }

    function resetMitreMapping() {
      document.querySelectorAll('.killchain-phase').forEach(phase => {
        phase.classList.remove('mapped');
      });
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      console.log('Correlation Lab initialized');
    });
  </script>
</body>
</html>