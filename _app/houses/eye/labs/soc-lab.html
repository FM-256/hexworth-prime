<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOC Lab - Eye House - Hexworth Prime</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0a1e 0%, #1a0b2e 100%);
            color: #e0e0e0;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #c084fc 0%, #06b6d4 100%);
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(192, 132, 252, 0.3);
        }

        h1 {
            font-size: 2.5em;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2em;
            color: #f0f0f0;
            margin-top: 10px;
        }

        .lab-nav {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .lab-card {
            background: linear-gradient(135deg, rgba(192, 132, 252, 0.2) 0%, rgba(6, 182, 212, 0.2) 100%);
            border: 2px solid rgba(192, 132, 252, 0.4);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .lab-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(192, 132, 252, 0.3);
            border-color: #c084fc;
        }

        .lab-card.completed {
            border-color: #22c55e;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(22, 163, 74, 0.2) 100%);
        }

        .lab-card.active {
            border-color: #06b6d4;
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.3) 0%, rgba(192, 132, 252, 0.3) 100%);
        }

        .lab-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .lab-title {
            color: #c084fc;
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 8px;
        }

        .lab-status {
            font-size: 0.85em;
            color: #06b6d4;
        }

        .lab-content {
            display: none;
            background: rgba(30, 20, 50, 0.6);
            border-radius: 15px;
            padding: 40px;
            border: 2px solid rgba(192, 132, 252, 0.3);
            backdrop-filter: blur(10px);
            animation: slideIn 0.5s ease-out;
        }

        .lab-content.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h2 {
            color: #c084fc;
            font-size: 2em;
            margin-bottom: 20px;
            border-bottom: 3px solid #06b6d4;
            padding-bottom: 10px;
        }

        h3 {
            color: #06b6d4;
            font-size: 1.5em;
            margin: 25px 0 15px 0;
        }

        .objective-box {
            background: linear-gradient(135deg, rgba(192, 132, 252, 0.15) 0%, rgba(6, 182, 212, 0.15) 100%);
            border-left: 4px solid #c084fc;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .scenario-box {
            background: rgba(6, 182, 212, 0.1);
            border: 2px solid #06b6d4;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }

        .alert-item {
            background: rgba(192, 132, 252, 0.1);
            border: 2px solid rgba(192, 132, 252, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            transition: all 0.3s ease;
        }

        .alert-item:hover {
            border-color: #c084fc;
            background: rgba(192, 132, 252, 0.15);
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .alert-id {
            font-family: 'Courier New', monospace;
            color: #06b6d4;
            font-weight: bold;
        }

        .severity-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.85em;
        }

        .severity-critical { background: #ef4444; color: white; }
        .severity-high { background: #f97316; color: white; }
        .severity-medium { background: #fbbf24; color: #1a0b2e; }
        .severity-low { background: #22c55e; color: white; }

        .priority-selector {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .priority-btn {
            padding: 8px 16px;
            background: rgba(192, 132, 252, 0.2);
            border: 2px solid rgba(192, 132, 252, 0.4);
            border-radius: 8px;
            color: #c084fc;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .priority-btn:hover {
            background: rgba(192, 132, 252, 0.3);
        }

        .priority-btn.selected {
            background: linear-gradient(135deg, #c084fc 0%, #a855f7 100%);
            color: white;
            border-color: #c084fc;
        }

        .answer-input {
            width: 100%;
            padding: 15px;
            background: rgba(20, 15, 35, 0.8);
            border: 2px solid rgba(192, 132, 252, 0.3);
            border-radius: 10px;
            color: #e0e0e0;
            font-family: 'Segoe UI', sans-serif;
            font-size: 1em;
            margin: 10px 0;
            resize: vertical;
        }

        .answer-input:focus {
            outline: none;
            border-color: #06b6d4;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-primary {
            background: linear-gradient(135deg, #c084fc 0%, #a855f7 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }

        .feedback-box {
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            display: none;
        }

        .feedback-box.correct {
            display: block;
            background: rgba(34, 197, 94, 0.2);
            border: 2px solid #22c55e;
            color: #22c55e;
        }

        .feedback-box.incorrect {
            display: block;
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
            color: #ef4444;
        }

        .feedback-box.info {
            display: block;
            background: rgba(6, 182, 212, 0.2);
            border: 2px solid #06b6d4;
            color: #06b6d4;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }

        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(192, 132, 252, 0.2);
            border: 2px solid rgba(192, 132, 252, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #c084fc;
        }

        .step.active {
            background: linear-gradient(135deg, #c084fc 0%, #a855f7 100%);
            color: white;
            border-color: #c084fc;
        }

        .step.completed {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            border-color: #22c55e;
        }

        .timeline-builder {
            background: rgba(20, 15, 35, 0.8);
            border: 2px solid #06b6d4;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }

        .timeline-event {
            background: rgba(192, 132, 252, 0.1);
            border-left: 3px solid #06b6d4;
            padding: 12px;
            margin: 10px 0 10px 20px;
            border-radius: 5px;
            cursor: move;
        }

        .timeline-event.dragging {
            opacity: 0.5;
        }

        .drop-zone {
            min-height: 60px;
            background: rgba(6, 182, 212, 0.1);
            border: 2px dashed rgba(6, 182, 212, 0.3);
            border-radius: 8px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #06b6d4;
        }

        .drop-zone.over {
            background: rgba(6, 182, 212, 0.2);
            border-color: #06b6d4;
        }

        .metric-card {
            background: linear-gradient(135deg, rgba(192, 132, 252, 0.15) 0%, rgba(6, 182, 212, 0.15) 100%);
            border: 2px solid rgba(192, 132, 252, 0.4);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin: 15px 0;
        }

        .metric-value {
            font-size: 2.5em;
            color: #06b6d4;
            font-weight: bold;
        }

        .metric-label {
            color: #c084fc;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .code-block {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid #c084fc;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            font-size: 0.9em;
        }

        .checklist {
            list-style: none;
            margin-left: 0;
        }

        .checklist li {
            padding: 10px;
            margin: 8px 0;
            background: rgba(192, 132, 252, 0.1);
            border-left: 3px solid #06b6d4;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checklist li:hover {
            background: rgba(192, 132, 252, 0.2);
        }

        .checklist li.checked {
            background: rgba(34, 197, 94, 0.2);
            border-left-color: #22c55e;
            text-decoration: line-through;
            opacity: 0.7;
        }

        .checklist li::before {
            content: '‚òê';
            margin-right: 10px;
            font-size: 1.2em;
            color: #06b6d4;
        }

        .checklist li.checked::before {
            content: '‚òë';
            color: #22c55e;
        }

        .progress-bar {
            background: rgba(192, 132, 252, 0.2);
            border-radius: 10px;
            height: 30px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(135deg, #c084fc 0%, #06b6d4 100%);
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .lab-nav {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div style="font-size: 3em; margin-bottom: 10px;">üî¨</div>
            <h1>SOC Operations Lab</h1>
            <p class="subtitle">Hands-On Security Operations Center Exercises</p>
            <p class="subtitle">Eye House - Detection & Visibility</p>
        </header>

        <div class="progress-bar">
            <div class="progress-fill" id="overallProgress" style="width: 0%">0 / 7 Labs Completed</div>
        </div>

        <div class="lab-nav" id="labNav">
            <!-- Lab cards will be generated by JavaScript -->
        </div>

        <div id="labContent">
            <!-- Lab content will be loaded here -->
        </div>
    </div>

    <script>
        // Lab definitions
        const labs = [
            {
                id: 'lab1',
                title: 'Alert Queue Prioritization',
                icon: 'üìä',
                objective: 'Learn to prioritize and triage a realistic alert queue based on severity, impact, and urgency.',
                completed: false
            },
            {
                id: 'lab2',
                title: 'Phishing Investigation',
                icon: 'üé£',
                objective: 'Conduct a complete phishing email investigation from initial triage through user impact assessment.',
                completed: false
            },
            {
                id: 'lab3',
                title: 'Escalation Decision Making',
                icon: 'üìà',
                objective: 'Practice making escalation decisions for ambiguous security alerts.',
                completed: false
            },
            {
                id: 'lab4',
                title: 'Shift Handoff Report',
                icon: 'üîÑ',
                objective: 'Write a professional shift handoff report documenting incidents and ongoing investigations.',
                completed: false
            },
            {
                id: 'lab5',
                title: 'Runbook Execution',
                icon: 'üìñ',
                objective: 'Follow a runbook step-by-step to investigate a malware detection alert.',
                completed: false
            },
            {
                id: 'lab6',
                title: 'Multi-Alert Correlation',
                icon: 'üîó',
                objective: 'Handle multiple simultaneous alerts and determine which are part of a coordinated attack.',
                completed: false
            },
            {
                id: 'lab7',
                title: 'SOC Metrics Analysis',
                icon: 'üìâ',
                objective: 'Calculate and interpret key SOC metrics (MTTD, MTTR, alert volume) to identify performance issues.',
                completed: false
            }
        ];

        let currentLab = null;

        // Initialize
        function init() {
            renderLabNav();
            updateOverallProgress();
        }

        // Render lab navigation
        function renderLabNav() {
            const nav = document.getElementById('labNav');
            nav.innerHTML = labs.map(lab => `
                <div class="lab-card ${lab.completed ? 'completed' : ''}" onclick="loadLab('${lab.id}')">
                    <div class="lab-icon">${lab.icon}</div>
                    <div class="lab-title">${lab.title}</div>
                    <div class="lab-status">${lab.completed ? '‚úÖ Completed' : 'Not Started'}</div>
                </div>
            `).join('');
        }

        // Load lab content
        function loadLab(labId) {
            currentLab = labs.find(l => l.id === labId);
            const content = document.getElementById('labContent');

            // Remove active class from all lab cards
            document.querySelectorAll('.lab-card').forEach(c => c.classList.remove('active'));
            // Add active class to current lab
            const labIndex = labs.findIndex(l => l.id === labId);
            document.querySelectorAll('.lab-card')[labIndex].classList.add('active');

            // Load specific lab content
            if (labId === 'lab1') loadLab1();
            else if (labId === 'lab2') loadLab2();
            else if (labId === 'lab3') loadLab3();
            else if (labId === 'lab4') loadLab4();
            else if (labId === 'lab5') loadLab5();
            else if (labId === 'lab6') loadLab6();
            else if (labId === 'lab7') loadLab7();

            // Scroll to content
            content.scrollIntoView({ behavior: 'smooth' });
        }

        // Lab 1: Alert Queue Prioritization
        function loadLab1() {
            const content = document.getElementById('labContent');
            content.innerHTML = `
                <div class="lab-content active">
                    <h2>üìä Lab 1: Alert Queue Prioritization</h2>

                    <div class="objective-box">
                        <h3 style="color: #c084fc; margin-top: 0;">Objective</h3>
                        <p>${currentLab.objective}</p>
                    </div>

                    <div class="scenario-box">
                        <h3 style="margin-top: 0;">Scenario</h3>
                        <p>You're starting your shift and find 10 alerts in the queue. You need to prioritize them in the correct order based on severity, potential impact, and time-sensitivity.</p>
                        <p><strong>Time Available:</strong> 2 hours</p>
                        <p><strong>Task:</strong> Rank these alerts from highest priority (1) to lowest priority (10).</p>
                    </div>

                    <div id="alertList">
                        <!-- Alerts will be populated here -->
                    </div>

                    <button class="btn btn-primary" onclick="checkPrioritization()">Submit Prioritization</button>
                    <div id="feedback1" class="feedback-box"></div>
                </div>
            `;

            const alerts = [
                {
                    id: 'A',
                    severity: 'critical',
                    title: 'Active Ransomware Encryption on File Server',
                    description: 'Files being encrypted on FILESVR-01. 500+ files affected in 2 minutes.',
                    priority: null,
                    correctPriority: 1
                },
                {
                    id: 'B',
                    severity: 'high',
                    title: 'CEO Account - Impossible Travel Alert',
                    description: 'CEO logged in from USA and China within 15 minutes.',
                    priority: null,
                    correctPriority: 2
                },
                {
                    id: 'C',
                    severity: 'medium',
                    title: 'Failed Login Attempts - Generic User',
                    description: '8 failed login attempts for user jsmith from office IP.',
                    priority: null,
                    correctPriority: 7
                },
                {
                    id: 'D',
                    severity: 'high',
                    title: 'Data Exfiltration - 2GB Upload to Dropbox',
                    description: 'Finance user uploaded confidential files to personal Dropbox.',
                    priority: null,
                    correctPriority: 3
                },
                {
                    id: 'E',
                    severity: 'low',
                    title: 'Antivirus - PUA Detected and Quarantined',
                    description: 'Potentially unwanted application quarantined on marketing workstation.',
                    priority: null,
                    correctPriority: 9
                },
                {
                    id: 'F',
                    severity: 'medium',
                    title: 'SQL Injection Attempt Blocked by WAF',
                    description: 'Web application firewall blocked SQL injection from external IP.',
                    priority: null,
                    correctPriority: 6
                },
                {
                    id: 'G',
                    severity: 'critical',
                    title: 'C2 Beaconing - Domain Controller',
                    description: 'Regular beaconing to known C2 server from DC01.',
                    priority: null,
                    correctPriority: 1
                },
                {
                    id: 'H',
                    severity: 'medium',
                    title: 'Malware Quarantined Before Execution',
                    description: 'EDR quarantined malware before it could execute. User notified.',
                    priority: null,
                    correctPriority: 8
                },
                {
                    id: 'I',
                    severity: 'high',
                    title: 'Privileged Account - Lateral Movement Detected',
                    description: 'Admin account accessed 15 servers in 5 minutes via RDP.',
                    priority: null,
                    correctPriority: 4
                },
                {
                    id: 'J',
                    severity: 'low',
                    title: 'Scheduled Vulnerability Scan - IT Security',
                    description: 'Automated security scan generating IDS alerts.',
                    priority: null,
                    correctPriority: 10
                }
            ];

            const alertList = document.getElementById('alertList');
            alertList.innerHTML = alerts.map(alert => `
                <div class="alert-item">
                    <div class="alert-header">
                        <span class="alert-id">Alert ${alert.id}</span>
                        <span class="severity-badge severity-${alert.severity}">${alert.severity.toUpperCase()}</span>
                    </div>
                    <h3 style="color: #c084fc; margin: 10px 0;">${alert.title}</h3>
                    <p style="color: #b0b0b0; margin-bottom: 15px;">${alert.description}</p>
                    <div>
                        <label style="color: #06b6d4; font-weight: bold;">Priority (1-10):</label>
                        <input type="number" min="1" max="10" class="answer-input" id="priority-${alert.id}"
                               style="width: 100px; display: inline-block; margin-left: 10px;"
                               placeholder="1-10">
                    </div>
                </div>
            `).join('');

            window.lab1Alerts = alerts;
        }

        function checkPrioritization() {
            const alerts = window.lab1Alerts;
            let correct = 0;
            let feedback = '<h3 style="color: #c084fc;">Prioritization Results:</h3>';

            alerts.forEach(alert => {
                const userPriority = parseInt(document.getElementById(`priority-${alert.id}`).value);
                alert.priority = userPriority;

                const diff = Math.abs(userPriority - alert.correctPriority);
                if (diff === 0) {
                    correct++;
                    feedback += `<p>‚úÖ <strong>Alert ${alert.id}:</strong> Correct! (Priority ${alert.correctPriority})</p>`;
                } else if (diff <= 2) {
                    feedback += `<p>‚ö†Ô∏è <strong>Alert ${alert.id}:</strong> Close. You said ${userPriority}, answer is ${alert.correctPriority}</p>`;
                } else {
                    feedback += `<p>‚ùå <strong>Alert ${alert.id}:</strong> Incorrect. You said ${userPriority}, answer is ${alert.correctPriority}</p>`;
                }
            });

            feedback += `<h3 style="margin-top: 20px;">Explanation:</h3>`;
            feedback += `<p><strong>Priority 1 (CRITICAL - Immediate Action):</strong> Alert A (Ransomware) and G (C2 on DC) are both critical incidents requiring immediate containment. Active encryption and DC compromise are highest priority.</p>`;
            feedback += `<p><strong>Priority 2-4 (HIGH - Urgent):</strong> Alert B (CEO account), D (data exfiltration), I (lateral movement) are high-impact incidents requiring rapid response.</p>`;
            feedback += `<p><strong>Priority 5-8 (MEDIUM):</strong> Alerts C, F, H require investigation but aren't time-critical emergencies.</p>`;
            feedback += `<p><strong>Priority 9-10 (LOW):</strong> Alerts E and J are low priority - PUA already quarantined, security scan is expected.</p>`;

            const feedbackBox = document.getElementById('feedback1');
            feedbackBox.className = `feedback-box ${correct >= 7 ? 'correct' : 'incorrect'}`;
            feedbackBox.innerHTML = feedback;

            if (correct >= 7) {
                completeLab('lab1');
                feedback += `<p style="margin-top: 20px;"><strong>üéâ Lab Completed!</strong> You correctly prioritized ${correct}/10 alerts.</p>`;
                feedbackBox.innerHTML = feedback;
            }
        }

        // Lab 2: Phishing Investigation
        function loadLab2() {
            const content = document.getElementById('labContent');
            content.innerHTML = `
                <div class="lab-content active">
                    <h2>üé£ Lab 2: Phishing Email Investigation</h2>

                    <div class="objective-box">
                        <h3 style="color: #c084fc; margin-top: 0;">Objective</h3>
                        <p>${currentLab.objective}</p>
                    </div>

                    <div class="step-indicator">
                        <div class="step active" id="step-1">1</div>
                        <div class="step" id="step-2">2</div>
                        <div class="step" id="step-3">3</div>
                        <div class="step" id="step-4">4</div>
                    </div>

                    <div id="phishing-step-1">
                        <div class="scenario-box">
                            <h3 style="margin-top: 0;">Step 1: Email Analysis</h3>
                            <p>A user reported a suspicious email. Analyze the email details below:</p>

                            <div class="code-block">
From: support@paypa1-security.com
To: finance-team@company.com
Subject: URGENT: Account Verification Required
Date: 2025-12-21 09:15:42

Dear Valued Customer,

Your PayPal account has been temporarily limited due to suspicious activity.
To restore full access, please verify your identity immediately by clicking the link below:

https://paypa1-secure-login.com/verify?id=7f8e9d

Failure to verify within 24 hours will result in permanent account closure.

Thank you,
PayPal Security Team

---------------------------------
Email Headers:
SPF: FAIL (sender IP 185.220.101.67 not authorized)
DKIM: FAIL (signature verification failed)
DMARC: FAIL (alignment check failed)
                            </div>

                            <h3>Analysis Questions:</h3>
                            <p><strong>1. Is this email legitimate or phishing?</strong></p>
                            <select class="answer-input" id="q1">
                                <option value="">Select...</option>
                                <option value="legitimate">Legitimate Email</option>
                                <option value="phishing">Phishing Email</option>
                            </select>

                            <p><strong>2. What indicators suggest this is phishing? (Select all that apply)</strong></p>
                            <ul class="checklist" id="phishing-indicators">
                                <li onclick="toggleCheck(this)" data-value="typo">Typosquatting domain (paypa1 vs paypal)</li>
                                <li onclick="toggleCheck(this)" data-value="spf">Failed SPF/DKIM/DMARC checks</li>
                                <li onclick="toggleCheck(this)" data-value="urgency">Urgency and threat of account closure</li>
                                <li onclick="toggleCheck(this)" data-value="generic">Generic greeting ("Dear Valued Customer")</li>
                                <li onclick="toggleCheck(this)" data-value="link">Suspicious link to non-PayPal domain</li>
                            </ul>

                            <button class="btn btn-primary" onclick="phishingStep2()">Next Step ‚Üí</button>
                            <div id="feedback-step1" class="feedback-box"></div>
                        </div>
                    </div>

                    <div id="phishing-step-2" style="display: none;">
                        <div class="scenario-box">
                            <h3 style="margin-top: 0;">Step 2: Scope Determination</h3>
                            <p>Good work identifying the phishing email! Now determine the scope of impact.</p>

                            <div class="code-block">
Email Gateway Logs:
- Total recipients: 47 users (Finance department)
- Emails delivered: 42 (5 auto-quarantined)
- Users who clicked link: 8
- Users who entered credentials: 3

User Details (entered credentials):
1. jsmith - Accountant - Last login: 2 hours ago
2. mchen - Finance Manager - Last login: 30 minutes ago
3. dbrown - CFO - Last login: Active now
                            </div>

                            <p><strong>Which users require immediate password reset?</strong></p>
                            <ul class="checklist" id="reset-users">
                                <li onclick="toggleCheck(this)" data-value="jsmith">jsmith (Accountant)</li>
                                <li onclick="toggleCheck(this)" data-value="mchen">mchen (Finance Manager)</li>
                                <li onclick="toggleCheck(this)" data-value="dbrown">dbrown (CFO)</li>
                                <li onclick="toggleCheck(this)" data-value="all42">All 42 users who received the email</li>
                                <li onclick="toggleCheck(this)" data-value="all8">All 8 users who clicked the link</li>
                            </ul>

                            <button class="btn btn-primary" onclick="phishingStep3()">Next Step ‚Üí</button>
                            <div id="feedback-step2" class="feedback-box"></div>
                        </div>
                    </div>

                    <div id="phishing-step-3" style="display: none;">
                        <div class="scenario-box">
                            <h3 style="margin-top: 0;">Step 3: Containment Actions</h3>
                            <p>Select the appropriate containment actions in the correct order:</p>

                            <ol style="margin: 20px 0; color: #b0b0b0;">
                                <li>What should you do FIRST?
                                    <select class="answer-input" id="first-action">
                                        <option value="">Select...</option>
                                        <option value="reset">Reset passwords for affected users</option>
                                        <option value="block">Block phishing domain at email gateway and proxy</option>
                                        <option value="delete">Delete phishing emails from all mailboxes</option>
                                        <option value="disable">Disable compromised user accounts</option>
                                    </select>
                                </li>
                                <li>What should you do SECOND?
                                    <select class="answer-input" id="second-action">
                                        <option value="">Select...</option>
                                        <option value="reset">Reset passwords for affected users</option>
                                        <option value="block">Block phishing domain at email gateway and proxy</option>
                                        <option value="delete">Delete phishing emails from all mailboxes</option>
                                        <option value="disable">Disable compromised user accounts</option>
                                    </select>
                                </li>
                                <li>What should you do THIRD?
                                    <select class="answer-input" id="third-action">
                                        <option value="">Select...</option>
                                        <option value="reset">Reset passwords for affected users</option>
                                        <option value="block">Block phishing domain at email gateway and proxy</option>
                                        <option value="delete">Delete phishing emails from all mailboxes</option>
                                        <option value="disable">Disable compromised user accounts</option>
                                    </select>
                                </li>
                            </ol>

                            <button class="btn btn-primary" onclick="phishingStep4()">Next Step ‚Üí</button>
                            <div id="feedback-step3" class="feedback-box"></div>
                        </div>
                    </div>

                    <div id="phishing-step-4" style="display: none;">
                        <div class="scenario-box">
                            <h3 style="margin-top: 0;">Step 4: Documentation</h3>
                            <p>Write a concise incident summary for your ticketing system:</p>

                            <textarea class="answer-input" id="incident-summary" rows="8"
                                placeholder="Include: What happened, how many affected, actions taken, current status"></textarea>

                            <button class="btn btn-success" onclick="completePhishingLab()">Complete Lab</button>
                            <div id="feedback-step4" class="feedback-box"></div>
                        </div>
                    </div>
                </div>
            `;
        }

        function phishingStep2() {
            const q1 = document.getElementById('q1').value;
            const indicators = Array.from(document.querySelectorAll('#phishing-indicators li.checked')).map(li => li.dataset.value);

            if (q1 !== 'phishing') {
                document.getElementById('feedback-step1').className = 'feedback-box incorrect';
                document.getElementById('feedback-step1').innerHTML = '<p>‚ùå This is a phishing email. Review the typosquatting domain, failed email authentication, and urgency tactics.</p>';
                return;
            }

            const requiredIndicators = ['typo', 'spf', 'urgency', 'generic', 'link'];
            const correct = requiredIndicators.filter(i => indicators.includes(i)).length;

            if (correct < 4) {
                document.getElementById('feedback-step1').className = 'feedback-box incorrect';
                document.getElementById('feedback-step1').innerHTML = `<p>‚ö†Ô∏è You identified ${correct}/5 key indicators. Review the email carefully for all phishing signs.</p>`;
                return;
            }

            document.getElementById('feedback-step1').className = 'feedback-box correct';
            document.getElementById('feedback-step1').innerHTML = '<p>‚úÖ Excellent analysis! All key phishing indicators identified.</p>';

            document.getElementById('step-1').classList.add('completed');
            document.getElementById('step-2').classList.add('active');
            document.getElementById('phishing-step-1').style.display = 'none';
            document.getElementById('phishing-step-2').style.display = 'block';
        }

        function phishingStep3() {
            const resetUsers = Array.from(document.querySelectorAll('#reset-users li.checked')).map(li => li.dataset.value);

            const correct = resetUsers.includes('jsmith') && resetUsers.includes('mchen') && resetUsers.includes('dbrown')
                          && !resetUsers.includes('all42') && !resetUsers.includes('all8');

            if (!correct) {
                document.getElementById('feedback-step2').className = 'feedback-box incorrect';
                document.getElementById('feedback-step2').innerHTML = '<p>‚ùå Only the 3 users who entered credentials need immediate password reset. Clicking alone doesn\'t compromise credentials.</p>';
                return;
            }

            document.getElementById('feedback-step2').className = 'feedback-box correct';
            document.getElementById('feedback-step2').innerHTML = '<p>‚úÖ Correct! Only users who submitted credentials (jsmith, mchen, dbrown) require immediate password reset.</p>';

            document.getElementById('step-2').classList.add('completed');
            document.getElementById('step-3').classList.add('active');
            document.getElementById('phishing-step-2').style.display = 'none';
            document.getElementById('phishing-step-3').style.display = 'block';
        }

        function phishingStep4() {
            const first = document.getElementById('first-action').value;
            const second = document.getElementById('second-action').value;
            const third = document.getElementById('third-action').value;

            if (first !== 'disable' || second !== 'block' || third !== 'delete') {
                document.getElementById('feedback-step3').className = 'feedback-box incorrect';
                document.getElementById('feedback-step3').innerHTML = `
                    <p>‚ùå Incorrect order. Correct sequence:</p>
                    <ol>
                        <li><strong>Disable</strong> compromised accounts immediately to prevent attacker access</li>
                        <li><strong>Block</strong> phishing domain to prevent future victims</li>
                        <li><strong>Delete</strong> emails from remaining mailboxes</li>
                    </ol>
                `;
                return;
            }

            document.getElementById('feedback-step3').className = 'feedback-box correct';
            document.getElementById('feedback-step3').innerHTML = '<p>‚úÖ Perfect! You prioritized containment correctly: Stop the damage (disable accounts), prevent spread (block domain), clean up (delete emails).</p>';

            document.getElementById('step-3').classList.add('completed');
            document.getElementById('step-4').classList.add('active');
            document.getElementById('phishing-step-3').style.display = 'none';
            document.getElementById('phishing-step-4').style.display = 'block';
        }

        function completePhishingLab() {
            const summary = document.getElementById('incident-summary').value;

            if (summary.length < 100) {
                document.getElementById('feedback-step4').className = 'feedback-box incorrect';
                document.getElementById('feedback-step4').innerHTML = '<p>‚ùå Summary too brief. Include: incident description, number affected, actions taken, and current status.</p>';
                return;
            }

            document.getElementById('feedback-step4').className = 'feedback-box correct';
            document.getElementById('feedback-step4').innerHTML = `
                <p>‚úÖ <strong>Lab Completed!</strong></p>
                <p>Excellent documentation. A good incident summary should include:</p>
                <ul>
                    <li>Incident type and timeline</li>
                    <li>Scope (number of users affected)</li>
                    <li>Containment actions taken</li>
                    <li>Current status and next steps</li>
                </ul>
            `;

            completeLab('lab2');
        }

        // Lab 3: Escalation Decision Making
        function loadLab3() {
            const content = document.getElementById('labContent');
            content.innerHTML = `
                <div class="lab-content active">
                    <h2>üìà Lab 3: Escalation Decision Making</h2>

                    <div class="objective-box">
                        <h3 style="color: #c084fc; margin-top: 0;">Objective</h3>
                        <p>${currentLab.objective}</p>
                    </div>

                    <p>For each scenario, decide whether to handle it yourself (Tier 1) or escalate to Tier 2/Management, and explain why.</p>

                    <div class="scenario-box">
                        <h3>Scenario 1: PowerShell Encoded Command</h3>
                        <p>EDR detected encoded PowerShell execution on a developer's workstation. Investigation shows it's a deployment script from their build system.</p>
                        <p><strong>Decision:</strong></p>
                        <select class="answer-input" id="esc1">
                            <option value="">Select...</option>
                            <option value="handle">Handle at Tier 1</option>
                            <option value="tier2">Escalate to Tier 2</option>
                            <option value="management">Escalate to Management</option>
                        </select>
                    </div>

                    <div class="scenario-box">
                        <h3>Scenario 2: Suspected Data Breach</h3>
                        <p>DLP alert shows 50GB upload to unknown external IP from HR system. Files include employee SSNs and salary information. User account belongs to recently terminated employee.</p>
                        <p><strong>Decision:</strong></p>
                        <select class="answer-input" id="esc2">
                            <option value="">Select...</option>
                            <option value="handle">Handle at Tier 1</option>
                            <option value="tier2">Escalate to Tier 2</option>
                            <option value="management">Escalate to Management + Legal</option>
                        </select>
                    </div>

                    <div class="scenario-box">
                        <h3>Scenario 3: Malware on Developer VM</h3>
                        <p>Malware detected on isolated development virtual machine used for malware analysis testing. Confirmed to be intentional testing by security team.</p>
                        <p><strong>Decision:</strong></p>
                        <select class="answer-input" id="esc3">
                            <option value="">Select...</option>
                            <option value="handle">Handle at Tier 1</option>
                            <option value="tier2">Escalate to Tier 2</option>
                            <option value="management">Escalate to Management</option>
                        </select>
                    </div>

                    <div class="scenario-box">
                        <h3>Scenario 4: Active Directory Attack</h3>
                        <p>Multiple alerts: Kerberoasting detected, suspicious LDAP queries, potential DCSync attack indicators on Domain Controller. This is beyond your expertise.</p>
                        <p><strong>Decision:</strong></p>
                        <select class="answer-input" id="esc4">
                            <option value="">Select...</option>
                            <option value="handle">Handle at Tier 1</option>
                            <option value="tier2">Escalate to Tier 2</option>
                            <option value="management">Escalate to Management</option>
                        </select>
                    </div>

                    <button class="btn btn-success" onclick="checkEscalations()">Submit Decisions</button>
                    <div id="feedback-esc" class="feedback-box"></div>
                </div>
            `;
        }

        function checkEscalations() {
            const esc1 = document.getElementById('esc1').value;
            const esc2 = document.getElementById('esc2').value;
            const esc3 = document.getElementById('esc3').value;
            const esc4 = document.getElementById('esc4').value;

            let correct = 0;
            let feedback = '<h3>Escalation Decisions:</h3>';

            if (esc1 === 'handle') {
                correct++;
                feedback += '<p>‚úÖ Scenario 1: Correct! Authorized development activity confirmed by ticket. Document as BTP and close.</p>';
            } else {
                feedback += '<p>‚ùå Scenario 1: This is authorized activity. Tier 1 can handle after verification.</p>';
            }

            if (esc2 === 'management') {
                correct++;
                feedback += '<p>‚úÖ Scenario 2: Correct! Suspected data breach requires immediate escalation to Management, Legal, and HR. This is a critical incident.</p>';
            } else {
                feedback += '<p>‚ùå Scenario 2: This is a potential data breach requiring Management + Legal notification, not just Tier 2.</p>';
            }

            if (esc3 === 'handle') {
                correct++;
                feedback += '<p>‚úÖ Scenario 3: Correct! Authorized security testing in isolated environment. Verify approval and close as BTP.</p>';
            } else {
                feedback += '<p>‚ùå Scenario 3: This is authorized testing in an isolated VM. Tier 1 can close after verification.</p>';
            }

            if (esc4 === 'tier2') {
                correct++;
                feedback += '<p>‚úÖ Scenario 4: Correct! Advanced AD attacks require Tier 2/3 expertise for forensics and response.</p>';
            } else {
                feedback += '<p>‚ùå Scenario 4: Active Directory attacks require advanced investigation skills - escalate to Tier 2.</p>';
            }

            const feedbackBox = document.getElementById('feedback-esc');
            feedbackBox.className = `feedback-box ${correct === 4 ? 'correct' : 'incorrect'}`;
            feedbackBox.innerHTML = feedback;

            if (correct === 4) {
                completeLab('lab3');
                feedbackBox.innerHTML += '<p style="margin-top: 20px;"><strong>üéâ Lab Completed!</strong> You made all correct escalation decisions.</p>';
            }
        }

        // Lab 4: Shift Handoff Report
        function loadLab4() {
            const content = document.getElementById('labContent');
            content.innerHTML = `
                <div class="lab-content active">
                    <h2>üîÑ Lab 4: Shift Handoff Report</h2>

                    <div class="objective-box">
                        <h3 style="color: #c084fc; margin-top: 0;">Objective</h3>
                        <p>${currentLab.objective}</p>
                    </div>

                    <div class="scenario-box">
                        <h3 style="margin-top: 0;">Your Shift Summary</h3>
                        <p>During your 8-hour shift, you handled:</p>
                        <ul>
                            <li><strong>INC-5421:</strong> Ransomware detected on HR-WS-055, contained and escalated to Tier 2 (still investigating)</li>
                            <li><strong>INC-5422:</strong> Phishing campaign targeting Finance, 3 users compromised, passwords reset, emails deleted</li>
                            <li><strong>INC-5423:</strong> False positive - Vulnerability scan triggering IDS alerts (closed)</li>
                            <li><strong>Alert Queue:</strong> 87 alerts triaged, 12 pending (3 medium, 9 low priority)</li>
                            <li><strong>Scheduled Event:</strong> Firewall maintenance tonight 22:00-24:00 (may cause connectivity alerts)</li>
                        </ul>
                    </div>

                    <h3>Write Your Handoff Report</h3>
                    <p>Include: Ongoing incidents, pending alerts, escalations waiting for response, and environmental notes.</p>

                    <textarea class="answer-input" id="handoff-report" rows="12"
                        placeholder="Write a professional shift handoff report for the incoming analyst..."></textarea>

                    <button class="btn btn-success" onclick="checkHandoff()">Submit Report</button>
                    <div id="feedback-handoff" class="feedback-box"></div>
                </div>
            `;
        }

        function checkHandoff() {
            const report = document.getElementById('handoff-report').value;

            const requiredElements = [
                { text: 'INC-5421', found: report.includes('INC-5421') || report.includes('5421'), name: 'Ongoing ransomware incident' },
                { text: 'INC-5422', found: report.includes('INC-5422') || report.includes('5422'), name: 'Phishing incident' },
                { text: 'pending', found: report.toLowerCase().includes('pending') || report.includes('12'), name: 'Pending alert count' },
                { text: 'firewall', found: report.toLowerCase().includes('firewall') || report.toLowerCase().includes('maintenance'), name: 'Scheduled maintenance' }
            ];

            const missingElements = requiredElements.filter(e => !e.found);

            if (report.length < 200) {
                document.getElementById('feedback-handoff').className = 'feedback-box incorrect';
                document.getElementById('feedback-handoff').innerHTML = '<p>‚ùå Report too brief. Provide more detail about ongoing incidents and next steps.</p>';
                return;
            }

            if (missingElements.length > 0) {
                document.getElementById('feedback-handoff').className = 'feedback-box incorrect';
                document.getElementById('feedback-handoff').innerHTML = `
                    <p>‚ö†Ô∏è Missing key information:</p>
                    <ul>${missingElements.map(e => `<li>${e.name}</li>`).join('')}</ul>
                `;
                return;
            }

            document.getElementById('feedback-handoff').className = 'feedback-box correct';
            document.getElementById('feedback-handoff').innerHTML = `
                <p>‚úÖ <strong>Lab Completed!</strong> Excellent handoff report!</p>
                <p>Your report included all critical elements:</p>
                <ul>
                    <li>Ongoing incident status (INC-5421)</li>
                    <li>Completed incidents (INC-5422)</li>
                    <li>Pending alert queue status</li>
                    <li>Scheduled maintenance notifications</li>
                </ul>
                <p>Good handoff reports ensure smooth transitions and prevent incidents from being overlooked.</p>
            `;

            completeLab('lab4');
        }

        // Lab 5: Runbook Execution
        function loadLab5() {
            const content = document.getElementById('labContent');
            content.innerHTML = `
                <div class="lab-content active">
                    <h2>üìñ Lab 5: Runbook Execution</h2>

                    <div class="objective-box">
                        <h3 style="color: #c084fc; margin-top: 0;">Objective</h3>
                        <p>${currentLab.objective}</p>
                    </div>

                    <div class="scenario-box">
                        <h3 style="margin-top: 0;">Alert Details</h3>
                        <p><strong>EDR Malware Detection:</strong> File "invoice.exe" detected on MKT-WS-032</p>
                        <p><strong>User:</strong> asmith (Marketing Coordinator)</p>
                        <p><strong>VirusTotal Score:</strong> 58/70 vendors detect as TrojanDownloader.Win32.Agent</p>
                    </div>

                    <h3>Follow the Runbook</h3>
                    <p>Complete each step of the malware investigation runbook. Check off each task as you complete it.</p>

                    <ul class="checklist" id="runbook-checklist">
                        <li onclick="toggleCheck(this)" data-value="vt">Check file hash in VirusTotal (&gt;30 detections = confirmed malware)</li>
                        <li onclick="toggleCheck(this)" data-value="exec">Review EDR logs - Was file executed or quarantined before execution?</li>
                        <li onclick="toggleCheck(this)" data-value="c2">Check network logs for C2 communication</li>
                        <li onclick="toggleCheck(this)" data-value="user">Contact user to confirm file source and actions taken</li>
                        <li onclick="toggleCheck(this)" data-value="scope">Search SIEM for same file hash on other systems</li>
                        <li onclick="toggleCheck(this)" data-value="persist">Check for persistence mechanisms (registry, scheduled tasks)</li>
                        <li onclick="toggleCheck(this)" data-value="isolate">Isolate host via EDR (if executed)</li>
                        <li onclick="toggleCheck(this)" data-value="disable">Disable user account (if credentials compromised)</li>
                        <li onclick="toggleCheck(this)" data-value="doc">Document findings in ticket with full timeline</li>
                        <li onclick="toggleCheck(this)" data-value="classify">Classify alert (TP/FP/BTP) and escalate if needed</li>
                    </ul>

                    <h3>Investigation Results</h3>
                    <div class="code-block">
VirusTotal: 58/70 detections (confirmed malware)
EDR Status: File QUARANTINED before execution
Network Logs: No C2 communication detected
User Report: Downloaded from email attachment, clicked before realizing suspicious
SIEM Search: No other systems affected
Persistence: None (file never executed)
                    </div>

                    <h3>Your Decision</h3>
                    <p><strong>Classification:</strong></p>
                    <select class="answer-input" id="runbook-classification">
                        <option value="">Select...</option>
                        <option value="tp-escalate">True Positive - Escalate to Tier 2</option>
                        <option value="tp-close">True Positive - Handle and Close</option>
                        <option value="fp">False Positive - Close</option>
                        <option value="btp">Benign True Positive - Close</option>
                    </select>

                    <p><strong>Actions Taken:</strong></p>
                    <textarea class="answer-input" id="runbook-actions" rows="4"
                        placeholder="List all actions you took..."></textarea>

                    <button class="btn btn-success" onclick="checkRunbook()">Complete Investigation</button>
                    <div id="feedback-runbook" class="feedback-box"></div>
                </div>
            `;
        }

        function checkRunbook() {
            const checkedSteps = document.querySelectorAll('#runbook-checklist li.checked').length;
            const classification = document.getElementById('runbook-classification').value;
            const actions = document.getElementById('runbook-actions').value;

            if (checkedSteps < 8) {
                document.getElementById('feedback-runbook').className = 'feedback-box incorrect';
                document.getElementById('feedback-runbook').innerHTML = '<p>‚ùå Complete more runbook steps before submitting. Thorough investigation is critical.</p>';
                return;
            }

            if (classification !== 'tp-close') {
                document.getElementById('feedback-runbook').className = 'feedback-box incorrect';
                document.getElementById('feedback-runbook').innerHTML = `
                    <p>‚ùå Incorrect classification. This is a <strong>True Positive</strong> that Tier 1 can handle:</p>
                    <ul>
                        <li>Confirmed malware (58/70 VT detections)</li>
                        <li>BUT: Quarantined BEFORE execution</li>
                        <li>No C2 communication</li>
                        <li>No lateral spread</li>
                        <li>User education needed, but no escalation required</li>
                    </ul>
                `;
                return;
            }

            if (actions.length < 50) {
                document.getElementById('feedback-runbook').className = 'feedback-box incorrect';
                document.getElementById('feedback-runbook').innerHTML = '<p>‚ùå Document your actions more thoroughly. What did you do to resolve this incident?</p>';
                return;
            }

            document.getElementById('feedback-runbook').className = 'feedback-box correct';
            document.getElementById('feedback-runbook').innerHTML = `
                <p>‚úÖ <strong>Lab Completed!</strong> Excellent runbook execution!</p>
                <p><strong>Correct Handling:</strong></p>
                <ul>
                    <li>‚úÖ Confirmed malware via VirusTotal</li>
                    <li>‚úÖ Verified EDR quarantined before execution (critical!)</li>
                    <li>‚úÖ Checked for C2 and lateral movement (none detected)</li>
                    <li>‚úÖ Classified as TP that Tier 1 can close</li>
                    <li>‚úÖ User education on phishing awareness</li>
                </ul>
                <p>Runbooks ensure consistent, thorough investigations even for junior analysts.</p>
            `;

            completeLab('lab5');
        }

        // Lab 6: Multi-Alert Correlation
        function loadLab6() {
            const content = document.getElementById('labContent');
            content.innerHTML = `
                <div class="lab-content active">
                    <h2>üîó Lab 6: Multi-Alert Correlation</h2>

                    <div class="objective-box">
                        <h3 style="color: #c084fc; margin-top: 0;">Objective</h3>
                        <p>${currentLab.objective}</p>
                    </div>

                    <div class="scenario-box">
                        <h3 style="margin-top: 0;">Situation</h3>
                        <p>Five alerts came in within 30 minutes. Analyze them to determine which are related to a single attack campaign.</p>
                    </div>

                    <div class="alert-item">
                        <div class="alert-header">
                            <span class="alert-id">Alert A - 14:15</span>
                            <span class="severity-badge severity-medium">MEDIUM</span>
                        </div>
                        <p><strong>Phishing Email Detected</strong></p>
                        <p>Subject: "Invoice #8821" - From: accounts@vendor-inv0icing.com</p>
                        <p>Malicious attachment: invoice_8821.zip ‚Üí Contains invoice.exe</p>
                        <input type="checkbox" id="related-a"> <label for="related-a">Part of attack campaign</label>
                    </div>

                    <div class="alert-item">
                        <div class="alert-header">
                            <span class="alert-id">Alert B - 14:22</span>
                            <span class="severity-badge severity-medium">MEDIUM</span>
                        </div>
                        <p><strong>Failed Login Attempts</strong></p>
                        <p>User: helpdesk - 15 failed RDP attempts from 203.0.113.45</p>
                        <p>Unrelated to other activity, generic brute force attempt</p>
                        <input type="checkbox" id="related-b"> <label for="related-b">Part of attack campaign</label>
                    </div>

                    <div class="alert-item">
                        <div class="alert-header">
                            <span class="alert-id">Alert C - 14:28</span>
                            <span class="severity-badge severity-high">HIGH</span>
                        </div>
                        <p><strong>Malware Execution</strong></p>
                        <p>Process: invoice.exe on FIN-WS-088 (User: jdoe - Finance)</p>
                        <p>File hash: d41d8cd98f00b204e9800998ecf8427e (matches email attachment)</p>
                        <input type="checkbox" id="related-c"> <label for="related-c">Part of attack campaign</label>
                    </div>

                    <div class="alert-item">
                        <div class="alert-header">
                            <span class="alert-id">Alert D - 14:35</span>
                            <span class="severity-badge severity-high">HIGH</span>
                        </div>
                        <p><strong>C2 Communication</strong></p>
                        <p>Host: FIN-WS-088 connecting to 185.220.101.88:443 (known C2 server)</p>
                        <p>Beaconing every 60 seconds since 14:29</p>
                        <input type="checkbox" id="related-d"> <label for="related-d">Part of attack campaign</label>
                    </div>

                    <div class="alert-item">
                        <div class="alert-header">
                            <span class="alert-id">Alert E - 14:42</span>
                            <span class="severity-badge severity-critical">CRITICAL</span>
                        </div>
                        <p><strong>Lateral Movement</strong></p>
                        <p>User: jdoe logged into FILESVR-01 via RDP from FIN-WS-088</p>
                        <p>Unusual activity - jdoe doesn't normally access file server</p>
                        <input type="checkbox" id="related-e"> <label for="related-e">Part of attack campaign</label>
                    </div>

                    <h3>Analysis Questions</h3>
                    <p><strong>1. What is the attack sequence?</strong></p>
                    <textarea class="answer-input" id="attack-sequence" rows="4"
                        placeholder="Describe the attack timeline from initial compromise to current state..."></textarea>

                    <p><strong>2. What should be your IMMEDIATE next action?</strong></p>
                    <select class="answer-input" id="immediate-action">
                        <option value="">Select...</option>
                        <option value="isolate-fin">Isolate FIN-WS-088 and FILESVR-01</option>
                        <option value="block-ip">Block C2 IP 185.220.101.88</option>
                        <option value="disable-jdoe">Disable user account jdoe</option>
                        <option value="delete-email">Delete phishing emails from other mailboxes</option>
                    </select>

                    <button class="btn btn-success" onclick="checkCorrelation()">Submit Analysis</button>
                    <div id="feedback-correlation" class="feedback-box"></div>
                </div>
            `;
        }

        function checkCorrelation() {
            const relatedA = document.getElementById('related-a').checked;
            const relatedB = document.getElementById('related-b').checked;
            const relatedC = document.getElementById('related-c').checked;
            const relatedD = document.getElementById('related-d').checked;
            const relatedE = document.getElementById('related-e').checked;
            const sequence = document.getElementById('attack-sequence').value;
            const action = document.getElementById('immediate-action').value;

            const correct = relatedA && !relatedB && relatedC && relatedD && relatedE;

            if (!correct) {
                document.getElementById('feedback-correlation').className = 'feedback-box incorrect';
                document.getElementById('feedback-correlation').innerHTML = `
                    <p>‚ùå Incorrect correlation. The attack chain is:</p>
                    <ul>
                        <li><strong>Alert A:</strong> Phishing email (initial vector) ‚úì</li>
                        <li><strong>Alert B:</strong> UNRELATED brute force attack ‚úó</li>
                        <li><strong>Alert C:</strong> User executed malware from email ‚úì</li>
                        <li><strong>Alert D:</strong> Malware established C2 connection ‚úì</li>
                        <li><strong>Alert E:</strong> Attacker using compromised account for lateral movement ‚úì</li>
                    </ul>
                `;
                return;
            }

            if (action !== 'isolate-fin') {
                document.getElementById('feedback-correlation').className = 'feedback-box incorrect';
                document.getElementById('feedback-correlation').innerHTML = '<p>‚ùå With active lateral movement, immediate isolation of compromised systems is critical to prevent further spread.</p>';
                return;
            }

            if (sequence.length < 100) {
                document.getElementById('feedback-correlation').className = 'feedback-box incorrect';
                document.getElementById('feedback-correlation').innerHTML = '<p>‚ùå Provide a more detailed attack sequence description.</p>';
                return;
            }

            document.getElementById('feedback-correlation').className = 'feedback-box correct';
            document.getElementById('feedback-correlation').innerHTML = `
                <p>‚úÖ <strong>Lab Completed!</strong> Excellent correlation analysis!</p>
                <p><strong>Attack Chain:</strong></p>
                <ol>
                    <li>Phishing email sent with malicious attachment (Alert A)</li>
                    <li>User jdoe executed invoice.exe (Alert C)</li>
                    <li>Malware established C2 connection (Alert D)</li>
                    <li>Attacker performed lateral movement to file server (Alert E)</li>
                </ol>
                <p><strong>Correct Action:</strong> Isolate both FIN-WS-088 and FILESVR-01 immediately, then disable jdoe account, block C2 IP, and escalate to Tier 2/IR team.</p>
                <p>Alert correlation is critical for detecting multi-stage attacks!</p>
            `;

            completeLab('lab6');
        }

        // Lab 7: SOC Metrics Analysis
        function loadLab7() {
            const content = document.getElementById('labContent');
            content.innerHTML = `
                <div class="lab-content active">
                    <h2>üìâ Lab 7: SOC Metrics Analysis</h2>

                    <div class="objective-box">
                        <h3 style="color: #c084fc; margin-top: 0;">Objective</h3>
                        <p>${currentLab.objective}</p>
                    </div>

                    <div class="scenario-box">
                        <h3 style="margin-top: 0;">Weekly SOC Metrics</h3>
                        <p>Analyze the following metrics from last week's SOC operations:</p>

                        <div class="metric-card">
                            <div class="metric-value">23 min</div>
                            <div class="metric-label">Mean Time to Detect (MTTD)</div>
                            <p style="color: #fbbf24; margin-top: 10px;">‚Üë +8 min from previous week</p>
                        </div>

                        <div class="metric-card">
                            <div class="metric-value">87 min</div>
                            <div class="metric-label">Mean Time to Respond (MTTR)</div>
                            <p style="color: #fbbf24; margin-top: 10px;">‚Üë +15 min from previous week</p>
                        </div>

                        <div class="metric-card">
                            <div class="metric-value">12,847</div>
                            <div class="metric-label">Total Alerts</div>
                            <p style="color: #ef4444; margin-top: 10px;">‚Üë +45% from previous week</p>
                        </div>

                        <div class="metric-card">
                            <div class="metric-value">91.2%</div>
                            <div class="metric-label">False Positive Rate</div>
                            <p style="color: #ef4444; margin-top: 10px;">‚Üë +6% from previous week</p>
                        </div>

                        <div class="metric-card">
                            <div class="metric-value">2.8%</div>
                            <div class="metric-label">True Positive Rate</div>
                            <p style="color: #22c55e; margin-top: 10px;">‚Üì -3% from previous week</p>
                        </div>

                        <div class="metric-card">
                            <div class="metric-value">34</div>
                            <div class="metric-label">Incidents Created</div>
                            <p style="color: #06b6d4; margin-top: 10px;">‚Üí Same as previous week</p>
                        </div>
                    </div>

                    <h3>Analysis Questions</h3>

                    <p><strong>1. What is the primary problem indicated by these metrics?</strong></p>
                    <select class="answer-input" id="metrics-problem">
                        <option value="">Select...</option>
                        <option value="understaffed">SOC is understaffed</option>
                        <option value="alert-noise">Excessive alert noise from new detection rules</option>
                        <option value="attacks">Increase in actual attacks</option>
                        <option value="training">Analysts need more training</option>
                    </select>

                    <p><strong>2. Why did MTTD and MTTR increase?</strong></p>
                    <textarea class="answer-input" id="metrics-why" rows="3"
                        placeholder="Explain the likely cause of slower detection and response times..."></textarea>

                    <p><strong>3. What is your recommended action?</strong></p>
                    <ul class="checklist" id="metrics-actions">
                        <li onclick="toggleCheck(this)" data-value="tune">Tune detection rules to reduce false positives</li>
                        <li onclick="toggleCheck(this)" data-value="hire">Hire more analysts</li>
                        <li onclick="toggleCheck(this)" data-value="automate">Implement SOAR automation for common FPs</li>
                        <li onclick="toggleCheck(this)" data-value="training">Provide additional analyst training</li>
                        <li onclick="toggleCheck(this)" data-value="review">Review recent rule deployments</li>
                    </ul>

                    <button class="btn btn-success" onclick="checkMetrics()">Submit Analysis</button>
                    <div id="feedback-metrics" class="feedback-box"></div>
                </div>
            `;
        }

        function checkMetrics() {
            const problem = document.getElementById('metrics-problem').value;
            const why = document.getElementById('metrics-why').value;
            const actions = Array.from(document.querySelectorAll('#metrics-actions li.checked')).map(li => li.dataset.value);

            if (problem !== 'alert-noise') {
                document.getElementById('feedback-metrics').className = 'feedback-box incorrect';
                document.getElementById('feedback-metrics').innerHTML = `
                    <p>‚ùå Key indicator: <strong>45% increase in alerts + 91% FP rate</strong></p>
                    <p>This suggests new detection rules are generating excessive noise, overwhelming analysts and slowing response times.</p>
                `;
                return;
            }

            if (why.length < 50) {
                document.getElementById('feedback-metrics').className = 'feedback-box incorrect';
                document.getElementById('feedback-metrics').innerHTML = '<p>‚ùå Explain WHY detection and response times increased. Consider the relationship between alert volume and analyst capacity.</p>';
                return;
            }

            const goodActions = actions.includes('tune') && actions.includes('automate') && actions.includes('review');

            if (!goodActions) {
                document.getElementById('feedback-metrics').className = 'feedback-box incorrect';
                document.getElementById('feedback-metrics').innerHTML = `
                    <p>‚ö†Ô∏è Focus on reducing alert noise. Key actions:</p>
                    <ul>
                        <li>Tune detection rules (reduce FPs)</li>
                        <li>Automate common FP handling via SOAR</li>
                        <li>Review recent rule deployments (find the source)</li>
                    </ul>
                `;
                return;
            }

            document.getElementById('feedback-metrics').className = 'feedback-box correct';
            document.getElementById('feedback-metrics').innerHTML = `
                <p>‚úÖ <strong>Lab Completed!</strong> Excellent metrics analysis!</p>
                <p><strong>Root Cause:</strong> 45% increase in alert volume with 91% FP rate indicates new detection rules are poorly tuned, creating noise that overwhelms analysts.</p>
                <p><strong>Impact:</strong> Analysts spend more time on FPs, slowing triage (‚ÜëMTTD) and response (‚ÜëMTTR).</p>
                <p><strong>Solution:</strong></p>
                <ul>
                    <li>Review recently deployed rules (likely source of noise)</li>
                    <li>Aggressive tuning to reduce FP rate below 80%</li>
                    <li>SOAR automation for obvious FPs</li>
                    <li>Monitor metrics weekly to verify improvement</li>
                </ul>
                <p>Metrics tell a story - learn to read them!</p>
            `;

            completeLab('lab7');
        }

        // Helper functions
        function toggleCheck(element) {
            element.classList.toggle('checked');
        }

        function completeLab(labId) {
            const lab = labs.find(l => l.id === labId);
            if (lab && !lab.completed) {
                lab.completed = true;
                renderLabNav();
                updateOverallProgress();
            }
        }

        function updateOverallProgress() {
            const completed = labs.filter(l => l.completed).length;
            const total = labs.length;
            const percent = (completed / total) * 100;

            const bar = document.getElementById('overallProgress');
            bar.style.width = percent + '%';
            bar.textContent = `${completed} / ${total} Labs Completed`;
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', init);
    </script>
<script src="../../../components/FluxCapacitor.js"></script>
</body>
</html>