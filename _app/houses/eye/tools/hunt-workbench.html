<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Threat Hunt Workbench - Eye House</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a0b2e 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 20px;
            background: linear-gradient(135deg, #c084fc 0%, #06b6d4 100%);
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(192, 132, 252, 0.3);
        }

        header h1 {
            font-size: 2.5em;
            color: #0f0f23;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.2em;
            color: #1a0b2e;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            padding: 10px 25px;
            background: rgba(192, 132, 252, 0.2);
            border: 2px solid #c084fc;
            border-radius: 8px;
            color: #c084fc;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: rgba(192, 132, 252, 0.3);
            transform: translateX(-5px);
        }

        .tool-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-button {
            padding: 15px 30px;
            background: rgba(30, 30, 60, 0.6);
            border: 2px solid #c084fc;
            border-radius: 10px;
            color: #c084fc;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        .tab-button:hover {
            background: rgba(192, 132, 252, 0.2);
            transform: translateY(-2px);
        }

        .tab-button.active {
            background: linear-gradient(135deg, #c084fc 0%, #a78bfa 100%);
            color: #0f0f23;
            box-shadow: 0 5px 20px rgba(192, 132, 252, 0.4);
        }

        .tool-section {
            display: none;
            background: rgba(30, 30, 60, 0.6);
            border: 2px solid #c084fc;
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }

        .tool-section.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tool-section h2 {
            color: #c084fc;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #06b6d4;
        }

        .tool-section h3 {
            color: #06b6d4;
            font-size: 1.4em;
            margin: 20px 0 10px 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #06b6d4;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            background: rgba(26, 26, 46, 0.8);
            border: 2px solid #c084fc;
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 1em;
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
            font-family: 'Courier New', monospace;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #06b6d4;
            box-shadow: 0 0 10px rgba(6, 182, 212, 0.3);
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #c084fc 0%, #a78bfa 100%);
            color: #0f0f23;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(192, 132, 252, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .output-box {
            background: #1a1a2e;
            border: 2px solid #06b6d4;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            color: #06b6d4;
            line-height: 1.6;
        }

        .output-box:empty::before {
            content: "Output will appear here...";
            color: #666;
            font-style: italic;
        }

        .hypothesis-template {
            background: rgba(6, 182, 212, 0.1);
            border: 2px solid #06b6d4;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .hypothesis-template strong {
            color: #06b6d4;
            display: block;
            margin-bottom: 5px;
        }

        .stack-result {
            background: rgba(26, 26, 46, 0.8);
            border-left: 4px solid #c084fc;
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .stack-result.outlier {
            border-left-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .stack-result .count {
            color: #06b6d4;
            font-weight: bold;
            margin-right: 10px;
        }

        .stack-result .value {
            color: #e0e0e0;
        }

        .technique-card {
            background: rgba(26, 26, 46, 0.8);
            border: 2px solid #c084fc;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .technique-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(192, 132, 252, 0.3);
        }

        .technique-card h4 {
            color: #c084fc;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .technique-card p {
            color: #d0d0d0;
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .technique-card .hunt-ideas {
            background: rgba(6, 182, 212, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }

        .technique-card.expanded .hunt-ideas {
            display: block;
        }

        .journal-entry {
            background: rgba(26, 26, 46, 0.8);
            border: 2px solid #c084fc;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .journal-entry .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #06b6d4;
        }

        .journal-entry .entry-title {
            color: #c084fc;
            font-size: 1.3em;
            font-weight: bold;
        }

        .journal-entry .entry-date {
            color: #06b6d4;
            font-size: 0.9em;
        }

        .journal-entry .entry-content {
            color: #e0e0e0;
            line-height: 1.6;
        }

        .journal-entry .entry-tags {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tag {
            background: rgba(192, 132, 252, 0.2);
            color: #c084fc;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .ioc-result {
            background: rgba(26, 26, 46, 0.8);
            border-left: 4px solid #22c55e;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .ioc-result.malicious {
            border-left-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .ioc-result.suspicious {
            border-left-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        .query-builder {
            background: rgba(26, 26, 46, 0.8);
            border: 2px solid #c084fc;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .info-box {
            background: rgba(6, 182, 212, 0.1);
            border-left: 5px solid #06b6d4;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .info-box strong {
            color: #06b6d4;
            display: block;
            margin-bottom: 5px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: rgba(26, 26, 46, 0.8);
            border: 2px solid #06b6d4;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .stat-card .stat-value {
            color: #c084fc;
            font-size: 2em;
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        .stat-card .stat-label {
            color: #06b6d4;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .tool-tabs {
                flex-direction: column;
            }

            .tab-button {
                width: 100%;
            }

            .tool-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">‚Üê Back to Eye House</a>

        <header>
            <h1>Threat Hunt Workbench</h1>
            <p>Systematic Hunting Methodology and Analysis Tools</p>
        </header>

        <div class="tool-tabs">
            <button class="tab-button active" onclick="switchTab('hypothesis')">Hypothesis Builder</button>
            <button class="tab-button" onclick="switchTab('stack')">Stack Analysis</button>
            <button class="tab-button" onclick="switchTab('attack')">ATT&CK Browser</button>
            <button class="tab-button" onclick="switchTab('journal')">Hunt Journal</button>
            <button class="tab-button" onclick="switchTab('ioc')">IOC Checker</button>
            <button class="tab-button" onclick="switchTab('query')">Query Generator</button>
        </div>

        <!-- Hypothesis Builder -->
        <div id="hypothesis" class="tool-section active">
            <h2>Hypothesis Builder</h2>
            <p>Structure your hunt with a testable hypothesis using the IF-AND-THEN-WHERE framework.</p>

            <div class="hypothesis-template">
                <strong>Hypothesis Framework:</strong>
                <p>IF [adversary behavior] AND [environmental condition] THEN [observable indicator] WHERE [data source]</p>
            </div>

            <div class="form-group">
                <label>Hunt Title</label>
                <input type="text" id="hunt-title" placeholder="e.g., Scheduled Task Persistence Hunt">
            </div>

            <div class="form-group">
                <label>IF (Adversary Behavior)</label>
                <input type="text" id="hyp-if" placeholder="e.g., An attacker has gained initial access and wants to maintain persistence">
            </div>

            <div class="form-group">
                <label>AND (Environmental Condition)</label>
                <input type="text" id="hyp-and" placeholder="e.g., They have local administrative privileges">
            </div>

            <div class="form-group">
                <label>THEN (Observable Indicator)</label>
                <input type="text" id="hyp-then" placeholder="e.g., They will create a scheduled task pointing to malicious payload">
            </div>

            <div class="form-group">
                <label>WHERE (Data Sources)</label>
                <textarea id="hyp-where" placeholder="e.g., Windows Event Log 4698, Sysmon Event ID 1, EDR process creation logs"></textarea>
            </div>

            <div class="form-group">
                <label>MITRE ATT&CK Technique (Optional)</label>
                <input type="text" id="hyp-technique" placeholder="e.g., T1053.005 - Scheduled Task/Job">
            </div>

            <div class="button-group">
                <button class="btn" onclick="generateHypothesis()">Generate Hypothesis Document</button>
                <button class="btn-secondary btn" onclick="saveHypothesis()">Save to Journal</button>
                <button class="btn-danger btn" onclick="clearHypothesis()">Clear</button>
            </div>

            <div id="hypothesis-output" class="output-box"></div>
        </div>

        <!-- Stack Analysis -->
        <div id="stack" class="tool-section">
            <h2>Stack Analysis Tool</h2>
            <p>Perform frequency analysis to identify outliers. Paste data (one item per line) and find statistical anomalies.</p>

            <div class="info-box">
                <strong>How to Use:</strong>
                <p>Paste a list of values (process names, IP addresses, usernames, etc.) with one entry per line. The tool will count occurrences and highlight rare outliers.</p>
            </div>

            <div class="form-group">
                <label>Data to Analyze (one entry per line)</label>
                <textarea id="stack-data" placeholder="explorer.exe&#10;chrome.exe&#10;explorer.exe&#10;svchost.exe&#10;malware.exe&#10;explorer.exe&#10;chrome.exe"></textarea>
            </div>

            <div class="form-group">
                <label>Outlier Threshold (count less than or equal to)</label>
                <input type="number" id="outlier-threshold" value="5" min="1">
            </div>

            <div class="button-group">
                <button class="btn" onclick="analyzeStack()">Analyze Stack</button>
                <button class="btn-secondary btn" onclick="loadSampleData()">Load Sample Data</button>
                <button class="btn-danger btn" onclick="clearStack()">Clear</button>
            </div>

            <div id="stack-stats" class="stats-grid"></div>
            <div id="stack-output" class="output-box"></div>
        </div>

        <!-- ATT&CK Browser -->
        <div id="attack" class="tool-section">
            <h2>MITRE ATT&CK Technique Browser</h2>
            <p>Select a technique to view hunting ideas and detection strategies.</p>

            <div class="form-group">
                <label>Select Tactic</label>
                <select id="tactic-select" onchange="filterTechniques()">
                    <option value="all">All Tactics</option>
                    <option value="persistence">Persistence</option>
                    <option value="credential-access">Credential Access</option>
                    <option value="lateral-movement">Lateral Movement</option>
                    <option value="command-control">Command and Control</option>
                    <option value="exfiltration">Exfiltration</option>
                </select>
            </div>

            <div id="techniques-container"></div>
        </div>

        <!-- Hunt Journal -->
        <div id="journal" class="tool-section">
            <h2>Hunt Journal</h2>
            <p>Document your hunting activities, findings, and lessons learned.</p>

            <div class="form-group">
                <label>Hunt Title</label>
                <input type="text" id="journal-title" placeholder="e.g., PowerShell Empire Detection">
            </div>

            <div class="form-group">
                <label>Hunt Type</label>
                <select id="journal-type">
                    <option value="hypothesis">Hypothesis-Driven</option>
                    <option value="data">Data-Driven</option>
                    <option value="intel">Intelligence-Driven</option>
                </select>
            </div>

            <div class="form-group">
                <label>Findings</label>
                <textarea id="journal-findings" placeholder="What did you discover?"></textarea>
            </div>

            <div class="form-group">
                <label>Outcome</label>
                <select id="journal-outcome">
                    <option value="threat-found">Threat Found</option>
                    <option value="false-positive">False Positive</option>
                    <option value="inconclusive">Inconclusive</option>
                    <option value="no-findings">No Findings (Validated Defenses)</option>
                </select>
            </div>

            <div class="form-group">
                <label>Next Steps / Recommendations</label>
                <textarea id="journal-recommendations" placeholder="What should be done next?"></textarea>
            </div>

            <div class="button-group">
                <button class="btn" onclick="saveJournalEntry()">Save Entry</button>
                <button class="btn-danger btn" onclick="clearJournal()">Clear Form</button>
            </div>

            <h3>Recent Hunt Entries</h3>
            <div id="journal-entries"></div>
        </div>

        <!-- IOC Checker -->
        <div id="ioc" class="tool-section">
            <h2>IOC Checker</h2>
            <p>Check indicators against sample threat intelligence database.</p>

            <div class="info-box">
                <strong>Educational Tool:</strong>
                <p>This simulates checking IOCs against a threat intelligence feed. In production, you'd integrate with MISP, ThreatConnect, or commercial feeds.</p>
            </div>

            <div class="form-group">
                <label>IOC Type</label>
                <select id="ioc-type">
                    <option value="ip">IP Address</option>
                    <option value="domain">Domain Name</option>
                    <option value="hash">File Hash</option>
                    <option value="email">Email Address</option>
                </select>
            </div>

            <div class="form-group">
                <label>Indicators (one per line)</label>
                <textarea id="ioc-data" placeholder="192.168.1.100&#10;malicious-domain.com&#10;admin@phishing-site.com"></textarea>
            </div>

            <div class="button-group">
                <button class="btn" onclick="checkIOCs()">Check IOCs</button>
                <button class="btn-secondary btn" onclick="loadSampleIOCs()">Load Sample IOCs</button>
                <button class="btn-danger btn" onclick="clearIOCs()">Clear</button>
            </div>

            <div id="ioc-output" class="output-box"></div>
        </div>

        <!-- Query Generator -->
        <div id="query" class="tool-section">
            <h2>Query Generator</h2>
            <p>Build hunting queries for popular SIEM platforms.</p>

            <div class="form-group">
                <label>SIEM Platform</label>
                <select id="query-platform">
                    <option value="splunk">Splunk (SPL)</option>
                    <option value="elastic">Elastic (KQL)</option>
                    <option value="sentinel">Microsoft Sentinel (KQL)</option>
                </select>
            </div>

            <div class="form-group">
                <label>Hunt Scenario</label>
                <select id="query-scenario" onchange="generateQuery()">
                    <option value="">Select a scenario...</option>
                    <option value="scheduled-task">Hunt for Scheduled Task Creation</option>
                    <option value="lsass-access">Hunt for LSASS Memory Access</option>
                    <option value="psexec">Hunt for PsExec Lateral Movement</option>
                    <option value="dns-tunneling">Hunt for DNS Tunneling</option>
                    <option value="powershell-encoded">Hunt for Encoded PowerShell</option>
                    <option value="rare-processes">Hunt for Rare Process Names</option>
                </select>
            </div>

            <div class="query-builder">
                <h3>Generated Query:</h3>
                <div id="query-output" class="output-box"></div>
            </div>

            <div class="button-group">
                <button class="btn" onclick="copyQuery()">Copy Query</button>
                <button class="btn-secondary btn" onclick="exportQuery()">Export to Hunt Journal</button>
            </div>

            <div class="info-box">
                <strong>Customization Tips:</strong>
                <p>Modify generated queries to match your environment. Add exclusions for known-good processes, adjust time ranges, and refine filters based on your baseline.</p>
            </div>
        </div>
    </div>

    <script>
        // Tab switching
        function switchTab(tabName) {
            // Hide all sections
            document.querySelectorAll('.tool-section').forEach(section => {
                section.classList.remove('active');
            });

            // Deactivate all buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            // Show selected section
            document.getElementById(tabName).classList.add('active');

            // Activate clicked button
            event.target.classList.add('active');
        }

        // Hypothesis Builder Functions
        function generateHypothesis() {
            const title = document.getElementById('hunt-title').value;
            const ifPart = document.getElementById('hyp-if').value;
            const andPart = document.getElementById('hyp-and').value;
            const thenPart = document.getElementById('hyp-then').value;
            const wherePart = document.getElementById('hyp-where').value;
            const technique = document.getElementById('hyp-technique').value;

            if (!title || !ifPart || !andPart || !thenPart || !wherePart) {
                alert('Please fill in all required fields');
                return;
            }

            const output = `
=== THREAT HUNT HYPOTHESIS ===
Hunt ID: HUNT-${new Date().getFullYear()}-${String(Math.floor(Math.random() * 1000)).padStart(3, '0')}
Title: ${title}
Date: ${new Date().toLocaleDateString()}
${technique ? `ATT&CK Technique: ${technique}\n` : ''}
HYPOTHESIS:
IF: ${ifPart}
AND: ${andPart}
THEN: ${thenPart}
WHERE: ${wherePart}

HUNT PLAN:
1. Query data sources identified above
2. Apply stack counting to find outliers
3. Investigate rare occurrences
4. Correlate findings with timeline
5. Document results and create detections if threats found

STATUS: Ready to Execute
            `.trim();

            document.getElementById('hypothesis-output').textContent = output;
        }

        function saveHypothesis() {
            const title = document.getElementById('hunt-title').value;
            if (!title) {
                alert('Please enter a hunt title first');
                return;
            }

            const entry = {
                title: title,
                type: 'hypothesis',
                findings: document.getElementById('hypothesis-output').textContent,
                outcome: 'planned',
                date: new Date().toISOString()
            };

            let journal = JSON.parse(localStorage.getItem('huntJournal') || '[]');
            journal.unshift(entry);
            localStorage.setItem('huntJournal', JSON.stringify(journal));

            alert('Hypothesis saved to Hunt Journal!');
        }

        function clearHypothesis() {
            document.getElementById('hunt-title').value = '';
            document.getElementById('hyp-if').value = '';
            document.getElementById('hyp-and').value = '';
            document.getElementById('hyp-then').value = '';
            document.getElementById('hyp-where').value = '';
            document.getElementById('hyp-technique').value = '';
            document.getElementById('hypothesis-output').textContent = '';
        }

        // Stack Analysis Functions
        function analyzeStack() {
            const data = document.getElementById('stack-data').value.trim();
            if (!data) {
                alert('Please enter data to analyze');
                return;
            }

            const threshold = parseInt(document.getElementById('outlier-threshold').value);
            const items = data.split('\n').map(item => item.trim()).filter(item => item);

            // Count occurrences
            const counts = {};
            items.forEach(item => {
                counts[item] = (counts[item] || 0) + 1;
            });

            // Sort by count
            const sorted = Object.entries(counts).sort((a, b) => a[1] - b[1]);

            // Generate statistics
            const totalItems = items.length;
            const uniqueItems = sorted.length;
            const outliers = sorted.filter(([_, count]) => count <= threshold).length;

            const statsHTML = `
                <div class="stat-card">
                    <span class="stat-value">${totalItems}</span>
                    <span class="stat-label">Total Entries</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value">${uniqueItems}</span>
                    <span class="stat-label">Unique Values</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value">${outliers}</span>
                    <span class="stat-label">Outliers Found</span>
                </div>
            `;
            document.getElementById('stack-stats').innerHTML = statsHTML;

            // Generate output
            let output = '=== STACK ANALYSIS RESULTS ===\n\n';
            output += 'Items sorted by frequency (rarest first):\n\n';

            sorted.forEach(([item, count]) => {
                const isOutlier = count <= threshold;
                const div = document.createElement('div');
                div.className = `stack-result ${isOutlier ? 'outlier' : ''}`;
                div.innerHTML = `<span class="count">${count}x</span><span class="value">${item}</span> ${isOutlier ? '‚ö†Ô∏è OUTLIER' : ''}`;

                const container = document.getElementById('stack-output');
                container.appendChild(div);
            });
        }

        function loadSampleData() {
            const sample = `explorer.exe
chrome.exe
explorer.exe
svchost.exe
explorer.exe
chrome.exe
svchost.exe
explorer.exe
notepad.exe
chrome.exe
mimikatz.exe
explorer.exe
chrome.exe
powershell.exe
cmd.exe
explorer.exe
suspicious-tool.exe
explorer.exe
chrome.exe`;
            document.getElementById('stack-data').value = sample;
        }

        function clearStack() {
            document.getElementById('stack-data').value = '';
            document.getElementById('stack-output').innerHTML = '';
            document.getElementById('stack-stats').innerHTML = '';
        }

        // ATT&CK Browser Functions
        const techniques = [
            {
                id: 'T1053.005',
                name: 'Scheduled Task/Job: Scheduled Task',
                tactic: 'persistence',
                description: 'Adversaries may abuse the Windows Task Scheduler to perform task scheduling for initial or recurring execution of malicious code.',
                huntIdeas: [
                    'Query Windows Event ID 4698 (scheduled task created)',
                    'Look for schtasks.exe execution with unusual parameters',
                    'Find tasks created by non-admin tools or scripts',
                    'Identify tasks pointing to temporary directories or suspicious paths',
                    'Stack count task creation by creator to find outliers'
                ],
                dataSources: ['Windows Event Logs', 'Sysmon', 'EDR Process Logs']
            },
            {
                id: 'T1003.001',
                name: 'OS Credential Dumping: LSASS Memory',
                tactic: 'credential-access',
                description: 'Adversaries may attempt to access credential material stored in the process memory of LSASS.',
                huntIdeas: [
                    'Monitor for process access to lsass.exe (Sysmon Event ID 10)',
                    'Look for MiniDump file creation targeting LSASS',
                    'Detect unusual processes opening handles to LSASS',
                    'Find execution of known credential dumping tools (mimikatz, procdump)',
                    'Stack count processes accessing LSASS memory'
                ],
                dataSources: ['Sysmon', 'EDR', 'Windows Security Logs']
            },
            {
                id: 'T1021.002',
                name: 'Remote Services: SMB/Windows Admin Shares',
                tactic: 'lateral-movement',
                description: 'Adversaries may use SMB and Windows admin shares to move laterally through a network.',
                huntIdeas: [
                    'Hunt for net use commands to admin shares (C$, ADMIN$)',
                    'Look for PsExec execution and service installation',
                    'Detect unusual network logon events (Event ID 4624 Type 3)',
                    'Find connections to ADMIN$ from non-admin workstations',
                    'Stack count source/destination pairs for lateral movement'
                ],
                dataSources: ['Windows Event Logs', 'Network Logs', 'EDR']
            },
            {
                id: 'T1071.004',
                name: 'Application Layer Protocol: DNS',
                tactic: 'command-control',
                description: 'Adversaries may communicate using DNS to avoid detection since DNS is a common protocol.',
                huntIdeas: [
                    'Find abnormally high DNS query volumes per host',
                    'Look for long subdomain names (potential data exfil)',
                    'Detect periodic DNS queries (beaconing)',
                    'Hunt for queries to newly registered domains',
                    'Analyze DNS TXT record queries for encoded data'
                ],
                dataSources: ['DNS Logs', 'Network Logs', 'Proxy Logs']
            },
            {
                id: 'T1048.003',
                name: 'Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted Protocol',
                tactic: 'exfiltration',
                description: 'Adversaries may use unencrypted protocols to exfiltrate data.',
                huntIdeas: [
                    'Hunt for large outbound data transfers',
                    'Look for FTP, HTTP (not HTTPS) with large uploads',
                    'Detect unusual protocols or ports for data transfer',
                    'Find workstations initiating server-like connections',
                    'Stack count outbound data volume by host to find outliers'
                ],
                dataSources: ['Network Logs', 'Firewall Logs', 'Proxy Logs']
            }
        ];

        function filterTechniques() {
            const tactic = document.getElementById('tactic-select').value;
            const container = document.getElementById('techniques-container');
            container.innerHTML = '';

            const filtered = tactic === 'all' ? techniques : techniques.filter(t => t.tactic === tactic);

            filtered.forEach(tech => {
                const card = document.createElement('div');
                card.className = 'technique-card';
                card.innerHTML = `
                    <h4>${tech.id} - ${tech.name}</h4>
                    <p>${tech.description}</p>
                    <div class="hunt-ideas">
                        <strong style="color: #06b6d4;">Hunting Ideas:</strong>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            ${tech.huntIdeas.map(idea => `<li style="margin-bottom: 8px;">${idea}</li>`).join('')}
                        </ul>
                        <strong style="color: #06b6d4; display: block; margin-top: 10px;">Data Sources:</strong>
                        <p style="margin-top: 5px;">${tech.dataSources.join(', ')}</p>
                    </div>
                `;
                card.onclick = () => card.classList.toggle('expanded');
                container.appendChild(card);
            });
        }

        // Hunt Journal Functions
        function saveJournalEntry() {
            const title = document.getElementById('journal-title').value;
            const type = document.getElementById('journal-type').value;
            const findings = document.getElementById('journal-findings').value;
            const outcome = document.getElementById('journal-outcome').value;
            const recommendations = document.getElementById('journal-recommendations').value;

            if (!title || !findings) {
                alert('Please fill in at least title and findings');
                return;
            }

            const entry = {
                title,
                type,
                findings,
                outcome,
                recommendations,
                date: new Date().toISOString()
            };

            let journal = JSON.parse(localStorage.getItem('huntJournal') || '[]');
            journal.unshift(entry);
            localStorage.setItem('huntJournal', JSON.stringify(journal));

            alert('Hunt entry saved!');
            clearJournal();
            loadJournalEntries();
        }

        function loadJournalEntries() {
            const journal = JSON.parse(localStorage.getItem('huntJournal') || '[]');
            const container = document.getElementById('journal-entries');
            container.innerHTML = '';

            if (journal.length === 0) {
                container.innerHTML = '<p style="color: #666; font-style: italic;">No hunt entries yet. Complete a hunt and document it!</p>';
                return;
            }

            journal.forEach((entry, index) => {
                const div = document.createElement('div');
                div.className = 'journal-entry';
                div.innerHTML = `
                    <div class="entry-header">
                        <div class="entry-title">${entry.title}</div>
                        <div class="entry-date">${new Date(entry.date).toLocaleDateString()}</div>
                    </div>
                    <div class="entry-content">
                        <p><strong style="color: #06b6d4;">Findings:</strong> ${entry.findings}</p>
                        ${entry.recommendations ? `<p style="margin-top: 10px;"><strong style="color: #06b6d4;">Recommendations:</strong> ${entry.recommendations}</p>` : ''}
                    </div>
                    <div class="entry-tags">
                        <span class="tag">${entry.type}</span>
                        <span class="tag">${entry.outcome}</span>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function clearJournal() {
            document.getElementById('journal-title').value = '';
            document.getElementById('journal-findings').value = '';
            document.getElementById('journal-recommendations').value = '';
        }

        // IOC Checker Functions
        const knownMaliciousIOCs = {
            ip: ['192.168.100.666', '10.0.0.666', '203.0.113.42', '198.51.100.99'],
            domain: ['malicious-domain.com', 'evil-site.net', 'phishing-portal.org', 'c2-server.biz'],
            hash: ['d41d8cd98f00b204e9800998ecf8427e', '5d41402abc4b2a76b9719d911017c592'],
            email: ['attacker@evil.com', 'phishing@malware.net', 'admin@fake-bank.com']
        };

        const suspiciousIOCs = {
            ip: ['185.220.101.1', '45.33.32.156'],
            domain: ['free-downloads.tk', 'bit-coin-wallet.ml'],
            hash: ['098f6bcd4621d373cade4e832627b4f6'],
            email: ['noreply@suspicious.com']
        };

        function checkIOCs() {
            const type = document.getElementById('ioc-type').value;
            const data = document.getElementById('ioc-data').value.trim();

            if (!data) {
                alert('Please enter indicators to check');
                return;
            }

            const indicators = data.split('\n').map(i => i.trim()).filter(i => i);
            const output = document.getElementById('ioc-output');
            output.innerHTML = '';

            indicators.forEach(ioc => {
                const div = document.createElement('div');

                if (knownMaliciousIOCs[type]?.includes(ioc)) {
                    div.className = 'ioc-result malicious';
                    div.innerHTML = `<strong>üö® MALICIOUS:</strong> ${ioc}<br><small>Known threat indicator - Investigate immediately</small>`;
                } else if (suspiciousIOCs[type]?.includes(ioc)) {
                    div.className = 'ioc-result suspicious';
                    div.innerHTML = `<strong>‚ö†Ô∏è SUSPICIOUS:</strong> ${ioc}<br><small>Potentially malicious - Further investigation recommended</small>`;
                } else {
                    div.className = 'ioc-result';
                    div.innerHTML = `<strong>‚úì CLEAN:</strong> ${ioc}<br><small>No matches in threat intelligence database</small>`;
                }

                output.appendChild(div);
            });
        }

        function loadSampleIOCs() {
            document.getElementById('ioc-data').value = `malicious-domain.com
google.com
evil-site.net
microsoft.com
phishing-portal.org`;
        }

        function clearIOCs() {
            document.getElementById('ioc-data').value = '';
            document.getElementById('ioc-output').innerHTML = '';
        }

        // Query Generator Functions
        function generateQuery() {
            const platform = document.getElementById('query-platform').value;
            const scenario = document.getElementById('query-scenario').value;

            if (!scenario) return;

            const queries = {
                splunk: {
                    'scheduled-task': `index=windows EventCode=4698
| search TaskName!="*Microsoft*" TaskName!="*Google*"
| stats count by ComputerName, TaskName, Command
| where count < 5
| sort count`,
                    'lsass-access': `index=sysmon EventCode=10 TargetImage="*lsass.exe"
| search SourceImage!="*svchost.exe" SourceImage!="*wininit.exe"
| stats count by SourceImage, SourceCommandLine
| sort count`,
                    'psexec': `index=windows (EventCode=7045 Service_Name="PSEXESVC") OR (process_name="psexec.exe")
| stats count by ComputerName, User, process_name
| sort _time`,
                    'dns-tunneling': `index=dns
| stats count by src_ip, query
| where count > 100
| sort count desc`,
                    'powershell-encoded': `index=windows process_name="powershell.exe" CommandLine="*-enc*" OR CommandLine="*-encodedcommand*"
| table _time, ComputerName, User, CommandLine`,
                    'rare-processes': `index=edr sourcetype=process
| stats count by process_name
| where count < 10
| sort count`
                },
                elastic: {
                    'scheduled-task': `event.code: 4698 AND NOT task.name: (*Microsoft* OR *Google*)
| stats count() by host.name, task.name`,
                    'lsass-access': `event.code: 10 AND process.target.name: "lsass.exe" AND NOT process.name: (svchost.exe OR wininit.exe)`,
                    'psexec': `event.code: 7045 AND service.name: "PSEXESVC" OR process.name: "psexec.exe"`,
                    'dns-tunneling': `event.category: "dns" | stats count() by source.ip, dns.question.name | where count > 100`,
                    'powershell-encoded': `process.name: "powershell.exe" AND process.command_line: (*-enc* OR *-encodedcommand*)`,
                    'rare-processes': `event.category: "process" | rare process.name by host.name`
                },
                sentinel: {
                    'scheduled-task': `SecurityEvent
| where EventID == 4698
| where TaskName !contains "Microsoft" and TaskName !contains "Google"
| summarize count() by Computer, TaskName`,
                    'lsass-access': `SecurityEvent
| where EventID == 10
| where TargetImage contains "lsass.exe"
| where SourceImage !contains "svchost.exe"
| summarize count() by SourceImage, CommandLine`,
                    'psexec': `SecurityEvent
| where (EventID == 7045 and ServiceName == "PSEXESVC") or ProcessName == "psexec.exe"
| project TimeGenerated, Computer, Account, ProcessName`,
                    'dns-tunneling': `DnsEvents
| summarize count() by ClientIP, Name
| where count_ > 100
| order by count_ desc`,
                    'powershell-encoded': `SecurityEvent
| where ProcessName == "powershell.exe"
| where CommandLine contains "-enc" or CommandLine contains "-encodedcommand"
| project TimeGenerated, Computer, Account, CommandLine`,
                    'rare-processes': `SecurityEvent
| where EventID == 4688
| summarize count() by NewProcessName
| where count_ < 10
| order by count_ asc`
                }
            };

            const query = queries[platform][scenario];
            document.getElementById('query-output').textContent = query;
        }

        function copyQuery() {
            const query = document.getElementById('query-output').textContent;
            if (!query) {
                alert('Generate a query first');
                return;
            }
            navigator.clipboard.writeText(query);
            alert('Query copied to clipboard!');
        }

        function exportQuery() {
            const query = document.getElementById('query-output').textContent;
            const scenario = document.getElementById('query-scenario').value;

            if (!query) {
                alert('Generate a query first');
                return;
            }

            const entry = {
                title: `Query: ${scenario}`,
                type: 'data',
                findings: query,
                outcome: 'planned',
                date: new Date().toISOString()
            };

            let journal = JSON.parse(localStorage.getItem('huntJournal') || '[]');
            journal.unshift(entry);
            localStorage.setItem('huntJournal', JSON.stringify(journal));

            alert('Query exported to Hunt Journal!');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            filterTechniques();
            loadJournalEntries();
        });
    </script>
<script src="../../../components/FluxCapacitor.js"></script>
</body>
</html>
