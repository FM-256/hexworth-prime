<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIEM Simulator - Eye House</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a0b2e 100%);
            color: #e0e0e0;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #c084fc 0%, #06b6d4 100%);
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(192, 132, 252, 0.3);
        }

        header h1 {
            font-size: 2.5em;
            color: #0f0f23;
            margin-bottom: 10px;
        }

        .tab-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            background: rgba(30, 30, 60, 0.6);
            border: 2px solid #c084fc;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            color: #c084fc;
        }

        .tab:hover {
            background: rgba(192, 132, 252, 0.2);
            transform: translateY(-2px);
        }

        .tab.active {
            background: linear-gradient(135deg, #c084fc 0%, #a78bfa 100%);
            color: #0f0f23;
            border-color: #06b6d4;
        }

        .tool-panel {
            display: none;
            background: rgba(30, 30, 60, 0.6);
            border: 2px solid #c084fc;
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            animation: fadeIn 0.3s ease;
        }

        .tool-panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            color: #c084fc;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #06b6d4;
        }

        h3 {
            color: #06b6d4;
            font-size: 1.5em;
            margin: 20px 0 15px 0;
        }

        .visualization-area {
            background: #1a1a2e;
            border: 2px solid #c084fc;
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
            min-height: 400px;
            position: relative;
        }

        .log-source {
            background: linear-gradient(135deg, #c084fc 0%, #a78bfa 100%);
            color: #0f0f23;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 10px;
            display: inline-block;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease;
            box-shadow: 0 4px 15px rgba(192, 132, 252, 0.4);
        }

        .log-source:hover {
            transform: scale(1.05);
        }

        .log-stream {
            position: absolute;
            width: 4px;
            background: linear-gradient(180deg, #06b6d4, transparent);
            animation: flowDown 2s linear infinite;
        }

        @keyframes flowDown {
            from {
                height: 0;
                opacity: 1;
            }
            to {
                height: 200px;
                opacity: 0;
            }
        }

        .siem-collector {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: #0f0f23;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            margin: 20px auto;
            max-width: 400px;
            box-shadow: 0 6px 20px rgba(6, 182, 212, 0.4);
        }

        .query-builder {
            background: #1a1a2e;
            border: 2px solid #06b6d4;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }

        .query-input {
            width: 100%;
            background: #0f0f23;
            border: 2px solid #c084fc;
            color: #06b6d4;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            margin: 10px 0;
            resize: vertical;
        }

        .query-input:focus {
            outline: none;
            border-color: #06b6d4;
            box-shadow: 0 0 15px rgba(6, 182, 212, 0.3);
        }

        .btn {
            background: linear-gradient(135deg, #c084fc 0%, #06b6d4 100%);
            color: #0f0f23;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(192, 132, 252, 0.5);
        }

        .btn-secondary {
            background: rgba(6, 182, 212, 0.3);
            border: 2px solid #06b6d4;
            color: #06b6d4;
        }

        .result-box {
            background: #0f0f23;
            border: 2px solid #06b6d4;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            color: #22d3ee;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .field-tag {
            background: rgba(192, 132, 252, 0.3);
            border: 1px solid #c084fc;
            padding: 5px 12px;
            border-radius: 5px;
            margin: 5px;
            display: inline-block;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .field-tag:hover {
            background: rgba(192, 132, 252, 0.5);
        }

        .field-tag.selected {
            background: linear-gradient(135deg, #c084fc 0%, #a78bfa 100%);
            color: #0f0f23;
            font-weight: bold;
        }

        .alert-rule-card {
            background: rgba(30, 30, 60, 0.5);
            border: 2px solid #c084fc;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .widget-preview {
            background: #1a1a2e;
            border: 2px solid #06b6d4;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            min-height: 250px;
            position: relative;
        }

        .chart-bar {
            background: linear-gradient(135deg, #c084fc 0%, #06b6d4 100%);
            margin: 5px 0;
            border-radius: 5px;
            transition: width 0.5s ease;
            height: 30px;
            display: flex;
            align-items: center;
            padding-left: 10px;
            color: #0f0f23;
            font-weight: bold;
        }

        .log-entry {
            background: rgba(6, 182, 212, 0.1);
            border-left: 4px solid #06b6d4;
            padding: 10px;
            margin: 8px 0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            transition: background 0.3s ease;
        }

        .log-entry:hover {
            background: rgba(6, 182, 212, 0.2);
        }

        .log-entry.highlight {
            border-left-color: #fb923c;
            background: rgba(251, 146, 60, 0.2);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .dropdown {
            width: 100%;
            background: #1a1a2e;
            border: 2px solid #c084fc;
            color: #e0e0e0;
            padding: 12px;
            border-radius: 8px;
            font-size: 1em;
            margin: 10px 0;
            cursor: pointer;
        }

        .dropdown:focus {
            outline: none;
            border-color: #06b6d4;
        }

        .info-box {
            background: rgba(6, 182, 212, 0.15);
            border-left: 5px solid #06b6d4;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .success-msg {
            background: rgba(34, 197, 94, 0.2);
            border: 2px solid #22c55e;
            color: #86efac;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }

        .error-msg {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
            color: #fca5a5;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }

        .node {
            background: linear-gradient(135deg, #c084fc 0%, #a78bfa 100%);
            color: #0f0f23;
            padding: 15px 25px;
            border-radius: 10px;
            display: inline-block;
            margin: 10px;
            font-weight: bold;
            position: relative;
            cursor: move;
            box-shadow: 0 4px 15px rgba(192, 132, 252, 0.4);
            transition: transform 0.3s ease;
        }

        .node:hover {
            transform: scale(1.05);
        }

        .connection-line {
            position: absolute;
            height: 3px;
            background: linear-gradient(90deg, #06b6d4, #c084fc);
            transform-origin: left center;
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 1.8em;
            }

            .tool-panel {
                padding: 15px;
            }
        }

        .stat-counter {
            font-size: 2em;
            color: #06b6d4;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç SIEM Simulator</h1>
            <p>Interactive Security Information and Event Management Training</p>
        </header>

        <div class="tab-container">
            <div class="tab active" onclick="switchTab('ingestion')">Log Ingestion</div>
            <div class="tab" onclick="switchTab('query')">Query Builder</div>
            <div class="tab" onclick="switchTab('parser')">Log Parser</div>
            <div class="tab" onclick="switchTab('alerts')">Alert Rules</div>
            <div class="tab" onclick="switchTab('dashboard')">Dashboard Designer</div>
            <div class="tab" onclick="switchTab('architecture')">Architecture Builder</div>
        </div>

        <!-- Log Ingestion Visualizer -->
        <div id="ingestion" class="tool-panel active">
            <h2>Log Ingestion Visualizer</h2>
            <p>Watch logs flow from various sources into the SIEM collector</p>

            <div class="info-box">
                <strong>How it works:</strong> Click on any log source to simulate log events being sent to the SIEM.
                The collector processes and normalizes the data before storage.
            </div>

            <div class="visualization-area" id="ingestionViz">
                <div style="text-align: center; margin-bottom: 30px;">
                    <h3>Data Sources</h3>
                    <div class="log-source" onclick="generateLogs('firewall')">üî• Firewall</div>
                    <div class="log-source" onclick="generateLogs('windows')">ü™ü Windows DC</div>
                    <div class="log-source" onclick="generateLogs('linux')">üêß Linux Server</div>
                    <div class="log-source" onclick="generateLogs('webapp')">üåê Web Application</div>
                    <div class="log-source" onclick="generateLogs('ids')">üõ°Ô∏è IDS/IPS</div>
                </div>

                <div id="streamContainer" style="text-align: center; height: 200px; position: relative;"></div>

                <div class="siem-collector">
                    üìä SIEM Collector<br>
                    <small>Processing & Normalizing Events</small>
                </div>

                <div style="margin-top: 30px;">
                    <h3>Recent Events</h3>
                    <div class="stat-counter" id="eventCounter">0</div>
                    <div id="recentLogs" class="result-box" style="max-height: 250px;"></div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="startAutoIngestion()">Start Auto-Ingestion</button>
                <button class="btn btn-secondary" onclick="stopAutoIngestion()">Stop</button>
                <button class="btn btn-secondary" onclick="clearLogs()">Clear Logs</button>
            </div>
        </div>

        <!-- Query Builder -->
        <div id="query" class="tool-panel">
            <h2>SPL Query Builder</h2>
            <p>Build and test Splunk-style queries against simulated log data</p>

            <div class="query-builder">
                <h3>Available Fields</h3>
                <div id="fieldTags">
                    <span class="field-tag" onclick="addToQuery('index=windows')">index=windows</span>
                    <span class="field-tag" onclick="addToQuery('index=firewall')">index=firewall</span>
                    <span class="field-tag" onclick="addToQuery('EventCode=4625')">EventCode=4625</span>
                    <span class="field-tag" onclick="addToQuery('EventCode=4624')">EventCode=4624</span>
                    <span class="field-tag" onclick="addToQuery('action=deny')">action=deny</span>
                    <span class="field-tag" onclick="addToQuery('action=allow')">action=allow</span>
                    <span class="field-tag" onclick="addToQuery('status=404')">status=404</span>
                    <span class="field-tag" onclick="addToQuery('status=200')">status=200</span>
                </div>

                <h3>Your Query</h3>
                <textarea class="query-input" id="queryInput" rows="4" placeholder="Enter your SPL query here...
Example: index=windows EventCode=4625 | stats count by src_ip"></textarea>

                <button class="btn" onclick="executeQuery()">Execute Query</button>
                <button class="btn btn-secondary" onclick="document.getElementById('queryInput').value=''">Clear</button>

                <h3>Query Examples</h3>
                <div class="grid-2">
                    <div class="alert-rule-card">
                        <strong>Failed Login Detection</strong>
                        <div class="log-entry" onclick="loadExample(0)">
                            index=windows EventCode=4625 | stats count by src_ip | where count>5
                        </div>
                    </div>
                    <div class="alert-rule-card">
                        <strong>Web Attack Detection</strong>
                        <div class="log-entry" onclick="loadExample(1)">
                            index=web status=404 | stats count by uri | sort -count
                        </div>
                    </div>
                    <div class="alert-rule-card">
                        <strong>Firewall Denials</strong>
                        <div class="log-entry" onclick="loadExample(2)">
                            index=firewall action=deny | stats count by dest_port
                        </div>
                    </div>
                    <div class="alert-rule-card">
                        <strong>Timeline Analysis</strong>
                        <div class="log-entry" onclick="loadExample(3)">
                            index=* | timechart span=1h count by sourcetype
                        </div>
                    </div>
                </div>
            </div>

            <div id="queryResults"></div>
        </div>

        <!-- Log Parser -->
        <div id="parser" class="tool-panel">
            <h2>Log Parser</h2>
            <p>Paste raw logs to see how SIEM parses them into structured fields</p>

            <div class="grid-2">
                <div>
                    <h3>Raw Log Input</h3>
                    <select class="dropdown" id="logFormat" onchange="loadSampleLog()">
                        <option value="">-- Select Sample Format --</option>
                        <option value="apache">Apache Access Log</option>
                        <option value="syslog">Linux Syslog</option>
                        <option value="windows">Windows Event XML</option>
                        <option value="firewall">Cisco ASA Firewall</option>
                        <option value="json">JSON Format</option>
                    </select>
                    <textarea class="query-input" id="rawLogInput" rows="10" placeholder="Paste raw log data here..."></textarea>
                    <button class="btn" onclick="parseLog()">Parse Log</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('rawLogInput').value=''; document.getElementById('parsedOutput').innerHTML=''">Clear</button>
                </div>

                <div>
                    <h3>Parsed Fields</h3>
                    <div id="parsedOutput" class="result-box" style="min-height: 300px;">
                        Parsed fields will appear here...
                    </div>
                </div>
            </div>

            <div class="info-box" style="margin-top: 20px;">
                <strong>üí° Tip:</strong> Understanding how logs are parsed into fields is crucial for writing effective queries and correlation rules.
                Each field becomes searchable and can be used in analytics.
            </div>
        </div>

        <!-- Alert Rules -->
        <div id="alerts" class="tool-panel">
            <h2>Alert Rule Builder</h2>
            <p>Create correlation rules to detect security threats</p>

            <div class="alert-rule-card">
                <h3>Create New Alert Rule</h3>

                <label style="color: #c084fc; font-weight: bold; display: block; margin-top: 15px;">Rule Name:</label>
                <input type="text" class="query-input" id="ruleName" placeholder="e.g., Brute Force Attack Detection" style="height: 45px;">

                <label style="color: #c084fc; font-weight: bold; display: block; margin-top: 15px;">Condition:</label>
                <select class="dropdown" id="ruleCondition">
                    <option value="count">Event Count Exceeds Threshold</option>
                    <option value="pattern">Specific Pattern Match</option>
                    <option value="anomaly">Anomalous Behavior</option>
                    <option value="correlation">Multi-Source Correlation</option>
                </select>

                <div class="grid-2" style="margin-top: 15px;">
                    <div>
                        <label style="color: #c084fc; font-weight: bold;">Event Type:</label>
                        <select class="dropdown" id="ruleEventType">
                            <option value="failed_login">Failed Login (4625)</option>
                            <option value="admin_login">Admin Login (4672)</option>
                            <option value="firewall_deny">Firewall Deny</option>
                            <option value="web_404">Web 404 Errors</option>
                            <option value="malware">Malware Detection</option>
                        </select>
                    </div>
                    <div>
                        <label style="color: #c084fc; font-weight: bold;">Threshold:</label>
                        <input type="number" class="query-input" id="ruleThreshold" value="5" min="1" style="height: 45px;">
                    </div>
                </div>

                <label style="color: #c084fc; font-weight: bold; display: block; margin-top: 15px;">Time Window:</label>
                <select class="dropdown" id="ruleTimeWindow">
                    <option value="5m">5 minutes</option>
                    <option value="15m">15 minutes</option>
                    <option value="1h">1 hour</option>
                    <option value="24h">24 hours</option>
                </select>

                <label style="color: #c084fc; font-weight: bold; display: block; margin-top: 15px;">Severity:</label>
                <select class="dropdown" id="ruleSeverity">
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                    <option value="critical">Critical</option>
                </select>

                <button class="btn" onclick="createAlertRule()" style="margin-top: 20px;">Create Alert Rule</button>
                <button class="btn btn-secondary" onclick="testAlertRule()">Test Rule</button>
            </div>

            <div id="alertOutput"></div>

            <h3 style="margin-top: 30px;">Active Alert Rules</h3>
            <div id="activeRules">
                <div class="alert-rule-card">
                    <strong style="color: #06b6d4;">Sample Rule: Excessive Failed Logins</strong>
                    <p style="margin: 10px 0;">Triggers when: Failed login count > 5 in 5 minutes</p>
                    <p style="margin: 10px 0;">Severity: <span style="color: #fb923c;">High</span></p>
                    <button class="btn btn-secondary" style="padding: 8px 20px;">Edit</button>
                    <button class="btn btn-secondary" style="padding: 8px 20px;">Disable</button>
                </div>
            </div>
        </div>

        <!-- Dashboard Designer -->
        <div id="dashboard" class="tool-panel">
            <h2>Dashboard Widget Designer</h2>
            <p>Create visualizations for your security operations center</p>

            <div class="grid-2">
                <div class="alert-rule-card">
                    <h3>Widget Configuration</h3>

                    <label style="color: #c084fc; font-weight: bold; display: block; margin-top: 15px;">Widget Type:</label>
                    <select class="dropdown" id="widgetType" onchange="updateWidgetPreview()">
                        <option value="bar">Bar Chart</option>
                        <option value="line">Line Chart</option>
                        <option value="pie">Pie Chart</option>
                        <option value="stats">Statistics Table</option>
                        <option value="counter">Single Value Counter</option>
                    </select>

                    <label style="color: #c084fc; font-weight: bold; display: block; margin-top: 15px;">Data Source:</label>
                    <select class="dropdown" id="widgetData">
                        <option value="failed_logins">Failed Logins by IP</option>
                        <option value="firewall_blocks">Firewall Blocks by Port</option>
                        <option value="web_errors">Web Errors by Status</option>
                        <option value="event_volume">Event Volume Over Time</option>
                        <option value="top_users">Top Active Users</option>
                    </select>

                    <label style="color: #c084fc; font-weight: bold; display: block; margin-top: 15px;">Title:</label>
                    <input type="text" class="query-input" id="widgetTitle" placeholder="Widget Title" style="height: 45px;" value="Security Events">

                    <button class="btn" onclick="createWidget()" style="margin-top: 20px;">Create Widget</button>
                </div>

                <div>
                    <h3>Live Preview</h3>
                    <div class="widget-preview" id="widgetPreview">
                        <h3 style="color: #06b6d4; margin-bottom: 20px;">Security Events</h3>
                        <div id="chartContainer"></div>
                    </div>
                </div>
            </div>

            <div id="dashboardOutput" style="margin-top: 30px;"></div>
        </div>

        <!-- Architecture Builder -->
        <div id="architecture" class="tool-panel">
            <h2>SIEM Architecture Builder</h2>
            <p>Design your SIEM deployment architecture by connecting components</p>

            <div class="info-box">
                <strong>Instructions:</strong> Drag and drop components to design your SIEM architecture.
                Click on components to connect them and build the data flow pipeline.
            </div>

            <div style="text-align: center; margin: 20px 0;">
                <h3>Available Components</h3>
                <button class="btn btn-secondary" onclick="addArchNode('source', 'Firewall')">Add Firewall</button>
                <button class="btn btn-secondary" onclick="addArchNode('source', 'Server')">Add Server</button>
                <button class="btn btn-secondary" onclick="addArchNode('collector', 'Forwarder')">Add Forwarder</button>
                <button class="btn btn-secondary" onclick="addArchNode('processor', 'Indexer')">Add Indexer</button>
                <button class="btn btn-secondary" onclick="addArchNode('interface', 'Search Head')">Add Search Head</button>
                <button class="btn" onclick="clearArchitecture()">Clear All</button>
            </div>

            <div class="visualization-area" id="archCanvas" style="min-height: 500px; position: relative;">
                <div style="text-align: center; color: #666; padding: 50px;">
                    Click buttons above to add components to your architecture
                </div>
            </div>

            <div class="success-msg" id="archSuccess" style="display: none;">
                ‚úì Architecture saved! Components: <span id="archNodeCount">0</span>
            </div>
        </div>
    </div>

    <script>
        let eventCount = 0;
        let autoIngestionInterval = null;
        let architectureNodes = [];

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tool-panel').forEach(panel => panel.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Log Ingestion Simulator
        function generateLogs(source) {
            const logs = {
                firewall: [
                    'Dec 21 10:15:32 firewall iptables: DENY TCP 203.0.113.50:45231 -> 192.168.1.100:22',
                    'Dec 21 10:15:33 firewall iptables: ALLOW TCP 192.168.1.50:52441 -> 8.8.8.8:443',
                    'Dec 21 10:15:34 firewall iptables: DENY UDP 198.51.100.25:1234 -> 192.168.1.1:53'
                ],
                windows: [
                    'EventID=4625 SourceIP=203.0.113.50 Account=Administrator Result=Failed',
                    'EventID=4624 SourceIP=192.168.1.45 Account=jsmith Result=Success LogonType=3',
                    'EventID=4672 Account=Administrator PrivilegeList=SeDebugPrivilege'
                ],
                linux: [
                    'Dec 21 10:15:32 webserver sshd[12345]: Failed password for root from 203.0.113.50',
                    'Dec 21 10:15:33 webserver sudo: analyst : command=/bin/cat /etc/shadow',
                    'Dec 21 10:15:34 webserver CRON[5678]: (root) CMD (/usr/bin/backup.sh)'
                ],
                webapp: [
                    '192.168.1.50 - - [21/Dec/2025:10:15:32] "GET /admin HTTP/1.1" 401 345',
                    '203.0.113.25 - - [21/Dec/2025:10:15:33] "POST /login.php HTTP/1.1" 200 1234',
                    '198.51.100.10 - - [21/Dec/2025:10:15:34] "GET /../../../../etc/passwd HTTP/1.1" 404 512'
                ],
                ids: [
                    'ALERT: SQL Injection attempt detected from 203.0.113.50 -> 192.168.1.100:3306',
                    'ALERT: Port scan detected from 198.51.100.25 targeting 192.168.1.0/24',
                    'INFO: Malware signature match - Trojan.Generic in SMTP traffic'
                ]
            };

            const recentLogsDiv = document.getElementById('recentLogs');
            const selectedLogs = logs[source];

            selectedLogs.forEach((log, index) => {
                setTimeout(() => {
                    eventCount++;
                    document.getElementById('eventCounter').textContent = eventCount;

                    const logDiv = document.createElement('div');
                    logDiv.className = 'log-entry';
                    logDiv.innerHTML = `<strong>[${source.toUpperCase()}]</strong> ${log}`;
                    recentLogsDiv.insertBefore(logDiv, recentLogsDiv.firstChild);

                    // Visual stream effect
                    createStreamEffect(source);

                    // Keep only last 20 logs
                    while (recentLogsDiv.children.length > 20) {
                        recentLogsDiv.removeChild(recentLogsDiv.lastChild);
                    }
                }, index * 300);
            });
        }

        function createStreamEffect(source) {
            const container = document.getElementById('streamContainer');
            const stream = document.createElement('div');
            stream.className = 'log-stream';
            stream.style.left = Math.random() * 80 + 10 + '%';
            container.appendChild(stream);

            setTimeout(() => container.removeChild(stream), 2000);
        }

        function startAutoIngestion() {
            if (autoIngestionInterval) return;

            const sources = ['firewall', 'windows', 'linux', 'webapp', 'ids'];
            autoIngestionInterval = setInterval(() => {
                const randomSource = sources[Math.floor(Math.random() * sources.length)];
                generateLogs(randomSource);
            }, 3000);
        }

        function stopAutoIngestion() {
            if (autoIngestionInterval) {
                clearInterval(autoIngestionInterval);
                autoIngestionInterval = null;
            }
        }

        function clearLogs() {
            document.getElementById('recentLogs').innerHTML = '';
            eventCount = 0;
            document.getElementById('eventCounter').textContent = '0';
        }

        // Query Builder
        function addToQuery(field) {
            const input = document.getElementById('queryInput');
            const currentValue = input.value.trim();

            if (currentValue === '') {
                input.value = field;
            } else if (!currentValue.includes(field)) {
                input.value = currentValue + ' ' + field;
            }
        }

        function loadExample(index) {
            const examples = [
                'index=windows EventCode=4625 | stats count by src_ip | where count>5',
                'index=web status=404 | stats count by uri | sort -count',
                'index=firewall action=deny | stats count by dest_port',
                'index=* | timechart span=1h count by sourcetype'
            ];
            document.getElementById('queryInput').value = examples[index];
        }

        function executeQuery() {
            const query = document.getElementById('queryInput').value;
            const resultsDiv = document.getElementById('queryResults');

            if (!query.trim()) {
                resultsDiv.innerHTML = '<div class="error-msg">Please enter a query</div>';
                return;
            }

            // Simulate query execution
            resultsDiv.innerHTML = '<div class="success-msg">‚úì Query executed successfully</div>';

            const resultBox = document.createElement('div');
            resultBox.className = 'result-box';
            resultBox.innerHTML = `
<strong>Query:</strong> ${query}

<strong>Results:</strong> 3 events found

src_ip          count
203.0.113.50    12
198.51.100.25   8
192.168.1.45    6

Execution time: 0.234 seconds
            `;
            resultsDiv.appendChild(resultBox);
        }

        // Log Parser
        function loadSampleLog() {
            const format = document.getElementById('logFormat').value;
            const samples = {
                apache: '192.168.1.50 - - [21/Dec/2025:10:15:32 +0000] "GET /admin/login.php HTTP/1.1" 401 345 "https://example.com" "Mozilla/5.0"',
                syslog: 'Dec 21 10:15:32 webserver sshd[12345]: Failed password for admin from 203.0.113.50 port 44321 ssh2',
                windows: `<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
  <System>
    <EventID>4625</EventID>
    <TimeCreated SystemTime="2025-12-21T10:15:32.123Z"/>
  </System>
  <EventData>
    <Data Name="TargetUserName">Administrator</Data>
    <Data Name="IpAddress">203.0.113.50</Data>
    <Data Name="LogonType">3</Data>
  </EventData>
</Event>`,
                firewall: 'CEF:0|Cisco|ASA|9.8|106023|Deny tcp src outside:203.0.113.50/52145 dst inside:192.168.1.100/22|High|src=203.0.113.50 dst=192.168.1.100 spt=52145 dpt=22',
                json: `{
  "timestamp": "2025-12-21T10:15:32Z",
  "source_ip": "203.0.113.50",
  "dest_ip": "192.168.1.100",
  "dest_port": 22,
  "action": "DENY",
  "protocol": "TCP",
  "severity": "high"
}`
            };

            if (samples[format]) {
                document.getElementById('rawLogInput').value = samples[format];
            }
        }

        function parseLog() {
            const rawLog = document.getElementById('rawLogInput').value;
            const outputDiv = document.getElementById('parsedOutput');

            if (!rawLog.trim()) {
                outputDiv.innerHTML = '<div class="error-msg">Please enter raw log data</div>';
                return;
            }

            // Simple parsing simulation
            outputDiv.innerHTML = `
<div class="success-msg">‚úì Log parsed successfully</div>

<strong style="color: #c084fc;">Extracted Fields:</strong>

<span style="color: #06b6d4;">timestamp:</span> 2025-12-21T10:15:32Z
<span style="color: #06b6d4;">source_ip:</span> 203.0.113.50
<span style="color: #06b6d4;">dest_ip:</span> 192.168.1.100
<span style="color: #06b6d4;">dest_port:</span> 22
<span style="color: #06b6d4;">action:</span> DENY
<span style="color: #06b6d4;">protocol:</span> TCP
<span style="color: #06b6d4;">severity:</span> high

<strong style="color: #c084fc; display: block; margin-top: 15px;">Normalized Format:</strong>

{
  "_time": "2025-12-21T10:15:32Z",
  "src": "203.0.113.50",
  "dest": "192.168.1.100",
  "dport": 22,
  "action": "blocked",
  "proto": "tcp",
  "severity": "high",
  "source_type": "firewall"
}
            `;
        }

        // Alert Rules
        function createAlertRule() {
            const name = document.getElementById('ruleName').value;
            const threshold = document.getElementById('ruleThreshold').value;
            const timeWindow = document.getElementById('ruleTimeWindow').value;
            const severity = document.getElementById('ruleSeverity').value;
            const eventType = document.getElementById('ruleEventType').value;

            if (!name.trim()) {
                document.getElementById('alertOutput').innerHTML = '<div class="error-msg">Please enter a rule name</div>';
                return;
            }

            document.getElementById('alertOutput').innerHTML = `
                <div class="success-msg">‚úì Alert rule created successfully!</div>
                <div class="alert-rule-card">
                    <strong style="color: #06b6d4;">${name}</strong>
                    <p style="margin: 10px 0;">Condition: ${eventType} count exceeds ${threshold} in ${timeWindow}</p>
                    <p style="margin: 10px 0;">Severity: <span style="color: ${severity === 'critical' ? '#ef4444' : '#fb923c'};">${severity.toUpperCase()}</span></p>
                    <p style="margin: 10px 0; color: #22c55e;">Status: Active</p>
                </div>
            `;
        }

        function testAlertRule() {
            document.getElementById('alertOutput').innerHTML = `
                <div class="success-msg">‚úì Rule test completed</div>
                <div class="result-box">
<strong>Test Results:</strong>

Simulated 100 events over last hour
Rule triggered: 2 times

Alert #1: 10:15 AM - 7 failed logins from 203.0.113.50
Alert #2: 10:42 AM - 6 failed logins from 198.51.100.25

False Positives: 0
Recommendation: Rule is well-tuned
                </div>
            `;
        }

        // Dashboard Designer
        function updateWidgetPreview() {
            createWidget();
        }

        function createWidget() {
            const widgetType = document.getElementById('widgetType').value;
            const dataSource = document.getElementById('widgetData').value;
            const title = document.getElementById('widgetTitle').value || 'Security Events';

            const chartContainer = document.getElementById('chartContainer');

            if (widgetType === 'bar') {
                chartContainer.innerHTML = `
                    <div class="chart-bar" style="width: 85%;">203.0.113.50: 12 events</div>
                    <div class="chart-bar" style="width: 60%;">198.51.100.25: 8 events</div>
                    <div class="chart-bar" style="width: 45%;">192.168.1.45: 6 events</div>
                    <div class="chart-bar" style="width: 30%;">10.0.0.50: 4 events</div>
                `;
            } else if (widgetType === 'counter') {
                chartContainer.innerHTML = `
                    <div class="stat-counter">1,247</div>
                    <div style="text-align: center; color: #c084fc;">Total Events Today</div>
                `;
            } else {
                chartContainer.innerHTML = `
                    <div style="text-align: center; padding: 50px; color: #666;">
                        ${widgetType.charAt(0).toUpperCase() + widgetType.slice(1)} chart preview
                    </div>
                `;
            }

            document.getElementById('widgetPreview').querySelector('h3').textContent = title;
        }

        // Architecture Builder
        function addArchNode(type, label) {
            const canvas = document.getElementById('archCanvas');
            const node = document.createElement('div');
            node.className = 'node';
            node.textContent = label;
            node.style.position = 'absolute';
            node.style.left = Math.random() * 60 + 10 + '%';
            node.style.top = Math.random() * 60 + 10 + '%';

            // Make draggable
            let isDragging = false;
            let currentX, currentY, initialX, initialY;

            node.addEventListener('mousedown', (e) => {
                isDragging = true;
                initialX = e.clientX - node.offsetLeft;
                initialY = e.clientY - node.offsetTop;
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;
                    node.style.left = currentX + 'px';
                    node.style.top = currentY + 'px';
                }
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });

            canvas.appendChild(node);
            architectureNodes.push(node);

            document.getElementById('archNodeCount').textContent = architectureNodes.length;
            document.getElementById('archSuccess').style.display = 'block';

            // Clear placeholder text
            if (architectureNodes.length === 1) {
                canvas.innerHTML = '';
                canvas.appendChild(node);
            }
        }

        function clearArchitecture() {
            const canvas = document.getElementById('archCanvas');
            canvas.innerHTML = '<div style="text-align: center; color: #666; padding: 50px;">Click buttons above to add components to your architecture</div>';
            architectureNodes = [];
            document.getElementById('archSuccess').style.display = 'none';
        }

        // Initialize
        window.onload = function() {
            updateWidgetPreview();
        };
    </script>
<script src="../../../components/FluxCapacitor.js"></script>
</body>
</html>
