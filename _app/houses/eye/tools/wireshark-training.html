<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wireshark Training Lab - Eye House | Hexworth Prime</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0a1e 0%, #1a0b2e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #e0e0e0;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(15, 10, 30, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 2px solid rgba(192, 132, 252, 0.3);
        }

        .header {
            background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%);
            padding: 30px;
            text-align: center;
            border-bottom: 3px solid #c084fc;
        }

        .header h1 {
            color: #ffffff;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            color: #e0f2f1;
            font-size: 1.1em;
        }

        .back-link {
            display: inline-block;
            margin-top: 15px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .back-link:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 0;
            min-height: calc(100vh - 200px);
        }

        .workspace {
            display: flex;
            flex-direction: column;
            border-right: 2px solid rgba(192, 132, 252, 0.3);
        }

        .tab-container {
            display: flex;
            background: rgba(15, 10, 30, 0.9);
            border-bottom: 2px solid rgba(192, 132, 252, 0.3);
            padding: 10px 20px 0;
            gap: 5px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 20px;
            background: rgba(124, 58, 237, 0.3);
            color: #c084fc;
            border: none;
            cursor: pointer;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s ease;
            font-size: 0.95em;
            font-weight: 500;
            border: 2px solid transparent;
            border-bottom: none;
        }

        .tab:hover {
            background: rgba(192, 132, 252, 0.3);
            color: #e0e0e0;
        }

        .tab.active {
            background: rgba(124, 58, 237, 0.6);
            color: #ffffff;
            border-color: #c084fc;
        }

        .tab-content {
            display: none;
            flex: 1;
            overflow: hidden;
            flex-direction: column;
        }

        .tab-content.active {
            display: flex;
        }

        /* Learn Tab Styles */
        .learn-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .learn-section {
            margin-bottom: 30px;
        }

        .learn-section h2 {
            color: #c084fc;
            font-size: 1.8em;
            margin-bottom: 15px;
            border-bottom: 2px solid #06b6d4;
            padding-bottom: 10px;
        }

        .learn-section h3 {
            color: #06b6d4;
            font-size: 1.3em;
            margin: 20px 0 10px;
        }

        .learn-section p {
            line-height: 1.8;
            margin-bottom: 15px;
            color: #d0d0d0;
        }

        .learn-section ul, .learn-section ol {
            margin-left: 25px;
            margin-bottom: 15px;
        }

        .learn-section li {
            line-height: 1.8;
            margin-bottom: 8px;
            color: #d0d0d0;
        }

        .info-box {
            background: rgba(6, 182, 212, 0.15);
            border-left: 4px solid #06b6d4;
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        .info-box.warning {
            background: rgba(251, 146, 60, 0.15);
            border-left-color: #fb923c;
        }

        .info-box.success {
            background: rgba(34, 197, 94, 0.15);
            border-left-color: #22c55e;
        }

        .info-box strong {
            color: #06b6d4;
            display: block;
            margin-bottom: 5px;
        }

        .info-box.warning strong {
            color: #fb923c;
        }

        .info-box.success strong {
            color: #22c55e;
        }

        code {
            background: rgba(124, 58, 237, 0.3);
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #c084fc;
        }

        .code-block {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
            border: 1px solid rgba(192, 132, 252, 0.3);
        }

        .code-block .comment {
            color: #6b7280;
        }

        .code-block .filter {
            color: #22c55e;
        }

        .code-block .operator {
            color: #fb923c;
        }

        /* Filter Lab Styles */
        .filter-lab {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .interface-selector {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px 20px;
            border-bottom: 1px solid rgba(192, 132, 252, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .interface-selector label {
            color: #c084fc;
            font-weight: 600;
        }

        .interface-selector select {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(192, 132, 252, 0.3);
            color: #e0e0e0;
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 0.95em;
        }

        .interface-selector select:focus {
            outline: none;
            border-color: #c084fc;
        }

        .interface-info {
            font-size: 0.85em;
            color: #888;
            flex: 1;
        }

        .filter-toolbar {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid rgba(192, 132, 252, 0.2);
        }

        .filter-input-wrapper {
            flex: 1;
            position: relative;
        }

        #filterInput {
            width: 100%;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(192, 132, 252, 0.3);
            color: #22c55e;
            padding: 12px 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 1em;
        }

        #filterInput:focus {
            outline: none;
            border-color: #22c55e;
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.3);
        }

        #filterInput.invalid {
            border-color: #ef4444;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
        }

        #filterInput.valid {
            border-color: #22c55e;
        }

        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(15, 10, 30, 0.98);
            border: 2px solid rgba(192, 132, 252, 0.5);
            border-top: none;
            border-radius: 0 0 6px 6px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .autocomplete-dropdown.show {
            display: block;
        }

        .autocomplete-item {
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid rgba(192, 132, 252, 0.1);
        }

        .autocomplete-item:hover, .autocomplete-item.selected {
            background: rgba(124, 58, 237, 0.3);
        }

        .autocomplete-item .filter-name {
            color: #22c55e;
            font-family: 'Courier New', monospace;
        }

        .autocomplete-item .filter-desc {
            color: #888;
            font-size: 0.85em;
        }

        .filter-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .apply-btn {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
        }

        .apply-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4);
        }

        .clear-btn {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
            color: #ef4444;
        }

        .clear-btn:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .packet-display {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .packet-list-container {
            flex: 1;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.4);
        }

        .packet-table {
            width: 100%;
            border-collapse: collapse;
        }

        .packet-table th {
            background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%);
            color: white;
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            font-size: 0.9em;
        }

        .packet-table td {
            padding: 10px;
            border-bottom: 1px solid rgba(192, 132, 252, 0.1);
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
        }

        .packet-table tr:hover {
            background: rgba(192, 132, 252, 0.1);
            cursor: pointer;
        }

        .packet-table tr.selected {
            background: rgba(192, 132, 252, 0.2);
            border-left: 4px solid #c084fc;
        }

        .packet-table tr.filtered-out {
            opacity: 0.3;
        }

        .packet-table tr.matched {
            background: rgba(34, 197, 94, 0.15);
        }

        .proto-tcp { color: #22c55e; }
        .proto-udp { color: #06b6d4; }
        .proto-http { color: #f472b6; }
        .proto-https { color: #c084fc; }
        .proto-dns { color: #fbbf24; }
        .proto-icmp { color: #fb923c; }
        .proto-arp { color: #a78bfa; }
        .proto-ssh { color: #34d399; }
        .proto-ftp { color: #f87171; }
        .proto-smb { color: #60a5fa; }

        .stats-bar {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid rgba(192, 132, 252, 0.2);
            font-size: 0.9em;
        }

        .stats-bar .stat {
            color: #888;
        }

        .stats-bar .stat span {
            color: #c084fc;
            font-weight: 600;
        }

        /* Packet Details Panel */
        .packet-details-panel {
            background: rgba(0, 0, 0, 0.5);
            border-top: 2px solid rgba(192, 132, 252, 0.3);
            max-height: 250px;
            overflow-y: auto;
            padding: 15px;
        }

        .layer {
            margin: 10px 0;
            padding: 12px;
            background: rgba(124, 58, 237, 0.1);
            border-left: 4px solid #c084fc;
            border-radius: 0 6px 6px 0;
        }

        .layer h4 {
            color: #c084fc;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .layer-field {
            display: flex;
            margin: 4px 0;
            font-size: 0.85em;
        }

        .layer-field .field-name {
            color: #06b6d4;
            min-width: 150px;
        }

        .layer-field .field-value {
            color: #e0e0e0;
            font-family: 'Courier New', monospace;
        }

        /* Challenges Tab */
        .challenges-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .challenge-card {
            background: rgba(124, 58, 237, 0.15);
            border: 2px solid rgba(192, 132, 252, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .challenge-card:hover {
            border-color: #c084fc;
            transform: translateX(5px);
        }

        .challenge-card.completed {
            border-color: #22c55e;
            background: rgba(34, 197, 94, 0.1);
        }

        .challenge-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .challenge-title {
            color: #c084fc;
            font-size: 1.1em;
            font-weight: 600;
        }

        .challenge-card.completed .challenge-title {
            color: #22c55e;
        }

        .challenge-points {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .challenge-desc {
            color: #b0b0b0;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .challenge-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            padding: 5px 15px;
            border-radius: 5px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-pending {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid #fbbf24;
        }

        .status-complete {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid #22c55e;
        }

        .hint-btn {
            background: rgba(124, 58, 237, 0.3);
            border: none;
            color: #c084fc;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s ease;
        }

        .hint-btn:hover {
            background: rgba(124, 58, 237, 0.5);
        }

        .hint-text {
            display: none;
            margin-top: 10px;
            padding: 10px 15px;
            background: rgba(6, 182, 212, 0.1);
            border-left: 3px solid #06b6d4;
            color: #a0a0a0;
            font-size: 0.9em;
        }

        .hint-text.show {
            display: block;
        }

        /* Reference Tab */
        .reference-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .ref-category {
            margin-bottom: 25px;
        }

        .ref-category h3 {
            color: #c084fc;
            font-size: 1.2em;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid rgba(192, 132, 252, 0.3);
        }

        .ref-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 10px;
        }

        .ref-item {
            background: rgba(124, 58, 237, 0.1);
            border: 1px solid rgba(192, 132, 252, 0.2);
            border-radius: 8px;
            padding: 12px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ref-item:hover {
            border-color: #c084fc;
            background: rgba(124, 58, 237, 0.2);
            transform: translateY(-2px);
        }

        .ref-item .filter-syntax {
            color: #22c55e;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            margin-bottom: 5px;
        }

        .ref-item .filter-explanation {
            color: #888;
            font-size: 0.85em;
        }

        /* Sidebar Learning Panel */
        .sidebar {
            background: rgba(10, 8, 20, 0.9);
            padding: 20px;
            overflow-y: auto;
            border-left: 2px solid rgba(192, 132, 252, 0.3);
        }

        .sidebar h3 {
            color: #c084fc;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(192, 132, 252, 0.3);
            font-size: 1.2em;
        }

        .sidebar h4 {
            color: #06b6d4;
            margin: 15px 0 10px;
            font-size: 1em;
        }

        .sidebar p {
            color: #b0b0b0;
            line-height: 1.6;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .sidebar ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .sidebar li {
            color: #b0b0b0;
            font-size: 0.9em;
            line-height: 1.6;
            margin-bottom: 5px;
        }

        .tip-box {
            background: rgba(6, 182, 212, 0.15);
            border-left: 4px solid #06b6d4;
            padding: 12px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }

        .tip-box strong {
            color: #06b6d4;
            display: block;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .tip-box p {
            margin: 0;
            font-size: 0.85em;
        }

        .quick-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
        }

        .quick-filter-btn {
            background: rgba(124, 58, 237, 0.3);
            border: 1px solid rgba(192, 132, 252, 0.3);
            color: #c084fc;
            padding: 6px 12px;
            border-radius: 5px;
            font-size: 0.8em;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            transition: all 0.3s ease;
        }

        .quick-filter-btn:hover {
            background: rgba(124, 58, 237, 0.5);
            border-color: #c084fc;
        }

        /* Settings/Export Panel */
        .settings-panel {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .settings-section {
            background: rgba(124, 58, 237, 0.1);
            border: 1px solid rgba(192, 132, 252, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .settings-section h3 {
            color: #c084fc;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .settings-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(192, 132, 252, 0.1);
        }

        .settings-row:last-child {
            border-bottom: none;
        }

        .settings-row label {
            color: #b0b0b0;
        }

        .settings-btn {
            background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .settings-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(124, 58, 237, 0.4);
        }

        .settings-btn.secondary {
            background: rgba(124, 58, 237, 0.2);
            border: 2px solid #7c3aed;
        }

        /* Progress tracker */
        .progress-section {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .progress-bar-container {
            background: rgba(124, 58, 237, 0.2);
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-bar {
            background: linear-gradient(90deg, #22c55e 0%, #06b6d4 100%);
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: #888;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .sidebar {
                border-left: none;
                border-top: 2px solid rgba(192, 132, 252, 0.3);
                max-height: 350px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(15, 10, 30, 0.5);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(124, 58, 237, 0.5);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #c084fc;
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .capturing {
            animation: pulse 1s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><span style="font-size: 0.5em; opacity: 0.4; margin-right: 8px;" title="See what flows beneath">üêá</span>ü¶à Wireshark Training Lab</h1>
            <p>Master Network Protocol Analysis Through Hands-On Practice</p>
            <a href="../index.html" class="back-link">‚Üê Back to Eye House</a>
        </div>

        <div class="main-content">
            <div class="workspace">
                <div class="tab-container">
                    <button class="tab active" onclick="switchTab('learn')">üìö Learn</button>
                    <button class="tab" onclick="switchTab('filter-lab')">üî¨ Filter Lab</button>
                    <button class="tab" onclick="switchTab('challenges')">üéØ Challenges</button>
                    <button class="tab" onclick="switchTab('reference')">üìñ Reference</button>
                    <button class="tab" onclick="switchTab('settings')">‚öôÔ∏è Settings</button>
                </div>

                <!-- LEARN TAB -->
                <div id="learn" class="tab-content active">
                    <div class="learn-content">
                        <div class="learn-section">
                            <h2>What is Wireshark?</h2>
                            <p>Wireshark is the world's foremost network protocol analyzer. It lets you capture and interactively browse network traffic running on a computer network. Think of it as a <strong>"network microscope"</strong> that shows you exactly what's happening on your network at the packet level.</p>

                            <div class="info-box">
                                <strong>üéØ Key Concept</strong>
                                <p>Every piece of data sent over a network is broken into small chunks called "packets". Wireshark captures these packets and decodes them so humans can read and understand network communications.</p>
                            </div>

                            <h3>Why Do We Need Wireshark?</h3>
                            <ul>
                                <li><strong>Network Troubleshooting:</strong> Find why applications are slow or connections are dropping</li>
                                <li><strong>Security Analysis:</strong> Detect malware, data exfiltration, and unauthorized access</li>
                                <li><strong>Protocol Learning:</strong> See how TCP/IP, HTTP, DNS, and other protocols actually work</li>
                                <li><strong>Forensics:</strong> Investigate security incidents by analyzing captured traffic</li>
                                <li><strong>Development:</strong> Debug network applications and verify implementations</li>
                            </ul>

                            <h3>The Three Core Skills</h3>
                            <ol>
                                <li><strong>Capturing:</strong> Recording network traffic from an interface</li>
                                <li><strong>Filtering:</strong> Finding the specific packets you need among thousands</li>
                                <li><strong>Analyzing:</strong> Understanding what the packets mean</li>
                            </ol>
                        </div>

                        <div class="learn-section">
                            <h2>Understanding Network Interfaces</h2>
                            <p>Before capturing, you must select which network interface to monitor. This is often a point of confusion for beginners.</p>

                            <div class="info-box warning">
                                <strong>‚ö†Ô∏è Common Mistake</strong>
                                <p>Selecting the wrong interface means capturing no useful traffic. If you're analyzing web traffic but selected a disconnected interface, you'll see nothing!</p>
                            </div>

                            <h3>Common Interface Types</h3>
                            <ul>
                                <li><code>eth0</code>, <code>ens33</code>, <code>enp0s3</code> - Wired Ethernet adapters</li>
                                <li><code>wlan0</code>, <code>wlp2s0</code> - Wireless adapters</li>
                                <li><code>lo</code> - Loopback (local traffic only, like 127.0.0.1)</li>
                                <li><code>any</code> - Capture from ALL interfaces simultaneously</li>
                                <li><code>virbr0</code>, <code>docker0</code> - Virtual bridges for VMs/containers</li>
                            </ul>

                            <div class="info-box success">
                                <strong>‚úÖ Pro Tip</strong>
                                <p>When unsure which interface to use, select "any" to capture from all interfaces. You can then filter by interface later using <code>frame.interface_name == "eth0"</code></p>
                            </div>
                        </div>

                        <div class="learn-section">
                            <h2>Display Filters vs Capture Filters</h2>
                            <p>This distinction confuses many beginners. Understanding the difference is crucial!</p>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                                <div style="background: rgba(34, 197, 94, 0.1); padding: 20px; border-radius: 10px; border: 2px solid #22c55e;">
                                    <h4 style="color: #22c55e; margin-bottom: 10px;">Display Filters</h4>
                                    <ul style="font-size: 0.9em;">
                                        <li>Applied AFTER capture</li>
                                        <li>Hide packets from view</li>
                                        <li>Easy to change on-the-fly</li>
                                        <li>All data still saved</li>
                                        <li>Uses Wireshark syntax</li>
                                    </ul>
                                    <div class="code-block">
                                        <span class="filter">ip.addr == 192.168.1.1</span><br>
                                        <span class="filter">http.request.method == "GET"</span>
                                    </div>
                                </div>
                                <div style="background: rgba(251, 146, 60, 0.1); padding: 20px; border-radius: 10px; border: 2px solid #fb923c;">
                                    <h4 style="color: #fb923c; margin-bottom: 10px;">Capture Filters</h4>
                                    <ul style="font-size: 0.9em;">
                                        <li>Applied DURING capture</li>
                                        <li>Prevents packets from being recorded</li>
                                        <li>Must be set before starting</li>
                                        <li>Filtered data is GONE forever</li>
                                        <li>Uses BPF syntax (tcpdump-style)</li>
                                    </ul>
                                    <div class="code-block">
                                        <span class="filter">host 192.168.1.1</span><br>
                                        <span class="filter">port 80</span>
                                    </div>
                                </div>
                            </div>

                            <div class="info-box">
                                <strong>üéì This Lab Focuses on Display Filters</strong>
                                <p>Display filters are more flexible and commonly used for analysis. They use Wireshark's powerful expression syntax which we'll practice extensively.</p>
                            </div>
                        </div>

                        <div class="learn-section">
                            <h2>Filter Syntax Fundamentals</h2>

                            <h3>Basic Comparison Operators</h3>
                            <div class="code-block">
                                <span class="filter">ip.addr</span> <span class="operator">==</span> 192.168.1.1    <span class="comment"># Equal to</span><br>
                                <span class="filter">ip.addr</span> <span class="operator">!=</span> 10.0.0.1        <span class="comment"># Not equal to</span><br>
                                <span class="filter">frame.len</span> <span class="operator">></span> 1000           <span class="comment"># Greater than</span><br>
                                <span class="filter">tcp.port</span> <span class="operator">>=</span> 1024           <span class="comment"># Greater than or equal</span><br>
                                <span class="filter">udp.port</span> <span class="operator"><</span> 1024            <span class="comment"># Less than (well-known ports)</span>
                            </div>

                            <h3>Logical Operators</h3>
                            <div class="code-block">
                                <span class="filter">http</span> <span class="operator">&&</span> <span class="filter">ip.src</span> == 192.168.1.100    <span class="comment"># AND - both must be true</span><br>
                                <span class="filter">dns</span> <span class="operator">||</span> <span class="filter">dhcp</span>                         <span class="comment"># OR - either can be true</span><br>
                                <span class="operator">!</span><span class="filter">arp</span>                                    <span class="comment"># NOT - exclude ARP packets</span><br>
                                <span class="operator">not</span> <span class="filter">tcp</span>                                 <span class="comment"># Alternative NOT syntax</span>
                            </div>

                            <h3>Handling Ports (Common Confusion Point!)</h3>
                            <div class="info-box warning">
                                <strong>‚ö†Ô∏è Important: Port Filter Variations</strong>
                                <p>These filter fields behave differently - choosing the wrong one is a common mistake!</p>
                            </div>
                            <div class="code-block">
                                <span class="filter">tcp.port</span> == 80       <span class="comment"># Matches if EITHER src OR dst port is 80</span><br>
                                <span class="filter">tcp.srcport</span> == 80    <span class="comment"># Only matches SOURCE port 80</span><br>
                                <span class="filter">tcp.dstport</span> == 80    <span class="comment"># Only matches DESTINATION port 80</span><br>
                                <span class="filter">udp.port</span> == 53        <span class="comment"># Same logic for UDP</span>
                            </div>

                            <h3>IP Address Filters (Another Confusion Point!)</h3>
                            <div class="code-block">
                                <span class="filter">ip.addr</span> == 192.168.1.1     <span class="comment"># Matches if EITHER src OR dst is this IP</span><br>
                                <span class="filter">ip.src</span> == 192.168.1.1      <span class="comment"># Only matches SOURCE IP</span><br>
                                <span class="filter">ip.dst</span> == 192.168.1.1      <span class="comment"># Only matches DESTINATION IP</span><br>
                                <span class="filter">ip.addr</span> == 192.168.1.0/24  <span class="comment"># Matches entire subnet (CIDR notation)</span>
                            </div>

                            <h3>String Matching</h3>
                            <div class="code-block">
                                <span class="filter">http.host</span> <span class="operator">contains</span> "google"        <span class="comment"># Contains substring</span><br>
                                <span class="filter">http.request.uri</span> <span class="operator">matches</span> "login"   <span class="comment"># Regex match</span><br>
                                <span class="filter">frame</span> <span class="operator">contains</span> "password"           <span class="comment"># Search raw packet data</span>
                            </div>
                        </div>

                        <div class="learn-section">
                            <h2>Common Analysis Scenarios</h2>

                            <h3>Finding HTTP Traffic</h3>
                            <div class="code-block">
                                <span class="filter">http</span>                                <span class="comment"># All HTTP traffic</span><br>
                                <span class="filter">http.request</span>                        <span class="comment"># HTTP requests only</span><br>
                                <span class="filter">http.response</span>                       <span class="comment"># HTTP responses only</span><br>
                                <span class="filter">http.request.method</span> == "POST"       <span class="comment"># POST requests (form submissions)</span><br>
                                <span class="filter">http.response.code</span> == 404           <span class="comment"># 404 Not Found errors</span><br>
                                <span class="filter">http.response.code</span> >= 400           <span class="comment"># All client/server errors</span>
                            </div>

                            <h3>DNS Analysis</h3>
                            <div class="code-block">
                                <span class="filter">dns</span>                                 <span class="comment"># All DNS traffic</span><br>
                                <span class="filter">dns.qry.name</span> contains "malware"     <span class="comment"># Suspicious domain queries</span><br>
                                <span class="filter">dns.flags.response</span> == 1             <span class="comment"># DNS responses only</span><br>
                                <span class="filter">dns.qry.type</span> == 16                   <span class="comment"># TXT record queries (sometimes C2)</span>
                            </div>

                            <h3>TCP Connection Analysis</h3>
                            <div class="code-block">
                                <span class="filter">tcp.flags.syn</span> == 1 && <span class="filter">tcp.flags.ack</span> == 0   <span class="comment"># SYN packets (new connections)</span><br>
                                <span class="filter">tcp.flags.reset</span> == 1                          <span class="comment"># RST packets (connection resets)</span><br>
                                <span class="filter">tcp.analysis.retransmission</span>                   <span class="comment"># Retransmitted packets</span><br>
                                <span class="filter">tcp.stream</span> eq 5                                 <span class="comment"># Follow specific TCP stream</span>
                            </div>

                            <h3>Security Investigation</h3>
                            <div class="code-block">
                                <span class="comment"># Port scanning detection</span><br>
                                <span class="filter">tcp.flags.syn</span> == 1 && <span class="filter">tcp.flags.ack</span> == 0 && <span class="filter">ip.src</span> == 10.0.0.50<br><br>
                                <span class="comment"># SMB traffic (lateral movement)</span><br>
                                <span class="filter">tcp.port</span> == 445<br><br>
                                <span class="comment"># Non-standard HTTPS port</span><br>
                                <span class="filter">tcp.port</span> == 8443 || <span class="filter">tcp.port</span> == 4443<br><br>
                                <span class="comment"># Large data transfers (exfiltration?)</span><br>
                                <span class="filter">frame.len</span> > 5000 && <span class="filter">ip.dst</span> != 192.168.0.0/16
                            </div>
                        </div>

                        <div class="learn-section">
                            <h2>Ready to Practice?</h2>
                            <p>Head to the <strong>Filter Lab</strong> tab to practice writing filters with instant feedback. Then test your skills in the <strong>Challenges</strong> section!</p>

                            <div class="info-box success">
                                <strong>üéÆ Interactive Learning</strong>
                                <p>The Filter Lab provides a simulated network capture. Type filters and see which packets match in real-time. No actual network capture required!</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- FILTER LAB TAB -->
                <div id="filter-lab" class="tab-content">
                    <div class="filter-lab">
                        <div class="interface-selector">
                            <label>Interface:</label>
                            <select id="interfaceSelect" onchange="changeInterface()">
                                <option value="eth0">eth0 (Ethernet - Primary)</option>
                                <option value="wlan0">wlan0 (Wireless)</option>
                                <option value="lo">lo (Loopback - localhost)</option>
                                <option value="any">any (All Interfaces)</option>
                                <option value="docker0">docker0 (Docker Bridge)</option>
                            </select>
                            <span class="interface-info" id="interfaceInfo">Capturing on primary ethernet adapter</span>
                            <button class="filter-btn apply-btn" onclick="loadScenario('normal')" style="padding: 8px 15px; font-size: 0.85em;">Load Normal Traffic</button>
                            <button class="filter-btn clear-btn" onclick="loadScenario('malicious')" style="padding: 8px 15px; font-size: 0.85em;">Load Malicious Traffic</button>
                        </div>

                        <div class="filter-toolbar">
                            <div class="filter-input-wrapper">
                                <input type="text" id="filterInput" placeholder="Enter display filter (e.g., ip.addr == 192.168.1.1)" autocomplete="off" spellcheck="false">
                                <div class="autocomplete-dropdown" id="autocomplete"></div>
                            </div>
                            <button class="filter-btn apply-btn" onclick="applyFilter()">Apply</button>
                            <button class="filter-btn clear-btn" onclick="clearFilter()">Clear</button>
                        </div>

                        <div class="packet-display">
                            <div class="packet-list-container">
                                <table class="packet-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 50px;">No.</th>
                                            <th style="width: 100px;">Time</th>
                                            <th style="width: 140px;">Source</th>
                                            <th style="width: 140px;">Destination</th>
                                            <th style="width: 70px;">Protocol</th>
                                            <th style="width: 60px;">Length</th>
                                            <th>Info</th>
                                        </tr>
                                    </thead>
                                    <tbody id="packetTableBody">
                                        <tr>
                                            <td colspan="7" style="text-align: center; padding: 40px; color: #888;">
                                                Click "Load Normal Traffic" or "Load Malicious Traffic" to begin
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="stats-bar">
                                <div class="stat">Displayed: <span id="displayedCount">0</span> / <span id="totalCount">0</span> packets</div>
                                <div class="stat">Filter Status: <span id="filterStatus">No filter applied</span></div>
                                <div class="stat">Interface: <span id="currentInterface">eth0</span></div>
                            </div>

                            <div class="packet-details-panel" id="packetDetails">
                                <p style="text-align: center; color: #888; padding: 20px;">Click a packet to view layer-by-layer details</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CHALLENGES TAB -->
                <div id="challenges" class="tab-content">
                    <div class="challenges-container">
                        <div class="progress-section">
                            <h3 style="color: #c084fc; margin-bottom: 10px;">Your Progress</h3>
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progressBar" style="width: 0%;"></div>
                            </div>
                            <div class="progress-text">
                                <span id="completedCount">0</span> of <span id="totalChallenges">10</span> challenges completed
                                <span id="totalPoints">0 points</span>
                            </div>
                        </div>

                        <div id="challengeList"></div>
                    </div>
                </div>

                <!-- REFERENCE TAB -->
                <div id="reference" class="tab-content">
                    <div class="reference-container">
                        <div class="ref-category">
                            <h3>üìç IP Address Filters</h3>
                            <div class="ref-grid">
                                <div class="ref-item" onclick="insertFilter('ip.addr == ')">
                                    <div class="filter-syntax">ip.addr == [IP]</div>
                                    <div class="filter-explanation">Match source OR destination IP</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('ip.src == ')">
                                    <div class="filter-syntax">ip.src == [IP]</div>
                                    <div class="filter-explanation">Match only source IP</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('ip.dst == ')">
                                    <div class="filter-syntax">ip.dst == [IP]</div>
                                    <div class="filter-explanation">Match only destination IP</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('ip.addr == 192.168.0.0/16')">
                                    <div class="filter-syntax">ip.addr == [CIDR]</div>
                                    <div class="filter-explanation">Match IP range/subnet</div>
                                </div>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>üîå Port Filters</h3>
                            <div class="ref-grid">
                                <div class="ref-item" onclick="insertFilter('tcp.port == ')">
                                    <div class="filter-syntax">tcp.port == [PORT]</div>
                                    <div class="filter-explanation">Match src OR dst TCP port</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('tcp.srcport == ')">
                                    <div class="filter-syntax">tcp.srcport == [PORT]</div>
                                    <div class="filter-explanation">Match only source port</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('tcp.dstport == ')">
                                    <div class="filter-syntax">tcp.dstport == [PORT]</div>
                                    <div class="filter-explanation">Match only destination port</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('udp.port == ')">
                                    <div class="filter-syntax">udp.port == [PORT]</div>
                                    <div class="filter-explanation">Match src OR dst UDP port</div>
                                </div>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>üì° Protocol Filters</h3>
                            <div class="ref-grid">
                                <div class="ref-item" onclick="insertFilter('http')">
                                    <div class="filter-syntax">http</div>
                                    <div class="filter-explanation">HTTP traffic</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('dns')">
                                    <div class="filter-syntax">dns</div>
                                    <div class="filter-explanation">DNS queries and responses</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('tcp')">
                                    <div class="filter-syntax">tcp</div>
                                    <div class="filter-explanation">All TCP packets</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('udp')">
                                    <div class="filter-syntax">udp</div>
                                    <div class="filter-explanation">All UDP packets</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('icmp')">
                                    <div class="filter-syntax">icmp</div>
                                    <div class="filter-explanation">ICMP (ping) traffic</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('arp')">
                                    <div class="filter-syntax">arp</div>
                                    <div class="filter-explanation">ARP broadcasts</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('tls')">
                                    <div class="filter-syntax">tls</div>
                                    <div class="filter-explanation">TLS/SSL encrypted traffic</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('ssh')">
                                    <div class="filter-syntax">ssh</div>
                                    <div class="filter-explanation">SSH traffic</div>
                                </div>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>üîó TCP Flags</h3>
                            <div class="ref-grid">
                                <div class="ref-item" onclick="insertFilter('tcp.flags.syn == 1')">
                                    <div class="filter-syntax">tcp.flags.syn == 1</div>
                                    <div class="filter-explanation">SYN flag set (connection start)</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('tcp.flags.ack == 1')">
                                    <div class="filter-syntax">tcp.flags.ack == 1</div>
                                    <div class="filter-explanation">ACK flag set</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('tcp.flags.fin == 1')">
                                    <div class="filter-syntax">tcp.flags.fin == 1</div>
                                    <div class="filter-explanation">FIN flag (connection close)</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('tcp.flags.reset == 1')">
                                    <div class="filter-syntax">tcp.flags.reset == 1</div>
                                    <div class="filter-explanation">RST flag (connection reset)</div>
                                </div>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>üåê HTTP Specific</h3>
                            <div class="ref-grid">
                                <div class="ref-item" onclick="insertFilter('http.request')">
                                    <div class="filter-syntax">http.request</div>
                                    <div class="filter-explanation">HTTP requests only</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('http.response')">
                                    <div class="filter-syntax">http.response</div>
                                    <div class="filter-explanation">HTTP responses only</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('http.request.method == \"GET\"')">
                                    <div class="filter-syntax">http.request.method == "GET"</div>
                                    <div class="filter-explanation">GET requests</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('http.request.method == \"POST\"')">
                                    <div class="filter-syntax">http.request.method == "POST"</div>
                                    <div class="filter-explanation">POST requests (form data)</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('http.response.code == 200')">
                                    <div class="filter-syntax">http.response.code == 200</div>
                                    <div class="filter-explanation">Successful responses</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('http.response.code >= 400')">
                                    <div class="filter-syntax">http.response.code >= 400</div>
                                    <div class="filter-explanation">Error responses</div>
                                </div>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>üîç DNS Specific</h3>
                            <div class="ref-grid">
                                <div class="ref-item" onclick="insertFilter('dns.qry.name contains \"\"')">
                                    <div class="filter-syntax">dns.qry.name contains "[domain]"</div>
                                    <div class="filter-explanation">Search DNS queries by domain</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('dns.flags.response == 0')">
                                    <div class="filter-syntax">dns.flags.response == 0</div>
                                    <div class="filter-explanation">DNS queries only</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('dns.flags.response == 1')">
                                    <div class="filter-syntax">dns.flags.response == 1</div>
                                    <div class="filter-explanation">DNS responses only</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('dns.qry.type == 1')">
                                    <div class="filter-syntax">dns.qry.type == 1</div>
                                    <div class="filter-explanation">A records (IPv4)</div>
                                </div>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>‚ö° Logical Operators</h3>
                            <div class="ref-grid">
                                <div class="ref-item" onclick="insertFilter(' && ')">
                                    <div class="filter-syntax">&& (and)</div>
                                    <div class="filter-explanation">Both conditions must be true</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter(' || ')">
                                    <div class="filter-syntax">|| (or)</div>
                                    <div class="filter-explanation">Either condition can be true</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter('!')">
                                    <div class="filter-syntax">! (not)</div>
                                    <div class="filter-explanation">Negate/exclude matches</div>
                                </div>
                                <div class="ref-item" onclick="insertFilter(' contains ')">
                                    <div class="filter-syntax">contains</div>
                                    <div class="filter-explanation">String contains substring</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SETTINGS TAB -->
                <div id="settings" class="tab-content">
                    <div class="settings-panel">
                        <div class="settings-section">
                            <h3>üì§ Export Progress</h3>
                            <p style="color: #888; margin-bottom: 15px;">Save your challenge progress and settings to continue later.</p>
                            <div class="settings-row">
                                <label>Export your progress data</label>
                                <button class="settings-btn" onclick="exportProgress()">Export to File</button>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>üì• Import Progress</h3>
                            <p style="color: #888; margin-bottom: 15px;">Load previously saved progress.</p>
                            <div class="settings-row">
                                <label>Import progress data</label>
                                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importProgress(event)">
                                <button class="settings-btn secondary" onclick="document.getElementById('importFile').click()">Import from File</button>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>üîÑ Reset Progress</h3>
                            <p style="color: #888; margin-bottom: 15px;">Clear all challenge progress and start fresh.</p>
                            <div class="settings-row">
                                <label>This cannot be undone!</label>
                                <button class="settings-btn" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);" onclick="resetProgress()">Reset All Progress</button>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>üìä Statistics</h3>
                            <div class="settings-row">
                                <label>Total Challenges Completed</label>
                                <span id="statsCompleted" style="color: #22c55e; font-weight: 600;">0</span>
                            </div>
                            <div class="settings-row">
                                <label>Total Points Earned</label>
                                <span id="statsPoints" style="color: #fbbf24; font-weight: 600;">0</span>
                            </div>
                            <div class="settings-row">
                                <label>Filters Applied</label>
                                <span id="statsFilters" style="color: #06b6d4; font-weight: 600;">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SIDEBAR -->
            <div class="sidebar" id="sidebar">
                <h3>üìñ Learning Panel</h3>
                <div id="learningContent">
                    <h4>Welcome to Wireshark Training!</h4>
                    <p>This interactive lab will teach you how to use Wireshark's display filters to analyze network traffic like a security professional.</p>

                    <div class="tip-box">
                        <strong>üí° Getting Started</strong>
                        <p>Start with the <strong>Learn</strong> tab for fundamentals, then practice in the <strong>Filter Lab</strong>!</p>
                    </div>

                    <h4>Quick Filters</h4>
                    <p>Click to insert into the filter bar:</p>
                    <div class="quick-filters">
                        <button class="quick-filter-btn" onclick="insertFilter('http')">http</button>
                        <button class="quick-filter-btn" onclick="insertFilter('dns')">dns</button>
                        <button class="quick-filter-btn" onclick="insertFilter('tcp')">tcp</button>
                        <button class="quick-filter-btn" onclick="insertFilter('icmp')">icmp</button>
                    </div>

                    <h4>Common Combinations</h4>
                    <div class="quick-filters">
                        <button class="quick-filter-btn" onclick="insertFilter('tcp.flags.syn == 1 && tcp.flags.ack == 0')">SYN only</button>
                        <button class="quick-filter-btn" onclick="insertFilter('http.request.method == \"POST\"')">POST requests</button>
                        <button class="quick-filter-btn" onclick="insertFilter('!arp && !dns')">No ARP/DNS</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== STATE MANAGEMENT ====================
        let packets = [];
        let filteredPackets = [];
        let currentFilter = '';
        let selectedPacketIndex = null;
        let currentInterface = 'eth0';
        let filterCount = 0;

        // Challenge state
        let challenges = [];
        let completedChallenges = new Set();
        let totalPoints = 0;

        // ==================== FILTER DEFINITIONS ====================
        const filterKeywords = [
            { name: 'ip.addr', desc: 'Source or destination IP address' },
            { name: 'ip.src', desc: 'Source IP address only' },
            { name: 'ip.dst', desc: 'Destination IP address only' },
            { name: 'tcp.port', desc: 'Source or destination TCP port' },
            { name: 'tcp.srcport', desc: 'TCP source port only' },
            { name: 'tcp.dstport', desc: 'TCP destination port only' },
            { name: 'udp.port', desc: 'Source or destination UDP port' },
            { name: 'udp.srcport', desc: 'UDP source port only' },
            { name: 'udp.dstport', desc: 'UDP destination port only' },
            { name: 'tcp.flags.syn', desc: 'TCP SYN flag' },
            { name: 'tcp.flags.ack', desc: 'TCP ACK flag' },
            { name: 'tcp.flags.fin', desc: 'TCP FIN flag' },
            { name: 'tcp.flags.reset', desc: 'TCP RST flag' },
            { name: 'http', desc: 'HTTP traffic' },
            { name: 'http.request', desc: 'HTTP requests' },
            { name: 'http.response', desc: 'HTTP responses' },
            { name: 'http.request.method', desc: 'HTTP method (GET, POST, etc.)' },
            { name: 'http.response.code', desc: 'HTTP status code' },
            { name: 'http.host', desc: 'HTTP Host header' },
            { name: 'http.request.uri', desc: 'HTTP request URI' },
            { name: 'dns', desc: 'DNS traffic' },
            { name: 'dns.qry.name', desc: 'DNS query domain name' },
            { name: 'dns.flags.response', desc: 'DNS response flag (0=query, 1=response)' },
            { name: 'dns.qry.type', desc: 'DNS query type (1=A, 28=AAAA, 16=TXT)' },
            { name: 'icmp', desc: 'ICMP (ping) traffic' },
            { name: 'arp', desc: 'ARP traffic' },
            { name: 'tls', desc: 'TLS/SSL encrypted traffic' },
            { name: 'ssh', desc: 'SSH traffic' },
            { name: 'ftp', desc: 'FTP traffic' },
            { name: 'smb', desc: 'SMB/CIFS traffic' },
            { name: 'frame.len', desc: 'Packet length in bytes' },
            { name: 'frame.time', desc: 'Packet capture time' },
            { name: 'eth.src', desc: 'Source MAC address' },
            { name: 'eth.dst', desc: 'Destination MAC address' },
            { name: 'frame.interface_name', desc: 'Capture interface name' }
        ];

        // ==================== CHALLENGES DEFINITION ====================
        const challengeDefinitions = [
            {
                id: 1,
                title: 'Filter by Protocol',
                description: 'Write a filter to show only HTTP traffic.',
                hint: 'Simply type the protocol name as the filter.',
                points: 10,
                check: (filter) => filter.trim().toLowerCase() === 'http'
            },
            {
                id: 2,
                title: 'Filter by IP Address',
                description: 'Show all traffic to or from IP address 192.168.1.100',
                hint: 'Use ip.addr with the == operator',
                points: 15,
                check: (filter) => filter.includes('ip.addr') && filter.includes('192.168.1.100')
            },
            {
                id: 3,
                title: 'Filter by Port',
                description: 'Display only traffic on TCP port 80 (HTTP)',
                hint: 'Use tcp.port or tcp.dstport',
                points: 15,
                check: (filter) => (filter.includes('tcp.port') || filter.includes('tcp.dstport')) && filter.includes('80')
            },
            {
                id: 4,
                title: 'Combine Filters with AND',
                description: 'Show HTTP traffic only from IP 192.168.1.100',
                hint: 'Combine http with ip.src using && operator',
                points: 20,
                check: (filter) => filter.includes('http') && filter.includes('&&') && filter.includes('192.168.1.')
            },
            {
                id: 5,
                title: 'Exclude Traffic',
                description: 'Show all traffic EXCEPT ARP packets',
                hint: 'Use the NOT operator (! or not) before arp',
                points: 15,
                check: (filter) => (filter.includes('!arp') || filter.includes('not arp') || filter.includes('!arp'))
            },
            {
                id: 6,
                title: 'Find DNS Queries',
                description: 'Display only DNS query packets (not responses)',
                hint: 'dns.flags.response == 0 means it\'s a query',
                points: 20,
                check: (filter) => filter.includes('dns') && filter.includes('response') && filter.includes('0')
            },
            {
                id: 7,
                title: 'TCP SYN Scan Detection',
                description: 'Find TCP SYN packets that are NOT SYN-ACK (potential port scan)',
                hint: 'SYN=1 and ACK=0 indicates a connection initiation',
                points: 25,
                check: (filter) => filter.includes('syn') && filter.includes('1') && filter.includes('ack') && filter.includes('0')
            },
            {
                id: 8,
                title: 'HTTP POST Requests',
                description: 'Find all HTTP POST requests (form submissions)',
                hint: 'Use http.request.method with the POST value in quotes',
                points: 20,
                check: (filter) => filter.includes('http.request.method') && filter.toLowerCase().includes('post')
            },
            {
                id: 9,
                title: 'Large Packets',
                description: 'Find packets larger than 1000 bytes',
                hint: 'Use frame.len with the > operator',
                points: 15,
                check: (filter) => filter.includes('frame.len') && filter.includes('>') && parseInt(filter.match(/\d+/)?.[0]) >= 1000
            },
            {
                id: 10,
                title: 'Suspicious DNS',
                description: 'Find DNS queries containing "malware" or "evil" in the domain name',
                hint: 'Use dns.qry.name with the contains operator',
                points: 25,
                check: (filter) => filter.includes('dns.qry.name') && filter.includes('contains')
            }
        ];

        // ==================== PACKET DATA GENERATION ====================
        function generateNormalTraffic() {
            return [
                { no: 1, time: '0.000000', src: '192.168.1.100', dst: '8.8.8.8', protocol: 'DNS', length: 74, srcPort: 54321, dstPort: 53, info: 'Standard query A www.example.com', flags: '', interface: 'eth0' },
                { no: 2, time: '0.032456', src: '8.8.8.8', dst: '192.168.1.100', protocol: 'DNS', length: 90, srcPort: 53, dstPort: 54321, info: 'Standard query response A 93.184.216.34', flags: '', interface: 'eth0' },
                { no: 3, time: '0.035123', src: '192.168.1.100', dst: '93.184.216.34', protocol: 'TCP', length: 74, srcPort: 49876, dstPort: 80, info: '[SYN] Seq=0 Win=65535', flags: 'SYN', interface: 'eth0' },
                { no: 4, time: '0.089234', src: '93.184.216.34', dst: '192.168.1.100', protocol: 'TCP', length: 74, srcPort: 80, dstPort: 49876, info: '[SYN, ACK] Seq=0 Ack=1', flags: 'SYN-ACK', interface: 'eth0' },
                { no: 5, time: '0.089456', src: '192.168.1.100', dst: '93.184.216.34', protocol: 'TCP', length: 66, srcPort: 49876, dstPort: 80, info: '[ACK] Seq=1 Ack=1', flags: 'ACK', interface: 'eth0' },
                { no: 6, time: '0.090123', src: '192.168.1.100', dst: '93.184.216.34', protocol: 'HTTP', length: 412, srcPort: 49876, dstPort: 80, info: 'GET / HTTP/1.1', flags: 'PSH-ACK', method: 'GET', interface: 'eth0' },
                { no: 7, time: '0.156789', src: '93.184.216.34', dst: '192.168.1.100', protocol: 'HTTP', length: 1514, srcPort: 80, dstPort: 49876, info: 'HTTP/1.1 200 OK (text/html)', flags: 'PSH-ACK', responseCode: 200, interface: 'eth0' },
                { no: 8, time: '0.157000', src: '192.168.1.100', dst: '93.184.216.34', protocol: 'TCP', length: 66, srcPort: 49876, dstPort: 80, info: '[ACK] Seq=347 Ack=1449', flags: 'ACK', interface: 'eth0' },
                { no: 9, time: '1.000000', src: '192.168.1.1', dst: '192.168.1.255', protocol: 'ARP', length: 42, srcPort: 0, dstPort: 0, info: 'Who has 192.168.1.100? Tell 192.168.1.1', flags: '', interface: 'eth0' },
                { no: 10, time: '1.000234', src: '192.168.1.100', dst: '192.168.1.1', protocol: 'ARP', length: 42, srcPort: 0, dstPort: 0, info: '192.168.1.100 is at aa:bb:cc:dd:ee:ff', flags: '', interface: 'eth0' },
                { no: 11, time: '2.500000', src: '192.168.1.50', dst: '192.168.1.1', protocol: 'ICMP', length: 74, srcPort: 0, dstPort: 0, info: 'Echo (ping) request id=0x0001', flags: '', interface: 'eth0' },
                { no: 12, time: '2.501234', src: '192.168.1.1', dst: '192.168.1.50', protocol: 'ICMP', length: 74, srcPort: 0, dstPort: 0, info: 'Echo (ping) reply id=0x0001', flags: '', interface: 'eth0' },
                { no: 13, time: '5.000000', src: '192.168.1.100', dst: '1.1.1.1', protocol: 'DNS', length: 82, srcPort: 55432, dstPort: 53, info: 'Standard query A cloudflare.com', flags: '', interface: 'eth0' },
                { no: 14, time: '5.025678', src: '1.1.1.1', dst: '192.168.1.100', protocol: 'DNS', length: 98, srcPort: 53, dstPort: 55432, info: 'Standard query response A 104.16.132.229', flags: '', interface: 'eth0' },
                { no: 15, time: '5.100000', src: '192.168.1.100', dst: '104.16.132.229', protocol: 'TCP', length: 74, srcPort: 50123, dstPort: 443, info: '[SYN] Seq=0 Win=65535', flags: 'SYN', interface: 'eth0' },
                { no: 16, time: '5.145678', src: '104.16.132.229', dst: '192.168.1.100', protocol: 'TCP', length: 74, srcPort: 443, dstPort: 50123, info: '[SYN, ACK] Seq=0 Ack=1', flags: 'SYN-ACK', interface: 'eth0' },
                { no: 17, time: '5.145890', src: '192.168.1.100', dst: '104.16.132.229', protocol: 'TCP', length: 66, srcPort: 50123, dstPort: 443, info: '[ACK] Seq=1 Ack=1', flags: 'ACK', interface: 'eth0' },
                { no: 18, time: '5.150000', src: '192.168.1.100', dst: '104.16.132.229', protocol: 'TLS', length: 573, srcPort: 50123, dstPort: 443, info: 'Client Hello', flags: 'PSH-ACK', interface: 'eth0' },
                { no: 19, time: '5.200000', src: '104.16.132.229', dst: '192.168.1.100', protocol: 'TLS', length: 1514, srcPort: 443, dstPort: 50123, info: 'Server Hello, Certificate', flags: 'PSH-ACK', interface: 'eth0' },
                { no: 20, time: '10.000000', src: '192.168.1.100', dst: '192.168.1.200', protocol: 'SMB', length: 186, srcPort: 51234, dstPort: 445, info: 'SMB2 Negotiate Protocol Request', flags: 'PSH-ACK', interface: 'eth0' },
                { no: 21, time: '10.050000', src: '192.168.1.200', dst: '192.168.1.100', protocol: 'SMB', length: 294, srcPort: 445, dstPort: 51234, info: 'SMB2 Negotiate Protocol Response', flags: 'PSH-ACK', interface: 'eth0' },
                { no: 22, time: '15.000000', src: '192.168.1.100', dst: '142.250.185.206', protocol: 'HTTP', length: 523, srcPort: 52345, dstPort: 80, info: 'POST /submit HTTP/1.1', flags: 'PSH-ACK', method: 'POST', interface: 'eth0' },
                { no: 23, time: '15.123456', src: '142.250.185.206', dst: '192.168.1.100', protocol: 'HTTP', length: 412, srcPort: 80, dstPort: 52345, info: 'HTTP/1.1 302 Found', flags: 'PSH-ACK', responseCode: 302, interface: 'eth0' },
                { no: 24, time: '20.000000', src: '192.168.1.100', dst: '192.168.1.1', protocol: 'ICMP', length: 74, srcPort: 0, dstPort: 0, info: 'Echo (ping) request id=0x0002', flags: '', interface: 'eth0' },
                { no: 25, time: '20.002345', src: '192.168.1.1', dst: '192.168.1.100', protocol: 'ICMP', length: 74, srcPort: 0, dstPort: 0, info: 'Echo (ping) reply id=0x0002', flags: '', interface: 'eth0' }
            ];
        }

        function generateMaliciousTraffic() {
            return [
                { no: 1, time: '0.000000', src: '192.168.1.150', dst: '8.8.8.8', protocol: 'DNS', length: 95, srcPort: 54321, dstPort: 53, info: 'Standard query A c2-server.evil.com', flags: '', interface: 'eth0' },
                { no: 2, time: '0.089234', src: '8.8.8.8', dst: '192.168.1.150', protocol: 'DNS', length: 111, srcPort: 53, dstPort: 54321, info: 'Response A 185.220.101.50', flags: '', interface: 'eth0' },
                { no: 3, time: '0.100000', src: '192.168.1.150', dst: '185.220.101.50', protocol: 'TCP', length: 74, srcPort: 51234, dstPort: 8443, info: '[SYN] Seq=0 Win=8192 (Suspicious port)', flags: 'SYN', interface: 'eth0' },
                { no: 4, time: '0.234567', src: '185.220.101.50', dst: '192.168.1.150', protocol: 'TCP', length: 74, srcPort: 8443, dstPort: 51234, info: '[SYN, ACK] Seq=0 Ack=1', flags: 'SYN-ACK', interface: 'eth0' },
                { no: 5, time: '0.234789', src: '192.168.1.150', dst: '185.220.101.50', protocol: 'TCP', length: 66, srcPort: 51234, dstPort: 8443, info: '[ACK] Seq=1 Ack=1', flags: 'ACK', interface: 'eth0' },
                { no: 6, time: '0.300000', src: '192.168.1.150', dst: '185.220.101.50', protocol: 'TCP', length: 256, srcPort: 51234, dstPort: 8443, info: 'Encrypted C2 beacon payload', flags: 'PSH-ACK', interface: 'eth0' },
                { no: 7, time: '60.000000', src: '192.168.1.150', dst: '185.220.101.50', protocol: 'TCP', length: 256, srcPort: 51234, dstPort: 8443, info: 'Encrypted C2 beacon (60s interval)', flags: 'PSH-ACK', interface: 'eth0' },
                { no: 8, time: '120.000000', src: '192.168.1.150', dst: '185.220.101.50', protocol: 'TCP', length: 256, srcPort: 51234, dstPort: 8443, info: 'Encrypted C2 beacon (60s interval)', flags: 'PSH-ACK', interface: 'eth0' },
                { no: 9, time: '125.000000', src: '192.168.1.150', dst: '8.8.8.8', protocol: 'DNS', length: 156, srcPort: 55555, dstPort: 53, info: 'Query TXT AAABBBCCC.tunnel.malware.com (DNS Tunneling?)', flags: '', interface: 'eth0' },
                { no: 10, time: '125.089000', src: '8.8.8.8', dst: '192.168.1.150', protocol: 'DNS', length: 512, srcPort: 53, dstPort: 55555, info: 'Response TXT (base64 encoded data)', flags: '', interface: 'eth0' },
                { no: 11, time: '180.000000', src: '192.168.1.150', dst: '185.220.101.50', protocol: 'TCP', length: 256, srcPort: 51234, dstPort: 8443, info: 'Encrypted C2 beacon (60s interval)', flags: 'PSH-ACK', interface: 'eth0' },
                { no: 12, time: '200.000000', src: '192.168.1.150', dst: '192.168.1.25', protocol: 'TCP', length: 74, srcPort: 52341, dstPort: 445, info: '[SYN] Lateral movement attempt (SMB)', flags: 'SYN', interface: 'eth0' },
                { no: 13, time: '200.050000', src: '192.168.1.150', dst: '192.168.1.26', protocol: 'TCP', length: 74, srcPort: 52342, dstPort: 445, info: '[SYN] Lateral movement attempt (SMB)', flags: 'SYN', interface: 'eth0' },
                { no: 14, time: '200.100000', src: '192.168.1.150', dst: '192.168.1.27', protocol: 'TCP', length: 74, srcPort: 52343, dstPort: 445, info: '[SYN] Lateral movement attempt (SMB)', flags: 'SYN', interface: 'eth0' },
                { no: 15, time: '200.150000', src: '192.168.1.150', dst: '192.168.1.28', protocol: 'TCP', length: 74, srcPort: 52344, dstPort: 445, info: '[SYN] Port scan pattern detected!', flags: 'SYN', interface: 'eth0' },
                { no: 16, time: '200.200000', src: '192.168.1.150', dst: '192.168.1.29', protocol: 'TCP', length: 74, srcPort: 52345, dstPort: 445, info: '[SYN] Sequential host scanning', flags: 'SYN', interface: 'eth0' },
                { no: 17, time: '240.000000', src: '192.168.1.150', dst: '185.220.101.50', protocol: 'TCP', length: 256, srcPort: 51234, dstPort: 8443, info: 'Encrypted C2 beacon (consistent 60s)', flags: 'PSH-ACK', interface: 'eth0' },
                { no: 18, time: '300.000000', src: '192.168.1.150', dst: '185.220.101.50', protocol: 'TCP', length: 8192, srcPort: 51234, dstPort: 8443, info: 'Large data transfer - EXFILTRATION!', flags: 'PSH-ACK', interface: 'eth0' },
                { no: 19, time: '301.000000', src: '192.168.1.150', dst: '185.220.101.50', protocol: 'TCP', length: 8192, srcPort: 51234, dstPort: 8443, info: 'Continued exfiltration...', flags: 'PSH-ACK', interface: 'eth0' },
                { no: 20, time: '302.000000', src: '192.168.1.150', dst: '185.220.101.50', protocol: 'TCP', length: 8192, srcPort: 51234, dstPort: 8443, info: 'Continued exfiltration...', flags: 'PSH-ACK', interface: 'eth0' }
            ];
        }

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', () => {
            initializeChallenges();
            loadProgress();
            setupFilterInput();
            updateStats();
        });

        function initializeChallenges() {
            challenges = [...challengeDefinitions];
            renderChallenges();
        }

        function setupFilterInput() {
            const input = document.getElementById('filterInput');
            const dropdown = document.getElementById('autocomplete');

            input.addEventListener('input', (e) => {
                const value = e.target.value;
                showAutocomplete(value);
                validateFilter(value);
            });

            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    applyFilter();
                } else if (e.key === 'Tab') {
                    e.preventDefault();
                    const selected = dropdown.querySelector('.selected');
                    if (selected) {
                        completeFilter(selected.dataset.filter);
                    }
                } else if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
                    e.preventDefault();
                    navigateAutocomplete(e.key === 'ArrowDown' ? 1 : -1);
                } else if (e.key === 'Escape') {
                    dropdown.classList.remove('show');
                }
            });

            input.addEventListener('blur', () => {
                setTimeout(() => dropdown.classList.remove('show'), 200);
            });

            input.addEventListener('focus', () => {
                if (input.value) showAutocomplete(input.value);
            });
        }

        // ==================== AUTOCOMPLETE ====================
        function showAutocomplete(value) {
            const dropdown = document.getElementById('autocomplete');

            if (!value) {
                dropdown.classList.remove('show');
                return;
            }

            // Get the last token being typed
            const tokens = value.split(/\s+/);
            const lastToken = tokens[tokens.length - 1].toLowerCase();

            if (!lastToken || lastToken.length < 1) {
                dropdown.classList.remove('show');
                return;
            }

            const matches = filterKeywords.filter(kw =>
                kw.name.toLowerCase().includes(lastToken)
            ).slice(0, 8);

            if (matches.length === 0) {
                dropdown.classList.remove('show');
                return;
            }

            dropdown.innerHTML = matches.map((kw, i) => `
                <div class="autocomplete-item ${i === 0 ? 'selected' : ''}"
                     data-filter="${kw.name}"
                     onclick="completeFilter('${kw.name}')">
                    <span class="filter-name">${kw.name}</span>
                    <span class="filter-desc">${kw.desc}</span>
                </div>
            `).join('');

            dropdown.classList.add('show');
        }

        function navigateAutocomplete(direction) {
            const dropdown = document.getElementById('autocomplete');
            const items = dropdown.querySelectorAll('.autocomplete-item');
            if (items.length === 0) return;

            let selectedIndex = -1;
            items.forEach((item, i) => {
                if (item.classList.contains('selected')) {
                    selectedIndex = i;
                    item.classList.remove('selected');
                }
            });

            selectedIndex += direction;
            if (selectedIndex < 0) selectedIndex = items.length - 1;
            if (selectedIndex >= items.length) selectedIndex = 0;

            items[selectedIndex].classList.add('selected');
            items[selectedIndex].scrollIntoView({ block: 'nearest' });
        }

        function completeFilter(filterName) {
            const input = document.getElementById('filterInput');
            const value = input.value;
            const tokens = value.split(/\s+/);
            tokens[tokens.length - 1] = filterName;
            input.value = tokens.join(' ');
            document.getElementById('autocomplete').classList.remove('show');
            input.focus();
            validateFilter(input.value);
        }

        // ==================== FILTER VALIDATION & APPLICATION ====================
        function validateFilter(filterStr) {
            const input = document.getElementById('filterInput');

            if (!filterStr.trim()) {
                input.classList.remove('valid', 'invalid');
                return true;
            }

            // Simple validation - check for known keywords
            const hasKnownKeyword = filterKeywords.some(kw =>
                filterStr.toLowerCase().includes(kw.name.toLowerCase())
            ) || ['&&', '||', '!', 'not', 'and', 'or', 'contains', 'matches'].some(op =>
                filterStr.toLowerCase().includes(op)
            );

            // Check for basic syntax errors
            const hasUnbalancedQuotes = (filterStr.match(/"/g) || []).length % 2 !== 0;
            const hasUnbalancedParens = (filterStr.match(/\(/g) || []).length !== (filterStr.match(/\)/g) || []).length;

            if (hasUnbalancedQuotes || hasUnbalancedParens) {
                input.classList.remove('valid');
                input.classList.add('invalid');
                return false;
            }

            if (hasKnownKeyword || filterStr.length < 3) {
                input.classList.remove('invalid');
                input.classList.add('valid');
                return true;
            }

            input.classList.remove('valid', 'invalid');
            return true;
        }

        function applyFilter() {
            const filterStr = document.getElementById('filterInput').value.trim();
            currentFilter = filterStr;
            filterCount++;

            if (!filterStr) {
                filteredPackets = [...packets];
                document.getElementById('filterStatus').textContent = 'No filter applied';
            } else {
                filteredPackets = packets.filter(packet => matchesFilter(packet, filterStr));
                document.getElementById('filterStatus').textContent = filterStr;
                document.getElementById('filterStatus').style.color = '#22c55e';
            }

            renderPackets();
            checkChallenges(filterStr);
            updateLearningPanel(filterStr);
            saveProgress();
        }

        function clearFilter() {
            document.getElementById('filterInput').value = '';
            document.getElementById('filterInput').classList.remove('valid', 'invalid');
            currentFilter = '';
            filteredPackets = [...packets];
            document.getElementById('filterStatus').textContent = 'No filter applied';
            document.getElementById('filterStatus').style.color = '#888';
            renderPackets();
        }

        function matchesFilter(packet, filterStr) {
            const filter = filterStr.toLowerCase();

            // Simple protocol filters
            if (filter === 'http') return packet.protocol === 'HTTP';
            if (filter === 'dns') return packet.protocol === 'DNS';
            if (filter === 'tcp') return ['TCP', 'HTTP', 'TLS', 'SMB', 'SSH', 'FTP'].includes(packet.protocol);
            if (filter === 'udp') return packet.protocol === 'DNS' || packet.srcPort === 53 || packet.dstPort === 53;
            if (filter === 'icmp') return packet.protocol === 'ICMP';
            if (filter === 'arp') return packet.protocol === 'ARP';
            if (filter === 'tls') return packet.protocol === 'TLS';
            if (filter === 'ssh') return packet.protocol === 'SSH' || packet.dstPort === 22 || packet.srcPort === 22;
            if (filter === 'smb') return packet.protocol === 'SMB' || packet.dstPort === 445 || packet.srcPort === 445;

            // NOT filters
            if (filter.startsWith('!') || filter.startsWith('not ')) {
                const negatedFilter = filter.replace(/^(!|not\s+)/, '');
                return !matchesFilter(packet, negatedFilter);
            }

            // IP filters
            if (filter.includes('ip.addr')) {
                const match = filter.match(/ip\.addr\s*==\s*([\d.\/]+)/);
                if (match) {
                    const ip = match[1];
                    if (ip.includes('/')) {
                        return isInSubnet(packet.src, ip) || isInSubnet(packet.dst, ip);
                    }
                    return packet.src === ip || packet.dst === ip;
                }
            }
            if (filter.includes('ip.src')) {
                const match = filter.match(/ip\.src\s*==\s*([\d.]+)/);
                if (match) return packet.src === match[1];
            }
            if (filter.includes('ip.dst')) {
                const match = filter.match(/ip\.dst\s*==\s*([\d.]+)/);
                if (match) return packet.dst === match[1];
            }

            // Port filters
            if (filter.includes('tcp.port')) {
                const match = filter.match(/tcp\.port\s*==\s*(\d+)/);
                if (match) {
                    const port = parseInt(match[1]);
                    return packet.srcPort === port || packet.dstPort === port;
                }
            }
            if (filter.includes('tcp.dstport')) {
                const match = filter.match(/tcp\.dstport\s*==\s*(\d+)/);
                if (match) return packet.dstPort === parseInt(match[1]);
            }
            if (filter.includes('tcp.srcport')) {
                const match = filter.match(/tcp\.srcport\s*==\s*(\d+)/);
                if (match) return packet.srcPort === parseInt(match[1]);
            }

            // TCP flags
            if (filter.includes('tcp.flags.syn') && filter.includes('tcp.flags.ack')) {
                const synMatch = filter.match(/tcp\.flags\.syn\s*==\s*(\d)/);
                const ackMatch = filter.match(/tcp\.flags\.ack\s*==\s*(\d)/);
                if (synMatch && ackMatch) {
                    const wantSyn = synMatch[1] === '1';
                    const wantAck = ackMatch[1] === '1';
                    const hasSyn = packet.flags.includes('SYN');
                    const hasAck = packet.flags.includes('ACK');
                    return hasSyn === wantSyn && hasAck === wantAck;
                }
            }
            if (filter.includes('tcp.flags.syn')) {
                const match = filter.match(/tcp\.flags\.syn\s*==\s*(\d)/);
                if (match) {
                    const wantSyn = match[1] === '1';
                    return packet.flags.includes('SYN') === wantSyn;
                }
            }
            if (filter.includes('tcp.flags.reset')) {
                const match = filter.match(/tcp\.flags\.reset\s*==\s*(\d)/);
                if (match) return packet.flags.includes('RST') === (match[1] === '1');
            }

            // HTTP filters
            if (filter.includes('http.request.method')) {
                const match = filter.match(/http\.request\.method\s*==\s*"?(\w+)"?/i);
                if (match) return packet.method && packet.method.toUpperCase() === match[1].toUpperCase();
            }
            if (filter.includes('http.request')) return packet.protocol === 'HTTP' && packet.method;
            if (filter.includes('http.response')) return packet.protocol === 'HTTP' && packet.responseCode;
            if (filter.includes('http.response.code')) {
                const match = filter.match(/http\.response\.code\s*(==|>=|<=|>|<)\s*(\d+)/);
                if (match) {
                    const op = match[1];
                    const code = parseInt(match[2]);
                    const pCode = packet.responseCode || 0;
                    if (op === '==') return pCode === code;
                    if (op === '>=') return pCode >= code;
                    if (op === '<=') return pCode <= code;
                    if (op === '>') return pCode > code;
                    if (op === '<') return pCode < code;
                }
            }

            // DNS filters
            if (filter.includes('dns.flags.response')) {
                const match = filter.match(/dns\.flags\.response\s*==\s*(\d)/);
                if (match) {
                    const isResponse = match[1] === '1';
                    const packetIsResponse = packet.info.toLowerCase().includes('response');
                    return packet.protocol === 'DNS' && packetIsResponse === isResponse;
                }
            }
            if (filter.includes('dns.qry.name') && filter.includes('contains')) {
                const match = filter.match(/dns\.qry\.name\s+contains\s+"?([^"]+)"?/i);
                if (match) {
                    return packet.protocol === 'DNS' && packet.info.toLowerCase().includes(match[1].toLowerCase());
                }
            }

            // Frame length
            if (filter.includes('frame.len')) {
                const match = filter.match(/frame\.len\s*(>|<|>=|<=|==)\s*(\d+)/);
                if (match) {
                    const op = match[1];
                    const len = parseInt(match[2]);
                    if (op === '>') return packet.length > len;
                    if (op === '<') return packet.length < len;
                    if (op === '>=') return packet.length >= len;
                    if (op === '<=') return packet.length <= len;
                    if (op === '==') return packet.length === len;
                }
            }

            // Contains for frame
            if (filter.includes('frame contains') || filter.includes('contains')) {
                const match = filter.match(/contains\s+"([^"]+)"/i);
                if (match) {
                    return packet.info.toLowerCase().includes(match[1].toLowerCase());
                }
            }

            // AND/OR operators
            if (filter.includes('&&') || filter.includes(' and ')) {
                const parts = filter.split(/\s*&&\s*|\s+and\s+/i);
                return parts.every(part => matchesFilter(packet, part.trim()));
            }
            if (filter.includes('||') || filter.includes(' or ')) {
                const parts = filter.split(/\s*\|\|\s*|\s+or\s+/i);
                return parts.some(part => matchesFilter(packet, part.trim()));
            }

            // Default: check if info contains filter text
            return packet.info.toLowerCase().includes(filter);
        }

        function isInSubnet(ip, cidr) {
            // Simple CIDR check (basic implementation)
            const [subnet, bits] = cidr.split('/');
            if (!bits) return ip === subnet;

            const subnetParts = subnet.split('.').map(Number);
            const ipParts = ip.split('.').map(Number);
            const mask = parseInt(bits);

            // Check first octets based on mask
            const octetsToCheck = Math.floor(mask / 8);
            for (let i = 0; i < octetsToCheck; i++) {
                if (ipParts[i] !== subnetParts[i]) return false;
            }
            return true;
        }

        // ==================== PACKET RENDERING ====================
        function loadScenario(type) {
            packets = type === 'malicious' ? generateMaliciousTraffic() : generateNormalTraffic();
            filteredPackets = [...packets];
            currentFilter = '';
            document.getElementById('filterInput').value = '';
            document.getElementById('filterStatus').textContent = 'No filter applied';
            document.getElementById('filterStatus').style.color = '#888';
            renderPackets();

            if (type === 'malicious') {
                updateLearningPanel('malicious_loaded');
            } else {
                updateLearningPanel('normal_loaded');
            }
        }

        function renderPackets() {
            const tbody = document.getElementById('packetTableBody');

            if (packets.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #888;">
                            Click "Load Normal Traffic" or "Load Malicious Traffic" to begin
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = packets.map((packet, index) => {
                const isFiltered = currentFilter && !filteredPackets.includes(packet);
                const isMatched = currentFilter && filteredPackets.includes(packet);
                const rowClass = isFiltered ? 'filtered-out' : (isMatched ? 'matched' : '');

                return `
                    <tr class="${rowClass}" onclick="selectPacket(${index})">
                        <td>${packet.no}</td>
                        <td>${packet.time}</td>
                        <td>${packet.src}</td>
                        <td>${packet.dst}</td>
                        <td class="proto-${packet.protocol.toLowerCase()}">${packet.protocol}</td>
                        <td>${packet.length}</td>
                        <td>${packet.info}</td>
                    </tr>
                `;
            }).join('');

            document.getElementById('displayedCount').textContent = filteredPackets.length;
            document.getElementById('totalCount').textContent = packets.length;
            document.getElementById('currentInterface').textContent = currentInterface;
        }

        function selectPacket(index) {
            selectedPacketIndex = index;
            const packet = packets[index];

            // Highlight selected row
            document.querySelectorAll('#packetTableBody tr').forEach((row, i) => {
                row.classList.toggle('selected', i === index);
            });

            // Show packet details
            const details = document.getElementById('packetDetails');
            details.innerHTML = `
                <div class="layer">
                    <h4>‚ñº Frame ${packet.no}</h4>
                    <div class="layer-field"><span class="field-name">Interface:</span><span class="field-value">${packet.interface}</span></div>
                    <div class="layer-field"><span class="field-name">Arrival Time:</span><span class="field-value">${packet.time} seconds</span></div>
                    <div class="layer-field"><span class="field-name">Frame Length:</span><span class="field-value">${packet.length} bytes</span></div>
                </div>
                <div class="layer">
                    <h4>‚ñº Internet Protocol Version 4</h4>
                    <div class="layer-field"><span class="field-name">Source Address:</span><span class="field-value">${packet.src}</span></div>
                    <div class="layer-field"><span class="field-name">Destination Address:</span><span class="field-value">${packet.dst}</span></div>
                    <div class="layer-field"><span class="field-name">Protocol:</span><span class="field-value">${packet.protocol}</span></div>
                </div>
                ${packet.srcPort ? `
                <div class="layer">
                    <h4>‚ñº ${packet.protocol === 'DNS' ? 'User Datagram Protocol' : 'Transmission Control Protocol'}</h4>
                    <div class="layer-field"><span class="field-name">Source Port:</span><span class="field-value">${packet.srcPort}</span></div>
                    <div class="layer-field"><span class="field-name">Destination Port:</span><span class="field-value">${packet.dstPort}</span></div>
                    ${packet.flags ? `<div class="layer-field"><span class="field-name">Flags:</span><span class="field-value">${packet.flags}</span></div>` : ''}
                </div>
                ` : ''}
                <div class="layer">
                    <h4>‚ñº ${packet.protocol} Details</h4>
                    <div class="layer-field"><span class="field-name">Info:</span><span class="field-value">${packet.info}</span></div>
                    ${packet.method ? `<div class="layer-field"><span class="field-name">Method:</span><span class="field-value">${packet.method}</span></div>` : ''}
                    ${packet.responseCode ? `<div class="layer-field"><span class="field-name">Response Code:</span><span class="field-value">${packet.responseCode}</span></div>` : ''}
                </div>
            `;
        }

        // ==================== INTERFACE HANDLING ====================
        function changeInterface() {
            const select = document.getElementById('interfaceSelect');
            currentInterface = select.value;

            const infoMap = {
                'eth0': 'Capturing on primary ethernet adapter',
                'wlan0': 'Capturing on wireless adapter',
                'lo': 'Capturing loopback (localhost only)',
                'any': 'Capturing from ALL interfaces',
                'docker0': 'Capturing Docker bridge network'
            };

            document.getElementById('interfaceInfo').textContent = infoMap[currentInterface] || '';
            document.getElementById('currentInterface').textContent = currentInterface;

            // Update learning panel with interface info
            updateLearningPanel('interface_' + currentInterface);
        }

        // ==================== CHALLENGES ====================
        function renderChallenges() {
            const container = document.getElementById('challengeList');
            container.innerHTML = challenges.map(ch => `
                <div class="challenge-card ${completedChallenges.has(ch.id) ? 'completed' : ''}" id="challenge-${ch.id}">
                    <div class="challenge-header">
                        <span class="challenge-title">${completedChallenges.has(ch.id) ? '‚úì ' : ''}${ch.title}</span>
                        <span class="challenge-points">${ch.points} pts</span>
                    </div>
                    <p class="challenge-desc">${ch.description}</p>
                    <div class="challenge-status">
                        <span class="status-badge ${completedChallenges.has(ch.id) ? 'status-complete' : 'status-pending'}">
                            ${completedChallenges.has(ch.id) ? 'Completed!' : 'Pending'}
                        </span>
                        ${!completedChallenges.has(ch.id) ? `
                            <button class="hint-btn" onclick="toggleHint(${ch.id})">Show Hint</button>
                        ` : ''}
                    </div>
                    <div class="hint-text" id="hint-${ch.id}">${ch.hint}</div>
                </div>
            `).join('');

            updateProgressBar();
        }

        function toggleHint(id) {
            const hint = document.getElementById(`hint-${id}`);
            hint.classList.toggle('show');
        }

        function checkChallenges(filterStr) {
            if (!filterStr) return;

            challenges.forEach(ch => {
                if (!completedChallenges.has(ch.id) && ch.check(filterStr)) {
                    completedChallenges.add(ch.id);
                    totalPoints += ch.points;

                    // Show completion notification
                    showNotification(`üéâ Challenge Complete: ${ch.title} (+${ch.points} pts)`);

                    renderChallenges();
                    saveProgress();
                }
            });
        }

        function updateProgressBar() {
            const completed = completedChallenges.size;
            const total = challenges.length;
            const percentage = (completed / total) * 100;

            document.getElementById('progressBar').style.width = percentage + '%';
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('totalChallenges').textContent = total;
            document.getElementById('totalPoints').textContent = totalPoints + ' points';
        }

        function showNotification(message) {
            // Simple notification - could be enhanced
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                font-weight: 600;
                z-index: 10000;
                box-shadow: 0 4px 20px rgba(34, 197, 94, 0.4);
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // ==================== LEARNING PANEL ====================
        function updateLearningPanel(context) {
            const panel = document.getElementById('learningContent');

            const content = {
                'normal_loaded': `
                    <h4>Normal Traffic Loaded</h4>
                    <p>This capture contains typical network activity:</p>
                    <ul>
                        <li>DNS queries to resolve domain names</li>
                        <li>HTTP requests for web pages</li>
                        <li>TLS handshakes for secure connections</li>
                        <li>ARP broadcasts for MAC resolution</li>
                        <li>ICMP ping requests/replies</li>
                    </ul>
                    <div class="tip-box">
                        <strong>Try These Filters:</strong>
                        <p>Start with <code>http</code> to see web traffic, or <code>dns</code> to see name resolution.</p>
                    </div>
                `,
                'malicious_loaded': `
                    <h4>‚ö†Ô∏è Malicious Traffic Loaded</h4>
                    <p>This capture contains suspicious activity:</p>
                    <ul>
                        <li><strong>C2 Beaconing:</strong> Regular 60-second intervals to external IP</li>
                        <li><strong>DNS Tunneling:</strong> Unusually long DNS queries</li>
                        <li><strong>Lateral Movement:</strong> SMB connections to multiple internal hosts</li>
                        <li><strong>Data Exfiltration:</strong> Large outbound transfers</li>
                    </ul>
                    <div class="tip-box" style="border-left-color: #ef4444; background: rgba(239, 68, 68, 0.1);">
                        <strong style="color: #ef4444;">Security Challenge:</strong>
                        <p>Can you find the C2 server IP? Try filtering by destination port or looking for patterns!</p>
                    </div>
                `,
                'interface_any': `
                    <h4>Capturing from All Interfaces</h4>
                    <p>The <code>any</code> interface captures from all available network adapters simultaneously.</p>
                    <div class="tip-box">
                        <strong>Pro Tip:</strong>
                        <p>Use <code>frame.interface_name == "eth0"</code> to filter to a specific interface after capture.</p>
                    </div>
                `,
                'interface_lo': `
                    <h4>Loopback Interface Selected</h4>
                    <p>The <code>lo</code> interface only shows traffic to/from localhost (127.0.0.1).</p>
                    <p>Useful for debugging local applications, but you won't see external network traffic here.</p>
                `
            };

            // Check for filter-related updates
            if (context && context.includes('ip.')) {
                panel.innerHTML = `
                    <h4>IP Address Filtering</h4>
                    <p>You're filtering by IP address. Remember:</p>
                    <ul>
                        <li><code>ip.addr</code> matches source OR destination</li>
                        <li><code>ip.src</code> matches source only</li>
                        <li><code>ip.dst</code> matches destination only</li>
                    </ul>
                    <div class="tip-box">
                        <strong>CIDR Notation:</strong>
                        <p>Use <code>ip.addr == 192.168.0.0/16</code> to match an entire subnet!</p>
                    </div>
                `;
                return;
            }

            if (context && context.includes('tcp.port')) {
                panel.innerHTML = `
                    <h4>Port Filtering</h4>
                    <p>Port filters are powerful for finding specific services:</p>
                    <ul>
                        <li><code>tcp.port == 80</code> - HTTP (matches src OR dst)</li>
                        <li><code>tcp.dstport == 443</code> - HTTPS destination only</li>
                        <li><code>tcp.srcport == 22</code> - SSH source only</li>
                    </ul>
                    <div class="tip-box">
                        <strong>Common Ports:</strong>
                        <p>80=HTTP, 443=HTTPS, 22=SSH, 53=DNS, 445=SMB, 3389=RDP</p>
                    </div>
                `;
                return;
            }

            if (content[context]) {
                panel.innerHTML = content[context];
            }
        }

        function insertFilter(filterText) {
            const input = document.getElementById('filterInput');
            const currentValue = input.value;

            if (currentValue && !currentValue.endsWith(' ') && !filterText.startsWith(' ')) {
                input.value = currentValue + ' ' + filterText;
            } else {
                input.value = currentValue + filterText;
            }

            input.focus();
            validateFilter(input.value);

            // Switch to filter lab tab if not already there
            switchTab('filter-lab');
        }

        // ==================== TAB SWITCHING ====================
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'filter-lab') {
                document.getElementById('filterInput').focus();
            }
        }

        // ==================== SAVE/LOAD PROGRESS ====================
        function saveProgress() {
            const data = {
                completedChallenges: Array.from(completedChallenges),
                totalPoints: totalPoints,
                filterCount: filterCount,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('wireshark_training_progress', JSON.stringify(data));
        }

        function loadProgress() {
            const saved = localStorage.getItem('wireshark_training_progress');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    completedChallenges = new Set(data.completedChallenges || []);
                    totalPoints = data.totalPoints || 0;
                    filterCount = data.filterCount || 0;
                    renderChallenges();
                    updateStats();
                } catch (e) {
                    console.error('Error loading progress:', e);
                }
            }
        }

        function exportProgress() {
            const data = {
                completedChallenges: Array.from(completedChallenges),
                totalPoints: totalPoints,
                filterCount: filterCount,
                exportedAt: new Date().toISOString(),
                version: '1.0'
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'wireshark_training_progress.json';
            a.click();
            URL.revokeObjectURL(url);

            showNotification('üì§ Progress exported successfully!');
        }

        function importProgress(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    completedChallenges = new Set(data.completedChallenges || []);
                    totalPoints = data.totalPoints || 0;
                    filterCount = data.filterCount || 0;

                    saveProgress();
                    renderChallenges();
                    updateStats();

                    showNotification('üì• Progress imported successfully!');
                } catch (err) {
                    alert('Error importing progress file. Please check the file format.');
                }
            };
            reader.readAsText(file);
        }

        function resetProgress() {
            if (!confirm('Are you sure you want to reset all progress? This cannot be undone!')) {
                return;
            }

            completedChallenges = new Set();
            totalPoints = 0;
            filterCount = 0;

            localStorage.removeItem('wireshark_training_progress');
            renderChallenges();
            updateStats();

            showNotification('üîÑ Progress reset successfully');
        }

        function updateStats() {
            document.getElementById('statsCompleted').textContent = completedChallenges.size;
            document.getElementById('statsPoints').textContent = totalPoints;
            document.getElementById('statsFilters').textContent = filterCount;
        }
    </script>
</body>
</html>
