<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VLAN Visualizer - Interactive Learning Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        /* Header */
        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 1.5em;
            color: #fff;
        }

        .header h1 span {
            color: #06b6d4;
        }

        .back-btn {
            background: rgba(6, 182, 212, 0.2);
            color: #06b6d4;
            border: 1px solid #06b6d4;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: #06b6d4;
            color: #fff;
        }

        /* Tabs */
        .tab-container {
            display: flex;
            background: rgba(0, 0, 0, 0.2);
            padding: 0 20px;
            overflow-x: auto;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            color: #888;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 500;
            white-space: nowrap;
        }

        .tab:hover {
            color: #bbb;
            background: rgba(255, 255, 255, 0.05);
        }

        .tab.active {
            color: #06b6d4;
            border-bottom-color: #06b6d4;
            background: rgba(6, 182, 212, 0.1);
        }

        /* Main Content */
        .main-content {
            padding: 20px;
            height: calc(100vh - 120px);
            overflow-y: auto;
        }

        .tab-content {
            display: none;
            height: 100%;
        }

        .tab-content.active {
            display: block;
        }

        /* ==================== TAB 1: What are VLANs? ==================== */
        .info-tab {
            max-width: 1000px;
            margin: 0 auto;
        }

        .info-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 4px solid #06b6d4;
        }

        .info-section h2 {
            color: #fff;
            margin-bottom: 15px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-section p {
            line-height: 1.8;
            color: #c0c0c0;
            font-size: 1.1em;
        }

        .info-section .highlight {
            color: #06b6d4;
            font-weight: 600;
        }

        .info-section .danger {
            color: #f44336;
            font-weight: 600;
        }

        .info-section .analogy {
            background: rgba(6, 182, 212, 0.15);
            padding: 15px 20px;
            border-radius: 8px;
            margin: 15px 0;
            font-style: italic;
            border-left: 3px solid #06b6d4;
        }

        /* The Problem Box */
        .problem-box {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.2), rgba(183, 28, 28, 0.2));
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            border: 2px solid rgba(244, 67, 54, 0.5);
        }

        .problem-box h3 {
            color: #f44336;
            font-size: 1.3em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Solution Box */
        .solution-box {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(8, 145, 178, 0.2));
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            border: 2px solid rgba(6, 182, 212, 0.5);
        }

        .solution-box h3 {
            color: #06b6d4;
            font-size: 1.3em;
            margin-bottom: 15px;
        }

        /* Broadcast Demo */
        .broadcast-demo {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .broadcast-demo svg {
            max-width: 100%;
            height: auto;
        }

        .demo-btn {
            background: #06b6d4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 15px;
            transition: all 0.3s;
        }

        .demo-btn:hover {
            background: #0891b2;
            transform: scale(1.05);
        }

        .demo-btn.running {
            background: #ff9800;
        }

        /* VLAN Color Scheme */
        .vlan-10 { background: rgba(255, 107, 107, 0.3); border-color: #ff6b6b; }
        .vlan-20 { background: rgba(78, 205, 196, 0.3); border-color: #4ecdc4; }
        .vlan-30 { background: rgba(149, 225, 211, 0.3); border-color: #95e1d3; }

        /* Expandable Sections */
        .expandable {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            margin: 10px 0;
            overflow: hidden;
        }

        .expandable-header {
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .expandable-header:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .expandable-header h4 {
            color: #06b6d4;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .expandable-header .arrow {
            color: #06b6d4;
            transition: transform 0.3s;
        }

        .expandable.open .expandable-header .arrow {
            transform: rotate(180deg);
        }

        .expandable-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background: rgba(0, 0, 0, 0.2);
        }

        .expandable.open .expandable-content {
            max-height: 800px;
        }

        .expandable-content-inner {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .expandable-content code {
            background: rgba(0, 0, 0, 0.4);
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #4fc3f7;
        }

        .expandable-content pre {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            color: #4fc3f7;
        }

        /* Key Facts Table */
        .facts-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .facts-table th,
        .facts-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .facts-table th {
            background: rgba(6, 182, 212, 0.2);
            color: #fff;
            font-weight: 600;
        }

        .facts-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        /* ==================== TAB 2-4: Visualizer ==================== */
        .visualizer-container {
            display: flex;
            height: 100%;
            gap: 20px;
        }

        .topology-panel {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .topology-canvas {
            width: 100%;
            height: 100%;
        }

        .info-panel {
            width: 380px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            overflow-y: auto;
        }

        .info-panel h3 {
            color: #fff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Instructions */
        .instructions {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.85em;
            color: #ffc107;
        }

        /* Legend */
        .legend {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .legend h4 {
            color: #fff;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
            font-size: 0.85em;
            color: #bbb;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid;
        }

        /* Frame Animation */
        .frame-display {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .frame-display h4 {
            color: #fff;
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .frame-structure {
            display: flex;
            gap: 2px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .frame-field {
            padding: 10px 8px;
            border-radius: 4px;
            text-align: center;
            font-size: 0.75em;
            min-width: 60px;
        }

        .frame-field.mac { background: #2196f3; color: white; }
        .frame-field.tag { background: #ff6b6b; color: white; animation: pulse 1s infinite; }
        .frame-field.type { background: #9c27b0; color: white; }
        .frame-field.data { background: #4caf50; color: white; }
        .frame-field.fcs { background: #607d8b; color: white; }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }

        /* Selection Info */
        .selection-info {
            background: rgba(6, 182, 212, 0.15);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .selection-info p {
            margin: 5px 0;
            font-size: 0.9em;
        }

        .selection-info .label {
            color: #888;
        }

        .selection-info .value {
            color: #fff;
            font-weight: 600;
        }

        /* Port Info */
        .port-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px 12px;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .port-item .port-name {
            font-weight: 600;
            color: #fff;
        }

        .port-badge {
            font-size: 0.8em;
            padding: 3px 8px;
            border-radius: 10px;
        }

        .badge-access { background: #4caf50; color: white; }
        .badge-trunk { background: #ff9800; color: white; }
        .badge-vlan-10 { background: #ff6b6b; color: white; }
        .badge-vlan-20 { background: #4ecdc4; color: white; }
        .badge-vlan-30 { background: #95e1d3; color: #333; }

        /* Controls */
        .controls {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .controls h4 {
            color: #fff;
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .control-btn {
            background: rgba(6, 182, 212, 0.2);
            color: #06b6d4;
            border: 1px solid #06b6d4;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            margin: 5px 5px 5px 0;
            transition: all 0.3s;
        }

        .control-btn:hover {
            background: #06b6d4;
            color: #fff;
        }

        .control-btn.active {
            background: #06b6d4;
            color: #fff;
        }

        /* No selection message */
        .no-selection {
            text-align: center;
            padding: 30px;
            color: #888;
        }

        .no-selection .icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        /* VLAN Select */
        .vlan-select {
            margin: 15px 0;
        }

        .vlan-select label {
            display: block;
            color: #bbb;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .vlan-select select {
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #444;
            background: #2a2a3e;
            color: #fff;
            font-size: 0.95em;
        }

        /* Routing Methods */
        .routing-method {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 3px solid #06b6d4;
        }

        .routing-method h5 {
            color: #06b6d4;
            margin-bottom: 8px;
        }

        .routing-method p {
            font-size: 0.9em;
            color: #bbb;
        }

        /* Code Display */
        .code-display {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            color: #4fc3f7;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        .code-display .comment {
            color: #6a9955;
        }

        .code-display .keyword {
            color: #c586c0;
        }

        /* Traffic Flow Indicator */
        .traffic-indicator {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid #4caf50;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
        }

        .traffic-indicator.blocked {
            background: rgba(244, 67, 54, 0.2);
            border-color: #f44336;
        }

        .traffic-indicator .status {
            font-weight: bold;
            font-size: 1.1em;
        }

        .traffic-indicator.blocked .status {
            color: #f44336;
        }

        /* Device labels in canvas */
        .device-label {
            font-size: 11px;
            fill: #fff;
            font-weight: bold;
        }

        .device-sublabel {
            font-size: 9px;
            fill: rgba(255,255,255,0.7);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><span>VLAN</span> Visualizer - Virtual LANs</h1>
        <a href="../../index.html" class="back-btn">‚Üê Back to Catalog</a>
    </div>

    <div class="tab-container">
        <div class="tab active" data-tab="info">What are VLANs?</div>
        <div class="tab" data-tab="tagging">802.1Q Tagging</div>
        <div class="tab" data-tab="ports">Trunk vs Access</div>
        <div class="tab" data-tab="routing">Inter-VLAN Routing</div>
    </div>

    <div class="main-content">
        <!-- ==================== TAB 1: What are VLANs? ==================== -->
        <div class="tab-content active" id="tab-info">
            <div class="info-tab">
                <div class="info-section">
                    <h2>üè¢ The Big Picture</h2>
                    <p>VLANs (Virtual Local Area Networks) let you <span class="highlight">logically separate network traffic</span> without buying separate switches for each department. Think of it as creating invisible walls inside your network.</p>
                    <p>One physical switch can act like multiple separate switches - Sales traffic stays with Sales, Engineering stays with Engineering, and Guests are isolated from everyone!</p>
                </div>

                <div class="problem-box">
                    <h3>üì¢ The Problem: Broadcast Chaos</h3>
                    <p>Imagine an office with 500 computers all on the same network. Every time one computer sends a broadcast (like "Who has this IP?" or "I'm looking for a printer!"), <strong>ALL 500 computers receive it</strong>.</p>
                    <ul style="margin: 15px 0 15px 25px; line-height: 2; color: #ffcdd2;">
                        <li>Network becomes slow from constant broadcast traffic</li>
                        <li>Security nightmare - anyone can see everyone's traffic</li>
                        <li>Accounting can sniff Engineering's data packets</li>
                        <li>Guest WiFi users can scan your entire network</li>
                    </ul>
                    <div class="broadcast-demo">
                        <svg id="broadcast-demo-svg" viewBox="0 0 500 280"></svg>
                        <br>
                        <button class="demo-btn" id="broadcast-btn">üì¢ Show Broadcast (No VLANs)</button>
                    </div>
                </div>

                <div class="solution-box">
                    <h3>‚úÖ The Solution: VLANs Create Boundaries</h3>
                    <p>With VLANs, you create <span class="highlight">separate broadcast domains</span>. A broadcast from VLAN 10 (Sales) stays in VLAN 10 - it never reaches VLAN 20 (Engineering).</p>
                    <div class="analogy">
                        "Think of VLANs like separate radio frequencies. Sales is on FM 101.1, Engineering is on FM 102.3. They can't hear each other even though they're using the same radio tower (switch)!"
                    </div>
                    <p>Now if someone in Sales sends a broadcast, only the 50 Sales computers receive it - not all 500 computers. <strong>90% less broadcast traffic!</strong></p>
                </div>

                <div class="info-section">
                    <h2>üéØ Why Use VLANs?</h2>
                    <table class="facts-table">
                        <thead>
                            <tr>
                                <th>Benefit</th>
                                <th>How It Helps</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>üîí <strong>Security</strong></td>
                                <td>Isolate sensitive traffic (payroll, HR, servers)</td>
                            </tr>
                            <tr>
                                <td>‚ö° <strong>Performance</strong></td>
                                <td>Smaller broadcast domains = less noise</td>
                            </tr>
                            <tr>
                                <td>üí∞ <strong>Cost Savings</strong></td>
                                <td>One switch does the work of many</td>
                            </tr>
                            <tr>
                                <td>üîß <strong>Flexibility</strong></td>
                                <td>Move users by changing port config, not cables</td>
                            </tr>
                            <tr>
                                <td>üìã <strong>Organization</strong></td>
                                <td>Group by function, not physical location</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="info-section">
                    <h2>üìä VLAN Quick Facts</h2>
                    <table class="facts-table">
                        <thead>
                            <tr>
                                <th>Property</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Standard</td>
                                <td><strong>IEEE 802.1Q</strong></td>
                            </tr>
                            <tr>
                                <td>VLAN Range</td>
                                <td>1-4094 (0 and 4095 reserved)</td>
                            </tr>
                            <tr>
                                <td>Normal Range</td>
                                <td>1-1005 (stored in vlan.dat)</td>
                            </tr>
                            <tr>
                                <td>Extended Range</td>
                                <td>1006-4094 (requires VTP transparent)</td>
                            </tr>
                            <tr>
                                <td>Default VLAN</td>
                                <td>VLAN 1 (cannot delete)</td>
                            </tr>
                            <tr>
                                <td>Tag Size</td>
                                <td>4 bytes added to frame</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="info-section">
                    <h2>üîç Want More Detail?</h2>

                    <div class="expandable">
                        <div class="expandable-header">
                            <h4>üè∑Ô∏è What's in a VLAN Tag?</h4>
                            <span class="arrow">‚ñº</span>
                        </div>
                        <div class="expandable-content">
                            <div class="expandable-content-inner">
                                <p>The 802.1Q tag adds 4 bytes to each Ethernet frame:</p>
                                <ul style="margin: 10px 0 10px 20px; line-height: 1.8;">
                                    <li><strong>TPID (2 bytes):</strong> Tag Protocol ID = 0x8100 (identifies tagged frame)</li>
                                    <li><strong>PCP (3 bits):</strong> Priority Code Point (QoS - 0-7)</li>
                                    <li><strong>DEI (1 bit):</strong> Drop Eligible Indicator</li>
                                    <li><strong>VID (12 bits):</strong> VLAN ID (0-4095)</li>
                                </ul>
                                <p style="margin-top: 10px;">12 bits for VLAN ID = 4096 possible VLANs (2^12)</p>
                            </div>
                        </div>
                    </div>

                    <div class="expandable">
                        <div class="expandable-header">
                            <h4>üìç What's a Native VLAN?</h4>
                            <span class="arrow">‚ñº</span>
                        </div>
                        <div class="expandable-content">
                            <div class="expandable-content-inner">
                                <p><strong>Native VLAN</strong> = the VLAN that carries untagged traffic on a trunk.</p>
                                <ul style="margin: 10px 0 10px 20px; line-height: 1.8;">
                                    <li>Default is VLAN 1</li>
                                    <li>Frames in native VLAN are NOT tagged on trunk</li>
                                    <li>Both ends of trunk MUST have same native VLAN</li>
                                    <li>Security tip: Change from VLAN 1 to unused VLAN</li>
                                </ul>
                                <pre>Switch(config-if)# switchport trunk native vlan 999</pre>
                            </div>
                        </div>
                    </div>

                    <div class="expandable">
                        <div class="expandable-header">
                            <h4>‚öôÔ∏è Basic VLAN Commands</h4>
                            <span class="arrow">‚ñº</span>
                        </div>
                        <div class="expandable-content">
                            <div class="expandable-content-inner">
                                <p><strong>Create a VLAN:</strong></p>
                                <pre>Switch(config)# vlan 10
Switch(config-vlan)# name Sales</pre>

                                <p style="margin-top: 15px;"><strong>Assign port to VLAN:</strong></p>
                                <pre>Switch(config)# interface fa0/1
Switch(config-if)# switchport mode access
Switch(config-if)# switchport access vlan 10</pre>

                                <p style="margin-top: 15px;"><strong>Create trunk:</strong></p>
                                <pre>Switch(config-if)# switchport mode trunk
Switch(config-if)# switchport trunk allowed vlan 10,20,30</pre>

                                <p style="margin-top: 15px;"><strong>Verify:</strong></p>
                                <pre>Switch# show vlan brief
Switch# show interfaces trunk</pre>
                            </div>
                        </div>
                    </div>

                    <div class="expandable">
                        <div class="expandable-header">
                            <h4>‚ö†Ô∏è Common VLAN Mistakes</h4>
                            <span class="arrow">‚ñº</span>
                        </div>
                        <div class="expandable-content">
                            <div class="expandable-content-inner">
                                <ul style="margin: 10px 0; line-height: 2;">
                                    <li><span class="danger">Native VLAN mismatch</span> - Both trunk ends need same native VLAN</li>
                                    <li><span class="danger">Forgetting to create VLAN</span> - Port assigned to non-existent VLAN won't forward</li>
                                    <li><span class="danger">Using VLAN 1</span> - Don't use for user data (security)</li>
                                    <li><span class="danger">No inter-VLAN routing</span> - VLANs can't talk without Layer 3</li>
                                    <li><span class="danger">Trunk pruning disabled</span> - All VLANs flood all trunks</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <p style="color: #888;">Ready to see tagging in action? Try the interactive tabs above! ‚Üí</p>
                </div>
            </div>
        </div>

        <!-- ==================== TAB 2: 802.1Q Tagging ==================== -->
        <div class="tab-content" id="tab-tagging">
            <div class="visualizer-container">
                <div class="topology-panel">
                    <svg class="topology-canvas" id="canvas-tagging"></svg>
                </div>
                <div class="info-panel">
                    <div class="instructions">
                        üí° Watch how frames get tagged and untagged as they travel through the network!
                    </div>

                    <div class="controls">
                        <h4>Send a Frame</h4>
                        <div class="vlan-select">
                            <label>From which VLAN?</label>
                            <select id="tagging-vlan-select">
                                <option value="10">VLAN 10 (Sales - Red)</option>
                                <option value="20">VLAN 20 (Engineering - Teal)</option>
                                <option value="30">VLAN 30 (Guest - Green)</option>
                            </select>
                        </div>
                        <button class="control-btn" id="send-frame-btn">üì® Send Frame</button>
                        <button class="control-btn" id="reset-tagging-btn">üîÑ Reset</button>
                    </div>

                    <div class="frame-display">
                        <h4>Current Frame Structure</h4>
                        <div class="frame-structure" id="frame-structure">
                            <div class="frame-field mac">Dest MAC<br>6 bytes</div>
                            <div class="frame-field mac">Src MAC<br>6 bytes</div>
                            <div class="frame-field type">Type<br>2 bytes</div>
                            <div class="frame-field data">Data<br>46-1500</div>
                            <div class="frame-field fcs">FCS<br>4 bytes</div>
                        </div>
                        <p id="frame-status" style="margin-top: 10px; font-size: 0.9em; color: #888; text-align: center;">
                            Untagged frame at source PC
                        </p>
                    </div>

                    <div class="legend">
                        <h4>How Tagging Works</h4>
                        <div style="font-size: 0.85em; color: #bbb; line-height: 1.8;">
                            <p><strong>1. PC sends untagged frame</strong> ‚Üí Access port</p>
                            <p><strong>2. Switch adds 802.1Q tag</strong> ‚Üí Frame enters trunk</p>
                            <p><strong>3. Frame travels tagged</strong> ‚Üí Between switches</p>
                            <p><strong>4. Switch removes tag</strong> ‚Üí Before delivery to PC</p>
                        </div>
                    </div>

                    <div class="expandable">
                        <div class="expandable-header">
                            <h4>üì¶ 802.1Q Tag Structure</h4>
                            <span class="arrow">‚ñº</span>
                        </div>
                        <div class="expandable-content">
                            <div class="expandable-content-inner">
                                <p>The 4-byte tag is inserted after Source MAC:</p>
                                <ul style="margin: 10px 0; line-height: 1.8; font-size: 0.9em;">
                                    <li><strong>TPID:</strong> 0x8100 (identifies 802.1Q)</li>
                                    <li><strong>PCP:</strong> QoS priority (0-7)</li>
                                    <li><strong>DEI:</strong> Drop eligibility</li>
                                    <li><strong>VID:</strong> VLAN ID (1-4094)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== TAB 3: Trunk vs Access ==================== -->
        <div class="tab-content" id="tab-ports">
            <div class="visualizer-container">
                <div class="topology-panel">
                    <svg class="topology-canvas" id="canvas-ports"></svg>
                </div>
                <div class="info-panel">
                    <div class="instructions">
                        üí° Click on switches or devices to see their port configurations!
                    </div>

                    <div class="legend">
                        <h4>Port Types</h4>
                        <div class="legend-item">
                            <span class="port-badge badge-access">Access</span>
                            <span>Single VLAN, end devices</span>
                        </div>
                        <div class="legend-item">
                            <span class="port-badge badge-trunk">Trunk</span>
                            <span>Multiple VLANs, switch-to-switch</span>
                        </div>
                    </div>

                    <div class="legend">
                        <h4>VLANs</h4>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #ff6b6b; border-color: #ff6b6b;"></div>
                            <span>VLAN 10 - Sales</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #4ecdc4; border-color: #4ecdc4;"></div>
                            <span>VLAN 20 - Engineering</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #95e1d3; border-color: #95e1d3;"></div>
                            <span>VLAN 30 - Guest</span>
                        </div>
                    </div>

                    <div id="ports-info">
                        <div class="no-selection">
                            <div class="icon">üîå</div>
                            <p>Click a switch or device to view<br>its port configuration</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== TAB 4: Inter-VLAN Routing ==================== -->
        <div class="tab-content" id="tab-routing">
            <div class="visualizer-container">
                <div class="topology-panel">
                    <svg class="topology-canvas" id="canvas-routing"></svg>
                </div>
                <div class="info-panel">
                    <div class="instructions">
                        üí° VLANs are isolated! Select a routing method to see how traffic flows between VLANs.
                    </div>

                    <div class="controls">
                        <h4>Routing Method</h4>
                        <button class="control-btn active" id="btn-no-routing" data-method="none">üö´ No Routing</button>
                        <button class="control-btn" id="btn-roas" data-method="roas">üîÄ Router-on-a-Stick</button>
                        <button class="control-btn" id="btn-svi" data-method="svi">üî∑ L3 Switch (SVI)</button>
                    </div>

                    <div class="controls">
                        <h4>Test Traffic</h4>
                        <div class="vlan-select">
                            <label>From:</label>
                            <select id="routing-from">
                                <option value="pc1">PC1 (VLAN 10 - Sales)</option>
                                <option value="pc2">PC2 (VLAN 20 - Engineering)</option>
                            </select>
                        </div>
                        <div class="vlan-select">
                            <label>To:</label>
                            <select id="routing-to">
                                <option value="pc2">PC2 (VLAN 20 - Engineering)</option>
                                <option value="pc1">PC1 (VLAN 10 - Sales)</option>
                            </select>
                        </div>
                        <button class="control-btn" id="test-routing-btn">üß™ Test Connection</button>
                    </div>

                    <div id="routing-status">
                        <div class="traffic-indicator blocked">
                            <div class="status">üö´ No Inter-VLAN Routing</div>
                            <p style="font-size: 0.85em; margin-top: 8px;">VLANs are isolated at Layer 2</p>
                        </div>
                    </div>

                    <div id="routing-info">
                        <div class="routing-method">
                            <h5>Current: No Routing</h5>
                            <p>Without Layer 3 routing, VLANs cannot communicate. Each VLAN is a separate broadcast domain.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== NETWORK TOPOLOGY DATA ====================
        const topology = {
            switches: [
                { id: 'SW1', x: 250, y: 120, label: 'Core Switch' },
                { id: 'SW2', x: 450, y: 120, label: 'Distribution' }
            ],
            router: { id: 'R1', x: 350, y: 40, label: 'Router' },
            l3switch: { id: 'L3SW', x: 350, y: 40, label: 'L3 Switch' },
            devices: [
                { id: 'PC1', x: 100, y: 220, vlan: 10, label: 'PC1', dept: 'Sales' },
                { id: 'PC2', x: 200, y: 280, vlan: 20, label: 'PC2', dept: 'Engineering' },
                { id: 'PC3', x: 300, y: 220, vlan: 10, label: 'PC3', dept: 'Sales' },
                { id: 'PC4', x: 500, y: 220, vlan: 20, label: 'PC4', dept: 'Engineering' },
                { id: 'PC5', x: 600, y: 280, vlan: 30, label: 'PC5', dept: 'Guest' }
            ],
            links: [
                // Switch interconnect (trunk)
                { from: 'SW1', to: 'SW2', type: 'trunk', vlans: [10, 20, 30] },
                // Devices to switches (access)
                { from: 'PC1', to: 'SW1', type: 'access', vlan: 10 },
                { from: 'PC2', to: 'SW1', type: 'access', vlan: 20 },
                { from: 'PC3', to: 'SW1', type: 'access', vlan: 10 },
                { from: 'PC4', to: 'SW2', type: 'access', vlan: 20 },
                { from: 'PC5', to: 'SW2', type: 'access', vlan: 30 }
            ]
        };

        const vlanColors = {
            10: '#ff6b6b',
            20: '#4ecdc4',
            30: '#95e1d3'
        };

        const vlanNames = {
            10: 'Sales',
            20: 'Engineering',
            30: 'Guest'
        };

        // State management
        let state = {
            activeTab: 'info',
            selectedElement: null,
            routingMethod: 'none',
            animationRunning: false,
            broadcastDemoRunning: false
        };

        // ==================== TAB SWITCHING ====================
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.dataset.tab;

                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.getElementById(`tab-${tabId}`).classList.add('active');

                state.activeTab = tabId;

                if (tabId === 'tagging') {
                    initTaggingCanvas();
                } else if (tabId === 'ports') {
                    initPortsCanvas();
                } else if (tabId === 'routing') {
                    initRoutingCanvas();
                }
            });
        });

        // ==================== EXPANDABLE SECTIONS ====================
        document.querySelectorAll('.expandable-header').forEach(header => {
            header.addEventListener('click', () => {
                header.parentElement.classList.toggle('open');
            });
        });

        // ==================== BROADCAST DEMO ====================
        function initBroadcastDemo() {
            const svg = document.getElementById('broadcast-demo-svg');
            svg.innerHTML = `
                <!-- Central Switch -->
                <rect x="200" y="100" width="100" height="50" rx="8" fill="#667eea" stroke="#fff" stroke-width="2"/>
                <text x="250" y="130" text-anchor="middle" fill="#fff" font-size="12" font-weight="bold">Switch</text>

                <!-- PCs around the switch -->
                <rect x="50" y="40" width="60" height="40" rx="5" fill="#2196f3" stroke="#fff" stroke-width="2"/>
                <text x="80" y="65" text-anchor="middle" fill="#fff" font-size="10">PC1</text>

                <rect x="50" y="180" width="60" height="40" rx="5" fill="#2196f3" stroke="#fff" stroke-width="2"/>
                <text x="80" y="205" text-anchor="middle" fill="#fff" font-size="10">PC2</text>

                <rect x="390" y="40" width="60" height="40" rx="5" fill="#2196f3" stroke="#fff" stroke-width="2"/>
                <text x="420" y="65" text-anchor="middle" fill="#fff" font-size="10">PC3</text>

                <rect x="390" y="180" width="60" height="40" rx="5" fill="#2196f3" stroke="#fff" stroke-width="2"/>
                <text x="420" y="205" text-anchor="middle" fill="#fff" font-size="10">PC4</text>

                <rect x="220" y="210" width="60" height="40" rx="5" fill="#2196f3" stroke="#fff" stroke-width="2"/>
                <text x="250" y="235" text-anchor="middle" fill="#fff" font-size="10">PC5</text>

                <!-- Links -->
                <line x1="110" y1="60" x2="200" y2="110" stroke="#555" stroke-width="2"/>
                <line x1="110" y1="200" x2="200" y2="140" stroke="#555" stroke-width="2"/>
                <line x1="390" y1="60" x2="300" y2="110" stroke="#555" stroke-width="2"/>
                <line x1="390" y1="200" x2="300" y2="140" stroke="#555" stroke-width="2"/>
                <line x1="250" y1="150" x2="250" y2="210" stroke="#555" stroke-width="2"/>
            `;
        }

        let broadcastInterval = null;
        document.getElementById('broadcast-btn').addEventListener('click', function() {
            const btn = this;
            const svg = document.getElementById('broadcast-demo-svg');

            if (state.broadcastDemoRunning) {
                state.broadcastDemoRunning = false;
                btn.textContent = 'üì¢ Show Broadcast (No VLANs)';
                btn.classList.remove('running');
                clearInterval(broadcastInterval);
                initBroadcastDemo();
                return;
            }

            state.broadcastDemoRunning = true;
            btn.textContent = '‚èπÔ∏è Stop';
            btn.classList.add('running');

            // PC1 sends broadcast
            const paths = [
                { x1: 80, y1: 80, x2: 250, y2: 125 },  // PC1 to Switch
                { x1: 250, y1: 125, x2: 80, y2: 180 },  // Switch to PC2
                { x1: 250, y1: 125, x2: 420, y2: 60 },  // Switch to PC3
                { x1: 250, y1: 125, x2: 420, y2: 200 }, // Switch to PC4
                { x1: 250, y1: 125, x2: 250, y2: 210 }  // Switch to PC5
            ];

            let pathIndex = 0;
            broadcastInterval = setInterval(() => {
                if (!state.broadcastDemoRunning) return;

                const path = paths[pathIndex % paths.length];
                const packet = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                packet.setAttribute('r', '8');
                packet.setAttribute('fill', '#ffc107');
                packet.setAttribute('cx', path.x1);
                packet.setAttribute('cy', path.y1);
                svg.appendChild(packet);

                let progress = 0;
                const animate = setInterval(() => {
                    progress += 0.04;
                    if (progress >= 1) {
                        clearInterval(animate);
                        packet.remove();
                        return;
                    }
                    packet.setAttribute('cx', path.x1 + (path.x2 - path.x1) * progress);
                    packet.setAttribute('cy', path.y1 + (path.y2 - path.y1) * progress);
                }, 25);

                pathIndex++;
            }, 150);
        });

        // ==================== TAB 2: TAGGING CANVAS ====================
        function initTaggingCanvas() {
            const svg = document.getElementById('canvas-tagging');
            const width = svg.clientWidth || 700;
            const height = svg.clientHeight || 400;

            svg.innerHTML = '';
            svg.setAttribute('viewBox', `0 0 ${width} ${height}`);

            // Draw simple topology: PC - Switch1 - (trunk) - Switch2 - PC
            const scale = Math.min(width / 700, height / 400);
            const offsetX = (width - 700 * scale) / 2;
            const offsetY = (height - 300 * scale) / 2;

            // Source PC
            drawDevice(svg, 80 * scale + offsetX, 200 * scale + offsetY, 'PC-A', 10, scale);

            // Switch 1
            drawSwitch(svg, 220 * scale + offsetX, 200 * scale + offsetY, 'SW1', scale);

            // Switch 2
            drawSwitch(svg, 480 * scale + offsetX, 200 * scale + offsetY, 'SW2', scale);

            // Destination PC
            drawDevice(svg, 620 * scale + offsetX, 200 * scale + offsetY, 'PC-B', 10, scale);

            // Links
            // PC-A to SW1 (access)
            drawLink(svg, 110 * scale + offsetX, 200 * scale + offsetY, 180 * scale + offsetX, 200 * scale + offsetY, 'access', 10, scale);
            // SW1 to SW2 (trunk)
            drawLink(svg, 260 * scale + offsetX, 200 * scale + offsetY, 440 * scale + offsetX, 200 * scale + offsetY, 'trunk', null, scale);
            // SW2 to PC-B (access)
            drawLink(svg, 520 * scale + offsetX, 200 * scale + offsetY, 590 * scale + offsetX, 200 * scale + offsetY, 'access', 10, scale);

            // Labels
            addText(svg, 165 * scale + offsetX, 170 * scale + offsetY, 'Access Port', 11 * scale, '#888');
            addText(svg, 350 * scale + offsetX, 170 * scale + offsetY, 'Trunk (802.1Q)', 12 * scale, '#ff9800');
            addText(svg, 555 * scale + offsetX, 170 * scale + offsetY, 'Access Port', 11 * scale, '#888');
        }

        function drawDevice(svg, x, y, label, vlan, scale) {
            const color = vlanColors[vlan] || '#2196f3';

            const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            rect.setAttribute('x', x - 25 * scale);
            rect.setAttribute('y', y - 20 * scale);
            rect.setAttribute('width', 50 * scale);
            rect.setAttribute('height', 40 * scale);
            rect.setAttribute('rx', 5 * scale);
            rect.setAttribute('fill', color);
            rect.setAttribute('stroke', '#fff');
            rect.setAttribute('stroke-width', 2);
            svg.appendChild(rect);

            addText(svg, x, y + 5 * scale, label, 11 * scale, '#fff', 'bold');
        }

        function drawSwitch(svg, x, y, label, scale) {
            const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            rect.setAttribute('x', x - 40 * scale);
            rect.setAttribute('y', y - 25 * scale);
            rect.setAttribute('width', 80 * scale);
            rect.setAttribute('height', 50 * scale);
            rect.setAttribute('rx', 8 * scale);
            rect.setAttribute('fill', '#667eea');
            rect.setAttribute('stroke', '#fff');
            rect.setAttribute('stroke-width', 2);
            svg.appendChild(rect);

            addText(svg, x, y + 5 * scale, label, 13 * scale, '#fff', 'bold');
        }

        function drawLink(svg, x1, y1, x2, y2, type, vlan, scale) {
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', x1);
            line.setAttribute('y1', y1);
            line.setAttribute('x2', x2);
            line.setAttribute('y2', y2);
            line.setAttribute('stroke-width', type === 'trunk' ? 6 * scale : 3 * scale);

            if (type === 'trunk') {
                line.setAttribute('stroke', '#ff9800');
            } else {
                line.setAttribute('stroke', vlan ? vlanColors[vlan] : '#555');
            }

            svg.appendChild(line);
        }

        function addText(svg, x, y, text, size, color, weight) {
            const textEl = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            textEl.setAttribute('x', x);
            textEl.setAttribute('y', y);
            textEl.setAttribute('text-anchor', 'middle');
            textEl.setAttribute('fill', color);
            textEl.setAttribute('font-size', size);
            if (weight) textEl.setAttribute('font-weight', weight);
            textEl.textContent = text;
            svg.appendChild(textEl);
        }

        // Send frame animation
        document.getElementById('send-frame-btn').addEventListener('click', function() {
            if (state.animationRunning) return;
            state.animationRunning = true;

            const svg = document.getElementById('canvas-tagging');
            const vlan = document.getElementById('tagging-vlan-select').value;
            const frameStatus = document.getElementById('frame-status');
            const frameStructure = document.getElementById('frame-structure');

            const width = svg.clientWidth || 700;
            const height = svg.clientHeight || 400;
            const scale = Math.min(width / 700, height / 400);
            const offsetX = (width - 700 * scale) / 2;
            const offsetY = (height - 300 * scale) / 2;

            // Create animated packet
            const packet = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            packet.setAttribute('r', 12 * scale);
            packet.setAttribute('fill', vlanColors[vlan]);
            packet.setAttribute('stroke', '#fff');
            packet.setAttribute('stroke-width', 2);
            svg.appendChild(packet);

            // Animation path: PC-A -> SW1 -> SW2 -> PC-B
            const path = [
                { x: 80 * scale + offsetX, y: 200 * scale + offsetY, status: 'Untagged frame leaving PC-A', tagged: false },
                { x: 220 * scale + offsetX, y: 200 * scale + offsetY, status: 'SW1 adds 802.1Q tag (VLAN ' + vlan + ')', tagged: true },
                { x: 480 * scale + offsetX, y: 200 * scale + offsetY, status: 'Tagged frame on trunk', tagged: true },
                { x: 620 * scale + offsetX, y: 200 * scale + offsetY, status: 'SW2 removes tag, delivers to PC-B', tagged: false }
            ];

            let step = 0;
            let progress = 0;

            function updateFrameDisplay(tagged) {
                if (tagged) {
                    frameStructure.innerHTML = `
                        <div class="frame-field mac">Dest MAC<br>6 bytes</div>
                        <div class="frame-field mac">Src MAC<br>6 bytes</div>
                        <div class="frame-field tag">802.1Q<br>VLAN ${vlan}</div>
                        <div class="frame-field type">Type<br>2 bytes</div>
                        <div class="frame-field data">Data<br>46-1500</div>
                        <div class="frame-field fcs">FCS<br>4 bytes</div>
                    `;
                } else {
                    frameStructure.innerHTML = `
                        <div class="frame-field mac">Dest MAC<br>6 bytes</div>
                        <div class="frame-field mac">Src MAC<br>6 bytes</div>
                        <div class="frame-field type">Type<br>2 bytes</div>
                        <div class="frame-field data">Data<br>46-1500</div>
                        <div class="frame-field fcs">FCS<br>4 bytes</div>
                    `;
                }
            }

            function animate() {
                if (step >= path.length - 1) {
                    packet.remove();
                    state.animationRunning = false;
                    frameStatus.textContent = 'Frame delivered! Click Send Frame to try again.';
                    return;
                }

                const from = path[step];
                const to = path[step + 1];

                progress += 0.02;
                const x = from.x + (to.x - from.x) * progress;
                const y = from.y + (to.y - from.y) * progress;

                packet.setAttribute('cx', x);
                packet.setAttribute('cy', y);

                if (progress >= 1) {
                    progress = 0;
                    step++;
                    if (step < path.length) {
                        frameStatus.textContent = path[step].status;
                        updateFrameDisplay(path[step].tagged);
                    }
                }

                requestAnimationFrame(animate);
            }

            packet.setAttribute('cx', path[0].x);
            packet.setAttribute('cy', path[0].y);
            frameStatus.textContent = path[0].status;
            updateFrameDisplay(path[0].tagged);
            animate();
        });

        document.getElementById('reset-tagging-btn').addEventListener('click', function() {
            initTaggingCanvas();
            document.getElementById('frame-status').textContent = 'Untagged frame at source PC';
            document.getElementById('frame-structure').innerHTML = `
                <div class="frame-field mac">Dest MAC<br>6 bytes</div>
                <div class="frame-field mac">Src MAC<br>6 bytes</div>
                <div class="frame-field type">Type<br>2 bytes</div>
                <div class="frame-field data">Data<br>46-1500</div>
                <div class="frame-field fcs">FCS<br>4 bytes</div>
            `;
        });

        // ==================== TAB 3: PORTS CANVAS ====================
        function initPortsCanvas() {
            const svg = document.getElementById('canvas-ports');
            const width = svg.clientWidth || 700;
            const height = svg.clientHeight || 400;

            svg.innerHTML = '';
            svg.setAttribute('viewBox', `0 0 ${width} ${height}`);

            const scale = Math.min(width / 700, height / 350);
            const offsetX = (width - 700 * scale) / 2;
            const offsetY = 30;

            // Draw Switches
            topology.switches.forEach(sw => {
                const x = sw.x * scale + offsetX;
                const y = sw.y * scale + offsetY;
                drawClickableSwitch(svg, x, y, sw, scale);
            });

            // Draw devices
            topology.devices.forEach(dev => {
                const x = dev.x * scale + offsetX;
                const y = dev.y * scale + offsetY;
                drawClickableDevice(svg, x, y, dev, scale);
            });

            // Draw links
            topology.links.forEach(link => {
                const from = [...topology.switches, ...topology.devices].find(n => n.id === link.from);
                const to = [...topology.switches, ...topology.devices].find(n => n.id === link.to);

                if (from && to) {
                    const x1 = from.x * scale + offsetX;
                    const y1 = from.y * scale + offsetY;
                    const x2 = to.x * scale + offsetX;
                    const y2 = to.y * scale + offsetY;

                    if (link.type === 'trunk') {
                        drawTrunkLink(svg, x1, y1, x2, y2, scale);
                    } else {
                        drawAccessLink(svg, x1, y1, x2, y2, link.vlan, scale);
                    }
                }
            });
        }

        function drawClickableSwitch(svg, x, y, sw, scale) {
            const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            group.style.cursor = 'pointer';
            group.setAttribute('data-id', sw.id);

            const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            rect.setAttribute('x', x - 50 * scale);
            rect.setAttribute('y', y - 30 * scale);
            rect.setAttribute('width', 100 * scale);
            rect.setAttribute('height', 60 * scale);
            rect.setAttribute('rx', 8 * scale);
            rect.setAttribute('fill', '#667eea');
            rect.setAttribute('stroke', '#fff');
            rect.setAttribute('stroke-width', 2);
            group.appendChild(rect);

            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.setAttribute('x', x);
            text.setAttribute('y', y);
            text.setAttribute('text-anchor', 'middle');
            text.setAttribute('fill', '#fff');
            text.setAttribute('font-size', 13 * scale);
            text.setAttribute('font-weight', 'bold');
            text.textContent = sw.id;
            group.appendChild(text);

            const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            label.setAttribute('x', x);
            label.setAttribute('y', y + 15 * scale);
            label.setAttribute('text-anchor', 'middle');
            label.setAttribute('fill', 'rgba(255,255,255,0.7)');
            label.setAttribute('font-size', 9 * scale);
            label.textContent = sw.label;
            group.appendChild(label);

            group.addEventListener('click', () => showSwitchInfo(sw.id));
            svg.appendChild(group);
        }

        function drawClickableDevice(svg, x, y, dev, scale) {
            const color = vlanColors[dev.vlan];
            const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            group.style.cursor = 'pointer';
            group.setAttribute('data-id', dev.id);

            const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            rect.setAttribute('x', x - 30 * scale);
            rect.setAttribute('y', y - 22 * scale);
            rect.setAttribute('width', 60 * scale);
            rect.setAttribute('height', 44 * scale);
            rect.setAttribute('rx', 6 * scale);
            rect.setAttribute('fill', color);
            rect.setAttribute('stroke', '#fff');
            rect.setAttribute('stroke-width', 2);
            group.appendChild(rect);

            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.setAttribute('x', x);
            text.setAttribute('y', y);
            text.setAttribute('text-anchor', 'middle');
            text.setAttribute('fill', '#fff');
            text.setAttribute('font-size', 11 * scale);
            text.setAttribute('font-weight', 'bold');
            text.textContent = dev.label;
            group.appendChild(text);

            const dept = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            dept.setAttribute('x', x);
            dept.setAttribute('y', y + 12 * scale);
            dept.setAttribute('text-anchor', 'middle');
            dept.setAttribute('fill', 'rgba(255,255,255,0.8)');
            dept.setAttribute('font-size', 8 * scale);
            dept.textContent = dev.dept;
            group.appendChild(dept);

            group.addEventListener('click', () => showDeviceInfo(dev));
            svg.appendChild(group);
        }

        function drawTrunkLink(svg, x1, y1, x2, y2, scale) {
            // Multi-colored trunk line
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', x1);
            line.setAttribute('y1', y1);
            line.setAttribute('x2', x2);
            line.setAttribute('y2', y2);
            line.setAttribute('stroke', '#ff9800');
            line.setAttribute('stroke-width', 8 * scale);
            svg.appendChild(line);

            // Add "TRUNK" label
            const midX = (x1 + x2) / 2;
            const midY = (y1 + y2) / 2 - 15 * scale;
            addText(svg, midX, midY, 'TRUNK', 10 * scale, '#ff9800', 'bold');
        }

        function drawAccessLink(svg, x1, y1, x2, y2, vlan, scale) {
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', x1);
            line.setAttribute('y1', y1);
            line.setAttribute('x2', x2);
            line.setAttribute('y2', y2);
            line.setAttribute('stroke', vlanColors[vlan]);
            line.setAttribute('stroke-width', 3 * scale);
            svg.appendChild(line);
        }

        function showSwitchInfo(switchId) {
            const container = document.getElementById('ports-info');
            const sw = topology.switches.find(s => s.id === switchId);

            // Find all links connected to this switch
            const connectedLinks = topology.links.filter(l => l.from === switchId || l.to === switchId);

            let portsHtml = '';
            connectedLinks.forEach((link, i) => {
                const neighbor = link.from === switchId ? link.to : link.from;
                const portType = link.type === 'trunk' ? 'Trunk' : 'Access';
                const badgeClass = link.type === 'trunk' ? 'badge-trunk' : 'badge-access';
                const vlanInfo = link.type === 'trunk' ?
                    'VLANs: ' + link.vlans.join(', ') :
                    'VLAN ' + link.vlan;

                portsHtml += `
                    <div class="port-item">
                        <div>
                            <span class="port-name">Fa0/${i}</span> ‚Üí ${neighbor}
                            <div style="font-size: 0.8em; color: #888;">${vlanInfo}</div>
                        </div>
                        <span class="port-badge ${badgeClass}">${portType}</span>
                    </div>
                `;
            });

            container.innerHTML = `
                <div class="selection-info">
                    <p><span class="label">Selected:</span> <span class="value">${sw.id}</span></p>
                    <p><span class="label">Role:</span> <span class="value">${sw.label}</span></p>
                    <p><span class="label">Ports:</span> <span class="value">${connectedLinks.length} connected</span></p>
                </div>
                <h4 style="color: #fff; margin: 15px 0 10px;">Port Configuration</h4>
                ${portsHtml}
                <div class="code-display" style="margin-top: 15px;">
<span class="comment">! Trunk configuration</span>
interface Gig0/1
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30

<span class="comment">! Access port configuration</span>
interface range Fa0/1-10
  switchport mode access
  switchport access vlan 10
                </div>
            `;
        }

        function showDeviceInfo(dev) {
            const container = document.getElementById('ports-info');
            const color = vlanColors[dev.vlan];

            container.innerHTML = `
                <div class="selection-info">
                    <p><span class="label">Device:</span> <span class="value">${dev.label}</span></p>
                    <p><span class="label">Department:</span> <span class="value">${dev.dept}</span></p>
                    <p><span class="label">VLAN:</span> <span class="value" style="color: ${color}">${dev.vlan} (${vlanNames[dev.vlan]})</span></p>
                </div>
                <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <h4 style="color: #fff; margin-bottom: 10px;">Can Communicate With:</h4>
                    <ul style="margin: 0; padding-left: 20px; color: #bbb; line-height: 1.8;">
                        ${topology.devices.filter(d => d.vlan === dev.vlan && d.id !== dev.id).map(d =>
                            `<li>${d.label} (${d.dept}) ‚úÖ</li>`
                        ).join('')}
                    </ul>
                    <h4 style="color: #fff; margin: 15px 0 10px;">Cannot Communicate With (without routing):</h4>
                    <ul style="margin: 0; padding-left: 20px; color: #f44336; line-height: 1.8;">
                        ${topology.devices.filter(d => d.vlan !== dev.vlan).map(d =>
                            `<li>${d.label} (${d.dept}) üö´</li>`
                        ).join('')}
                    </ul>
                </div>
            `;
        }

        // ==================== TAB 4: ROUTING CANVAS ====================
        function initRoutingCanvas() {
            const svg = document.getElementById('canvas-routing');
            const width = svg.clientWidth || 700;
            const height = svg.clientHeight || 400;

            svg.innerHTML = '';
            svg.setAttribute('viewBox', `0 0 ${width} ${height}`);

            const scale = Math.min(width / 700, height / 400);
            const offsetX = (width - 700 * scale) / 2;
            const offsetY = 40;

            // Draw based on routing method
            if (state.routingMethod === 'none') {
                drawBasicTopology(svg, scale, offsetX, offsetY);
            } else if (state.routingMethod === 'roas') {
                drawRoasTopology(svg, scale, offsetX, offsetY);
            } else if (state.routingMethod === 'svi') {
                drawSviTopology(svg, scale, offsetX, offsetY);
            }

            updateRoutingInfo();
        }

        function drawBasicTopology(svg, scale, offsetX, offsetY) {
            // Switch
            drawSwitch(svg, 350 * scale + offsetX, 150 * scale + offsetY, 'Switch', scale);

            // PCs
            drawDevice(svg, 150 * scale + offsetX, 280 * scale + offsetY, 'PC1', 10, scale);
            drawDevice(svg, 550 * scale + offsetX, 280 * scale + offsetY, 'PC2', 20, scale);

            // Links
            drawAccessLink(svg, 150 * scale + offsetX, 260 * scale + offsetY, 320 * scale + offsetX, 170 * scale + offsetY, 10, scale);
            drawAccessLink(svg, 550 * scale + offsetX, 260 * scale + offsetY, 380 * scale + offsetX, 170 * scale + offsetY, 20, scale);

            // VLAN labels
            addText(svg, 150 * scale + offsetX, 320 * scale + offsetY, 'VLAN 10 - Sales', 10 * scale, '#ff6b6b');
            addText(svg, 150 * scale + offsetX, 335 * scale + offsetY, '192.168.10.10', 9 * scale, '#888');
            addText(svg, 550 * scale + offsetX, 320 * scale + offsetY, 'VLAN 20 - Engineering', 10 * scale, '#4ecdc4');
            addText(svg, 550 * scale + offsetX, 335 * scale + offsetY, '192.168.20.20', 9 * scale, '#888');

            // Barrier line
            const barrierLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            barrierLine.setAttribute('x1', 350 * scale + offsetX);
            barrierLine.setAttribute('y1', 50 * scale + offsetY);
            barrierLine.setAttribute('x2', 350 * scale + offsetX);
            barrierLine.setAttribute('y2', 350 * scale + offsetY);
            barrierLine.setAttribute('stroke', '#f44336');
            barrierLine.setAttribute('stroke-width', 2);
            barrierLine.setAttribute('stroke-dasharray', '10,5');
            barrierLine.setAttribute('opacity', '0.5');
            svg.appendChild(barrierLine);

            addText(svg, 350 * scale + offsetX, 40 * scale + offsetY, 'üö´ No L3 Routing', 12 * scale, '#f44336', 'bold');
        }

        function drawRoasTopology(svg, scale, offsetX, offsetY) {
            // Router at top
            const routerGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            const routerCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            routerCircle.setAttribute('cx', 350 * scale + offsetX);
            routerCircle.setAttribute('cy', 60 * scale + offsetY);
            routerCircle.setAttribute('r', 35 * scale);
            routerCircle.setAttribute('fill', '#2196f3');
            routerCircle.setAttribute('stroke', '#fff');
            routerCircle.setAttribute('stroke-width', 3);
            routerGroup.appendChild(routerCircle);
            addText(svg, 350 * scale + offsetX, 65 * scale + offsetY, 'Router', 12 * scale, '#fff', 'bold');
            svg.appendChild(routerGroup);

            // Subinterfaces
            addText(svg, 280 * scale + offsetX, 100 * scale + offsetY, 'Gig0/0.10', 9 * scale, '#ff6b6b');
            addText(svg, 420 * scale + offsetX, 100 * scale + offsetY, 'Gig0/0.20', 9 * scale, '#4ecdc4');

            // Switch
            drawSwitch(svg, 350 * scale + offsetX, 180 * scale + offsetY, 'Switch', scale);

            // Trunk link (router to switch)
            drawTrunkLink(svg, 350 * scale + offsetX, 95 * scale + offsetY, 350 * scale + offsetX, 150 * scale + offsetY, scale);

            // PCs
            drawDevice(svg, 150 * scale + offsetX, 300 * scale + offsetY, 'PC1', 10, scale);
            drawDevice(svg, 550 * scale + offsetX, 300 * scale + offsetY, 'PC2', 20, scale);

            // Access links
            drawAccessLink(svg, 150 * scale + offsetX, 280 * scale + offsetY, 320 * scale + offsetX, 200 * scale + offsetY, 10, scale);
            drawAccessLink(svg, 550 * scale + offsetX, 280 * scale + offsetY, 380 * scale + offsetX, 200 * scale + offsetY, 20, scale);

            // IP addresses
            addText(svg, 150 * scale + offsetX, 340 * scale + offsetY, '192.168.10.10', 9 * scale, '#888');
            addText(svg, 150 * scale + offsetX, 355 * scale + offsetY, 'GW: .1', 8 * scale, '#666');
            addText(svg, 550 * scale + offsetX, 340 * scale + offsetY, '192.168.20.20', 9 * scale, '#888');
            addText(svg, 550 * scale + offsetX, 355 * scale + offsetY, 'GW: .1', 8 * scale, '#666');

            addText(svg, 350 * scale + offsetX, 30 * scale + offsetY, '‚úÖ Router-on-a-Stick', 12 * scale, '#4caf50', 'bold');
        }

        function drawSviTopology(svg, scale, offsetX, offsetY) {
            // L3 Switch
            const l3Group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            const l3Rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            l3Rect.setAttribute('x', 290 * scale + offsetX);
            l3Rect.setAttribute('y', 100 * scale + offsetY);
            l3Rect.setAttribute('width', 120 * scale);
            l3Rect.setAttribute('height', 70 * scale);
            l3Rect.setAttribute('rx', 10 * scale);
            l3Rect.setAttribute('fill', 'linear-gradient(135deg, #667eea, #764ba2)');
            l3Rect.setAttribute('fill', '#9c27b0');
            l3Rect.setAttribute('stroke', '#fff');
            l3Rect.setAttribute('stroke-width', 3);
            l3Group.appendChild(l3Rect);
            svg.appendChild(l3Group);

            addText(svg, 350 * scale + offsetX, 130 * scale + offsetY, 'L3 Switch', 13 * scale, '#fff', 'bold');
            addText(svg, 350 * scale + offsetX, 150 * scale + offsetY, '(ip routing)', 10 * scale, 'rgba(255,255,255,0.7)');

            // SVIs
            addText(svg, 250 * scale + offsetX, 95 * scale + offsetY, 'SVI VLAN 10', 9 * scale, '#ff6b6b');
            addText(svg, 250 * scale + offsetX, 107 * scale + offsetY, '192.168.10.1', 8 * scale, '#888');
            addText(svg, 450 * scale + offsetX, 95 * scale + offsetY, 'SVI VLAN 20', 9 * scale, '#4ecdc4');
            addText(svg, 450 * scale + offsetX, 107 * scale + offsetY, '192.168.20.1', 8 * scale, '#888');

            // PCs
            drawDevice(svg, 150 * scale + offsetX, 280 * scale + offsetY, 'PC1', 10, scale);
            drawDevice(svg, 550 * scale + offsetX, 280 * scale + offsetY, 'PC2', 20, scale);

            // Access links
            drawAccessLink(svg, 150 * scale + offsetX, 260 * scale + offsetY, 320 * scale + offsetX, 170 * scale + offsetY, 10, scale);
            drawAccessLink(svg, 550 * scale + offsetX, 260 * scale + offsetY, 380 * scale + offsetX, 170 * scale + offsetY, 20, scale);

            // IP addresses
            addText(svg, 150 * scale + offsetX, 320 * scale + offsetY, '192.168.10.10', 9 * scale, '#888');
            addText(svg, 550 * scale + offsetX, 320 * scale + offsetY, '192.168.20.20', 9 * scale, '#888');

            addText(svg, 350 * scale + offsetX, 60 * scale + offsetY, '‚úÖ Layer 3 Switch (SVI)', 12 * scale, '#4caf50', 'bold');
        }

        function updateRoutingInfo() {
            const statusContainer = document.getElementById('routing-status');
            const infoContainer = document.getElementById('routing-info');

            if (state.routingMethod === 'none') {
                statusContainer.innerHTML = `
                    <div class="traffic-indicator blocked">
                        <div class="status">üö´ No Inter-VLAN Routing</div>
                        <p style="font-size: 0.85em; margin-top: 8px;">VLANs are isolated at Layer 2</p>
                    </div>
                `;
                infoContainer.innerHTML = `
                    <div class="routing-method">
                        <h5>Current: No Routing</h5>
                        <p>Without Layer 3 routing, VLANs cannot communicate. Each VLAN is a separate broadcast domain - like separate networks.</p>
                    </div>
                `;
            } else if (state.routingMethod === 'roas') {
                statusContainer.innerHTML = `
                    <div class="traffic-indicator">
                        <div class="status" style="color: #4caf50;">‚úÖ Inter-VLAN Routing Active</div>
                        <p style="font-size: 0.85em; margin-top: 8px;">Router-on-a-Stick enabled</p>
                    </div>
                `;
                infoContainer.innerHTML = `
                    <div class="routing-method">
                        <h5>Router-on-a-Stick (ROAS)</h5>
                        <p>Single physical link with multiple subinterfaces. Each subinterface handles one VLAN.</p>
                    </div>
                    <div class="code-display">
<span class="comment">! Router configuration</span>
interface Gig0/0
  no shutdown

interface Gig0/0.10
  encapsulation dot1Q 10
  ip address 192.168.10.1 255.255.255.0

interface Gig0/0.20
  encapsulation dot1Q 20
  ip address 192.168.20.1 255.255.255.0
                    </div>
                    <p style="font-size: 0.85em; color: #ffc107; margin-top: 10px;">‚ö†Ô∏è Single link = potential bottleneck</p>
                `;
            } else if (state.routingMethod === 'svi') {
                statusContainer.innerHTML = `
                    <div class="traffic-indicator">
                        <div class="status" style="color: #4caf50;">‚úÖ Inter-VLAN Routing Active</div>
                        <p style="font-size: 0.85em; margin-top: 8px;">Layer 3 Switch (SVI)</p>
                    </div>
                `;
                infoContainer.innerHTML = `
                    <div class="routing-method">
                        <h5>Layer 3 Switch (SVI)</h5>
                        <p>Switch Virtual Interfaces route between VLANs at wire speed. No external router needed!</p>
                    </div>
                    <div class="code-display">
<span class="comment">! L3 Switch configuration</span>
ip routing

interface vlan 10
  ip address 192.168.10.1 255.255.255.0
  no shutdown

interface vlan 20
  ip address 192.168.20.1 255.255.255.0
  no shutdown
                    </div>
                    <p style="font-size: 0.85em; color: #4caf50; margin-top: 10px;">‚úÖ Best performance for enterprise networks</p>
                `;
            }
        }

        // Routing method buttons
        document.querySelectorAll('[data-method]').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('[data-method]').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                state.routingMethod = this.dataset.method;
                initRoutingCanvas();
            });
        });

        // Test routing button
        document.getElementById('test-routing-btn').addEventListener('click', function() {
            if (state.animationRunning) return;

            const fromDevice = document.getElementById('routing-from').value;
            const toDevice = document.getElementById('routing-to').value;

            if (fromDevice === toDevice) {
                alert('Select different devices to test inter-VLAN routing!');
                return;
            }

            const statusContainer = document.getElementById('routing-status');

            if (state.routingMethod === 'none') {
                statusContainer.innerHTML = `
                    <div class="traffic-indicator blocked">
                        <div class="status">üö´ Connection FAILED</div>
                        <p style="font-size: 0.85em; margin-top: 8px;">No Layer 3 device to route between VLANs!</p>
                    </div>
                `;
            } else {
                state.animationRunning = true;
                statusContainer.innerHTML = `
                    <div class="traffic-indicator">
                        <div class="status" style="color: #4caf50;">‚úÖ Connection SUCCESS!</div>
                        <p style="font-size: 0.85em; margin-top: 8px;">Traffic routed via ${state.routingMethod === 'roas' ? 'Router subinterfaces' : 'SVI interfaces'}</p>
                    </div>
                `;

                // Animate packet
                const svg = document.getElementById('canvas-routing');
                const packet = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                packet.setAttribute('r', '10');
                packet.setAttribute('fill', '#ffc107');
                packet.setAttribute('stroke', '#fff');
                packet.setAttribute('stroke-width', '2');

                const width = svg.clientWidth || 700;
                const height = svg.clientHeight || 400;
                const scale = Math.min(width / 700, height / 400);
                const offsetX = (width - 700 * scale) / 2;
                const offsetY = 40;

                // Device positions - PC1 is at x=150, PC2 is at x=550
                const devicePositions = {
                    pc1: { x: 150, yRoas: 300, ySvi: 280 },
                    pc2: { x: 550, yRoas: 300, ySvi: 280 }
                };

                const fromPos = devicePositions[fromDevice];
                const toPos = devicePositions[toDevice];

                let path;
                if (state.routingMethod === 'roas') {
                    path = [
                        { x: fromPos.x * scale + offsetX, y: fromPos.yRoas * scale + offsetY },
                        { x: 350 * scale + offsetX, y: 180 * scale + offsetY },
                        { x: 350 * scale + offsetX, y: 60 * scale + offsetY },
                        { x: 350 * scale + offsetX, y: 180 * scale + offsetY },
                        { x: toPos.x * scale + offsetX, y: toPos.yRoas * scale + offsetY }
                    ];
                } else {
                    path = [
                        { x: fromPos.x * scale + offsetX, y: fromPos.ySvi * scale + offsetY },
                        { x: 350 * scale + offsetX, y: 135 * scale + offsetY },
                        { x: toPos.x * scale + offsetX, y: toPos.ySvi * scale + offsetY }
                    ];
                }

                let step = 0;
                let progress = 0;
                packet.setAttribute('cx', path[0].x);
                packet.setAttribute('cy', path[0].y);
                svg.appendChild(packet);

                function animate() {
                    if (step >= path.length - 1) {
                        packet.remove();
                        state.animationRunning = false;
                        return;
                    }

                    progress += 0.03;
                    const from = path[step];
                    const to = path[step + 1];
                    const x = from.x + (to.x - from.x) * progress;
                    const y = from.y + (to.y - from.y) * progress;

                    packet.setAttribute('cx', x);
                    packet.setAttribute('cy', y);

                    if (progress >= 1) {
                        progress = 0;
                        step++;
                    }

                    requestAnimationFrame(animate);
                }

                animate();
            }
        });

        // ==================== INITIALIZATION ====================
        initBroadcastDemo();
    </script>
</body>
</html>
