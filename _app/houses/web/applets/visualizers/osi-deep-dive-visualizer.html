<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSI Model Deep Dive - Interactive Visualizer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #4f46e5 0%, #818cf8 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            color: white;
            padding: 30px 0;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .back-link {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            text-decoration: none;
            font-size: 1.1em;
            opacity: 0.8;
            transition: opacity 0.3s;
        }

        .back-link:hover {
            opacity: 1;
        }

        /* Tabs */
        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 15px 30px;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .tab-btn.active {
            background: white;
            color: #4f46e5;
            border-color: white;
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .tab-content.active {
            display: block;
        }

        h2 {
            color: #4f46e5;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        h3 {
            color: #6366f1;
            margin: 25px 0 15px;
            font-size: 1.4em;
        }

        /* Layer Explorer */
        .layer-explorer {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
            margin: 20px 0;
        }

        .layer-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .layer-item {
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .layer-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .layer-item.active {
            transform: translateX(10px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .layer7-item { background: linear-gradient(90deg, #ef4444, #f87171); }
        .layer6-item { background: linear-gradient(90deg, #f97316, #fb923c); }
        .layer5-item { background: linear-gradient(90deg, #eab308, #facc15); }
        .layer4-item { background: linear-gradient(90deg, #22c55e, #4ade80); }
        .layer3-item { background: linear-gradient(90deg, #06b6d4, #22d3ee); }
        .layer2-item { background: linear-gradient(90deg, #3b82f6, #60a5fa); }
        .layer1-item { background: linear-gradient(90deg, #8b5cf6, #a78bfa); }

        .layer-details {
            background: #f8fafc;
            border-radius: 15px;
            padding: 30px;
            min-height: 400px;
        }

        .layer-details h3 {
            color: #4f46e5;
            margin-top: 0;
        }

        .detail-section {
            margin: 20px 0;
        }

        .detail-section h4 {
            color: #6366f1;
            margin-bottom: 10px;
        }

        .protocol-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .protocol-tag {
            background: #e0e7ff;
            color: #4f46e5;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }

        /* Encapsulation Animator */
        .encapsulation-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin: 30px 0;
        }

        .encap-stage {
            width: 100%;
            max-width: 800px;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            opacity: 0.3;
            transition: all 0.5s;
            position: relative;
        }

        .encap-stage.active {
            opacity: 1;
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .encap-stage.completed {
            opacity: 0.7;
        }

        .data-visual {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 0.9em;
            flex-wrap: wrap;
        }

        .header-box {
            padding: 8px 12px;
            border-radius: 5px;
            font-weight: bold;
        }

        .animation-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #4f46e5;
            color: white;
        }

        .btn-primary:hover {
            background: #4338ca;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        /* Protocol Mapper */
        .mapper-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin: 30px 0;
        }

        .protocol-pool {
            min-height: 400px;
        }

        .layer-zones {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .drop-zone {
            padding: 15px;
            border: 2px dashed #cbd5e1;
            border-radius: 10px;
            min-height: 60px;
            transition: all 0.3s;
        }

        .drop-zone.drag-over {
            background: #f0f9ff;
            border-color: #4f46e5;
        }

        .drop-zone.correct {
            background: #d1fae5;
            border-color: #10b981;
        }

        .drop-zone.incorrect {
            background: #fee2e2;
            border-color: #ef4444;
        }

        .draggable-protocol {
            padding: 12px 20px;
            background: white;
            border: 2px solid #4f46e5;
            border-radius: 8px;
            margin: 8px;
            cursor: move;
            display: inline-block;
            transition: all 0.3s;
        }

        .draggable-protocol:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(79, 70, 229, 0.3);
        }

        .draggable-protocol.dragging {
            opacity: 0.5;
        }

        /* Quiz */
        .quiz-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .quiz-question {
            background: #f8fafc;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
        }

        .quiz-question h4 {
            color: #4f46e5;
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quiz-option {
            padding: 15px 20px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quiz-option:hover {
            border-color: #818cf8;
            background: #f5f3ff;
        }

        .quiz-option.selected {
            border-color: #4f46e5;
            background: #e0e7ff;
        }

        .quiz-option.correct {
            border-color: #10b981;
            background: #d1fae5;
        }

        .quiz-option.incorrect {
            border-color: #ef4444;
            background: #fee2e2;
        }

        .quiz-feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }

        .quiz-feedback.show {
            display: block;
        }

        .quiz-feedback.correct {
            background: #d1fae5;
            color: #065f46;
        }

        .quiz-feedback.incorrect {
            background: #fee2e2;
            color: #991b1b;
        }

        .quiz-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .score-display {
            font-size: 1.2em;
            color: #4f46e5;
            font-weight: bold;
        }

        .info-box {
            background: #e0e7ff;
            border-left: 4px solid #818cf8;
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 0 10px 10px 0;
        }

        .success-box {
            background: #d1fae5;
            border-left: 4px solid #10b981;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
            text-align: center;
        }

        @media (max-width: 900px) {
            .layer-explorer,
            .mapper-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <a href="../../index.html" class="back-link">‚Üê Back to Catalog</a>

    <div class="container">
        <header>
            <h1>üì° OSI Model Deep Dive</h1>
            <p>Interactive Layer Explorer & Learning Tools</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" data-tab="explorer">Layer Explorer</button>
            <button class="tab-btn" data-tab="encapsulation">Encapsulation Animator</button>
            <button class="tab-btn" data-tab="mapper">Protocol Mapper</button>
            <button class="tab-btn" data-tab="quiz">Quiz</button>
        </div>

        <!-- Tab 1: Layer Explorer -->
        <div id="explorer" class="tab-content active">
            <h2>Interactive Layer Explorer</h2>
            <p>Click on any OSI layer to explore its details:</p>

            <div class="layer-explorer">
                <div class="layer-list">
                    <div class="layer-item layer7-item active" data-layer="7">
                        <span>Layer 7 - Application</span>
                        <span>‚Üí</span>
                    </div>
                    <div class="layer-item layer6-item" data-layer="6">
                        <span>Layer 6 - Presentation</span>
                        <span>‚Üí</span>
                    </div>
                    <div class="layer-item layer5-item" data-layer="5">
                        <span>Layer 5 - Session</span>
                        <span>‚Üí</span>
                    </div>
                    <div class="layer-item layer4-item" data-layer="4">
                        <span>Layer 4 - Transport</span>
                        <span>‚Üí</span>
                    </div>
                    <div class="layer-item layer3-item" data-layer="3">
                        <span>Layer 3 - Network</span>
                        <span>‚Üí</span>
                    </div>
                    <div class="layer-item layer2-item" data-layer="2">
                        <span>Layer 2 - Data Link</span>
                        <span>‚Üí</span>
                    </div>
                    <div class="layer-item layer1-item" data-layer="1">
                        <span>Layer 1 - Physical</span>
                        <span>‚Üí</span>
                    </div>
                </div>

                <div class="layer-details" id="layerDetails">
                    <!-- Layer details populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Tab 2: Encapsulation Animator -->
        <div id="encapsulation" class="tab-content">
            <h2>Encapsulation Animation</h2>
            <p>Watch how data is encapsulated as it travels down the OSI stack:</p>

            <div class="animation-controls">
                <button class="btn btn-primary" onclick="startEncapsulation()">‚ñ∂ Start Animation</button>
                <button class="btn btn-secondary" onclick="resetEncapsulation()">‚Ü∫ Reset</button>
                <button class="btn btn-secondary" onclick="toggleDirection()">‚áÖ Reverse (De-encapsulation)</button>
            </div>

            <div id="directionIndicator" style="text-align: center; font-size: 1.2em; color: #4f46e5; font-weight: bold; margin: 10px 0;">
                Direction: Encapsulation (Sending Data ‚¨áÔ∏è)
            </div>

            <div class="encapsulation-container" id="encapContainer">
                <!-- Encapsulation stages populated by JavaScript -->
            </div>
        </div>

        <!-- Tab 3: Protocol Mapper -->
        <div id="mapper" class="tab-content">
            <h2>Protocol Mapping Challenge</h2>
            <p>Drag and drop protocols to their correct OSI layers:</p>

            <div class="mapper-container">
                <div class="protocol-pool">
                    <h3>Available Protocols</h3>
                    <div id="protocolPool">
                        <!-- Draggable protocols populated by JavaScript -->
                    </div>
                </div>

                <div class="layer-zones">
                    <h3>OSI Layers</h3>
                    <div class="drop-zone" data-layer="7">
                        <strong>Layer 7 - Application:</strong>
                        <div class="zone-content"></div>
                    </div>
                    <div class="drop-zone" data-layer="6">
                        <strong>Layer 6 - Presentation:</strong>
                        <div class="zone-content"></div>
                    </div>
                    <div class="drop-zone" data-layer="5">
                        <strong>Layer 5 - Session:</strong>
                        <div class="zone-content"></div>
                    </div>
                    <div class="drop-zone" data-layer="4">
                        <strong>Layer 4 - Transport:</strong>
                        <div class="zone-content"></div>
                    </div>
                    <div class="drop-zone" data-layer="3">
                        <strong>Layer 3 - Network:</strong>
                        <div class="zone-content"></div>
                    </div>
                    <div class="drop-zone" data-layer="2">
                        <strong>Layer 2 - Data Link:</strong>
                        <div class="zone-content"></div>
                    </div>
                    <div class="drop-zone" data-layer="1">
                        <strong>Layer 1 - Physical:</strong>
                        <div class="zone-content"></div>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-primary" onclick="checkAnswers()">Check Answers</button>
                <button class="btn btn-secondary" onclick="resetMapper()">Reset</button>
            </div>

            <div id="mapperFeedback"></div>
        </div>

        <!-- Tab 4: Quiz -->
        <div id="quiz" class="tab-content">
            <h2>OSI Model Knowledge Check</h2>
            <div class="quiz-container">
                <div id="quiz-area">
                    <!-- Quiz populated by JS -->
                </div>
                <div class="quiz-controls">
                    <div class="score-display" id="score-display">Score: 0/0</div>
                    <div>
                        <button class="btn btn-secondary" onclick="resetQuiz()">Restart Quiz</button>
                        <button class="btn btn-primary" id="next-btn" onclick="nextQuestion()">Check Answer</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab functionality
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(btn.dataset.tab).classList.add('active');
            });
        });

        // Layer Explorer Data
        const layerData = {
            7: {
                name: "Application Layer",
                pdu: "Data",
                description: "Provides network services directly to end users and applications. This is where user interaction happens.",
                protocols: ["HTTP", "HTTPS", "FTP", "SMTP", "POP3", "IMAP", "DNS", "DHCP", "SSH", "Telnet", "SNMP"],
                devices: ["Application Firewalls", "Proxy Servers", "Load Balancers"],
                functions: [
                    "Provides network services to applications",
                    "User authentication and privacy",
                    "Identifies communication partners",
                    "Determines resource availability"
                ],
                ports: "80 (HTTP), 443 (HTTPS), 21 (FTP), 25 (SMTP), 53 (DNS), 22 (SSH)"
            },
            6: {
                name: "Presentation Layer",
                pdu: "Data",
                description: "Translates data formats, handles encryption/decryption, and data compression.",
                protocols: ["SSL/TLS", "JPEG", "GIF", "MPEG", "ASCII", "EBCDIC", "MIME"],
                devices: ["Gateway (presentation level)"],
                functions: [
                    "Data translation and code formatting",
                    "Encryption and decryption",
                    "Data compression and decompression",
                    "Character set conversion (ASCII, Unicode)"
                ],
                ports: "N/A (functions, not protocols)"
            },
            5: {
                name: "Session Layer",
                pdu: "Data",
                description: "Manages sessions between applications - establishes, maintains, and terminates connections.",
                protocols: ["NetBIOS", "RPC", "PPTP", "L2TP", "SAP"],
                devices: ["Gateway (session level)"],
                functions: [
                    "Session establishment and termination",
                    "Dialog control (half-duplex/full-duplex)",
                    "Synchronization with checkpoints",
                    "Session recovery"
                ],
                ports: "N/A (session management)"
            },
            4: {
                name: "Transport Layer",
                pdu: "Segments (TCP) / Datagrams (UDP)",
                description: "Provides reliable or unreliable delivery and error correction before transmission.",
                protocols: ["TCP", "UDP"],
                devices: ["Advanced Firewalls (stateful inspection)"],
                functions: [
                    "Segmentation and reassembly",
                    "Connection establishment (TCP)",
                    "Flow control and windowing",
                    "Error detection and recovery",
                    "Port-based multiplexing"
                ],
                ports: "0-65535 (well-known: 0-1023, registered: 1024-49151, dynamic: 49152-65535)"
            },
            3: {
                name: "Network Layer",
                pdu: "Packets",
                description: "Routes packets across networks using logical addressing (IP addresses).",
                protocols: ["IP (IPv4/IPv6)", "ICMP", "IGMP", "IPsec", "OSPF", "EIGRP", "BGP", "RIP"],
                devices: ["Routers", "Layer 3 Switches", "Firewalls"],
                functions: [
                    "Logical addressing (IP addresses)",
                    "Routing and path selection",
                    "Packet forwarding",
                    "Fragmentation and reassembly",
                    "Quality of Service (QoS)"
                ],
                ports: "N/A (uses IP addresses)"
            },
            2: {
                name: "Data Link Layer",
                pdu: "Frames",
                description: "Provides physical addressing (MAC) and error detection for data transfer between adjacent nodes.",
                protocols: ["Ethernet (802.3)", "Wi-Fi (802.11)", "PPP", "HDLC", "Frame Relay"],
                devices: ["Switches", "Bridges", "Wireless Access Points", "Network Interface Cards"],
                functions: [
                    "Physical addressing (MAC addresses)",
                    "Frame delimiting and error detection",
                    "Media Access Control (CSMA/CD)",
                    "Flow control between nodes",
                    "Divided into LLC and MAC sublayers"
                ],
                ports: "N/A (uses MAC addresses: 48-bit like 00:1A:2B:3C:4D:5E)"
            },
            1: {
                name: "Physical Layer",
                pdu: "Bits",
                description: "Transmits raw bitstream over physical medium - handles electrical, optical, and mechanical aspects.",
                protocols: ["Ethernet Physical (100BASE-T, 1000BASE-T)", "USB", "DSL", "SONET"],
                devices: ["Hubs", "Repeaters", "Cables", "Modems", "Transceivers"],
                functions: [
                    "Bit transmission over physical medium",
                    "Voltage levels and timing",
                    "Physical connectors and topology",
                    "Transmission mode (simplex/duplex)",
                    "Bit synchronization"
                ],
                ports: "Physical connectors: RJ-45, Fiber (SC, LC), Coaxial"
            }
        };

        // Layer Explorer functionality
        function showLayerDetails(layerNum) {
            const layer = layerData[layerNum];
            const detailsDiv = document.getElementById('layerDetails');

            detailsDiv.innerHTML = `
                <h3>${layer.name}</h3>
                <div class="detail-section">
                    <h4>üìù Description</h4>
                    <p>${layer.description}</p>
                </div>
                <div class="detail-section">
                    <h4>üì¶ PDU (Protocol Data Unit)</h4>
                    <p><strong>${layer.pdu}</strong></p>
                </div>
                <div class="detail-section">
                    <h4>üîß Key Protocols</h4>
                    <div class="protocol-tags">
                        ${layer.protocols.map(p => `<span class="protocol-tag">${p}</span>`).join('')}
                    </div>
                </div>
                <div class="detail-section">
                    <h4>üñ•Ô∏è Devices</h4>
                    <p>${layer.devices.join(', ')}</p>
                </div>
                <div class="detail-section">
                    <h4>‚öôÔ∏è Key Functions</h4>
                    <ul style="margin-left: 20px;">
                        ${layer.functions.map(f => `<li>${f}</li>`).join('')}
                    </ul>
                </div>
                <div class="detail-section">
                    <h4>üîå Addressing/Ports</h4>
                    <p>${layer.ports}</p>
                </div>
            `;
        }

        // Initialize layer explorer
        document.querySelectorAll('.layer-item').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.layer-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                showLayerDetails(item.dataset.layer);
            });
        });

        // Initialize with Layer 7
        showLayerDetails(7);

        // Encapsulation Animation
        let encapDirection = 'down'; // 'down' for encapsulation, 'up' for de-encapsulation
        let currentStage = 0;
        let animationInterval;

        const encapStages = {
            down: [
                {
                    layer: "Application/Presentation/Session (L7-L5)",
                    description: "User creates data",
                    data: ["User Data"],
                    colors: ["#fee2e2"]
                },
                {
                    layer: "Transport (L4)",
                    description: "Add TCP header with source/destination ports",
                    data: ["TCP Header", "User Data"],
                    colors: ["#dcfce7", "#fee2e2"]
                },
                {
                    layer: "Network (L3)",
                    description: "Add IP header with source/destination IP addresses",
                    data: ["IP Header", "TCP Header", "User Data"],
                    colors: ["#dbeafe", "#dcfce7", "#fee2e2"]
                },
                {
                    layer: "Data Link (L2)",
                    description: "Add Ethernet header/trailer with MAC addresses",
                    data: ["Eth Header", "IP Header", "TCP Header", "User Data", "Trailer"],
                    colors: ["#e0e7ff", "#dbeafe", "#dcfce7", "#fee2e2", "#e0e7ff"]
                },
                {
                    layer: "Physical (L1)",
                    description: "Convert to bits and transmit over physical medium",
                    data: ["10101010101010..."],
                    colors: ["#f3e8ff"]
                }
            ],
            up: [
                {
                    layer: "Physical (L1)",
                    description: "Receive bits from physical medium",
                    data: ["10101010101010..."],
                    colors: ["#f3e8ff"]
                },
                {
                    layer: "Data Link (L2)",
                    description: "Strip Ethernet header/trailer, verify MAC address",
                    data: ["IP Header", "TCP Header", "User Data"],
                    colors: ["#dbeafe", "#dcfce7", "#fee2e2"]
                },
                {
                    layer: "Network (L3)",
                    description: "Strip IP header, verify destination IP",
                    data: ["TCP Header", "User Data"],
                    colors: ["#dcfce7", "#fee2e2"]
                },
                {
                    layer: "Transport (L4)",
                    description: "Strip TCP header, reassemble segments",
                    data: ["User Data"],
                    colors: ["#fee2e2"]
                },
                {
                    layer: "Application/Presentation/Session (L7-L5)",
                    description: "Deliver data to application",
                    data: ["User Data"],
                    colors: ["#fee2e2"]
                }
            ]
        };

        function renderEncapsulation() {
            const container = document.getElementById('encapContainer');
            const stages = encapStages[encapDirection];

            container.innerHTML = stages.map((stage, index) => `
                <div class="encap-stage" id="stage-${index}" style="background: ${stage.colors[0]};">
                    <strong>${stage.layer}</strong>
                    <p style="margin: 10px 0; color: #666;">${stage.description}</p>
                    <div class="data-visual">
                        ${stage.data.map((item, i) => `
                            <span class="header-box" style="background: ${stage.colors[i]}; border: 2px solid #333;">
                                ${item}
                            </span>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function startEncapsulation() {
            clearInterval(animationInterval);
            currentStage = 0;
            renderEncapsulation();

            animationInterval = setInterval(() => {
                const stages = document.querySelectorAll('.encap-stage');

                if (currentStage > 0) {
                    stages[currentStage - 1].classList.remove('active');
                    stages[currentStage - 1].classList.add('completed');
                }

                if (currentStage < stages.length) {
                    stages[currentStage].classList.add('active');
                    currentStage++;
                } else {
                    clearInterval(animationInterval);
                }
            }, 1500);
        }

        function resetEncapsulation() {
            clearInterval(animationInterval);
            currentStage = 0;
            renderEncapsulation();
        }

        function toggleDirection() {
            encapDirection = encapDirection === 'down' ? 'up' : 'down';
            const indicator = document.getElementById('directionIndicator');
            indicator.textContent = encapDirection === 'down'
                ? 'Direction: Encapsulation (Sending Data ‚¨áÔ∏è)'
                : 'Direction: De-encapsulation (Receiving Data ‚¨ÜÔ∏è)';
            resetEncapsulation();
        }

        // Initialize encapsulation view
        renderEncapsulation();

        // Protocol Mapper
        const protocols = [
            { name: 'HTTP', layer: 7 },
            { name: 'FTP', layer: 7 },
            { name: 'SMTP', layer: 7 },
            { name: 'DNS', layer: 7 },
            { name: 'DHCP', layer: 7 },
            { name: 'SSL/TLS', layer: 6 },
            { name: 'JPEG', layer: 6 },
            { name: 'NetBIOS', layer: 5 },
            { name: 'RPC', layer: 5 },
            { name: 'TCP', layer: 4 },
            { name: 'UDP', layer: 4 },
            { name: 'IP', layer: 3 },
            { name: 'ICMP', layer: 3 },
            { name: 'OSPF', layer: 3 },
            { name: 'Ethernet', layer: 2 },
            { name: 'Wi-Fi', layer: 2 },
            { name: 'MAC', layer: 2 },
            { name: 'Cables', layer: 1 },
            { name: 'Hubs', layer: 1 }
        ];

        function renderProtocolPool() {
            const pool = document.getElementById('protocolPool');
            const shuffled = [...protocols].sort(() => Math.random() - 0.5);

            pool.innerHTML = shuffled.map(p => `
                <div class="draggable-protocol" draggable="true" data-protocol="${p.name}" data-layer="${p.layer}">
                    ${p.name}
                </div>
            `).join('');

            // Add drag event listeners
            document.querySelectorAll('.draggable-protocol').forEach(protocol => {
                protocol.addEventListener('dragstart', handleDragStart);
                protocol.addEventListener('dragend', handleDragEnd);
            });
        }

        let draggedElement = null;

        function handleDragStart(e) {
            draggedElement = e.target;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        // Setup drop zones
        document.querySelectorAll('.drop-zone').forEach(zone => {
            zone.addEventListener('dragover', (e) => {
                e.preventDefault();
                zone.classList.add('drag-over');
            });

            zone.addEventListener('dragleave', () => {
                zone.classList.remove('drag-over');
            });

            zone.addEventListener('drop', (e) => {
                e.preventDefault();
                zone.classList.remove('drag-over');

                if (draggedElement) {
                    const zoneContent = zone.querySelector('.zone-content');
                    zoneContent.appendChild(draggedElement);
                    zone.classList.remove('correct', 'incorrect');
                }
            });
        });

        function checkAnswers() {
            let correct = 0;
            let total = 0;

            document.querySelectorAll('.drop-zone').forEach(zone => {
                const targetLayer = zone.dataset.layer;
                const protocols = zone.querySelectorAll('.draggable-protocol');

                protocols.forEach(protocol => {
                    total++;
                    const protocolLayer = protocol.dataset.layer;

                    if (protocolLayer === targetLayer) {
                        correct++;
                        protocol.style.background = '#d1fae5';
                        protocol.style.borderColor = '#10b981';
                    } else {
                        protocol.style.background = '#fee2e2';
                        protocol.style.borderColor = '#ef4444';
                    }
                });
            });

            const feedback = document.getElementById('mapperFeedback');
            const percentage = Math.round((correct / total) * 100);

            if (percentage === 100) {
                feedback.innerHTML = `
                    <div class="success-box">
                        <h3 style="color: #059669;">üéâ Perfect Score!</h3>
                        <p>You got all ${total} protocols correct! You're an OSI expert!</p>
                    </div>
                `;
            } else {
                feedback.innerHTML = `
                    <div class="info-box">
                        <h3>Score: ${correct}/${total} (${percentage}%)</h3>
                        <p>Protocols in green are correct, red are incorrect. Try moving the red ones to the correct layers!</p>
                    </div>
                `;
            }
        }

        function resetMapper() {
            renderProtocolPool();
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('correct', 'incorrect');
                const zoneContent = zone.querySelector('.zone-content');
                zoneContent.innerHTML = '';
            });
            document.getElementById('mapperFeedback').innerHTML = '';
        }

        // Initialize protocol mapper
        renderProtocolPool();

        // Quiz
        const quizQuestions = [
            {
                question: "Which layer is responsible for logical addressing using IP addresses?",
                options: ["Layer 2 - Data Link", "Layer 3 - Network", "Layer 4 - Transport", "Layer 7 - Application"],
                correct: 1,
                explanation: "Layer 3 (Network) handles logical addressing with IP addresses and routing between networks."
            },
            {
                question: "What is the PDU (Protocol Data Unit) at Layer 2?",
                options: ["Bits", "Frames", "Packets", "Segments"],
                correct: 1,
                explanation: "Layer 2 uses Frames as its PDU. It adds MAC addresses and error detection."
            },
            {
                question: "Which protocol operates at Layer 7?",
                options: ["TCP", "IP", "HTTP", "Ethernet"],
                correct: 2,
                explanation: "HTTP is an Application layer (Layer 7) protocol used for web browsing."
            },
            {
                question: "What does Layer 4 use to identify different applications?",
                options: ["IP addresses", "MAC addresses", "Port numbers", "Domain names"],
                correct: 2,
                explanation: "Layer 4 uses port numbers to identify applications. For example, HTTP uses port 80."
            },
            {
                question: "Which device operates at Layer 2?",
                options: ["Router", "Hub", "Switch", "Repeater"],
                correct: 2,
                explanation: "Switches operate at Layer 2, forwarding frames based on MAC addresses. Routers are Layer 3."
            },
            {
                question: "What is the correct order of encapsulation when SENDING data?",
                options: [
                    "Data ‚Üí Frames ‚Üí Packets ‚Üí Segments ‚Üí Bits",
                    "Data ‚Üí Segments ‚Üí Packets ‚Üí Frames ‚Üí Bits",
                    "Bits ‚Üí Frames ‚Üí Packets ‚Üí Segments ‚Üí Data",
                    "Data ‚Üí Packets ‚Üí Segments ‚Üí Frames ‚Üí Bits"
                ],
                correct: 1,
                explanation: "When sending, data goes through: Application (Data) ‚Üí Transport (Segments) ‚Üí Network (Packets) ‚Üí Data Link (Frames) ‚Üí Physical (Bits)."
            },
            {
                question: "Which layer handles encryption and compression?",
                options: ["Layer 5 - Session", "Layer 6 - Presentation", "Layer 7 - Application", "Layer 4 - Transport"],
                correct: 1,
                explanation: "Layer 6 (Presentation) handles data formatting, encryption/decryption, and compression."
            },
            {
                question: "TCP operates at which layer?",
                options: ["Layer 3", "Layer 4", "Layer 5", "Layer 7"],
                correct: 1,
                explanation: "TCP is a Layer 4 (Transport) protocol that provides reliable, connection-oriented communication."
            },
            {
                question: "What layer do routers primarily operate at?",
                options: ["Layer 1", "Layer 2", "Layer 3", "Layer 7"],
                correct: 2,
                explanation: "Routers operate at Layer 3 (Network), making routing decisions based on IP addresses."
            },
            {
                question: "Which mnemonic helps remember the OSI layers from bottom to top?",
                options: [
                    "All People Seem To Need Data Processing",
                    "Please Do Not Throw Sausage Pizza Away",
                    "A Penguin Said To Never Drop Peanuts",
                    "Please Do Not Tell Secret Passwords Aloud"
                ],
                correct: 1,
                explanation: "Please Do Not Throw Sausage Pizza Away = Physical, Data Link, Network, Transport, Session, Presentation, Application (bottom to top)."
            }
        ];

        let currentQuestion = 0;
        let score = 0;
        let answered = false;

        function renderQuiz() {
            const area = document.getElementById('quiz-area');
            const q = quizQuestions[currentQuestion];

            area.innerHTML = `
                <div class="quiz-question">
                    <h4>Question ${currentQuestion + 1} of ${quizQuestions.length}</h4>
                    <p style="font-size: 1.1em; margin-bottom: 20px;">${q.question}</p>
                    <div class="quiz-options">
                        ${q.options.map((opt, i) => `
                            <div class="quiz-option" onclick="selectAnswer(${i})" data-index="${i}">
                                ${opt}
                            </div>
                        `).join('')}
                    </div>
                    <div class="quiz-feedback" id="quiz-feedback"></div>
                </div>
            `;

            document.getElementById('next-btn').textContent = 'Check Answer';
            answered = false;
            updateScore();
        }

        function selectAnswer(index) {
            if (answered) return;

            document.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelector(`.quiz-option[data-index="${index}"]`).classList.add('selected');
        }

        function nextQuestion() {
            if (!answered) {
                // Check answer
                const selected = document.querySelector('.quiz-option.selected');
                if (!selected) {
                    alert('Please select an answer!');
                    return;
                }

                const selectedIndex = parseInt(selected.dataset.index);
                const q = quizQuestions[currentQuestion];
                const feedback = document.getElementById('quiz-feedback');

                document.querySelectorAll('.quiz-option').forEach((opt, i) => {
                    if (i === q.correct) {
                        opt.classList.add('correct');
                    } else if (i === selectedIndex && selectedIndex !== q.correct) {
                        opt.classList.add('incorrect');
                    }
                });

                if (selectedIndex === q.correct) {
                    score++;
                    feedback.className = 'quiz-feedback show correct';
                    feedback.innerHTML = `‚úÖ Correct! ${q.explanation}`;
                } else {
                    feedback.className = 'quiz-feedback show incorrect';
                    feedback.innerHTML = `‚ùå Incorrect. ${q.explanation}`;
                }

                answered = true;
                updateScore();

                if (currentQuestion < quizQuestions.length - 1) {
                    document.getElementById('next-btn').textContent = 'Next Question ‚Üí';
                } else {
                    document.getElementById('next-btn').textContent = 'See Results';
                }
            } else {
                // Move to next question
                currentQuestion++;
                if (currentQuestion < quizQuestions.length) {
                    renderQuiz();
                } else {
                    showResults();
                }
            }
        }

        function updateScore() {
            document.getElementById('score-display').textContent = `Score: ${score}/${answered ? currentQuestion + 1 : currentQuestion}`;
        }

        function showResults() {
            const area = document.getElementById('quiz-area');
            const percentage = Math.round((score / quizQuestions.length) * 100);
            let message, color;

            if (percentage >= 90) {
                message = "üèÜ Excellent! You've mastered the OSI model!";
                color = "#10b981";
            } else if (percentage >= 70) {
                message = "üëç Good job! You have a solid understanding of the OSI model.";
                color = "#4f46e5";
            } else if (percentage >= 50) {
                message = "üìö Not bad, but review the layers and their functions again.";
                color = "#f59e0b";
            } else {
                message = "üìñ Keep studying! Review each layer's PDU, protocols, and devices.";
                color = "#ef4444";
            }

            area.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div style="font-size: 4em; margin-bottom: 20px;">üéØ</div>
                    <h3 style="font-size: 2em; color: ${color};">You scored ${score}/${quizQuestions.length} (${percentage}%)</h3>
                    <p style="font-size: 1.3em; margin: 20px 0;">${message}</p>
                </div>
            `;

            document.getElementById('next-btn').style.display = 'none';
        }

        function resetQuiz() {
            currentQuestion = 0;
            score = 0;
            answered = false;
            document.getElementById('next-btn').style.display = 'inline-block';
            renderQuiz();
        }

        // Initialize quiz
        renderQuiz();
    </script>
</body>
</html>
