<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Access Control -->
    <script src="../../../../components/AccessGuard.js"></script>
    <script>
        AccessGuard.require('sorted');
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSPF Cost Visualizer - Interactive Learning Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        /* Header */
        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 1.5em;
            color: #fff;
        }

        .header h1 span {
            color: #667eea;
        }

        .back-btn {
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
            border: 1px solid #667eea;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: #667eea;
            color: #fff;
        }

        /* Tabs */
        .tab-container {
            display: flex;
            background: rgba(0, 0, 0, 0.2);
            padding: 0 20px;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            color: #888;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 500;
        }

        .tab:hover {
            color: #bbb;
            background: rgba(255, 255, 255, 0.05);
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        /* Main Content */
        .main-content {
            padding: 20px;
            height: calc(100vh - 120px);
            overflow-y: auto;
        }

        .tab-content {
            display: none;
            height: 100%;
        }

        .tab-content.active {
            display: block;
        }

        /* ==================== TAB 1: What is Cost? ==================== */
        .info-tab {
            max-width: 1000px;
            margin: 0 auto;
        }

        .info-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .info-section h2 {
            color: #fff;
            margin-bottom: 15px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-section h2 .icon {
            font-size: 1.2em;
        }

        .info-section p {
            line-height: 1.8;
            color: #c0c0c0;
            font-size: 1.1em;
        }

        .info-section .highlight {
            color: #667eea;
            font-weight: 600;
        }

        .info-section .analogy {
            background: rgba(102, 126, 234, 0.15);
            padding: 15px 20px;
            border-radius: 8px;
            margin: 15px 0;
            font-style: italic;
            border-left: 3px solid #667eea;
        }

        /* Quick Reference Table */
        .cost-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .cost-table th,
        .cost-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .cost-table th {
            background: rgba(102, 126, 234, 0.2);
            color: #fff;
            font-weight: 600;
        }

        .cost-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .cost-table .link-sample {
            display: inline-block;
            width: 40px;
            height: 4px;
            vertical-align: middle;
            margin-right: 10px;
            border-radius: 2px;
        }

        .link-fiber-10g { background: #00c853; height: 6px; }
        .link-fiber-1g { background: #2196f3; height: 5px; }
        .link-ethernet { background: #ff9800; height: 4px; }
        .link-serial { background: #f44336; height: 3px; border-style: dashed; }

        /* The One Rule Box */
        .one-rule {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            margin: 25px 0;
            border: 2px solid rgba(102, 126, 234, 0.5);
        }

        .one-rule h3 {
            color: #fff;
            font-size: 1.3em;
            margin-bottom: 10px;
        }

        .one-rule p {
            font-size: 1.2em;
            color: #e0e0e0;
        }

        /* Expandable Sections */
        .expandable {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            margin: 10px 0;
            overflow: hidden;
        }

        .expandable-header {
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .expandable-header:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .expandable-header h4 {
            color: #667eea;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .expandable-header .arrow {
            color: #667eea;
            transition: transform 0.3s;
        }

        .expandable.open .expandable-header .arrow {
            transform: rotate(180deg);
        }

        .expandable-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background: rgba(0, 0, 0, 0.2);
        }

        .expandable.open .expandable-content {
            max-height: 500px;
        }

        .expandable-content-inner {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .expandable-content code {
            background: rgba(0, 0, 0, 0.4);
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #4fc3f7;
        }

        .expandable-content pre {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            color: #4fc3f7;
        }

        /* ==================== TAB 2-4: Visualizer ==================== */
        .visualizer-container {
            display: flex;
            height: 100%;
            gap: 20px;
        }

        .topology-panel {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .topology-canvas {
            width: 100%;
            height: 100%;
        }

        .info-panel {
            width: 320px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            overflow-y: auto;
        }

        .info-panel h3 {
            color: #fff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Legend */
        .legend {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .legend h4 {
            color: #fff;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
            font-size: 0.85em;
            color: #bbb;
        }

        .legend-line {
            width: 30px;
            height: 4px;
            border-radius: 2px;
        }

        /* Routing Table */
        .routing-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85em;
        }

        .routing-table th,
        .routing-table td {
            padding: 8px 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .routing-table th {
            background: rgba(102, 126, 234, 0.2);
            color: #fff;
        }

        .routing-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .routing-table .best-path {
            color: #00c853;
            font-weight: 600;
        }

        /* Selection Info */
        .selection-info {
            background: rgba(102, 126, 234, 0.15);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .selection-info p {
            margin: 5px 0;
            font-size: 0.9em;
        }

        .selection-info .label {
            color: #888;
        }

        .selection-info .value {
            color: #fff;
            font-weight: 600;
        }

        /* Instructions */
        .instructions {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.85em;
            color: #ffc107;
        }

        /* What-If Controls */
        .whatif-controls {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .whatif-controls h4 {
            color: #fff;
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .control-btn {
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
            border: 1px solid #667eea;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            margin: 5px 5px 5px 0;
            transition: all 0.3s;
        }

        .control-btn:hover {
            background: #667eea;
            color: #fff;
        }

        .control-btn.active {
            background: #667eea;
            color: #fff;
        }

        .control-btn.danger {
            border-color: #f44336;
            color: #f44336;
        }

        .control-btn.danger:hover,
        .control-btn.danger.active {
            background: #f44336;
            color: #fff;
        }

        /* Path comparison */
        .path-list {
            margin-top: 15px;
        }

        .path-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 3px solid #888;
        }

        .path-item.best {
            border-left-color: #00c853;
            background: rgba(0, 200, 83, 0.1);
        }

        .path-item .path-cost {
            font-size: 1.2em;
            font-weight: bold;
            color: #fff;
        }

        .path-item .path-hops {
            font-size: 0.85em;
            color: #bbb;
            margin-top: 5px;
        }

        .path-item.best .path-cost {
            color: #00c853;
        }

        /* Failed link indicator */
        .failed-links {
            margin-top: 10px;
        }

        .failed-link-item {
            background: rgba(244, 67, 54, 0.2);
            padding: 8px 12px;
            border-radius: 4px;
            margin: 5px 0;
            font-size: 0.85em;
            color: #f44336;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .restore-btn {
            background: transparent;
            border: 1px solid #f44336;
            color: #f44336;
            padding: 2px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
        }

        .restore-btn:hover {
            background: #f44336;
            color: #fff;
        }

        /* Router node on canvas */
        .router-node {
            cursor: pointer;
            transition: all 0.2s;
        }

        .router-node:hover circle {
            filter: brightness(1.2);
        }

        .router-node.selected circle {
            stroke: #ffc107;
            stroke-width: 3;
        }

        .router-node.source circle {
            stroke: #00c853;
            stroke-width: 3;
        }

        .router-node.destination circle {
            stroke: #f44336;
            stroke-width: 3;
        }

        /* No selection message */
        .no-selection {
            text-align: center;
            padding: 30px;
            color: #888;
        }

        .no-selection .icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><span>OSPF</span> Cost Visualizer</h1>
        <a href="../../../../index.html" class="back-btn">‚Üê Back to House</a>
    </div>

    <div class="tab-container">
        <div class="tab active" data-tab="info">What is Cost?</div>
        <div class="tab" data-tab="router-view">Router's Eye View</div>
        <div class="tab" data-tab="path-explorer">Path Explorer</div>
        <div class="tab" data-tab="what-if">What-If Simulator</div>
    </div>

    <div class="main-content">
        <!-- ==================== TAB 1: What is Cost? ==================== -->
        <div class="tab-content active" id="tab-info">
            <div class="info-tab">
                <div class="info-section">
                    <h2><span class="icon">üéØ</span> The Big Picture</h2>
                    <p>OSPF needs to pick the <span class="highlight">best path</span> to send your data. But what makes a path "best"?</p>
                    <p>Here's the thing: it's <strong>not</strong> about counting how many routers you pass through. It's about finding the <span class="highlight">fastest route overall</span>.</p>
                </div>

                <div class="info-section">
                    <h2><span class="icon">üöó</span> Think of it Like GPS</h2>
                    <div class="analogy">
                        "Your GPS doesn't just count streets. It knows the highway is faster than the back road, even if the back road has fewer turns. OSPF does the same thing with network links."
                    </div>
                    <p>When you ask for directions, GPS considers <em>how fast</em> each road is, not just <em>how many</em> roads. A path with 5 highway segments beats a path with 2 dirt roads every time.</p>
                </div>

                <div class="info-section">
                    <h2><span class="icon">‚ö°</span> Cost = Speed Rating</h2>
                    <p>Every network link gets a number called <span class="highlight">"cost"</span>. It's simple:</p>
                    <ul style="margin: 15px 0 15px 25px; line-height: 2;">
                        <li><strong>Lower number</strong> = Faster link = OSPF prefers it</li>
                        <li><strong>Higher number</strong> = Slower link = OSPF avoids it if possible</li>
                    </ul>
                    <p>That's really all there is to it. Fiber gets a low cost because it's fast. Old serial lines get a high cost because they're slow.</p>
                </div>

                <div class="info-section">
                    <h2><span class="icon">üìä</span> Quick Reference</h2>
                    <table class="cost-table">
                        <thead>
                            <tr>
                                <th>Link Type</th>
                                <th>Speed</th>
                                <th>Cost</th>
                                <th>Think of it as...</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="link-sample link-fiber-10g"></span>10G Fiber</td>
                                <td>10 Gbps</td>
                                <td><strong>1</strong></td>
                                <td>üõ£Ô∏è Highway - wide open, full speed</td>
                            </tr>
                            <tr>
                                <td><span class="link-sample link-fiber-1g"></span>1G Fiber</td>
                                <td>1 Gbps</td>
                                <td><strong>10</strong></td>
                                <td>üöó Main road - good traffic flow</td>
                            </tr>
                            <tr>
                                <td><span class="link-sample link-ethernet"></span>FastEthernet</td>
                                <td>100 Mbps</td>
                                <td><strong>100</strong></td>
                                <td>üèòÔ∏è Side street - gets the job done</td>
                            </tr>
                            <tr>
                                <td><span class="link-sample link-serial"></span>T1/Serial</td>
                                <td>1.544 Mbps</td>
                                <td><strong>64</strong></td>
                                <td>üöú Dirt road - slow but sometimes necessary</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="one-rule">
                    <h3>üìå The One Rule to Remember</h3>
                    <p><strong>OSPF adds up the costs along a path. Lowest total wins.</strong></p>
                </div>

                <div class="info-section">
                    <h2><span class="icon">ü§î</span> Why Should I Care?</h2>
                    <p>When you understand cost, you <span class="highlight">control where traffic flows</span>. This is called <strong>traffic engineering</strong>.</p>
                    <ul style="margin: 15px 0 15px 25px; line-height: 2;">
                        <li>Want backups to use the cheap slow link? <em>Raise the cost on the fast link.</em></li>
                        <li>Want video calls to always use fiber? <em>Make sure fiber has the lowest cost.</em></li>
                        <li>Need to take a link down for maintenance? <em>Raise its cost sky-high first, traffic moves automatically.</em></li>
                    </ul>
                </div>

                <div class="info-section">
                    <h2><span class="icon">üîç</span> Want More Detail?</h2>

                    <div class="expandable">
                        <div class="expandable-header">
                            <h4>üìê How is cost actually calculated?</h4>
                            <span class="arrow">‚ñº</span>
                        </div>
                        <div class="expandable-content">
                            <div class="expandable-content-inner">
                                <p>There's a simple formula:</p>
                                <pre>Cost = Reference Bandwidth / Interface Bandwidth</pre>
                                <p style="margin-top: 15px;">By default, the reference bandwidth is <strong>100 Mbps</strong>. So:</p>
                                <ul style="margin: 10px 0 10px 20px; line-height: 1.8;">
                                    <li>100 Mbps link: 100 / 100 = <strong>Cost 1</strong></li>
                                    <li>10 Mbps link: 100 / 10 = <strong>Cost 10</strong></li>
                                    <li>1 Gbps link: 100 / 1000 = 0.1 ‚Üí rounds to <strong>Cost 1</strong></li>
                                </ul>
                                <p style="margin-top: 15px; color: #ffc107;">‚ö†Ô∏è Notice the problem? Both 100 Mbps and 1 Gbps get cost 1! That's why modern networks change the reference bandwidth to 10 Gbps or higher.</p>
                            </div>
                        </div>
                    </div>

                    <div class="expandable">
                        <div class="expandable-header">
                            <h4>‚öôÔ∏è Can I change the cost manually?</h4>
                            <span class="arrow">‚ñº</span>
                        </div>
                        <div class="expandable-content">
                            <div class="expandable-content-inner">
                                <p>Absolutely! Two ways:</p>
                                <p style="margin-top: 10px;"><strong>1. Change cost on a specific interface:</strong></p>
                                <pre>Router(config)# interface GigabitEthernet0/1
Router(config-if)# ip ospf cost 50</pre>
                                <p style="margin-top: 15px;"><strong>2. Change the reference bandwidth (affects all interfaces):</strong></p>
                                <pre>Router(config)# router ospf 1
Router(config-router)# auto-cost reference-bandwidth 10000</pre>
                                <p style="margin-top: 10px; font-size: 0.9em; color: #888;">The 10000 means 10,000 Mbps (10 Gbps). Do this on ALL routers in your OSPF domain!</p>
                            </div>
                        </div>
                    </div>

                    <div class="expandable">
                        <div class="expandable-header">
                            <h4>üîÄ What if two paths have equal cost?</h4>
                            <span class="arrow">‚ñº</span>
                        </div>
                        <div class="expandable-content">
                            <div class="expandable-content-inner">
                                <p>Great question! When OSPF finds multiple paths with the <em>exact same</em> total cost, it uses <strong>both of them</strong>. This is called <span class="highlight">Equal-Cost Multi-Path (ECMP)</span>.</p>
                                <p style="margin-top: 10px;">Traffic gets load-balanced across all equal-cost paths automatically. Free performance boost!</p>
                                <p style="margin-top: 10px;">By default, OSPF can use up to 4 equal-cost paths (configurable up to 16 on most platforms).</p>
                            </div>
                        </div>
                    </div>

                    <div class="expandable">
                        <div class="expandable-header">
                            <h4>üåç Real-world example: Traffic engineering</h4>
                            <span class="arrow">‚ñº</span>
                        </div>
                        <div class="expandable-content">
                            <div class="expandable-content-inner">
                                <p><strong>Scenario:</strong> You have two paths between offices:</p>
                                <ul style="margin: 10px 0 10px 20px; line-height: 1.8;">
                                    <li>Path A: Expensive dedicated fiber (fast, reliable)</li>
                                    <li>Path B: Cheap internet VPN (slower, best-effort)</li>
                                </ul>
                                <p style="margin-top: 10px;"><strong>Goal:</strong> Use fiber for everything, but automatically fail over to VPN if fiber dies.</p>
                                <p style="margin-top: 10px;"><strong>Solution:</strong></p>
                                <ul style="margin: 10px 0 10px 20px; line-height: 1.8;">
                                    <li>Set fiber interface cost to <strong>10</strong></li>
                                    <li>Set VPN interface cost to <strong>1000</strong></li>
                                </ul>
                                <p style="margin-top: 10px;">OSPF will always prefer the fiber (lower cost). If fiber fails, it automatically switches to VPN. When fiber comes back, traffic shifts back. No manual intervention needed!</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <p style="color: #888;">Ready to see it in action? Try the interactive tabs above! ‚Üí</p>
                </div>
            </div>
        </div>

        <!-- ==================== TAB 2: Router's Eye View ==================== -->
        <div class="tab-content" id="tab-router-view">
            <div class="visualizer-container">
                <div class="topology-panel">
                    <svg class="topology-canvas" id="canvas-router-view"></svg>
                </div>
                <div class="info-panel">
                    <div class="instructions">
                        üí° Click any router to see its OSPF view of the network
                    </div>

                    <div class="legend">
                        <h4>Link Types</h4>
                        <div class="legend-item">
                            <div class="legend-line link-fiber-10g"></div>
                            <span>10G Fiber (Cost 1)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-line link-fiber-1g"></div>
                            <span>1G Fiber (Cost 10)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-line link-ethernet"></div>
                            <span>FastEthernet (Cost 100)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-line link-serial" style="border-top: 3px dashed #f44336; height: 0;"></div>
                            <span>Serial/T1 (Cost 64)</span>
                        </div>
                    </div>

                    <div id="router-view-info">
                        <div class="no-selection">
                            <div class="icon">üñ±Ô∏è</div>
                            <p>Click a router to view its<br>SPF tree and routing table</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== TAB 3: Path Explorer ==================== -->
        <div class="tab-content" id="tab-path-explorer">
            <div class="visualizer-container">
                <div class="topology-panel">
                    <svg class="topology-canvas" id="canvas-path-explorer"></svg>
                </div>
                <div class="info-panel">
                    <div class="instructions">
                        üí° Click a <strong style="color: #00c853;">source</strong> router, then a <strong style="color: #f44336;">destination</strong> router to explore paths
                    </div>

                    <div class="legend">
                        <h4>Link Types</h4>
                        <div class="legend-item">
                            <div class="legend-line link-fiber-10g"></div>
                            <span>10G Fiber (Cost 1)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-line link-fiber-1g"></div>
                            <span>1G Fiber (Cost 10)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-line link-ethernet"></div>
                            <span>FastEthernet (Cost 100)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-line link-serial" style="border-top: 3px dashed #f44336; height: 0;"></div>
                            <span>Serial/T1 (Cost 64)</span>
                        </div>
                    </div>

                    <div id="path-explorer-info">
                        <div class="no-selection">
                            <div class="icon">üõ§Ô∏è</div>
                            <p>Select source and destination<br>to compare available paths</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== TAB 4: What-If Simulator ==================== -->
        <div class="tab-content" id="tab-what-if">
            <div class="visualizer-container">
                <div class="topology-panel">
                    <svg class="topology-canvas" id="canvas-what-if"></svg>
                </div>
                <div class="info-panel">
                    <div class="instructions">
                        üí° Click any <strong>link</strong> to fail it, or click a <strong>router</strong> to see routing changes
                    </div>

                    <div class="whatif-controls">
                        <h4>Simulation Controls</h4>
                        <button class="control-btn" id="btn-reset-topology">üîÑ Reset All Links</button>
                        <button class="control-btn" id="btn-fail-random">üí• Fail Random Link</button>
                    </div>

                    <div class="legend">
                        <h4>Link Types</h4>
                        <div class="legend-item">
                            <div class="legend-line link-fiber-10g"></div>
                            <span>10G Fiber (Cost 1)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-line link-fiber-1g"></div>
                            <span>1G Fiber (Cost 10)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-line link-ethernet"></div>
                            <span>FastEthernet (Cost 100)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-line link-serial" style="border-top: 3px dashed #f44336; height: 0;"></div>
                            <span>Serial/T1 (Cost 64)</span>
                        </div>
                    </div>

                    <div id="whatif-info">
                        <div class="no-selection">
                            <div class="icon">üîß</div>
                            <p>Fail links to see how OSPF<br>reconverges automatically</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== NETWORK TOPOLOGY DATA ====================
        const LINK_TYPES = {
            FIBER_10G: { name: '10G Fiber', cost: 1, color: '#00c853', width: 6 },
            FIBER_1G: { name: '1G Fiber', cost: 10, color: '#2196f3', width: 5 },
            ETHERNET: { name: 'FastEthernet', cost: 100, color: '#ff9800', width: 4 },
            SERIAL: { name: 'Serial/T1', cost: 64, color: '#f44336', width: 3, dashed: true }
        };

        // 18 Router positions (optimized for 1920x1080)
        const routers = [
            { id: 'R1', x: 150, y: 80 },
            { id: 'R2', x: 300, y: 80 },
            { id: 'R3', x: 450, y: 80 },
            { id: 'R4', x: 600, y: 80 },
            { id: 'R5', x: 750, y: 80 },
            { id: 'R6', x: 100, y: 200 },
            { id: 'R7', x: 250, y: 200 },
            { id: 'R8', x: 400, y: 200 },
            { id: 'R9', x: 550, y: 200 },
            { id: 'R10', x: 700, y: 200 },
            { id: 'R11', x: 850, y: 200 },
            { id: 'R12', x: 150, y: 320 },
            { id: 'R13', x: 300, y: 320 },
            { id: 'R14', x: 450, y: 320 },
            { id: 'R15', x: 600, y: 320 },
            { id: 'R16', x: 750, y: 320 },
            { id: 'R17', x: 350, y: 440 },
            { id: 'R18', x: 550, y: 440 }
        ];

        // Links with varied costs
        const links = [
            // Top row connections (mostly fast fiber)
            { from: 'R1', to: 'R2', type: 'FIBER_10G' },
            { from: 'R2', to: 'R3', type: 'FIBER_10G' },
            { from: 'R3', to: 'R4', type: 'FIBER_1G' },
            { from: 'R4', to: 'R5', type: 'FIBER_10G' },

            // Vertical connections from top row
            { from: 'R1', to: 'R6', type: 'FIBER_1G' },
            { from: 'R1', to: 'R7', type: 'ETHERNET' },
            { from: 'R2', to: 'R7', type: 'FIBER_1G' },
            { from: 'R3', to: 'R8', type: 'FIBER_10G' },
            { from: 'R3', to: 'R9', type: 'ETHERNET' },
            { from: 'R4', to: 'R9', type: 'FIBER_1G' },
            { from: 'R4', to: 'R10', type: 'FIBER_10G' },
            { from: 'R5', to: 'R10', type: 'FIBER_1G' },
            { from: 'R5', to: 'R11', type: 'FIBER_10G' },

            // Middle row connections
            { from: 'R6', to: 'R7', type: 'FIBER_1G' },
            { from: 'R7', to: 'R8', type: 'FIBER_10G' },
            { from: 'R8', to: 'R9', type: 'FIBER_1G' },
            { from: 'R9', to: 'R10', type: 'FIBER_10G' },
            { from: 'R10', to: 'R11', type: 'FIBER_1G' },

            // Vertical connections to bottom row
            { from: 'R6', to: 'R12', type: 'ETHERNET' },
            { from: 'R7', to: 'R12', type: 'SERIAL' },
            { from: 'R7', to: 'R13', type: 'FIBER_1G' },
            { from: 'R8', to: 'R13', type: 'ETHERNET' },
            { from: 'R8', to: 'R14', type: 'FIBER_10G' },
            { from: 'R9', to: 'R14', type: 'SERIAL' },
            { from: 'R9', to: 'R15', type: 'FIBER_1G' },
            { from: 'R10', to: 'R15', type: 'ETHERNET' },
            { from: 'R10', to: 'R16', type: 'FIBER_1G' },
            { from: 'R11', to: 'R16', type: 'ETHERNET' },

            // Bottom row connections
            { from: 'R12', to: 'R13', type: 'FIBER_1G' },
            { from: 'R13', to: 'R14', type: 'FIBER_10G' },
            { from: 'R14', to: 'R15', type: 'FIBER_1G' },
            { from: 'R15', to: 'R16', type: 'FIBER_10G' },

            // Bottom connections
            { from: 'R12', to: 'R17', type: 'SERIAL' },
            { from: 'R13', to: 'R17', type: 'FIBER_1G' },
            { from: 'R14', to: 'R17', type: 'ETHERNET' },
            { from: 'R14', to: 'R18', type: 'FIBER_1G' },
            { from: 'R15', to: 'R18', type: 'FIBER_10G' },
            { from: 'R16', to: 'R18', type: 'SERIAL' },
            { from: 'R17', to: 'R18', type: 'ETHERNET' }
        ];

        // State management
        let state = {
            activeTab: 'info',
            routerView: { selectedRouter: null },
            pathExplorer: { source: null, destination: null },
            whatIf: { failedLinks: new Set(), selectedRouter: null }
        };

        // ==================== TAB SWITCHING ====================
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.dataset.tab;

                // Update tab styling
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                // Update content visibility
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.getElementById(`tab-${tabId}`).classList.add('active');

                state.activeTab = tabId;

                // Initialize canvas for visualization tabs
                if (tabId !== 'info') {
                    initializeCanvas(tabId);
                }
            });
        });

        // ==================== EXPANDABLE SECTIONS ====================
        document.querySelectorAll('.expandable-header').forEach(header => {
            header.addEventListener('click', () => {
                header.parentElement.classList.toggle('open');
            });
        });

        // ==================== CANVAS RENDERING ====================
        function initializeCanvas(tabId) {
            const canvasId = `canvas-${tabId.replace('tab-', '')}`;
            let canvas = document.getElementById(canvasId);
            if (!canvas) {
                // Map tab IDs to canvas IDs
                const canvasMap = {
                    'router-view': 'canvas-router-view',
                    'path-explorer': 'canvas-path-explorer',
                    'what-if': 'canvas-what-if'
                };
                canvas = document.getElementById(canvasMap[tabId]);
            }
            if (!canvas) return;

            renderTopology(canvas, tabId);
        }

        function renderTopology(canvas, mode) {
            const width = canvas.clientWidth || 900;
            const height = canvas.clientHeight || 500;

            canvas.innerHTML = '';
            canvas.setAttribute('viewBox', `0 0 ${width} ${height}`);

            // Create defs for markers
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            canvas.appendChild(defs);

            // Scale positions to fit canvas
            const scaleX = (width - 100) / 900;
            const scaleY = (height - 100) / 500;
            const scale = Math.min(scaleX, scaleY, 1);
            const offsetX = (width - 900 * scale) / 2;
            const offsetY = (height - 500 * scale) / 2 + 30;

            // Draw links
            const linksGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            linksGroup.setAttribute('class', 'links');

            links.forEach((link, index) => {
                const fromRouter = routers.find(r => r.id === link.from);
                const toRouter = routers.find(r => r.id === link.to);
                const linkType = LINK_TYPES[link.type];

                const x1 = fromRouter.x * scale + offsetX;
                const y1 = fromRouter.y * scale + offsetY;
                const x2 = toRouter.x * scale + offsetX;
                const y2 = toRouter.y * scale + offsetY;

                const linkId = `${link.from}-${link.to}`;
                const isFailed = state.whatIf.failedLinks.has(linkId);

                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', x1);
                line.setAttribute('y1', y1);
                line.setAttribute('x2', x2);
                line.setAttribute('y2', y2);
                line.setAttribute('stroke', isFailed ? '#555' : linkType.color);
                line.setAttribute('stroke-width', linkType.width * scale);
                line.setAttribute('class', 'link');
                line.setAttribute('data-link-id', linkId);
                line.setAttribute('data-cost', linkType.cost);

                if (linkType.dashed) {
                    line.setAttribute('stroke-dasharray', '10,5');
                }

                if (isFailed) {
                    line.setAttribute('stroke-dasharray', '5,5');
                    line.setAttribute('opacity', '0.3');
                }

                // Add click handler for What-If mode
                if (mode === 'what-if') {
                    line.style.cursor = 'pointer';
                    line.addEventListener('click', () => toggleLinkFailure(linkId));
                    line.addEventListener('mouseenter', () => {
                        if (!isFailed) line.setAttribute('stroke-width', linkType.width * scale + 2);
                    });
                    line.addEventListener('mouseleave', () => {
                        line.setAttribute('stroke-width', linkType.width * scale);
                    });
                }

                linksGroup.appendChild(line);

                // Add cost label
                const midX = (x1 + x2) / 2;
                const midY = (y1 + y2) / 2;

                const costBg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                costBg.setAttribute('x', midX - 12);
                costBg.setAttribute('y', midY - 8);
                costBg.setAttribute('width', 24);
                costBg.setAttribute('height', 16);
                costBg.setAttribute('fill', 'rgba(0,0,0,0.7)');
                costBg.setAttribute('rx', 3);
                if (isFailed) costBg.setAttribute('opacity', '0.3');
                linksGroup.appendChild(costBg);

                const costLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                costLabel.setAttribute('x', midX);
                costLabel.setAttribute('y', midY + 4);
                costLabel.setAttribute('text-anchor', 'middle');
                costLabel.setAttribute('fill', isFailed ? '#555' : '#fff');
                costLabel.setAttribute('font-size', '11');
                costLabel.setAttribute('font-weight', 'bold');
                costLabel.textContent = linkType.cost;
                if (isFailed) costLabel.setAttribute('opacity', '0.3');
                linksGroup.appendChild(costLabel);
            });

            canvas.appendChild(linksGroup);

            // Draw routers
            const routersGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            routersGroup.setAttribute('class', 'routers');

            routers.forEach(router => {
                const x = router.x * scale + offsetX;
                const y = router.y * scale + offsetY;

                const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                group.setAttribute('class', 'router-node');
                group.setAttribute('data-router-id', router.id);
                group.style.cursor = 'pointer';

                // Determine selection state
                let isSelected = false;
                let isSource = false;
                let isDestination = false;

                if (mode === 'router-view') {
                    isSelected = state.routerView.selectedRouter === router.id;
                } else if (mode === 'path-explorer') {
                    isSource = state.pathExplorer.source === router.id;
                    isDestination = state.pathExplorer.destination === router.id;
                } else if (mode === 'what-if') {
                    isSelected = state.whatIf.selectedRouter === router.id;
                }

                // Router circle
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', x);
                circle.setAttribute('cy', y);
                circle.setAttribute('r', 22 * scale);
                circle.setAttribute('fill', 'linear-gradient(135deg, #667eea, #764ba2)');
                circle.setAttribute('fill', '#667eea');

                if (isSource) {
                    circle.setAttribute('stroke', '#00c853');
                    circle.setAttribute('stroke-width', 4);
                } else if (isDestination) {
                    circle.setAttribute('stroke', '#f44336');
                    circle.setAttribute('stroke-width', 4);
                } else if (isSelected) {
                    circle.setAttribute('stroke', '#ffc107');
                    circle.setAttribute('stroke-width', 4);
                } else {
                    circle.setAttribute('stroke', '#fff');
                    circle.setAttribute('stroke-width', 2);
                }

                group.appendChild(circle);

                // Router label
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', x);
                label.setAttribute('y', y + 5);
                label.setAttribute('text-anchor', 'middle');
                label.setAttribute('fill', '#fff');
                label.setAttribute('font-size', 12 * scale);
                label.setAttribute('font-weight', 'bold');
                label.textContent = router.id;
                group.appendChild(label);

                // Click handler
                group.addEventListener('click', () => handleRouterClick(router.id, mode));

                routersGroup.appendChild(group);
            });

            canvas.appendChild(routersGroup);
        }

        // ==================== INTERACTION HANDLERS ====================
        function handleRouterClick(routerId, mode) {
            if (mode === 'router-view') {
                state.routerView.selectedRouter = routerId;
                renderTopology(document.getElementById('canvas-router-view'), 'router-view');
                showRouterViewInfo(routerId);
            } else if (mode === 'path-explorer') {
                if (!state.pathExplorer.source) {
                    state.pathExplorer.source = routerId;
                } else if (!state.pathExplorer.destination && routerId !== state.pathExplorer.source) {
                    state.pathExplorer.destination = routerId;
                } else {
                    // Reset and start new selection
                    state.pathExplorer.source = routerId;
                    state.pathExplorer.destination = null;
                }
                renderTopology(document.getElementById('canvas-path-explorer'), 'path-explorer');
                showPathExplorerInfo();
            } else if (mode === 'what-if') {
                state.whatIf.selectedRouter = routerId;
                renderTopology(document.getElementById('canvas-what-if'), 'what-if');
                showWhatIfInfo(routerId);
            }
        }

        function toggleLinkFailure(linkId) {
            if (state.whatIf.failedLinks.has(linkId)) {
                state.whatIf.failedLinks.delete(linkId);
            } else {
                state.whatIf.failedLinks.add(linkId);
            }
            renderTopology(document.getElementById('canvas-what-if'), 'what-if');
            if (state.whatIf.selectedRouter) {
                showWhatIfInfo(state.whatIf.selectedRouter);
            }
            updateFailedLinksDisplay();
        }

        // ==================== DIJKSTRA'S ALGORITHM ====================
        function calculateShortestPaths(sourceId, failedLinks = new Set()) {
            const distances = {};
            const previous = {};
            const unvisited = new Set();

            routers.forEach(r => {
                distances[r.id] = Infinity;
                previous[r.id] = null;
                unvisited.add(r.id);
            });

            distances[sourceId] = 0;

            while (unvisited.size > 0) {
                // Find unvisited node with smallest distance
                let current = null;
                let minDist = Infinity;
                unvisited.forEach(id => {
                    if (distances[id] < minDist) {
                        minDist = distances[id];
                        current = id;
                    }
                });

                if (current === null || minDist === Infinity) break;

                unvisited.delete(current);

                // Check neighbors
                links.forEach(link => {
                    const linkId = `${link.from}-${link.to}`;
                    const linkIdReverse = `${link.to}-${link.from}`;

                    if (failedLinks.has(linkId) || failedLinks.has(linkIdReverse)) return;

                    let neighbor = null;
                    if (link.from === current) neighbor = link.to;
                    else if (link.to === current) neighbor = link.from;

                    if (neighbor && unvisited.has(neighbor)) {
                        const cost = LINK_TYPES[link.type].cost;
                        const newDist = distances[current] + cost;

                        if (newDist < distances[neighbor]) {
                            distances[neighbor] = newDist;
                            previous[neighbor] = current;
                        }
                    }
                });
            }

            return { distances, previous };
        }

        function getPath(previous, destination) {
            const path = [];
            let current = destination;

            while (current) {
                path.unshift(current);
                current = previous[current];
            }

            return path;
        }

        function findAllPaths(source, destination, failedLinks = new Set(), maxPaths = 5) {
            const paths = [];
            const visited = new Set();

            function dfs(current, path, cost) {
                if (paths.length >= maxPaths) return;
                if (current === destination) {
                    paths.push({ path: [...path], cost });
                    return;
                }

                visited.add(current);

                links.forEach(link => {
                    const linkId = `${link.from}-${link.to}`;
                    const linkIdReverse = `${link.to}-${link.from}`;

                    if (failedLinks.has(linkId) || failedLinks.has(linkIdReverse)) return;

                    let neighbor = null;
                    if (link.from === current && !visited.has(link.to)) neighbor = link.to;
                    else if (link.to === current && !visited.has(link.from)) neighbor = link.from;

                    if (neighbor) {
                        const linkCost = LINK_TYPES[link.type].cost;
                        path.push(neighbor);
                        dfs(neighbor, path, cost + linkCost);
                        path.pop();
                    }
                });

                visited.delete(current);
            }

            dfs(source, [source], 0);
            return paths.sort((a, b) => a.cost - b.cost);
        }

        // ==================== INFO PANEL UPDATES ====================
        function showRouterViewInfo(routerId) {
            const container = document.getElementById('router-view-info');
            const { distances, previous } = calculateShortestPaths(routerId);

            let html = `
                <div class="selection-info">
                    <p><span class="label">Selected Router:</span> <span class="value">${routerId}</span></p>
                    <p><span class="label">View:</span> <span class="value">SPF Tree from ${routerId}'s perspective</span></p>
                </div>
                <h3>Routing Table</h3>
                <table class="routing-table">
                    <thead>
                        <tr>
                            <th>Destination</th>
                            <th>Next Hop</th>
                            <th>Cost</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            routers.forEach(router => {
                if (router.id === routerId) return;

                const path = getPath(previous, router.id);
                const nextHop = path.length > 1 ? path[1] : '-';
                const cost = distances[router.id];

                html += `
                    <tr>
                        <td>${router.id}</td>
                        <td>${nextHop}</td>
                        <td>${cost === Infinity ? '‚àû' : cost}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function showPathExplorerInfo() {
            const container = document.getElementById('path-explorer-info');
            const { source, destination } = state.pathExplorer;

            if (!source) {
                container.innerHTML = `
                    <div class="no-selection">
                        <div class="icon">üõ§Ô∏è</div>
                        <p>Select source and destination<br>to compare available paths</p>
                    </div>
                `;
                return;
            }

            if (!destination) {
                container.innerHTML = `
                    <div class="selection-info">
                        <p><span class="label">Source:</span> <span class="value" style="color: #00c853;">${source}</span></p>
                        <p><span class="label">Destination:</span> <span class="value" style="color: #888;">Click another router...</span></p>
                    </div>
                `;
                return;
            }

            const paths = findAllPaths(source, destination);

            let html = `
                <div class="selection-info">
                    <p><span class="label">Source:</span> <span class="value" style="color: #00c853;">${source}</span></p>
                    <p><span class="label">Destination:</span> <span class="value" style="color: #f44336;">${destination}</span></p>
                </div>
                <h3>Available Paths</h3>
                <div class="path-list">
            `;

            if (paths.length === 0) {
                html += '<p style="color: #888;">No paths available</p>';
            } else {
                paths.forEach((pathInfo, index) => {
                    const isBest = index === 0;
                    html += `
                        <div class="path-item ${isBest ? 'best' : ''}">
                            <div class="path-cost">${isBest ? '‚òÖ ' : ''}Cost: ${pathInfo.cost}</div>
                            <div class="path-hops">${pathInfo.path.join(' ‚Üí ')}</div>
                            <div class="path-hops">${pathInfo.path.length - 1} hops</div>
                        </div>
                    `;
                });
            }

            html += '</div>';
            container.innerHTML = html;
        }

        function showWhatIfInfo(routerId) {
            const container = document.getElementById('whatif-info');
            const { distances, previous } = calculateShortestPaths(routerId, state.whatIf.failedLinks);

            let html = `
                <div class="selection-info">
                    <p><span class="label">Selected Router:</span> <span class="value">${routerId}</span></p>
                    <p><span class="label">Failed Links:</span> <span class="value">${state.whatIf.failedLinks.size}</span></p>
                </div>
            `;

            if (state.whatIf.failedLinks.size > 0) {
                html += `<div class="failed-links"><h4 style="color: #f44336; margin-bottom: 10px;">Failed Links:</h4>`;
                state.whatIf.failedLinks.forEach(linkId => {
                    html += `
                        <div class="failed-link-item">
                            <span>${linkId.replace('-', ' ‚Üî ')}</span>
                            <button class="restore-btn" onclick="restoreLink('${linkId}')">Restore</button>
                        </div>
                    `;
                });
                html += '</div>';
            }

            html += `
                <h3>Updated Routing Table</h3>
                <table class="routing-table">
                    <thead>
                        <tr>
                            <th>Destination</th>
                            <th>Next Hop</th>
                            <th>Cost</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            routers.forEach(router => {
                if (router.id === routerId) return;

                const path = getPath(previous, router.id);
                const nextHop = path.length > 1 ? path[1] : '-';
                const cost = distances[router.id];
                const unreachable = cost === Infinity;

                html += `
                    <tr style="${unreachable ? 'color: #f44336;' : ''}">
                        <td>${router.id}</td>
                        <td>${unreachable ? '‚úó' : nextHop}</td>
                        <td>${unreachable ? 'Unreachable' : cost}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function updateFailedLinksDisplay() {
            if (state.whatIf.failedLinks.size === 0 && !state.whatIf.selectedRouter) {
                document.getElementById('whatif-info').innerHTML = `
                    <div class="no-selection">
                        <div class="icon">üîß</div>
                        <p>Fail links to see how OSPF<br>reconverges automatically</p>
                    </div>
                `;
            }
        }

        function restoreLink(linkId) {
            state.whatIf.failedLinks.delete(linkId);
            renderTopology(document.getElementById('canvas-what-if'), 'what-if');
            if (state.whatIf.selectedRouter) {
                showWhatIfInfo(state.whatIf.selectedRouter);
            }
            updateFailedLinksDisplay();
        }

        // ==================== WHAT-IF CONTROLS ====================
        document.getElementById('btn-reset-topology').addEventListener('click', () => {
            state.whatIf.failedLinks.clear();
            state.whatIf.selectedRouter = null;
            renderTopology(document.getElementById('canvas-what-if'), 'what-if');
            updateFailedLinksDisplay();
        });

        document.getElementById('btn-fail-random').addEventListener('click', () => {
            const activeLinks = links.filter(link => {
                const linkId = `${link.from}-${link.to}`;
                return !state.whatIf.failedLinks.has(linkId);
            });

            if (activeLinks.length > 0) {
                const randomLink = activeLinks[Math.floor(Math.random() * activeLinks.length)];
                const linkId = `${randomLink.from}-${randomLink.to}`;
                state.whatIf.failedLinks.add(linkId);
                renderTopology(document.getElementById('canvas-what-if'), 'what-if');
                if (state.whatIf.selectedRouter) {
                    showWhatIfInfo(state.whatIf.selectedRouter);
                }
            }
        });

        // Make restoreLink available globally
        window.restoreLink = restoreLink;
    </script>
<script src="../../../../components/FluxCapacitor.js"></script>
</body>
</html>
