<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Access Control -->
    <script src="../../../../components/AccessGuard.js"></script>
    <script>
        AccessGuard.require('sorted');
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FHRP Visualizer - HSRP, VRRP, GLBP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #166534 0%, #22c55e 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            color: white;
            padding: 30px 0;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .back-link {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            text-decoration: none;
            font-size: 1.1em;
            opacity: 0.8;
            transition: opacity 0.3s;
        }

        .back-link:hover {
            opacity: 1;
        }

        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 15px 30px;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .tab-btn.active {
            background: white;
            color: #166534;
            border-color: white;
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .tab-content.active {
            display: block;
        }

        h2 {
            color: #166534;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        h3 {
            color: #16a34a;
            margin: 25px 0 15px;
            font-size: 1.4em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #e5e7eb;
        }

        th {
            background: #16a34a;
            color: white;
            font-weight: bold;
        }

        tr:nth-child(even) {
            background: #f0fdf4;
        }

        .state-machine {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 30px 0;
        }

        .state-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .state-box {
            padding: 20px 30px;
            border-radius: 10px;
            border: 3px solid #d1d5db;
            background: white;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            min-width: 120px;
        }

        .state-box.active {
            border-color: #22c55e;
            background: #dcfce7;
            transform: scale(1.1);
        }

        .state-arrow {
            font-size: 2em;
            color: #16a34a;
        }

        .config-builder {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .config-options {
            background: #f8fafc;
            border-radius: 15px;
            padding: 25px;
        }

        .config-group {
            margin-bottom: 20px;
        }

        .config-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #374151;
        }

        .config-group select, .config-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1em;
        }

        .config-output {
            background: #1e293b;
            border-radius: 15px;
            padding: 25px;
            color: #22c55e;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            font-size: 0.95em;
            line-height: 1.6;
            max-height: 600px;
            overflow-y: auto;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 8px 15px;
            background: #22c55e;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            background: #16a34a;
        }

        .config-wrapper {
            position: relative;
        }

        .quiz-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .quiz-question {
            background: #f8fafc;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
        }

        .quiz-question h4 {
            color: #166534;
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quiz-option {
            padding: 15px 20px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quiz-option:hover {
            border-color: #22c55e;
            background: #f0fdf4;
        }

        .quiz-option.selected {
            border-color: #22c55e;
            background: #dcfce7;
        }

        .quiz-option.correct {
            border-color: #10b981;
            background: #d1fae5;
        }

        .quiz-option.incorrect {
            border-color: #ef4444;
            background: #fee2e2;
        }

        .quiz-feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }

        .quiz-feedback.show {
            display: block;
        }

        .quiz-feedback.correct {
            background: #d1fae5;
            color: #065f46;
        }

        .quiz-feedback.incorrect {
            background: #fee2e2;
            color: #991b1b;
        }

        .quiz-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #22c55e;
            color: white;
        }

        .btn-primary:hover {
            background: #16a34a;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .score-display {
            font-size: 1.2em;
            color: #166534;
            font-weight: bold;
        }

        .info-box {
            background: #dcfce7;
            border-left: 4px solid #22c55e;
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 0 10px 10px 0;
        }

        .protocol-comparison {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        .protocol-card {
            border-radius: 15px;
            padding: 25px;
            text-align: center;
        }

        .protocol-card.hsrp {
            background: #dbeafe;
            border: 3px solid #3b82f6;
        }

        .protocol-card.vrrp {
            background: #d1fae5;
            border: 3px solid #10b981;
        }

        .protocol-card.glbp {
            background: #fef3c7;
            border: 3px solid #f59e0b;
        }

        .protocol-card h3 {
            margin: 10px 0;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .detail-label {
            font-weight: bold;
        }

        @media (max-width: 900px) {
            .config-builder {
                grid-template-columns: 1fr;
            }

            .protocol-comparison {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <a href="../../../../index.html" class="back-link">‚Üê Back to House</a>

    <div class="container">
        <header>
            <h1>üîÑ FHRP Visualizer</h1>
            <p>Interactive HSRP, VRRP, and GLBP Explorer</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" data-tab="comparison">Protocol Comparison</button>
            <button class="tab-btn" data-tab="states">State Machine</button>
            <button class="tab-btn" data-tab="builder">Config Builder</button>
            <button class="tab-btn" data-tab="quiz">Quiz</button>
        </div>

        <!-- Tab 1: Protocol Comparison -->
        <div id="comparison" class="tab-content active">
            <h2>FHRP Protocol Comparison</h2>
            <p>Side-by-side comparison of HSRP, VRRP, and GLBP:</p>

            <div class="protocol-comparison">
                <div class="protocol-card hsrp">
                    <div style="font-size: 3em;">üîµ</div>
                    <h3 style="color: #1e40af;">HSRP</h3>
                    <p style="font-weight: bold; color: #1e40af;">Hot Standby Router Protocol</p>

                    <div style="text-align: left; margin-top: 20px;">
                        <div class="detail-row">
                            <span class="detail-label">Vendor:</span>
                            <span>Cisco Proprietary</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">RFC/Standard:</span>
                            <span>None (Cisco only)</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Active Routers:</span>
                            <span>1 (Active/Standby)</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Multicast (v1):</span>
                            <span>224.0.0.2</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Multicast (v2):</span>
                            <span>224.0.0.102</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Transport:</span>
                            <span>UDP 1985</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Virtual MAC (v1):</span>
                            <span>0000.0c07.acXX</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Virtual MAC (v2):</span>
                            <span>0000.0c9f.fXXX</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Hello Timer:</span>
                            <span>3 seconds</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Hold Timer:</span>
                            <span>10 seconds</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Default Priority:</span>
                            <span>100</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Preemption:</span>
                            <span>Disabled (manual)</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Load Balancing:</span>
                            <span>No</span>
                        </div>
                    </div>
                </div>

                <div class="protocol-card vrrp">
                    <div style="font-size: 3em;">üü¢</div>
                    <h3 style="color: #059669;">VRRP</h3>
                    <p style="font-weight: bold; color: #059669;">Virtual Router Redundancy Protocol</p>

                    <div style="text-align: left; margin-top: 20px;">
                        <div class="detail-row">
                            <span class="detail-label">Vendor:</span>
                            <span>Open Standard</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">RFC/Standard:</span>
                            <span>RFC 5798</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Active Routers:</span>
                            <span>1 (Master/Backup)</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Multicast:</span>
                            <span>224.0.0.18</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Multicast (v2):</span>
                            <span>N/A</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Transport:</span>
                            <span>IP Protocol 112</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Virtual MAC:</span>
                            <span>0000.5e00.01XX</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Virtual MAC (v2):</span>
                            <span>N/A</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Advertisement:</span>
                            <span>1 second</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Hold Timer:</span>
                            <span>3 √ó Advertisement</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Default Priority:</span>
                            <span>100</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Preemption:</span>
                            <span>Enabled (default)</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Load Balancing:</span>
                            <span>No</span>
                        </div>
                    </div>
                </div>

                <div class="protocol-card glbp">
                    <div style="font-size: 3em;">üü°</div>
                    <h3 style="color: #d97706;">GLBP</h3>
                    <p style="font-weight: bold; color: #d97706;">Gateway Load Balancing Protocol</p>

                    <div style="text-align: left; margin-top: 20px;">
                        <div class="detail-row">
                            <span class="detail-label">Vendor:</span>
                            <span>Cisco Proprietary</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">RFC/Standard:</span>
                            <span>None (Cisco only)</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Active Routers:</span>
                            <span>Up to 4 (AVG/AVF)</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Multicast:</span>
                            <span>224.0.0.102</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Multicast (v2):</span>
                            <span>N/A</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Transport:</span>
                            <span>UDP 3222</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Virtual MAC:</span>
                            <span>0007.b400.XXYY</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Virtual MAC (v2):</span>
                            <span>N/A</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Hello Timer:</span>
                            <span>3 seconds</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Hold Timer:</span>
                            <span>10 seconds</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Default Priority:</span>
                            <span>100</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Preemption:</span>
                            <span>Disabled (manual)</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Load Balancing:</span>
                            <span>Yes (round-robin)</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="info-box">
                <h3 style="color: #166534;">Key Differences Summary</h3>
                <ul>
                    <li><strong>HSRP:</strong> Cisco-only, most common in enterprise, simple active/standby model</li>
                    <li><strong>VRRP:</strong> Open standard for multi-vendor environments, preemption enabled by default</li>
                    <li><strong>GLBP:</strong> Cisco-only with load balancing, uses multiple virtual MACs for distribution</li>
                </ul>
            </div>
        </div>

        <!-- Tab 2: State Machine -->
        <div id="states" class="tab-content">
            <h2>HSRP State Machine Simulator</h2>
            <p>Click on states to see the HSRP state transition sequence:</p>

            <div class="state-machine">
                <div class="state-row">
                    <div class="state-box" data-state="0">Initial</div>
                    <div class="state-arrow">‚Üí</div>
                    <div class="state-box" data-state="1">Learn</div>
                    <div class="state-arrow">‚Üí</div>
                    <div class="state-box" data-state="2">Listen</div>
                </div>
                <div style="text-align: center;">
                    <div class="state-arrow" style="transform: rotate(90deg); display: inline-block;">‚Üí</div>
                </div>
                <div class="state-row">
                    <div class="state-box" data-state="5">Active</div>
                    <div class="state-arrow">‚Üê</div>
                    <div class="state-box" data-state="4">Standby</div>
                    <div class="state-arrow">‚Üê</div>
                    <div class="state-box" data-state="3">Speak</div>
                </div>
            </div>

            <div id="state-description" style="background: #f0fdf4; padding: 20px; border-radius: 10px; margin-top: 30px; border-left: 4px solid #22c55e;">
                <h3 style="color: #166534;">State: Initial</h3>
                <p style="font-size: 1.1em; line-height: 1.6;">
                    <strong>Description:</strong> Starting state when HSRP first starts or the interface comes up.<br>
                    <strong>Behavior:</strong> HSRP is not running yet. Interface is being configured.<br>
                    <strong>Next State:</strong> Learn (if virtual IP not configured) or Listen (if virtual IP is configured).
                </p>
            </div>

            <div style="margin-top: 30px;">
                <button class="btn btn-primary" onclick="animateStates()">Animate Full Transition</button>
                <button class="btn btn-secondary" onclick="resetStates()">Reset</button>
            </div>

            <h3 style="margin-top: 40px;">Complete State Reference</h3>
            <table>
                <tr>
                    <th>State</th>
                    <th>Description</th>
                    <th>Sends Hellos?</th>
                    <th>Forwards Traffic?</th>
                </tr>
                <tr>
                    <td><strong>Initial</strong></td>
                    <td>Starting state, HSRP beginning</td>
                    <td>No</td>
                    <td>No</td>
                </tr>
                <tr>
                    <td><strong>Learn</strong></td>
                    <td>Waiting to learn virtual IP from active router</td>
                    <td>No</td>
                    <td>No</td>
                </tr>
                <tr>
                    <td><strong>Listen</strong></td>
                    <td>Listening for hello messages</td>
                    <td>No</td>
                    <td>No</td>
                </tr>
                <tr>
                    <td><strong>Speak</strong></td>
                    <td>Participating in active/standby election</td>
                    <td>Yes</td>
                    <td>No</td>
                </tr>
                <tr>
                    <td><strong>Standby</strong></td>
                    <td>Backup router, ready to take over</td>
                    <td>Yes</td>
                    <td>No</td>
                </tr>
                <tr style="background: #dbeafe;">
                    <td><strong>Active</strong></td>
                    <td>Forwarding router for virtual IP</td>
                    <td>Yes</td>
                    <td>Yes</td>
                </tr>
            </table>
        </div>

        <!-- Tab 3: Config Builder -->
        <div id="builder" class="tab-content">
            <h2>FHRP Configuration Builder</h2>
            <p>Generate configuration for HSRP, VRRP, or GLBP:</p>

            <div class="config-builder">
                <div class="config-options">
                    <div class="config-group">
                        <label>Protocol:</label>
                        <select id="cfg-protocol" onchange="updateConfig()">
                            <option value="hsrp">HSRP (Cisco)</option>
                            <option value="vrrp">VRRP (Open Standard)</option>
                            <option value="glbp">GLBP (Cisco - Load Balancing)</option>
                        </select>
                    </div>

                    <div class="config-group" id="version-group">
                        <label>HSRP Version:</label>
                        <select id="cfg-version" onchange="updateConfig()">
                            <option value="1">Version 1</option>
                            <option value="2">Version 2 (Recommended)</option>
                        </select>
                    </div>

                    <div class="config-group">
                        <label>Group Number:</label>
                        <input type="number" id="cfg-group" value="1" min="0" max="255" onchange="updateConfig()">
                    </div>

                    <div class="config-group">
                        <label>Interface:</label>
                        <select id="cfg-interface" onchange="updateConfig()">
                            <option value="GigabitEthernet0/0">GigabitEthernet0/0</option>
                            <option value="GigabitEthernet0/1">GigabitEthernet0/1</option>
                            <option value="Vlan10">Vlan10</option>
                            <option value="Vlan100">Vlan100</option>
                        </select>
                    </div>

                    <div class="config-group">
                        <label>Physical IP Address:</label>
                        <input type="text" id="cfg-physical-ip" value="192.168.1.1" onchange="updateConfig()">
                    </div>

                    <div class="config-group">
                        <label>Subnet Mask:</label>
                        <input type="text" id="cfg-mask" value="255.255.255.0" onchange="updateConfig()">
                    </div>

                    <div class="config-group">
                        <label>Virtual Gateway IP:</label>
                        <input type="text" id="cfg-virtual-ip" value="192.168.1.254" onchange="updateConfig()">
                    </div>

                    <div class="config-group">
                        <label>Priority:</label>
                        <input type="number" id="cfg-priority" value="100" min="1" max="255" onchange="updateConfig()">
                    </div>

                    <div class="config-group">
                        <label>Preemption:</label>
                        <select id="cfg-preempt" onchange="updateConfig()">
                            <option value="yes">Enabled</option>
                            <option value="no">Disabled</option>
                        </select>
                    </div>

                    <div class="config-group" id="tracking-group" style="display: none;">
                        <label>Interface Tracking:</label>
                        <select id="cfg-tracking" onchange="updateConfig()">
                            <option value="no">No Tracking</option>
                            <option value="yes">Track Uplink</option>
                        </select>
                    </div>

                    <div class="config-group" id="glbp-lb-group" style="display: none;">
                        <label>Load Balancing Method:</label>
                        <select id="cfg-lb-method" onchange="updateConfig()">
                            <option value="round-robin">Round-Robin</option>
                            <option value="weighted">Weighted</option>
                            <option value="host-dependent">Host-Dependent</option>
                        </select>
                    </div>
                </div>

                <div class="config-wrapper">
                    <div class="config-output" id="config-output"></div>
                    <button class="copy-btn" onclick="copyConfig()">üìã Copy</button>
                </div>
            </div>
        </div>

        <!-- Tab 4: Quiz -->
        <div id="quiz" class="tab-content">
            <h2>FHRP Knowledge Check</h2>
            <div class="quiz-container">
                <div id="quiz-area"></div>
                <div class="quiz-controls">
                    <div class="score-display" id="score-display">Score: 0/0</div>
                    <div>
                        <button class="btn btn-secondary" onclick="resetQuiz()">Restart Quiz</button>
                        <button class="btn btn-primary" id="next-btn" onclick="nextQuestion()">Check Answer</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab functionality
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(btn.dataset.tab).classList.add('active');
            });
        });

        // State Machine
        const stateDescriptions = {
            0: {
                name: "Initial",
                desc: "Starting state when HSRP first starts or the interface comes up.",
                behavior: "HSRP is not running yet. Interface is being configured.",
                next: "Learn (if virtual IP not configured) or Listen (if virtual IP is configured)"
            },
            1: {
                name: "Learn",
                desc: "Router has not yet determined the virtual IP address.",
                behavior: "Waiting to hear hello messages from the active router to learn the virtual IP.",
                next: "Listen (after learning virtual IP or timeout)"
            },
            2: {
                name: "Listen",
                desc: "Router knows the virtual IP and is listening for hello messages.",
                behavior: "Monitoring for active and standby routers. Not sending hellos yet.",
                next: "Speak (after hold timer expires without hearing from active/standby)"
            },
            3: {
                name: "Speak",
                desc: "Router is sending hello messages and participating in the election.",
                behavior: "Actively competing to become active or standby router.",
                next: "Standby or Active (based on priority)"
            },
            4: {
                name: "Standby",
                desc: "Router is the standby (backup) router.",
                behavior: "Monitoring the active router. Sends periodic hellos. Ready to take over if active fails.",
                next: "Active (if active router fails or this router has higher priority with preemption)"
            },
            5: {
                name: "Active",
                desc: "Router is the active router forwarding traffic for the virtual IP.",
                behavior: "Forwarding traffic. Responding to ARP requests for virtual IP. Sending periodic hellos.",
                next: "Speak (if a router with higher priority preempts)"
            }
        };

        let currentState = 0;

        document.querySelectorAll('.state-box').forEach(box => {
            box.addEventListener('click', () => {
                const state = parseInt(box.dataset.state);
                setActiveState(state);
            });
        });

        function setActiveState(state) {
            currentState = state;
            document.querySelectorAll('.state-box').forEach(box => box.classList.remove('active'));
            document.querySelector(`.state-box[data-state="${state}"]`).classList.add('active');

            const info = stateDescriptions[state];
            document.getElementById('state-description').innerHTML = `
                <h3 style="color: #166534;">State: ${info.name}</h3>
                <p style="font-size: 1.1em; line-height: 1.6;">
                    <strong>Description:</strong> ${info.desc}<br>
                    <strong>Behavior:</strong> ${info.behavior}<br>
                    <strong>Next State:</strong> ${info.next}
                </p>
            `;
        }

        function animateStates() {
            let state = 0;
            const interval = setInterval(() => {
                setActiveState(state);
                state++;
                if (state > 5) {
                    clearInterval(interval);
                }
            }, 1500);
        }

        function resetStates() {
            setActiveState(0);
        }

        // Config Builder
        function updateConfig() {
            const protocol = document.getElementById('cfg-protocol').value;
            const version = document.getElementById('cfg-version').value;
            const group = document.getElementById('cfg-group').value;
            const iface = document.getElementById('cfg-interface').value;
            const physicalIp = document.getElementById('cfg-physical-ip').value;
            const mask = document.getElementById('cfg-mask').value;
            const virtualIp = document.getElementById('cfg-virtual-ip').value;
            const priority = document.getElementById('cfg-priority').value;
            const preempt = document.getElementById('cfg-preempt').value;
            const tracking = document.getElementById('cfg-tracking').value;
            const lbMethod = document.getElementById('cfg-lb-method').value;

            // Show/hide version selector
            document.getElementById('version-group').style.display = protocol === 'hsrp' ? 'block' : 'none';
            document.getElementById('tracking-group').style.display = protocol === 'hsrp' ? 'block' : 'none';
            document.getElementById('glbp-lb-group').style.display = protocol === 'glbp' ? 'block' : 'none';

            let config = '';

            if (protocol === 'hsrp') {
                config = `! HSRP Configuration
! Generated by Hexworth Prime FHRP Visualizer
!
interface ${iface}
 ip address ${physicalIp} ${mask}
 ${version === '2' ? 'standby version 2' : '! Using HSRP version 1 (default)'}
 standby ${group} ip ${virtualIp}
 standby ${group} priority ${priority}`;

                if (preempt === 'yes') {
                    config += `\n standby ${group} preempt`;
                }

                config += `\n standby ${group} timers 3 10`;

                if (tracking === 'yes') {
                    config += `\n!
! Configure interface tracking
track 1 interface GigabitEthernet0/1 line-protocol
!
interface ${iface}
 standby ${group} track 1 decrement 20`;
                }

                config += `\n no shutdown
!
! Virtual MAC will be: 0000.0c${version === '2' ? '9f.f' : '07.ac'}${group.toString(16).padStart(version === '2' ? 3 : 2, '0')}
!
! Verification commands:
! show standby
! show standby brief
! show track`;

            } else if (protocol === 'vrrp') {
                config = `! VRRP Configuration
! Generated by Hexworth Prime FHRP Visualizer
!
interface ${iface}
 ip address ${physicalIp} ${mask}
 vrrp ${group} ip ${virtualIp}
 vrrp ${group} priority ${priority}`;

                if (preempt === 'no') {
                    config += `\n vrrp ${group} preempt disable  ! Preempt is ON by default in VRRP`;
                } else {
                    config += `\n ! Preemption enabled by default`;
                }

                config += `\n vrrp ${group} timers advertise 1
 no shutdown
!
! Virtual MAC will be: 0000.5e00.01${group.toString(16).padStart(2, '0')}
!
! Verification commands:
! show vrrp
! show vrrp brief`;

            } else if (protocol === 'glbp') {
                config = `! GLBP Configuration
! Generated by Hexworth Prime FHRP Visualizer
!
interface ${iface}
 ip address ${physicalIp} ${mask}
 glbp ${group} ip ${virtualIp}
 glbp ${group} priority ${priority}`;

                if (preempt === 'yes') {
                    config += `\n glbp ${group} preempt`;
                }

                config += `\n glbp ${group} timers 3 10
 glbp ${group} load-balancing ${lbMethod}
 no shutdown
!
! Virtual MAC format: 0007.b400.${group.toString(16).padStart(2, '0')}YY
! (YY varies per AVF - Active Virtual Forwarder)
!
! Verification commands:
! show glbp
! show glbp brief`;
            }

            document.getElementById('config-output').textContent = config;
        }

        function copyConfig() {
            const config = document.getElementById('config-output').textContent;
            navigator.clipboard.writeText(config).then(() => {
                const btn = document.querySelector('.copy-btn');
                btn.textContent = '‚úÖ Copied!';
                setTimeout(() => btn.textContent = 'üìã Copy', 2000);
            });
        }

        // Quiz
        const quizQuestions = [
            {
                question: "What is the default HSRP priority value?",
                options: ["50", "100", "150", "255"],
                correct: 1,
                explanation: "The default HSRP priority is 100. Higher values have higher priority in the election."
            },
            {
                question: "Which protocol uses IP protocol 112 instead of UDP?",
                options: ["HSRP", "VRRP", "GLBP", "All of them"],
                correct: 1,
                explanation: "VRRP uses IP protocol 112. HSRP uses UDP 1985 and GLBP uses UDP 3222."
            },
            {
                question: "What is the virtual MAC format for HSRPv1?",
                options: ["0000.0c07.acXX", "0000.5e00.01XX", "0007.b400.XXYY", "0000.0c9f.fXXX"],
                correct: 0,
                explanation: "HSRPv1 uses 0000.0c07.acXX where XX is the group number in hex. HSRPv2 uses 0000.0c9f.fXXX."
            },
            {
                question: "Which FHRP has preemption enabled by default?",
                options: ["HSRP", "VRRP", "GLBP", "None"],
                correct: 1,
                explanation: "VRRP has preemption enabled by default. HSRP and GLBP require manual configuration with the 'preempt' command."
            },
            {
                question: "What does GLBP stand for?",
                options: ["Gateway Link Backup Protocol", "Gateway Load Balancing Protocol", "Global Link Binding Protocol", "Gateway Loop Break Protocol"],
                correct: 1,
                explanation: "GLBP = Gateway Load Balancing Protocol. It's Cisco's FHRP that provides both redundancy and load balancing."
            },
            {
                question: "Which multicast address does VRRP use?",
                options: ["224.0.0.2", "224.0.0.18", "224.0.0.102", "224.0.0.5"],
                correct: 1,
                explanation: "VRRP uses 224.0.0.18. HSRPv1 uses 224.0.0.2, and HSRPv2/GLBP use 224.0.0.102."
            },
            {
                question: "In HSRP, what role does the router play if it's not Active or Standby?",
                options: ["Passive", "Listen", "Backup", "Idle"],
                correct: 1,
                explanation: "Routers in HSRP that are neither Active nor Standby are in the Listen state, monitoring hello messages."
            },
            {
                question: "How many routers can actively forward traffic in GLBP?",
                options: ["1", "2", "4", "8"],
                correct: 2,
                explanation: "GLBP supports up to 4 Active Virtual Forwarders (AVFs) forwarding traffic simultaneously."
            },
            {
                question: "What command enables HSRP on an interface?",
                options: ["hsrp enable", "standby ip [address]", "fhrp active", "gateway redundancy"],
                correct: 1,
                explanation: "The command 'standby [group] ip [virtual-ip]' enables HSRP and sets the virtual gateway address."
            },
            {
                question: "Which FHRP is an open standard (not Cisco proprietary)?",
                options: ["HSRP", "VRRP", "GLBP", "All are proprietary"],
                correct: 1,
                explanation: "VRRP (RFC 5798) is the only open standard FHRP. HSRP and GLBP are Cisco proprietary."
            }
        ];

        let currentQuestion = 0;
        let score = 0;
        let answered = false;

        function renderQuiz() {
            const area = document.getElementById('quiz-area');
            const q = quizQuestions[currentQuestion];

            area.innerHTML = `
                <div class="quiz-question">
                    <h4>Question ${currentQuestion + 1} of ${quizQuestions.length}</h4>
                    <p style="font-size: 1.1em; margin-bottom: 20px;">${q.question}</p>
                    <div class="quiz-options">
                        ${q.options.map((opt, i) => `
                            <div class="quiz-option" onclick="selectAnswer(${i})" data-index="${i}">
                                ${opt}
                            </div>
                        `).join('')}
                    </div>
                    <div class="quiz-feedback" id="quiz-feedback"></div>
                </div>
            `;

            document.getElementById('next-btn').textContent = 'Check Answer';
            answered = false;
            updateScore();
        }

        function selectAnswer(index) {
            if (answered) return;

            document.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelector(`.quiz-option[data-index="${index}"]`).classList.add('selected');
        }

        function nextQuestion() {
            if (!answered) {
                const selected = document.querySelector('.quiz-option.selected');
                if (!selected) {
                    alert('Please select an answer!');
                    return;
                }

                const selectedIndex = parseInt(selected.dataset.index);
                const q = quizQuestions[currentQuestion];
                const feedback = document.getElementById('quiz-feedback');

                document.querySelectorAll('.quiz-option').forEach((opt, i) => {
                    if (i === q.correct) {
                        opt.classList.add('correct');
                    } else if (i === selectedIndex && selectedIndex !== q.correct) {
                        opt.classList.add('incorrect');
                    }
                });

                if (selectedIndex === q.correct) {
                    score++;
                    feedback.className = 'quiz-feedback show correct';
                    feedback.innerHTML = `‚úÖ Correct! ${q.explanation}`;
                } else {
                    feedback.className = 'quiz-feedback show incorrect';
                    feedback.innerHTML = `‚ùå Incorrect. ${q.explanation}`;
                }

                answered = true;
                updateScore();

                if (currentQuestion < quizQuestions.length - 1) {
                    document.getElementById('next-btn').textContent = 'Next Question ‚Üí';
                } else {
                    document.getElementById('next-btn').textContent = 'See Results';
                }
            } else {
                currentQuestion++;
                if (currentQuestion < quizQuestions.length) {
                    renderQuiz();
                } else {
                    showResults();
                }
            }
        }

        function updateScore() {
            document.getElementById('score-display').textContent = `Score: ${score}/${answered ? currentQuestion + 1 : currentQuestion}`;
        }

        function showResults() {
            const area = document.getElementById('quiz-area');
            const percentage = Math.round((score / quizQuestions.length) * 100);
            let message, color;

            if (percentage >= 90) {
                message = "üèÜ Excellent! You're an FHRP expert!";
                color = "#10b981";
            } else if (percentage >= 70) {
                message = "üëç Good job! You understand FHRPs well.";
                color = "#22c55e";
            } else if (percentage >= 50) {
                message = "üìö Not bad, but review the material again.";
                color = "#f59e0b";
            } else {
                message = "üìñ Keep studying! Review HSRP, VRRP, and GLBP.";
                color = "#ef4444";
            }

            area.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div style="font-size: 4em; margin-bottom: 20px;">üéØ</div>
                    <h3 style="font-size: 2em; color: ${color};">You scored ${score}/${quizQuestions.length} (${percentage}%)</h3>
                    <p style="font-size: 1.3em; margin: 20px 0;">${message}</p>
                </div>
            `;

            document.getElementById('next-btn').style.display = 'none';
        }

        function resetQuiz() {
            currentQuestion = 0;
            score = 0;
            answered = false;
            document.getElementById('next-btn').style.display = 'inline-block';
            renderQuiz();
        }

        // Initialize
        updateConfig();
        renderQuiz();
        setActiveState(0);
    </script>
</body>
</html>
