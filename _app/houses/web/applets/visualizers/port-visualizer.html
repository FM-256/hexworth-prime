<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Access Control -->
    <script src="../../../../components/AccessGuard.js"></script>
    <script>
        AccessGuard.require('sorted');
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Port Visualizer - Network Essentials</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: white;
        }

        .header {
            text-align: center;
            padding: 30px 20px;
            background: rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #06b6d4, #22d3ee);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header p {
            color: #94a3b8;
            font-size: 1.1em;
        }

        .back-link {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #06b6d4;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95em;
            transition: color 0.3s;
        }

        .back-link:hover {
            color: #22d3ee;
        }

        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 20px;
            flex-wrap: wrap;
            background: rgba(0, 0, 0, 0.2);
        }

        .tab {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 25px;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        .tab:hover {
            background: rgba(6, 182, 212, 0.2);
            color: white;
        }

        .tab.active {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: white;
            border-color: #22d3ee;
        }

        .tab-content {
            display: none;
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .tab-content.active {
            display: block;
        }

        /* Port Explorer Tab Styles */
        .search-filter-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 12px 20px;
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1em;
        }

        .search-input::placeholder {
            color: #64748b;
        }

        .search-input:focus {
            outline: none;
            border-color: #06b6d4;
        }

        .filter-btn {
            padding: 12px 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.05);
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .filter-btn.active {
            background: rgba(6, 182, 212, 0.3);
            border-color: #06b6d4;
            color: white;
        }

        .port-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .port-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .port-card:hover {
            border-color: #06b6d4;
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(6, 182, 212, 0.2);
        }

        .port-card.tcp {
            border-left: 4px solid #3b82f6;
        }

        .port-card.udp {
            border-left: 4px solid #10b981;
        }

        .port-card.both {
            border-left: 4px solid #f59e0b;
        }

        .port-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .port-number {
            font-size: 2em;
            font-weight: bold;
            color: #22d3ee;
        }

        .protocol-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .protocol-badge.tcp {
            background: rgba(59, 130, 246, 0.3);
            color: #60a5fa;
        }

        .protocol-badge.udp {
            background: rgba(16, 185, 129, 0.3);
            color: #34d399;
        }

        .protocol-badge.both {
            background: rgba(245, 158, 11, 0.3);
            color: #fbbf24;
        }

        .port-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #fbbf24;
            margin-bottom: 8px;
        }

        .port-description {
            color: #94a3b8;
            font-size: 0.95em;
            line-height: 1.5;
        }

        .port-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .port-tag {
            padding: 4px 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-size: 0.8em;
            color: #94a3b8;
        }

        .security-badge {
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 0.8em;
        }

        .security-badge.secure {
            background: rgba(16, 185, 129, 0.2);
            color: #34d399;
        }

        .security-badge.insecure {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }

        /* TCP vs UDP Tab Styles */
        .comparison-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .protocol-box {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
        }

        .protocol-box.tcp-box {
            border: 3px solid #3b82f6;
        }

        .protocol-box.udp-box {
            border: 3px solid #10b981;
        }

        .protocol-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .protocol-title {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .tcp-box .protocol-title { color: #60a5fa; }
        .udp-box .protocol-title { color: #34d399; }

        .protocol-subtitle {
            color: #94a3b8;
            margin-bottom: 20px;
        }

        .feature-list {
            text-align: left;
            list-style: none;
        }

        .feature-list li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .feature-list li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #22d3ee;
        }

        .animation-demo {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            margin-top: 20px;
        }

        .animation-demo h3 {
            color: #22d3ee;
            margin-bottom: 20px;
            text-align: center;
        }

        .packet-animation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            position: relative;
            height: 150px;
        }

        .endpoint {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
        }

        .endpoint.client {
            background: rgba(59, 130, 246, 0.3);
            border: 3px solid #3b82f6;
            color: #60a5fa;
        }

        .endpoint.server {
            background: rgba(16, 185, 129, 0.3);
            border: 3px solid #10b981;
            color: #34d399;
        }

        .packet-path {
            flex: 1;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            margin: 0 20px;
            position: relative;
        }

        .packet {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 5px;
            top: -13px;
            left: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
            transition: left 0.5s ease-in-out;
        }

        .packet.tcp-packet {
            background: #3b82f6;
            color: white;
        }

        .packet.udp-packet {
            background: #10b981;
            color: white;
        }

        .packet.ack-packet {
            background: #8b5cf6;
            color: white;
        }

        .demo-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .demo-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .demo-btn.tcp-btn {
            background: #3b82f6;
            color: white;
        }

        .demo-btn.udp-btn {
            background: #10b981;
            color: white;
        }

        .demo-btn:hover {
            transform: scale(1.05);
        }

        /* Port Scanner Tab Styles */
        .scanner-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .scanner-controls {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
        }

        .scanner-results {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #94a3b8;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 1em;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #06b6d4;
        }

        .scan-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .scan-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(6, 182, 212, 0.4);
        }

        .port-result {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .port-result .port-num {
            font-size: 1.3em;
            font-weight: bold;
            color: #22d3ee;
        }

        .port-result .service {
            color: #94a3b8;
        }

        .port-status {
            padding: 5px 15px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .port-status.open {
            background: rgba(16, 185, 129, 0.2);
            color: #34d399;
        }

        .port-status.closed {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }

        .port-status.filtered {
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }

        /* Matching Game Tab Styles */
        .game-container {
            text-align: center;
        }

        .game-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 30px;
            border-radius: 15px;
        }

        .stat-label {
            color: #94a3b8;
            font-size: 0.9em;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #22d3ee;
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            max-width: 900px;
            margin: 0 auto;
        }

        .match-column {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
        }

        .match-column h3 {
            color: #22d3ee;
            margin-bottom: 20px;
        }

        .match-item {
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .match-item:hover {
            background: rgba(6, 182, 212, 0.2);
        }

        .match-item.selected {
            border-color: #06b6d4;
            background: rgba(6, 182, 212, 0.3);
        }

        .match-item.correct {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.3);
        }

        .match-item.incorrect {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.3);
        }

        .match-item.matched {
            opacity: 0.5;
            pointer-events: none;
        }

        .game-controls {
            margin-top: 30px;
        }

        .game-btn {
            padding: 15px 40px;
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .game-btn:hover {
            transform: scale(1.05);
        }

        /* Quiz Tab Styles */
        .quiz-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .quiz-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .progress-bar {
            flex: 1;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin: 0 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #06b6d4, #22d3ee);
            transition: width 0.3s ease;
        }

        .quiz-question-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
        }

        .quiz-question {
            font-size: 1.4em;
            margin-bottom: 25px;
            color: white;
        }

        .quiz-options {
            display: grid;
            gap: 15px;
        }

        .quiz-option {
            padding: 18px 25px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }

        .quiz-option:hover {
            background: rgba(6, 182, 212, 0.2);
            border-color: rgba(6, 182, 212, 0.5);
        }

        .quiz-option.selected {
            border-color: #06b6d4;
        }

        .quiz-option.correct {
            background: rgba(16, 185, 129, 0.3);
            border-color: #10b981;
        }

        .quiz-option.incorrect {
            background: rgba(239, 68, 68, 0.3);
            border-color: #ef4444;
        }

        .quiz-option.disabled {
            pointer-events: none;
        }

        .quiz-feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 12px;
            display: none;
        }

        .quiz-feedback.show {
            display: block;
        }

        .quiz-feedback.correct {
            background: rgba(16, 185, 129, 0.2);
            border: 2px solid #10b981;
        }

        .quiz-feedback.incorrect {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
        }

        .quiz-btn {
            padding: 15px 40px;
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }

        .quiz-btn:hover {
            transform: scale(1.05);
        }

        .quiz-btn:disabled {
            background: #4a5568;
            cursor: not-allowed;
            transform: none;
        }

        .quiz-results {
            text-align: center;
            padding: 40px;
        }

        .quiz-score {
            font-size: 4em;
            font-weight: bold;
            margin: 20px 0;
        }

        .quiz-score.excellent { color: #10b981; }
        .quiz-score.good { color: #f59e0b; }
        .quiz-score.needs-work { color: #ef4444; }

        /* Responsive */
        @media (max-width: 1024px) {
            .comparison-container {
                grid-template-columns: 1fr;
            }
            .scanner-container {
                grid-template-columns: 1fr;
            }
            .game-board {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            .tabs {
                gap: 5px;
            }
            .tab {
                padding: 10px 15px;
                font-size: 0.9em;
            }
            .port-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <a href="../../../../index.html" class="back-link">‚Üê Back to House</a>

    <div class="header">
        <h1>üö™ Port Visualizer</h1>
        <p>Interactive tool for learning network ports and protocols</p>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="switchTab('explorer')">Port Explorer</button>
        <button class="tab" onclick="switchTab('comparison')">TCP vs UDP</button>
        <button class="tab" onclick="switchTab('scanner')">Port Scanner Sim</button>
        <button class="tab" onclick="switchTab('game')">Matching Game</button>
        <button class="tab" onclick="switchTab('quiz')">Quiz</button>
    </div>

    <!-- Tab 1: Port Explorer -->
    <div id="explorer" class="tab-content active">
        <div class="search-filter-bar">
            <input type="text" class="search-input" id="portSearch" placeholder="Search by port number, name, or description..." oninput="filterPorts()">
            <button class="filter-btn active" data-filter="all" onclick="setFilter('all')">All</button>
            <button class="filter-btn" data-filter="tcp" onclick="setFilter('tcp')">TCP Only</button>
            <button class="filter-btn" data-filter="udp" onclick="setFilter('udp')">UDP Only</button>
            <button class="filter-btn" data-filter="secure" onclick="setFilter('secure')">Secure</button>
            <button class="filter-btn" data-filter="insecure" onclick="setFilter('insecure')">Insecure</button>
        </div>
        <div class="port-grid" id="portGrid">
            <!-- Ports will be dynamically inserted -->
        </div>
    </div>

    <!-- Tab 2: TCP vs UDP Comparison -->
    <div id="comparison" class="tab-content">
        <div class="comparison-container">
            <div class="protocol-box tcp-box">
                <div class="protocol-icon">üìû</div>
                <div class="protocol-title">TCP</div>
                <div class="protocol-subtitle">Transmission Control Protocol</div>
                <ul class="feature-list">
                    <li>Connection-oriented (3-way handshake)</li>
                    <li>Reliable delivery guaranteed</li>
                    <li>Packets arrive in order</li>
                    <li>Error checking and recovery</li>
                    <li>Flow control (prevents overload)</li>
                    <li>Header size: 20+ bytes</li>
                </ul>
                <div style="margin-top: 20px; padding: 15px; background: rgba(59, 130, 246, 0.2); border-radius: 10px;">
                    <strong>Best for:</strong> Web, email, file transfers, databases
                </div>
            </div>
            <div class="protocol-box udp-box">
                <div class="protocol-icon">üì¢</div>
                <div class="protocol-title">UDP</div>
                <div class="protocol-subtitle">User Datagram Protocol</div>
                <ul class="feature-list">
                    <li>Connectionless (no handshake)</li>
                    <li>Best-effort delivery only</li>
                    <li>No ordering guarantee</li>
                    <li>Minimal error checking</li>
                    <li>No flow control</li>
                    <li>Header size: 8 bytes only</li>
                </ul>
                <div style="margin-top: 20px; padding: 15px; background: rgba(16, 185, 129, 0.2); border-radius: 10px;">
                    <strong>Best for:</strong> Streaming, VoIP, gaming, DNS
                </div>
            </div>
        </div>

        <div class="animation-demo">
            <h3>Live Comparison Demo</h3>
            <div class="packet-animation" id="packetAnimation">
                <div class="endpoint client">CLIENT</div>
                <div class="packet-path">
                    <div class="packet tcp-packet" id="tcpPacket" style="display: none;">TCP</div>
                    <div class="packet udp-packet" id="udpPacket" style="display: none;">UDP</div>
                    <div class="packet ack-packet" id="ackPacket" style="display: none;">ACK</div>
                </div>
                <div class="endpoint server">SERVER</div>
            </div>
            <div id="animationStatus" style="text-align: center; color: #94a3b8; margin-top: 15px;">
                Click a button to see the difference!
            </div>
            <div class="demo-controls">
                <button class="demo-btn tcp-btn" onclick="runTCPDemo()">Run TCP Demo</button>
                <button class="demo-btn udp-btn" onclick="runUDPDemo()">Run UDP Demo</button>
            </div>
        </div>
    </div>

    <!-- Tab 3: Port Scanner Simulator -->
    <div id="scanner" class="tab-content">
        <div class="scanner-container">
            <div class="scanner-controls">
                <h3 style="color: #22d3ee; margin-bottom: 20px;">üîç Educational Port Scanner</h3>
                <p style="color: #94a3b8; margin-bottom: 20px;">This simulator demonstrates port scanning concepts. No actual network scanning occurs.</p>

                <div class="form-group">
                    <label>Target Host (Simulated)</label>
                    <input type="text" id="targetHost" value="192.168.1.100" placeholder="Enter IP address">
                </div>

                <div class="form-group">
                    <label>Scan Type</label>
                    <select id="scanType">
                        <option value="common">Common Ports (Top 20)</option>
                        <option value="web">Web Server Ports</option>
                        <option value="email">Email Server Ports</option>
                        <option value="database">Database Ports</option>
                        <option value="full">Full Scan (1-1024)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Server Profile</label>
                    <select id="serverProfile">
                        <option value="webserver">Web Server</option>
                        <option value="mailserver">Mail Server</option>
                        <option value="database">Database Server</option>
                        <option value="workstation">Workstation</option>
                        <option value="firewall">Behind Firewall</option>
                    </select>
                </div>

                <button class="scan-btn" onclick="runScan()">üöÄ Start Scan</button>
            </div>

            <div class="scanner-results">
                <h3 style="color: #22d3ee; margin-bottom: 20px;">Scan Results</h3>
                <div id="scanResults">
                    <p style="color: #94a3b8; text-align: center;">Select options and click "Start Scan" to see results.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab 4: Matching Game -->
    <div id="game" class="tab-content">
        <div class="game-container">
            <div class="game-stats">
                <div class="stat-box">
                    <div class="stat-label">Score</div>
                    <div class="stat-value" id="gameScore">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Matches</div>
                    <div class="stat-value" id="gameMatches">0/10</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Time</div>
                    <div class="stat-value" id="gameTime">0:00</div>
                </div>
            </div>

            <div class="game-board">
                <div class="match-column">
                    <h3>Port Numbers</h3>
                    <div id="portColumn">
                        <!-- Port items will be inserted here -->
                    </div>
                </div>
                <div class="match-column">
                    <h3>Services</h3>
                    <div id="serviceColumn">
                        <!-- Service items will be inserted here -->
                    </div>
                </div>
            </div>

            <div class="game-controls">
                <button class="game-btn" onclick="startGame()">New Game</button>
            </div>
        </div>
    </div>

    <!-- Tab 5: Quiz -->
    <div id="quiz" class="tab-content">
        <div class="quiz-container">
            <div class="quiz-progress">
                <span id="quizCurrent">Question 1 of 10</span>
                <div class="progress-bar">
                    <div class="progress-fill" id="quizProgressBar" style="width: 10%;"></div>
                </div>
                <span id="quizScoreDisplay">Score: 0/0</span>
            </div>

            <div id="quizQuestionArea">
                <!-- Questions will be dynamically inserted here -->
            </div>

            <div id="quizResults" class="quiz-results" style="display: none;">
                <h2>Quiz Complete!</h2>
                <div class="quiz-score" id="finalScore">8/10</div>
                <p id="scoreMessage">Great job! You have a solid understanding of ports and protocols.</p>
                <button class="quiz-btn" onclick="restartQuiz()" style="margin-top: 20px;">
                    Try Again
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===============================
        // PORT DATABASE
        // ===============================
        const portDatabase = [
            { port: 20, name: 'FTP Data', protocol: 'tcp', description: 'File Transfer Protocol - Data transfer channel', category: 'file', secure: false },
            { port: 21, name: 'FTP Control', protocol: 'tcp', description: 'File Transfer Protocol - Command/control channel', category: 'file', secure: false },
            { port: 22, name: 'SSH', protocol: 'tcp', description: 'Secure Shell - Encrypted remote access and file transfer', category: 'remote', secure: true },
            { port: 23, name: 'Telnet', protocol: 'tcp', description: 'Unencrypted remote terminal access (legacy)', category: 'remote', secure: false },
            { port: 25, name: 'SMTP', protocol: 'tcp', description: 'Simple Mail Transfer Protocol - Email sending', category: 'email', secure: false },
            { port: 53, name: 'DNS', protocol: 'both', description: 'Domain Name System - Name resolution (UDP queries, TCP zone transfers)', category: 'network', secure: true },
            { port: 67, name: 'DHCP Server', protocol: 'udp', description: 'Dynamic Host Configuration Protocol - Server port', category: 'network', secure: true },
            { port: 68, name: 'DHCP Client', protocol: 'udp', description: 'Dynamic Host Configuration Protocol - Client port', category: 'network', secure: true },
            { port: 69, name: 'TFTP', protocol: 'udp', description: 'Trivial File Transfer Protocol - Simple file transfer without auth', category: 'file', secure: false },
            { port: 80, name: 'HTTP', protocol: 'tcp', description: 'Hypertext Transfer Protocol - Unencrypted web traffic', category: 'web', secure: false },
            { port: 110, name: 'POP3', protocol: 'tcp', description: 'Post Office Protocol v3 - Email retrieval', category: 'email', secure: false },
            { port: 123, name: 'NTP', protocol: 'udp', description: 'Network Time Protocol - Time synchronization', category: 'network', secure: true },
            { port: 143, name: 'IMAP', protocol: 'tcp', description: 'Internet Message Access Protocol - Email sync', category: 'email', secure: false },
            { port: 161, name: 'SNMP', protocol: 'udp', description: 'Simple Network Management Protocol - Device monitoring', category: 'network', secure: false },
            { port: 162, name: 'SNMP Trap', protocol: 'udp', description: 'SNMP Trap - Device notifications', category: 'network', secure: false },
            { port: 389, name: 'LDAP', protocol: 'both', description: 'Lightweight Directory Access Protocol', category: 'directory', secure: false },
            { port: 443, name: 'HTTPS', protocol: 'tcp', description: 'HTTP Secure - Encrypted web traffic with TLS/SSL', category: 'web', secure: true },
            { port: 445, name: 'SMB', protocol: 'tcp', description: 'Server Message Block - Windows file sharing', category: 'file', secure: false },
            { port: 465, name: 'SMTPS (Legacy)', protocol: 'tcp', description: 'SMTP over SSL - Legacy secure email sending', category: 'email', secure: true },
            { port: 500, name: 'IKE', protocol: 'udp', description: 'Internet Key Exchange - VPN/IPSec setup', category: 'vpn', secure: true },
            { port: 514, name: 'Syslog', protocol: 'udp', description: 'System Logging Protocol', category: 'network', secure: false },
            { port: 587, name: 'SMTP Submission', protocol: 'tcp', description: 'Email submission with STARTTLS (recommended)', category: 'email', secure: true },
            { port: 636, name: 'LDAPS', protocol: 'tcp', description: 'LDAP over SSL - Secure directory access', category: 'directory', secure: true },
            { port: 993, name: 'IMAPS', protocol: 'tcp', description: 'IMAP over SSL - Secure email sync', category: 'email', secure: true },
            { port: 995, name: 'POP3S', protocol: 'tcp', description: 'POP3 over SSL - Secure email retrieval', category: 'email', secure: true },
            { port: 1433, name: 'MS SQL', protocol: 'tcp', description: 'Microsoft SQL Server database', category: 'database', secure: false },
            { port: 1521, name: 'Oracle', protocol: 'tcp', description: 'Oracle database listener', category: 'database', secure: false },
            { port: 1812, name: 'RADIUS Auth', protocol: 'udp', description: 'RADIUS Authentication', category: 'auth', secure: true },
            { port: 1813, name: 'RADIUS Acct', protocol: 'udp', description: 'RADIUS Accounting', category: 'auth', secure: true },
            { port: 3306, name: 'MySQL', protocol: 'tcp', description: 'MySQL database server', category: 'database', secure: false },
            { port: 3389, name: 'RDP', protocol: 'tcp', description: 'Remote Desktop Protocol - Windows remote access', category: 'remote', secure: true },
            { port: 5432, name: 'PostgreSQL', protocol: 'tcp', description: 'PostgreSQL database server', category: 'database', secure: false },
            { port: 5900, name: 'VNC', protocol: 'tcp', description: 'Virtual Network Computing - Remote desktop', category: 'remote', secure: false },
        ];

        let currentFilter = 'all';

        // ===============================
        // TAB SWITCHING
        // ===============================
        function switchTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');

            if (tabId === 'quiz' && !quizStarted) {
                startQuiz();
            }
            if (tabId === 'game' && !gameStarted) {
                initGame();
            }
        }

        // ===============================
        // PORT EXPLORER
        // ===============================
        function renderPorts() {
            const grid = document.getElementById('portGrid');
            const searchTerm = document.getElementById('portSearch').value.toLowerCase();

            let filteredPorts = portDatabase.filter(port => {
                const matchesSearch =
                    port.port.toString().includes(searchTerm) ||
                    port.name.toLowerCase().includes(searchTerm) ||
                    port.description.toLowerCase().includes(searchTerm);

                let matchesFilter = true;
                if (currentFilter === 'tcp') matchesFilter = port.protocol === 'tcp';
                else if (currentFilter === 'udp') matchesFilter = port.protocol === 'udp';
                else if (currentFilter === 'secure') matchesFilter = port.secure === true;
                else if (currentFilter === 'insecure') matchesFilter = port.secure === false;

                return matchesSearch && matchesFilter;
            });

            grid.innerHTML = filteredPorts.map(port => `
                <div class="port-card ${port.protocol}">
                    <div class="port-header">
                        <div class="port-number">${port.port}</div>
                        <span class="protocol-badge ${port.protocol}">${port.protocol.toUpperCase()}</span>
                    </div>
                    <div class="port-name">${port.name}</div>
                    <div class="port-description">${port.description}</div>
                    <div class="port-tags">
                        <span class="port-tag">${port.category}</span>
                        <span class="security-badge ${port.secure ? 'secure' : 'insecure'}">
                            ${port.secure ? 'üîí Secure' : '‚ö†Ô∏è Insecure'}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        function filterPorts() {
            renderPorts();
        }

        function setFilter(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.filter === filter);
            });
            renderPorts();
        }

        // ===============================
        // TCP vs UDP DEMO
        // ===============================
        let animationRunning = false;

        function runTCPDemo() {
            if (animationRunning) return;
            animationRunning = true;

            const tcpPacket = document.getElementById('tcpPacket');
            const ackPacket = document.getElementById('ackPacket');
            const status = document.getElementById('animationStatus');

            // Reset
            tcpPacket.style.display = 'flex';
            tcpPacket.style.left = '0%';
            ackPacket.style.display = 'none';

            // Step 1: SYN
            status.innerHTML = '1Ô∏è‚É£ <strong>SYN</strong> - Client initiates connection...';
            tcpPacket.textContent = 'SYN';

            setTimeout(() => {
                tcpPacket.style.left = '90%';
            }, 100);

            setTimeout(() => {
                // Step 2: SYN-ACK
                status.innerHTML = '2Ô∏è‚É£ <strong>SYN-ACK</strong> - Server acknowledges...';
                ackPacket.style.display = 'flex';
                ackPacket.textContent = 'SYN-ACK';
                ackPacket.style.left = '90%';

                setTimeout(() => {
                    ackPacket.style.left = '0%';
                }, 100);
            }, 1000);

            setTimeout(() => {
                // Step 3: ACK
                status.innerHTML = '3Ô∏è‚É£ <strong>ACK</strong> - Client confirms, connection established!';
                tcpPacket.textContent = 'ACK';
                tcpPacket.style.left = '0%';

                setTimeout(() => {
                    tcpPacket.style.left = '90%';
                }, 100);
            }, 2000);

            setTimeout(() => {
                // Step 4: Data
                status.innerHTML = '4Ô∏è‚É£ <strong>DATA</strong> - Sending data with acknowledgments...';
                tcpPacket.textContent = 'DATA';
            }, 3000);

            setTimeout(() => {
                status.innerHTML = '‚úÖ TCP: Connection established, data delivered reliably!';
                tcpPacket.style.display = 'none';
                ackPacket.style.display = 'none';
                animationRunning = false;
            }, 4000);
        }

        function runUDPDemo() {
            if (animationRunning) return;
            animationRunning = true;

            const udpPacket = document.getElementById('udpPacket');
            const status = document.getElementById('animationStatus');

            // Reset
            udpPacket.style.display = 'flex';
            udpPacket.style.left = '0%';

            status.innerHTML = 'üì§ UDP: Sending packet 1...';

            setTimeout(() => {
                udpPacket.style.left = '90%';
            }, 100);

            setTimeout(() => {
                udpPacket.style.left = '0%';
                udpPacket.textContent = 'PKT2';
                status.innerHTML = 'üì§ UDP: Sending packet 2...';
            }, 600);

            setTimeout(() => {
                udpPacket.style.left = '90%';
            }, 700);

            setTimeout(() => {
                udpPacket.style.left = '0%';
                udpPacket.textContent = 'PKT3';
                status.innerHTML = 'üì§ UDP: Sending packet 3...';
            }, 1200);

            setTimeout(() => {
                udpPacket.style.left = '90%';
            }, 1300);

            setTimeout(() => {
                status.innerHTML = '‚úÖ UDP: All packets sent! (No confirmation if received)';
                udpPacket.style.display = 'none';
                animationRunning = false;
            }, 2000);
        }

        // ===============================
        // PORT SCANNER SIMULATOR
        // ===============================
        const serverProfiles = {
            webserver: { 22: 'open', 80: 'open', 443: 'open', 3306: 'filtered' },
            mailserver: { 22: 'open', 25: 'open', 110: 'open', 143: 'open', 587: 'open', 993: 'open', 995: 'open' },
            database: { 22: 'open', 1433: 'open', 3306: 'open', 5432: 'open' },
            workstation: { 135: 'open', 139: 'open', 445: 'open', 3389: 'open' },
            firewall: { 22: 'filtered', 80: 'filtered', 443: 'filtered' }
        };

        const scanPorts = {
            common: [21, 22, 23, 25, 53, 80, 110, 135, 139, 143, 443, 445, 993, 995, 1433, 3306, 3389, 5432, 8080],
            web: [80, 443, 8080, 8443],
            email: [25, 110, 143, 465, 587, 993, 995],
            database: [1433, 1521, 3306, 5432, 27017],
            full: Array.from({length: 1024}, (_, i) => i + 1)
        };

        function runScan() {
            const profile = document.getElementById('serverProfile').value;
            const scanType = document.getElementById('scanType').value;
            const resultsDiv = document.getElementById('scanResults');
            const portsToScan = scanPorts[scanType];
            const serverConfig = serverProfiles[profile];

            resultsDiv.innerHTML = '<p style="color: #22d3ee;">Scanning...</p>';

            setTimeout(() => {
                let html = '';
                portsToScan.forEach(port => {
                    const portInfo = portDatabase.find(p => p.port === port);
                    let status = serverConfig[port] || 'closed';

                    // Some randomization for realism
                    if (status === 'closed' && Math.random() < 0.1) status = 'filtered';

                    if (status !== 'closed' || scanType !== 'full') {
                        html += `
                            <div class="port-result">
                                <div>
                                    <span class="port-num">${port}</span>
                                    <span class="service">${portInfo ? portInfo.name : 'Unknown'}</span>
                                </div>
                                <span class="port-status ${status}">${status.toUpperCase()}</span>
                            </div>
                        `;
                    }
                });

                if (!html) {
                    html = '<p style="color: #94a3b8; text-align: center;">All scanned ports are closed.</p>';
                }

                resultsDiv.innerHTML = html;
            }, 1500);
        }

        // ===============================
        // MATCHING GAME
        // ===============================
        let gameStarted = false;
        let gameScore = 0;
        let gameMatches = 0;
        let gameTimer = 0;
        let gameInterval = null;
        let selectedPort = null;
        let selectedService = null;
        let gamePairs = [];

        const gameData = [
            { port: '22', service: 'SSH' },
            { port: '80', service: 'HTTP' },
            { port: '443', service: 'HTTPS' },
            { port: '53', service: 'DNS' },
            { port: '25', service: 'SMTP' },
            { port: '110', service: 'POP3' },
            { port: '143', service: 'IMAP' },
            { port: '3389', service: 'RDP' },
            { port: '21', service: 'FTP' },
            { port: '23', service: 'Telnet' }
        ];

        function initGame() {
            gameStarted = true;
            startGame();
        }

        function startGame() {
            gameScore = 0;
            gameMatches = 0;
            gameTimer = 0;
            selectedPort = null;
            selectedService = null;

            if (gameInterval) clearInterval(gameInterval);
            gameInterval = setInterval(() => {
                gameTimer++;
                document.getElementById('gameTime').textContent =
                    `${Math.floor(gameTimer / 60)}:${(gameTimer % 60).toString().padStart(2, '0')}`;
            }, 1000);

            updateGameStats();

            // Shuffle and display
            const shuffledPorts = [...gameData].sort(() => Math.random() - 0.5);
            const shuffledServices = [...gameData].sort(() => Math.random() - 0.5);

            document.getElementById('portColumn').innerHTML = shuffledPorts.map(item => `
                <div class="match-item" data-port="${item.port}" onclick="selectPort('${item.port}')">
                    Port ${item.port}
                </div>
            `).join('');

            document.getElementById('serviceColumn').innerHTML = shuffledServices.map(item => `
                <div class="match-item" data-service="${item.service}" onclick="selectService('${item.service}')">
                    ${item.service}
                </div>
            `).join('');
        }

        function selectPort(port) {
            if (selectedPort === port) {
                selectedPort = null;
                document.querySelectorAll('[data-port]').forEach(el => el.classList.remove('selected'));
                return;
            }

            selectedPort = port;
            document.querySelectorAll('[data-port]').forEach(el => {
                el.classList.toggle('selected', el.dataset.port === port);
            });

            checkMatch();
        }

        function selectService(service) {
            if (selectedService === service) {
                selectedService = null;
                document.querySelectorAll('[data-service]').forEach(el => el.classList.remove('selected'));
                return;
            }

            selectedService = service;
            document.querySelectorAll('[data-service]').forEach(el => {
                el.classList.toggle('selected', el.dataset.service === service);
            });

            checkMatch();
        }

        function checkMatch() {
            if (!selectedPort || !selectedService) return;

            const correct = gameData.find(item => item.port === selectedPort && item.service === selectedService);

            const portEl = document.querySelector(`[data-port="${selectedPort}"]`);
            const serviceEl = document.querySelector(`[data-service="${selectedService}"]`);

            if (correct) {
                gameScore += 100;
                gameMatches++;
                portEl.classList.add('correct', 'matched');
                serviceEl.classList.add('correct', 'matched');

                if (gameMatches === 10) {
                    clearInterval(gameInterval);
                    setTimeout(() => {
                        alert(`üéâ Congratulations! You matched all ports!\nScore: ${gameScore}\nTime: ${Math.floor(gameTimer / 60)}:${(gameTimer % 60).toString().padStart(2, '0')}`);
                    }, 500);
                }
            } else {
                gameScore = Math.max(0, gameScore - 25);
                portEl.classList.add('incorrect');
                serviceEl.classList.add('incorrect');

                setTimeout(() => {
                    portEl.classList.remove('incorrect', 'selected');
                    serviceEl.classList.remove('incorrect', 'selected');
                }, 500);
            }

            selectedPort = null;
            selectedService = null;
            updateGameStats();
        }

        function updateGameStats() {
            document.getElementById('gameScore').textContent = gameScore;
            document.getElementById('gameMatches').textContent = `${gameMatches}/10`;
        }

        // ===============================
        // QUIZ
        // ===============================
        const quizQuestions = [
            {
                question: "What port does HTTPS use?",
                options: ["80", "443", "8080", "8443"],
                correct: 1,
                explanation: "HTTPS (HTTP Secure) uses port 443 for encrypted web traffic."
            },
            {
                question: "Which protocol is connectionless?",
                options: ["TCP", "UDP", "HTTP", "FTP"],
                correct: 1,
                explanation: "UDP is connectionless - it sends data without establishing a connection first."
            },
            {
                question: "What is the DHCP server port?",
                options: ["66", "67", "68", "69"],
                correct: 1,
                explanation: "DHCP server listens on port 67. Clients use port 68."
            },
            {
                question: "Which port is used for secure email submission?",
                options: ["25", "110", "587", "995"],
                correct: 2,
                explanation: "Port 587 is the modern SMTP submission port with STARTTLS encryption."
            },
            {
                question: "SSH is the secure replacement for which service?",
                options: ["FTP", "HTTP", "Telnet", "SMTP"],
                correct: 2,
                explanation: "SSH (port 22) replaced Telnet (port 23) for secure remote access."
            },
            {
                question: "DNS primarily uses which protocol?",
                options: ["TCP only", "UDP only", "Both (UDP for queries)", "Neither"],
                correct: 2,
                explanation: "DNS uses UDP for standard queries and TCP for zone transfers or large responses."
            },
            {
                question: "What port range is reserved for well-known services?",
                options: ["0-255", "0-1023", "1024-49151", "49152-65535"],
                correct: 1,
                explanation: "Well-known ports (0-1023) are reserved for system services and require elevated privileges."
            },
            {
                question: "Which port is commonly targeted by ransomware?",
                options: ["22 (SSH)", "80 (HTTP)", "445 (SMB)", "3306 (MySQL)"],
                correct: 2,
                explanation: "Port 445 (SMB) was exploited by WannaCry and other ransomware attacks."
            },
            {
                question: "What does a 'filtered' port state indicate?",
                options: ["Service is running", "Service is not running", "Firewall is blocking", "Port doesn't exist"],
                correct: 2,
                explanation: "Filtered means a firewall is blocking access - no response is received."
            },
            {
                question: "Which command shows listening ports on Windows?",
                options: ["ipconfig", "ping", "tracert", "netstat"],
                correct: 3,
                explanation: "netstat -an shows all connections and listening ports."
            }
        ];

        let quizStarted = false;
        let currentQuestion = 0;
        let quizScore = 0;
        let answered = false;

        function startQuiz() {
            quizStarted = true;
            currentQuestion = 0;
            quizScore = 0;
            document.getElementById('quizResults').style.display = 'none';
            showQuestion();
        }

        function showQuestion() {
            answered = false;
            const q = quizQuestions[currentQuestion];

            document.getElementById('quizCurrent').textContent = `Question ${currentQuestion + 1} of ${quizQuestions.length}`;
            document.getElementById('quizProgressBar').style.width = `${((currentQuestion + 1) / quizQuestions.length) * 100}%`;
            document.getElementById('quizScoreDisplay').textContent = `Score: ${quizScore}/${currentQuestion}`;

            let html = `
                <div class="quiz-question-container">
                    <div class="quiz-question">${q.question}</div>
                    <div class="quiz-options">
                        ${q.options.map((opt, i) => `
                            <div class="quiz-option" onclick="selectAnswer(${i})" data-index="${i}">
                                ${opt}
                            </div>
                        `).join('')}
                    </div>
                    <div class="quiz-feedback" id="quizFeedback"></div>
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="quiz-btn" id="nextBtn" onclick="nextQuestion()" disabled>
                            ${currentQuestion < quizQuestions.length - 1 ? 'Next Question' : 'See Results'}
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('quizQuestionArea').innerHTML = html;
        }

        function selectAnswer(index) {
            if (answered) return;
            answered = true;

            const q = quizQuestions[currentQuestion];
            const options = document.querySelectorAll('.quiz-option');

            options.forEach((opt, i) => {
                opt.classList.add('disabled');
                if (i === q.correct) {
                    opt.classList.add('correct');
                } else if (i === index && i !== q.correct) {
                    opt.classList.add('incorrect');
                }
            });

            const feedback = document.getElementById('quizFeedback');
            if (index === q.correct) {
                quizScore++;
                feedback.className = 'quiz-feedback show correct';
                feedback.innerHTML = `<strong>Correct!</strong> ${q.explanation}`;
            } else {
                feedback.className = 'quiz-feedback show incorrect';
                feedback.innerHTML = `<strong>Incorrect.</strong> ${q.explanation}`;
            }

            document.getElementById('nextBtn').disabled = false;
        }

        function nextQuestion() {
            currentQuestion++;
            if (currentQuestion < quizQuestions.length) {
                showQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            document.getElementById('quizQuestionArea').innerHTML = '';
            document.getElementById('quizResults').style.display = 'block';

            const percentage = (quizScore / quizQuestions.length) * 100;
            const scoreEl = document.getElementById('finalScore');
            scoreEl.textContent = `${quizScore}/${quizQuestions.length}`;

            if (percentage >= 80) {
                scoreEl.className = 'quiz-score excellent';
                document.getElementById('scoreMessage').textContent = 'Excellent! You have a strong understanding of ports and protocols!';
            } else if (percentage >= 60) {
                scoreEl.className = 'quiz-score good';
                document.getElementById('scoreMessage').textContent = 'Good job! Review the topics you missed and try again.';
            } else {
                scoreEl.className = 'quiz-score needs-work';
                document.getElementById('scoreMessage').textContent = 'Keep studying! Review the presentation and Port Explorer to strengthen your understanding.';
            }
        }

        function restartQuiz() {
            startQuiz();
        }

        // ===============================
        // INITIALIZATION
        // ===============================
        document.addEventListener('DOMContentLoaded', function() {
            renderPorts();
        });
    </script>
</body>
</html>
