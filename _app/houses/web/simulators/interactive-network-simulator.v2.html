<!DOCTYPE html>
<!-- saved from url=(0113)file://wsl.localhost/Ubuntu/home/eq/Ai%20content%20creation/network-essentials/interactive-network-simulator.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Admin Learning Lab - Interactive Training</title>
    <style>
        /* ========== GLOBAL STYLES ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --accent-cyan: #06b6d4;
            --accent-teal: #14b8a6;
            --accent-purple: #9333ea;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --border: #475569;
        }

        /* ========== FULLSCREEN MODAL OVERLAY ========== */
        .fullscreen-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }

        .fullscreen-overlay.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 20px;
        }

        .fullscreen-content {
            background: var(--bg-secondary);
            border: 2px solid var(--accent-cyan);
            border-radius: 12px;
            padding: 30px;
            max-width: 1400px;
            width: 100%;
            margin: auto;
            box-shadow: 0 0 50px rgba(6, 182, 212, 0.5);
            position: relative;
        }

        .fullscreen-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--error);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10000;
        }

        .fullscreen-close:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .fullscreen-toggle {
            background: var(--accent-purple);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            margin-left: 10px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .fullscreen-toggle:hover {
            background: #7c3aed;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(147, 51, 234, 0.4);
        }

        .fullscreen-toggle::before {
            content: "⛶";
            font-size: 1.2em;
        }

        /* Scroll animation for visibility */
        .scroll-into-view {
            scroll-margin-top: 100px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ========== MODULE MANAGER ========== */
        .module-manager-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }

        .module-manager-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .module-manager {
            background: var(--bg-secondary);
            border: 2px solid var(--accent-purple);
            border-radius: 12px;
            padding: 30px;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 0 50px rgba(147, 51, 234, 0.5);
            position: relative;
        }

        .module-manager h2 {
            color: var(--accent-purple);
            margin-bottom: 20px;
            text-align: center;
        }

        .upload-area {
            border: 3px dashed var(--accent-purple);
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            background: rgba(147, 51, 234, 0.1);
            border-color: var(--accent-cyan);
        }

        .upload-area.dragover {
            background: rgba(147, 51, 234, 0.2);
            border-color: var(--success);
        }

        .upload-icon {
            font-size: 3em;
            margin-bottom: 10px;
            color: var(--accent-purple);
        }

        .module-list {
            margin-top: 30px;
            max-height: 400px;
            overflow-y: auto;
        }

        .module-item {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .module-item:hover {
            border-color: var(--accent-cyan);
        }

        .module-info h4 {
            color: var(--accent-cyan);
            margin-bottom: 5px;
        }

        .module-info p {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .module-actions {
            display: flex;
            gap: 10px;
        }

        .module-delete {
            background: var(--error);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .module-delete:hover {
            background: #dc2626;
            transform: scale(1.05);
        }

        .module-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }

        .module-status.loaded {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .module-status.error {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
            border: 1px solid var(--error);
        }

        .module-template {
            background: var(--bg-primary);
            border: 2px solid var(--accent-teal);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .module-template h3 {
            color: var(--accent-teal);
            margin-bottom: 15px;
        }

        .module-template pre {
            background: #1a1a2e;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 0.85em;
            color: var(--text-primary);
        }

        /* ========== DEVICE CONFIGURATION MODAL ========== */
        .device-config-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .device-config-modal.active {
            display: flex;
        }

        .device-config-content {
            background: var(--bg-secondary);
            border: 2px solid var(--accent-cyan);
            border-radius: 12px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            position: relative;
        }

        .device-config-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .device-config-header h2 {
            color: var(--accent-cyan);
            margin: 0;
            font-size: 1.8em;
        }

        .device-icon-large {
            font-size: 3em;
            margin-right: 15px;
        }

        .config-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }

        .config-tab {
            padding: 10px 20px;
            background: var(--bg-tertiary);
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            color: var(--text-secondary);
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .config-tab:hover {
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .config-tab.active {
            background: var(--accent-cyan);
            color: var(--bg-primary);
        }

        .config-section {
            display: none;
        }

        .config-section.active {
            display: block;
        }

        .config-form-group {
            margin-bottom: 20px;
        }

        .config-form-group label {
            display: block;
            color: var(--accent-cyan);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .config-form-group input,
        .config-form-group select {
            width: 100%;
            padding: 10px;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 1em;
        }

        .config-form-group input:focus,
        .config-form-group select:focus {
            outline: none;
            border-color: var(--accent-cyan);
        }

        .interface-list {
            display: grid;
            gap: 15px;
        }

        .interface-item {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 15px;
        }

        .interface-item.active {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }

        .interface-item.inactive {
            border-color: var(--error);
            background: rgba(239, 68, 68, 0.1);
        }

        .interface-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .interface-name {
            font-weight: 700;
            color: var(--accent-cyan);
            font-size: 1.1em;
        }

        .interface-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .interface-status.up {
            background: var(--success);
            color: white;
        }

        .interface-status.down {
            background: var(--error);
            color: white;
        }

        .cli-terminal {
            background: #000;
            border: 2px solid var(--accent-cyan);
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            color: #0f0;
            min-height: 300px;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .cli-output {
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .cli-input-line {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        .cli-prompt {
            color: #0ff;
            margin-right: 8px;
            font-weight: bold;
        }

        .cli-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            outline: none;
        }

        .config-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid var(--border);
        }

        .device-label-on-canvas {
            font-size: 10px;
            color: #10b981;
            font-weight: 600;
        }

        /* ========== CABLE SELECTION ========== */
        .cable-selector {
            display: flex;
            gap: 10px;
            align-items: center;
            padding: 15px;
            background: var(--bg-primary);
            border-radius: 8px;
            border: 2px solid var(--border);
            margin-bottom: 15px;
        }

        .cable-type-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 20px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .cable-type-option:hover {
            background: var(--bg-primary);
            border-color: var(--accent-cyan);
        }

        .cable-type-option.selected {
            background: var(--accent-cyan);
            border-color: var(--accent-cyan);
            color: var(--bg-primary);
        }

        .cable-type-icon {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .cable-type-label {
            font-size: 0.85em;
            font-weight: 600;
            text-align: center;
        }

        .connection-info {
            background: var(--bg-tertiary);
            padding: 10px 15px;
            border-radius: 6px;
            border-left: 4px solid var(--accent-cyan);
            margin-top: 10px;
            font-size: 0.9em;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, #1a2744 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        /* ========== HEADER ========== */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 2px solid var(--accent-cyan);
            box-shadow: 0 0 30px rgba(6, 182, 212, 0.3);
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1em;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            margin-top: 15px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-teal));
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        /* ========== NAVIGATION TABS ========== */
        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .tab {
            padding: 12px 24px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .tab:hover {
            background: var(--bg-primary);
            border-color: var(--accent-cyan);
            color: var(--text-primary);
        }

        .tab.active {
            background: var(--accent-cyan);
            border-color: var(--accent-cyan);
            color: var(--bg-primary);
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.5);
        }

        /* ========== CONTENT SECTIONS ========== */
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .panel {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .panel h2 {
            color: var(--accent-cyan);
            margin-bottom: 15px;
            font-size: 1.8em;
            border-bottom: 2px solid var(--accent-teal);
            padding-bottom: 10px;
        }

        .panel h3 {
            color: var(--accent-teal);
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        /* ========== OSI MODEL VISUALIZATION ========== */
        .osi-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }

        .osi-layer {
            padding: 20px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .osi-layer:hover {
            transform: translateX(10px);
            border-color: var(--accent-cyan);
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.3);
        }

        .osi-layer.active {
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-teal));
            color: var(--bg-primary);
            border-color: var(--accent-teal);
        }

        .osi-layer-number {
            font-size: 2em;
            font-weight: bold;
            opacity: 0.3;
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }

        .osi-layer-name {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .osi-details-panel {
            margin: 10px 0 !important;
            animation: slideDown 0.3s ease;
            display: block !important;
            width: 100% !important;
            position: relative !important;
            overflow: visible !important;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .osi-details {
            background: #1e293b !important;
            padding: 20px !important;
            border: 3px solid #06b6d4 !important;
            border-radius: 8px !important;
            margin: 10px 0 !important;
            min-height: 300px !important;
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.5) !important;
            display: block !important;
            width: 100% !important;
            position: relative !important;
            z-index: 10 !important;
        }

        .osi-details h4 {
            color: #06b6d4 !important;
            margin-top: 15px;
            margin-bottom: 10px;
            font-size: 1.1em;
            font-weight: bold;
        }

        .osi-details h3 {
            color: #14b8a6 !important;
            margin-top: 30px;
            font-size: 1.3em;
            font-weight: bold;
        }

        .osi-details p {
            color: #cbd5e1 !important;
            line-height: 1.6;
            font-size: 1em;
            margin: 10px 0;
        }

        .osi-details ul {
            color: #cbd5e1 !important;
        }

        .osi-details ul li {
            color: #cbd5e1 !important;
            margin: 5px 0;
        }

        .osi-layer-description {
            font-size: 0.9em;
            opacity: 0.8;
        }


        .protocol-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .protocol-badge {
            padding: 5px 12px;
            background: var(--accent-teal);
            color: var(--bg-primary);
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .packet-animation {
            height: 60px;
            background: var(--bg-primary);
            border-radius: 8px;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
            border: 2px solid var(--border);
        }

        .packet {
            width: 50px;
            height: 50px;
            background: var(--accent-cyan);
            position: absolute;
            top: 5px;
            left: -60px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--bg-primary);
            box-shadow: 0 0 20px var(--accent-cyan);
        }

        .packet.animating {
            animation: packetFlow 3s ease-in-out;
        }

        @keyframes packetFlow {
            0% {
                left: -60px;
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
            10% {
                left: 5%;
                transform: scale(1.1) rotate(10deg);
            }
            20% {
                left: 20%;
                transform: scale(0.9) rotate(-5deg);
            }
            30% {
                left: 35%;
                transform: scale(1.2) rotate(5deg);
            }
            40% {
                left: 50%;
                transform: scale(1) rotate(-10deg);
            }
            50% {
                left: 65%;
                transform: scale(1.1) rotate(8deg);
            }
            60% {
                left: 75%;
                transform: scale(0.95) rotate(-3deg);
            }
            70% {
                left: 85%;
                transform: scale(1.05) rotate(5deg);
            }
            80% {
                left: 95%;
                transform: scale(1) rotate(0deg);
            }
            90% {
                left: calc(100% + 10px);
                opacity: 1;
            }
            100% {
                left: calc(100% + 60px);
                opacity: 0;
                transform: scale(0.8) rotate(0deg);
            }
        }

        /* ========== OSI DUAL FLOW VISUALIZATION ========== */
        .osi-dual-flow-container {
            display: grid;
            grid-template-columns: 1fr 100px 1fr;
            gap: 20px;
            margin-top: 20px;
            padding: 20px;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 12px;
        }

        .flow-column {
            position: relative;
        }

        .osi-flow-stack {
            position: relative;
            min-height: 500px;
        }

        .osi-flow-layer {
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.4s ease;
            cursor: pointer;
        }

        .osi-flow-layer:hover {
            border-color: var(--accent-cyan);
            transform: translateX(5px);
        }

        .osi-flow-layer.active {
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-teal));
            border-color: var(--accent-teal);
            transform: scale(1.08);
            box-shadow: 0 0 25px rgba(6, 182, 212, 0.6);
        }

        .osi-flow-layer.processing {
            background: var(--warning);
            border-color: var(--warning);
            animation: pulse 0.5s ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .layer-label {
            font-weight: bold;
            color: var(--text-primary);
            font-size: 0.95em;
            flex: 1;
        }

        .layer-action {
            color: var(--text-secondary);
            font-size: 0.85em;
            font-style: italic;
            text-align: right;
            flex: 1;
        }

        .osi-flow-layer.active .layer-label,
        .osi-flow-layer.active .layer-action {
            color: var(--bg-primary);
            font-weight: bold;
        }

        .flow-packet {
            position: absolute;
            top: -60px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent-cyan);
            border: 3px solid var(--accent-teal);
            border-radius: 8px;
            padding: 8px 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 30px rgba(6, 182, 212, 0.8);
            opacity: 0;
            transition: all 0.6s ease;
            z-index: 100;
            min-width: 120px;
        }

        .flow-packet.visible {
            opacity: 1;
        }

        .packet-label {
            font-size: 0.75em;
            font-weight: bold;
            color: var(--bg-primary);
            text-align: center;
            white-space: nowrap;
        }

        .transmission-line {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .transmission-arrow {
            font-size: 3em;
            color: var(--accent-teal);
            animation: arrowPulse 2s ease-in-out infinite;
        }

        .transmission-arrow.transmitting {
            animation: arrowTransmit 1s ease-in-out;
        }

        @keyframes arrowPulse {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        @keyframes arrowTransmit {
            0%, 100% { color: var(--accent-teal); }
            50% { color: var(--success); transform: scale(1.3); }
        }

        .transmission-label {
            color: var(--text-secondary);
            font-size: 0.9em;
            text-align: center;
            margin-top: 10px;
            writing-mode: vertical-rl;
            text-orientation: mixed;
        }

        .animation-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
            margin-top: 25px;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 8px;
            flex-wrap: wrap;
        }

        .speed-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn-small {
            padding: 8px 15px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .btn-small:hover {
            background: var(--accent-cyan);
            border-color: var(--accent-cyan);
            color: var(--bg-primary);
        }

        .btn-small.active {
            background: var(--accent-teal);
            border-color: var(--accent-teal);
            color: var(--bg-primary);
        }

        @media (max-width: 1024px) {
            .osi-dual-flow-container {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .transmission-line {
                display: none;
            }
        }

        /* ========== NAT/PAT VISUALIZATION ========== */
        .nat-intro {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--accent-cyan);
            margin: 20px 0;
        }

        .nat-types-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .nat-type-card {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }

        .nat-type-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-cyan);
            box-shadow: 0 5px 20px rgba(6, 182, 212, 0.3);
        }

        .nat-example {
            background: var(--bg-primary);
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            text-align: center;
            color: var(--accent-cyan);
            margin: 15px 0;
            border: 1px solid var(--border);
        }

        .nat-visualization-container {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 30px;
            margin: 30px 0;
            padding: 30px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            border: 2px solid var(--border);
        }

        .nat-side {
            min-width: 250px;
        }

        .nat-device-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .nat-device {
            background: var(--bg-primary);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nat-device:hover {
            border-color: var(--accent-cyan);
            transform: translateX(5px);
        }

        .nat-device.active {
            border-color: var(--success);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(6, 182, 212, 0.1));
            animation: pulse 1s ease-in-out infinite;
        }

        .device-icon {
            font-size: 2em;
        }

        .device-info {
            flex: 1;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .nat-router {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px 20px;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-teal));
            border-radius: 12px;
            color: var(--bg-primary);
            min-width: 150px;
            position: relative;
        }

        .router-icon {
            font-size: 4em;
            margin-bottom: 10px;
        }

        .router-label {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .public-ip {
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 10px 15px;
            border-radius: 6px;
            text-align: center;
            font-size: 0.9em;
            font-family: 'Courier New', monospace;
        }

        .nat-table-container {
            margin: 30px 0;
            overflow-x: auto;
        }

        .nat-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-tertiary);
            border-radius: 8px;
            overflow: hidden;
        }

        .nat-table thead {
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-teal));
        }

        .nat-table th {
            padding: 15px;
            text-align: left;
            color: var(--bg-primary);
            font-weight: bold;
        }

        .nat-table td {
            padding: 12px 15px;
            border-top: 1px solid var(--border);
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
        }

        .nat-table tbody tr:hover {
            background: var(--bg-primary);
        }

        .nat-table .status-active {
            color: var(--success);
            font-weight: bold;
        }

        .nat-table .status-timeout {
            color: var(--warning);
        }

        .nat-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }

        .nat-status {
            text-align: center;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-size: 1.1em;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nat-status.active {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 2px solid var(--success);
        }

        .nat-explanation {
            background: var(--bg-tertiary);
            padding: 25px;
            border-radius: 8px;
            border-left: 4px solid var(--accent-teal);
        }

        .nat-quiz-section {
            background: var(--bg-tertiary);
            padding: 25px;
            border-radius: 8px;
        }

        .quiz-question {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        @media (max-width: 1024px) {
            .nat-visualization-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .nat-router {
                order: -1;
            }
        }

        .nat-entry {
            opacity: 0;
            transform: translateX(-20px);
            transition: all 0.5s ease;
        }

        .status-badge {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            display: inline-block;
        }

        /* ========== DHCP ========== */
        .dhcp-intro {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid var(--accent-cyan);
        }

        .dhcp-benefits {
            margin-top: 15px;
        }

        .dhcp-benefits ul {
            list-style: none;
            padding-left: 0;
        }

        .dhcp-benefits li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .dhcp-benefits li::before {
            content: "✓";
            position: absolute;
            left: 0;
            color: var(--success);
            font-weight: bold;
        }

        .dora-steps-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        @media (max-width: 1024px) {
            .dora-steps-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .dora-steps-grid {
                grid-template-columns: 1fr;
            }
        }

        .dora-step-card {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }

        .dora-step-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-cyan);
            box-shadow: 0 5px 20px rgba(52, 152, 219, 0.3);
        }

        .dora-step-number {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            margin: 0 auto 15px;
        }

        .dora-step-card h4 {
            color: var(--accent-cyan);
            margin: 10px 0;
            font-size: 1.3em;
        }

        .tech-detail {
            font-size: 0.85em;
            color: var(--text-muted);
            font-style: italic;
            margin-top: 10px;
        }

        .dhcp-visualization-container {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            align-items: center;
            margin: 30px 0;
            min-height: 250px;
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 12px;
            border: 2px solid var(--border);
            position: relative;
        }

        @media (max-width: 768px) {
            .dhcp-visualization-container {
                grid-template-columns: 1fr;
                gap: 30px;
            }
        }

        .dhcp-client, .dhcp-server {
            text-align: center;
            padding: 20px;
            background: var(--bg-primary);
            border-radius: 8px;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }

        .dhcp-client.active, .dhcp-server.active {
            border-color: var(--accent-cyan);
            box-shadow: 0 0 20px rgba(52, 152, 219, 0.5);
            transform: scale(1.05);
        }

        .device-icon-large {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .device-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .device-status {
            font-size: 0.9em;
            color: var(--text-muted);
            padding: 5px 10px;
            background: var(--bg-secondary);
            border-radius: 4px;
            margin-top: 10px;
        }

        .dhcp-network-space {
            position: relative;
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dhcp-packet {
            position: absolute;
            left: 10%;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            font-weight: 600;
            opacity: 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.8s ease;
        }

        .dhcp-packet.animate-to-server {
            left: 80%;
            opacity: 1;
        }

        .dhcp-packet.animate-to-client {
            left: 10%;
            opacity: 1;
        }

        .packet-type {
            font-size: 1.1em;
        }

        .dhcp-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }

        .dhcp-details-panel {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid var(--success);
        }

        .step-details-content {
            color: var(--text-primary);
            line-height: 1.6;
        }

        .dhcp-lease-table {
            overflow-x: auto;
            margin: 20px 0;
        }

        #dhcpLeaseTable {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-secondary);
            border-radius: 8px;
            overflow: hidden;
        }

        #dhcpLeaseTable thead {
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
        }

        #dhcpLeaseTable th {
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        #dhcpLeaseTable td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border);
            color: var(--text-primary);
        }

        #dhcpLeaseTable tbody tr {
            transition: background 0.3s ease;
        }

        #dhcpLeaseTable tbody tr:hover {
            background: rgba(52, 152, 219, 0.1);
        }

        .dhcp-lease-entry {
            opacity: 0;
            transform: translateX(-20px);
            transition: all 0.5s ease;
        }

        .lease-status-active {
            color: var(--success);
            font-weight: 600;
        }

        .lease-status-expired {
            color: var(--danger);
            font-weight: 600;
        }

        /* ========== OSPF ========== */
        .ospf-intro {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid var(--accent-purple);
        }

        .ospf-benefits ul {
            list-style: none;
            padding-left: 0;
        }

        .ospf-benefits li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .ospf-benefits li::before {
            content: "→";
            position: absolute;
            left: 0;
            color: var(--accent-purple);
            font-weight: bold;
        }

        .ospf-phases-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        @media (max-width: 1024px) {
            .ospf-phases-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .ospf-phases-grid {
                grid-template-columns: 1fr;
            }
        }

        .ospf-phase-card {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }

        .ospf-phase-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-purple);
            box-shadow: 0 5px 20px rgba(155, 89, 182, 0.3);
        }

        .ospf-phase-number {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent-purple), #8e44ad);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            margin: 0 auto 15px;
        }

        .ospf-phase-card h4 {
            color: var(--accent-purple);
            margin: 10px 0;
            font-size: 1.3em;
        }

        .ospf-topology-container {
            margin: 30px 0;
        }

        .ospf-router {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ospf-router.active {
            filter: drop-shadow(0 0 15px rgba(52, 152, 219, 0.8));
            fill: #e74c3c;
        }

        .ospf-router.neighbor {
            filter: drop-shadow(0 0 10px rgba(46, 204, 113, 0.6));
        }

        .ospf-link {
            transition: all 0.3s ease;
        }

        .ospf-link.active {
            stroke: #e74c3c;
            stroke-width: 6;
            filter: drop-shadow(0 0 8px rgba(231, 76, 60, 0.8));
        }

        .ospf-link.shortest-path {
            stroke: #2ecc71;
            stroke-width: 6;
            filter: drop-shadow(0 0 8px rgba(46, 204, 113, 0.8));
        }

        .ospf-packet {
            transition: all 0.3s ease;
        }

        .ospf-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .ospf-details-panel {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid var(--accent-purple);
        }

        .ospf-tables-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        @media (max-width: 900px) {
            .ospf-tables-grid {
                grid-template-columns: 1fr;
            }
        }

        .ospf-table-container {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 8px;
        }

        .ospf-table-container h4 {
            color: var(--accent-purple);
            margin-bottom: 10px;
        }

        .ospf-routing-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-primary);
            border-radius: 8px;
            overflow: hidden;
        }

        .ospf-routing-table thead {
            background: linear-gradient(135deg, var(--accent-purple), #8e44ad);
        }

        .ospf-routing-table th {
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9em;
        }

        .ospf-routing-table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border);
            color: var(--text-primary);
            font-size: 0.9em;
        }

        .ospf-routing-table tbody tr {
            transition: background 0.3s ease;
            opacity: 0;
            transform: translateX(-20px);
        }

        .ospf-routing-table tbody tr.visible {
            opacity: 1;
            transform: translateX(0);
        }

        .ospf-routing-table tbody tr:hover {
            background: rgba(155, 89, 182, 0.1);
        }

        /* ========== RIP ========== */
        .rip-intro {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #e74c3c;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: var(--bg-primary);
            border-radius: 8px;
            overflow: hidden;
        }

        .comparison-table thead {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .comparison-table th {
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .comparison-table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border);
            color: var(--text-primary);
        }

        .comparison-table tbody tr:hover {
            background: rgba(231, 76, 60, 0.1);
        }

        .rip-topology-container {
            margin: 30px 0;
        }

        .rip-router {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .rip-router.active {
            filter: drop-shadow(0 0 15px rgba(231, 76, 60, 0.8));
        }

        .rip-link {
            transition: all 0.3s ease;
        }

        .rip-link.bad-path {
            stroke: #e74c3c;
            stroke-width: 6;
            filter: drop-shadow(0 0 8px rgba(231, 76, 60, 0.8));
            animation: pulse-red 1.5s infinite;
        }

        @keyframes pulse-red {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .rip-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .rip-details-panel {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #e74c3c;
        }

        .rip-tables-grid {
            margin: 20px 0;
        }

        .rip-table-container {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 8px;
        }

        .rip-table-container h4 {
            color: #e74c3c;
            margin-bottom: 10px;
        }

        .rip-routing-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-primary);
            border-radius: 8px;
            overflow: hidden;
        }

        .rip-routing-table thead {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .rip-routing-table th {
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9em;
        }

        .rip-routing-table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border);
            color: var(--text-primary);
            font-size: 0.9em;
        }

        .rip-routing-table tbody tr {
            transition: all 0.5s ease;
            opacity: 0;
            transform: translateX(-20px);
        }

        .rip-routing-table tbody tr.visible {
            opacity: 1;
            transform: translateX(0);
        }

        .rip-routing-table tbody tr:hover {
            background: rgba(231, 76, 60, 0.1);
        }

        /* ========== STP ========== */
        .stp-intro {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #16a085;
        }

        .stp-states-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .stp-states-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .stp-state-card {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid;
        }

        .stp-state-card.blocking {
            background: rgba(231, 76, 60, 0.1);
            border-color: #e74c3c;
        }

        .stp-state-card.listening {
            background: rgba(241, 196, 15, 0.1);
            border-color: #f1c40f;
        }

        .stp-state-card.learning {
            background: rgba(243, 156, 18, 0.1);
            border-color: #f39c12;
        }

        .stp-state-card.forwarding {
            background: rgba(46, 204, 113, 0.1);
            border-color: #2ecc71;
        }

        .stp-switch {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .stp-switch.root {
            fill: #16a085 !important;
            filter: drop-shadow(0 0 20px rgba(22, 160, 133, 0.8));
        }

        .stp-link {
            transition: all 0.5s ease;
        }

        .stp-link.blocked {
            stroke: #e74c3c !important;
            stroke-dasharray: 10, 5;
        }

        .port-indicator {
            transition: all 0.3s ease;
        }

        .stp-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .stp-details-panel {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #16a085;
        }

        /* ========== VLANs ========== */
        .vlan-intro {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid var(--accent-purple);
        }

        .vlan-demo-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        @media (max-width: 900px) {
            .vlan-demo-grid {
                grid-template-columns: 1fr;
            }
        }

        .vlan-box {
            padding: 20px;
            border-radius: 8px;
            border: 3px solid;
            text-align: center;
        }

        .vlan-box.vlan-10 {
            background: rgba(52, 152, 219, 0.1);
            border-color: #3498db;
        }

        .vlan-box.vlan-20 {
            background: rgba(46, 204, 113, 0.1);
            border-color: #2ecc71;
        }

        .vlan-box.vlan-30 {
            background: rgba(231, 76, 60, 0.1);
            border-color: #e74c3c;
        }

        .vlan-switch-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .vlan-switch {
            background: var(--bg-secondary);
            border: 3px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            min-width: 400px;
        }

        .switch-label {
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .switch-ports {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .port {
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            font-size: 0.9em;
            border: 2px solid;
            transition: all 0.3s ease;
        }

        .port.vlan-10 {
            background: rgba(52, 152, 219, 0.2);
            border-color: #3498db;
        }

        .port.vlan-20 {
            background: rgba(46, 204, 113, 0.2);
            border-color: #2ecc71;
        }

        .port.vlan-30 {
            background: rgba(231, 76, 60, 0.2);
            border-color: #e74c3c;
        }

        .port.trunk {
            background: linear-gradient(135deg, rgba(52,152,219,0.3), rgba(46,204,113,0.3), rgba(231,76,60,0.3));
            border-color: var(--accent-purple);
            font-weight: bold;
        }

        .port.active {
            transform: scale(1.1);
            box-shadow: 0 0 20px currentColor;
        }

        .vlan-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .vlan-details-panel {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid var(--accent-purple);
        }

        .command-box {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .command-box pre {
            margin: 0;
            color: var(--text-primary);
            font-size: 0.9em;
        }

        .command-box code {
            color: #2ecc71;
        }

        /* ========== NETWORK ALGORITHMS ========== */
        .algo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .algo-card {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .algo-card:hover {
            border-color: var(--accent-cyan);
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.3);
        }

        .algo-card h4 {
            color: var(--accent-cyan);
            margin-bottom: 10px;
        }

        .algo-visualization {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            min-height: 400px;
        }

        .graph-container {
            position: relative;
            width: 100%;
            height: 400px;
            margin: 20px 0;
        }

        .algo-node {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--bg-secondary);
            border: 3px solid var(--accent-cyan);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--text-primary);
            transition: all 0.3s ease;
            z-index: 10;
        }

        .algo-node.visited {
            background: var(--success);
            border-color: var(--success);
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.6);
        }

        .algo-node.current {
            background: var(--warning);
            border-color: var(--warning);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.8);
            animation: pulse 1s infinite;
        }

        .algo-node.shortest-path {
            background: var(--accent-purple);
            border-color: var(--accent-purple);
            box-shadow: 0 0 15px rgba(147, 51, 234, 0.6);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .algo-edge {
            position: absolute;
            background: var(--border);
            transform-origin: left center;
            z-index: 1;
        }

        .algo-edge.active {
            background: var(--accent-cyan);
            box-shadow: 0 0 10px rgba(6, 182, 212, 0.6);
        }

        .algo-edge.shortest-path {
            background: var(--accent-purple);
            height: 4px;
            box-shadow: 0 0 10px rgba(147, 51, 234, 0.6);
        }

        .edge-weight {
            position: absolute;
            background: var(--bg-secondary);
            color: var(--warning);
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            border: 1px solid var(--border);
            z-index: 5;
        }

        .algo-steps {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .algo-step {
            padding: 10px;
            margin: 5px 0;
            background: var(--bg-secondary);
            border-left: 4px solid var(--accent-cyan);
            border-radius: 4px;
            font-family: monospace;
        }

        .algo-step.current {
            background: rgba(6, 182, 212, 0.2);
            border-left-color: var(--warning);
        }

        .algo-comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .algo-comparison-table th,
        .algo-comparison-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid var(--border);
        }

        .algo-comparison-table th {
            background: var(--bg-tertiary);
            color: var(--accent-cyan);
            font-weight: bold;
        }

        .algo-comparison-table tr:hover {
            background: rgba(6, 182, 212, 0.1);
        }

        .complexity-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .complexity-good {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .complexity-medium {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .complexity-bad {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
            border: 1px solid var(--error);
        }

        /* ========== AUTOMATION TOOLS (ANSIBLE/CHEF/PUPPET) ========== */
        .automation-intro {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.1), rgba(20, 184, 166, 0.1));
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--accent-cyan);
            margin: 20px 0;
        }

        .automation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .automation-card {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .automation-card:hover {
            border-color: var(--accent-cyan);
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.3);
            transform: translateY(-2px);
        }

        .automation-card h4 {
            color: var(--accent-cyan);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .automation-icon {
            font-size: 1.5em;
        }

        .playbook-editor {
            background: #1a1a2e;
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }

        .playbook-editor pre {
            margin: 0;
            color: #e0e0e0;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .yaml-key {
            color: #61dafb;
        }

        .yaml-value {
            color: #98c379;
        }

        .yaml-comment {
            color: #5c6370;
            font-style: italic;
        }

        .yaml-string {
            color: #e5c07b;
        }

        .execution-flow {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .flow-step {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 15px 20px;
            min-width: 120px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .flow-step.active {
            background: var(--accent-cyan);
            color: var(--bg-primary);
            border-color: var(--accent-cyan);
            box-shadow: 0 0 15px rgba(6, 182, 212, 0.6);
        }

        .flow-step.completed {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .flow-arrow {
            color: var(--accent-cyan);
            font-size: 1.5em;
            font-weight: bold;
        }

        .inventory-display {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .inventory-group {
            margin: 10px 0;
            padding: 10px;
            background: var(--bg-secondary);
            border-left: 3px solid var(--accent-teal);
            border-radius: 4px;
        }

        .inventory-group h5 {
            color: var(--accent-teal);
            margin-bottom: 8px;
        }

        .inventory-host {
            padding: 8px 12px;
            margin: 5px 0;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 4px;
            font-family: monospace;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .inventory-host.reachable {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }

        .inventory-host.unreachable {
            border-color: var(--error);
            background: rgba(239, 68, 68, 0.1);
        }

        .host-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .host-status.success {
            background: var(--success);
            color: white;
        }

        .host-status.failed {
            background: var(--error);
            color: white;
        }

        .module-showcase {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .module-card {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .module-card:hover {
            border-color: var(--accent-teal);
            transform: translateY(-2px);
        }

        .module-card h5 {
            color: var(--accent-teal);
            margin-bottom: 8px;
            font-size: 1em;
        }

        .module-example {
            background: #1a1a2e;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.85em;
            margin-top: 10px;
            color: #e0e0e0;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        @media (max-width: 1024px) {
            .comparison-grid {
                grid-template-columns: 1fr;
            }
        }

        .tool-card {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }

        .tool-card.ansible {
            border-color: #ee0000;
        }

        .tool-card.chef {
            border-color: #f09820;
        }

        .tool-card.puppet {
            border-color: #ffae1a;
        }

        .tool-logo {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .feature-list {
            text-align: left;
            margin-top: 15px;
        }

        .feature-item {
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .feature-item:last-child {
            border-bottom: none;
        }

        .pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .pros-cons {
                grid-template-columns: 1fr;
            }
        }

        .pros-box {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid var(--success);
            border-radius: 8px;
            padding: 15px;
        }

        .cons-box {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid var(--error);
            border-radius: 8px;
            padding: 15px;
        }

        /* ========== SUBNET CALCULATOR ========== */
        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .calculator-grid {
                grid-template-columns: 1fr;
            }
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--accent-teal);
            font-weight: 600;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--accent-cyan);
        }

        .btn {
            padding: 12px 24px;
            background: var(--accent-cyan);
            color: var(--bg-primary);
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        .btn:hover {
            background: var(--accent-teal);
            box-shadow: 0 0 20px rgba(20, 184, 166, 0.5);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-primary);
            border-color: var(--accent-cyan);
        }

        .results-panel {
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid var(--accent-teal);
            margin-top: 20px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 8px 0;
            background: var(--bg-tertiary);
            border-radius: 6px;
            border-left: 4px solid var(--accent-cyan);
        }

        .result-label {
            color: var(--accent-teal);
            font-weight: 600;
        }

        .result-value {
            color: var(--text-primary);
            font-family: 'Courier New', monospace;
        }

        .binary-display {
            font-family: 'Courier New', monospace;
            background: var(--bg-primary);
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            border: 1px solid var(--border);
            font-size: 0.9em;
        }

        /* ========== CLI SIMULATOR ========== */
        .cli-container {
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid var(--accent-cyan);
            box-shadow: 0 0 30px rgba(6, 182, 212, 0.3);
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
        }

        .cli-output {
            margin-bottom: 10px;
            white-space: pre-wrap;
            line-height: 1.4;
        }

        .cli-input-line {
            display: flex;
            align-items: center;
        }

        .cli-prompt {
            color: #0ff;
            margin-right: 5px;
        }

        .cli-input {
            background: transparent;
            border: none;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            outline: none;
            flex: 1;
        }

        .cli-cursor {
            display: inline-block;
            width: 8px;
            height: 16px;
            background: #0f0;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .cli-help {
            margin-top: 20px;
            padding: 15px;
            background: var(--bg-secondary);
            border-radius: 6px;
            border: 1px solid var(--border);
        }

        .cli-help h4 {
            color: var(--accent-cyan);
            margin-bottom: 10px;
        }

        .cli-help ul {
            list-style: none;
            padding-left: 0;
        }

        .cli-help li {
            padding: 5px 0;
            color: var(--text-secondary);
            font-family: 'Courier New', monospace;
        }

        .cli-help li code {
            color: var(--accent-teal);
            background: var(--bg-primary);
            padding: 2px 6px;
            border-radius: 3px;
        }

        /* ========== TCP HANDSHAKE ANIMATION ========== */
        .tcp-animation-container {
            background: var(--bg-primary);
            padding: 30px;
            border-radius: 8px;
            border: 2px solid var(--accent-teal);
            margin-top: 20px;
            position: relative;
            min-height: 400px;
        }

        .tcp-device {
            width: 120px;
            height: 120px;
            background: var(--bg-tertiary);
            border: 3px solid var(--accent-cyan);
            border-radius: 12px;
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .tcp-device.client {
            left: 50px;
            top: 50%;
            transform: translateY(-50%);
        }

        .tcp-device.server {
            right: 50px;
            top: 50%;
            transform: translateY(-50%);
        }

        .tcp-device-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .tcp-packet-visual {
            position: absolute;
            padding: 10px 15px;
            background: var(--accent-cyan);
            color: var(--bg-primary);
            border-radius: 6px;
            font-weight: bold;
            font-size: 0.9em;
            box-shadow: 0 0 20px var(--accent-cyan);
            opacity: 0;
        }

        .tcp-step-description {
            margin-top: 20px;
            padding: 15px;
            background: var(--bg-secondary);
            border-radius: 6px;
            border-left: 4px solid var(--accent-teal);
            min-height: 80px;
        }

        .tcp-controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }


        /* ========== DEVICE PROPERTIES PANEL ========== */
        .device-properties-panel {
            display: none;
            position: absolute;
            top: 20px;
            right: 20px;
            width: 300px;
            background: var(--bg-secondary);
            border: 2px solid var(--accent-purple);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 0 30px rgba(147, 51, 234, 0.5);
            z-index: 100;
        }

        .device-properties-panel.active {
            display: block;
        }

        .device-properties-panel h4 {
            color: var(--accent-purple);
            margin-bottom: 15px;
            text-align: center;
        }

        .properties-input-group {
            margin-bottom: 15px;
        }

        .properties-input-group label {
            display: block;
            color: var(--text-secondary);
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .properties-input-group input {
            width: 100%;
            padding: 8px;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 4px;
            color: var(--text-primary);
        }

        .properties-input-group input:focus {
            outline: none;
            border-color: var(--accent-cyan);
        }

        .btn-save {
            width: 100%;
            padding: 10px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-save:hover {
            background: #10b981;
            transform: scale(1.02);
        }


        /* ========== TOPOLOGY BUILDER ========== */
        .topology-container {
            background: var(--bg-primary);
            border: 2px solid var(--accent-cyan);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .topology-canvas-container {
            background: #1a2332;
            border: 2px solid var(--border);
            border-radius: 8px;
            position: relative;
            min-height: 500px;
            overflow: hidden;
        }

        .topology-canvas {
            width: 100%;
            height: 500px;
            cursor: crosshair;
        }

        .device-palette {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .device-icon {
            width: 80px;
            height: 80px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .device-icon:hover {
            background: var(--bg-secondary);
            border-color: var(--accent-cyan);
            transform: scale(1.1);
        }

        .device-icon.selected {
            border-color: var(--accent-cyan);
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.5);
        }

        .device-icon-symbol {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .device-icon-label {
            font-size: 0.8em;
            color: var(--text-secondary);
        }

        .topology-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        /* ========== QUIZ SECTION ========== */
        .quiz-container {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .quiz-question {
            font-size: 1.2em;
            color: var(--accent-cyan);
            margin-bottom: 20px;
            font-weight: 600;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quiz-option {
            padding: 15px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            background: var(--bg-primary);
            border-color: var(--accent-cyan);
            transform: translateX(5px);
        }

        .quiz-option.correct {
            background: var(--success);
            border-color: var(--success);
            color: var(--bg-primary);
        }

        .quiz-option.incorrect {
            background: var(--error);
            border-color: var(--error);
            color: var(--bg-primary);
        }

        .quiz-option.disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .quiz-feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
        }

        .quiz-feedback.correct {
            background: rgba(16, 185, 129, 0.2);
            border: 2px solid var(--success);
            color: var(--success);
        }

        .quiz-feedback.incorrect {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid var(--error);
            color: var(--error);
        }

        .quiz-score {
            margin-top: 20px;
            padding: 20px;
            background: var(--bg-primary);
            border-radius: 8px;
            border: 2px solid var(--accent-teal);
            text-align: center;
            font-size: 1.2em;
        }

        /* ========== CHEAT SHEET ========== */
        .cheat-sheet {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .cheat-card {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--accent-cyan);
        }

        .cheat-card h4 {
            color: var(--accent-teal);
            margin-bottom: 10px;
        }

        .cheat-card ul {
            list-style: none;
            padding-left: 0;
        }

        .cheat-card li {
            padding: 5px 0;
            font-family: 'Courier New', monospace;
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .cheat-card code {
            color: var(--accent-cyan);
            background: var(--bg-primary);
            padding: 2px 6px;
            border-radius: 3px;
        }

        /* ========== PACKET FLOW VISUALIZER ========== */
        .packet-flow-container {
            background: var(--bg-primary);
            padding: 30px;
            border-radius: 8px;
            border: 2px solid var(--accent-teal);
            margin-top: 20px;
            position: relative;
            min-height: 400px;
        }

        .network-node {
            width: 100px;
            height: 100px;
            background: var(--bg-tertiary);
            border: 3px solid var(--accent-cyan);
            border-radius: 50%;
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
        }

        .connection-line {
            position: absolute;
            height: 3px;
            background: var(--border);
            transform-origin: left center;
        }

        .packet-flow-visual {
            position: absolute;
            width: 30px;
            height: 30px;
            background: var(--accent-cyan);
            border-radius: 50%;
            box-shadow: 0 0 20px var(--accent-cyan);
        }

        /* ========== UTILITY CLASSES ========== */
        .text-center {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .hidden {
            display: none;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            color: var(--accent-cyan);
            border-bottom: 1px dotted var(--accent-cyan);
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            border: 2px solid var(--accent-cyan);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .mnemonic {
            background: var(--bg-primary);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid var(--accent-teal);
            margin: 20px 0;
            text-align: center;
            font-size: 1.1em;
            font-weight: 600;
            color: var(--accent-cyan);
        }

        .scrollbar-custom::-webkit-scrollbar {
            width: 10px;
        }

        .scrollbar-custom::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        .scrollbar-custom::-webkit-scrollbar-thumb {
            background: var(--accent-cyan);
            border-radius: 5px;
        }

        .scrollbar-custom::-webkit-scrollbar-thumb:hover {
            background: var(--accent-teal);
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <div class="header">
        <h1>Network Admin Learning Lab</h1>
        <p>Interactive Training for Junior Network Administrators - 3 Week Curriculum</p>
        <div class="progress-bar">
            <div class="progress-fill" id="overallProgress" style="width: 144.444%;"></div>
        </div>
    </div>
    <!-- Back to Catalog Button -->
    <a href="../../index.html" style="position: fixed; top: 20px; right: 20px; background: rgba(6, 182, 212, 0.9); color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: bold; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.3); transition: all 0.3s ease;"
       onmouseover="this.style.background='rgba(6, 182, 212, 1)'; this.style.transform='translateY(-2px)'"
       onmouseout="this.style.background='rgba(6, 182, 212, 0.9)'; this.style.transform='translateY(0)'">
        📁 Back to Catalog
    </a>

    <!-- NAVIGATION TABS -->
    <nav class="tabs" role="tablist" aria-label="Main navigation">
        <div class="tab" data-section="home" role="tab" aria-selected="false" aria-controls="home" tabindex="-1">Home</div>
        <div class="tab" data-section="osi-model" role="tab" aria-selected="false" aria-controls="osi-model" tabindex="-1">OSI Model</div>
        <div class="tab" data-section="subnet-calc" role="tab" aria-selected="false" aria-controls="subnet-calc" tabindex="-1">Subnet Calculator</div>
        <div class="tab" data-section="cli-sim" role="tab" aria-selected="false" aria-controls="cli-sim" tabindex="-1">CLI Simulator</div>
        <div class="tab" data-section="tcp-handshake" role="tab" aria-selected="false" aria-controls="tcp-handshake" tabindex="-1">TCP Handshake</div>
        <div class="tab" data-section="nat-pat" role="tab" aria-selected="false" aria-controls="nat-pat" tabindex="-1">NAT/PAT</div>
        <div class="tab" data-section="dhcp" role="tab" aria-selected="false" aria-controls="dhcp" tabindex="-1">DHCP</div>
        <div class="tab" data-section="ospf" role="tab" aria-selected="false" aria-controls="ospf" tabindex="-1">OSPF</div>
        <div class="tab" data-section="rip" role="tab" aria-selected="false" aria-controls="rip" tabindex="-1">RIP</div>
        <div class="tab" data-section="stp" role="tab" aria-selected="false" aria-controls="stp" tabindex="-1">STP</div>
        <div class="tab" data-section="vlans" role="tab" aria-selected="false" aria-controls="vlans" tabindex="-1">VLANs</div>
        <div class="tab" data-section="algorithms" role="tab" aria-selected="false" aria-controls="algorithms" tabindex="-1">Network Algorithms</div>
        <div class="tab" data-section="ansible" role="tab" aria-selected="false" aria-controls="ansible" tabindex="-1">Ansible</div>
        <div class="tab" data-section="chef" role="tab" aria-selected="false" aria-controls="chef" tabindex="-1">Chef</div>
        <div class="tab active" data-section="topology" role="tab" aria-selected="true" aria-controls="topology" tabindex="0">Topology Builder</div>
        <div class="tab" data-section="packet-flow" role="tab" aria-selected="false" aria-controls="packet-flow" tabindex="-1">Packet Flow</div>
        <div class="tab" data-section="quizzes" role="tab" aria-selected="false" aria-controls="quizzes" tabindex="-1">Quizzes</div>
        <div class="tab" data-section="cheat-sheet" role="tab" aria-selected="false" aria-controls="cheat-sheet" tabindex="-1">Cheat Sheet</div>
        <div class="tab tab-upload" role="tab" aria-selected="false" tabindex="-1" style="margin-left: auto; background: var(--accent-purple); color: white; border-color: var(--accent-purple);" onclick="openModuleManager()">⊕ Add Module</div>
    </nav>

    <!-- HOME SECTION -->
    <div class="content-section" id="home">
        <div class="panel">
            <h2>Welcome to Network Admin Learning Lab</h2>
            <p>This interactive training platform covers a comprehensive 3-week curriculum designed for aspiring Junior Network Administrators.</p>

            <h3>Week 1: Networking Fundamentals</h3>
            <ul style="margin-left: 20px; color: var(--text-secondary);">
                <li>OSI Model (7 layers) with interactive visualization</li>
                <li>TCP/IP Stack and protocols</li>
                <li>IP Addressing &amp; Subnetting</li>
                <li>Ethernet, Switching (MAC, ARP, VLANs)</li>
            </ul>

            <h3>Week 2: Network Devices &amp; Configuration</h3>
            <ul style="margin-left: 20px; color: var(--text-secondary);">
                <li>Routers, Switches, Firewalls</li>
                <li>Basic CLI Commands (Cisco IOS)</li>
                <li>Wireless &amp; Security Basics</li>
                <li>Static routing, DHCP</li>
            </ul>

            <h3>Week 3: Advanced Topics</h3>
            <ul style="margin-left: 20px; color: var(--text-secondary);">
                <li>Routing Protocols (OSPF, BGP)</li>
                <li>Network Monitoring Tools</li>
                <li>Troubleshooting scenarios</li>
                <li>Security (ACLs, Firewalls)</li>
            </ul>

            <div class="mt-20">
                <h3>Interactive Features:</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
                    <div class="result-item">
                        <span>OSI Model Visualization</span>
                        <span style="color: var(--success);">✓</span>
                    </div>
                    <div class="result-item">
                        <span>Subnet Calculator</span>
                        <span style="color: var(--success);">✓</span>
                    </div>
                    <div class="result-item">
                        <span>CLI Simulator</span>
                        <span style="color: var(--success);">✓</span>
                    </div>
                    <div class="result-item">
                        <span>TCP Handshake Animation</span>
                        <span style="color: var(--success);">✓</span>
                    </div>
                    <div class="result-item">
                        <span>Topology Builder</span>
                        <span style="color: var(--success);">✓</span>
                    </div>
                    <div class="result-item">
                        <span>Interactive Quizzes</span>
                        <span style="color: var(--success);">✓</span>
                    </div>
                </div>
            </div>

            <div class="mnemonic">
                Remember the OSI Model: <strong>"Puff Daddy Needs To Stop Producing Albums"</strong>
            </div>

            <p style="margin-top: 20px; text-align: center; color: var(--text-secondary);">
                Your progress is automatically saved. Start exploring by clicking any tab above!
            </p>
        </div>
    </div>

    <!-- OSI MODEL SECTION -->
    <div class="content-section" id="osi-model">
        <div class="panel">
            <h2>OSI Model - 7 Layer Network Architecture</h2>
            <p>The Open Systems Interconnection (OSI) model is a conceptual framework that standardizes network communication functions into seven distinct layers.</p>

            <div class="mnemonic">
                Mnemonic: <strong>"Puff Daddy Needs To Stop Producing Albums"</strong>
            </div>

            <div class="osi-container" id="osiLayers">
                <!-- Layers will be dynamically created -->
            <div class="osi-layer">
                    <div class="osi-layer-number">7</div>
                    <div class="osi-layer-name">7. Application Layer</div>
                    <div class="osi-layer-description">End-user services and network applications</div>
                </div><div class="osi-layer">
                    <div class="osi-layer-number">6</div>
                    <div class="osi-layer-name">6. Presentation Layer</div>
                    <div class="osi-layer-description">Data translation, encryption, and compression</div>
                </div><div class="osi-layer">
                    <div class="osi-layer-number">5</div>
                    <div class="osi-layer-name">5. Session Layer</div>
                    <div class="osi-layer-description">Manages sessions between applications</div>
                </div><div class="osi-layer">
                    <div class="osi-layer-number">4</div>
                    <div class="osi-layer-name">4. Transport Layer</div>
                    <div class="osi-layer-description">Reliable data transfer and error recovery</div>
                </div><div class="osi-layer">
                    <div class="osi-layer-number">3</div>
                    <div class="osi-layer-name">3. Network Layer</div>
                    <div class="osi-layer-description">Logical addressing and routing</div>
                </div><div class="osi-layer">
                    <div class="osi-layer-number">2</div>
                    <div class="osi-layer-name">2. Data Link Layer</div>
                    <div class="osi-layer-description">Physical addressing and frame handling</div>
                </div><div class="osi-layer">
                    <div class="osi-layer-number">1</div>
                    <div class="osi-layer-name">1. Physical Layer</div>
                    <div class="osi-layer-description">Physical transmission of raw bits</div>
                </div></div>
        </div>
    </div>

    <!-- SUBNET CALCULATOR SECTION -->
    <div class="content-section" id="subnet-calc">
        <div class="panel">
            <h2>Subnet Calculator</h2>
            <p>Calculate network details, subnet masks, and practice subnetting problems.</p>

            <div class="calculator-grid">
                <div>
                    <h3>Calculate Subnet</h3>
                    <div class="input-group">
                        <label>IP Address:</label>
                        <input type="text" id="ipAddress" placeholder="192.168.1.0" value="192.168.1.0">
                    </div>
                    <div class="input-group">
                        <label>Subnet Mask (CIDR):</label>
                        <input type="text" id="subnetMask" placeholder="24" value="24">
                    </div>
                    <button class="btn" onclick="calculateSubnet()">Calculate</button>
                    <button class="btn btn-secondary" style="margin-left: 10px;" onclick="generatePracticeProblem()">Practice Problem</button>
                </div>

                <div>
                    <h3>Results</h3>
                    <div class="results-panel" id="subnetResults">
                        <p style="text-align: center; color: var(--text-secondary);">Enter an IP address and subnet mask to calculate</p>
                    </div>
                </div>
            </div>

            <div id="binaryDisplay" class="binary-display hidden" style="margin-top: 20px;">
                <h4 style="color: var(--accent-cyan); margin-bottom: 10px;">Binary Representation:</h4>
                <div id="binaryContent"></div>
            </div>

            <div id="practiceProblem" class="hidden" style="margin-top: 20px;">
                <div class="panel" style="background: var(--bg-primary);">
                    <h3>Practice Problem</h3>
                    <p id="practiceQuestion"></p>
                    <div class="input-group" style="margin-top: 15px;">
                        <label>Your Answer:</label>
                        <input type="text" id="practiceAnswer" placeholder="Enter your answer">
                    </div>
                    <button class="btn" onclick="checkPracticeAnswer()">Check Answer</button>
                    <div id="practiceFeedback" class="hidden" style="margin-top: 15px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- CLI SIMULATOR SECTION -->
    <div class="content-section" id="cli-sim">
        <div class="panel">
            <h2>Cisco IOS CLI Simulator</h2>
            <p>Practice Cisco IOS commands in a simulated environment.</p>

            <div class="cli-container scrollbar-custom" id="cliContainer">
                <div id="cliOutput">Welcome to Network Admin Learning Lab CLI Simulator

Configure a device in the Topology Builder to use this CLI.

</div>
                <div class="cli-input-line">
                    <span class="cli-prompt" id="cliPrompt">Router&gt;</span>
                    <input type="text" class="cli-input" id="cliInput" autocomplete="off" spellcheck="false" aria-label="Command line input for Cisco IOS simulator" aria-describedby="cliOutput">
                </div>
            </div>

            <div class="cli-help">
                <h4>Available Commands:</h4>
                <ul>
                    <li><code>enable</code> - Enter privileged EXEC mode</li>
                    <li><code>configure terminal</code> - Enter global configuration mode</li>
                    <li><code>show ip interface brief</code> - Display interface status</li>
                    <li><code>show running-config</code> - Display current configuration</li>
                    <li><code>show version</code> - Display system version</li>
                    <li><code>ping [ip]</code> - Test connectivity (e.g., ping 8.8.8.8)</li>
                    <li><code>traceroute [ip]</code> - Trace route to destination</li>
                    <li><code>show ip route</code> - Display routing table</li>
                    <li><code>show vlan</code> - Display VLAN information</li>
                    <li><code>help</code> - Display available commands</li>
                    <li><code>clear</code> - Clear the terminal</li>
                    <li><code>exit</code> - Exit current mode</li>
                </ul>
                <p style="margin-top: 10px; color: var(--accent-teal);">Tip: Use the up arrow to access command history!</p>
            </div>
        </div>
    </div>

    <!-- TCP HANDSHAKE SECTION -->
    <div class="content-section" id="tcp-handshake">
        <div class="panel">
            <h2>TCP 3-Way Handshake</h2>
            <p>The TCP three-way handshake establishes a reliable connection between client and server.</p>

            <div class="tcp-animation-container">
                <div class="tcp-device client">
                    <div class="tcp-device-icon">💻</div>
                    <div>Client</div>
                </div>
                <div class="tcp-device server">
                    <div class="tcp-device-icon">🖥️</div>
                    <div>Server</div>
                </div>
                <div id="tcpPackets"></div>
            </div>

            <div class="tcp-step-description" id="tcpStepDescription">
                <p>Click "Start Animation" to see the TCP handshake in action.</p>
            </div>

            <div class="tcp-controls">
                <button class="btn" onclick="startTCPAnimation()">Start Animation</button>
                <button class="btn btn-secondary" onclick="resetTCPAnimation()">Reset</button>
            </div>

            <div style="margin-top: 30px; padding: 20px; background: var(--bg-primary); border-radius: 8px; border: 1px solid var(--border);">
                <h3>Understanding the Handshake:</h3>
                <div style="margin-top: 15px;">
                    <div class="result-item">
                        <span class="result-label">Step 1: SYN</span>
                        <span class="result-value">Client sends synchronization request</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Step 2: SYN-ACK</span>
                        <span class="result-value">Server acknowledges and sends its own SYN</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Step 3: ACK</span>
                        <span class="result-value">Client acknowledges server's SYN</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Result</span>
                        <span class="result-value">Connection established! 🎉</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- NAT/PAT SECTION -->
    <div class="content-section" id="nat-pat">
        <div class="panel">
            <h2>NAT/PAT - Network Address Translation</h2>
            <p>Understanding how private IP addresses are translated to public addresses for internet communication.</p>

            <div class="nat-intro">
                <h3>Why Do We Need NAT?</h3>
                <ul style="margin-left: 20px; color: var(--text-secondary); line-height: 1.8;">
                    <li><strong>IPv4 Address Exhaustion:</strong> Only ~4.3 billion IPv4 addresses exist</li>
                    <li><strong>Security:</strong> Hides internal network structure from the internet</li>
                    <li><strong>Cost Savings:</strong> Multiple devices share one or few public IP addresses</li>
                    <li><strong>Flexibility:</strong> Change ISPs without reconfiguring internal network</li>
                </ul>
            </div>

            <div class="nat-types-grid">
                <div class="nat-type-card">
                    <h3 style="color: var(--accent-cyan);">Static NAT</h3>
                    <p>One-to-one mapping between private and public IP addresses</p>
                    <div class="nat-example">192.168.1.10 ↔ 203.0.113.5</div>
                    <p style="font-size: 0.9em; color: var(--text-secondary);">Use case: Web servers, mail servers</p>
                </div>

                <div class="nat-type-card">
                    <h3 style="color: var(--accent-teal);">Dynamic NAT</h3>
                    <p>Maps private IPs to a pool of public IPs dynamically</p>
                    <div class="nat-example">192.168.1.x → Pool: 203.0.113.5-10</div>
                    <p style="font-size: 0.9em; color: var(--text-secondary);">Use case: Organizations with multiple public IPs</p>
                </div>

                <div class="nat-type-card">
                    <h3 style="color: var(--success);">PAT (Overloading)</h3>
                    <p>Many private IPs share ONE public IP using different ports</p>
                    <div class="nat-example">192.168.1.x:port → 203.0.113.5:port</div>
                    <p style="font-size: 0.9em; color: var(--text-secondary);">Use case: Home routers, most common</p>
                </div>
            </div>

            <h3 style="margin-top: 40px;">Interactive PAT Demonstration</h3>
            <p>Watch how multiple internal devices share a single public IP address using Port Address Translation</p>

            <div class="nat-visualization-container">
                <div class="nat-side">
                    <h4 style="text-align: center; color: var(--accent-cyan); margin-bottom: 15px;">INSIDE (Private Network)</h4>
                    <div class="nat-device-list" id="insideDevices">
                        <div class="nat-device" data-ip="192.168.1.10">
                            <span class="device-icon">💻</span>
                            <span class="device-info">PC1<br>192.168.1.10</span>
                        </div>
                        <div class="nat-device" data-ip="192.168.1.11">
                            <span class="device-icon">📱</span>
                            <span class="device-info">Phone<br>192.168.1.11</span>
                        </div>
                        <div class="nat-device" data-ip="192.168.1.12">
                            <span class="device-icon">💻</span>
                            <span class="device-info">PC2<br>192.168.1.12</span>
                        </div>
                    </div>
                </div>

                <div class="nat-router">
                    <div class="router-icon">📡</div>
                    <div class="router-label">NAT Router</div>
                    <div class="public-ip">Public IP:<br>203.0.113.5</div>
                </div>

                <div class="nat-side">
                    <h4 style="text-align: center; color: var(--accent-teal); margin-bottom: 15px;">OUTSIDE (Internet)</h4>
                    <div class="nat-device-list">
                        <div class="nat-device">
                            <span class="device-icon">🌐</span>
                            <span class="device-info">Web Server<br>8.8.8.8:80</span>
                        </div>
                        <div class="nat-device">
                            <span class="device-icon">📧</span>
                            <span class="device-info">Mail Server<br>1.1.1.1:25</span>
                        </div>
                        <div class="nat-device">
                            <span class="device-icon">☁️</span>
                            <span class="device-info">Cloud Service<br>93.184.216.34:443</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="nat-table-container">
                <h4>NAT Translation Table (Live)</h4>
                <table class="nat-table" id="natTable">
                    <thead>
                        <tr>
                            <th>Inside Local</th>
                            <th>Inside Global</th>
                            <th>Outside Global</th>
                            <th>Protocol</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="natTableBody">
                        <tr>
                            <td colspan="5" style="text-align: center; color: var(--text-secondary);">No active translations. Click a device to start a connection.</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="nat-controls">
                <button class="btn" onclick="startNATDemo(&#39;web&#39;)">PC1 → Web Server</button>
                <button class="btn" onclick="startNATDemo(&#39;mail&#39;)">Phone → Mail Server</button>
                <button class="btn" onclick="startNATDemo(&#39;cloud&#39;)">PC2 → Cloud Service</button>
                <button class="btn" onclick="startNATDemo(&#39;all&#39;)">All Devices (Simultaneous)</button>
                <button class="btn btn-secondary" onclick="resetNAT()">Reset Table</button>
            </div>

            <div id="natStatus" class="nat-status"></div>

            <div class="nat-explanation" style="margin-top: 30px;">
                <h3>How PAT Works:</h3>
                <ol style="margin-left: 20px; color: var(--text-secondary); line-height: 2;">
                    <li><strong>Outgoing Packet:</strong> Device (192.168.1.10:5000) wants to access Web Server (8.8.8.8:80)</li>
                    <li><strong>NAT Translation:</strong> Router replaces source IP:Port with public IP:unique port (203.0.113.5:50001)</li>
                    <li><strong>Records Entry:</strong> Router stores translation in NAT table</li>
                    <li><strong>Internet Routing:</strong> Packet travels with public source address</li>
                    <li><strong>Return Traffic:</strong> Server replies to 203.0.113.5:50001</li>
                    <li><strong>Reverse Translation:</strong> Router looks up port 50001, translates back to 192.168.1.10:5000</li>
                    <li><strong>Delivery:</strong> Original device receives the response</li>
                </ol>
            </div>

            <div class="nat-quiz-section" style="margin-top: 30px;">
                <h3>Quick Quiz</h3>
                <div class="quiz-question">
                    <p><strong>Q: What is the main difference between NAT and PAT?</strong></p>
                    <button class="btn-small" onclick="showNATAnswer(1)">Show Answer</button>
                    <div id="natAnswer1" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> NAT (Network Address Translation) translates IP addresses, while PAT (Port Address Translation) translates both IP addresses AND port numbers. PAT allows multiple devices to share a single public IP by using different port numbers for each connection.
                    </div>
                </div>

                <div class="quiz-question" style="margin-top: 20px;">
                    <p><strong>Q: Why can't two devices use the same port number in PAT?</strong></p>
                    <button class="btn-small" onclick="showNATAnswer(2)">Show Answer</button>
                    <div id="natAnswer2" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> The router uses the unique combination of public IP + port number to identify which internal device should receive return traffic. If two devices used the same port, the router wouldn't know which device to send the response to.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- DHCP SECTION -->
    <div class="content-section" id="dhcp">
        <div class="panel">
            <h2>DHCP - Dynamic Host Configuration Protocol</h2>
            <p>Learn how devices automatically obtain IP addresses through the 4-step DORA process.</p>

            <div class="dhcp-intro">
                <h3>What is DHCP?</h3>
                <p>DHCP is a network protocol that automatically assigns IP addresses and network configuration to devices. Without DHCP, network administrators would need to manually configure every device - imagine doing this for hundreds or thousands of devices!</p>

                <div class="dhcp-benefits">
                    <h4>Benefits of DHCP:</h4>
                    <ul>
                        <li><strong>Automation:</strong> No manual IP configuration needed</li>
                        <li><strong>Centralized Management:</strong> Single server manages all IP assignments</li>
                        <li><strong>Prevents Conflicts:</strong> Ensures no duplicate IP addresses</li>
                        <li><strong>Efficient IP Usage:</strong> IPs are leased and recycled when not in use</li>
                    </ul>
                </div>
            </div>

            <h3>The DORA Process</h3>
            <div class="dora-steps-grid">
                <div class="dora-step-card">
                    <div class="dora-step-number">1</div>
                    <h4>Discover</h4>
                    <p><strong>Client broadcasts:</strong> "Is there a DHCP server available?"</p>
                    <p class="tech-detail">Broadcast to 255.255.255.255</p>
                </div>
                <div class="dora-step-card">
                    <div class="dora-step-number">2</div>
                    <h4>Offer</h4>
                    <p><strong>Server responds:</strong> "Yes! I can offer you 192.168.1.100"</p>
                    <p class="tech-detail">Includes IP, subnet mask, gateway, DNS</p>
                </div>
                <div class="dora-step-card">
                    <div class="dora-step-number">3</div>
                    <h4>Request</h4>
                    <p><strong>Client accepts:</strong> "I accept that IP address"</p>
                    <p class="tech-detail">Broadcast to inform all servers</p>
                </div>
                <div class="dora-step-card">
                    <div class="dora-step-number">4</div>
                    <h4>Acknowledge</h4>
                    <p><strong>Server confirms:</strong> "IP is yours for 24 hours"</p>
                    <p class="tech-detail">Lease time specified</p>
                </div>
            </div>

            <h3>Interactive Visualization</h3>
            <div class="dhcp-visualization-container">
                <div class="dhcp-client" id="dhcpClient">
                    <div class="device-icon-large">💻</div>
                    <div class="device-label">Client</div>
                    <div class="device-status" id="clientStatus">No IP Address</div>
                </div>

                <div class="dhcp-network-space">
                    <div class="dhcp-packet" id="dhcpPacket">
                        <div class="packet-type">DISCOVER</div>
                    </div>
                </div>

                <div class="dhcp-server" id="dhcpServer">
                    <div class="device-icon-large">🖥️</div>
                    <div class="device-label">DHCP Server</div>
                    <div class="device-status">192.168.1.1</div>
                </div>
            </div>

            <div class="dhcp-controls">
                <button class="btn" onclick="startDHCPAnimation()">Start DORA Process</button>
                <button class="btn btn-secondary" onclick="resetDHCP()">Reset</button>
                <button class="fullscreen-toggle" onclick="openFullscreen(document.getElementById(&#39;dhcpTopology&#39;).parentElement, &#39;DHCP DORA Process - Fullscreen Mode&#39;)">Fullscreen</button>
            </div>

            <div id="dhcpStatus" class="status-display">
                Click "Start DORA Process" to see how a device obtains an IP address.
            </div>

            <div class="dhcp-details-panel">
                <h3>Step-by-Step Explanation</h3>
                <div id="dhcpStepDetails" class="step-details-content">
                    <p>The animation will show each step of the DORA process with detailed explanations.</p>
                </div>
            </div>

            <h3>DHCP Lease Information</h3>
            <div class="dhcp-lease-table">
                <table id="dhcpLeaseTable">
                    <thead>
                        <tr>
                            <th>MAC Address</th>
                            <th>IP Address</th>
                            <th>Lease Start</th>
                            <th>Lease Duration</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Populated dynamically -->
                    </tbody>
                </table>
            </div>

            <h3>Quiz: Test Your DHCP Knowledge</h3>
            <div class="quiz-container">
                <div class="quiz-item">
                    <p><strong>Q: What does DORA stand for?</strong></p>
                    <button class="btn-small" onclick="showDHCPAnswer(1)">Show Answer</button>
                    <div id="dhcpAnswer1" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> DORA stands for Discover, Offer, Request, Acknowledge - the four steps in the DHCP process.
                    </div>
                </div>

                <div class="quiz-item">
                    <p><strong>Q: Why does the client broadcast the Discover message instead of sending it directly to the server?</strong></p>
                    <button class="btn-small" onclick="showDHCPAnswer(2)">Show Answer</button>
                    <div id="dhcpAnswer2" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> The client doesn't know the DHCP server's IP address yet (it doesn't even have an IP itself!), so it broadcasts to 255.255.255.255 to reach all devices on the network. Any DHCP server listening will respond.
                    </div>
                </div>

                <div class="quiz-item">
                    <p><strong>Q: What happens when a DHCP lease expires?</strong></p>
                    <button class="btn-small" onclick="showDHCPAnswer(3)">Show Answer</button>
                    <div id="dhcpAnswer3" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> The client typically tries to renew the lease at 50% of the lease time. If the lease expires without renewal, the client must release the IP and go through the DORA process again to obtain a new address.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- OSPF SECTION -->
    <div class="content-section" id="ospf">
        <div class="panel">
            <h2>OSPF - Open Shortest Path First</h2>
            <p>Learn how OSPF routers discover neighbors, exchange routing information, and calculate the best paths using Dijkstra's algorithm.</p>

            <div class="ospf-intro">
                <h3>What is OSPF?</h3>
                <p>OSPF is a link-state routing protocol used in large enterprise networks. Unlike distance-vector protocols (like RIP), OSPF routers maintain a complete map of the network topology and use this to calculate the shortest path to each destination.</p>

                <div class="ospf-benefits">
                    <h4>Key Features:</h4>
                    <ul>
                        <li><strong>Link-State Protocol:</strong> Each router has complete topology map</li>
                        <li><strong>Fast Convergence:</strong> Quick to adapt to network changes</li>
                        <li><strong>Scalable:</strong> Works well in large networks using areas</li>
                        <li><strong>Cost-Based Routing:</strong> Uses bandwidth to calculate best paths</li>
                        <li><strong>No Hop Limit:</strong> Unlike RIP's 15-hop limit</li>
                    </ul>
                </div>
            </div>

            <h3>OSPF Operation Phases</h3>
            <div class="ospf-phases-grid">
                <div class="ospf-phase-card">
                    <div class="ospf-phase-number">1</div>
                    <h4>Neighbor Discovery</h4>
                    <p>Routers send Hello packets to find neighbors</p>
                    <p class="tech-detail">Multicast to 224.0.0.5 every 10s</p>
                </div>
                <div class="ospf-phase-card">
                    <div class="ospf-phase-number">2</div>
                    <h4>Database Exchange</h4>
                    <p>Routers exchange Link-State Advertisements (LSAs)</p>
                    <p class="tech-detail">DBD, LSR, LSU packets</p>
                </div>
                <div class="ospf-phase-card">
                    <div class="ospf-phase-number">3</div>
                    <h4>SPF Calculation</h4>
                    <p>Run Dijkstra's algorithm to build routing table</p>
                    <p class="tech-detail">Creates Shortest Path Tree</p>
                </div>
                <div class="ospf-phase-card">
                    <div class="ospf-phase-number">4</div>
                    <h4>Route Installation</h4>
                    <p>Best routes installed in routing table</p>
                    <p class="tech-detail">Based on lowest cost</p>
                </div>
            </div>

            <h3>Interactive Network Topology</h3>
            <p style="color: var(--text-muted); font-size: 0.9em; margin-bottom: 15px;">
                This network demonstrates OSPF's cost-based routing. Notice how different link speeds (costs) affect path selection - OSPF doesn't just count hops!
            </p>
            <div class="ospf-topology-container">
                <svg id="ospfTopology" viewBox="0 0 1000 600" style="width: 100%; height: 600px; background: var(--bg-secondary); border-radius: 8px; border: 2px solid var(--border);">
                    <!-- Router A (Source) -->
                    <circle cx="80" cy="300" r="35" fill="#e74c3c" stroke="white" stroke-width="3" class="ospf-router" data-router="A"></circle>
                    <text x="80" y="305" text-anchor="middle" fill="white" font-weight="bold" font-size="18">A</text>
                    <text x="80" y="350" text-anchor="middle" fill="var(--text-primary)" font-size="11">Source</text>
                    <text x="80" y="365" text-anchor="middle" fill="var(--text-muted)" font-size="9" id="routerAStatus">Idle</text>

                    <!-- Router B (Top path) -->
                    <circle cx="280" cy="120" r="35" fill="var(--accent-cyan)" stroke="white" stroke-width="3" class="ospf-router" data-router="B"></circle>
                    <text x="280" y="125" text-anchor="middle" fill="white" font-weight="bold" font-size="18">B</text>
                    <text x="280" y="170" text-anchor="middle" fill="var(--text-primary)" font-size="11">10Gbps Link</text>
                    <text x="280" y="185" text-anchor="middle" fill="var(--text-muted)" font-size="9" id="routerBStatus">Idle</text>

                    <!-- Router C (Middle-top) -->
                    <circle cx="280" cy="300" r="35" fill="var(--accent-cyan)" stroke="white" stroke-width="3" class="ospf-router" data-router="C"></circle>
                    <text x="280" y="305" text-anchor="middle" fill="white" font-weight="bold" font-size="18">C</text>
                    <text x="280" y="350" text-anchor="middle" fill="var(--text-primary)" font-size="11">100Mbps Link</text>
                    <text x="280" y="365" text-anchor="middle" fill="var(--text-muted)" font-size="9" id="routerCStatus">Idle</text>

                    <!-- Router D (Bottom path) -->
                    <circle cx="280" cy="480" r="35" fill="var(--accent-cyan)" stroke="white" stroke-width="3" class="ospf-router" data-router="D"></circle>
                    <text x="280" y="485" text-anchor="middle" fill="white" font-weight="bold" font-size="18">D</text>
                    <text x="280" y="530" text-anchor="middle" fill="var(--text-primary)" font-size="11">10Mbps Link</text>
                    <text x="280" y="545" text-anchor="middle" fill="var(--text-muted)" font-size="9" id="routerDStatus">Idle</text>

                    <!-- Router E (Middle-right) -->
                    <circle cx="520" cy="200" r="35" fill="var(--accent-cyan)" stroke="white" stroke-width="3" class="ospf-router" data-router="E"></circle>
                    <text x="520" y="205" text-anchor="middle" fill="white" font-weight="bold" font-size="18">E</text>
                    <text x="520" y="250" text-anchor="middle" fill="var(--text-primary)" font-size="11">Core Router</text>
                    <text x="520" y="265" text-anchor="middle" fill="var(--text-muted)" font-size="9" id="routerEStatus">Idle</text>

                    <!-- Router F (Lower-right) -->
                    <circle cx="520" cy="400" r="35" fill="var(--accent-cyan)" stroke="white" stroke-width="3" class="ospf-router" data-router="F"></circle>
                    <text x="520" y="405" text-anchor="middle" fill="white" font-weight="bold" font-size="18">F</text>
                    <text x="520" y="450" text-anchor="middle" fill="var(--text-primary)" font-size="11">Aggregation</text>
                    <text x="520" y="465" text-anchor="middle" fill="var(--text-muted)" font-size="9" id="routerFStatus">Idle</text>

                    <!-- Router G (Destination) -->
                    <circle cx="750" cy="300" r="35" fill="#2ecc71" stroke="white" stroke-width="3" class="ospf-router" data-router="G"></circle>
                    <text x="750" y="305" text-anchor="middle" fill="white" font-weight="bold" font-size="18">G</text>
                    <text x="750" y="350" text-anchor="middle" fill="var(--text-primary)" font-size="11">Destination</text>
                    <text x="750" y="365" text-anchor="middle" fill="var(--text-muted)" font-size="9" id="routerGStatus">Idle</text>

                    <!-- Links with costs -->
                    <!-- A to B (10Gbps = cost 1) -->
                    <line x1="115" y1="300" x2="245" y2="120" stroke="var(--border)" stroke-width="4" class="ospf-link" data-link="A-B"></line>
                    <rect x="160" y="190" width="60" height="20" fill="var(--bg-primary)" opacity="0.9" rx="4"></rect>
                    <text x="190" y="204" text-anchor="middle" fill="#2ecc71" font-size="11" font-weight="bold">Cost: 1</text>

                    <!-- A to C (100Mbps = cost 10) -->
                    <line x1="115" y1="300" x2="245" y2="300" stroke="var(--border)" stroke-width="4" class="ospf-link" data-link="A-C"></line>
                    <rect x="150" y="290" width="70" height="20" fill="var(--bg-primary)" opacity="0.9" rx="4"></rect>
                    <text x="185" y="304" text-anchor="middle" fill="#f39c12" font-size="11" font-weight="bold">Cost: 10</text>

                    <!-- A to D (10Mbps = cost 100) -->
                    <line x1="115" y1="300" x2="245" y2="480" stroke="var(--border)" stroke-width="4" class="ospf-link" data-link="A-D"></line>
                    <rect x="150" y="400" width="80" height="20" fill="var(--bg-primary)" opacity="0.9" rx="4"></rect>
                    <text x="190" y="414" text-anchor="middle" fill="#e74c3c" font-size="11" font-weight="bold">Cost: 100</text>

                    <!-- B to E (10Gbps = cost 1) -->
                    <line x1="315" y1="120" x2="485" y2="200" stroke="var(--border)" stroke-width="4" class="ospf-link" data-link="B-E"></line>
                    <rect x="380" y="145" width="60" height="20" fill="var(--bg-primary)" opacity="0.9" rx="4"></rect>
                    <text x="410" y="159" text-anchor="middle" fill="#2ecc71" font-size="11" font-weight="bold">Cost: 1</text>

                    <!-- C to E (1Gbps = cost 10) -->
                    <line x1="315" y1="300" x2="485" y2="200" stroke="var(--border)" stroke-width="4" class="ospf-link" data-link="C-E"></line>
                    <rect x="380" y="235" width="70" height="20" fill="var(--bg-primary)" opacity="0.9" rx="4"></rect>
                    <text x="415" y="249" text-anchor="middle" fill="#f39c12" font-size="11" font-weight="bold">Cost: 10</text>

                    <!-- C to F (100Mbps = cost 10) -->
                    <line x1="315" y1="300" x2="485" y2="400" stroke="var(--border)" stroke-width="4" class="ospf-link" data-link="C-F"></line>
                    <rect x="380" y="335" width="70" height="20" fill="var(--bg-primary)" opacity="0.9" rx="4"></rect>
                    <text x="415" y="349" text-anchor="middle" fill="#f39c12" font-size="11" font-weight="bold">Cost: 10</text>

                    <!-- D to F (10Mbps = cost 100) -->
                    <line x1="315" y1="480" x2="485" y2="400" stroke="var(--border)" stroke-width="4" class="ospf-link" data-link="D-F"></line>
                    <rect x="380" y="425" width="80" height="20" fill="var(--bg-primary)" opacity="0.9" rx="4"></rect>
                    <text x="420" y="439" text-anchor="middle" fill="#e74c3c" font-size="11" font-weight="bold">Cost: 100</text>

                    <!-- E to G (10Gbps = cost 1) -->
                    <line x1="555" y1="200" x2="715" y2="300" stroke="var(--border)" stroke-width="4" class="ospf-link" data-link="E-G"></line>
                    <rect x="615" y="235" width="60" height="20" fill="var(--bg-primary)" opacity="0.9" rx="4"></rect>
                    <text x="645" y="249" text-anchor="middle" fill="#2ecc71" font-size="11" font-weight="bold">Cost: 1</text>

                    <!-- F to G (100Mbps = cost 10) -->
                    <line x1="555" y1="400" x2="715" y2="300" stroke="var(--border)" stroke-width="4" class="ospf-link" data-link="F-G"></line>
                    <rect x="615" y="335" width="70" height="20" fill="var(--bg-primary)" opacity="0.9" rx="4"></rect>
                    <text x="650" y="349" text-anchor="middle" fill="#f39c12" font-size="11" font-weight="bold">Cost: 10</text>

                    <!-- E to F (backup link, 1Gbps = cost 10) -->
                    <line x1="520" y1="235" x2="520" y2="365" stroke="var(--border)" stroke-width="4" stroke-dasharray="5,5" class="ospf-link" data-link="E-F"></line>
                    <rect x="485" y="290" width="70" height="20" fill="var(--bg-primary)" opacity="0.9" rx="4"></rect>
                    <text x="520" y="304" text-anchor="middle" fill="#95a5a6" font-size="11" font-weight="bold">Cost: 10</text>

                    <!-- Legend -->
                    <g transform="translate(810, 50)">
                        <text x="0" y="0" fill="var(--text-primary)" font-weight="bold" font-size="12">Cost Legend:</text>
                        <text x="0" y="20" fill="#2ecc71" font-size="10">● 10Gbps = Cost 1</text>
                        <text x="0" y="35" fill="#3498db" font-size="10">● 1Gbps = Cost 10</text>
                        <text x="0" y="50" fill="#f39c12" font-size="10">● 100Mbps = Cost 10</text>
                        <text x="0" y="65" fill="#e74c3c" font-size="10">● 10Mbps = Cost 100</text>
                        <line x1="0" y1="75" x2="0" y2="95" stroke="var(--border)" stroke-width="2"></line>
                        <text x="10" y="90" fill="var(--text-muted)" font-size="9">Solid = Primary</text>
                        <line x1="0" y1="100" x2="0" y2="115" stroke="var(--border)" stroke-width="2" stroke-dasharray="3,3"></line>
                        <text x="10" y="110" fill="var(--text-muted)" font-size="9">Dashed = Backup</text>
                    </g>

                    <!-- OSPF Packets (initially hidden) -->
                    <circle cx="80" cy="300" r="8" fill="#9b59b6" class="ospf-packet" id="ospfPacket" style="opacity: 0;">
                        <animate attributeName="r" values="8;12;8" dur="1s" repeatCount="indefinite"></animate>
                    </circle>
                </svg>
            </div>

            <div class="ospf-controls">
                <button class="btn" onclick="startOSPFAnimation()">Start OSPF Process</button>
                <button class="btn btn-secondary" onclick="showOSPFPath()">Show Shortest Path (A→G)</button>
                <button class="btn btn-secondary" onclick="resetOSPF()">Reset</button>
                <button class="fullscreen-toggle" onclick="openFullscreen(document.getElementById(&#39;ospfTopology&#39;).parentElement, &#39;OSPF Routing - Fullscreen Mode&#39;)">Fullscreen</button>
            </div>

            <div id="ospfStatus" class="status-display">
                Click "Start OSPF Process" to see how routers discover neighbors and exchange routing information.
            </div>

            <div class="ospf-details-panel">
                <h3>Current Operation</h3>
                <div id="ospfStepDetails" class="step-details-content">
                    <p>The animation will demonstrate OSPF neighbor discovery, LSA flooding, and shortest path calculation.</p>
                </div>
            </div>

            <h3>OSPF Routing Tables</h3>
            <div class="ospf-tables-grid">
                <div class="ospf-table-container">
                    <h4>Router A (Source) - Routing Table</h4>
                    <table class="ospf-routing-table" id="routingTableA">
                        <thead>
                            <tr>
                                <th>Destination</th>
                                <th>Next Hop</th>
                                <th>Cost</th>
                                <th>Interface</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Populated dynamically -->
                        </tbody>
                    </table>
                </div>
                <div class="ospf-table-container">
                    <h4>Router G (Destination) - Routing Table</h4>
                    <table class="ospf-routing-table" id="routingTableG">
                        <thead>
                            <tr>
                                <th>Destination</th>
                                <th>Next Hop</th>
                                <th>Cost</th>
                                <th>Interface</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Populated dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <h3>Quiz: Test Your OSPF Knowledge</h3>
            <div class="quiz-container">
                <div class="quiz-item">
                    <p><strong>Q: What is the main advantage of OSPF over RIP?</strong></p>
                    <button class="btn-small" onclick="showOSPFAnswer(1)">Show Answer</button>
                    <div id="ospfAnswer1" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> OSPF has several advantages: faster convergence, no hop-count limit (RIP limited to 15), uses bandwidth-based metrics instead of hop count, and scales better in large networks through the use of areas.
                    </div>
                </div>

                <div class="quiz-item">
                    <p><strong>Q: How does OSPF calculate the cost of a path?</strong></p>
                    <button class="btn-small" onclick="showOSPFAnswer(2)">Show Answer</button>
                    <div id="ospfAnswer2" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> OSPF cost is calculated as: Cost = Reference Bandwidth / Interface Bandwidth. The default reference bandwidth is 100 Mbps. For example, a 10 Mbps link has cost 10, a 100 Mbps link has cost 1. Lower cost = better path.
                    </div>
                </div>

                <div class="quiz-item">
                    <p><strong>Q: What multicast address does OSPF use for Hello packets?</strong></p>
                    <button class="btn-small" onclick="showOSPFAnswer(3)">Show Answer</button>
                    <div id="ospfAnswer3" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> OSPF uses 224.0.0.5 (AllSPFRouters) for Hello packets and general OSPF communication. Designated Routers also use 224.0.0.6 (AllDRouters).
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- RIP SECTION -->
    <div class="content-section" id="rip">
        <div class="panel">
            <h2>RIP - Routing Information Protocol</h2>
            <p>Understand RIP's distance-vector routing and see why hop-count based routing has limitations compared to OSPF.</p>

            <div class="rip-intro">
                <h3>What is RIP?</h3>
                <p>RIP (Routing Information Protocol) is one of the oldest distance-vector routing protocols. It uses hop count as its only metric - meaning it counts routers, not bandwidth. This simple approach has significant drawbacks in modern networks.</p>

                <div class="rip-comparison">
                    <h4>RIP vs OSPF Comparison:</h4>
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Feature</th>
                                <th>RIP</th>
                                <th>OSPF</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Metric</strong></td>
                                <td>Hop count only</td>
                                <td>Cost (bandwidth-based)</td>
                            </tr>
                            <tr>
                                <td><strong>Max Distance</strong></td>
                                <td>15 hops (16 = unreachable)</td>
                                <td>No limit</td>
                            </tr>
                            <tr>
                                <td><strong>Convergence</strong></td>
                                <td>Slow (30s updates)</td>
                                <td>Fast (event-driven)</td>
                            </tr>
                            <tr>
                                <td><strong>Algorithm</strong></td>
                                <td>Bellman-Ford</td>
                                <td>Dijkstra (SPF)</td>
                            </tr>
                            <tr>
                                <td><strong>Scalability</strong></td>
                                <td>Small networks</td>
                                <td>Large enterprise</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <h3>Same Topology, Different Results</h3>
            <p style="color: var(--text-muted); font-size: 0.9em; margin-bottom: 15px;">
                This is the SAME network from OSPF, but watch RIP make the WRONG choice! RIP only counts hops, ignoring that some links are 1000x slower than others.
            </p>

            <div class="rip-topology-container">
                <svg id="ripTopology" viewBox="0 0 1000 600" style="width: 100%; height: 600px; background: var(--bg-secondary); border-radius: 8px; border: 2px solid var(--border);">
                    <!-- Same topology as OSPF -->
                    <!-- Router A (Source) -->
                    <circle cx="80" cy="300" r="35" fill="#e74c3c" stroke="white" stroke-width="3" class="rip-router" data-router="A"></circle>
                    <text x="80" y="305" text-anchor="middle" fill="white" font-weight="bold" font-size="18">A</text>
                    <text x="80" y="350" text-anchor="middle" fill="var(--text-primary)" font-size="11">Source</text>
                    <text x="80" y="365" text-anchor="middle" fill="var(--text-muted)" font-size="9" id="ripRouterAStatus">Idle</text>

                    <!-- Router B -->
                    <circle cx="280" cy="120" r="35" fill="var(--accent-cyan)" stroke="white" stroke-width="3" class="rip-router" data-router="B"></circle>
                    <text x="280" y="125" text-anchor="middle" fill="white" font-weight="bold" font-size="18">B</text>
                    <text x="280" y="170" text-anchor="middle" fill="var(--text-primary)" font-size="11">Hop 1</text>
                    <text x="280" y="185" text-anchor="middle" fill="var(--text-muted)" font-size="9" id="ripRouterBStatus">Idle</text>

                    <!-- Router C -->
                    <circle cx="280" cy="300" r="35" fill="var(--accent-cyan)" stroke="white" stroke-width="3" class="rip-router" data-router="C"></circle>
                    <text x="280" y="305" text-anchor="middle" fill="white" font-weight="bold" font-size="18">C</text>
                    <text x="280" y="350" text-anchor="middle" fill="var(--text-primary)" font-size="11">Hop 1</text>
                    <text x="280" y="365" text-anchor="middle" fill="var(--text-muted)" font-size="9" id="ripRouterCStatus">Idle</text>

                    <!-- Router D -->
                    <circle cx="280" cy="480" r="35" fill="var(--accent-cyan)" stroke="white" stroke-width="3" class="rip-router" data-router="D"></circle>
                    <text x="280" y="485" text-anchor="middle" fill="white" font-weight="bold" font-size="18">D</text>
                    <text x="280" y="530" text-anchor="middle" fill="var(--text-primary)" font-size="11">Hop 1</text>
                    <text x="280" y="545" text-anchor="middle" fill="var(--text-muted)" font-size="9" id="ripRouterDStatus">Idle</text>

                    <!-- Router E -->
                    <circle cx="520" cy="200" r="35" fill="var(--accent-cyan)" stroke="white" stroke-width="3" class="rip-router" data-router="E"></circle>
                    <text x="520" y="205" text-anchor="middle" fill="white" font-weight="bold" font-size="18">E</text>
                    <text x="520" y="250" text-anchor="middle" fill="var(--text-primary)" font-size="11">Hop 2</text>
                    <text x="520" y="265" text-anchor="middle" fill="var(--text-muted)" font-size="9" id="ripRouterEStatus">Idle</text>

                    <!-- Router F -->
                    <circle cx="520" cy="400" r="35" fill="var(--accent-cyan)" stroke="white" stroke-width="3" class="rip-router" data-router="F"></circle>
                    <text x="520" y="405" text-anchor="middle" fill="white" font-weight="bold" font-size="18">F</text>
                    <text x="520" y="450" text-anchor="middle" fill="var(--text-primary)" font-size="11">Hop 2</text>
                    <text x="520" y="465" text-anchor="middle" fill="var(--text-muted)" font-size="9" id="ripRouterFStatus">Idle</text>

                    <!-- Router G (Destination) -->
                    <circle cx="750" cy="300" r="35" fill="#2ecc71" stroke="white" stroke-width="3" class="rip-router" data-router="G"></circle>
                    <text x="750" y="305" text-anchor="middle" fill="white" font-weight="bold" font-size="18">G</text>
                    <text x="750" y="350" text-anchor="middle" fill="var(--text-primary)" font-size="11">Destination</text>
                    <text x="750" y="365" text-anchor="middle" fill="var(--text-muted)" font-size="9" id="ripRouterGStatus">Idle</text>

                    <!-- Links with HOP COUNT labels -->
                    <line x1="115" y1="300" x2="245" y2="120" stroke="var(--border)" stroke-width="4" class="rip-link" data-link="A-B"></line>
                    <rect x="160" y="190" width="70" height="20" fill="var(--bg-primary)" opacity="0.9" rx="4"></rect>
                    <text x="195" y="204" text-anchor="middle" fill="var(--text-primary)" font-size="11" font-weight="bold">1 hop</text>

                    <line x1="115" y1="300" x2="245" y2="300" stroke="var(--border)" stroke-width="4" class="rip-link" data-link="A-C"></line>
                    <rect x="150" y="290" width="70" height="20" fill="var(--bg-primary)" opacity="0.9" rx="4"></rect>
                    <text x="185" y="304" text-anchor="middle" fill="var(--text-primary)" font-size="11" font-weight="bold">1 hop</text>

                    <line x1="115" y1="300" x2="245" y2="480" stroke="var(--border)" stroke-width="4" class="rip-link" data-link="A-D"></line>
                    <rect x="150" y="400" width="70" height="20" fill="var(--bg-primary)" opacity="0.9" rx="4"></rect>
                    <text x="185" y="414" text-anchor="middle" fill="var(--text-primary)" font-size="11" font-weight="bold">1 hop</text>

                    <line x1="315" y1="120" x2="485" y2="200" stroke="var(--border)" stroke-width="4" class="rip-link" data-link="B-E"></line>
                    <rect x="380" y="145" width="70" height="20" fill="var(--bg-primary)" opacity="0.9" rx="4"></rect>
                    <text x="415" y="159" text-anchor="middle" fill="var(--text-primary)" font-size="11" font-weight="bold">1 hop</text>

                    <line x1="315" y1="300" x2="485" y2="200" stroke="var(--border)" stroke-width="4" class="rip-link" data-link="C-E"></line>
                    <rect x="380" y="235" width="70" height="20" fill="var(--bg-primary)" opacity="0.9" rx="4"></rect>
                    <text x="415" y="249" text-anchor="middle" fill="var(--text-primary)" font-size="11" font-weight="bold">1 hop</text>

                    <line x1="315" y1="300" x2="485" y2="400" stroke="var(--border)" stroke-width="4" class="rip-link" data-link="C-F"></line>
                    <rect x="380" y="335" width="70" height="20" fill="var(--bg-primary)" opacity="0.9" rx="4"></rect>
                    <text x="415" y="349" text-anchor="middle" fill="var(--text-primary)" font-size="11" font-weight="bold">1 hop</text>

                    <line x1="315" y1="480" x2="485" y2="400" stroke="var(--border)" stroke-width="4" class="rip-link" data-link="D-F"></line>
                    <rect x="380" y="425" width="70" height="20" fill="var(--bg-primary)" opacity="0.9" rx="4"></rect>
                    <text x="420" y="439" text-anchor="middle" fill="var(--text-primary)" font-size="11" font-weight="bold">1 hop</text>

                    <line x1="555" y1="200" x2="715" y2="300" stroke="var(--border)" stroke-width="4" class="rip-link" data-link="E-G"></line>
                    <rect x="615" y="235" width="70" height="20" fill="var(--bg-primary)" opacity="0.9" rx="4"></rect>
                    <text x="650" y="249" text-anchor="middle" fill="var(--text-primary)" font-size="11" font-weight="bold">1 hop</text>

                    <line x1="555" y1="400" x2="715" y2="300" stroke="var(--border)" stroke-width="4" class="rip-link" data-link="F-G"></line>
                    <rect x="615" y="335" width="70" height="20" fill="var(--bg-primary)" opacity="0.9" rx="4"></rect>
                    <text x="650" y="349" text-anchor="middle" fill="var(--text-primary)" font-size="11" font-weight="bold">1 hop</text>

                    <!-- Warning box -->
                    <g transform="translate(810, 50)">
                        <rect x="0" y="0" width="170" height="140" fill="#e74c3c" opacity="0.1" stroke="#e74c3c" stroke-width="2" rx="8"></rect>
                        <text x="85" y="20" text-anchor="middle" fill="#e74c3c" font-weight="bold" font-size="14">⚠️ RIP Problem</text>
                        <text x="10" y="45" fill="var(--text-primary)" font-size="10">RIP sees ALL paths</text>
                        <text x="10" y="60" fill="var(--text-primary)" font-size="10">as equal (3 hops)</text>
                        <text x="10" y="80" fill="var(--text-primary)" font-size="10">It cannot tell the</text>
                        <text x="10" y="95" fill="var(--text-primary)" font-size="10">difference between:</text>
                        <text x="10" y="115" fill="#2ecc71" font-size="9">• 10Gbps link</text>
                        <text x="10" y="130" fill="#e74c3c" font-size="9">• 10Mbps link</text>
                    </g>
                </svg>
            </div>

            <div class="rip-controls">
                <button class="btn" onclick="startRIPAnimation()">Start RIP Process</button>
                <button class="btn btn-secondary" onclick="showRIPProblem()">Show RIP's Bad Choice</button>
                <button class="btn btn-secondary" onclick="resetRIP()">Reset</button>
                <button class="fullscreen-toggle" onclick="openFullscreen(document.getElementById(&#39;ripTopology&#39;).parentElement, &#39;RIP Routing - Fullscreen Mode&#39;)">Fullscreen</button>
            </div>

            <div id="ripStatus" class="status-display">
                Click "Start RIP Process" to see how RIP distributes routing information every 30 seconds.
            </div>

            <div class="rip-details-panel">
                <h3>Current Operation</h3>
                <div id="ripStepDetails" class="step-details-content">
                    <p>The animation will demonstrate RIP's distance-vector algorithm and its limitations.</p>
                </div>
            </div>

            <h3>RIP Routing Tables (Hop Count Based)</h3>
            <div class="rip-tables-grid">
                <div class="rip-table-container">
                    <h4>Router A (Source) - RIP Table</h4>
                    <table class="rip-routing-table" id="ripTableA">
                        <thead>
                            <tr>
                                <th>Destination</th>
                                <th>Next Hop</th>
                                <th>Hops</th>
                                <th>Update Timer</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Populated dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <h3>Quiz: Test Your RIP Knowledge</h3>
            <div class="quiz-container">
                <div class="quiz-item">
                    <p><strong>Q: Why is RIP's 15-hop limit a problem for large networks?</strong></p>
                    <button class="btn-small" onclick="showRIPAnswer(1)">Show Answer</button>
                    <div id="ripAnswer1" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> Any destination more than 15 hops away is considered unreachable (metric = 16). This severely limits network size. Large enterprise networks can easily exceed 15 routers in diameter, making RIP unsuitable for such environments.
                    </div>
                </div>

                <div class="quiz-item">
                    <p><strong>Q: What is the "count to infinity" problem in RIP?</strong></p>
                    <button class="btn-small" onclick="showRIPAnswer(2)">Show Answer</button>
                    <div id="ripAnswer2" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> When a network becomes unreachable, routers can get stuck in a loop incrementing the hop count toward infinity. Example: If Router A loses a link, Router B might advertise it back to A with +1 hops, A then advertises it to B with +1 more, etc. RIP uses split horizon and poison reverse to mitigate this.
                    </div>
                </div>

                <div class="quiz-item">
                    <p><strong>Q: Why does RIP choose poorly in our example network?</strong></p>
                    <button class="btn-small" onclick="showRIPAnswer(3)">Show Answer</button>
                    <div id="ripAnswer3" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> RIP only counts hops (routers), not bandwidth or latency. All three paths from A to G have 3 hops, so RIP sees them as equal and might choose the slow 10Mbps path. OSPF's cost metric allows it to always select the fast 10Gbps path, resulting in 1000x better performance.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- STP SECTION -->
    <div class="content-section" id="stp">
        <div class="panel">
            <h2>STP - Spanning Tree Protocol</h2>
            <p>Learn how STP prevents broadcast storms by blocking redundant paths while maintaining network resilience.</p>

            <div class="stp-intro">
                <h3>Why STP?</h3>
                <p>Switches forward broadcast frames out all ports. If there's a loop, broadcasts circulate forever, creating a broadcast storm that crashes the network in seconds. STP prevents this by logically blocking redundant links while keeping them as backups.</p>
            </div>

            <h3>STP Port States</h3>
            <div class="stp-states-grid">
                <div class="stp-state-card blocking">
                    <h4>Blocking</h4>
                    <p>Does not forward frames, prevents loops</p>
                </div>
                <div class="stp-state-card listening">
                    <h4>Listening</h4>
                    <p>Preparing to forward, no data yet</p>
                </div>
                <div class="stp-state-card learning">
                    <h4>Learning</h4>
                    <p>Building MAC table, no forwarding</p>
                </div>
                <div class="stp-state-card forwarding">
                    <h4>Forwarding</h4>
                    <p>Actively forwarding frames</p>
                </div>
            </div>

            <h3>Interactive STP Topology</h3>
            <p style="color: var(--text-muted); font-size: 0.9em; margin-bottom: 15px;">
                This network has redundant paths. Watch STP elect a root bridge and block ports to prevent loops!
            </p>

            <svg id="stpTopology" viewBox="0 0 800 500" style="width: 100%; height: 500px; background: var(--bg-secondary); border-radius: 8px; border: 2px solid var(--border);">
                <!-- Switch A (will become root) -->
                <rect x="320" y="30" width="160" height="80" fill="var(--accent-cyan)" stroke="white" stroke-width="3" class="stp-switch" data-switch="A" rx="8"></rect>
                <text x="400" y="65" text-anchor="middle" fill="white" font-weight="bold" font-size="18">Switch A</text>
                <text x="400" y="85" text-anchor="middle" fill="white" font-size="11" id="switchAStatus">Priority: 4096</text>

                <!-- Switch B -->
                <rect x="80" y="250" width="160" height="80" fill="var(--accent-cyan)" stroke="white" stroke-width="3" class="stp-switch" data-switch="B" rx="8"></rect>
                <text x="160" y="285" text-anchor="middle" fill="white" font-weight="bold" font-size="18">Switch B</text>
                <text x="160" y="305" text-anchor="middle" fill="white" font-size="11" id="switchBStatus">Priority: 32768</text>

                <!-- Switch C -->
                <rect x="560" y="250" width="160" height="80" fill="var(--accent-cyan)" stroke="white" stroke-width="3" class="stp-switch" data-switch="C" rx="8"></rect>
                <text x="640" y="285" text-anchor="middle" fill="white" font-weight="bold" font-size="18">Switch C</text>
                <text x="640" y="305" text-anchor="middle" fill="white" font-size="11" id="switchCStatus">Priority: 32768</text>

                <!-- Links -->
                <line x1="360" y1="110" x2="200" y2="250" stroke="#2ecc71" stroke-width="6" class="stp-link" data-link="A-B" id="linkAB"></line>
                <text x="270" y="170" fill="var(--text-primary)" font-size="12">Cost: 4</text>

                <line x1="440" y1="110" x2="600" y2="250" stroke="#2ecc71" stroke-width="6" class="stp-link" data-link="A-C" id="linkAC"></line>
                <text x="530" y="170" fill="var(--text-primary)" font-size="12">Cost: 4</text>

                <line x1="240" y1="290" x2="560" y2="290" stroke="var(--border)" stroke-width="6" class="stp-link" data-link="B-C" id="linkBC"></line>
                <text x="400" y="280" fill="var(--text-primary)" font-size="12">Cost: 19 (redundant)</text>

                <!-- Port status indicators -->
                <circle cx="200" cy="250" r="12" fill="#2ecc71" class="port-indicator" id="portB1"></circle>
                <text x="200" y="235" text-anchor="middle" fill="var(--text-muted)" font-size="10">FWD</text>

                <circle cx="600" cy="250" r="12" fill="#2ecc71" class="port-indicator" id="portC1"></circle>
                <text x="600" y="235" text-anchor="middle" fill="var(--text-muted)" font-size="10">FWD</text>

                <circle cx="240" cy="290" r="12" fill="#e74c3c" class="port-indicator" id="portB2"></circle>
                <text x="240" y="320" text-anchor="middle" fill="var(--text-muted)" font-size="10">BLK</text>

                <circle cx="560" cy="290" r="12" fill="#95a5a6" class="port-indicator" id="portC2"></circle>
                <text x="560" y="320" text-anchor="middle" fill="var(--text-muted)" font-size="10">BLK</text>

                <!-- Legend -->
                <g transform="translate(20, 400)">
                    <text x="0" y="0" fill="var(--text-primary)" font-weight="bold" font-size="12">Port States:</text>
                    <circle cx="0" cy="15" r="6" fill="#2ecc71"></circle>
                    <text x="12" y="19" fill="var(--text-primary)" font-size="10">Forwarding</text>
                    <circle cx="0" cy="30" r="6" fill="#e74c3c"></circle>
                    <text x="12" y="34" fill="var(--text-primary)" font-size="10">Blocking</text>
                    <circle cx="0" cy="45" r="6" fill="#f39c12"></circle>
                    <text x="12" y="49" fill="var(--text-primary)" font-size="10">Learning</text>
                </g>
            </svg>

            <div class="stp-controls">
                <button class="btn" onclick="startSTPAnimation()">Start STP Process</button>
                <button class="btn btn-secondary" onclick="simulateLinkFailure()">Simulate Link Failure</button>
                <button class="btn btn-secondary" onclick="resetSTP()">Reset</button>
                <button class="fullscreen-toggle" onclick="openFullscreen(document.querySelector(&#39;.stp-demo&#39;), &#39;STP Loop Prevention - Fullscreen Mode&#39;)">Fullscreen</button>
            </div>

            <div id="stpStatus" class="status-display">
                Click "Start STP Process" to see root bridge election and port blocking.
            </div>

            <div class="stp-details-panel">
                <h3>Current Operation</h3>
                <div id="stpStepDetails" class="step-details-content">
                    <p>STP will elect a root bridge, calculate best paths, and block redundant links to prevent loops.</p>
                </div>
            </div>

            <h3>Quiz: Test Your STP Knowledge</h3>
            <div class="quiz-container">
                <div class="quiz-item">
                    <p><strong>Q: What happens if STP is disabled on a network with loops?</strong></p>
                    <button class="btn-small" onclick="showSTPAnswer(1)">Show Answer</button>
                    <div id="stpAnswer1" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> A broadcast storm occurs. Broadcast frames circulate infinitely, multiplying exponentially. This consumes all bandwidth and CPU resources, crashing the network within seconds.
                    </div>
                </div>

                <div class="quiz-item">
                    <p><strong>Q: How does STP choose the root bridge?</strong></p>
                    <button class="btn-small" onclick="showSTPAnswer(2)">Show Answer</button>
                    <div id="stpAnswer2" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> The switch with the lowest Bridge ID becomes root. Bridge ID = Priority (default 32768) + MAC address. Administrators typically set a lower priority (like 4096) on the desired root switch.
                    </div>
                </div>

                <div class="quiz-item">
                    <p><strong>Q: What is the difference between blocking and disabled port states?</strong></p>
                    <button class="btn-small" onclick="showSTPAnswer(3)">Show Answer</button>
                    <div id="stpAnswer3" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> Blocking ports still listen for BPDUs and can transition to forwarding if the primary path fails. Disabled ports are administratively shut down and do not participate in STP at all.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- VLANs SECTION -->
    <div class="content-section" id="vlans">
        <div class="panel">
            <h2>VLANs - Virtual Local Area Networks</h2>
            <p>Learn how VLANs segment networks for security, performance, and manageability.</p>

            <div class="vlan-intro">
                <h3>What are VLANs?</h3>
                <p>VLANs logically segment a physical network into multiple broadcast domains. Devices in different VLANs cannot communicate directly, even if connected to the same switch - they need a router or Layer 3 switch for inter-VLAN routing.</p>

                <h4>Why Use VLANs?</h4>
                <ul>
                    <li><strong>Security:</strong> Isolate sensitive data (HR, Finance) from general users</li>
                    <li><strong>Performance:</strong> Reduce broadcast domain size</li>
                    <li><strong>Flexibility:</strong> Group users logically, not physically</li>
                    <li><strong>Cost Savings:</strong> No need for separate switches per department</li>
                </ul>
            </div>

            <h3>VLAN Configuration Example</h3>
            <div class="vlan-demo-grid">
                <div class="vlan-box vlan-10">
                    <h4>VLAN 10 - Sales</h4>
                    <p>📱 PC1: 192.168.10.10</p>
                    <p>📱 PC2: 192.168.10.11</p>
                    <p>✅ Can communicate</p>
                </div>
                <div class="vlan-box vlan-20">
                    <h4>VLAN 20 - Engineering</h4>
                    <p>💻 PC3: 192.168.20.10</p>
                    <p>💻 PC4: 192.168.20.11</p>
                    <p>✅ Can communicate</p>
                </div>
                <div class="vlan-box vlan-30">
                    <h4>VLAN 30 - HR</h4>
                    <p>🔒 PC5: 192.168.30.10</p>
                    <p>🔒 PC6: 192.168.30.11</p>
                    <p>✅ Can communicate</p>
                </div>
            </div>

            <p style="text-align: center; margin: 20px 0; font-weight: bold; color: var(--accent-cyan);">
                ⚠️ VLAN 10 ↔️ VLAN 20 ↔️ VLAN 30 = ❌ CANNOT communicate without router!
            </p>

            <h3>Interactive VLAN Demonstration</h3>
            <div id="vlanDemo">
                <div class="vlan-switch-container">
                    <div class="vlan-switch">
                        <div class="switch-label">Layer 2 Switch</div>
                        <div class="switch-ports">
                            <div class="port vlan-10">P1 (VLAN 10)</div>
                            <div class="port vlan-10">P2 (VLAN 10)</div>
                            <div class="port vlan-20">P3 (VLAN 20)</div>
                            <div class="port vlan-20">P4 (VLAN 20)</div>
                            <div class="port vlan-30">P5 (VLAN 30)</div>
                            <div class="port trunk">P6 (TRUNK)</div>
                        </div>
                    </div>
                </div>

                <div class="vlan-controls">
                    <button class="btn" onclick="testVLANComm(&#39;same&#39;)">Test Same VLAN (10→10)</button>
                    <button class="btn btn-secondary" onclick="testVLANComm(&#39;different&#39;)">Test Different VLAN (10→20)</button>
                    <button class="btn btn-secondary" onclick="showTrunkDemo()">Show Trunk Link</button>
                    <button class="fullscreen-toggle" onclick="openFullscreen(document.getElementById(&#39;vlanDemo&#39;), &#39;VLAN Segmentation - Fullscreen Mode&#39;)">Fullscreen</button>
                </div>

                <div id="vlanStatus" class="status-display">
                    Click buttons to see VLAN isolation in action.
                </div>

                <div id="vlanStepDetails" class="vlan-details-panel" style="display:none;">
                    <h3>Result</h3>
                    <div class="step-details-content"></div>
                </div>
            </div>

            <h3>Cisco IOS VLAN Commands</h3>
            <div class="command-box">
                <pre><code># Create VLAN
Switch(config)# vlan 10
Switch(config-vlan)# name Sales

# Assign port to VLAN
Switch(config)# interface fa0/1
Switch(config-if)# switchport mode access
Switch(config-if)# switchport access vlan 10

# Configure trunk (carries multiple VLANs)
Switch(config)# interface gi0/1
Switch(config-if)# switchport mode trunk
Switch(config-if)# switchport trunk allowed vlan 10,20,30

# Verify
Switch# show vlan brief
Switch# show interfaces trunk</code></pre>
            </div>

            <h3>Quiz: Test Your VLAN Knowledge</h3>
            <div class="quiz-container">
                <div class="quiz-item">
                    <p><strong>Q: Can PC in VLAN 10 ping PC in VLAN 20 on the same switch?</strong></p>
                    <button class="btn-small" onclick="showVLANAnswer(1)">Show Answer</button>
                    <div id="vlanAnswer1" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> NO! Even though they're on the same physical switch, VLANs create separate broadcast domains. They need a Layer 3 device (router or Layer 3 switch) to communicate. This is the whole point of VLANs - traffic isolation!
                    </div>
                </div>

                <div class="quiz-item">
                    <p><strong>Q: What is a trunk port?</strong></p>
                    <button class="btn-small" onclick="showVLANAnswer(2)">Show Answer</button>
                    <div id="vlanAnswer2" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> A trunk port carries traffic for multiple VLANs simultaneously using VLAN tagging (802.1Q). It's used to connect switches together or connect a switch to a router for inter-VLAN routing. Each frame gets a VLAN ID tag added to identify which VLAN it belongs to.
                    </div>
                </div>

                <div class="quiz-item">
                    <p><strong>Q: What is the native VLAN on a trunk?</strong></p>
                    <button class="btn-small" onclick="showVLANAnswer(3)">Show Answer</button>
                    <div id="vlanAnswer3" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> The native VLAN (default VLAN 1) is the VLAN whose frames are NOT tagged when sent across a trunk. This is for backward compatibility with non-VLAN-aware devices. It's a security best practice to change the native VLAN from default and never use it for user traffic.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- NETWORK ALGORITHMS SECTION -->
    <div class="content-section" id="algorithms">
        <div class="panel">
            <h2>Network Algorithms - Core Concepts</h2>
            <p>Understanding the algorithms that power modern networks is essential for network administrators. These algorithms enable routing decisions, loop prevention, and optimal path selection.</p>

            <div class="algo-intro">
                <h3>Why Study Network Algorithms?</h3>
                <p>Network algorithms are the mathematical foundation behind protocols you've already learned:</p>
                <ul>
                    <li><strong>OSPF uses Dijkstra's Algorithm</strong> - Finds shortest path based on cost</li>
                    <li><strong>RIP uses Bellman-Ford</strong> - Distance vector routing with hop count</li>
                    <li><strong>STP uses Prim's/Kruskal's</strong> - Minimum spanning tree to prevent loops</li>
                    <li><strong>BGP uses Path Vector</strong> - Internet-scale routing with policy control</li>
                </ul>
            </div>

            <h3>Algorithm Comparison</h3>
            <table class="algo-comparison-table">
                <thead>
                    <tr>
                        <th>Algorithm</th>
                        <th>Type</th>
                        <th>Time Complexity</th>
                        <th>Used By</th>
                        <th>Best For</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Dijkstra's</strong></td>
                        <td>Link-State</td>
                        <td><span class="complexity-badge complexity-medium">O(V²) or O(E log V)</span></td>
                        <td>OSPF, IS-IS</td>
                        <td>Weighted graphs, single source shortest path</td>
                    </tr>
                    <tr>
                        <td><strong>Bellman-Ford</strong></td>
                        <td>Distance-Vector</td>
                        <td><span class="complexity-badge complexity-bad">O(V × E)</span></td>
                        <td>RIP, BGP (variant)</td>
                        <td>Negative weights, distributed routing</td>
                    </tr>
                    <tr>
                        <td><strong>Floyd-Warshall</strong></td>
                        <td>All-Pairs Shortest</td>
                        <td><span class="complexity-badge complexity-bad">O(V³)</span></td>
                        <td>SDN controllers</td>
                        <td>Finding all shortest paths</td>
                    </tr>
                    <tr>
                        <td><strong>Prim's/Kruskal's</strong></td>
                        <td>Minimum Spanning Tree</td>
                        <td><span class="complexity-badge complexity-good">O(E log V)</span></td>
                        <td>STP, RSTP</td>
                        <td>Loop-free network topology</td>
                    </tr>
                </tbody>
            </table>

            <h3>Interactive Dijkstra's Algorithm Visualization</h3>
            <p>Watch how OSPF finds the shortest path from router A to all other routers using Dijkstra's algorithm.</p>

            <div class="algo-visualization">
                <div id="dijkstraGraph" class="graph-container">
                    <!-- Graph will be drawn here -->
                </div>

                <div class="algo-controls">
                    <button class="btn" onclick="startDijkstra()">Run Dijkstra's Algorithm</button>
                    <button class="btn btn-secondary" onclick="stepDijkstra()">Step Through</button>
                    <button class="btn btn-secondary" onclick="resetDijkstra()">Reset</button>
                    <button class="btn" onclick="compareBellmanFord()">Compare with Bellman-Ford</button>
                    <button class="fullscreen-toggle" onclick="openFullscreen(document.querySelector(&#39;.algo-visualization&#39;), &#39;Dijkstra Algorithm - Fullscreen Mode&#39;)">Fullscreen</button>
                </div>

                <div id="algoStatus" class="status-display" style="margin-top: 15px;">
                    Click "Run Dijkstra's Algorithm" to visualize shortest path calculation.
                </div>

                <div id="algoSteps" class="algo-steps">
                    <strong>Algorithm Steps:</strong>
                    <div id="stepsList"></div>
                </div>
            </div>

            <h3>How Dijkstra's Works (OSPF's SPF)</h3>
            <div class="algo-grid">
                <div class="algo-card">
                    <h4>Step 1: Initialize</h4>
                    <p>Set distance to source = 0, all others = ∞. Mark all nodes unvisited.</p>
                    <code style="display: block; margin-top: 10px; color: var(--accent-teal);">
                        dist[A] = 0<br>
                        dist[B,C,D,E,F] = ∞
                    </code>
                </div>
                <div class="algo-card">
                    <h4>Step 2: Visit Nearest</h4>
                    <p>Select unvisited node with smallest distance. Mark it visited.</p>
                    <code style="display: block; margin-top: 10px; color: var(--accent-teal);">
                        current = min(unvisited)<br>
                        mark current as visited
                    </code>
                </div>
                <div class="algo-card">
                    <h4>Step 3: Update Neighbors</h4>
                    <p>For each neighbor, calculate distance through current node. Update if shorter.</p>
                    <code style="display: block; margin-top: 10px; color: var(--accent-teal);">
                        new_dist = dist[current] + cost<br>
                        if new_dist &lt; dist[neighbor]:<br>
                        &nbsp;&nbsp;dist[neighbor] = new_dist
                    </code>
                </div>
                <div class="algo-card">
                    <h4>Step 4: Repeat</h4>
                    <p>Continue until all nodes visited or target reached.</p>
                    <code style="display: block; margin-top: 10px; color: var(--accent-teal);">
                        while unvisited_nodes:<br>
                        &nbsp;&nbsp;go to step 2
                    </code>
                </div>
            </div>

            <h3>Bellman-Ford Algorithm (RIP)</h3>
            <div class="algo-visualization">
                <p><strong>Key Difference:</strong> Bellman-Ford relaxes ALL edges V-1 times, while Dijkstra greedily selects the minimum.</p>

                <div style="background: var(--bg-primary); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h4 style="color: var(--accent-cyan);">Bellman-Ford Pseudocode:</h4>
                    <pre style="color: var(--text-primary); margin: 10px 0;"><code>function BellmanFord(Graph, source):
    // Initialize distances
    for each vertex v in Graph:
        distance[v] = INFINITY
        predecessor[v] = NULL
    distance[source] = 0

    // Relax edges repeatedly
    for i = 1 to size(Graph) - 1:
        for each edge (u, v) with weight w in Graph:
            if distance[u] + w &lt; distance[v]:
                distance[v] = distance[u] + w
                predecessor[v] = u

    // Check for negative-weight cycles
    for each edge (u, v) with weight w in Graph:
        if distance[u] + w &lt; distance[v]:
            error "Graph contains negative-weight cycle"</code></pre>
                </div>

                <div class="algo-grid">
                    <div class="algo-card">
                        <h4>✅ Advantages</h4>
                        <ul>
                            <li>Handles negative weights</li>
                            <li>Detects negative cycles</li>
                            <li>Simple distributed implementation</li>
                            <li>Works with distance-vector protocols</li>
                        </ul>
                    </div>
                    <div class="algo-card">
                        <h4>❌ Disadvantages</h4>
                        <ul>
                            <li>Slower than Dijkstra (O(V×E) vs O(E log V))</li>
                            <li>Count-to-infinity problem</li>
                            <li>Slow convergence</li>
                            <li>More bandwidth for updates</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3>Spanning Tree Algorithms (STP)</h3>
            <div class="algo-visualization">
                <p>STP uses minimum spanning tree algorithms to create a loop-free topology. Two common algorithms:</p>

                <div class="algo-grid">
                    <div class="algo-card">
                        <h4>Prim's Algorithm</h4>
                        <p><strong>Approach:</strong> Grow tree from a single vertex</p>
                        <ol style="margin-left: 20px; margin-top: 10px;">
                            <li>Start with root bridge (lowest Bridge ID)</li>
                            <li>Add cheapest edge connecting tree to non-tree vertex</li>
                            <li>Repeat until all vertices included</li>
                        </ol>
                        <p style="margin-top: 10px;"><strong>Complexity:</strong> <span class="complexity-badge complexity-good">O(E log V)</span></p>
                    </div>
                    <div class="algo-card">
                        <h4>Kruskal's Algorithm</h4>
                        <p><strong>Approach:</strong> Sort edges and add if no cycle</p>
                        <ol style="margin-left: 20px; margin-top: 10px;">
                            <li>Sort all edges by cost (low to high)</li>
                            <li>Add edge if it doesn't create a cycle</li>
                            <li>Use Union-Find to detect cycles</li>
                        </ol>
                        <p style="margin-top: 10px;"><strong>Complexity:</strong> <span class="complexity-badge complexity-good">O(E log E)</span></p>
                    </div>
                </div>

                <div style="background: rgba(6, 182, 212, 0.1); padding: 15px; border-left: 4px solid var(--accent-cyan); margin: 20px 0; border-radius: 4px;">
                    <strong>STP Implementation:</strong> Switches exchange BPDUs (Bridge Protocol Data Units) to elect root and calculate port costs. The distributed algorithm converges to a spanning tree without needing global knowledge.
                </div>
            </div>

            <h3>Real-World Application Scenarios</h3>
            <div class="algo-grid">
                <div class="algo-card">
                    <h4>🌐 OSPF Network</h4>
                    <p><strong>Scenario:</strong> 100-router enterprise network</p>
                    <p><strong>Algorithm:</strong> Dijkstra's SPF</p>
                    <p><strong>Why:</strong> Fast convergence (sub-second), supports VLSM, hierarchical design with areas.</p>
                    <p style="margin-top: 10px;"><strong>Calculation:</strong> Each router runs SPF independently. With 100 routers and average degree 4, O(E log V) ≈ 400 log 100 ≈ 2,400 operations.</p>
                </div>
                <div class="algo-card">
                    <h4>🏢 Small Office Network</h4>
                    <p><strong>Scenario:</strong> 3 routers, simple topology</p>
                    <p><strong>Algorithm:</strong> RIP (Bellman-Ford variant)</p>
                    <p><strong>Why:</strong> Easy to configure, no OSPF complexity needed, max 15 hops sufficient.</p>
                    <p style="margin-top: 10px;"><strong>Caveat:</strong> Slow convergence (30-60 sec). Modern networks prefer OSPF even at small scale.</p>
                </div>
                <div class="algo-card">
                    <h4>🔄 Redundant Switch Fabric</h4>
                    <p><strong>Scenario:</strong> Data center with mesh topology</p>
                    <p><strong>Algorithm:</strong> RSTP (Rapid STP using MST)</p>
                    <p><strong>Why:</strong> Prevents broadcast storms, sub-second failover, multiple spanning trees per VLAN.</p>
                    <p style="margin-top: 10px;"><strong>Trade-off:</strong> Some links blocked, but network remains stable. Modern alternative: TRILL, SPB.</p>
                </div>
            </div>

            <h3>Quiz: Network Algorithms</h3>
            <div class="quiz-section">
                <div class="quiz-item">
                    <p><strong>Q: Why does OSPF use Dijkstra instead of Bellman-Ford?</strong></p>
                    <button class="btn-small" onclick="showAlgoAnswer(1)">Show Answer</button>
                    <div id="algoAnswer1" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> Dijkstra's is faster (O(E log V) vs O(V×E)) and OSPF is a link-state protocol where each router has complete topology knowledge. This allows each router to independently run SPF. Dijkstra also doesn't suffer from count-to-infinity problems. Bellman-Ford is better for distance-vector protocols where routers only know neighbors.
                    </div>
                </div>

                <div class="quiz-item">
                    <p><strong>Q: What is the "count-to-infinity" problem in Bellman-Ford/RIP?</strong></p>
                    <button class="btn-small" onclick="showAlgoAnswer(2)">Show Answer</button>
                    <div id="algoAnswer2" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> When a network fails, routers using distance-vector may form routing loops where they increment hop counts indefinitely. Example: Router A thinks B has path to network (2 hops), B thinks A has path (2 hops). When network fails, they keep advertising each other's routes with increasing metrics until max (16 = unreachable in RIP). Solutions: split horizon, poison reverse, hold-down timers.
                    </div>
                </div>

                <div class="quiz-item">
                    <p><strong>Q: In a network with 50 routers, how many times does each router run Dijkstra's in OSPF?</strong></p>
                    <button class="btn-small" onclick="showAlgoAnswer(3)">Show Answer</button>
                    <div id="algoAnswer3" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> Each router runs SPF once with itself as the root to compute shortest paths to all destinations. SPF runs again when topology changes (link up/down, new router). In stable state: 1 run per router. During convergence: potentially multiple runs per router, but modern OSPF implementations throttle SPF recalculations (default 5-10 sec intervals) to prevent CPU thrashing.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ANSIBLE AUTOMATION SECTION -->
    <div class="content-section" id="ansible">
        <div class="panel">
            <h2>Ansible - Agentless Network Automation</h2>
            <p>Learn how Ansible simplifies network configuration management, deployment, and orchestration through simple, human-readable YAML playbooks.</p>

            <div class="automation-intro">
                <h3>What is Ansible?</h3>
                <p><strong>Ansible</strong> is an open-source automation platform that uses SSH to configure and manage network devices, servers, and cloud infrastructure without requiring agents on target systems.</p>

                <h4>Why Network Admins Use Ansible:</h4>
                <ul>
                    <li><strong>Agentless:</strong> No software to install on managed devices - uses SSH/WinRM</li>
                    <li><strong>Simple Syntax:</strong> YAML-based playbooks are human-readable</li>
                    <li><strong>Idempotent:</strong> Running the same playbook multiple times produces the same result</li>
                    <li><strong>Vendor Support:</strong> Modules for Cisco, Juniper, Arista, Palo Alto, and more</li>
                    <li><strong>Scalability:</strong> Manage 1 device or 10,000 with the same code</li>
                </ul>
            </div>

            <h3>Core Ansible Concepts</h3>
            <div class="automation-grid">
                <div class="automation-card">
                    <h4><span class="automation-icon">📋</span> Inventory</h4>
                    <p>List of managed hosts grouped logically (routers, switches, firewalls).</p>
                    <code style="display: block; margin-top: 10px; color: var(--text-secondary);">
                        /etc/ansible/hosts<br>
                        or custom inventory.ini
                    </code>
                </div>
                <div class="automation-card">
                    <h4><span class="automation-icon">📖</span> Playbooks</h4>
                    <p>YAML files defining tasks to execute on hosts.</p>
                    <code style="display: block; margin-top: 10px; color: var(--text-secondary);">
                        configure_network.yml<br>
                        Contains plays and tasks
                    </code>
                </div>
                <div class="automation-card">
                    <h4><span class="automation-icon">🧩</span> Modules</h4>
                    <p>Pre-built units of automation (ios_command, nxos_config, etc.).</p>
                    <code style="display: block; margin-top: 10px; color: var(--text-secondary);">
                        cisco.ios.ios_config<br>
                        ansible.netcommon.cli_command
                    </code>
                </div>
                <div class="automation-card">
                    <h4><span class="automation-icon">🎭</span> Roles</h4>
                    <p>Reusable collections of tasks, variables, and templates.</p>
                    <code style="display: block; margin-top: 10px; color: var(--text-secondary);">
                        roles/router-baseline/<br>
                        ├── tasks/<br>
                        ├── templates/<br>
                        └── vars/
                    </code>
                </div>
            </div>

            <h3>Ansible Inventory Example</h3>
            <div class="inventory-display">
                <div class="playbook-editor">
                    <pre><code><span class="yaml-comment"># /etc/ansible/hosts - Inventory File</span>

<span class="yaml-key">[routers]</span>
<span class="yaml-value">router1.example.com</span> <span class="yaml-key">ansible_host=</span><span class="yaml-string">192.168.1.1</span>
<span class="yaml-value">router2.example.com</span> <span class="yaml-key">ansible_host=</span><span class="yaml-string">192.168.1.2</span>

<span class="yaml-key">[switches]</span>
<span class="yaml-value">switch1.example.com</span> <span class="yaml-key">ansible_host=</span><span class="yaml-string">192.168.1.10</span>
<span class="yaml-value">switch2.example.com</span> <span class="yaml-key">ansible_host=</span><span class="yaml-string">192.168.1.11</span>

<span class="yaml-key">[firewalls]</span>
<span class="yaml-value">firewall1.example.com</span> <span class="yaml-key">ansible_host=</span><span class="yaml-string">192.168.1.254</span>

<span class="yaml-comment"># Group variables</span>
<span class="yaml-key">[routers:vars]</span>
<span class="yaml-key">ansible_network_os=</span><span class="yaml-string">ios</span>
<span class="yaml-key">ansible_user=</span><span class="yaml-string">admin</span>
<span class="yaml-key">ansible_connection=</span><span class="yaml-string">network_cli</span></code></pre>
                </div>

                <button class="btn" onclick="testInventory()">Test Inventory Connectivity</button>

                <div id="inventoryResult" style="margin-top: 15px;"></div>
            </div>

            <h3>Interactive Playbook Execution</h3>
            <p>Watch how Ansible executes a network configuration playbook across multiple devices:</p>

            <div class="playbook-editor">
                <pre><code><span class="yaml-comment">---</span>
<span class="yaml-comment"># configure_routers.yml - Ansible Playbook</span>

<span class="yaml-key">- name:</span> <span class="yaml-string">Configure Cisco Routers</span>
  <span class="yaml-key">hosts:</span> <span class="yaml-value">routers</span>
  <span class="yaml-key">gather_facts:</span> <span class="yaml-value">no</span>
  <span class="yaml-key">connection:</span> <span class="yaml-value">network_cli</span>

  <span class="yaml-key">tasks:</span>
    <span class="yaml-key">- name:</span> <span class="yaml-string">Set hostname</span>
      <span class="yaml-key">cisco.ios.ios_config:</span>
        <span class="yaml-key">lines:</span>
          <span class="yaml-key">-</span> <span class="yaml-string">hostname {{ inventory_hostname }}</span>

    <span class="yaml-key">- name:</span> <span class="yaml-string">Configure NTP servers</span>
      <span class="yaml-key">cisco.ios.ios_config:</span>
        <span class="yaml-key">lines:</span>
          <span class="yaml-key">-</span> <span class="yaml-string">ntp server 10.0.0.1</span>
          <span class="yaml-key">-</span> <span class="yaml-string">ntp server 10.0.0.2</span>

    <span class="yaml-key">- name:</span> <span class="yaml-string">Enable OSPF routing</span>
      <span class="yaml-key">cisco.ios.ios_config:</span>
        <span class="yaml-key">lines:</span>
          <span class="yaml-key">-</span> <span class="yaml-string">router ospf 1</span>
          <span class="yaml-key">-</span> <span class="yaml-string">network 192.168.0.0 0.0.255.255 area 0</span>

    <span class="yaml-key">- name:</span> <span class="yaml-string">Save configuration</span>
      <span class="yaml-key">cisco.ios.ios_command:</span>
        <span class="yaml-key">commands:</span>
          <span class="yaml-key">-</span> <span class="yaml-string">write memory</span></code></pre>
            </div>

            <div style="margin: 20px 0;">
                <button class="btn" onclick="runPlaybook()">Run Playbook</button>
                <button class="btn btn-secondary" onclick="resetPlaybook()">Reset</button>
                <button class="fullscreen-toggle" onclick="openFullscreen(document.querySelector(&#39;.playbook-editor&#39;).parentElement.parentElement, &#39;Ansible Playbook - Fullscreen Mode&#39;)">Fullscreen</button>
            </div>

            <h4>Execution Flow:</h4>
            <div id="playbookFlow" class="execution-flow">
                <div class="flow-step" id="step1">Gather Facts</div>
                <div class="flow-arrow">→</div>
                <div class="flow-step" id="step2">Task 1: Hostname</div>
                <div class="flow-arrow">→</div>
                <div class="flow-step" id="step3">Task 2: NTP</div>
                <div class="flow-arrow">→</div>
                <div class="flow-step" id="step4">Task 3: OSPF</div>
                <div class="flow-arrow">→</div>
                <div class="flow-step" id="step5">Task 4: Save</div>
            </div>

            <div id="playbookStatus" class="status-display" style="margin-top: 15px;">
                Click "Run Playbook" to execute automation tasks.
            </div>

            <div id="playbookOutput" style="margin-top: 20px; background: #1a1a2e; border: 2px solid var(--border); border-radius: 8px; padding: 15px; font-family: monospace; color: #e0e0e0; max-height: 300px; overflow-y: auto; display: none;">
                <strong style="color: var(--accent-cyan);">PLAY RECAP:</strong>
                <div id="outputContent"></div>
            </div>

            <h3>Popular Ansible Network Modules</h3>
            <div class="module-showcase">
                <div class="module-card">
                    <h5>cisco.ios.ios_config</h5>
                    <p>Configure Cisco IOS devices</p>
                    <div class="module-example">
lines:<br>
&nbsp;&nbsp;- interface GigabitEthernet0/1<br>
&nbsp;&nbsp;- ip address 10.0.0.1 255.255.255.0<br>
&nbsp;&nbsp;- no shutdown
                    </div>
                </div>
                <div class="module-card">
                    <h5>cisco.ios.ios_command</h5>
                    <p>Execute show commands</p>
                    <div class="module-example">
commands:<br>
&nbsp;&nbsp;- show ip interface brief<br>
&nbsp;&nbsp;- show running-config
                    </div>
                </div>
                <div class="module-card">
                    <h5>cisco.ios.ios_vlan</h5>
                    <p>Manage VLANs</p>
                    <div class="module-example">
vlan_id: 10<br>
name: Sales<br>
state: active
                    </div>
                </div>
                <div class="module-card">
                    <h5>cisco.nxos.nxos_bgp</h5>
                    <p>Configure BGP on Nexus</p>
                    <div class="module-example">
asn: 65001<br>
router_id: 1.1.1.1<br>
state: present
                    </div>
                </div>
                <div class="module-card">
                    <h5>arista.eos.eos_interfaces</h5>
                    <p>Manage Arista interfaces</p>
                    <div class="module-example">
name: Ethernet1<br>
description: "Uplink"<br>
enabled: true
                    </div>
                </div>
                <div class="module-card">
                    <h5>junipernetworks.junos.junos_config</h5>
                    <p>Configure Juniper devices</p>
                    <div class="module-example">
lines:<br>
&nbsp;&nbsp;- set interfaces ge-0/0/0<br>
&nbsp;&nbsp;- set unit 0 family inet
                    </div>
                </div>
            </div>

            <h3>Real-World Use Cases</h3>
            <div class="automation-grid">
                <div class="automation-card">
                    <h4>🔄 Configuration Backup</h4>
                    <p><strong>Scenario:</strong> Daily backup of all router configs to Git</p>
                    <p><strong>Playbook:</strong> Fetches running-config, commits to repository with timestamp</p>
                    <p><strong>Value:</strong> Version control, quick rollback, audit trail</p>
                </div>
                <div class="automation-card">
                    <h4>🚀 Zero-Touch Provisioning</h4>
                    <p><strong>Scenario:</strong> New switch arrives, auto-configures based on role</p>
                    <p><strong>Playbook:</strong> Detects device, applies VLAN/port configs from templates</p>
                    <p><strong>Value:</strong> Onboarding time: 2 hours → 5 minutes</p>
                </div>
                <div class="automation-card">
                    <h4>🔒 Security Compliance</h4>
                    <p><strong>Scenario:</strong> Enforce password policy across 500 devices</p>
                    <p><strong>Playbook:</strong> Sets min length, complexity, rotation</p>
                    <p><strong>Value:</strong> Manual: 500 hours → Ansible: 10 minutes</p>
                </div>
                <div class="automation-card">
                    <h4>🩺 Health Checks</h4>
                    <p><strong>Scenario:</strong> Weekly audit of interface status, CPU, memory</p>
                    <p><strong>Playbook:</strong> Collects stats, alerts on thresholds</p>
                    <p><strong>Value:</strong> Proactive issue detection, trend analysis</p>
                </div>
            </div>

            <h3>Ansible vs Chef vs Puppet</h3>
            <table class="algo-comparison-table">
                <thead>
                    <tr>
                        <th>Feature</th>
                        <th style="color: #ee0000;">Ansible</th>
                        <th style="color: #f09820;">Chef</th>
                        <th style="color: #ffae1a;">Puppet</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Architecture</strong></td>
                        <td>Agentless (SSH)</td>
                        <td>Agent-based (Chef Client)</td>
                        <td>Agent-based (Puppet Agent)</td>
                    </tr>
                    <tr>
                        <td><strong>Language</strong></td>
                        <td>YAML (declarative)</td>
                        <td>Ruby DSL (procedural)</td>
                        <td>Puppet DSL (declarative)</td>
                    </tr>
                    <tr>
                        <td><strong>Learning Curve</strong></td>
                        <td><span class="complexity-badge complexity-good">Easy</span></td>
                        <td><span class="complexity-badge complexity-bad">Steep</span></td>
                        <td><span class="complexity-badge complexity-medium">Moderate</span></td>
                    </tr>
                    <tr>
                        <td><strong>Setup Time</strong></td>
                        <td>Minutes</td>
                        <td>Hours (agent install)</td>
                        <td>Hours (agent install)</td>
                    </tr>
                    <tr>
                        <td><strong>Best For</strong></td>
                        <td>Network devices, quick deployments</td>
                        <td>Large-scale server automation</td>
                        <td>Infrastructure as Code, compliance</td>
                    </tr>
                    <tr>
                        <td><strong>Scalability</strong></td>
                        <td>Good (10K+ nodes with Tower)</td>
                        <td>Excellent (100K+ nodes)</td>
                        <td>Excellent (100K+ nodes)</td>
                    </tr>
                    <tr>
                        <td><strong>Community</strong></td>
                        <td>Very large (Red Hat backed)</td>
                        <td>Large (Progress Software)</td>
                        <td>Large (Perforce/Puppet Inc)</td>
                    </tr>
                </tbody>
            </table>

            <h3>Ansible Pros &amp; Cons</h3>
            <div class="pros-cons">
                <div class="pros-box">
                    <h4 style="color: var(--success); margin-bottom: 10px;">✅ Advantages</h4>
                    <ul style="margin-left: 20px;">
                        <li>No agents required - works over SSH</li>
                        <li>YAML syntax is human-readable and easy to learn</li>
                        <li>Idempotent operations prevent configuration drift</li>
                        <li>Huge module library (5,000+ modules)</li>
                        <li>Strong network vendor support (Cisco, Juniper, Arista)</li>
                        <li>Fast to deploy - install Ansible, run playbooks</li>
                        <li>Active community and excellent documentation</li>
                        <li>Tower/AWX provides GUI and RBAC for enterprises</li>
                    </ul>
                </div>
                <div class="cons-box">
                    <h4 style="color: var(--error); margin-bottom: 10px;">❌ Disadvantages</h4>
                    <ul style="margin-left: 20px;">
                        <li>Sequential execution can be slower than parallel agents</li>
                        <li>SSH overhead for very large deployments (10K+ hosts)</li>
                        <li>YAML indentation errors can be frustrating</li>
                        <li>Limited Windows support compared to Linux</li>
                        <li>No built-in reporting (need Tower/AWX)</li>
                        <li>Pull model requires cron/scheduler (push is default)</li>
                        <li>Variable precedence can be confusing</li>
                    </ul>
                </div>
            </div>

            <h3>Getting Started with Ansible</h3>
            <div class="command-box">
                <pre><code># Install Ansible (Ubuntu/Debian)
sudo apt update
sudo apt install ansible

# Install Ansible (Red Hat/CentOS)
sudo yum install ansible

# Install Ansible (macOS)
brew install ansible

# Verify installation
ansible --version

# Test connectivity to hosts
ansible all -m ping -i inventory.ini

# Run ad-hoc command
ansible routers -m ios_command -a "commands='show version'" -i inventory.ini

# Execute playbook
ansible-playbook configure_routers.yml -i inventory.ini

# Check playbook syntax
ansible-playbook configure_routers.yml --syntax-check

# Dry run (check mode)
ansible-playbook configure_routers.yml --check</code></pre>
            </div>

            <h3>Quiz: Ansible Automation</h3>
            <div class="quiz-section">
                <div class="quiz-item">
                    <p><strong>Q: What makes Ansible "agentless" and why does this matter for network devices?</strong></p>
                    <button class="btn-small" onclick="showAnsibleAnswer(1)">Show Answer</button>
                    <div id="ansibleAnswer1" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> Ansible uses SSH (or WinRM for Windows) to communicate with managed hosts, meaning no agent software needs to be installed on target devices. This is crucial for network devices (routers, switches, firewalls) because: 1) Many network OS versions don't support agent installation, 2) Security policies often prohibit installing third-party software on network infrastructure, 3) Agentless means no agent updates/maintenance, and 4) Works immediately with any SSH-enabled device.
                    </div>
                </div>

                <div class="quiz-item">
                    <p><strong>Q: What does "idempotent" mean in Ansible, and why is it important?</strong></p>
                    <button class="btn-small" onclick="showAnsibleAnswer(2)">Show Answer</button>
                    <div id="ansibleAnswer2" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> Idempotent means running the same playbook multiple times produces the same end state without unintended side effects. Example: If a playbook sets hostname to "Router1", running it again won't change anything if hostname is already "Router1". Importance: 1) Safe to re-run playbooks without breaking things, 2) Prevents configuration drift, 3) "Apply desired state" instead of "execute commands", and 4) Makes automation predictable and reliable. Non-idempotent would be: "add VLAN 10" executed 5 times might create duplicates or errors.
                    </div>
                </div>

                <div class="quiz-item">
                    <p><strong>Q: When would you choose Ansible over Chef or Puppet for network automation?</strong></p>
                    <button class="btn-small" onclick="showAnsibleAnswer(3)">Show Answer</button>
                    <div id="ansibleAnswer3" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> Choose Ansible for network automation when: 1) Managing network devices (routers, switches, firewalls) - most have native Ansible modules but can't run agents, 2) Quick deployment needed - Ansible installs in minutes vs hours for Chef/Puppet, 3) Team has limited coding experience - YAML is easier than Ruby DSL, 4) Agentless architecture is required - common in security-conscious environments, 5) Budget constraints - Ansible core is free, Chef/Puppet enterprise can be expensive. Chef/Puppet better for: massive server fleets (100K+), complex dependency management, strict compliance reporting needs.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CHEF AUTOMATION SECTION -->
    <div class="content-section" id="chef">
        <div class="panel">
            <h2>Chef - Infrastructure as Code with Ruby</h2>
            <p>Learn how Chef uses Ruby DSL and a client-server architecture to automate infrastructure provisioning, configuration, and compliance at enterprise scale.</p>

            <div class="automation-intro">
                <h3>What is Chef?</h3>
                <p><strong>Chef</strong> is a powerful configuration management tool that treats infrastructure as code using a Ruby-based Domain Specific Language (DSL). Chef uses a pull model where agents (Chef Client) on managed nodes periodically check in with a central server (Chef Server) to receive and apply configuration policies.</p>

                <h4>Key Chef Characteristics:</h4>
                <ul>
                    <li><strong>Agent-Based:</strong> Chef Client runs on managed nodes</li>
                    <li><strong>Pull Model:</strong> Nodes pull configurations from Chef Server</li>
                    <li><strong>Ruby DSL:</strong> Recipes written in Ruby</li>
                    <li><strong>Enterprise Scale:</strong> Manages 100K+ servers</li>
                    <li><strong>Test-Driven:</strong> Test Kitchen and ChefSpec for testing</li>
                </ul>
            </div>

            <h3>Chef Architecture</h3>
            <div class="automation-grid">
                <div class="automation-card">
                    <h4><span class="automation-icon">🖥️</span> Chef Workstation</h4>
                    <p>Where administrators author cookbooks and interact with Chef infrastructure.</p>
                    <code style="display: block; margin-top: 10px; color: var(--text-secondary);">
                        knife - CLI tool<br>
                        chef-repo - local repo
                    </code>
                </div>
                <div class="automation-card">
                    <h4><span class="automation-icon">🏢</span> Chef Server</h4>
                    <p>Central hub that stores cookbooks, node data, and policies.</p>
                    <code style="display: block; margin-top: 10px; color: var(--text-secondary);">
                        Hosted Chef (SaaS)<br>
                        Chef Infra Server (on-prem)
                    </code>
                </div>
                <div class="automation-card">
                    <h4><span class="automation-icon">📡</span> Chef Client</h4>
                    <p>Agent running on managed nodes that applies configurations.</p>
                    <code style="display: block; margin-top: 10px; color: var(--text-secondary);">
                        chef-client daemon<br>
                        Runs every 30 min (default)
                    </code>
                </div>
                <div class="automation-card">
                    <h4><span class="automation-icon">📚</span> Cookbooks</h4>
                    <p>Collections of recipes, attributes, and resources.</p>
                    <code style="display: block; margin-top: 10px; color: var(--text-secondary);">
                        cookbook/<br>
                        ├── recipes/<br>
                        ├── attributes/<br>
                        └── templates/
                    </code>
                </div>
            </div>

            <h3>Chef Recipe Example</h3>
            <p>Chef recipes are written in Ruby DSL. Here's a typical recipe for configuring a web server:</p>

            <div class="playbook-editor">
                <pre><code><span class="yaml-comment"># cookbook/nginx_server/recipes/default.rb</span>

<span class="yaml-comment"># Install nginx package</span>
<span class="yaml-key">package</span> <span class="yaml-string">'nginx'</span> <span class="yaml-key">do</span>
  <span class="yaml-key">action</span> <span class="yaml-value">:install</span>
<span class="yaml-key">end</span>

<span class="yaml-comment"># Manage nginx service</span>
<span class="yaml-key">service</span> <span class="yaml-string">'nginx'</span> <span class="yaml-key">do</span>
  <span class="yaml-key">action</span> [<span class="yaml-value">:enable</span>, <span class="yaml-value">:start</span>]
  <span class="yaml-key">supports</span> <span class="yaml-key">restart:</span> <span class="yaml-value">true</span>, <span class="yaml-key">reload:</span> <span class="yaml-value">true</span>
<span class="yaml-key">end</span>

<span class="yaml-comment"># Deploy configuration file from template</span>
<span class="yaml-key">template</span> <span class="yaml-string">'/etc/nginx/nginx.conf'</span> <span class="yaml-key">do</span>
  <span class="yaml-key">source</span> <span class="yaml-string">'nginx.conf.erb'</span>
  <span class="yaml-key">owner</span> <span class="yaml-string">'root'</span>
  <span class="yaml-key">group</span> <span class="yaml-string">'root'</span>
  <span class="yaml-key">mode</span> <span class="yaml-string">'0644'</span>
  <span class="yaml-key">notifies</span> <span class="yaml-value">:reload</span>, <span class="yaml-string">'service[nginx]'</span>, <span class="yaml-value">:delayed</span>
<span class="yaml-key">end</span>

<span class="yaml-comment"># Create directory for web content</span>
<span class="yaml-key">directory</span> <span class="yaml-string">'/var/www/html'</span> <span class="yaml-key">do</span>
  <span class="yaml-key">owner</span> <span class="yaml-string">'www-data'</span>
  <span class="yaml-key">group</span> <span class="yaml-string">'www-data'</span>
  <span class="yaml-key">mode</span> <span class="yaml-string">'0755'</span>
  <span class="yaml-key">recursive</span> <span class="yaml-value">true</span>
<span class="yaml-key">end</span>

<span class="yaml-comment"># Deploy index.html</span>
<span class="yaml-key">file</span> <span class="yaml-string">'/var/www/html/index.html'</span> <span class="yaml-key">do</span>
  <span class="yaml-key">content</span> <span class="yaml-string">'&lt;h1&gt;Managed by Chef&lt;/h1&gt;'</span>
  <span class="yaml-key">mode</span> <span class="yaml-string">'0644'</span>
  <span class="yaml-key">owner</span> <span class="yaml-string">'www-data'</span>
<span class="yaml-key">end</span></code></pre>
            </div>

            <h3>Interactive Chef Client Run</h3>
            <p>Watch how Chef Client converges node configuration by applying recipes:</p>

            <div style="margin: 20px 0;">
                <button class="btn" onclick="runChefClient()">Run chef-client</button>
                <button class="btn btn-secondary" onclick="resetChefClient()">Reset</button>
                <button class="fullscreen-toggle" onclick="openFullscreen(document.getElementById(&#39;chefFlow&#39;).parentElement.parentElement, &#39;Chef Client Run - Fullscreen Mode&#39;)">Fullscreen</button>
            </div>

            <h4>Chef Client Run Phases:</h4>
            <div id="chefFlow" class="execution-flow">
                <div class="flow-step" id="chefStep1">Authenticate</div>
                <div class="flow-arrow">→</div>
                <div class="flow-step" id="chefStep2">Sync Cookbooks</div>
                <div class="flow-arrow">→</div>
                <div class="flow-step" id="chefStep3">Load Recipes</div>
                <div class="flow-arrow">→</div>
                <div class="flow-step" id="chefStep4">Converge</div>
                <div class="flow-arrow">→</div>
                <div class="flow-step" id="chefStep5">Report</div>
            </div>

            <div id="chefStatus" class="status-display" style="margin-top: 15px;">
                Click "Run chef-client" to execute a convergence cycle.
            </div>

            <div id="chefOutput" style="margin-top: 20px; background: #1a1a2e; border: 2px solid var(--border); border-radius: 8px; padding: 15px; font-family: monospace; color: #e0e0e0; max-height: 300px; overflow-y: auto; display: none;">
                <div id="chefOutputContent"></div>
            </div>

            <h3>Chef Resources (Building Blocks)</h3>
            <div class="module-showcase">
                <div class="module-card">
                    <h5>package</h5>
                    <p>Manage packages (apt, yum, etc.)</p>
                    <div class="module-example">
package 'apache2' do<br>
&nbsp;&nbsp;action :install<br>
end
                    </div>
                </div>
                <div class="module-card">
                    <h5>service</h5>
                    <p>Manage system services</p>
                    <div class="module-example">
service 'sshd' do<br>
&nbsp;&nbsp;action [:enable, :start]<br>
end
                    </div>
                </div>
                <div class="module-card">
                    <h5>template</h5>
                    <p>Deploy config from ERB templates</p>
                    <div class="module-example">
template '/etc/config.conf' do<br>
&nbsp;&nbsp;source 'config.erb'<br>
&nbsp;&nbsp;variables({...})<br>
end
                    </div>
                </div>
                <div class="module-card">
                    <h5>file</h5>
                    <p>Manage file content</p>
                    <div class="module-example">
file '/tmp/test.txt' do<br>
&nbsp;&nbsp;content 'Hello Chef'<br>
&nbsp;&nbsp;mode '0644'<br>
end
                    </div>
                </div>
                <div class="module-card">
                    <h5>directory</h5>
                    <p>Create and manage directories</p>
                    <div class="module-example">
directory '/opt/app' do<br>
&nbsp;&nbsp;recursive true<br>
&nbsp;&nbsp;mode '0755'<br>
end
                    </div>
                </div>
                <div class="module-card">
                    <h5>execute</h5>
                    <p>Run arbitrary commands</p>
                    <div class="module-example">
execute 'update-cache' do<br>
&nbsp;&nbsp;command 'apt-get update'<br>
&nbsp;&nbsp;only_if {condition}<br>
end
                    </div>
                </div>
            </div>

            <h3>Chef Workflow</h3>
            <div class="automation-grid">
                <div class="automation-card">
                    <h4>1️⃣ Develop</h4>
                    <p>Create cookbooks on workstation</p>
                    <code style="display: block; margin-top: 10px; color: var(--text-secondary); font-size: 0.85em;">
                        $ chef generate cookbook myapp<br>
                        $ cd myapp<br>
                        $ chef generate recipe default
                    </code>
                </div>
                <div class="automation-card">
                    <h4>2️⃣ Test</h4>
                    <p>Test locally with Test Kitchen</p>
                    <code style="display: block; margin-top: 10px; color: var(--text-secondary); font-size: 0.85em;">
                        $ kitchen create<br>
                        $ kitchen converge<br>
                        $ kitchen verify
                    </code>
                </div>
                <div class="automation-card">
                    <h4>3️⃣ Upload</h4>
                    <p>Upload to Chef Server with knife</p>
                    <code style="display: block; margin-top: 10px; color: var(--text-secondary); font-size: 0.85em;">
                        $ knife cookbook upload myapp<br>
                        $ knife node run_list add node1 'recipe[myapp]'
                    </code>
                </div>
                <div class="automation-card">
                    <h4>4️⃣ Converge</h4>
                    <p>Chef Client runs and applies config</p>
                    <code style="display: block; margin-top: 10px; color: var(--text-secondary); font-size: 0.85em;">
                        # On managed node<br>
                        $ sudo chef-client<br>
                        [Convergence happens]
                    </code>
                </div>
            </div>

            <h3>Chef vs Ansible: When to Choose Chef</h3>
            <div class="pros-cons">
                <div class="pros-box">
                    <h4 style="color: var(--success); margin-bottom: 10px;">✅ Choose Chef When:</h4>
                    <ul style="margin-left: 20px;">
                        <li>Managing 10K+ servers (Chef scales better)</li>
                        <li>Need complex dependency resolution</li>
                        <li>Team has Ruby expertise</li>
                        <li>Require test-driven infrastructure (Test Kitchen)</li>
                        <li>Want pull model for autonomous convergence</li>
                        <li>Need built-in compliance scanning (Chef InSpec)</li>
                        <li>Managing heterogeneous OS environments</li>
                        <li>Complex application orchestration needed</li>
                    </ul>
                </div>
                <div class="cons-box">
                    <h4 style="color: var(--error); margin-bottom: 10px;">❌ Chef May Not Be Ideal When:</h4>
                    <ul style="margin-left: 20px;">
                        <li>Team lacks Ruby knowledge (steep learning curve)</li>
                        <li>Managing network devices (agent install not possible)</li>
                        <li>Need quick wins (setup takes hours vs Ansible minutes)</li>
                        <li>Small environment (&lt;100 servers)</li>
                        <li>Limited budget (enterprise support is expensive)</li>
                        <li>Prefer push model for immediate changes</li>
                        <li>Simple configuration needs</li>
                    </ul>
                </div>
            </div>

            <h3>Chef Knife Commands</h3>
            <div class="command-box">
                <pre><code># Bootstrap a new node
knife bootstrap 192.168.1.10 -U admin -P password --node-name node1

# List cookbooks on Chef Server
knife cookbook list

# Upload cookbook
knife cookbook upload myapp

# Show node details
knife node show node1

# Set node run list
knife node run_list add node1 'recipe[myapp::default]'

# Search for nodes
knife search node "platform:ubuntu"

# Test SSH connectivity
knife ssh "name:web*" "uptime" -x admin

# Download cookbook from Supermarket
knife supermarket download nginx

# Delete node from Chef Server
knife node delete node1 -y

# Check cookbook syntax
knife cookbook test myapp</code></pre>
            </div>

            <h3>Real-World Chef Use Cases</h3>
            <div class="automation-grid">
                <div class="automation-card">
                    <h4>🏢 Enterprise Server Fleet</h4>
                    <p><strong>Scenario:</strong> 50,000 servers across data centers</p>
                    <p><strong>Chef Solution:</strong> Central Chef Server, automated patching, compliance scanning with InSpec</p>
                    <p><strong>Result:</strong> 99.99% configuration compliance, automated security updates</p>
                </div>
                <div class="automation-card">
                    <h4>☁️ Cloud Migration</h4>
                    <p><strong>Scenario:</strong> Migrate on-prem apps to AWS/Azure</p>
                    <p><strong>Chef Solution:</strong> Platform-agnostic cookbooks, cloud-specific recipes</p>
                    <p><strong>Result:</strong> Consistent config across on-prem and cloud</p>
                </div>
                <div class="automation-card">
                    <h4>🔧 Application Deployment</h4>
                    <p><strong>Scenario:</strong> Deploy complex multi-tier Java app</p>
                    <p><strong>Chef Solution:</strong> Cookbooks for Tomcat, MySQL, Nginx with proper ordering</p>
                    <p><strong>Result:</strong> Repeatable deployments, environment parity</p>
                </div>
                <div class="automation-card">
                    <h4>📋 Compliance Auditing</h4>
                    <p><strong>Scenario:</strong> PCI-DSS compliance for payment systems</p>
                    <p><strong>Chef Solution:</strong> Chef InSpec profiles for automated audits</p>
                    <p><strong>Result:</strong> Continuous compliance, audit reports on-demand</p>
                </div>
            </div>

            <h3>Quiz: Chef Automation</h3>
            <div class="quiz-section">
                <div class="quiz-item">
                    <p><strong>Q: What is the difference between Chef's pull model and Ansible's push model?</strong></p>
                    <button class="btn-small" onclick="showChefAnswer(1)">Show Answer</button>
                    <div id="chefAnswer1" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> Chef uses a <strong>pull model</strong>: Chef Client agents run on managed nodes and periodically (default 30 min) pull their desired configuration from Chef Server, then apply changes autonomously. Ansible uses a <strong>push model</strong>: The control node pushes configurations to managed hosts over SSH when you run a playbook. Trade-offs: Pull = autonomous healing, better for large scale, continues even if control node is down. Push = immediate changes, simpler architecture, no agents required. Chef is "eventual consistency", Ansible is "immediate consistency".
                    </div>
                </div>

                <div class="quiz-item">
                    <p><strong>Q: Why does Chef use Ruby DSL instead of YAML like Ansible?</strong></p>
                    <button class="btn-small" onclick="showChefAnswer(2)">Show Answer</button>
                    <div id="chefAnswer2" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> Chef uses Ruby DSL (Domain Specific Language) because it provides: 1) Full programming capabilities (loops, conditionals, variables) making recipes more powerful than declarative YAML, 2) Ability to leverage Ruby gems and libraries, 3) Dynamic resource generation at runtime, 4) Complex logic for dependency resolution. Trade-off: Steeper learning curve (must know Ruby basics) vs Ansible's simple YAML. Example: In Chef you can write `node['applications'].each do |app| install app end` which is harder in pure YAML. Chef's philosophy: "infrastructure as code" means real code, not just data.
                    </div>
                </div>

                <div class="quiz-item">
                    <p><strong>Q: What is "convergence" in Chef and why is it important?</strong></p>
                    <button class="btn-small" onclick="showChefAnswer(3)">Show Answer</button>
                    <div id="chefAnswer3" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                        <strong>Answer:</strong> <strong>Convergence</strong> is the process where Chef Client brings the node's actual state into alignment with the desired state defined in recipes. During convergence, Chef: 1) Builds a resource collection from recipes, 2) Resolves dependencies, 3) Executes resources in order, 4) Takes action only if current state != desired state (idempotency). Importance: Ensures configuration drift is corrected automatically. If an admin manually changes a config file, the next Chef run will revert it to the desired state. This "self-healing" infrastructure is Chef's core value proposition. Without convergence, manual changes would accumulate and cause environment inconsistencies.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TOPOLOGY BUILDER SECTION -->
    <div class="content-section active" id="topology">
        <div class="panel">
            <h2>Network Topology Builder</h2>
            <p class="section-intro">Build realistic network topologies with professional-grade features including intelligent cable detection, interface-level configuration, Cisco IOS CLI simulation, and visual connectivity status indicators.</p>

            <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; border-left: 4px solid var(--accent-cyan); margin-bottom: 25px;">
                <h3 style="margin-top: 0; color: var(--accent-cyan);">📘 Quick Start Guide</h3>

                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--accent-green); margin-bottom: 10px;">1️⃣ Placing Devices</h4>
                    <ol style="margin: 0; padding-left: 20px; line-height: 1.8;">
                        <li>Select a device type from the <strong>Device Palette</strong> (Router, Switch, Computer, Server, or Firewall)</li>
                        <li>Click the <strong>🔧 Place Device</strong> button to enter placement mode</li>
                        <li>Click anywhere on the gray canvas to place your device</li>
                        <li>Repeat to add more devices to your network</li>
                    </ol>
                    <p style="margin: 10px 0 0 0; padding: 10px; background: rgba(16, 185, 129, 0.1); border-radius: 4px; font-size: 0.9em;">
                        <strong>💡 Tip:</strong> Each device is automatically assigned a unique hostname (e.g., Router742, Switch891) and comes with realistic network interfaces pre-configured.
                    </p>
                </div>

                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--accent-green); margin-bottom: 10px;">2️⃣ Configuring Devices</h4>
                    <ol style="margin: 0; padding-left: 20px; line-height: 1.8;">
                        <li>Click the <strong>⚙️ Configure</strong> button to enter configuration mode</li>
                        <li>Click on any device to open the <strong>Device Configuration Modal</strong></li>
                        <li>Use the three tabs to configure different aspects:</li>
                    </ol>
                    <ul style="margin: 10px 0 0 40px; padding: 0; line-height: 1.8;">
                        <li><strong>Basic Tab:</strong> Set hostname and description</li>
                        <li><strong>Interfaces Tab:</strong> Configure IP addresses, subnet masks, and interface status for each port</li>
                        <li><strong>CLI Tab:</strong> Use authentic Cisco IOS commands in a simulated command-line interface</li>
                    </ul>
                    <p style="margin: 10px 0 0 0; padding: 10px; background: rgba(16, 185, 129, 0.1); border-radius: 4px; font-size: 0.9em;">
                        <strong>💡 Tip:</strong> Interfaces must be configured with IP addresses in the same subnet to communicate. Don't forget to set the status to "Up" for active interfaces!
                    </p>
                </div>

                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--accent-green); margin-bottom: 10px;">3️⃣ Connecting Devices</h4>
                    <ol style="margin: 0; padding-left: 20px; line-height: 1.8;">
                        <li>Click the <strong>🔗 Connect</strong> button to enter connection mode</li>
                        <li>Choose a cable type from the selector that appears:
                            <ul style="margin: 5px 0; padding-left: 20px;">
                                <li><strong>🔌 Auto:</strong> Automatically selects the correct cable type (recommended for beginners)</li>
                                <li><strong>━ Straight-Through:</strong> Connects different device types (router ↔ switch, switch ↔ computer)</li>
                                <li><strong>╳ Crossover:</strong> Connects same device types (router ↔ router, switch ↔ switch, computer ↔ computer)</li>
                                <li><strong>⚡ Serial:</strong> WAN connections between routers (Serial interfaces)</li>
                                <li><strong>💡 Fiber:</strong> High-speed optical connections (GigabitEthernet/10GigabitEthernet)</li>
                            </ul>
                        </li>
                        <li>Click the <strong>first device</strong> and select which interface to use</li>
                        <li>Click the <strong>second device</strong> and select its interface</li>
                        <li>The cable is created with intelligent routing and visual status indicators</li>
                    </ol>
                    <p style="margin: 10px 0 0 0; padding: 10px; background: rgba(16, 185, 129, 0.1); border-radius: 4px; font-size: 0.9em;">
                        <strong>💡 Tip:</strong> Watch the cable color change! Gray = not configured, Orange = partial config, Green = fully operational, Red = interface down.
                    </p>
                </div>

                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--accent-green); margin-bottom: 10px;">4️⃣ Testing Connectivity</h4>
                    <ol style="margin: 0; padding-left: 20px; line-height: 1.8;">
                        <li>Click the <strong>🔍 Test Network</strong> button</li>
                        <li>Review the connectivity report showing:
                            <ul style="margin: 5px 0; padding-left: 20px;">
                                <li>Total devices and connections</li>
                                <li>Active vs. down interfaces</li>
                                <li>Properly configured IP addresses</li>
                                <li>Reachability between devices on the same subnet</li>
                            </ul>
                        </li>
                    </ol>
                </div>

                <div>
                    <h4 style="color: var(--accent-green); margin-bottom: 10px;">5️⃣ Other Operations</h4>
                    <ul style="margin: 0; padding-left: 20px; line-height: 1.8;">
                        <li><strong>🗑️ Delete Mode:</strong> Click button, then click devices to remove them</li>
                        <li><strong>Clear All:</strong> Removes all devices and connections (use with caution!)</li>
                    </ul>
                </div>
            </div>

            <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; border-left: 4px solid var(--accent-purple); margin-bottom: 25px;">
                <h3 style="margin-top: 0; color: var(--accent-purple);">🎯 Device Types &amp; Capabilities</h3>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;">
                    <div style="background: var(--bg-primary); padding: 15px; border-radius: 6px; border: 1px solid var(--border);">
                        <h4 style="margin: 0 0 10px 0;">📡 Router</h4>
                        <p style="margin: 0 0 10px 0; font-size: 0.9em; color: var(--text-secondary);">Layer 3 device for inter-network routing</p>
                        <strong style="font-size: 0.85em; color: var(--accent-cyan);">Default Interfaces:</strong>
                        <ul style="margin: 5px 0 0 0; padding-left: 20px; font-size: 0.85em; line-height: 1.6;">
                            <li>GigabitEthernet0/0 (Gi0/0)</li>
                            <li>GigabitEthernet0/1 (Gi0/1)</li>
                            <li>Serial0/0/0 (Se0/0/0) - WAN</li>
                        </ul>
                        <p style="margin: 10px 0 0 0; font-size: 0.85em;"><strong>Use for:</strong> Routing between different networks/subnets</p>
                    </div>

                    <div style="background: var(--bg-primary); padding: 15px; border-radius: 6px; border: 1px solid var(--border);">
                        <h4 style="margin: 0 0 10px 0;">🔀 Switch</h4>
                        <p style="margin: 0 0 10px 0; font-size: 0.9em; color: var(--text-secondary);">Layer 2 device for LAN connectivity</p>
                        <strong style="font-size: 0.85em; color: var(--accent-cyan);">Default Interfaces:</strong>
                        <ul style="margin: 5px 0 0 0; padding-left: 20px; font-size: 0.85em; line-height: 1.6;">
                            <li>FastEthernet0/1-4 (Fa0/1-4)</li>
                            <li>GigabitEthernet0/1 (Gi0/1) - Uplink</li>
                        </ul>
                        <p style="margin: 10px 0 0 0; font-size: 0.85em;"><strong>Use for:</strong> Connecting multiple devices in the same network</p>
                    </div>

                    <div style="background: var(--bg-primary); padding: 15px; border-radius: 6px; border: 1px solid var(--border);">
                        <h4 style="margin: 0 0 10px 0;">💻 Computer</h4>
                        <p style="margin: 0 0 10px 0; font-size: 0.9em; color: var(--text-secondary);">End-user workstation device</p>
                        <strong style="font-size: 0.85em; color: var(--accent-cyan);">Default Interfaces:</strong>
                        <ul style="margin: 5px 0 0 0; padding-left: 20px; font-size: 0.85em; line-height: 1.6;">
                            <li>Ethernet0 (Eth0)</li>
                        </ul>
                        <p style="margin: 10px 0 0 0; font-size: 0.85em;"><strong>Use for:</strong> Client endpoints in your network</p>
                    </div>

                    <div style="background: var(--bg-primary); padding: 15px; border-radius: 6px; border: 1px solid var(--border);">
                        <h4 style="margin: 0 0 10px 0;">🖥️ Server</h4>
                        <p style="margin: 0 0 10px 0; font-size: 0.9em; color: var(--text-secondary);">Network service provider (web, DNS, DHCP)</p>
                        <strong style="font-size: 0.85em; color: var(--accent-cyan);">Default Interfaces:</strong>
                        <ul style="margin: 5px 0 0 0; padding-left: 20px; font-size: 0.85em; line-height: 1.6;">
                            <li>Ethernet0 (Eth0)</li>
                        </ul>
                        <p style="margin: 10px 0 0 0; font-size: 0.85em;"><strong>Use for:</strong> Hosting network services</p>
                    </div>

                    <div style="background: var(--bg-primary); padding: 15px; border-radius: 6px; border: 1px solid var(--border);">
                        <h4 style="margin: 0 0 10px 0;">🔥 Firewall</h4>
                        <p style="margin: 0 0 10px 0; font-size: 0.9em; color: var(--text-secondary);">Network security and access control</p>
                        <strong style="font-size: 0.85em; color: var(--accent-cyan);">Default Interfaces:</strong>
                        <ul style="margin: 5px 0 0 0; padding-left: 20px; font-size: 0.85em; line-height: 1.6;">
                            <li>Outside (External network)</li>
                            <li>Inside (Internal network)</li>
                            <li>DMZ (Demilitarized zone)</li>
                        </ul>
                        <p style="margin: 10px 0 0 0; font-size: 0.85em;"><strong>Use for:</strong> Securing network perimeters</p>
                    </div>
                </div>
            </div>

            <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; border-left: 4px solid var(--accent-orange); margin-bottom: 25px;">
                <h3 style="margin-top: 0; color: var(--accent-orange);">🔌 Cable Types &amp; Smart Detection</h3>

                <table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">
                    <thead>
                        <tr style="background: var(--bg-primary); border-bottom: 2px solid var(--border);">
                            <th style="padding: 12px; text-align: left; border: 1px solid var(--border);">Cable Type</th>
                            <th style="padding: 12px; text-align: left; border: 1px solid var(--border);">Icon</th>
                            <th style="padding: 12px; text-align: left; border: 1px solid var(--border);">Used For</th>
                            <th style="padding: 12px; text-align: left; border: 1px solid var(--border);">Auto-Detection Logic</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid var(--border);">
                            <td style="padding: 12px; border: 1px solid var(--border);"><strong>Auto</strong></td>
                            <td style="padding: 12px; border: 1px solid var(--border);">🔌</td>
                            <td style="padding: 12px; border: 1px solid var(--border);">Let the system choose the correct cable</td>
                            <td style="padding: 12px; border: 1px solid var(--border);">Analyzes device types and interfaces to select optimal cable</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border);">
                            <td style="padding: 12px; border: 1px solid var(--border);"><strong>Straight-Through</strong></td>
                            <td style="padding: 12px; border: 1px solid var(--border);">━</td>
                            <td style="padding: 12px; border: 1px solid var(--border);">Connecting different device types</td>
                            <td style="padding: 12px; border: 1px solid var(--border);">Router↔Switch, Switch↔Computer, Router↔Computer</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border);">
                            <td style="padding: 12px; border: 1px solid var(--border);"><strong>Crossover</strong></td>
                            <td style="padding: 12px; border: 1px solid var(--border);">╳</td>
                            <td style="padding: 12px; border: 1px solid var(--border);">Connecting same device types</td>
                            <td style="padding: 12px; border: 1px solid var(--border);">Router↔Router, Switch↔Switch, Computer↔Computer</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border);">
                            <td style="padding: 12px; border: 1px solid var(--border);"><strong>Serial</strong></td>
                            <td style="padding: 12px; border: 1px solid var(--border);">⚡</td>
                            <td style="padding: 12px; border: 1px solid var(--border);">WAN connections (long distance)</td>
                            <td style="padding: 12px; border: 1px solid var(--border);">Detected when connecting Serial interfaces (Se0/0/0)</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid var(--border);"><strong>Fiber Optic</strong></td>
                            <td style="padding: 12px; border: 1px solid var(--border);">💡</td>
                            <td style="padding: 12px; border: 1px solid var(--border);">High-speed connections</td>
                            <td style="padding: 12px; border: 1px solid var(--border);">Used for GigabitEthernet uplinks and long-distance LAN</td>
                        </tr>
                    </tbody>
                </table>

                <div style="margin-top: 15px; padding: 12px; background: rgba(249, 115, 22, 0.1); border-radius: 4px;">
                    <strong style="color: var(--accent-orange);">📊 Visual Status Indicators:</strong>
                    <ul style="margin: 8px 0 0 0; padding-left: 20px; line-height: 1.8;">
                        <li><strong style="color: #64748b;">⚫ Gray:</strong> Default state - interfaces not configured</li>
                        <li><strong style="color: #f97316;">🟠 Orange:</strong> Partial configuration - one interface configured, other not</li>
                        <li><strong style="color: #10b981;">🟢 Green:</strong> Fully operational - both interfaces up with valid IPs in same subnet</li>
                        <li><strong style="color: #ef4444;">🔴 Red:</strong> Connection down - one or both interfaces set to "Down" status</li>
                    </ul>
                </div>
            </div>

            <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; border-left: 4px solid var(--accent-green); margin-bottom: 25px;">
                <h3 style="margin-top: 0; color: var(--accent-green);">⌨️ CLI Simulator Features</h3>
                <p style="margin: 0 0 15px 0;">The integrated Command Line Interface simulates authentic Cisco IOS behavior for hands-on practice.</p>

                <div style="margin-bottom: 15px;">
                    <h4 style="margin: 0 0 10px 0; font-size: 1em;">Supported Command Modes:</h4>
                    <ul style="margin: 0; padding-left: 20px; line-height: 1.8;">
                        <li><strong>User EXEC Mode (&gt;):</strong> Basic monitoring commands</li>
                        <li><strong>Privileged EXEC Mode (#):</strong> Advanced show commands - access with <code style="background: var(--bg-primary); padding: 2px 6px; border-radius: 3px;">enable</code></li>
                        <li><strong>Global Configuration Mode (config)#:</strong> Device-wide configuration - access with <code style="background: var(--bg-primary); padding: 2px 6px; border-radius: 3px;">configure terminal</code></li>
                        <li><strong>Interface Configuration Mode (config-if)#:</strong> Interface-specific settings - access with <code style="background: var(--bg-primary); padding: 2px 6px; border-radius: 3px;">interface [name]</code></li>
                    </ul>
                </div>

                <div style="margin-bottom: 15px;">
                    <h4 style="margin: 0 0 10px 0; font-size: 1em;">Essential Commands:</h4>
                    <div style="background: var(--bg-primary); padding: 15px; border-radius: 6px; font-family: &#39;Courier New&#39;, monospace; font-size: 0.85em; line-height: 1.8;">
                        <div><span style="color: var(--accent-cyan);">Router&gt;</span> enable</div>
                        <div><span style="color: var(--accent-cyan);">Router#</span> show ip interface brief</div>
                        <div><span style="color: var(--accent-cyan);">Router#</span> show running-config</div>
                        <div><span style="color: var(--accent-cyan);">Router#</span> configure terminal</div>
                        <div><span style="color: var(--accent-cyan);">Router(config)#</span> hostname MyRouter</div>
                        <div><span style="color: var(--accent-cyan);">Router(config)#</span> interface GigabitEthernet0/0</div>
                        <div><span style="color: var(--accent-cyan);">Router(config-if)#</span> ip address 192.168.1.1 255.255.255.0</div>
                        <div><span style="color: var(--accent-cyan);">Router(config-if)#</span> no shutdown</div>
                        <div><span style="color: var(--accent-cyan);">Router(config-if)#</span> exit</div>
                        <div><span style="color: var(--accent-cyan);">Router(config)#</span> exit</div>
                        <div><span style="color: var(--accent-cyan);">Router#</span> copy running-config startup-config</div>
                    </div>
                </div>

                <p style="margin: 15px 0 0 0; padding: 10px; background: rgba(16, 185, 129, 0.1); border-radius: 4px; font-size: 0.9em;">
                    <strong>💡 Pro Tip:</strong> Use <code style="background: var(--bg-primary); padding: 2px 6px; border-radius: 3px;">Tab</code> for command completion and <code style="background: var(--bg-primary); padding: 2px 6px; border-radius: 3px;">?</code> for context-sensitive help!
                </p>
            </div>

            <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; border-left: 4px solid #8b5cf6;">
                <h3 style="margin-top: 0; color: #8b5cf6;">🎓 Practice Scenarios</h3>

                <div style="margin-bottom: 15px;">
                    <h4 style="color: var(--accent-green);">Beginner: Simple LAN</h4>
                    <ol style="margin: 5px 0 0 0; padding-left: 20px; line-height: 1.8;">
                        <li>Place 1 Switch and 3 Computers</li>
                        <li>Configure Switch with IP 192.168.1.1/24</li>
                        <li>Configure Computers with IPs 192.168.1.10, .11, .12 /24</li>
                        <li>Connect all computers to switch ports using Auto cable detection</li>
                        <li>Set all interfaces to "Up" status</li>
                        <li>Test Network - all devices should be green!</li>
                    </ol>
                </div>

                <div style="margin-bottom: 15px;">
                    <h4 style="color: var(--accent-orange);">Intermediate: Router-on-a-Stick</h4>
                    <ol style="margin: 5px 0 0 0; padding-left: 20px; line-height: 1.8;">
                        <li>Place 1 Router, 1 Switch, 2 Computers</li>
                        <li>Configure Router Gi0/0: 192.168.1.1/24</li>
                        <li>Configure PC1: 192.168.1.10/24, PC2: 192.168.1.20/24</li>
                        <li>Connect Router to Switch (straight-through cable)</li>
                        <li>Connect both PCs to Switch</li>
                        <li>Use CLI to set default gateway on PCs</li>
                    </ol>
                </div>

                <div>
                    <h4 style="color: #ef4444;">Advanced: Multi-Network with WAN</h4>
                    <ol style="margin: 5px 0 0 0; padding-left: 20px; line-height: 1.8;">
                        <li>Place 2 Routers, 2 Switches, 4 Computers, 1 Server</li>
                        <li>Network 1: 192.168.1.0/24 (Router1, Switch1, PC1, PC2)</li>
                        <li>Network 2: 192.168.2.0/24 (Router2, Switch2, PC3, Server)</li>
                        <li>WAN Link: Connect Router1 Se0/0/0 to Router2 Se0/0/0 (10.0.0.0/30)</li>
                        <li>Configure routing between networks using CLI</li>
                        <li>Test cross-network connectivity</li>
                    </ol>
                </div>
            </div>

            <div class="topology-container">
                            <div id="devicePropertiesPanel" class="device-properties-panel">
                <h4 id="propertiesTitle">Device Properties</h4>
                <div class="properties-input-group">
                    <label for="deviceName">Device Name:</label>
                    <input type="text" id="deviceName" name="deviceName">
                </div>
                <div class="properties-input-group">
                    <label for="deviceIp">IP Address:</label>
                    <input type="text" id="deviceIp" name="deviceIp">
                </div>
                <button class="btn-save" onclick="saveDeviceProperties()">Save Properties</button>
            </div>
            <h3>Device Palette</h3>
                <div class="device-palette">
                    <div class="device-icon" data-device="router" onclick="selectDevice(&#39;router&#39;)">
                        <div class="device-icon-symbol">📡</div>
                        <div class="device-icon-label">Router</div>
                    </div>
                    <div class="device-icon" data-device="switch" onclick="selectDevice(&#39;switch&#39;)">
                        <div class="device-icon-symbol">🔀</div>
                        <div class="device-icon-label">Switch</div>
                    </div>
                    <div class="device-icon" data-device="computer" onclick="selectDevice(&#39;computer&#39;)">
                        <div class="device-icon-symbol">💻</div>
                        <div class="device-icon-label">Computer</div>
                    </div>
                    <div class="device-icon" data-device="server" onclick="selectDevice(&#39;server&#39;)">
                        <div class="device-icon-symbol">🖥️</div>
                        <div class="device-icon-label">Server</div>
                    </div>
                    <div class="device-icon" data-device="firewall" onclick="selectDevice(&#39;firewall&#39;)">
                        <div class="device-icon-symbol">🔥</div>
                        <div class="device-icon-label">Firewall</div>
                    </div>
                </div>

                <h3>Canvas</h3>
                <div class="topology-canvas-container">
                    <canvas class="topology-canvas" id="topologyCanvas" role="img" aria-label="Interactive network topology builder. Use device buttons above to place routers, switches, computers, servers, and firewalls. Connect devices by selecting Connect mode." width="1689" height="500"></canvas>
                </div>

                <div id="cableSelector" class="cable-selector" style="display: none;">
                    <span style="font-weight: 600; color: var(--text-secondary);">Select Cable Type:</span>
                    <div class="cable-type-option selected" data-cable="auto" onclick="selectCableType(&#39;auto&#39;)">
                        <div class="cable-type-icon">🔌</div>
                        <div class="cable-type-label">Auto</div>
                    </div>
                    <div class="cable-type-option" data-cable="straight" onclick="selectCableType(&#39;straight&#39;)">
                        <div class="cable-type-icon">━</div>
                        <div class="cable-type-label">Straight-Through</div>
                    </div>
                    <div class="cable-type-option" data-cable="crossover" onclick="selectCableType(&#39;crossover&#39;)">
                        <div class="cable-type-icon">╳</div>
                        <div class="cable-type-label">Crossover</div>
                    </div>
                    <div class="cable-type-option" data-cable="serial" onclick="selectCableType(&#39;serial&#39;)">
                        <div class="cable-type-icon">⚡</div>
                        <div class="cable-type-label">Serial</div>
                    </div>
                    <div class="cable-type-option" data-cable="fiber" onclick="selectCableType(&#39;fiber&#39;)">
                        <div class="cable-type-icon">💡</div>
                        <div class="cable-type-label">Fiber</div>
                    </div>
                </div>

                <div class="topology-controls">
                    <button class="btn" onclick="setTopologyMode(&#39;place&#39;)">🔧 Place Device</button>
                    <button class="btn btn-secondary" onclick="setTopologyMode(&#39;configure&#39;)">⚙️ Configure</button>
                    <button class="btn btn-secondary" onclick="setTopologyMode(&#39;connect&#39;)">🔗 Connect</button>
                    <button class="btn btn-secondary" onclick="setTopologyMode(&#39;delete&#39;)">🗑️ Delete</button>
                    <button class="btn btn-secondary" onclick="clearTopology()">Clear All</button>
                    <button class="btn" onclick="testConnectivity()">🔍 Test Network</button>
                </div>

                <div id="topologyStatus" class="mt-20" style="padding: 15px; background: var(--bg-primary); border-radius: 6px; border: 1px solid var(--border);">
                    <p>Click a device type, then click on the canvas to place it. Use Configure mode to set IP addresses and interfaces.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- DEVICE CONFIGURATION MODAL -->
    <div id="deviceConfigModal" class="device-config-modal">
        <div class="device-config-content">
            <div class="device-config-header">
                <div style="display: flex; align-items: center;">
                    <span id="configDeviceIcon" class="device-icon-large">📡</span>
                    <h2 id="configDeviceTitle">Device Configuration</h2>
                </div>
                <button class="fullscreen-close" onclick="closeDeviceConfig()">✕</button>
            </div>

            <div class="config-tabs">
                <button class="config-tab active" onclick="switchConfigTab(&#39;basic&#39;)">Basic</button>
                <button class="config-tab" onclick="switchConfigTab(&#39;interfaces&#39;)">Interfaces</button>
                <button class="config-tab" onclick="switchConfigTab(&#39;cli&#39;)">CLI</button>
            </div>

            <!-- BASIC CONFIG TAB -->
            <div id="basicConfig" class="config-section active">
                <div class="config-form-group">
                    <label for="deviceHostname">Hostname</label>
                    <input type="text" id="deviceHostname" placeholder="e.g., Router1, Switch-Core, PC-1">
                </div>
                <div class="config-form-group">
                    <label for="deviceType">Device Type</label>
                    <select id="deviceType" disabled="">
                        <option value="router">Router</option>
                        <option value="switch">Switch</option>
                        <option value="computer">Computer</option>
                        <option value="server">Server</option>
                        <option value="firewall">Firewall</option>
                    </select>
                </div>
            </div>

            <!-- INTERFACES TAB -->
            <div id="interfacesConfig" class="config-section">
                <div id="interfaceList" class="interface-list">
                    <!-- Interfaces will be dynamically generated -->
                </div>
            </div>

            <!-- CLI TAB -->
            <div id="cliConfig" class="config-section">
                <div class="cli-terminal" id="cliTerminal">
                    <div class="cli-output" id="cliOutput"></div>
                    <div class="cli-input-line">
                        <span class="cli-prompt" id="cliPrompt">Device&gt;</span>
                        <input type="text" class="cli-input" id="cliInput" placeholder="Enter command...">
                    </div>
                </div>
                <div style="font-size: 0.9em; color: var(--text-secondary);">
                    <strong>Available commands:</strong> show ip interface brief, show running-config, show interfaces,
                    configure terminal, interface [name], ip address [ip] [mask], no shutdown, exit
                </div>
            </div>

            <div class="config-actions">
                <button class="btn btn-secondary" onclick="closeDeviceConfig()">Cancel</button>
                <button class="btn" onclick="saveDeviceConfig()">Save Configuration</button>
            </div>
        </div>
    </div>

    <!-- PACKET FLOW SECTION -->
    <div class="content-section" id="packet-flow">
        <div class="panel">
            <h2>Packet Flow Visualizer</h2>
            <p>Understand how packets travel through a network, including ARP and routing decisions.</p>

            <div class="packet-flow-container" id="packetFlowContainer" role="img" aria-label="Network packet flow visualization showing devices: PC1, switches, routers, and server. Packets travel from left to right through the network."><div class="connection-line" style="left: 122.4px; top: 100px; width: 260.1px; transform: rotate(0deg);"></div><div class="connection-line" style="left: 382.5px; top: 100px; width: 260.1px; transform: rotate(0deg);"></div><div class="connection-line" style="left: 642.6px; top: 100px; width: 244.8px; transform: rotate(0deg);"></div><div class="connection-line" style="left: 887.4px; top: 100px; width: 260.1px; transform: rotate(0deg);"></div><div class="connection-line" style="left: 1147.5px; top: 100px; width: 260.1px; transform: rotate(0deg);"></div><div class="network-node" style="left: 72.4px; top: 50px;">
                    <div style="font-size: 2em; margin-bottom: 5px;">💻</div>
                    <div style="font-size: 0.8em; white-space: pre-line; text-align: center;">PC1
192.168.1.10</div>
                </div><div class="network-node" style="left: 332.5px; top: 50px;">
                    <div style="font-size: 2em; margin-bottom: 5px;">🔀</div>
                    <div style="font-size: 0.8em; white-space: pre-line; text-align: center;">Switch</div>
                </div><div class="network-node" style="left: 592.6px; top: 50px;">
                    <div style="font-size: 2em; margin-bottom: 5px;">📡</div>
                    <div style="font-size: 0.8em; white-space: pre-line; text-align: center;">Router
192.168.1.1</div>
                </div><div class="network-node" style="left: 837.4px; top: 50px;">
                    <div style="font-size: 2em; margin-bottom: 5px;">📡</div>
                    <div style="font-size: 0.8em; white-space: pre-line; text-align: center;">Router
10.0.0.1</div>
                </div><div class="network-node" style="left: 1097.5px; top: 50px;">
                    <div style="font-size: 2em; margin-bottom: 5px;">🔀</div>
                    <div style="font-size: 0.8em; white-space: pre-line; text-align: center;">Switch</div>
                </div><div class="network-node" style="left: 1357.6px; top: 50px;">
                    <div style="font-size: 2em; margin-bottom: 5px;">🖥️</div>
                    <div style="font-size: 0.8em; white-space: pre-line; text-align: center;">Server
10.0.0.100</div>
                </div></div>

            <div class="tcp-controls" style="margin-top: 20px;">
                <button class="btn" onclick="demonstrateARP()">Demonstrate ARP</button>
                <button class="btn btn-secondary" onclick="demonstrateRouting()">Demonstrate Routing</button>
                <button class="btn btn-secondary" onclick="demonstrateFullPath()">Full Packet Journey</button>
                <button class="btn btn-secondary" onclick="resetPacketFlow()">Reset</button>
            </div>

            <div id="packetFlowDescription" class="tcp-step-description" style="margin-top: 20px;">
                <p>Select a demonstration to visualize packet flow through the network.</p>
            </div>

            <div style="margin-top: 30px; padding: 20px; background: var(--bg-primary); border-radius: 8px; border: 1px solid var(--border);">
                <h3>Packet Flow Concepts:</h3>
                <div style="margin-top: 15px;">
                    <div class="result-item">
                        <span class="result-label">ARP (Address Resolution Protocol)</span>
                        <span class="result-value">Maps IP addresses to MAC addresses</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Routing Decision</span>
                        <span class="result-value">Router determines next hop based on routing table</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Switching</span>
                        <span class="result-value">Layer 2 forwarding using MAC addresses</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Encapsulation</span>
                        <span class="result-value">Headers added at each OSI layer</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- QUIZZES SECTION -->
    <div class="content-section" id="quizzes">
        <div class="panel">
            <h2>Interactive Quizzes</h2>
            <p>Test your knowledge with quizzes covering each week of the curriculum.</p>

            <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                <button class="btn" onclick="loadQuiz(1)">Week 1 Quiz</button>
                <button class="btn btn-secondary" onclick="loadQuiz(2)">Week 2 Quiz</button>
                <button class="btn btn-secondary" onclick="loadQuiz(3)">Week 3 Quiz</button>
            </div>

            <div id="quizContainer" class="quiz-container hidden">
                <div class="quiz-question" id="quizQuestion"></div>
                <div class="quiz-options" id="quizOptions"></div>
                <div id="quizFeedback" class="hidden"></div>
                <button class="btn mt-20 hidden" id="nextQuestionBtn" onclick="nextQuestion()">Next Question</button>
            </div>

            <div id="quizScore" class="quiz-score hidden">
                <h3>Quiz Complete!</h3>
                <p id="scoreText"></p>
                <button class="btn mt-20" onclick="resetQuiz()">Start Over</button>
            </div>

            <div id="quizPlaceholder" class="text-center" style="padding: 40px; color: var(--text-secondary);">
                <p>Select a week to begin the quiz</p>
            </div>
        </div>
    </div>

    <!-- CHEAT SHEET SECTION -->
    <div class="content-section" id="cheat-sheet">
        <div class="panel">
            <h2>Network Admin Cheat Sheet</h2>
            <p>Quick reference for common commands, protocols, and concepts.</p>

            <h3>Cisco IOS Commands</h3>
            <div class="cheat-sheet">
                <div class="cheat-card">
                    <h4>Basic Navigation</h4>
                    <ul>
                        <li><code>enable</code> - Privileged EXEC mode</li>
                        <li><code>configure terminal</code> - Global config</li>
                        <li><code>exit</code> - Exit current mode</li>
                        <li><code>end</code> - Return to privileged EXEC</li>
                        <li><code>?</code> - Context-sensitive help</li>
                    </ul>
                </div>
                <div class="cheat-card">
                    <h4>Show Commands</h4>
                    <ul>
                        <li><code>show running-config</code> - Active config</li>
                        <li><code>show ip interface brief</code> - Interface status</li>
                        <li><code>show ip route</code> - Routing table</li>
                        <li><code>show vlan</code> - VLAN info</li>
                        <li><code>show version</code> - System info</li>
                    </ul>
                </div>
                <div class="cheat-card">
                    <h4>Interface Configuration</h4>
                    <ul>
                        <li><code>interface [type] [number]</code></li>
                        <li><code>ip address [ip] [mask]</code></li>
                        <li><code>no shutdown</code> - Enable interface</li>
                        <li><code>description [text]</code> - Add description</li>
                        <li><code>speed [value]</code> - Set speed</li>
                    </ul>
                </div>
            </div>

            <h3 style="margin-top: 30px;">Port Numbers &amp; Protocols</h3>
            <div class="cheat-sheet">
                <div class="cheat-card">
                    <h4>Common TCP Ports</h4>
                    <ul>
                        <li><code>20/21</code> - FTP (Data/Control)</li>
                        <li><code>22</code> - SSH</li>
                        <li><code>23</code> - Telnet</li>
                        <li><code>25</code> - SMTP</li>
                        <li><code>80</code> - HTTP</li>
                        <li><code>443</code> - HTTPS</li>
                    </ul>
                </div>
                <div class="cheat-card">
                    <h4>Common UDP Ports</h4>
                    <ul>
                        <li><code>53</code> - DNS</li>
                        <li><code>67/68</code> - DHCP</li>
                        <li><code>69</code> - TFTP</li>
                        <li><code>161/162</code> - SNMP</li>
                        <li><code>514</code> - Syslog</li>
                    </ul>
                </div>
                <div class="cheat-card">
                    <h4>OSI Layer Protocols</h4>
                    <ul>
                        <li><code>Layer 1</code> - Ethernet, USB, Bluetooth</li>
                        <li><code>Layer 2</code> - MAC, ARP, PPP</li>
                        <li><code>Layer 3</code> - IP, ICMP, OSPF, BGP</li>
                        <li><code>Layer 4</code> - TCP, UDP</li>
                        <li><code>Layer 7</code> - HTTP, FTP, SSH, DNS</li>
                    </ul>
                </div>
            </div>

            <h3 style="margin-top: 30px;">Subnetting Quick Reference</h3>
            <div class="cheat-sheet">
                <div class="cheat-card">
                    <h4>Subnet Mask Conversion</h4>
                    <ul>
                        <li><code>/24</code> = 255.255.255.0</li>
                        <li><code>/25</code> = 255.255.255.128</li>
                        <li><code>/26</code> = 255.255.255.192</li>
                        <li><code>/27</code> = 255.255.255.224</li>
                        <li><code>/28</code> = 255.255.255.240</li>
                        <li><code>/29</code> = 255.255.255.248</li>
                        <li><code>/30</code> = 255.255.255.252</li>
                    </ul>
                </div>
                <div class="cheat-card">
                    <h4>Usable Hosts Formula</h4>
                    <ul>
                        <li><code>2^n - 2</code> where n = host bits</li>
                        <li><code>/24</code> = 254 hosts</li>
                        <li><code>/25</code> = 126 hosts</li>
                        <li><code>/26</code> = 62 hosts</li>
                        <li><code>/27</code> = 30 hosts</li>
                        <li><code>/28</code> = 14 hosts</li>
                        <li><code>/30</code> = 2 hosts (point-to-point)</li>
                    </ul>
                </div>
                <div class="cheat-card">
                    <h4>Private IP Ranges</h4>
                    <ul>
                        <li><code>10.0.0.0/8</code> - Class A</li>
                        <li><code>172.16.0.0/12</code> - Class B</li>
                        <li><code>192.168.0.0/16</code> - Class C</li>
                        <li><code>127.0.0.0/8</code> - Loopback</li>
                        <li><code>169.254.0.0/16</code> - APIPA</li>
                    </ul>
                </div>
                <div class="cheat-card">
                    <h4>Simple Packet Tracer</h4>
                    <ul>
                        <li><strong>Place Mode:</strong> Select a device from the palette and click on the canvas to place it.</li>
                        <li><strong>Connect Mode:</strong> Click on two devices to connect them.</li>
                        <li><strong>Delete Mode:</strong> Click on a device to delete it.</li>
                        <li><strong>Properties:</strong> Click on a device to open the properties panel and edit its name and IP address.</li>
                        <li><strong>Ping Mode:</strong> Select a source device, then a destination device to test connectivity.</li>
                    </ul>
                </div>
            </div>

            <h3 style="margin-top: 30px;">Troubleshooting Steps</h3>
            <div class="panel" style="background: var(--bg-primary); border: 2px solid var(--accent-teal);">
                <ol style="margin-left: 20px; color: var(--text-secondary); line-height: 2;">
                    <li><strong style="color: var(--accent-cyan);">Physical Layer:</strong> Check cables, LEDs, and connections</li>
                    <li><strong style="color: var(--accent-cyan);">Data Link:</strong> Verify MAC addresses and switch port status</li>
                    <li><strong style="color: var(--accent-cyan);">Network Layer:</strong> Check IP configuration and routing</li>
                    <li><strong style="color: var(--accent-cyan);">Transport Layer:</strong> Verify firewall rules and port availability</li>
                    <li><strong style="color: var(--accent-cyan);">Application Layer:</strong> Test specific services and applications</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        // ========== GLOBAL STATE ==========
        let currentSection = 'home';
        let progressData = {
            completedSections: [],
            quizScores: {},
            practiceProblems: 0
        };

        // ========== VISIBILITY & FULLSCREEN HELPERS ==========

        /**
         * Smoothly scroll an element into view when animation starts
         * @param {string|HTMLElement} element - Element or selector to scroll to
         * @param {number} offset - Additional offset from top (default: -20)
         */
        function scrollToElement(element, offset = -20) {
            const el = typeof element === 'string' ? document.querySelector(element) : element;
            if (!el) return;

            const elementPosition = el.getBoundingClientRect().top;
            const offsetPosition = elementPosition + window.pageYOffset + offset;

            window.scrollTo({
                top: offsetPosition,
                behavior: 'smooth'
            });
        }

        /**
         * Open element in fullscreen overlay
         * @param {string|HTMLElement} contentElement - Element to display in fullscreen
         * @param {string} title - Optional title for the fullscreen view
         */
        function openFullscreen(contentElement, title = '') {
            const el = typeof contentElement === 'string' ? document.querySelector(contentElement) : contentElement;
            if (!el) return;

            // Create overlay if it doesn't exist
            let overlay = document.getElementById('fullscreenOverlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.id = 'fullscreenOverlay';
                overlay.className = 'fullscreen-overlay';
                document.body.appendChild(overlay);
            }

            // Clone the content
            const content = document.createElement('div');
            content.className = 'fullscreen-content';

            if (title) {
                const titleEl = document.createElement('h2');
                titleEl.textContent = title;
                titleEl.style.cssText = 'color: var(--accent-cyan); margin-bottom: 20px; text-align: center;';
                content.appendChild(titleEl);
            }

            const closeBtn = document.createElement('button');
            closeBtn.className = 'fullscreen-close';
            closeBtn.innerHTML = '✕';
            closeBtn.onclick = closeFullscreen;
            content.appendChild(closeBtn);

            const clonedContent = el.cloneNode(true);
            clonedContent.style.maxHeight = 'none';
            content.appendChild(clonedContent);

            overlay.innerHTML = '';
            overlay.appendChild(content);
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';

            // Re-attach event handlers if needed
            attachFullscreenEventHandlers(clonedContent);
        }

        /**
         * Close fullscreen overlay
         */
        function closeFullscreen() {
            const overlay = document.getElementById('fullscreenOverlay');
            if (overlay) {
                overlay.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }

        /**
         * Re-attach event handlers to cloned elements in fullscreen
         * @param {HTMLElement} container - Container with cloned elements
         */
        function attachFullscreenEventHandlers(container) {
            // Find all buttons and re-attach their onclick handlers
            const buttons = container.querySelectorAll('button[onclick]');
            buttons.forEach(btn => {
                const onclickAttr = btn.getAttribute('onclick');
                if (onclickAttr) {
                    btn.onclick = function() {
                        eval(onclickAttr);
                    };
                }
            });
        }

        // Close fullscreen on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeFullscreen();
            }
        });

        // OSI Model Data
        const osiLayers = [
            {
                number: 7,
                name: "Application",
                description: "End-user services and network applications",
                protocols: ["HTTP", "FTP", "SMTP", "DNS", "SSH", "Telnet"],
                functions: [
                    "User interface and application services",
                    "Network process to application",
                    "Email, file transfer, web browsing"
                ],
                mnemonic: "All"
            },
            {
                number: 6,
                name: "Presentation",
                description: "Data translation, encryption, and compression",
                protocols: ["SSL/TLS", "JPEG", "GIF", "MPEG", "ASCII"],
                functions: [
                    "Data encryption and decryption",
                    "Data compression and decompression",
                    "Character encoding and format conversion"
                ],
                mnemonic: "People"
            },
            {
                number: 5,
                name: "Session",
                description: "Manages sessions between applications",
                protocols: ["NetBIOS", "RPC", "PPTP", "L2TP"],
                functions: [
                    "Establishes, manages, and terminates connections",
                    "Session checkpointing and recovery",
                    "Dialog control and synchronization"
                ],
                mnemonic: "Seem"
            },
            {
                number: 4,
                name: "Transport",
                description: "Reliable data transfer and error recovery",
                protocols: ["TCP", "UDP", "SCTP"],
                functions: [
                    "Segmentation and reassembly",
                    "Flow control and error recovery",
                    "Port addressing (multiplexing)"
                ],
                mnemonic: "To"
            },
            {
                number: 3,
                name: "Network",
                description: "Logical addressing and routing",
                protocols: ["IP", "ICMP", "OSPF", "BGP", "EIGRP"],
                functions: [
                    "Logical addressing (IP addresses)",
                    "Routing and path determination",
                    "Packet forwarding and fragmentation"
                ],
                mnemonic: "Need"
            },
            {
                number: 2,
                name: "Data Link",
                description: "Physical addressing and frame handling",
                protocols: ["Ethernet", "MAC", "ARP", "PPP", "VLAN"],
                functions: [
                    "Physical addressing (MAC addresses)",
                    "Frame formatting and error detection",
                    "Media access control"
                ],
                mnemonic: "Data"
            },
            {
                number: 1,
                name: "Physical",
                description: "Physical transmission of raw bits",
                protocols: ["Ethernet", "USB", "Bluetooth", "Fiber", "Coax"],
                functions: [
                    "Bit transmission over physical medium",
                    "Hardware specifications",
                    "Cable types, connectors, voltages"
                ],
                mnemonic: "Processing"
            }
        ];

        // Quiz Questions
        const quizQuestions = {
            1: [ // Week 1
                {
                    question: "How many layers does the OSI model have?",
                    options: ["5", "6", "7", "8"],
                    correct: 2,
                    explanation: "The OSI model has 7 layers, from Physical (1) to Application (7)."
                },
                {
                    question: "Which layer is responsible for logical addressing and routing?",
                    options: ["Data Link", "Network", "Transport", "Session"],
                    correct: 1,
                    explanation: "The Network Layer (Layer 3) handles IP addressing and routing."
                },
                {
                    question: "What protocol maps IP addresses to MAC addresses?",
                    options: ["DHCP", "DNS", "ARP", "ICMP"],
                    correct: 2,
                    explanation: "ARP (Address Resolution Protocol) maps IP addresses to MAC addresses."
                },
                {
                    question: "How many usable host addresses are in a /24 subnet?",
                    options: ["254", "255", "256", "128"],
                    correct: 0,
                    explanation: "A /24 subnet has 254 usable addresses (256 total minus network and broadcast)."
                },
                {
                    question: "Which layer does TCP operate at?",
                    options: ["Network", "Transport", "Session", "Application"],
                    correct: 1,
                    explanation: "TCP operates at Layer 4, the Transport Layer."
                },
                {
                    question: "What is the purpose of a VLAN?",
                    options: [
                        "Increase physical bandwidth",
                        "Segment broadcast domains logically",
                        "Provide wireless connectivity",
                        "Encrypt network traffic"
                    ],
                    correct: 1,
                    explanation: "VLANs segment broadcast domains at Layer 2, improving network organization and security."
                }
            ],
            2: [ // Week 2
                {
                    question: "What command enters privileged EXEC mode on a Cisco device?",
                    options: ["configure terminal", "enable", "privileged", "admin"],
                    correct: 1,
                    explanation: "The 'enable' command enters privileged EXEC mode (Router#)."
                },
                {
                    question: "Which device operates at Layer 2 of the OSI model?",
                    options: ["Router", "Hub", "Switch", "Gateway"],
                    correct: 2,
                    explanation: "Switches operate at Layer 2, using MAC addresses to forward frames."
                },
                {
                    question: "What port does DHCP use?",
                    options: ["UDP 53", "TCP 80", "UDP 67/68", "TCP 443"],
                    correct: 2,
                    explanation: "DHCP uses UDP ports 67 (server) and 68 (client)."
                },
                {
                    question: "What does the 'no shutdown' command do?",
                    options: [
                        "Disables the interface",
                        "Enables the interface",
                        "Restarts the router",
                        "Clears the configuration"
                    ],
                    correct: 1,
                    explanation: "'no shutdown' administratively enables an interface."
                },
                {
                    question: "Which wireless security protocol is most secure?",
                    options: ["WEP", "WPA", "WPA2", "WPA3"],
                    correct: 3,
                    explanation: "WPA3 is the most secure wireless protocol, released in 2018."
                },
                {
                    question: "What command displays active interfaces and their IP addresses?",
                    options: [
                        "show ip",
                        "show interfaces",
                        "show ip interface brief",
                        "show running-config"
                    ],
                    correct: 2,
                    explanation: "'show ip interface brief' displays a concise list of interfaces and their status."
                }
            ],
            3: [ // Week 3
                {
                    question: "What type of routing protocol is OSPF?",
                    options: ["Distance Vector", "Link State", "Hybrid", "Static"],
                    correct: 1,
                    explanation: "OSPF is a link-state routing protocol that uses SPF algorithm."
                },
                {
                    question: "Which command tests Layer 3 connectivity?",
                    options: ["traceroute", "ping", "telnet", "ssh"],
                    correct: 1,
                    explanation: "Ping uses ICMP to test Layer 3 (IP) connectivity."
                },
                {
                    question: "What is the purpose of an Access Control List (ACL)?",
                    options: [
                        "Assign IP addresses",
                        "Filter network traffic",
                        "Route packets",
                        "Compress data"
                    ],
                    correct: 1,
                    explanation: "ACLs filter traffic based on defined criteria, providing security."
                },
                {
                    question: "Which BGP attribute has the highest preference?",
                    options: ["AS-Path", "Weight", "Local Preference", "MED"],
                    correct: 1,
                    explanation: "Weight is Cisco proprietary and has the highest BGP path selection preference."
                },
                {
                    question: "What protocol number does OSPF use?",
                    options: ["TCP 179", "UDP 520", "IP Protocol 89", "IP Protocol 88"],
                    correct: 2,
                    explanation: "OSPF uses IP protocol number 89, not TCP or UDP."
                },
                {
                    question: "What does traceroute show?",
                    options: [
                        "Bandwidth usage",
                        "Path packets take to destination",
                        "Encryption status",
                        "MAC address table"
                    ],
                    correct: 1,
                    explanation: "Traceroute shows each hop (router) a packet traverses to reach destination."
                }
            ]
        };

        // Old CLI Simulator State (for backward compatibility)
        let oldCliMode = 'user';
        let oldCliHistory = [];
        let oldHistoryIndex = -1;
        let cliInterfaces = {
            'GigabitEthernet0/0': { ip: '192.168.1.1', status: 'up', protocol: 'up' },
            'GigabitEthernet0/1': { ip: '10.0.0.1', status: 'up', protocol: 'up' },
            'Serial0/0/0': { ip: '172.16.0.1', status: 'down', protocol: 'down' }
        };

        // Topology Builder State
        let topologyDevices = [];
        let topologyConnections = [];
        let selectedDevice = null;
        let topologyMode = 'place';
        let connectionStart = null;
        let topologyCanvas, topologyCtx;
        let deviceCounter = 1;
        let selectedTopologyDevice = null;
        let selectedCableType = 'auto';
        let selectedInterfaceFrom = null;

        // Packet Flow State
        let packetFlowAnimation = null;

        // ========== INITIALIZATION ==========
        document.addEventListener('DOMContentLoaded', function() {
            loadProgress();
            initializeTabs();
            initializeOSIModel();
            initializeCLI();
            initializeTopology();
            initializePacketFlow();
            updateProgress();
        });

        // ========== PROGRESS TRACKING ==========
        function loadProgress() {
            const saved = localStorage.getItem('networkAdminProgress');
            if (saved) {
                progressData = JSON.parse(saved);
            }
        }

        function saveProgress() {
            localStorage.setItem('networkAdminProgress', JSON.stringify(progressData));
            updateProgress();
        }

        function updateProgress() {
            const totalSections = 9;
            const completedCount = progressData.completedSections.length;
            const percentage = (completedCount / totalSections) * 100;
            document.getElementById('overallProgress').style.width = percentage + '%';
        }

        function markSectionComplete(section) {
            if (!progressData.completedSections.includes(section)) {
                progressData.completedSections.push(section);
                saveProgress();
            }
        }

        // ========== TAB NAVIGATION ==========
        function initializeTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    // Only switch if the tab has a data-section attribute (skip special tabs like upload)
                    if (section) {
                        switchSection(section);
                    }
                });
            });

            // Restore last viewed tab or default to home
            const savedTab = localStorage.getItem('currentTab');
            const initialTab = savedTab && document.getElementById(savedTab) ? savedTab : 'home';
            switchSection(initialTab);
        }

        function switchSection(section) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(s => {
                s.classList.remove('active');
            });

            // Show selected section
            const targetSection = document.getElementById(section);
            if (targetSection) {
                targetSection.classList.add('active');
            }

            // Update tab styling and ARIA attributes
            document.querySelectorAll('.tab').forEach(t => {
                t.classList.remove('active');
                t.setAttribute('aria-selected', 'false');
                t.setAttribute('tabindex', '-1');
            });
            const targetTab = document.querySelector(`[data-section="${section}"]`);
            if (targetTab) {
                targetTab.classList.add('active');
                targetTab.setAttribute('aria-selected', 'true');
                targetTab.setAttribute('tabindex', '0');
                targetTab.focus();
            }

            currentSection = section;

            // Reinitialize canvas-based sections when they become visible
            if (section === 'topology' && topologyCanvas) {
                // Small delay to ensure canvas is visible
                setTimeout(() => {
                    const parent = topologyCanvas.parentElement;
                    if (parent && parent.offsetWidth > 0) {
                        topologyCanvas.width = parent.offsetWidth;
                        topologyCanvas.height = 500;
                        drawTopology();
                    }
                }, 50);
            } else if (section === 'packet-flow') {
                setTimeout(() => {
                    initializePacketFlow();
                }, 50);
            }

            // Save to localStorage for persistence
            localStorage.setItem('currentTab', section);
        }

        // ========== OSI MODEL ==========
        function initializeOSIModel() {
            const container = document.getElementById('osiLayers');
            osiLayers.forEach(layer => {
                const layerDiv = document.createElement('div');
                layerDiv.className = 'osi-layer';
                layerDiv.innerHTML = `
                    <div class="osi-layer-number">${layer.number}</div>
                    <div class="osi-layer-name">${layer.number}. ${layer.name} Layer</div>
                    <div class="osi-layer-description">${layer.description}</div>
                `;
                layerDiv.addEventListener('click', () => showOSIDetails(layer));
                container.appendChild(layerDiv);
            });
        }

        function showOSIDetails(layer) {
            // Remove active class from all layers and any existing details panels
            document.querySelectorAll('.osi-layer').forEach(l => l.classList.remove('active'));
            document.querySelectorAll('.osi-details-panel').forEach(panel => panel.remove());

            // Find and activate clicked layer
            const layers = document.querySelectorAll('.osi-layer');
            const clickedLayer = layers[7 - layer.number];
            clickedLayer.classList.add('active');

            // Create details panel
            const detailsPanel = document.createElement('div');
            detailsPanel.className = 'osi-details-panel';

            // Build protocols HTML
            let protocolsHTML = '';
            if (layer.protocols && layer.protocols.length > 0) {
                layer.protocols.forEach(protocol => {
                    protocolsHTML += `<div class="protocol-badge">${protocol}</div>`;
                });
            } else {
                protocolsHTML = '<p>No protocols defined</p>';
            }

            // Build functions HTML
            let functionsHTML = '';
            if (layer.functions && layer.functions.length > 0) {
                layer.functions.forEach(func => {
                    functionsHTML += `<li>${func}</li>`;
                });
            } else {
                functionsHTML = '<li>No functions defined</li>';
            }

            detailsPanel.innerHTML = `
                <div class="osi-details">
                    <h4 style="color: #06b6d4 !important; font-size: 1.8em !important; margin-bottom: 15px !important; font-weight: bold !important;">Layer ${layer.number}: ${layer.name}</h4>
                    <p style="color: #cbd5e1 !important; font-size: 1.2em !important; margin-bottom: 20px !important; line-height: 1.6 !important;">${layer.description}</p>

                    <h4 style="color: #06b6d4 !important; font-size: 1.3em !important; margin-top: 25px !important; margin-bottom: 15px !important; font-weight: bold !important;">Protocols & Technologies:</h4>
                    <div class="protocol-list">${protocolsHTML}</div>

                    <h4 style="color: #06b6d4 !important; font-size: 1.3em !important; margin-top: 25px !important; margin-bottom: 15px !important; font-weight: bold !important;">Functions:</h4>
                    <ul style="margin-left: 20px !important; color: #cbd5e1 !important; font-size: 1.1em !important; line-height: 1.8 !important;">${functionsHTML}</ul>

                    <h3 style="color: #14b8a6 !important; font-size: 1.5em !important; margin-top: 35px !important; margin-bottom: 10px !important; font-weight: bold !important;">Complete OSI Communication Flow</h3>
                    <p style="color: #cbd5e1 !important; font-size: 1.1em !important; margin-bottom: 15px !important;">
                        <strong>Real-world example:</strong> Sending an HTTP request from your browser to www.example.com
                    </p>

                    <div class="osi-dual-flow-container">
                        <div class="flow-column">
                            <h4 style="color: #06b6d4; text-align: center; margin-bottom: 15px;">SENDER (Encapsulation)</h4>
                            <div class="osi-flow-stack" id="senderStack">
                                <div class="osi-flow-layer" data-layer="7" data-side="sender">
                                    <span class="layer-label">Layer 7 - Application</span>
                                    <span class="layer-action">HTTP Request</span>
                                </div>
                                <div class="osi-flow-layer" data-layer="6" data-side="sender">
                                    <span class="layer-label">Layer 6 - Presentation</span>
                                    <span class="layer-action">Encrypt/Format (SSL/TLS)</span>
                                </div>
                                <div class="osi-flow-layer" data-layer="5" data-side="sender">
                                    <span class="layer-label">Layer 5 - Session</span>
                                    <span class="layer-action">Session Management</span>
                                </div>
                                <div class="osi-flow-layer" data-layer="4" data-side="sender">
                                    <span class="layer-label">Layer 4 - Transport</span>
                                    <span class="layer-action">Add TCP Header</span>
                                </div>
                                <div class="osi-flow-layer" data-layer="3" data-side="sender">
                                    <span class="layer-label">Layer 3 - Network</span>
                                    <span class="layer-action">Add IP Header</span>
                                </div>
                                <div class="osi-flow-layer" data-layer="2" data-side="sender">
                                    <span class="layer-label">Layer 2 - Data Link</span>
                                    <span class="layer-action">Add MAC Header</span>
                                </div>
                                <div class="osi-flow-layer" data-layer="1" data-side="sender">
                                    <span class="layer-label">Layer 1 - Physical</span>
                                    <span class="layer-action">Convert to Bits</span>
                                </div>
                                <div class="flow-packet" id="senderPacket">
                                    <span class="packet-label">Data</span>
                                </div>
                            </div>
                        </div>

                        <div class="transmission-line">
                            <div class="transmission-arrow">➡️</div>
                            <div class="transmission-label">Network Transmission</div>
                        </div>

                        <div class="flow-column">
                            <h4 style="color: #14b8a6; text-align: center; margin-bottom: 15px;">RECEIVER (De-encapsulation)</h4>
                            <div class="osi-flow-stack" id="receiverStack">
                                <div class="osi-flow-layer" data-layer="1" data-side="receiver">
                                    <span class="layer-label">Layer 1 - Physical</span>
                                    <span class="layer-action">Receive Bits</span>
                                </div>
                                <div class="osi-flow-layer" data-layer="2" data-side="receiver">
                                    <span class="layer-label">Layer 2 - Data Link</span>
                                    <span class="layer-action">Remove MAC Header</span>
                                </div>
                                <div class="osi-flow-layer" data-layer="3" data-side="receiver">
                                    <span class="layer-label">Layer 3 - Network</span>
                                    <span class="layer-action">Remove IP Header</span>
                                </div>
                                <div class="osi-flow-layer" data-layer="4" data-side="receiver">
                                    <span class="layer-label">Layer 4 - Transport</span>
                                    <span class="layer-action">Remove TCP Header</span>
                                </div>
                                <div class="osi-flow-layer" data-layer="5" data-side="receiver">
                                    <span class="layer-label">Layer 5 - Session</span>
                                    <span class="layer-action">Session Processing</span>
                                </div>
                                <div class="osi-flow-layer" data-layer="6" data-side="receiver">
                                    <span class="layer-label">Layer 6 - Presentation</span>
                                    <span class="layer-action">Decrypt/Decode</span>
                                </div>
                                <div class="osi-flow-layer" data-layer="7" data-side="receiver">
                                    <span class="layer-label">Layer 7 - Application</span>
                                    <span class="layer-action">HTTP Response</span>
                                </div>
                                <div class="flow-packet" id="receiverPacket">
                                    <span class="packet-label">Data</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="animation-controls">
                        <button class="btn" onclick="startOSIAnimation()">▶️ Start Animation</button>
                        <button class="btn" onclick="pauseOSIAnimation()">⏸️ Pause</button>
                        <button class="btn" onclick="resetOSIAnimation()">🔄 Reset</button>
                        <div class="speed-controls">
                            <label style="color: #cbd5e1; margin-right: 10px;">Speed:</label>
                            <button class="btn-small" onclick="setAnimationSpeed(1200, event)">Slow</button>
                            <button class="btn-small active" onclick="setAnimationSpeed(800, event)">Normal</button>
                            <button class="btn-small" onclick="setAnimationSpeed(400, event)">Fast</button>
                        </div>
                    </div>

                    <div class="animation-status" id="animationStatus" style="color: #14b8a6; text-align: center; margin-top: 15px; font-size: 1.1em; min-height: 30px;"></div>
                </div>
            `;

            // Insert the details panel right after the clicked layer
            clickedLayer.insertAdjacentElement('afterend', detailsPanel);

            // Auto-scroll to the details panel smoothly
            setTimeout(() => {
                detailsPanel.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);

            markSectionComplete('osi-model');
        }

        // OSI Animation State
        let osiAnimationState = {
            speed: 800,
            paused: false,
            currentStep: 0,
            timeoutId: null
        };

        const packetLabels = [
            'HTTP Data',
            'Encrypted Data',
            'Session Data',
            'TCP Segment',
            'IP Packet',
            'Ethernet Frame',
            'Physical Bits'
        ];

        function startOSIAnimation() {
            resetOSIAnimation();
            osiAnimationState.paused = false;
            updateStatus('Starting animation...');

            setTimeout(() => {
                animateSender();
            }, 500);
        }

        function animateSender() {
            if (osiAnimationState.paused) return;

            const senderPacket = document.getElementById('senderPacket');
            const senderLayers = document.querySelectorAll('[data-side="sender"]');

            if (!senderPacket || senderLayers.length === 0) return;

            senderPacket.classList.add('visible');
            updateStatus('📤 SENDER: Encapsulating data...');

            let step = 0;
            const animateStep = () => {
                if (osiAnimationState.paused) {
                    osiAnimationState.currentStep = step;
                    return;
                }

                if (step > 0) {
                    senderLayers[step - 1].classList.remove('active');
                    senderLayers[step - 1].classList.add('processing');
                    setTimeout(() => {
                        senderLayers[step - 1].classList.remove('processing');
                    }, 300);
                }

                if (step < senderLayers.length) {
                    const layer = senderLayers[step];
                    layer.classList.add('active');

                    // Update packet label
                    const packetLabel = senderPacket.querySelector('.packet-label');
                    packetLabel.textContent = packetLabels[step];

                    // Move packet
                    const layerRect = layer.getBoundingClientRect();
                    const containerRect = senderPacket.parentElement.getBoundingClientRect();
                    const relativeTop = layerRect.top - containerRect.top;
                    senderPacket.style.top = relativeTop + 5 + 'px';

                    // Grow packet as headers are added
                    const scale = 1 + (step * 0.05);
                    senderPacket.style.transform = `translateX(-50%) scale(${scale})`;

                    updateStatus(`📤 Layer ${7 - step}: ${packetLabels[step]}`);

                    step++;
                    osiAnimationState.timeoutId = setTimeout(animateStep, osiAnimationState.speed);
                } else {
                    // Sender complete, start transmission
                    senderLayers.forEach(l => l.classList.remove('active'));
                    updateStatus('📡 Transmitting data across network...');

                    const arrow = document.querySelector('.transmission-arrow');
                    if (arrow) arrow.classList.add('transmitting');

                    osiAnimationState.timeoutId = setTimeout(() => {
                        if (arrow) arrow.classList.remove('transmitting');
                        senderPacket.classList.remove('visible');
                        animateReceiver();
                    }, osiAnimationState.speed * 1.5);
                }
            };

            animateStep();
        }

        function animateReceiver() {
            if (osiAnimationState.paused) return;

            const receiverPacket = document.getElementById('receiverPacket');
            const receiverLayers = document.querySelectorAll('[data-side="receiver"]');

            if (!receiverPacket || receiverLayers.length === 0) return;

            receiverPacket.classList.add('visible');
            receiverPacket.style.transform = 'translateX(-50%) scale(1.35)';

            const receiverLabel = receiverPacket.querySelector('.packet-label');
            receiverLabel.textContent = 'Physical Bits';

            updateStatus('📥 RECEIVER: De-encapsulating data...');

            let step = 0;
            const animateStep = () => {
                if (osiAnimationState.paused) {
                    osiAnimationState.currentStep = step + 7;
                    return;
                }

                if (step > 0) {
                    receiverLayers[step - 1].classList.remove('active');
                    receiverLayers[step - 1].classList.add('processing');
                    setTimeout(() => {
                        receiverLayers[step - 1].classList.remove('processing');
                    }, 300);
                }

                if (step < receiverLayers.length) {
                    const layer = receiverLayers[step];
                    layer.classList.add('active');

                    // Update packet label (reverse order)
                    receiverLabel.textContent = packetLabels[6 - step];

                    // Move packet
                    const layerRect = layer.getBoundingClientRect();
                    const containerRect = receiverPacket.parentElement.getBoundingClientRect();
                    const relativeTop = layerRect.top - containerRect.top;
                    receiverPacket.style.top = relativeTop + 5 + 'px';

                    // Shrink packet as headers are removed
                    const scale = 1.35 - (step * 0.05);
                    receiverPacket.style.transform = `translateX(-50%) scale(${scale})`;

                    updateStatus(`📥 Layer ${step + 1}: Removing ${packetLabels[6 - step]} headers`);

                    step++;
                    osiAnimationState.timeoutId = setTimeout(animateStep, osiAnimationState.speed);
                } else {
                    // Animation complete
                    receiverLayers.forEach(l => l.classList.remove('active'));
                    updateStatus('✅ Complete! Data successfully delivered to application.');

                    osiAnimationState.timeoutId = setTimeout(() => {
                        receiverPacket.classList.remove('visible');
                    }, 2000);

                    markSectionComplete('osi-model');
                }
            };

            animateStep();
        }

        function pauseOSIAnimation() {
            osiAnimationState.paused = !osiAnimationState.paused;

            if (osiAnimationState.paused) {
                if (osiAnimationState.timeoutId) {
                    clearTimeout(osiAnimationState.timeoutId);
                }
                updateStatus('⏸️ Animation paused');
            } else {
                updateStatus('▶️ Animation resumed');
                if (osiAnimationState.currentStep < 7) {
                    animateSender();
                } else {
                    animateReceiver();
                }
            }
        }

        function resetOSIAnimation() {
            osiAnimationState.paused = false;
            osiAnimationState.currentStep = 0;

            if (osiAnimationState.timeoutId) {
                clearTimeout(osiAnimationState.timeoutId);
            }

            // Reset all layers
            document.querySelectorAll('.osi-flow-layer').forEach(layer => {
                layer.classList.remove('active', 'processing');
            });

            // Reset packets
            const senderPacket = document.getElementById('senderPacket');
            const receiverPacket = document.getElementById('receiverPacket');

            if (senderPacket) {
                senderPacket.classList.remove('visible');
                senderPacket.style.top = '-60px';
                senderPacket.style.transform = 'translateX(-50%) scale(1)';
                senderPacket.querySelector('.packet-label').textContent = 'Data';
            }

            if (receiverPacket) {
                receiverPacket.classList.remove('visible');
                receiverPacket.style.top = '-60px';
                receiverPacket.style.transform = 'translateX(-50%) scale(1)';
                receiverPacket.querySelector('.packet-label').textContent = 'Data';
            }

            // Reset arrow
            const arrow = document.querySelector('.transmission-arrow');
            if (arrow) arrow.classList.remove('transmitting');

            updateStatus('Ready to start');
        }

        function setAnimationSpeed(speed, event) {
            osiAnimationState.speed = speed;

            // Update active button
            document.querySelectorAll('.btn-small').forEach(btn => {
                btn.classList.remove('active');
            });

            if (event && event.target) {
                event.target.classList.add('active');
            }

            updateStatus(`Speed set to ${speed === 1200 ? 'Slow' : speed === 800 ? 'Normal' : 'Fast'}`);
        }

        function updateStatus(message) {
            const statusEl = document.getElementById('animationStatus');
            if (statusEl) {
                statusEl.textContent = message;
            }
        }

        // ========== NAT/PAT VISUALIZATION ==========
        let natEntryCounter = 50001; // Starting port for PAT
        let natDemoRunning = false;
        let natTimeouts = [];

        function startNATDemo(type) {
            if (natDemoRunning) return;
            natDemoRunning = true;

            // Clear any existing timeouts
            natTimeouts.forEach(id => clearTimeout(id));
            natTimeouts = [];

            // Clear previous table entries
            const tbody = document.querySelector('#natTable tbody');
            if (tbody) tbody.innerHTML = '';

            // Reset all device active states
            document.querySelectorAll('.nat-device').forEach(d => d.classList.remove('active'));
            document.querySelector('.nat-router')?.classList.remove('active');

            const demos = {
                web: [
                    { device: 'webServer', insideLocal: '192.168.1.10:1234', outsideGlobal: '203.0.113.5:50001', protocol: 'HTTP', delay: 500 },
                ],
                mail: [
                    { device: 'mailServer', insideLocal: '192.168.1.20:2345', outsideGlobal: '203.0.113.5:50002', protocol: 'SMTP', delay: 500 },
                ],
                cloud: [
                    { device: 'cloudServer', insideLocal: '192.168.1.30:3456', outsideGlobal: '203.0.113.5:50003', protocol: 'HTTPS', delay: 500 },
                ],
                all: [
                    { device: 'webServer', insideLocal: '192.168.1.10:1234', outsideGlobal: '203.0.113.5:50001', protocol: 'HTTP', delay: 500 },
                    { device: 'mailServer', insideLocal: '192.168.1.20:2345', outsideGlobal: '203.0.113.5:50002', protocol: 'SMTP', delay: 2000 },
                    { device: 'cloudServer', insideLocal: '192.168.1.30:3456', outsideGlobal: '203.0.113.5:50003', protocol: 'HTTPS', delay: 3500 },
                ]
            };

            const sequence = demos[type] || demos.all;

            updateNATStatus('Starting NAT/PAT demonstration...', true);

            sequence.forEach((entry, index) => {
                const timeoutId = setTimeout(() => {
                    // Activate device
                    const device = document.getElementById(entry.device);
                    if (device) device.classList.add('active');

                    // Activate router
                    const router = document.querySelector('.nat-router');
                    if (router) router.classList.add('active');

                    updateNATStatus(`Translating ${entry.protocol} packet from ${entry.insideLocal}...`, true);

                    // Add NAT table entry after brief delay
                    const addTimeout = setTimeout(() => {
                        addNATEntry(entry.insideLocal, entry.outsideGlobal, entry.protocol);

                        // Deactivate after showing translation
                        const deactivateTimeout = setTimeout(() => {
                            if (device) device.classList.remove('active');

                            // Check if this is the last entry
                            if (index === sequence.length - 1) {
                                const finalTimeout = setTimeout(() => {
                                    if (router) router.classList.remove('active');
                                    updateNATStatus('Demonstration complete. NAT table populated.', false);
                                    natDemoRunning = false;
                                }, 800);
                                natTimeouts.push(finalTimeout);
                            }
                        }, 1000);
                        natTimeouts.push(deactivateTimeout);
                    }, 600);
                    natTimeouts.push(addTimeout);
                }, entry.delay);
                natTimeouts.push(timeoutId);
            });

            markSectionComplete('nat-pat');
        }

        function resetNAT() {
            // Clear all timeouts
            natTimeouts.forEach(id => clearTimeout(id));
            natTimeouts = [];
            natDemoRunning = false;

            // Clear NAT table
            const tbody = document.querySelector('#natTable tbody');
            if (tbody) tbody.innerHTML = '';

            // Reset all device states
            document.querySelectorAll('.nat-device').forEach(d => d.classList.remove('active'));
            document.querySelector('.nat-router')?.classList.remove('active');

            // Reset counter
            natEntryCounter = 50001;

            updateNATStatus('NAT table cleared. Ready for demonstration.', false);
        }

        function addNATEntry(insideLocal, outsideGlobal, protocol) {
            const tbody = document.querySelector('#natTable tbody');
            if (!tbody) return;

            const row = document.createElement('tr');
            row.classList.add('nat-entry');
            row.innerHTML = `
                <td>${insideLocal}</td>
                <td>${outsideGlobal}</td>
                <td>${protocol}</td>
                <td><span class="status-badge">Active</span></td>
            `;

            tbody.appendChild(row);

            // Animate row appearance
            setTimeout(() => {
                row.style.opacity = '1';
                row.style.transform = 'translateX(0)';
            }, 50);
        }

        function updateNATStatus(message, active) {
            const statusEl = document.getElementById('natStatus');
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.style.color = active ? '#2ecc71' : '#7f8c8d';
            }
        }

        function showNATAnswer(num) {
            const answer = document.getElementById(`natAnswer${num}`);
            if (!answer) return;

            const isHidden = answer.style.display === 'none' || !answer.style.display;
            answer.style.display = isHidden ? 'block' : 'none';

            // Update button text
            const button = answer.previousElementSibling;
            if (button && button.tagName === 'BUTTON') {
                button.textContent = isHidden ? 'Hide Answer' : 'Show Answer';
            }
        }

        // ========== DHCP VISUALIZATION ==========
        let dhcpAnimationRunning = false;
        let dhcpTimeouts = [];

        function startDHCPAnimation() {
            if (dhcpAnimationRunning) return;

            // Auto-scroll to keep visualization visible
            scrollToElement('#dhcpTopology', -100);

            dhcpAnimationRunning = true;

            // Clear any existing timeouts
            dhcpTimeouts.forEach(id => clearTimeout(id));
            dhcpTimeouts = [];

            // Reset states
            const client = document.getElementById('dhcpClient');
            const server = document.getElementById('dhcpServer');
            const packet = document.getElementById('dhcpPacket');
            const clientStatus = document.getElementById('clientStatus');

            if (!client || !server || !packet || !clientStatus) return;

            // Clear classes
            client.classList.remove('active');
            server.classList.remove('active');
            packet.classList.remove('animate-to-server', 'animate-to-client');
            packet.style.opacity = '0';

            updateDHCPStatus('Starting DHCP DORA process...', true);

            // Step 1: DISCOVER
            dhcpTimeouts.push(setTimeout(() => {
                updateDHCPStepDetails('Step 1: DISCOVER',
                    'The client has no IP address and needs one. It broadcasts a DHCPDISCOVER message to the entire network (255.255.255.255) looking for any available DHCP servers. This is like shouting "Is anyone there who can give me an IP address?"');

                const packetType = packet.querySelector('.packet-type');
                if (packetType) packetType.textContent = 'DISCOVER';

                client.classList.add('active');
                packet.classList.add('animate-to-server');
                updateDHCPStatus('Client broadcasting DISCOVER message...', true);
            }, 500));

            // Step 2: OFFER
            dhcpTimeouts.push(setTimeout(() => {
                server.classList.add('active');
                client.classList.remove('active');
                packet.classList.remove('animate-to-server');
                packet.style.opacity = '0';

                updateDHCPStepDetails('Step 2: OFFER',
                    'The DHCP server receives the DISCOVER broadcast and responds with a DHCPOFFER message. The offer includes:<br>• Available IP address (e.g., 192.168.1.100)<br>• Subnet mask (e.g., 255.255.255.0)<br>• Default gateway (e.g., 192.168.1.1)<br>• DNS server addresses<br>• Lease duration (e.g., 24 hours)<br><br>The server reserves this IP temporarily, waiting for the client to accept.');

                dhcpTimeouts.push(setTimeout(() => {
                    const packetType = packet.querySelector('.packet-type');
                    if (packetType) packetType.textContent = 'OFFER';
                    packet.classList.add('animate-to-client');
                    updateDHCPStatus('Server sending OFFER (192.168.1.100)...', true);
                }, 300));
            }, 2000));

            // Step 3: REQUEST
            dhcpTimeouts.push(setTimeout(() => {
                client.classList.add('active');
                server.classList.remove('active');
                packet.classList.remove('animate-to-client');
                packet.style.opacity = '0';

                updateDHCPStepDetails('Step 3: REQUEST',
                    'The client accepts the offer by broadcasting a DHCPREQUEST message. Why broadcast instead of unicast? Because there might be multiple DHCP servers on the network. Broadcasting ensures all servers know which offer was accepted, so the others can release their reserved IPs back to their pools.');

                dhcpTimeouts.push(setTimeout(() => {
                    const packetType = packet.querySelector('.packet-type');
                    if (packetType) packetType.textContent = 'REQUEST';
                    packet.classList.add('animate-to-server');
                    updateDHCPStatus('Client requesting IP 192.168.1.100...', true);
                }, 300));
            }, 3500));

            // Step 4: ACKNOWLEDGE
            dhcpTimeouts.push(setTimeout(() => {
                server.classList.add('active');
                client.classList.remove('active');
                packet.classList.remove('animate-to-server');
                packet.style.opacity = '0';

                updateDHCPStepDetails('Step 4: ACKNOWLEDGE',
                    'The DHCP server sends a DHCPACK (acknowledgment) message confirming the lease. This final message includes:<br>• Confirmation of IP address assignment<br>• Lease start time<br>• Lease duration<br>• Renewal time (T1 - typically 50% of lease)<br>• Rebinding time (T2 - typically 87.5% of lease)<br><br>The client can now use this IP address and will automatically attempt to renew at T1.');

                dhcpTimeouts.push(setTimeout(() => {
                    const packetType = packet.querySelector('.packet-type');
                    if (packetType) packetType.textContent = 'ACK';
                    packet.classList.add('animate-to-client');
                    updateDHCPStatus('Server acknowledging lease...', true);
                }, 300));
            }, 5000));

            // Final: Complete
            dhcpTimeouts.push(setTimeout(() => {
                client.classList.add('active');
                server.classList.remove('active');
                packet.style.opacity = '0';
                packet.classList.remove('animate-to-client');

                clientStatus.textContent = '192.168.1.100';
                clientStatus.style.color = 'var(--success)';

                updateDHCPStatus('DORA process complete! Client has IP address.', false);
                updateDHCPStepDetails('Process Complete!',
                    'The client now has a fully configured network connection:<br>• IP Address: 192.168.1.100<br>• Subnet Mask: 255.255.255.0<br>• Default Gateway: 192.168.1.1<br>• DNS Servers: 8.8.8.8, 8.8.4.4<br>• Lease Time: 24 hours<br><br>The client will attempt to renew this lease at 12 hours (50%) and again at 21 hours (87.5%) if needed.');

                // Add lease entry to table
                addDHCPLeaseEntry('00:1A:2B:3C:4D:5E', '192.168.1.100', '24 hours');

                dhcpAnimationRunning = false;
            }, 6500));

            markSectionComplete('dhcp');
        }

        function resetDHCP() {
            // Clear all timeouts
            dhcpTimeouts.forEach(id => clearTimeout(id));
            dhcpTimeouts = [];
            dhcpAnimationRunning = false;

            // Reset UI elements
            const client = document.getElementById('dhcpClient');
            const server = document.getElementById('dhcpServer');
            const packet = document.getElementById('dhcpPacket');
            const clientStatus = document.getElementById('clientStatus');

            if (client) client.classList.remove('active');
            if (server) server.classList.remove('active');
            if (packet) {
                packet.classList.remove('animate-to-server', 'animate-to-client');
                packet.style.opacity = '0';
            }
            if (clientStatus) {
                clientStatus.textContent = 'No IP Address';
                clientStatus.style.color = '';
            }

            // Clear lease table
            const tbody = document.querySelector('#dhcpLeaseTable tbody');
            if (tbody) tbody.innerHTML = '';

            updateDHCPStatus('Click "Start DORA Process" to see how a device obtains an IP address.', false);

            const details = document.getElementById('dhcpStepDetails');
            if (details) {
                details.innerHTML = '<p>The animation will show each step of the DORA process with detailed explanations.</p>';
            }
        }

        function updateDHCPStatus(message, active) {
            const statusEl = document.getElementById('dhcpStatus');
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.style.color = active ? '#2ecc71' : '#7f8c8d';
            }
        }

        function updateDHCPStepDetails(title, description) {
            const details = document.getElementById('dhcpStepDetails');
            if (details) {
                details.innerHTML = `
                    <h4 style="color: var(--accent-cyan); margin-bottom: 10px;">${title}</h4>
                    <p style="line-height: 1.8;">${description}</p>
                `;
            }
        }

        function addDHCPLeaseEntry(macAddress, ipAddress, duration) {
            const tbody = document.querySelector('#dhcpLeaseTable tbody');
            if (!tbody) return;

            const now = new Date();
            const timeString = now.toLocaleTimeString();

            const row = document.createElement('tr');
            row.classList.add('dhcp-lease-entry');
            row.innerHTML = `
                <td>${macAddress}</td>
                <td>${ipAddress}</td>
                <td>${timeString}</td>
                <td>${duration}</td>
                <td><span class="lease-status-active">Active</span></td>
            `;

            tbody.appendChild(row);

            // Animate row appearance
            setTimeout(() => {
                row.style.opacity = '1';
                row.style.transform = 'translateX(0)';
            }, 50);
        }

        function showDHCPAnswer(num) {
            const answer = document.getElementById(`dhcpAnswer${num}`);
            if (!answer) return;

            const isHidden = answer.style.display === 'none' || !answer.style.display;
            answer.style.display = isHidden ? 'block' : 'none';

            // Update button text
            const button = answer.previousElementSibling;
            if (button && button.tagName === 'BUTTON') {
                button.textContent = isHidden ? 'Hide Answer' : 'Show Answer';
            }
        }

        // ========== OSPF VISUALIZATION ==========
        let ospfAnimationRunning = false;
        let ospfTimeouts = [];

        const ospfTopology = {
            routers: {
                A: { neighbors: ['B', 'C', 'D'] },
                B: { neighbors: ['A', 'E'] },
                C: { neighbors: ['A', 'E', 'F'] },
                D: { neighbors: ['A', 'F'] },
                E: { neighbors: ['B', 'C', 'F', 'G'] },
                F: { neighbors: ['C', 'D', 'E', 'G'] },
                G: { neighbors: ['E', 'F'] }
            },
            links: {
                'A-B': { cost: 1 },   // 10Gbps
                'A-C': { cost: 10 },  // 100Mbps
                'A-D': { cost: 100 }, // 10Mbps
                'B-E': { cost: 1 },   // 10Gbps
                'C-E': { cost: 10 },  // 1Gbps
                'C-F': { cost: 10 },  // 100Mbps
                'D-F': { cost: 100 }, // 10Mbps
                'E-G': { cost: 1 },   // 10Gbps
                'F-G': { cost: 10 },  // 100Mbps
                'E-F': { cost: 10 }   // Backup 1Gbps
            }
        };

        function startOSPFAnimation() {
            if (ospfAnimationRunning) return;

            // Auto-scroll to keep visualization visible
            scrollToElement('#ospfTopology', -100);

            ospfAnimationRunning = true;

            // Clear timeouts
            ospfTimeouts.forEach(id => clearTimeout(id));
            ospfTimeouts = [];

            // Reset visual states
            document.querySelectorAll('.ospf-router').forEach(r => {
                r.classList.remove('active', 'neighbor');
            });
            document.querySelectorAll('.ospf-link').forEach(l => {
                l.classList.remove('active', 'shortest-path');
            });

            // Clear routing tables
            document.querySelector('#routingTableA tbody').innerHTML = '';
            document.querySelector('#routingTableG tbody').innerHTML = '';

            updateOSPFStatus('Starting OSPF neighbor discovery...', true);

            // Phase 1: Neighbor Discovery from Router A
            ospfTimeouts.push(setTimeout(() => {
                updateOSPFStepDetails('Phase 1: Neighbor Discovery',
                    'Router A sends Hello packets (multicast to 224.0.0.5) on all interfaces to discover neighbors. Routers B, C, and D receive these hellos and respond. Each router learns about its directly connected neighbors and establishes adjacencies.');

                document.querySelector('[data-router="A"]').classList.add('active');
                updateRouterStatus('A', 'Sending Hello');

                ospfTimeouts.push(setTimeout(() => {
                    ['B', 'C', 'D'].forEach(r => {
                        document.querySelector(`[data-router="${r}"]`).classList.add('neighbor');
                        updateRouterStatus(r, 'Neighbor Found');
                    });
                    ['A-B', 'A-C', 'A-D'].forEach(link => {
                        document.querySelector(`[data-link="${link}"]`).classList.add('active');
                    });

                    updateOSPFStatus('Router A discovered neighbors B, C, and D', true);
                }, 800));
            }, 500));

            // Phase 2: Database Exchange
            ospfTimeouts.push(setTimeout(() => {
                document.querySelectorAll('.ospf-router').forEach(r => r.classList.add('active'));
                document.querySelectorAll('.ospf-link').forEach(l => l.classList.add('active'));

                updateOSPFStepDetails('Phase 2: LSA Exchange',
                    'All routers exchange Link-State Advertisements (LSAs). Each router describes its directly connected links and their costs. These LSAs flood through the network so every router builds an identical Link-State Database (LSDB) containing the complete network topology.');

                ['A', 'B', 'C', 'D', 'E', 'F', 'G'].forEach(r => {
                    updateRouterStatus(r, 'Exchanging LSAs');
                });
                updateOSPFStatus('All routers exchanging Link-State Advertisements...', true);
            }, 2500));

            // Phase 3: SPF Calculation
            ospfTimeouts.push(setTimeout(() => {
                updateOSPFStepDetails('Phase 3: SPF Calculation (Dijkstra\'s Algorithm)',
                    'Each router independently runs Dijkstra\'s Shortest Path First algorithm on the identical LSDB. Starting from itself as the root, each router calculates the lowest-cost path to every destination. This creates a Shortest Path Tree with the router at the center.');

                ['A', 'B', 'C', 'D', 'E', 'F', 'G'].forEach(r => {
                    updateRouterStatus(r, 'Running SPF');
                });
                updateOSPFStatus('Routers calculating shortest paths using Dijkstra algorithm...', true);
            }, 4000));

            // Phase 4: Populate Routing Tables
            ospfTimeouts.push(setTimeout(() => {
                updateOSPFStepDetails('Phase 4: Routing Table Installation',
                    'Best routes are installed in each router\'s routing table. Notice Router A\'s best path to G is via B→E→G (cost 3) using high-speed 10Gbps links, NOT via the slow D→F→G path (cost 210). This demonstrates OSPF\'s cost-based routing - it chooses the fastest path, not just the shortest hop count!');

                // Router A routing table - showing paths to all destinations
                addOSPFRoute('routingTableA', 'Router B', 'Direct', '1', 'Gi0/1');
                ospfTimeouts.push(setTimeout(() => {
                    addOSPFRoute('routingTableA', 'Router C', 'Direct', '10', 'Fa0/0');
                }, 150));
                ospfTimeouts.push(setTimeout(() => {
                    addOSPFRoute('routingTableA', 'Router D', 'Direct', '100', 'Eth0/0');
                }, 300));
                ospfTimeouts.push(setTimeout(() => {
                    addOSPFRoute('routingTableA', 'Router E', 'via B', '2', 'Gi0/1');
                }, 450));
                ospfTimeouts.push(setTimeout(() => {
                    addOSPFRoute('routingTableA', 'Router F', 'via C', '20', 'Fa0/0');
                }, 600));
                ospfTimeouts.push(setTimeout(() => {
                    addOSPFRoute('routingTableA', 'Router G (BEST)', 'via B', '3', 'Gi0/1');
                }, 750));

                // Router G routing table - reverse paths
                ospfTimeouts.push(setTimeout(() => {
                    addOSPFRoute('routingTableG', 'Router E', 'Direct', '1', 'Gi0/1');
                }, 900));
                ospfTimeouts.push(setTimeout(() => {
                    addOSPFRoute('routingTableG', 'Router F', 'Direct', '10', 'Fa0/0');
                }, 1050));
                ospfTimeouts.push(setTimeout(() => {
                    addOSPFRoute('routingTableG', 'Router B', 'via E', '2', 'Gi0/1');
                }, 1200));
                ospfTimeouts.push(setTimeout(() => {
                    addOSPFRoute('routingTableG', 'Router A (SRC)', 'via E', '3', 'Gi0/1');
                }, 1350));

                ['A', 'B', 'C', 'D', 'E', 'F', 'G'].forEach(r => {
                    updateRouterStatus(r, 'Routes Installed');
                });
                updateOSPFStatus('OSPF convergence complete! Routing tables populated.', false);
            }, 5500));

            // Final cleanup
            ospfTimeouts.push(setTimeout(() => {
                document.querySelectorAll('.ospf-router').forEach(r => r.classList.remove('active', 'neighbor'));
                document.querySelectorAll('.ospf-link').forEach(l => l.classList.remove('active'));

                ['A', 'B', 'C', 'D', 'E', 'F', 'G'].forEach(r => {
                    updateRouterStatus(r, 'Ready');
                });

                ospfAnimationRunning = false;
            }, 8000));

            markSectionComplete('ospf');
        }

        function showOSPFPath() {
            // Highlight shortest path from A to G (A → B → E → G = cost 3)
            document.querySelectorAll('.ospf-link').forEach(l => l.classList.remove('shortest-path'));

            updateOSPFStepDetails('Shortest Path Analysis: A → G',
                '<strong>Why OSPF chooses the fast path over short path:</strong><br><br>' +
                '<strong>✓ BEST PATH: A → B → E → G</strong><br>' +
                'Cost: 1 (10Gbps) + 1 (10Gbps) + 1 (10Gbps) = <strong>3</strong><br>' +
                'Hops: 3 | Speed: Super fast!<br><br>' +
                '<strong>Alternative: A → C → F → G</strong><br>' +
                'Cost: 10 (100Mbps) + 10 (100Mbps) + 10 (100Mbps) = <strong>30</strong><br>' +
                'Hops: 3 | Speed: Moderate<br><br>' +
                '<strong>Worst: A → D → F → G</strong><br>' +
                'Cost: 100 (10Mbps) + 100 (10Mbps) + 10 (100Mbps) = <strong>210</strong><br>' +
                'Hops: 3 | Speed: Very slow!<br><br>' +
                '<strong>Key Insight:</strong> All paths have the same number of hops (3), but OSPF intelligently selects the path with the lowest cost based on link bandwidth. The 10Gbps path is 70x better than the 10Mbps path! This is why OSPF is superior to hop-count protocols like RIP.');

            // Highlight the winning path
            document.querySelector('[data-link="A-B"]').classList.add('shortest-path');
            document.querySelector('[data-link="B-E"]').classList.add('shortest-path');
            document.querySelector('[data-link="E-G"]').classList.add('shortest-path');

            // Highlight the routers in the path
            ['A', 'B', 'E', 'G'].forEach(r => {
                document.querySelector(`[data-router="${r}"]`).classList.add('active');
            });

            updateOSPFStatus('Shortest path A→B→E→G highlighted (total cost: 3)', false);
        }

        function resetOSPF() {
            // Clear timeouts
            ospfTimeouts.forEach(id => clearTimeout(id));
            ospfTimeouts = [];
            ospfAnimationRunning = false;

            // Reset visuals
            document.querySelectorAll('.ospf-router').forEach(r => {
                r.classList.remove('active', 'neighbor');
            });
            document.querySelectorAll('.ospf-link').forEach(l => {
                l.classList.remove('active', 'shortest-path');
            });

            // Clear routing tables
            document.querySelector('#routingTableA tbody').innerHTML = '';
            document.querySelector('#routingTableG tbody').innerHTML = '';

            // Reset router statuses
            ['A', 'B', 'C', 'D', 'E', 'F', 'G'].forEach(r => {
                updateRouterStatus(r, 'Idle');
            });

            updateOSPFStatus('Click "Start OSPF Process" to see how routers discover neighbors and exchange routing information.', false);

            const details = document.getElementById('ospfStepDetails');
            if (details) {
                details.innerHTML = '<p>The animation will demonstrate OSPF neighbor discovery, LSA flooding, and shortest path calculation.</p>';
            }
        }

        function updateOSPFStatus(message, active) {
            const statusEl = document.getElementById('ospfStatus');
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.style.color = active ? '#2ecc71' : '#7f8c8d';
            }
        }

        function updateOSPFStepDetails(title, description) {
            const details = document.getElementById('ospfStepDetails');
            if (details) {
                details.innerHTML = `
                    <h4 style="color: var(--accent-purple); margin-bottom: 10px;">${title}</h4>
                    <p style="line-height: 1.8;">${description}</p>
                `;
            }
        }

        function updateRouterStatus(router, status) {
            const statusEl = document.getElementById(`router${router}Status`);
            if (statusEl) {
                statusEl.textContent = status;
            }
        }

        function addOSPFRoute(tableId, destination, nextHop, cost, intf) {
            const tbody = document.querySelector(`#${tableId} tbody`);
            if (!tbody) return;

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${destination}</td>
                <td>${nextHop}</td>
                <td>${cost}</td>
                <td>${intf}</td>
            `;

            tbody.appendChild(row);

            // Animate row appearance
            setTimeout(() => {
                row.classList.add('visible');
            }, 50);
        }

        function showOSPFAnswer(num) {
            const answer = document.getElementById(`ospfAnswer${num}`);
            if (!answer) return;

            const isHidden = answer.style.display === 'none' || !answer.style.display;
            answer.style.display = isHidden ? 'block' : 'none';

            // Update button text
            const button = answer.previousElementSibling;
            if (button && button.tagName === 'BUTTON') {
                button.textContent = isHidden ? 'Hide Answer' : 'Show Answer';
            }
        }

        // ========== RIP VISUALIZATION ==========
        let ripAnimationRunning = false;
        let ripTimeouts = [];

        function startRIPAnimation() {
            if (ripAnimationRunning) return;

            // Auto-scroll to keep visualization visible
            scrollToElement('#ripTopology', -100);

            ripAnimationRunning = true;

            ripTimeouts.forEach(id => clearTimeout(id));
            ripTimeouts = [];

            document.querySelectorAll('.rip-router').forEach(r => r.classList.remove('active'));
            document.querySelectorAll('.rip-link').forEach(l => l.classList.remove('bad-path'));
            document.querySelector('#ripTableA tbody').innerHTML = '';

            updateRIPStatus('Starting RIP updates (every 30 seconds)...', true);

            // Phase 1: Initial updates
            ripTimeouts.push(setTimeout(() => {
                updateRIPStepDetails('Phase 1: Distance Vector Exchange',
                    'Each router broadcasts its entire routing table to its directly connected neighbors every 30 seconds. This is very inefficient compared to OSPF\'s event-driven LSAs. Routers use the Bellman-Ford algorithm to calculate best paths based solely on hop count.');

                ['A', 'B', 'C', 'D', 'E', 'F', 'G'].forEach(r => {
                    updateRIPRouterStatus(r, 'Broadcasting');
                });
                updateRIPStatus('All routers broadcasting routing tables...', true);
            }, 500));

            // Phase 2: Routing table population
            ripTimeouts.push(setTimeout(() => {
                updateRIPStepDetails('Phase 2: Routing Table Construction',
                    'Router A builds its routing table. Notice it sees THREE equal-cost paths to Router G (all 3 hops). RIP cannot distinguish between the blazing-fast 10Gbps path and the painfully slow 10Mbps path. It might randomly choose the worst option!');

                addRIPRoute('ripTableA', 'Router B', 'Direct', '1', '30s');
                ripTimeouts.push(setTimeout(() => addRIPRoute('ripTableA', 'Router C', 'Direct', '1', '30s'), 150));
                ripTimeouts.push(setTimeout(() => addRIPRoute('ripTableA', 'Router D', 'Direct', '1', '30s'), 300));
                ripTimeouts.push(setTimeout(() => addRIPRoute('ripTableA', 'Router E', 'via B/C', '2', '30s'), 450));
                ripTimeouts.push(setTimeout(() => addRIPRoute('ripTableA', 'Router F', 'via C/D', '2', '30s'), 600));
                ripTimeouts.push(setTimeout(() => addRIPRoute('ripTableA', 'Router G', 'via B/C/D', '3', '30s'), 750));

                ['A', 'B', 'C', 'D', 'E', 'F', 'G'].forEach(r => {
                    updateRIPRouterStatus(r, 'Table Updated');
                });
                updateRIPStatus('RIP convergence complete. All paths have equal metric!', false);
            }, 2500));

            // Cleanup
            ripTimeouts.push(setTimeout(() => {
                document.querySelectorAll('.rip-router').forEach(r => r.classList.remove('active'));
                ['A', 'B', 'C', 'D', 'E', 'F', 'G'].forEach(r => updateRIPRouterStatus(r, 'Ready'));
                ripAnimationRunning = false;
            }, 4500));

            markSectionComplete('rip');
        }

        function showRIPProblem() {
            document.querySelectorAll('.rip-link').forEach(l => l.classList.remove('bad-path'));

            // Highlight potentially BAD path that RIP might choose
            updateRIPStepDetails('RIP\'s Fatal Flaw: Hop-Count Blindness',
                '<strong style="color: #e74c3c;">⚠️ WARNING: RIP might choose the SLOW path!</strong><br><br>' +
                '<strong>All paths have 3 hops, so RIP sees them as EQUAL:</strong><br><br>' +
                '1️⃣ A → B → E → G (3 hops, 10Gbps each = SUPER FAST) ✓<br>' +
                '2️⃣ A → C → F → G (3 hops, 100Mbps each = Moderate)<br>' +
                '3️⃣ A → D → F → G (3 hops, 10Mbps links = PAINFULLY SLOW) ⚠️<br><br>' +
                '<strong>The Problem:</strong> RIP uses load balancing or random selection among equal-metric paths. It has a 33% chance of choosing the horrifically slow D→F path! Meanwhile, OSPF would ALWAYS pick the fast path because it considers bandwidth.<br><br>' +
                '<strong>Real-World Impact:</strong> Users experience 1000x slower speeds just because the network admin used RIP instead of OSPF. This is why RIP is considered obsolete for modern networks.');

            // Highlight the potentially bad path in red
            document.querySelector('[data-link="A-D"]').classList.add('bad-path');
            document.querySelector('[data-link="D-F"]').classList.add('bad-path');
            document.querySelector('[data-link="F-G"]').classList.add('bad-path');

            updateRIPStatus('RIP ERROR: Might route traffic through 10Mbps links!', false);
        }

        function resetRIP() {
            ripTimeouts.forEach(id => clearTimeout(id));
            ripTimeouts = [];
            ripAnimationRunning = false;

            document.querySelectorAll('.rip-router').forEach(r => r.classList.remove('active'));
            document.querySelectorAll('.rip-link').forEach(l => l.classList.remove('bad-path'));
            document.querySelector('#ripTableA tbody').innerHTML = '';

            ['A', 'B', 'C', 'D', 'E', 'F', 'G'].forEach(r => updateRIPRouterStatus(r, 'Idle'));

            updateRIPStatus('Click "Start RIP Process" to see how RIP distributes routing information every 30 seconds.', false);

            const details = document.getElementById('ripStepDetails');
            if (details) {
                details.innerHTML = '<p>The animation will demonstrate RIP\'s distance-vector algorithm and its limitations.</p>';
            }
        }

        function updateRIPStatus(message, active) {
            const statusEl = document.getElementById('ripStatus');
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.style.color = active ? '#e74c3c' : '#7f8c8d';
            }
        }

        function updateRIPStepDetails(title, description) {
            const details = document.getElementById('ripStepDetails');
            if (details) {
                details.innerHTML = `
                    <h4 style="color: #e74c3c; margin-bottom: 10px;">${title}</h4>
                    <p style="line-height: 1.8;">${description}</p>
                `;
            }
        }

        function updateRIPRouterStatus(router, status) {
            const statusEl = document.getElementById(`ripRouter${router}Status`);
            if (statusEl) {
                statusEl.textContent = status;
            }
        }

        function addRIPRoute(tableId, destination, nextHop, hops, timer) {
            const tbody = document.querySelector(`#${tableId} tbody`);
            if (!tbody) return;

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${destination}</td>
                <td>${nextHop}</td>
                <td>${hops}</td>
                <td>${timer}</td>
            `;

            tbody.appendChild(row);

            setTimeout(() => {
                row.classList.add('visible');
            }, 50);
        }

        function showRIPAnswer(num) {
            const answer = document.getElementById(`ripAnswer${num}`);
            if (!answer) return;

            const isHidden = answer.style.display === 'none' || !answer.style.display;
            answer.style.display = isHidden ? 'block' : 'none';

            const button = answer.previousElementSibling;
            if (button && button.tagName === 'BUTTON') {
                button.textContent = isHidden ? 'Hide Answer' : 'Show Answer';
            }
        }

        // ========== STP VISUALIZATION ==========
        let stpAnimationRunning = false;
        let stpTimeouts = [];

        function startSTPAnimation() {
            if (stpAnimationRunning) return;

            // Auto-scroll to keep visualization visible
            scrollToElement('.stp-demo', -100);

            stpAnimationRunning = true;

            stpTimeouts.forEach(id => clearTimeout(id));
            stpTimeouts = [];

            document.querySelectorAll('.stp-switch').forEach(s => s.classList.remove('root'));
            document.getElementById('linkBC').classList.remove('blocked');

            updateSTPStatus('Starting STP convergence...', true);

            stpTimeouts.push(setTimeout(() => {
                updateSTPStepDetails('Step 1: Root Bridge Election',
                    'All switches send BPDUs claiming to be root. Switch A has priority 4096 (lowest), so it wins. Switches B and C update their BPDUs to advertise Switch A as root.');

                document.querySelector('[data-switch="A"]').classList.add('root');
                document.getElementById('switchAStatus').textContent = 'ROOT BRIDGE';
                updateSTPStatus('Switch A elected as root bridge', true);
            }, 500));

            stpTimeouts.push(setTimeout(() => {
                updateSTPStepDetails('Step 2: Calculate Root Path Cost',
                    'Each switch calculates its cost to reach the root:<br>• Switch B: Cost 4 (direct to A)<br>• Switch C: Cost 4 (direct to A)<br>• B-C link creates redundancy with cost 19');

                document.getElementById('switchBStatus').textContent = 'Root Path Cost: 4';
                document.getElementById('switchCStatus').textContent = 'Root Path Cost: 4';
                updateSTPStatus('Root path costs calculated', true);
            }, 2000));

            stpTimeouts.push(setTimeout(() => {
                updateSTPStepDetails('Step 3: Block Redundant Link',
                    'The B-C link (cost 19) creates a loop. STP blocks the port with higher Bridge ID. Switch B blocks its port to prevent broadcast storms while keeping it as backup.');

                document.getElementById('linkBC').classList.add('blocked');
                document.getElementById('portB2').setAttribute('fill', '#e74c3c');
                updateSTPStatus('B-C link blocked to prevent loops', false);
            }, 3500));

            stpTimeouts.push(setTimeout(() => {
                updateSTPStepDetails('STP Convergence Complete',
                    'Network is loop-free! All traffic flows through root Switch A. If link A-B fails, STP will automatically unblock the B-C link within 30-50 seconds (or 2-3 seconds with Rapid STP).');

                stpAnimationRunning = false;
            }, 5000));

            markSectionComplete('stp');
        }

        function simulateLinkFailure() {
            updateSTPStepDetails('Link Failure Simulation: A-B Down',
                'Link A-B has failed! STP detects the loss of BPDUs and recalculates. The blocked B-C port transitions through Listening→Learning→Forwarding states. Network connectivity restored via alternate path!');

            document.getElementById('linkAB').setAttribute('stroke', '#95a5a6');
            document.getElementById('linkAB').setAttribute('stroke-dasharray', '10,5');
            document.getElementById('portB1').setAttribute('fill', '#95a5a6');

            setTimeout(() => {
                document.getElementById('linkBC').classList.remove('blocked');
                document.getElementById('portB2').setAttribute('fill', '#f39c12');

                setTimeout(() => {
                    document.getElementById('portB2').setAttribute('fill', '#2ecc71');
                    updateSTPStatus('Convergence complete: B-C link now forwarding', false);
                }, 1500);
            }, 1000);
        }

        function resetSTP() {
            stpTimeouts.forEach(id => clearTimeout(id));
            stpTimeouts = [];
            stpAnimationRunning = false;

            document.querySelectorAll('.stp-switch').forEach(s => s.classList.remove('root'));
            document.getElementById('linkBC').classList.remove('blocked');
            document.getElementById('linkAB').setAttribute('stroke', '#2ecc71');
            document.getElementById('linkAB').setAttribute('stroke-dasharray', '0');
            document.getElementById('portB1').setAttribute('fill', '#2ecc71');
            document.getElementById('portB2').setAttribute('fill', '#e74c3c');

            document.getElementById('switchAStatus').textContent = 'Priority: 4096';
            document.getElementById('switchBStatus').textContent = 'Priority: 32768';
            document.getElementById('switchCStatus').textContent = 'Priority: 32768';

            updateSTPStatus('Click "Start STP Process" to see root bridge election and port blocking.', false);

            const details = document.getElementById('stpStepDetails');
            if (details) {
                details.innerHTML = '<p>STP will elect a root bridge, calculate best paths, and block redundant links to prevent loops.</p>';
            }
        }

        function updateSTPStatus(message, active) {
            const statusEl = document.getElementById('stpStatus');
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.style.color = active ? '#16a085' : '#7f8c8d';
            }
        }

        function updateSTPStepDetails(title, description) {
            const details = document.getElementById('stpStepDetails');
            if (details) {
                details.innerHTML = `
                    <h4 style="color: #16a085; margin-bottom: 10px;">${title}</h4>
                    <p style="line-height: 1.8;">${description}</p>
                `;
            }
        }

        function showSTPAnswer(num) {
            const answer = document.getElementById(`stpAnswer${num}`);
            if (!answer) return;

            const isHidden = answer.style.display === 'none' || !answer.style.display;
            answer.style.display = isHidden ? 'block' : 'none';

            const button = answer.previousElementSibling;
            if (button && button.tagName === 'BUTTON') {
                button.textContent = isHidden ? 'Hide Answer' : 'Show Answer';
            }
        }

        // ========== VLAN VISUALIZATION ==========
        function testVLANComm(type) {
            // Auto-scroll to keep visualization visible
            scrollToElement('#vlanDemo', -100);

            document.querySelectorAll('.port').forEach(p => p.classList.remove('active'));
            const detailsPanel = document.getElementById('vlanStepDetails');
            const detailsContent = detailsPanel.querySelector('.step-details-content');

            if (type === 'same') {
                document.querySelectorAll('.port.vlan-10').forEach(p => p.classList.add('active'));

                detailsContent.innerHTML = `
                    <h4 style="color: #2ecc71; margin-bottom: 10px;">✅ SUCCESS - Communication Allowed</h4>
                    <p><strong>Scenario:</strong> PC1 (VLAN 10, Port 1) pinging PC2 (VLAN 10, Port 2)</p>
                    <p><strong>Result:</strong> PING SUCCESSFUL! Both devices are in the same VLAN (10), so they're in the same broadcast domain. The switch forwards the frame between ports 1 and 2.</p>
                    <p><strong>What happened:</strong></p>
                    <ol>
                        <li>PC1 sends ARP broadcast to find PC2's MAC address</li>
                        <li>Switch floods ARP only to ports in VLAN 10 (Port 2)</li>
                        <li>PC2 responds with its MAC address</li>
                        <li>PC1 sends ICMP echo request directly to PC2</li>
                        <li>Communication succeeds!</li>
                    </ol>
                `;
                updateVLANStatus('✅ Same VLAN communication: SUCCESSFUL', true);
            } else {
                const port10 = document.querySelector('.port.vlan-10');
                const port20 = document.querySelector('.port.vlan-20');
                port10.classList.add('active');
                port20.classList.add('active');

                detailsPanel.innerHTML = `
                    <h3>Result</h3>
                    <div class="step-details-content">
                        <h4 style="color: #e74c3c; margin-bottom: 10px;">❌ FAILED - Communication BLOCKED</h4>
                        <p><strong>Scenario:</strong> PC1 (VLAN 10, Port 1) trying to ping PC3 (VLAN 20, Port 3)</p>
                        <p><strong>Result:</strong> PING FAILED! Even though both PCs are connected to the SAME physical switch, they cannot communicate because they're in different VLANs.</p>
                        <p><strong>Why it failed:</strong></p>
                        <ol>
                            <li>PC1 sends ARP broadcast to find PC3's MAC address</li>
                            <li>Switch receives the ARP on Port 1 (VLAN 10)</li>
                            <li>Switch only floods ARP to other VLAN 10 ports (Port 2)</li>
                            <li>PC3 on VLAN 20 NEVER receives the ARP request</li>
                            <li>PC1 gets "Destination Host Unreachable"</li>
                        </ol>
                        <p><strong>Solution:</strong> Need a Layer 3 device (router or Layer 3 switch) to route between VLANs. This is called "inter-VLAN routing."</p>
                    </div>
                `;
                updateVLANStatus('❌ Different VLAN communication: BLOCKED (by design!)', false);
            }

            detailsPanel.style.display = 'block';
            markSectionComplete('vlans');
        }

        function showTrunkDemo() {
            document.querySelectorAll('.port').forEach(p => p.classList.remove('active'));
            document.querySelector('.port.trunk').classList.add('active');

            const detailsPanel = document.getElementById('vlanStepDetails');
            detailsPanel.innerHTML = `
                <h3>Trunk Port Demonstration</h3>
                <div class="step-details-content">
                    <h4 style="color: var(--accent-purple); margin-bottom: 10px;">🔀 Trunk Port (802.1Q)</h4>
                    <p><strong>What is it:</strong> A trunk port carries traffic for MULTIPLE VLANs simultaneously. This port would typically connect to another switch or a router.</p>
                    <p><strong>How it works:</strong></p>
                    <ol>
                        <li><strong>Frame Tagging:</strong> When a frame enters the switch on a VLAN 10 access port, the switch adds a 4-byte 802.1Q tag containing VLAN ID = 10</li>
                        <li><strong>Trunk Transmission:</strong> Tagged frame is sent out the trunk port</li>
                        <li><strong>Receiving Switch:</strong> Next switch reads the tag, knows it's VLAN 10, and forwards only to VLAN 10 ports</li>
                        <li><strong>Tag Removal:</strong> When forwarding to an access port, the tag is removed</li>
                    </ol>
                    <p><strong>Example Frame:</strong></p>
                    <pre style="background: var(--bg-primary); padding: 10px; border-radius: 4px; font-size: 0.85em;">
[Dest MAC][Src MAC][802.1Q Tag: VLAN 10][Type][Data][FCS]
                     ^^^^^^^^^^^^^^^^
                     4 bytes added by trunk
                    </pre>
                    <p><strong>Native VLAN:</strong> Frames for VLAN 1 (default native) are NOT tagged. Security best practice: change native VLAN to an unused VLAN!</p>
                </div>
            `;
            detailsPanel.style.display = 'block';
            updateVLANStatus('Trunk port carries all VLANs using 802.1Q tagging', true);
        }

        function updateVLANStatus(message, active) {
            const statusEl = document.getElementById('vlanStatus');
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.style.color = active ? 'var(--accent-purple)' : '#e74c3c';
            }
        }

        function showVLANAnswer(num) {
            const answer = document.getElementById(`vlanAnswer${num}`);
            if (!answer) return;

            const isHidden = answer.style.display === 'none' || !answer.style.display;
            answer.style.display = isHidden ? 'block' : 'none';

            const button = answer.previousElementSibling;
            if (button && button.tagName === 'BUTTON') {
                button.textContent = isHidden ? 'Hide Answer' : 'Show Answer';
            }
        }

        // ========== NETWORK ALGORITHMS ==========
        let algoTimeouts = [];
        let dijkstraState = {
            nodes: [],
            edges: [],
            distances: {},
            visited: new Set(),
            previous: {},
            current: null,
            step: 0,
            steps: []
        };

        // Initialize the Dijkstra graph visualization
        function initDijkstraGraph() {
            const container = document.getElementById('dijkstraGraph');
            if (!container) return;

            // Clear previous content
            container.innerHTML = '';

            // Define network topology (6 nodes in a mesh-like structure)
            const nodes = [
                { id: 'A', x: 100, y: 200, label: 'A (Source)' },
                { id: 'B', x: 250, y: 100, label: 'B' },
                { id: 'C', x: 250, y: 300, label: 'C' },
                { id: 'D', x: 400, y: 100, label: 'D' },
                { id: 'E', x: 400, y: 300, label: 'E' },
                { id: 'F', x: 550, y: 200, label: 'F (Target)' }
            ];

            const edges = [
                { from: 'A', to: 'B', weight: 4 },
                { from: 'A', to: 'C', weight: 2 },
                { from: 'B', to: 'D', weight: 5 },
                { from: 'B', to: 'C', weight: 1 },
                { from: 'C', to: 'E', weight: 10 },
                { from: 'D', to: 'F', weight: 3 },
                { from: 'E', to: 'F', weight: 2 },
                { from: 'D', to: 'E', weight: 2 }
            ];

            dijkstraState.nodes = nodes;
            dijkstraState.edges = edges;

            // Draw edges first (so they appear behind nodes)
            edges.forEach((edge, index) => {
                const fromNode = nodes.find(n => n.id === edge.from);
                const toNode = nodes.find(n => n.id === edge.to);

                const dx = toNode.x - fromNode.x;
                const dy = toNode.y - fromNode.y;
                const length = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;

                const edgeEl = document.createElement('div');
                edgeEl.className = 'algo-edge';
                edgeEl.id = `edge-${edge.from}-${edge.to}`;
                edgeEl.style.left = `${fromNode.x + 25}px`;
                edgeEl.style.top = `${fromNode.y + 25}px`;
                edgeEl.style.width = `${length}px`;
                edgeEl.style.height = '2px';
                edgeEl.style.transform = `rotate(${angle}deg)`;
                container.appendChild(edgeEl);

                // Add weight label
                const weightEl = document.createElement('div');
                weightEl.className = 'edge-weight';
                weightEl.textContent = edge.weight;
                weightEl.style.left = `${fromNode.x + dx / 2 + 15}px`;
                weightEl.style.top = `${fromNode.y + dy / 2 + 15}px`;
                container.appendChild(weightEl);
            });

            // Draw nodes
            nodes.forEach(node => {
                const nodeEl = document.createElement('div');
                nodeEl.className = 'algo-node';
                nodeEl.id = `node-${node.id}`;
                nodeEl.textContent = node.id;
                nodeEl.style.left = `${node.x}px`;
                nodeEl.style.top = `${node.y}px`;
                nodeEl.title = `${node.label}\nDistance: ∞`;
                container.appendChild(nodeEl);
            });
        }

        // Initialize Dijkstra's algorithm
        function resetDijkstra() {
            algoTimeouts.forEach(clearTimeout);
            algoTimeouts = [];

            dijkstraState = {
                nodes: dijkstraState.nodes,
                edges: dijkstraState.edges,
                distances: {},
                visited: new Set(),
                previous: {},
                current: null,
                step: 0,
                steps: []
            };

            initDijkstraGraph();

            document.getElementById('stepsList').innerHTML = '';
            updateAlgoStatus('Graph reset. Click "Run Dijkstra\'s Algorithm" to begin.', false);
        }

        // Run Dijkstra's algorithm with visualization
        function startDijkstra() {
            // Auto-scroll to keep visualization visible
            scrollToElement('#dijkstraGraph', -100);

            resetDijkstra();

            const source = 'A';
            const target = 'F';

            // Initialize distances
            dijkstraState.nodes.forEach(node => {
                dijkstraState.distances[node.id] = node.id === source ? 0 : Infinity;
                dijkstraState.previous[node.id] = null;
            });

            dijkstraState.steps = [
                { node: source, dist: 0, action: `Initialize: Set distance to ${source} = 0, all others = ∞` }
            ];

            updateAlgoStatus(`Starting Dijkstra's Algorithm from ${source} to ${target}...`, true);

            // Run algorithm step by step with animations
            runDijkstraSteps(source, target, 0);
        }

        function runDijkstraSteps(source, target, delay) {
            const unvisited = dijkstraState.nodes
                .map(n => n.id)
                .filter(id => !dijkstraState.visited.has(id));

            if (unvisited.length === 0) {
                // Algorithm complete - show shortest path
                algoTimeouts.push(setTimeout(() => {
                    showShortestPath(source, target);
                }, delay));
                return;
            }

            // Find unvisited node with minimum distance
            let minDist = Infinity;
            let current = null;
            unvisited.forEach(nodeId => {
                if (dijkstraState.distances[nodeId] < minDist) {
                    minDist = dijkstraState.distances[nodeId];
                    current = nodeId;
                }
            });

            if (current === null || minDist === Infinity) {
                updateAlgoStatus('No path exists to remaining nodes.', false);
                return;
            }

            dijkstraState.current = current;
            dijkstraState.visited.add(current);

            // Visualize current node
            algoTimeouts.push(setTimeout(() => {
                const nodeEl = document.getElementById(`node-${current}`);
                if (nodeEl) {
                    nodeEl.classList.add('current');
                    nodeEl.title = `${current}\nDistance: ${dijkstraState.distances[current]}`;
                }

                const stepMsg = `Visit ${current} (distance: ${dijkstraState.distances[current]})`;
                dijkstraState.steps.push({ node: current, dist: dijkstraState.distances[current], action: stepMsg });
                addAlgoStep(stepMsg, true);
                updateAlgoStatus(`Processing node ${current}...`, true);

                // Update neighbors
                const neighbors = dijkstraState.edges.filter(e => e.from === current || e.to === current);

                neighbors.forEach((edge, i) => {
                    const neighbor = edge.from === current ? edge.to : edge.from;

                    if (!dijkstraState.visited.has(neighbor)) {
                        const newDist = dijkstraState.distances[current] + edge.weight;

                        if (newDist < dijkstraState.distances[neighbor]) {
                            dijkstraState.distances[neighbor] = newDist;
                            dijkstraState.previous[neighbor] = current;

                            const updateMsg = `  Update ${neighbor}: ${dijkstraState.distances[current]} + ${edge.weight} = ${newDist}`;
                            dijkstraState.steps.push({ node: neighbor, dist: newDist, action: updateMsg });

                            algoTimeouts.push(setTimeout(() => {
                                addAlgoStep(updateMsg, false);

                                // Highlight edge
                                const edgeEl = document.getElementById(`edge-${edge.from}-${edge.to}`);
                                if (edgeEl) edgeEl.classList.add('active');

                                // Update neighbor node
                                const neighborEl = document.getElementById(`node-${neighbor}`);
                                if (neighborEl) {
                                    neighborEl.title = `${neighbor}\nDistance: ${newDist}`;
                                }
                            }, 500 * i));
                        }
                    }
                });

                // Mark current as visited and continue
                algoTimeouts.push(setTimeout(() => {
                    const nodeEl = document.getElementById(`node-${current}`);
                    if (nodeEl) {
                        nodeEl.classList.remove('current');
                        nodeEl.classList.add('visited');
                    }

                    runDijkstraSteps(source, target, 0);
                }, 1000 + neighbors.length * 500));

            }, delay));
        }

        function showShortestPath(source, target) {
            updateAlgoStatus(`Algorithm complete! Highlighting shortest path from ${source} to ${target}...`, true);

            // Reconstruct path
            const path = [];
            let current = target;

            while (current !== null) {
                path.unshift(current);
                current = dijkstraState.previous[current];
            }

            if (path[0] !== source) {
                updateAlgoStatus(`No path exists from ${source} to ${target}`, false);
                return;
            }

            const totalDistance = dijkstraState.distances[target];
            addAlgoStep(`Shortest path: ${path.join(' → ')} (Total distance: ${totalDistance})`, true);

            // Highlight path
            path.forEach((nodeId, i) => {
                algoTimeouts.push(setTimeout(() => {
                    const nodeEl = document.getElementById(`node-${nodeId}`);
                    if (nodeEl) {
                        nodeEl.classList.add('shortest-path');
                    }

                    if (i < path.length - 1) {
                        const nextNode = path[i + 1];
                        const edge = dijkstraState.edges.find(e =>
                            (e.from === nodeId && e.to === nextNode) ||
                            (e.to === nodeId && e.from === nextNode)
                        );

                        if (edge) {
                            const edgeEl = document.getElementById(`edge-${edge.from}-${edge.to}`);
                            if (edgeEl) edgeEl.classList.add('shortest-path');
                        }
                    }
                }, 300 * i));
            });

            algoTimeouts.push(setTimeout(() => {
                updateAlgoStatus(`✅ Shortest path found: ${path.join(' → ')} | Total cost: ${totalDistance}`, false);
            }, 300 * path.length + 200));
        }

        function stepDijkstra() {
            updateAlgoStatus('Step-by-step mode not yet implemented. Use "Run Dijkstra\'s Algorithm" for full visualization.', false);
        }

        function compareBellmanFord() {
            updateAlgoStatus('Bellman-Ford comparison: B-F would relax ALL edges 5 times (V-1), while Dijkstra visits each node once in optimal order. For this 6-node graph, B-F does ~40 operations vs Dijkstra\'s ~15.', false);

            addAlgoStep('Bellman-Ford Analysis:', true);
            addAlgoStep('  - Iterations: 5 (V-1 where V=6)', false);
            addAlgoStep('  - Operations per iteration: ~8 edge relaxations', false);
            addAlgoStep('  - Total: ~40 operations', false);
            addAlgoStep('  - Dijkstra: ~15 operations (one visit per node + neighbor updates)', false);
            addAlgoStep('  - Winner: Dijkstra is ~2.7x more efficient for this graph', false);
        }

        function addAlgoStep(message, isCurrent) {
            const stepsList = document.getElementById('stepsList');
            const stepEl = document.createElement('div');
            stepEl.className = 'algo-step' + (isCurrent ? ' current' : '');
            stepEl.textContent = message;
            stepsList.appendChild(stepEl);
            stepsList.scrollTop = stepsList.scrollHeight;
        }

        function updateAlgoStatus(message, active) {
            const status = document.getElementById('algoStatus');
            if (status) {
                status.textContent = message;
                status.style.background = active ? 'rgba(6, 182, 212, 0.2)' : 'var(--bg-primary)';
                status.style.borderLeft = active ? '4px solid var(--accent-cyan)' : '4px solid var(--border)';
            }
        }

        function showAlgoAnswer(num) {
            const answer = document.getElementById(`algoAnswer${num}`);
            if (!answer) return;

            const isHidden = answer.style.display === 'none' || !answer.style.display;
            answer.style.display = isHidden ? 'block' : 'none';

            const button = answer.previousElementSibling;
            if (button && button.tagName === 'BUTTON') {
                button.textContent = isHidden ? 'Hide Answer' : 'Show Answer';
            }
        }

        // Initialize algorithms visualization when tab is opened
        document.addEventListener('DOMContentLoaded', function() {
            const algoTab = document.querySelector('[data-section="algorithms"]');
            if (algoTab) {
                algoTab.addEventListener('click', function() {
                    setTimeout(initDijkstraGraph, 100);
                });
            }
        });

        // ========== ANSIBLE AUTOMATION ==========
        let ansibleTimeouts = [];
        let playbookRunning = false;

        // Test inventory connectivity
        function testInventory() {
            const resultDiv = document.getElementById('inventoryResult');
            if (!resultDiv) return;

            resultDiv.innerHTML = '<div class="inventory-display"><p style="color: var(--accent-cyan);">Testing connectivity to managed hosts...</p></div>';

            const hosts = [
                { name: 'router1.example.com', ip: '192.168.1.1', group: 'routers' },
                { name: 'router2.example.com', ip: '192.168.1.2', group: 'routers' },
                { name: 'switch1.example.com', ip: '192.168.1.10', group: 'switches' },
                { name: 'switch2.example.com', ip: '192.168.1.11', group: 'switches' },
                { name: 'firewall1.example.com', ip: '192.168.1.254', group: 'firewalls' }
            ];

            let groupedHosts = {
                routers: [],
                switches: [],
                firewalls: []
            };

            hosts.forEach(host => {
                groupedHosts[host.group].push(host);
            });

            ansibleTimeouts.push(setTimeout(() => {
                let html = '<div class="inventory-display">';

                Object.keys(groupedHosts).forEach(groupName => {
                    html += `<div class="inventory-group">`;
                    html += `<h5>[${groupName}]</h5>`;

                    groupedHosts[groupName].forEach((host, index) => {
                        const isReachable = Math.random() > 0.1; // 90% success rate
                        const statusClass = isReachable ? 'reachable' : 'unreachable';
                        const statusText = isReachable ? 'SUCCESS' : 'UNREACHABLE';
                        const statusBadge = isReachable ? 'success' : 'failed';

                        html += `<div class="inventory-host ${statusClass}">`;
                        html += `<span>${host.name} (${host.ip})</span>`;
                        html += `<span class="host-status ${statusBadge}">${statusText}</span>`;
                        html += `</div>`;
                    });

                    html += `</div>`;
                });

                html += '</div>';
                resultDiv.innerHTML = html;

                const totalHosts = hosts.length;
                const reachable = resultDiv.querySelectorAll('.inventory-host.reachable').length;
                const summary = document.createElement('div');
                summary.style.cssText = 'margin-top: 15px; padding: 15px; background: var(--bg-primary); border-radius: 8px; border-left: 4px solid var(--success);';
                summary.innerHTML = `<strong>✅ Inventory Test Complete:</strong> ${reachable}/${totalHosts} hosts reachable`;
                resultDiv.appendChild(summary);
            }, 1500));
        }

        // Run Ansible playbook simulation
        function runPlaybook() {
            if (playbookRunning) return;

            // Auto-scroll to keep visualization visible
            scrollToElement('#playbookFlow', -100);

            playbookRunning = true;
            const statusDiv = document.getElementById('playbookStatus');
            const outputDiv = document.getElementById('playbookOutput');
            const outputContent = document.getElementById('outputContent');

            // Reset flow steps
            for (let i = 1; i <= 5; i++) {
                const step = document.getElementById(`step${i}`);
                if (step) {
                    step.classList.remove('active', 'completed');
                }
            }

            if (statusDiv) {
                statusDiv.textContent = 'Executing playbook...';
                statusDiv.style.background = 'rgba(6, 182, 212, 0.2)';
                statusDiv.style.borderLeft = '4px solid var(--accent-cyan)';
            }

            if (outputDiv) outputDiv.style.display = 'none';
            if (outputContent) outputContent.innerHTML = '';

            const steps = [
                { id: 1, name: 'Gather Facts', duration: 800, output: 'TASK [Gathering Facts] *******\nok: [router1.example.com]\nok: [router2.example.com]' },
                { id: 2, name: 'Task 1: Hostname', duration: 1000, output: 'TASK [Set hostname] **********\nchanged: [router1.example.com]\nchanged: [router2.example.com]' },
                { id: 3, name: 'Task 2: NTP', duration: 1200, output: 'TASK [Configure NTP servers] *\nchanged: [router1.example.com]\nchanged: [router2.example.com]' },
                { id: 4, name: 'Task 3: OSPF', duration: 1500, output: 'TASK [Enable OSPF routing] ***\nchanged: [router1.example.com]\nchanged: [router2.example.com]' },
                { id: 5, name: 'Task 4: Save', duration: 1000, output: 'TASK [Save configuration] ****\nok: [router1.example.com]\nok: [router2.example.com]' }
            ];

            let totalDelay = 0;

            steps.forEach((step, index) => {
                ansibleTimeouts.push(setTimeout(() => {
                    // Update flow visualization
                    const stepEl = document.getElementById(`step${step.id}`);
                    if (stepEl) {
                        // Mark previous as completed
                        if (step.id > 1) {
                            const prevStep = document.getElementById(`step${step.id - 1}`);
                            if (prevStep) {
                                prevStep.classList.remove('active');
                                prevStep.classList.add('completed');
                            }
                        }
                        stepEl.classList.add('active');
                    }

                    // Update status
                    if (statusDiv) {
                        statusDiv.textContent = `Executing: ${step.name}...`;
                    }

                    // Add output
                    if (outputDiv && outputContent) {
                        outputDiv.style.display = 'block';
                        const outputLine = document.createElement('div');
                        outputLine.style.cssText = 'margin: 5px 0; color: #98c379;';
                        outputLine.textContent = step.output;
                        outputContent.appendChild(outputLine);
                        outputDiv.scrollTop = outputDiv.scrollHeight;
                    }

                    // Complete final step
                    if (index === steps.length - 1) {
                        ansibleTimeouts.push(setTimeout(() => {
                            const lastStep = document.getElementById(`step${step.id}`);
                            if (lastStep) {
                                lastStep.classList.remove('active');
                                lastStep.classList.add('completed');
                            }

                            if (statusDiv) {
                                statusDiv.textContent = '✅ Playbook execution completed successfully!';
                                statusDiv.style.background = 'rgba(16, 185, 129, 0.2)';
                                statusDiv.style.borderLeft = '4px solid var(--success)';
                            }

                            if (outputContent) {
                                const recap = document.createElement('div');
                                recap.style.cssText = 'margin-top: 15px; padding: 10px; border-top: 1px solid var(--border);';
                                recap.innerHTML = `<strong style="color: var(--accent-cyan);">PLAY RECAP:</strong><br>
<span style="color: #10b981;">router1.example.com</span> : ok=5 <span style="color: #f59e0b;">changed=4</span> unreachable=0 failed=0<br>
<span style="color: #10b981;">router2.example.com</span> : ok=5 <span style="color: #f59e0b;">changed=4</span> unreachable=0 failed=0`;
                                outputContent.appendChild(recap);
                            }

                            playbookRunning = false;
                        }, step.duration));
                    }
                }, totalDelay));

                totalDelay += step.duration;
            });
        }

        // Reset playbook visualization
        function resetPlaybook() {
            ansibleTimeouts.forEach(clearTimeout);
            ansibleTimeouts = [];
            playbookRunning = false;

            for (let i = 1; i <= 5; i++) {
                const step = document.getElementById(`step${i}`);
                if (step) {
                    step.classList.remove('active', 'completed');
                }
            }

            const statusDiv = document.getElementById('playbookStatus');
            if (statusDiv) {
                statusDiv.textContent = 'Click "Run Playbook" to execute automation tasks.';
                statusDiv.style.background = 'var(--bg-primary)';
                statusDiv.style.borderLeft = '4px solid var(--border)';
            }

            const outputDiv = document.getElementById('playbookOutput');
            if (outputDiv) {
                outputDiv.style.display = 'none';
            }

            const outputContent = document.getElementById('outputContent');
            if (outputContent) {
                outputContent.innerHTML = '';
            }
        }

        // Show Ansible quiz answers
        function showAnsibleAnswer(num) {
            const answer = document.getElementById(`ansibleAnswer${num}`);
            if (!answer) return;

            const isHidden = answer.style.display === 'none' || !answer.style.display;
            answer.style.display = isHidden ? 'block' : 'none';

            const button = answer.previousElementSibling;
            if (button && button.tagName === 'BUTTON') {
                button.textContent = isHidden ? 'Hide Answer' : 'Show Answer';
            }
        }

        // ========== CHEF AUTOMATION ==========
        let chefTimeouts = [];
        let chefClientRunning = false;

        // Run Chef Client simulation
        function runChefClient() {
            if (chefClientRunning) return;

            // Auto-scroll to keep visualization visible
            scrollToElement('#chefFlow', -100);

            chefClientRunning = true;
            const statusDiv = document.getElementById('chefStatus');
            const outputDiv = document.getElementById('chefOutput');
            const outputContent = document.getElementById('chefOutputContent');

            // Reset flow steps
            for (let i = 1; i <= 5; i++) {
                const step = document.getElementById(`chefStep${i}`);
                if (step) {
                    step.classList.remove('active', 'completed');
                }
            }

            if (statusDiv) {
                statusDiv.textContent = 'Starting chef-client run...';
                statusDiv.style.background = 'rgba(6, 182, 212, 0.2)';
                statusDiv.style.borderLeft = '4px solid var(--accent-cyan)';
            }

            if (outputDiv) outputDiv.style.display = 'none';
            if (outputContent) outputContent.innerHTML = '';

            const steps = [
                {
                    id: 1,
                    name: 'Authenticate',
                    duration: 1000,
                    output: '[2025-01-25T10:30:00-05:00] INFO: Starting Chef Infra Client, version 18.2.7\n[2025-01-25T10:30:00-05:00] INFO: Authenticating to Chef Server (chef.example.com)'
                },
                {
                    id: 2,
                    name: 'Sync Cookbooks',
                    duration: 1200,
                    output: '[2025-01-25T10:30:01-05:00] INFO: Synchronizing Cookbooks:\n  - nginx_server (1.2.0)\n  - base_config (2.1.3)'
                },
                {
                    id: 3,
                    name: 'Load Recipes',
                    duration: 800,
                    output: '[2025-01-25T10:30:02-05:00] INFO: Loading cookbooks [nginx_server@1.2.0, base_config@2.1.3]\n[2025-01-25T10:30:02-05:00] INFO: Run List is [recipe[nginx_server::default]]'
                },
                {
                    id: 4,
                    name: 'Converge',
                    duration: 2000,
                    output: '[2025-01-25T10:30:03-05:00] INFO: Processing package[nginx]\n  * package[nginx] action install (up to date)\n[2025-01-25T10:30:04-05:00] INFO: Processing service[nginx]\n  * service[nginx] action enable (up to date)\n  * service[nginx] action start (up to date)\n[2025-01-25T10:30:04-05:00] INFO: Processing template[/etc/nginx/nginx.conf]\n  * template[/etc/nginx/nginx.conf] action create (updated)\n[2025-01-25T10:30:05-05:00] INFO: Processing directory[/var/www/html]\n  * directory[/var/www/html] action create (up to date)\n[2025-01-25T10:30:05-05:00] INFO: Processing file[/var/www/html/index.html]\n  * file[/var/www/html/index.html] action create (updated)'
                },
                {
                    id: 5,
                    name: 'Report',
                    duration: 600,
                    output: '[2025-01-25T10:30:05-05:00] INFO: Chef Infra Client finished, 2/5 resources updated in 05 seconds'
                }
            ];

            let totalDelay = 0;

            steps.forEach((step, index) => {
                chefTimeouts.push(setTimeout(() => {
                    // Update flow visualization
                    const stepEl = document.getElementById(`chefStep${step.id}`);
                    if (stepEl) {
                        // Mark previous as completed
                        if (step.id > 1) {
                            const prevStep = document.getElementById(`chefStep${step.id - 1}`);
                            if (prevStep) {
                                prevStep.classList.remove('active');
                                prevStep.classList.add('completed');
                            }
                        }
                        stepEl.classList.add('active');
                    }

                    // Update status
                    if (statusDiv) {
                        statusDiv.textContent = `Executing: ${step.name}...`;
                    }

                    // Add output
                    if (outputDiv && outputContent) {
                        outputDiv.style.display = 'block';
                        const outputLine = document.createElement('div');
                        outputLine.style.cssText = 'margin: 5px 0; color: #98c379; white-space: pre-wrap; font-size: 0.85em;';
                        outputLine.textContent = step.output;
                        outputContent.appendChild(outputLine);
                        outputDiv.scrollTop = outputDiv.scrollHeight;
                    }

                    // Complete final step
                    if (index === steps.length - 1) {
                        chefTimeouts.push(setTimeout(() => {
                            const lastStep = document.getElementById(`chefStep${step.id}`);
                            if (lastStep) {
                                lastStep.classList.remove('active');
                                lastStep.classList.add('completed');
                            }

                            if (statusDiv) {
                                statusDiv.textContent = '✅ Chef Client run completed successfully!';
                                statusDiv.style.background = 'rgba(16, 185, 129, 0.2)';
                                statusDiv.style.borderLeft = '4px solid var(--success)';
                            }

                            if (outputContent) {
                                const summary = document.createElement('div');
                                summary.style.cssText = 'margin-top: 15px; padding: 10px; border-top: 1px solid var(--border); color: var(--accent-cyan);';
                                summary.innerHTML = `<strong>Chef Infra Client Run Summary:</strong><br>
<span style="color: #10b981;">✔ Resources:</span> 5 total, 2 updated, 3 up-to-date<br>
<span style="color: #10b981;">✔ Run Time:</span> 5.2 seconds<br>
<span style="color: #10b981;">✔ Convergence:</span> SUCCESS`;
                                outputContent.appendChild(summary);
                            }

                            chefClientRunning = false;
                        }, step.duration));
                    }
                }, totalDelay));

                totalDelay += step.duration;
            });
        }

        // Reset Chef Client visualization
        function resetChefClient() {
            chefTimeouts.forEach(clearTimeout);
            chefTimeouts = [];
            chefClientRunning = false;

            for (let i = 1; i <= 5; i++) {
                const step = document.getElementById(`chefStep${i}`);
                if (step) {
                    step.classList.remove('active', 'completed');
                }
            }

            const statusDiv = document.getElementById('chefStatus');
            if (statusDiv) {
                statusDiv.textContent = 'Click "Run chef-client" to execute a convergence cycle.';
                statusDiv.style.background = 'var(--bg-primary)';
                statusDiv.style.borderLeft = '4px solid var(--border)';
            }

            const outputDiv = document.getElementById('chefOutput');
            if (outputDiv) {
                outputDiv.style.display = 'none';
            }

            const outputContent = document.getElementById('chefOutputContent');
            if (outputContent) {
                outputContent.innerHTML = '';
            }
        }

        // Show Chef quiz answers
        function showChefAnswer(num) {
            const answer = document.getElementById(`chefAnswer${num}`);
            if (!answer) return;

            const isHidden = answer.style.display === 'none' || !answer.style.display;
            answer.style.display = isHidden ? 'block' : 'none';

            const button = answer.previousElementSibling;
            if (button && button.tagName === 'BUTTON') {
                button.textContent = isHidden ? 'Hide Answer' : 'Show Answer';
            }
        }

        // ========== SUBNET CALCULATOR ==========
        function calculateSubnet() {
            const ipInput = document.getElementById('ipAddress').value.trim();
            const cidrInput = parseInt(document.getElementById('subnetMask').value.trim());

            // Validate inputs
            if (!isValidIP(ipInput)) {
                showSubnetError("Invalid IP address format");
                return;
            }

            if (isNaN(cidrInput) || cidrInput < 0 || cidrInput > 32) {
                showSubnetError("CIDR must be between 0 and 32");
                return;
            }

            // Calculate subnet details
            const ipParts = ipInput.split('.').map(Number);
            const subnetMask = cidrToMask(cidrInput);
            const wildcardMask = subnetMask.map(octet => 255 - octet);

            const networkAddress = ipParts.map((octet, i) => octet & subnetMask[i]);
            const broadcastAddress = networkAddress.map((octet, i) => octet | wildcardMask[i]);

            const firstUsable = [...networkAddress];
            firstUsable[3] += 1;

            const lastUsable = [...broadcastAddress];
            lastUsable[3] -= 1;

            const hostBits = 32 - cidrInput;
            const totalHosts = Math.pow(2, hostBits);
            const usableHosts = hostBits > 1 ? totalHosts - 2 : (hostBits === 1 ? 2 : 1);

            // Display results
            const resultsPanel = document.getElementById('subnetResults');
            resultsPanel.innerHTML = `
                <div class="result-item">
                    <span class="result-label">Network Address:</span>
                    <span class="result-value">${networkAddress.join('.')}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Subnet Mask:</span>
                    <span class="result-value">${subnetMask.join('.')} (/${cidrInput})</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Wildcard Mask:</span>
                    <span class="result-value">${wildcardMask.join('.')}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">First Usable IP:</span>
                    <span class="result-value">${firstUsable.join('.')}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Last Usable IP:</span>
                    <span class="result-value">${lastUsable.join('.')}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Broadcast Address:</span>
                    <span class="result-value">${broadcastAddress.join('.')}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Total Hosts:</span>
                    <span class="result-value">${totalHosts}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Usable Hosts:</span>
                    <span class="result-value">${usableHosts}</span>
                </div>
            `;

            // Show binary representation
            showBinaryRepresentation(ipParts, subnetMask, networkAddress);
            markSectionComplete('subnet-calc');
        }

        function showBinaryRepresentation(ip, mask, network) {
            const binaryDisplay = document.getElementById('binaryDisplay');
            binaryDisplay.classList.remove('hidden');

            const toBinary = (num) => num.toString(2).padStart(8, '0');

            const content = document.getElementById('binaryContent');
            content.innerHTML = `
                <div style="margin-bottom: 10px;">
                    <strong style="color: var(--accent-cyan);">IP Address:</strong><br>
                    ${ip.map(octet => toBinary(octet)).join('.')} = ${ip.join('.')}
                </div>
                <div style="margin-bottom: 10px;">
                    <strong style="color: var(--accent-cyan);">Subnet Mask:</strong><br>
                    ${mask.map(octet => toBinary(octet)).join('.')} = ${mask.join('.')}
                </div>
                <div>
                    <strong style="color: var(--accent-cyan);">Network Address:</strong><br>
                    ${network.map(octet => toBinary(octet)).join('.')} = ${network.join('.')}
                </div>
            `;
        }

        function cidrToMask(cidr) {
            const mask = [];
            for (let i = 0; i < 4; i++) {
                const n = Math.min(cidr, 8);
                mask.push(256 - Math.pow(2, 8 - n));
                cidr -= n;
            }
            return mask;
        }

        function isValidIP(ip) {
            const parts = ip.split('.');
            if (parts.length !== 4) return false;
            return parts.every(part => {
                const num = parseInt(part);
                return !isNaN(num) && num >= 0 && num <= 255;
            });
        }

        function showSubnetError(message) {
            const resultsPanel = document.getElementById('subnetResults');
            resultsPanel.innerHTML = `<p style="text-align: center; color: var(--error);">${message}</p>`;
        }

        function generatePracticeProblem() {
            const problems = [
                {
                    question: "What is the network address of 192.168.10.45/26?",
                    answer: "192.168.10.0"
                },
                {
                    question: "How many usable hosts are in a /28 subnet?",
                    answer: "14"
                },
                {
                    question: "What is the broadcast address of 10.1.1.64/27?",
                    answer: "10.1.1.95"
                },
                {
                    question: "Convert subnet mask 255.255.255.248 to CIDR notation.",
                    answer: "/29"
                },
                {
                    question: "What is the first usable IP in 172.16.0.0/24?",
                    answer: "172.16.0.1"
                }
            ];

            const problem = problems[Math.floor(Math.random() * problems.length)];
            document.getElementById('practiceProblem').classList.remove('hidden');
            document.getElementById('practiceQuestion').textContent = problem.question;
            document.getElementById('practiceAnswer').value = '';
            document.getElementById('practiceFeedback').classList.add('hidden');

            // Store answer for checking
            document.getElementById('practiceAnswer').dataset.correctAnswer = problem.answer;
        }

        function checkPracticeAnswer() {
            const userAnswer = document.getElementById('practiceAnswer').value.trim();
            const correctAnswer = document.getElementById('practiceAnswer').dataset.correctAnswer;
            const feedback = document.getElementById('practiceFeedback');

            feedback.classList.remove('hidden');

            if (userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
                feedback.innerHTML = `<div class="quiz-feedback correct">✓ Correct! Great job!</div>`;
                progressData.practiceProblems++;
                saveProgress();
            } else {
                feedback.innerHTML = `<div class="quiz-feedback incorrect">✗ Incorrect. The correct answer is: ${correctAnswer}</div>`;
            }
        }

        // ========== CLI SIMULATOR ==========
        function initializeCLI() {
            const cliInput = document.getElementById('cliInput');
            const cliOutput = document.getElementById('cliOutput');

            // Welcome message
            appendCLIOutput(`
Cisco IOS Software Simulator
Copyright (c) 2024 Network Admin Learning Lab

Welcome to Router CLI Simulator
Type 'help' for available commands

`);

            // Handle Enter key
            cliInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    const command = this.value.trim();
                    if (command) {
                        executeCLICommand(command);
                        cliHistory.push(command);
                        historyIndex = cliHistory.length;
                        this.value = '';
                    }
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (historyIndex > 0) {
                        historyIndex--;
                        this.value = cliHistory[historyIndex];
                    }
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (historyIndex < cliHistory.length - 1) {
                        historyIndex++;
                        this.value = cliHistory[historyIndex];
                    } else {
                        historyIndex = cliHistory.length;
                        this.value = '';
                    }
                }
            });

            // Keep input focused
            cliInput.focus();
            document.getElementById('cliContainer').addEventListener('click', () => cliInput.focus());
        }

        function executeCLICommand(command) {
            const prompt = document.getElementById('cliPrompt').textContent;
            appendCLIOutput(`${prompt}${command}\n`);

            const cmd = command.toLowerCase().trim();
            let output = '';

            // Command routing
            if (cmd === 'help' || cmd === '?') {
                output = getCLIHelp();
            } else if (cmd === 'enable') {
                if (cliMode === 'user') {
                    cliMode = 'privileged';
                    updateCLIPrompt();
                    output = '';
                } else {
                    output = '% Already in privileged mode\n';
                }
            } else if (cmd === 'configure terminal' || cmd === 'conf t') {
                if (cliMode === 'privileged') {
                    cliMode = 'config';
                    updateCLIPrompt();
                    output = 'Enter configuration commands, one per line. End with CNTL/Z.\n';
                } else {
                    output = '% Invalid command. Enter privileged mode first.\n';
                }
            } else if (cmd === 'exit') {
                if (cliMode === 'config') {
                    cliMode = 'privileged';
                } else if (cliMode === 'privileged') {
                    cliMode = 'user';
                }
                updateCLIPrompt();
                output = '';
            } else if (cmd === 'end') {
                cliMode = 'privileged';
                updateCLIPrompt();
                output = '';
            } else if (cmd === 'clear') {
                document.getElementById('cliOutput').innerHTML = '';
                return;
            } else if (cmd === 'show version') {
                output = getShowVersion();
            } else if (cmd === 'show ip interface brief' || cmd === 'sh ip int br') {
                output = getShowIPInterfaceBrief();
            } else if (cmd === 'show running-config' || cmd === 'sh run') {
                output = getShowRunningConfig();
            } else if (cmd === 'show ip route') {
                output = getShowIPRoute();
            } else if (cmd === 'show vlan') {
                output = getShowVLAN();
            } else if (cmd.startsWith('ping ')) {
                const ip = cmd.split(' ')[1];
                output = simulatePing(ip);
            } else if (cmd.startsWith('traceroute ')) {
                const ip = cmd.split(' ')[1];
                output = simulateTraceroute(ip);
            } else {
                output = `% Invalid input detected at '^' marker.\n`;
            }

            appendCLIOutput(output);
            markSectionComplete('cli-sim');
        }

        function appendCLIOutput(text) {
            const output = document.getElementById('cliOutput');
            output.innerHTML += text;
            const container = document.getElementById('cliContainer');
            container.scrollTop = container.scrollHeight;
        }

        function updateCLIPrompt() {
            const prompt = document.getElementById('cliPrompt');
            if (cliMode === 'user') {
                prompt.textContent = 'Router>';
            } else if (cliMode === 'privileged') {
                prompt.textContent = 'Router#';
            } else if (cliMode === 'config') {
                prompt.textContent = 'Router(config)#';
            }
        }

        function getCLIHelp() {
            return `Available commands:
  enable                    - Enter privileged EXEC mode
  configure terminal        - Enter global configuration mode
  show version              - Display system version information
  show ip interface brief   - Display interface status summary
  show running-config       - Display current configuration
  show ip route             - Display routing table
  show vlan                 - Display VLAN information
  ping [ip]                 - Test connectivity to IP address
  traceroute [ip]           - Trace route to IP address
  exit                      - Exit current mode
  end                       - Return to privileged EXEC mode
  clear                     - Clear the terminal screen
  help or ?                 - Display this help message

`;
        }

        function getShowVersion() {
            return `Cisco IOS Software, Router Software (X86_64_LINUX_IOSD-UNIVERSALK9-M)
Version 17.3.1, RELEASE SOFTWARE (fc5)
Technical Support: http://www.cisco.com/techsupport
Copyright (c) 1986-2024 by Cisco Systems, Inc.

Router uptime is 5 days, 3 hours, 42 minutes
System image file is "flash:iosxe-universalk9.17.03.01.SPA.bin"

Cisco ISR4331/K9 (1RU) processor with 4194304K/6147K bytes of memory.
Processor board ID FDO12345678
4 Gigabit Ethernet interfaces
32768K bytes of non-volatile configuration memory.
16777216K bytes of physical memory.

Configuration register is 0x2102

`;
        }

        function getShowIPInterfaceBrief() {
            return `Interface              IP-Address      OK? Method Status                Protocol
GigabitEthernet0/0     192.168.1.1     YES manual up                    up
GigabitEthernet0/1     10.0.0.1        YES manual up                    up
Serial0/0/0            172.16.0.1      YES manual down                  down
Loopback0              127.0.0.1       YES manual up                    up

`;
        }

        function getShowRunningConfig() {
            return `Building configuration...

Current configuration : 1234 bytes
!
version 17.3
service timestamps debug datetime msec
service timestamps log datetime msec
!
hostname Router
!
interface GigabitEthernet0/0
 description LAN Interface
 ip address 192.168.1.1 255.255.255.0
 duplex auto
 speed auto
!
interface GigabitEthernet0/1
 description WAN Interface
 ip address 10.0.0.1 255.255.255.0
 duplex auto
 speed auto
!
ip route 0.0.0.0 0.0.0.0 10.0.0.254
!
line con 0
line vty 0 4
 login
!
end

`;
        }

        function getShowIPRoute() {
            return `Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP
       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area

Gateway of last resort is 10.0.0.254 to network 0.0.0.0

S*    0.0.0.0/0 [1/0] via 10.0.0.254
      10.0.0.0/8 is variably subnetted, 2 subnets, 2 masks
C        10.0.0.0/24 is directly connected, GigabitEthernet0/1
L        10.0.0.1/32 is directly connected, GigabitEthernet0/1
      192.168.1.0/24 is variably subnetted, 2 subnets, 2 masks
C        192.168.1.0/24 is directly connected, GigabitEthernet0/0
L        192.168.1.1/32 is directly connected, GigabitEthernet0/0

`;
        }

        function getShowVLAN() {
            return `VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Gi0/1, Gi0/2, Gi0/3
10   Management                       active    Gi0/4
20   Users                            active    Gi0/5, Gi0/6, Gi0/7
30   Servers                          active    Gi0/8

VLAN Type  SAID       MTU   Parent RingNo BridgeNo Stp  BrdgMode Trans1 Trans2
---- ----- ---------- ----- ------ ------ -------- ---- -------- ------ ------
1    enet  100001     1500  -      -      -        -    -        0      0
10   enet  100010     1500  -      -      -        -    -        0      0
20   enet  100020     1500  -      -      -        -    -        0      0
30   enet  100030     1500  -      -      -        -    -        0      0

`;
        }

        function simulatePing(ip) {
            // Validate input
            if (!ip || ip.trim() === '') {
                return '% IP address required\n';
            }

            const trimmedIp = ip.trim();

            if (!isValidIP(trimmedIp)) {
                return `% Invalid IP address: ${trimmedIp}\n`;
            }

            return `Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to ${trimmedIp}, timeout is 2 seconds:
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 1/2/4 ms

`;
        }

        function simulateTraceroute(ip) {
            // Validate input
            if (!ip || ip.trim() === '') {
                return '% IP address or hostname required\n';
            }

            const trimmedIp = ip.trim();

            if (!isValidIP(trimmedIp)) {
                return `% Invalid IP address: ${trimmedIp}\n`;
            }

            return `Type escape sequence to abort.
Tracing the route to ${trimmedIp}

  1 192.168.1.254 4 msec 4 msec 4 msec
  2 10.0.0.254 8 msec 8 msec 8 msec
  3 172.16.0.1 12 msec 12 msec 12 msec
  4 ${ip} 16 msec 16 msec 16 msec

`;
        }

        // ========== TCP HANDSHAKE ==========
        let tcpAnimationRunning = false;
        let tcpTimeouts = []; // Track timeouts for cleanup

        function startTCPAnimation() {
            if (tcpAnimationRunning) return;
            tcpAnimationRunning = true;

            // Clear any existing timeouts
            tcpTimeouts.forEach(id => clearTimeout(id));
            tcpTimeouts = [];

            const steps = [
                {
                    message: "Step 1: Client sends SYN (Synchronize) packet to server",
                    packet: "SYN",
                    from: "client",
                    to: "server",
                    delay: 0
                },
                {
                    message: "Step 2: Server receives SYN and responds with SYN-ACK",
                    packet: "SYN-ACK",
                    from: "server",
                    to: "client",
                    delay: 2000
                },
                {
                    message: "Step 3: Client sends ACK to complete handshake",
                    packet: "ACK",
                    from: "client",
                    to: "server",
                    delay: 4000
                },
                {
                    message: "Connection Established! Data transfer can now begin.",
                    packet: null,
                    delay: 6000
                }
            ];

            steps.forEach(step => {
                const timeoutId = setTimeout(() => {
                    document.getElementById('tcpStepDescription').innerHTML = `<p><strong>${step.message}</strong></p>`;
                    if (step.packet) {
                        animateTCPPacket(step.packet, step.from, step.to);
                    } else {
                        tcpAnimationRunning = false;
                    }
                }, step.delay);
                tcpTimeouts.push(timeoutId);
            });

            markSectionComplete('tcp-handshake');
        }

        function animateTCPPacket(label, from, to) {
            const container = document.querySelector('.tcp-animation-container');
            const packet = document.createElement('div');
            packet.className = 'tcp-packet-visual';
            packet.textContent = label;

            const fromDevice = container.querySelector(`.tcp-device.${from}`);
            const toDevice = container.querySelector(`.tcp-device.${to}`);

            const fromRect = fromDevice.getBoundingClientRect();
            const toRect = toDevice.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();

            const startX = from === 'client' ? 170 : container.offsetWidth - 170;
            const endX = to === 'client' ? 170 : container.offsetWidth - 170;
            const startY = container.offsetHeight / 2;

            packet.style.left = startX + 'px';
            packet.style.top = startY + 'px';
            packet.style.opacity = '1';

            container.appendChild(packet);

            // Animate packet
            setTimeout(() => {
                packet.style.transition = 'all 1.5s ease';
                packet.style.left = endX + 'px';
            }, 50);

            setTimeout(() => {
                packet.remove();
            }, 1600);
        }

        function resetTCPAnimation() {
            // Clear all timeouts
            tcpTimeouts.forEach(id => clearTimeout(id));
            tcpTimeouts = [];

            // Remove all packets
            document.querySelectorAll('.tcp-packet-visual').forEach(p => p.remove());
            document.getElementById('tcpStepDescription').innerHTML = '<p>Click "Start Animation" to see the TCP handshake in action.</p>';
            tcpAnimationRunning = false;
        }

        // ========== TOPOLOGY BUILDER ==========
        function initializeTopology() {
            topologyCanvas = document.getElementById('topologyCanvas');
            if (!topologyCanvas) {
                console.error('Topology canvas not found');
                return;
            }

            topologyCtx = topologyCanvas.getContext('2d');
            if (!topologyCtx) {
                console.error('Could not get canvas context');
                return;
            }

            // Responsive canvas sizing
            function resizeCanvas() {
                const parent = topologyCanvas.parentElement;
                if (!parent) return;

                const newWidth = parent.offsetWidth || 800;
                const newHeight = 500; // Keep consistent height for now

                // Only resize if dimensions actually changed
                if (topologyCanvas.width !== newWidth || topologyCanvas.height !== newHeight) {
                    topologyCanvas.width = newWidth;
                    topologyCanvas.height = newHeight;
                    drawTopology();
                }
            }

            // Set initial canvas size
            resizeCanvas();

            // Handle window resize with debouncing
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(resizeCanvas, 250);
            });

            // Handle clicks
            topologyCanvas.addEventListener('click', handleTopologyClick);

            // Initial draw
            drawTopology();
        }

        function selectDevice(type) {
            console.log('Device selected:', type);
            selectedDevice = type;
            document.querySelectorAll('.device-icon').forEach(icon => {
                icon.classList.remove('selected');
            });
            document.querySelector(`[data-device="${type}"]`).classList.add('selected');
            console.log('selectedDevice is now:', selectedDevice);
        }

        function setTopologyMode(mode) {
            console.log('Setting topology mode to:', mode);
            topologyMode = mode;
            connectionStart = null;
            selectedInterfaceFrom = null;

            if (mode === 'ping') {
                updateTopologyStatus('Ping Mode: Select a source device.');
            } else {
                updateTopologyStatus(`Mode: ${mode.charAt(0).toUpperCase() + mode.slice(1)}`);
            }
            console.log('topologyMode is now:', topologyMode);
        }

        function selectCableType(type) {
            selectedCableType = type;
            document.querySelectorAll('.cable-type-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelector(`[data-cable="${type}"]`).classList.add('selected');
        }

        function handleTopologyClick(event) {
            console.log('Canvas clicked! Mode:', topologyMode, 'Selected device:', selectedDevice);

            const rect = topologyCanvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            console.log('Click coordinates:', x, y);

            if (topologyMode === 'place' && selectedDevice) {
                console.log('Placing device:', selectedDevice);
                placeDevice(x, y, selectedDevice);
            } else if (topologyMode === 'configure') {
                openDeviceConfig(x, y);
            } else if (topologyMode === 'connect') {
                handleConnection(x, y);
            } else if (topologyMode === 'delete') {
                deleteDevice(x, y);
            } else {
                console.log('No action taken - check mode and selectedDevice');
            }
        }

        function simulatePing(source, destination) {
            const path = findPath(source, destination);

            if (path) {
                updateTopologyStatus(`Ping from ${source.name} to ${destination.name}: SUCCESS! Path: ${path.map(d => d.name).join(' -> ')}`, 'success');
                animatePing(path);
                console.log('Ping path:', path);
            } else {
                updateTopologyStatus(`Ping from ${source.name} to ${destination.name}: FAILED! No path found.`, 'error');
                console.log('No path found');
            }
        }

        function findPath(source, destination) {
            const queue = [[source, [source]]];
            const visited = new Set([source.id]);

            while (queue.length > 0) {
                const [current, path] = queue.shift();

                if (current.id === destination.id) {
                    return path;
                }

                const neighbors = topologyConnections
                    .filter(conn => conn.from === current.id || conn.to === current.id)
                    .map(conn => {
                        const neighborId = conn.from === current.id ? conn.to : conn.from;
                        return topologyDevices.find(d => d.id === neighborId);
                    });

                for (const neighbor of neighbors) {
                    if (neighbor && !visited.has(neighbor.id)) {
                        visited.add(neighbor.id);
                        const newPath = [...path, neighbor];
                        queue.push([neighbor, newPath]);
                    }
                }
            }

            return null;
        }

        function animatePing(path) {
            let step = 0;

            function draw() {
                drawTopology(); // Redraw the base topology

                if (step >= path.length - 1) {
                    return; // Animation finished
                }

                const fromDevice = path[step];
                const toDevice = path[step + 1];

                const animationDuration = 500; // ms
                const startTime = Date.now();

                function animate() {
                    const now = Date.now();
                    const progress = (now - startTime) / animationDuration;

                    if (progress < 1) {
                        const x = fromDevice.x + (toDevice.x - fromDevice.x) * progress;
                        const y = fromDevice.y + (toDevice.y - fromDevice.y) * progress;

                        // Redraw topology to clear previous frames
                        drawTopology();

                        // Draw ping packet
                        topologyCtx.fillStyle = 'lime';
                        topologyCtx.beginPath();
                        topologyCtx.arc(x, y, 5, 0, Math.PI * 2);
                        topologyCtx.fill();

                        requestAnimationFrame(animate);
                    } else {
                        step++;
                        draw(); // Start next segment
                    }
                }

                animate();
            }

            draw();
        }


        function saveDeviceProperties() {
            if (!selectedTopologyDevice) return;

            const newName = document.getElementById('deviceName').value;
            const newIp = document.getElementById('deviceIp').value;

            const device = topologyDevices.find(d => d.id === selectedTopologyDevice.id);
            if (device) {
                device.name = newName;
                device.ip = newIp;
            }

            document.getElementById('devicePropertiesPanel').classList.remove('active');
            selectedTopologyDevice = null;
            drawTopology();
            updateTopologyStatus('Device properties updated.', 'success');
        }


        function placeDevice(x, y, type) {
            console.log('placeDevice called with:', x, y, type);

            const icons = {
                router: '📡',
                switch: '🔀',
                computer: '💻',
                server: '🖥️',
                firewall: '🔥'
            };

            const deviceId = Date.now();
            const defaultInterfaces = getDefaultInterfaces(type);

            topologyDevices.push({
                x: x,
                y: y,
                type: type,
                icon: icons[type],
                id: deviceId,
                name: `${type}-${deviceCounter}`,
                ip: `192.168.0.${deviceCounter}`,
                hostname: `${type.charAt(0).toUpperCase() + type.slice(1)}${deviceId % 1000}`,
                interfaces: defaultInterfaces,
                config: {
                    mode: 'user',  // user, privileged, config
                    runningConfig: '',
                    startupConfig: ''
                }
            });
            deviceCounter++;

            drawTopology();
            updateTopologyStatus(`Placed ${type} at (${Math.round(x)}, ${Math.round(y)})`);
            markSectionComplete('topology');
        }

        function getDefaultInterfaces(deviceType) {
            switch(deviceType) {
                case 'router':
                    return [
                        { name: 'GigabitEthernet0/0', shortName: 'Gi0/0', ip: '', subnet: '', status: 'down', type: 'ethernet' },
                        { name: 'GigabitEthernet0/1', shortName: 'Gi0/1', ip: '', subnet: '', status: 'down', type: 'ethernet' },
                        { name: 'Serial0/0/0', shortName: 'Se0/0/0', ip: '', subnet: '', status: 'down', type: 'serial' }
                    ];
                case 'switch':
                    return [
                        { name: 'FastEthernet0/1', shortName: 'Fa0/1', vlan: 1, status: 'down', type: 'ethernet' },
                        { name: 'FastEthernet0/2', shortName: 'Fa0/2', vlan: 1, status: 'down', type: 'ethernet' },
                        { name: 'FastEthernet0/3', shortName: 'Fa0/3', vlan: 1, status: 'down', type: 'ethernet' },
                        { name: 'FastEthernet0/4', shortName: 'Fa0/4', vlan: 1, status: 'down', type: 'ethernet' },
                        { name: 'GigabitEthernet0/1', shortName: 'Gi0/1', vlan: 1, status: 'down', type: 'ethernet' }
                    ];
                case 'computer':
                case 'server':
                    return [
                        { name: 'Ethernet0', shortName: 'Eth0', ip: '', subnet: '', gateway: '', status: 'down', type: 'ethernet' }
                    ];
                case 'firewall':
                    return [
                        { name: 'Outside', shortName: 'Outside', ip: '', subnet: '', status: 'down', type: 'ethernet' },
                        { name: 'Inside', shortName: 'Inside', ip: '', subnet: '', status: 'down', type: 'ethernet' },
                        { name: 'DMZ', shortName: 'DMZ', ip: '', subnet: '', status: 'down', type: 'ethernet' }
                    ];
                default:
                    return [];
            }
        }

        function handleConnection(x, y) {
            const device = findDeviceAt(x, y);

            if (!device) return;

            if (!connectionStart) {
                // First device selected - show interface selector
                connectionStart = device;
                selectedInterfaceFrom = selectInterfaceModal(device, true);
                updateTopologyStatus(`Selected ${device.hostname}, click another device to connect`);
            } else {
                if (connectionStart.id !== device.id) {
                    // Second device selected - show interface selector
                    const interfaceTo = selectInterfaceModal(device, false);

                    // Determine cable type
                    const cableType = selectedCableType === 'auto' ?
                        autoDetectCableType(connectionStart, device, selectedInterfaceFrom, interfaceTo) :
                        selectedCableType;

                    // Validate connection
                    const validation = validateConnection(connectionStart, device, selectedInterfaceFrom, interfaceTo, cableType);

                    if (validation.valid) {
                        topologyConnections.push({
                            from: connectionStart.id,
                            to: device.id,
                            fromInterface: selectedInterfaceFrom,
                            toInterface: interfaceTo,
                            cableType: cableType,
                            status: 'connected'
                        });

                        // Set interfaces to 'up' if both sides are configured
                        const fromIface = connectionStart.interfaces[selectedInterfaceFrom];
                        const toIface = device.interfaces[interfaceTo];
                        if (fromIface && toIface) {
                            fromIface.status = 'up';
                            toIface.status = 'up';
                        }

                        updateTopologyStatus(`✓ ${validation.message}`, 'success');
                        drawTopology();
                    } else {
                        updateTopologyStatus(`✗ ${validation.message}`, 'error');
                    }
                }
                connectionStart = null;
                selectedInterfaceFrom = null;
            }
        }

        function selectInterfaceModal(device, isFrom) {
            // For now, use the first available (unused) interface
            // In Phase 3 we can add a modal selector
            const availableInterfaces = device.interfaces.filter((iface, idx) => {
                // Check if this interface is already used
                const used = topologyConnections.some(conn =>
                    (conn.from === device.id && conn.fromInterface === idx) ||
                    (conn.to === device.id && conn.toInterface === idx)
                );
                return !used;
            });

            if (availableInterfaces.length > 0) {
                const index = device.interfaces.indexOf(availableInterfaces[0]);
                return index;
            }
            return 0; // Fallback to first interface
        }

        function autoDetectCableType(fromDevice, toDevice, fromIfaceIdx, toIfaceIdx) {
            const fromIface = fromDevice.interfaces[fromIfaceIdx];
            const toIface = toDevice.interfaces[toIfaceIdx];

            if (!fromIface || !toIface) return 'straight';

            // Serial connections
            if (fromIface.type === 'serial' || toIface.type === 'serial') {
                return 'serial';
            }

            // Fiber connections
            if (fromIface.name.toLowerCase().includes('fiber') || toIface.name.toLowerCase().includes('fiber')) {
                return 'fiber';
            }

            // Same device type connections (switch-to-switch, router-to-router, PC-to-PC) = crossover
            if (fromDevice.type === toDevice.type && fromDevice.type !== 'firewall') {
                return 'crossover';
            }

            // Different device types = straight-through
            return 'straight';
        }

        function validateConnection(fromDevice, toDevice, fromIfaceIdx, toIfaceIdx, cableType) {
            const fromIface = fromDevice.interfaces[fromIfaceIdx];
            const toIface = toDevice.interfaces[toIfaceIdx];

            if (!fromIface || !toIface) {
                return { valid: false, message: 'Interface not found' };
            }

            // Check if interfaces are already connected
            const alreadyConnected = topologyConnections.some(conn =>
                (conn.from === fromDevice.id && conn.fromInterface === fromIfaceIdx) ||
                (conn.to === toDevice.id && conn.toInterface === toIfaceIdx)
            );

            if (alreadyConnected) {
                return { valid: false, message: 'Interface already in use' };
            }

            // Cable type validation
            if (cableType === 'serial') {
                if (fromIface.type !== 'serial' && toIface.type !== 'serial') {
                    return { valid: false, message: 'Serial cable requires at least one serial interface' };
                }
            }

            // Crossover validation hint (not blocking)
            if (cableType === 'straight' && fromDevice.type === toDevice.type &&
                ['switch', 'router'].includes(fromDevice.type)) {
                return { valid: true, message: `Connected ${fromDevice.hostname}:${fromIface.shortName} to ${toDevice.hostname}:${toIface.shortName} (Consider crossover cable)` };
            }

            return {
                valid: true,
                message: `Connected ${fromDevice.hostname}:${fromIface.shortName} to ${toDevice.hostname}:${toIface.shortName} via ${cableType} cable`
            };
        }

        // Cable drawing functions
        function drawCrossoverCable(x1, y1, x2, y2, color) {
            // Draw crossover as a line with X in middle
            topologyCtx.strokeStyle = color;
            topologyCtx.lineWidth = 3;
            topologyCtx.beginPath();
            topologyCtx.moveTo(x1, y1);
            topologyCtx.lineTo(x2, y2);
            topologyCtx.stroke();

            // Draw X symbol in middle
            const midX = (x1 + x2) / 2;
            const midY = (y1 + y2) / 2;
            const size = 8;

            topologyCtx.strokeStyle = color;
            topologyCtx.lineWidth = 2;
            topologyCtx.beginPath();
            topologyCtx.moveTo(midX - size, midY - size);
            topologyCtx.lineTo(midX + size, midY + size);
            topologyCtx.moveTo(midX + size, midY - size);
            topologyCtx.lineTo(midX - size, midY + size);
            topologyCtx.stroke();
        }

        function drawSerialCable(x1, y1, x2, y2, color) {
            // Draw serial as dashed line
            topologyCtx.strokeStyle = color;
            topologyCtx.lineWidth = 3;
            topologyCtx.setLineDash([10, 5]);
            topologyCtx.beginPath();
            topologyCtx.moveTo(x1, y1);
            topologyCtx.lineTo(x2, y2);
            topologyCtx.stroke();
            topologyCtx.setLineDash([]); // Reset
        }

        function drawFiberCable(x1, y1, x2, y2, color) {
            // Draw fiber as thin double line
            const angle = Math.atan2(y2 - y1, x2 - x1);
            const offset = 2;

            // First line
            topologyCtx.strokeStyle = color;
            topologyCtx.lineWidth = 2;
            topologyCtx.beginPath();
            topologyCtx.moveTo(x1 + offset * Math.cos(angle + Math.PI/2),
                              y1 + offset * Math.sin(angle + Math.PI/2));
            topologyCtx.lineTo(x2 + offset * Math.cos(angle + Math.PI/2),
                              y2 + offset * Math.sin(angle + Math.PI/2));
            topologyCtx.stroke();

            // Second line
            topologyCtx.beginPath();
            topologyCtx.moveTo(x1 - offset * Math.cos(angle + Math.PI/2),
                              y1 - offset * Math.sin(angle + Math.PI/2));
            topologyCtx.lineTo(x2 - offset * Math.cos(angle + Math.PI/2),
                              y2 - offset * Math.sin(angle + Math.PI/2));
            topologyCtx.stroke();
        }

        function deleteDevice(x, y) {
            const device = findDeviceAt(x, y);
            if (device) {
                topologyDevices = topologyDevices.filter(d => d.id !== device.id);
                topologyConnections = topologyConnections.filter(c =>
                    c.from !== device.id && c.to !== device.id
                );
                drawTopology();
                updateTopologyStatus(`Deleted ${device.type}`);
            }
        }

        function findDeviceAt(x, y) {
            const radius = 30;
            return topologyDevices.find(device => {
                const dx = device.x - x;
                const dy = device.y - y;
                return Math.sqrt(dx * dx + dy * dy) < radius;
            });
        }

        function drawTopology() {
            topologyCtx.clearRect(0, 0, topologyCanvas.width, topologyCanvas.height);

            // Draw connections with cable types and colors
            topologyConnections.forEach(conn => {
                const fromDevice = topologyDevices.find(d => d.id === conn.from);
                const toDevice = topologyDevices.find(d => d.id === conn.to);

                if (fromDevice && toDevice) {
                    // Determine cable color based on status
                    let cableColor = '#475569'; // Default gray
                    const fromIface = fromDevice.interfaces && fromDevice.interfaces[conn.fromInterface];
                    const toIface = toDevice.interfaces && toDevice.interfaces[conn.toInterface];

                    // Both interfaces up and configured = green
                    if (fromIface && toIface &&
                        fromIface.status === 'up' && toIface.status === 'up' &&
                        fromIface.ip && toIface.ip) {
                        cableColor = '#10b981'; // Green - fully operational
                    }
                    // At least one interface up = orange
                    else if (fromIface && toIface &&
                        (fromIface.status === 'up' || toIface.status === 'up')) {
                        cableColor = '#f59e0b'; // Orange - partially operational
                    }
                    // Both down or misconfigured = red
                    else if (fromIface && toIface &&
                        fromIface.status === 'down' && toIface.status === 'down') {
                        cableColor = '#ef4444'; // Red - down
                    }

                    // Draw cable based on type
                    const cableType = conn.cableType || 'straight';

                    if (cableType === 'crossover') {
                        drawCrossoverCable(fromDevice.x, fromDevice.y, toDevice.x, toDevice.y, cableColor);
                    } else if (cableType === 'serial') {
                        drawSerialCable(fromDevice.x, fromDevice.y, toDevice.x, toDevice.y, cableColor);
                    } else if (cableType === 'fiber') {
                        drawFiberCable(fromDevice.x, fromDevice.y, toDevice.x, toDevice.y, cableColor);
                    } else {
                        topologyCtx.strokeStyle = cableColor;
                        topologyCtx.lineWidth = 3;
                        topologyCtx.beginPath();
                        topologyCtx.moveTo(fromDevice.x, fromDevice.y);
                        topologyCtx.lineTo(toDevice.x, toDevice.y);
                        topologyCtx.stroke();
                    }

                    // Draw interface labels on cable
                    if (fromIface && toIface) {
                        const midX = (fromDevice.x + toDevice.x) / 2;
                        const midY = (fromDevice.y + toDevice.y) / 2;

                        topologyCtx.font = '9px Arial';
                        topologyCtx.fillStyle = '#e0e0e0';
                        topologyCtx.fillText(`${fromIface.shortName}`, midX - 20, midY - 5);
                        topologyCtx.fillText(`${toIface.shortName}`, midX + 20, midY - 5);
                    }
                }
            });

            // Draw devices
            topologyDevices.forEach(device => {
                const hasActiveInterfaces = device.interfaces && device.interfaces.some(i => i.status === 'up');
                const borderColor = hasActiveInterfaces ? '#10b981' : '#06b6d4';

                topologyCtx.fillStyle = '#334155';
                topologyCtx.strokeStyle = borderColor;
                topologyCtx.lineWidth = 2;
                topologyCtx.beginPath();
                topologyCtx.arc(device.x, device.y, 30, 0, Math.PI * 2);
                topologyCtx.fill();
                topologyCtx.stroke();

                topologyCtx.font = '30px Arial';
                topologyCtx.textAlign = 'center';
                topologyCtx.textBaseline = 'middle';
                topologyCtx.fillText(device.icon, device.x, device.y);

                topologyCtx.font = 'bold 11px Arial';
                topologyCtx.fillStyle = '#10b981';
                topologyCtx.fillText(device.hostname || device.type, device.x, device.y + 45);

                if (device.interfaces && device.interfaces[0] && device.interfaces[0].ip) {
                    topologyCtx.font = '9px Arial';
                    topologyCtx.fillStyle = '#06b6d4';
                    topologyCtx.fillText(device.interfaces[0].ip, device.x, device.y + 58);
                }
            });
        }

        function clearTopology() {
            topologyDevices = [];
            topologyConnections = [];
            connectionStart = null;
            drawTopology();
            updateTopologyStatus('Topology cleared');
        }

        function testConnectivity() {
            if (topologyDevices.length === 0) {
                updateTopologyStatus('No devices to test');
                return;
            }

            const connectedDevices = new Set();
            topologyConnections.forEach(conn => {
                connectedDevices.add(conn.from);
                connectedDevices.add(conn.to);
            });

            const isolated = topologyDevices.filter(d => !connectedDevices.has(d.id));

            if (isolated.length > 0) {
                updateTopologyStatus(`Warning: ${isolated.length} isolated device(s) detected!`, 'error');
            } else if (topologyDevices.length > 0 && topologyConnections.length > 0) {
                updateTopologyStatus('All devices are connected!', 'success');
            } else {
                updateTopologyStatus('Add connections between devices', 'warning');
            }
        }

        function updateTopologyStatus(message, type = 'info') {
            const status = document.getElementById('topologyStatus');
            const colors = {
                info: 'var(--text-secondary)',
                success: 'var(--success)',
                warning: 'var(--warning)',
                error: 'var(--error)'
            };
            status.innerHTML = `<p style="color: ${colors[type]}">${message}</p>`;
        }

        // ========== DEVICE CONFIGURATION FUNCTIONS ==========
        let currentConfigDevice = null;

        function openDeviceConfig(x, y) {
            const device = findDeviceAt(x, y);
            if (!device) {
                updateTopologyStatus('No device found at this location', 'warning');
                return;
            }

            currentConfigDevice = device;

            // Update modal title and icon
            document.getElementById('configDeviceIcon').textContent = device.icon;
            document.getElementById('configDeviceTitle').textContent = `${device.hostname} Configuration`;

            // Load basic config
            document.getElementById('deviceHostname').value = device.hostname;
            document.getElementById('deviceType').value = device.type;

            // Load interfaces
            renderInterfaceList(device);

            // Initialize CLI
            initializeCLI(device);

            // Show modal
            document.getElementById('deviceConfigModal').classList.add('active');
            updateTopologyStatus(`Configuring ${device.hostname}`, 'info');
        }

        function closeDeviceConfig() {
            document.getElementById('deviceConfigModal').classList.remove('active');
            currentConfigDevice = null;
        }

        function switchConfigTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.config-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.textContent.toLowerCase() === tabName.toLowerCase()) {
                    tab.classList.add('active');
                }
            });

            // Update sections
            document.querySelectorAll('.config-section').forEach(section => {
                section.classList.remove('active');
            });

            const sectionMap = {
                'basic': 'basicConfig',
                'interfaces': 'interfacesConfig',
                'cli': 'cliConfig'
            };

            document.getElementById(sectionMap[tabName]).classList.add('active');
        }

        function renderInterfaceList(device) {
            const interfaceList = document.getElementById('interfaceList');
            interfaceList.innerHTML = '';

            device.interfaces.forEach((iface, index) => {
                const statusClass = iface.status === 'up' ? 'active' : 'inactive';
                const statusText = iface.status === 'up' ? 'UP' : 'DOWN';

                let interfaceHTML = `
                    <div class="interface-item ${statusClass}">
                        <div class="interface-header">
                            <span class="interface-name">${iface.name}</span>
                            <span class="interface-status ${iface.status}">${statusText}</span>
                        </div>
                `;

                if (device.type === 'router' || device.type === 'computer' || device.type === 'server' || device.type === 'firewall') {
                    interfaceHTML += `
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                            <div>
                                <label style="font-size: 0.85em; color: var(--text-secondary);">IP Address</label>
                                <input type="text" value="${iface.ip}"
                                    onchange="updateInterface(${index}, 'ip', this.value)"
                                    placeholder="192.168.1.1"
                                    style="width: 100%; padding: 6px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); margin-top: 4px;">
                            </div>
                            <div>
                                <label style="font-size: 0.85em; color: var(--text-secondary);">Subnet Mask</label>
                                <input type="text" value="${iface.subnet}"
                                    onchange="updateInterface(${index}, 'subnet', this.value)"
                                    placeholder="255.255.255.0"
                                    style="width: 100%; padding: 6px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); margin-top: 4px;">
                            </div>
                        </div>
                    `;

                    if (device.type === 'computer' || device.type === 'server') {
                        interfaceHTML += `
                            <div style="margin-top: 10px;">
                                <label style="font-size: 0.85em; color: var(--text-secondary);">Default Gateway</label>
                                <input type="text" value="${iface.gateway || ''}"
                                    onchange="updateInterface(${index}, 'gateway', this.value)"
                                    placeholder="192.168.1.254"
                                    style="width: 100%; padding: 6px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); margin-top: 4px;">
                            </div>
                        `;
                    }
                } else if (device.type === 'switch') {
                    interfaceHTML += `
                        <div style="margin-top: 10px;">
                            <label style="font-size: 0.85em; color: var(--text-secondary);">VLAN</label>
                            <input type="number" value="${iface.vlan}"
                                onchange="updateInterface(${index}, 'vlan', this.value)"
                                min="1" max="4094"
                                style="width: 100%; padding: 6px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); margin-top: 4px;">
                        </div>
                    `;
                }

                interfaceHTML += `
                        <div style="margin-top: 10px;">
                            <button class="btn btn-small" onclick="toggleInterfaceStatus(${index})"
                                style="padding: 6px 12px; font-size: 0.85em;">
                                ${iface.status === 'up' ? 'Shutdown' : 'No Shutdown'}
                            </button>
                        </div>
                    </div>
                `;

                interfaceList.innerHTML += interfaceHTML;
            });
        }

        function updateInterface(index, field, value) {
            if (currentConfigDevice && currentConfigDevice.interfaces[index]) {
                currentConfigDevice.interfaces[index][field] = value;
            }
        }

        function toggleInterfaceStatus(index) {
            if (currentConfigDevice && currentConfigDevice.interfaces[index]) {
                const iface = currentConfigDevice.interfaces[index];
                iface.status = iface.status === 'up' ? 'down' : 'up';
                renderInterfaceList(currentConfigDevice);
                drawTopology();
            }
        }

        function saveDeviceConfig() {
            if (!currentConfigDevice) return;

            // Save hostname
            currentConfigDevice.hostname = document.getElementById('deviceHostname').value;

            // Redraw topology to show updated info
            drawTopology();

            updateTopologyStatus(`Configuration saved for ${currentConfigDevice.hostname}`, 'success');
            closeDeviceConfig();
        }

        // ========== CLI SIMULATOR ==========
        let cliHistory = [];
        let cliHistoryIndex = -1;
        let cliMode = 'user'; // user, privileged, config, interface

        function initializeCLI(device) {
            const output = document.getElementById('cliOutput');
            const prompt = document.getElementById('cliPrompt');
            const input = document.getElementById('cliInput');

            // Handle initial page load (no device)
            if (!device) {
                if (output) output.textContent = 'Welcome to Network Admin Learning Lab CLI Simulator\n\nConfigure a device in the Topology Builder to use this CLI.\n\n';
                if (prompt) prompt.textContent = 'Router>';
                if (input) input.value = '';
                return;
            }

            cliMode = 'user';
            cliHistory = [];
            cliHistoryIndex = -1;

            output.textContent = `Welcome to ${device.hostname}\n\n`;
            prompt.textContent = `${device.hostname}>`;
            input.value = '';

            // Remove old event listener and add new one
            const newInput = input.cloneNode(true);
            input.parentNode.replaceChild(newInput, input);

            newInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    const command = newInput.value.trim();
                    if (command) {
                        processCLICommand(command, device);
                        cliHistory.push(command);
                        cliHistoryIndex = cliHistory.length;
                        newInput.value = '';
                    }
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (cliHistoryIndex > 0) {
                        cliHistoryIndex--;
                        newInput.value = cliHistory[cliHistoryIndex];
                    }
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (cliHistoryIndex < cliHistory.length - 1) {
                        cliHistoryIndex++;
                        newInput.value = cliHistory[cliHistoryIndex];
                    } else {
                        cliHistoryIndex = cliHistory.length;
                        newInput.value = '';
                    }
                }
            });
        }

        function processCLICommand(command, device) {
            const output = document.getElementById('cliOutput');
            const prompt = document.getElementById('cliPrompt');

            // Echo command
            output.textContent += `${prompt.textContent}${command}\n`;

            const cmd = command.toLowerCase().trim();

            // Command processing
            if (cmd === 'enable') {
                if (cliMode === 'user') {
                    cliMode = 'privileged';
                    prompt.textContent = `${device.hostname}#`;
                    output.textContent += 'Privileged mode enabled\n\n';
                }
            } else if (cmd === 'configure terminal' || cmd === 'conf t') {
                if (cliMode === 'privileged') {
                    cliMode = 'config';
                    prompt.textContent = `${device.hostname}(config)#`;
                    output.textContent += 'Entering configuration mode\n\n';
                }
            } else if (cmd === 'exit') {
                if (cliMode === 'config') {
                    cliMode = 'privileged';
                    prompt.textContent = `${device.hostname}#`;
                } else if (cliMode === 'privileged') {
                    cliMode = 'user';
                    prompt.textContent = `${device.hostname}>`;
                }
                output.textContent += '\n';
            } else if (cmd === 'show ip interface brief' || cmd === 'sh ip int br') {
                let result = 'Interface              IP-Address      Status                Protocol\n';
                device.interfaces.forEach(iface => {
                    const name = iface.name.padEnd(22);
                    const ip = (iface.ip || 'unassigned').padEnd(15);
                    const status = (iface.status === 'up' ? 'up' : 'administratively down').padEnd(21);
                    const protocol = iface.status === 'up' ? 'up' : 'down';
                    result += `${name} ${ip} ${status} ${protocol}\n`;
                });
                output.textContent += result + '\n';
            } else if (cmd === 'show running-config' || cmd === 'sh run') {
                output.textContent += `Building configuration...\n\nhostname ${device.hostname}\n!\n`;
                device.interfaces.forEach(iface => {
                    output.textContent += `interface ${iface.name}\n`;
                    if (iface.ip) {
                        output.textContent += ` ip address ${iface.ip} ${iface.subnet}\n`;
                    }
                    if (iface.status === 'up') {
                        output.textContent += ` no shutdown\n`;
                    }
                    output.textContent += `!\n`;
                });
                output.textContent += 'end\n\n';
            } else if (cmd === 'show interfaces' || cmd === 'sh int') {
                device.interfaces.forEach(iface => {
                    output.textContent += `${iface.name} is ${iface.status}, line protocol is ${iface.status}\n`;
                    if (iface.ip) {
                        output.textContent += `  Internet address is ${iface.ip}/${iface.subnet}\n`;
                    }
                    output.textContent += `\n`;
                });
            } else if (cmd.startsWith('interface ') || cmd.startsWith('int ')) {
                if (cliMode === 'config') {
                    const ifaceName = cmd.replace(/^(interface|int)\s+/, '');
                    const iface = device.interfaces.find(i =>
                        i.name.toLowerCase() === ifaceName || i.shortName.toLowerCase() === ifaceName
                    );
                    if (iface) {
                        cliMode = 'interface';
                        prompt.textContent = `${device.hostname}(config-if)#`;
                        output.textContent += `Entering interface configuration for ${iface.name}\n\n`;
                    } else {
                        output.textContent += `% Invalid interface\n\n`;
                    }
                }
            } else if (cmd === '?') {
                output.textContent += `Available commands:\n`;
                output.textContent += `  enable                - Enter privileged mode\n`;
                output.textContent += `  configure terminal    - Enter configuration mode\n`;
                output.textContent += `  show ip interface brief - Show interface summary\n`;
                output.textContent += `  show running-config   - Show current configuration\n`;
                output.textContent += `  show interfaces       - Show interface details\n`;
                output.textContent += `  exit                  - Exit current mode\n\n`;
            } else {
                output.textContent += `% Invalid command or incomplete.\n\n`;
            }

            // Auto-scroll to bottom
            const terminal = document.getElementById('cliTerminal');
            terminal.scrollTop = terminal.scrollHeight;
        }

        // ========== PACKET FLOW VISUALIZER ==========
        function initializePacketFlow() {
            const container = document.getElementById('packetFlowContainer');

            if (!container) return;

            // Create network topology visualization with percentage-based positioning
            const containerWidth = container.offsetWidth || 1200;
            const nodes = [
                { id: 'pc1', x: containerWidth * 0.08, y: 100, label: 'PC1\n192.168.1.10', icon: '💻' },
                { id: 'switch1', x: containerWidth * 0.25, y: 100, label: 'Switch', icon: '🔀' },
                { id: 'router1', x: containerWidth * 0.42, y: 100, label: 'Router\n192.168.1.1', icon: '📡' },
                { id: 'router2', x: containerWidth * 0.58, y: 100, label: 'Router\n10.0.0.1', icon: '📡' },
                { id: 'switch2', x: containerWidth * 0.75, y: 100, label: 'Switch', icon: '🔀' },
                { id: 'server', x: containerWidth * 0.92, y: 100, label: 'Server\n10.0.0.100', icon: '🖥️' }
            ];

            // Store nodes for animation
            window.packetFlowNodes = nodes;

            container.innerHTML = '';

            // Draw connections
            const connections = [
                ['pc1', 'switch1'],
                ['switch1', 'router1'],
                ['router1', 'router2'],
                ['router2', 'switch2'],
                ['switch2', 'server']
            ];

            connections.forEach(([from, to]) => {
                const fromNode = nodes.find(n => n.id === from);
                const toNode = nodes.find(n => n.id === to);

                const line = document.createElement('div');
                line.className = 'connection-line';
                const dx = toNode.x - fromNode.x;
                const dy = toNode.y - fromNode.y;
                const length = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;

                line.style.left = fromNode.x + 'px';
                line.style.top = fromNode.y + 'px';
                line.style.width = length + 'px';
                line.style.transform = `rotate(${angle}deg)`;

                container.appendChild(line);
            });

            // Draw nodes
            nodes.forEach(node => {
                const nodeDiv = document.createElement('div');
                nodeDiv.className = 'network-node';
                nodeDiv.style.left = (node.x - 50) + 'px';
                nodeDiv.style.top = (node.y - 50) + 'px';
                nodeDiv.innerHTML = `
                    <div style="font-size: 2em; margin-bottom: 5px;">${node.icon}</div>
                    <div style="font-size: 0.8em; white-space: pre-line; text-align: center;">${node.label}</div>
                `;
                container.appendChild(nodeDiv);
            });
        }

        function demonstrateARP() {
            updatePacketFlowDescription('ARP Process: PC1 needs to find MAC address of Router (192.168.1.1)');
            animatePacketFlowPath(['pc1', 'switch1', 'router1'], 'ARP', 2000);

            setTimeout(() => {
                updatePacketFlowDescription('Router responds with its MAC address');
                animatePacketFlowPath(['router1', 'switch1', 'pc1'], 'ARP Reply', 2000);
            }, 2500);

            markSectionComplete('packet-flow');
        }

        function demonstrateRouting() {
            updatePacketFlowDescription('Routing Decision: Router determines next hop based on destination IP');
            animatePacketFlowPath(['router1', 'router2'], 'IP Packet', 2000);

            setTimeout(() => {
                updatePacketFlowDescription('Packet forwarded to next router in path');
            }, 2200);

            markSectionComplete('packet-flow');
        }

        function demonstrateFullPath() {
            updatePacketFlowDescription('Full Journey: PC1 sends packet to Server (10.0.0.100)');
            animatePacketFlowPath(['pc1', 'switch1', 'router1', 'router2', 'switch2', 'server'], 'Data', 4000);

            setTimeout(() => {
                updatePacketFlowDescription('Packet successfully delivered! Return path begins...');
                animatePacketFlowPath(['server', 'switch2', 'router2', 'router1', 'switch1', 'pc1'], 'ACK', 4000);
            }, 5000);

            markSectionComplete('packet-flow');
        }

        function animatePacketFlowPath(path, label, duration) {
            // Use dynamically calculated nodes from initializePacketFlow
            const nodeArray = window.packetFlowNodes || [];
            const nodes = {};
            nodeArray.forEach(node => {
                nodes[node.id] = { x: node.x, y: node.y };
            });

            const container = document.getElementById('packetFlowContainer');
            const packet = document.createElement('div');
            packet.className = 'packet-flow-visual';
            packet.textContent = label;

            const startNode = nodes[path[0]];
            packet.style.left = (startNode.x - 15) + 'px';
            packet.style.top = (startNode.y - 15) + 'px';

            container.appendChild(packet);

            const stepDuration = duration / (path.length - 1);

            path.forEach((nodeId, index) => {
                if (index === 0) return;

                setTimeout(() => {
                    const node = nodes[nodeId];
                    packet.style.transition = `all ${stepDuration}ms linear`;
                    packet.style.left = (node.x - 15) + 'px';
                    packet.style.top = (node.y - 15) + 'px';
                }, stepDuration * index);
            });

            setTimeout(() => {
                packet.remove();
            }, duration + 500);
        }

        function resetPacketFlow() {
            document.querySelectorAll('.packet-flow-visual').forEach(p => p.remove());
            updatePacketFlowDescription('Select a demonstration to visualize packet flow through the network.');
        }

        function updatePacketFlowDescription(text) {
            document.getElementById('packetFlowDescription').innerHTML = `<p><strong>${text}</strong></p>`;
        }

        // ========== QUIZ SYSTEM ==========
        let currentQuiz = null;
        let currentQuestionIndex = 0;
        let quizScore = 0;

        function loadQuiz(week) {
            currentQuiz = quizQuestions[week];
            currentQuestionIndex = 0;
            quizScore = 0;

            document.getElementById('quizPlaceholder').classList.add('hidden');
            document.getElementById('quizScore').classList.add('hidden');
            document.getElementById('quizContainer').classList.remove('hidden');

            showQuestion();
        }

        function showQuestion() {
            if (currentQuestionIndex >= currentQuiz.length) {
                showQuizResults();
                return;
            }

            const question = currentQuiz[currentQuestionIndex];

            document.getElementById('quizQuestion').textContent =
                `Question ${currentQuestionIndex + 1} of ${currentQuiz.length}: ${question.question}`;

            const optionsContainer = document.getElementById('quizOptions');
            optionsContainer.innerHTML = '';

            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'quiz-option';
                optionDiv.textContent = option;
                optionDiv.addEventListener('click', () => selectAnswer(index));
                optionsContainer.appendChild(optionDiv);
            });

            document.getElementById('quizFeedback').classList.add('hidden');
            document.getElementById('nextQuestionBtn').classList.add('hidden');
        }

        function selectAnswer(selectedIndex) {
            const question = currentQuiz[currentQuestionIndex];
            const options = document.querySelectorAll('.quiz-option');
            const feedback = document.getElementById('quizFeedback');

            // Disable all options
            options.forEach(opt => opt.classList.add('disabled'));

            // Mark correct and incorrect
            options[question.correct].classList.add('correct');
            if (selectedIndex !== question.correct) {
                options[selectedIndex].classList.add('incorrect');
            }

            // Show feedback
            feedback.classList.remove('hidden');
            if (selectedIndex === question.correct) {
                feedback.className = 'quiz-feedback correct';
                feedback.innerHTML = `<strong>✓ Correct!</strong><br>${question.explanation}`;
                quizScore++;
            } else {
                feedback.className = 'quiz-feedback incorrect';
                feedback.innerHTML = `<strong>✗ Incorrect.</strong><br>${question.explanation}`;
            }

            // Show next button
            document.getElementById('nextQuestionBtn').classList.remove('hidden');
        }

        function nextQuestion() {
            currentQuestionIndex++;
            showQuestion();
        }

        function showQuizResults() {
            document.getElementById('quizContainer').classList.add('hidden');
            document.getElementById('quizScore').classList.remove('hidden');

            const percentage = Math.round((quizScore / currentQuiz.length) * 100);
            let message = '';

            if (percentage >= 90) {
                message = 'Excellent! You have mastered this material!';
            } else if (percentage >= 70) {
                message = 'Good job! You have a solid understanding.';
            } else if (percentage >= 50) {
                message = 'Not bad, but review the material and try again.';
            } else {
                message = 'Keep studying and try again. You can do it!';
            }

            document.getElementById('scoreText').innerHTML = `
                You scored <strong>${quizScore}</strong> out of <strong>${currentQuiz.length}</strong> (${percentage}%)<br>
                ${message}
            `;

            // Save score
            const week = Object.keys(quizQuestions).find(k => quizQuestions[k] === currentQuiz);
            progressData.quizScores[`week${week}`] = percentage;
            saveProgress();
            markSectionComplete('quizzes');
        }

        function resetQuiz() {
            document.getElementById('quizScore').classList.add('hidden');
            document.getElementById('quizPlaceholder').classList.remove('hidden');
            currentQuiz = null;
        }
        // ========== MODULE MANAGER SYSTEM ==========
        let customModules = JSON.parse(localStorage.getItem('customModules') || '[]');

        /**
         * Open the module manager overlay
         */
        function openModuleManager() {
            let overlay = document.getElementById('moduleManagerOverlay');
            if (!overlay) {
                createModuleManagerUI();
                overlay = document.getElementById('moduleManagerOverlay');
            }
            overlay.classList.add('active');
            renderModuleList();
        }

        /**
         * Close the module manager overlay
         */
        function closeModuleManager() {
            const overlay = document.getElementById('moduleManagerOverlay');
            if (overlay) {
                overlay.classList.remove('active');
            }
        }

        /**
         * Create the module manager UI
         */
        function createModuleManagerUI() {
            const overlay = document.createElement('div');
            overlay.id = 'moduleManagerOverlay';
            overlay.className = 'module-manager-overlay';

            overlay.innerHTML = `
                <div class="module-manager">
                    <button class="fullscreen-close" onclick="closeModuleManager()">✕</button>

                    <h2>📦 Module Manager</h2>
                    <p style="text-align: center; color: var(--text-secondary); margin-bottom: 20px;">
                        Upload custom training modules to extend the Network Admin Learning Lab
                    </p>

                    <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                        <div class="upload-icon">📤</div>
                        <h3 style="color: var(--accent-purple); margin: 10px 0;">Upload Module</h3>
                        <p style="color: var(--text-secondary);">Click to browse or drag & drop an HTML file</p>
                        <p style="color: var(--text-secondary); font-size: 0.85em; margin-top: 10px;">Supported: .html files</p>
                    </div>

                    <input type="file" id="fileInput" accept=".html,.htm" style="display: none;" onchange="handleFileUpload(event)">

                    <div class="module-template">
                        <h3>📝 Module Template</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 10px;">Your HTML file should follow this structure:</p>
                        <pre>&lt;!-- MODULE METADATA (Required) --&gt;
&lt;meta name="module-id" content="unique-module-id"&gt;
&lt;meta name="module-title" content="Your Module Title"&gt;
&lt;meta name="module-description" content="Brief description"&gt;

&lt;!-- MODULE CONTENT --&gt;
&lt;div class="content-section" id="your-module-id"&gt;
    &lt;div class="panel"&gt;
        &lt;h2&gt;Your Module Title&lt;/h2&gt;
        &lt;p&gt;Your content here...&lt;/p&gt;

        &lt;!-- Use existing CSS classes --&gt;
        &lt;button class="btn" onclick="yourFunction()"&gt;Demo&lt;/button&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;!-- MODULE SCRIPTS (Optional) --&gt;
&lt;scr`+`ipt&gt;
function yourFunction() {
    alert('Module demo!');
}
&lt;\/script&gt;</pre>
                        <button class="btn" onclick="downloadTemplate()" style="margin-top: 10px;">Download Template</button>
                    </div>

                    <h3 style="color: var(--accent-cyan); margin-top: 30px; margin-bottom: 15px;">Installed Modules</h3>
                    <div class="module-list" id="moduleList"></div>
                </div>
            `;

            document.body.appendChild(overlay);

            // Setup drag & drop
            const uploadArea = overlay.querySelector('#uploadArea');
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });

            // Close on ESC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && overlay.classList.contains('active')) {
                    closeModuleManager();
                }
            });
        }

        /**
         * Handle file upload from input
         */
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
            event.target.value = ''; // Reset input
        }

        /**
         * Process uploaded file
         */
        function handleFile(file) {
            if (!file.name.endsWith('.html') && !file.name.endsWith('.htm')) {
                alert('Please upload an HTML file (.html or .htm)');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                try {
                    parseAndInstallModule(content, file.name);
                } catch (error) {
                    alert('Error installing module: ' + error.message);
                    console.error(error);
                }
            };
            reader.readAsText(file);
        }

        /**
         * Parse module HTML and install it
         */
        function parseAndInstallModule(htmlContent, fileName) {
            // Create temporary DOM parser
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlContent, 'text/html');

            // Extract metadata
            const moduleId = doc.querySelector('meta[name="module-id"]')?.content;
            const moduleTitle = doc.querySelector('meta[name="module-title"]')?.content;
            const moduleDescription = doc.querySelector('meta[name="module-description"]')?.content;

            if (!moduleId || !moduleTitle) {
                throw new Error('Module must have module-id and module-title meta tags');
            }

            // Check for duplicate
            if (customModules.find(m => m.id === moduleId)) {
                if (!confirm(`Module "${moduleTitle}" already exists. Replace it?`)) {
                    return;
                }
                deleteModule(moduleId);
            }

            // Create module object
            const module = {
                id: moduleId,
                title: moduleTitle,
                description: moduleDescription || 'No description',
                fileName: fileName,
                content: htmlContent,
                installedDate: new Date().toISOString()
            };

            // Save to storage
            customModules.push(module);
            localStorage.setItem('customModules', JSON.stringify(customModules));

            // Install module immediately
            installModuleToDOM(module);

            // Update UI
            renderModuleList();
            alert(`✅ Module "${moduleTitle}" installed successfully!`);
        }

        /**
         * Install module content into the DOM
         */
        function installModuleToDOM(module) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(module.content, 'text/html');

            // Extract content section
            const contentSection = doc.querySelector('.content-section');
            if (contentSection) {
                // Insert before the last section (or at the end)
                const mainContainer = document.querySelector('nav.tabs').parentElement;
                const lastSection = mainContainer.querySelector('.content-section:last-of-type');
                if (lastSection) {
                    lastSection.parentElement.insertBefore(contentSection, lastSection);
                } else {
                    mainContainer.appendChild(contentSection);
                }
            }

            // Extract and execute scripts
            const scripts = doc.querySelectorAll('script');
            scripts.forEach(oldScript => {
                const newScript = document.createElement('script');
                if (oldScript.src) {
                    newScript.src = oldScript.src;
                } else {
                    newScript.textContent = oldScript.textContent;
                }
                document.body.appendChild(newScript);
            });

            // Add navigation tab
            addNavigationTab(module.id, module.title);
        }

        /**
         * Add navigation tab for module
         */
        function addNavigationTab(moduleId, moduleTitle) {
            const nav = document.querySelector('nav.tabs');
            const uploadTab = nav.querySelector('.tab-upload');

            // Check if tab already exists
            if (nav.querySelector(`[data-section="${moduleId}"]`)) {
                return;
            }

            const tab = document.createElement('div');
            tab.className = 'tab';
            tab.setAttribute('data-section', moduleId);
            tab.setAttribute('role', 'tab');
            tab.setAttribute('aria-selected', 'false');
            tab.setAttribute('aria-controls', moduleId);
            tab.setAttribute('tabindex', '-1');
            tab.textContent = moduleTitle;
            tab.style.background = 'linear-gradient(135deg, rgba(147, 51, 234, 0.2), rgba(6, 182, 212, 0.2))';
            tab.style.borderColor = 'var(--accent-purple)';

            // Insert before upload button
            nav.insertBefore(tab, uploadTab);

            // Add click handler
            tab.addEventListener('click', () => switchSection(moduleId));
        }

        /**
         * Delete a module
         */
        function deleteModule(moduleId) {
            // Remove from storage
            customModules = customModules.filter(m => m.id !== moduleId);
            localStorage.setItem('customModules', JSON.stringify(customModules));

            // Remove from DOM
            const section = document.getElementById(moduleId);
            if (section) {
                section.remove();
            }

            // Remove tab
            const tab = document.querySelector(`[data-section="${moduleId}"]`);
            if (tab) {
                tab.remove();
            }

            // Update UI
            renderModuleList();
        }

        /**
         * Render the list of installed modules
         */
        function renderModuleList() {
            const listContainer = document.getElementById('moduleList');
            if (!listContainer) return;

            if (customModules.length === 0) {
                listContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">No custom modules installed yet</p>';
                return;
            }

            listContainer.innerHTML = customModules.map(module => `
                <div class="module-item">
                    <div class="module-info">
                        <h4>${module.title} <span class="module-status loaded">LOADED</span></h4>
                        <p>${module.description}</p>
                        <p style="font-size: 0.8em; color: var(--text-secondary); margin-top: 5px;">
                            Installed: ${new Date(module.installedDate).toLocaleDateString()}
                        </p>
                    </div>
                    <div class="module-actions">
                        <button class="module-delete" onclick="deleteModule('${module.id}')">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        /**
         * Download module template
         */
        function downloadTemplate() {
            const template = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Access Control -->
    <script src="../../../../components/AccessGuard.js"></script>
    <script>
        AccessGuard.require('sorted');
    </script>
    <!-- MODULE METADATA (Required) -->
    <meta name="module-id" content="my-custom-module">
    <meta name="module-title" content="My Custom Module">
    <meta name="module-description" content="A custom training module for network administration">
    <title>Custom Module</title>
</head>
<body>

<!-- MODULE CONTENT -->
<div class="content-section" id="my-custom-module">
    <div class="panel">
        <h2>My Custom Module</h2>
        <p>This is a custom training module. You can add any content here!</p>

        <h3>Interactive Demo</h3>
        <button class="btn" onclick="runDemo()">Run Demo</button>
        <button class="btn btn-secondary" onclick="resetDemo()">Reset</button>

        <div id="demoOutput" class="status-display" style="margin-top: 15px;">
            Click "Run Demo" to see it in action.
        </div>

        <h3>Quiz Section</h3>
        <div class="quiz-section">
            <div class="quiz-item">
                <p><strong>Q: What does this module teach?</strong></p>
                <button class="btn-small" onclick="showAnswer(1)">Show Answer</button>
                <div id="answer1" style="display: none; margin-top: 10px; padding: 15px; background: var(--bg-primary); border-left: 4px solid var(--success); border-radius: 4px;">
                    <strong>Answer:</strong> This is a template module that demonstrates how to create custom content!
                </div>
            </div>
        </div>
    </div>
</div>

<!-- MODULE SCRIPTS (Optional) -->
<scr` + `ipt>
    function runDemo() {
        const output = document.getElementById('demoOutput');
        if (output) {
            output.textContent = '✅ Demo running successfully!';
            output.style.background = 'rgba(16, 185, 129, 0.2)';
            output.style.borderLeft = '4px solid var(--success)';
        }
    }

    function resetDemo() {
        const output = document.getElementById('demoOutput');
        if (output) {
            output.textContent = 'Click "Run Demo" to see it in action.';
            output.style.background = 'var(--bg-primary)';
            output.style.borderLeft = '4px solid var(--border)';
        }
    }

    function showAnswer(num) {
        const answer = document.getElementById('answer' + num);
        if (!answer) return;

        const isHidden = answer.style.display === 'none' || !answer.style.display;
        answer.style.display = isHidden ? 'block' : 'none';

        const button = answer.previousElementSibling;
        if (button && button.tagName === 'BUTTON') {
            button.textContent = isHidden ? 'Hide Answer' : 'Show Answer';
        }
    }
<\/script>

</body>
</html>`;

            const blob = new Blob([template], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'module-template.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        /**
         * Load saved modules on page load
         */
        function loadSavedModules() {
            customModules.forEach(module => {
                try {
                    installModuleToDOM(module);
                } catch (error) {
                    console.error(`Error loading module ${module.id}:`, error);
                }
            });
        }

        // Load modules when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedModules();
        });

    </script>


</body></html>