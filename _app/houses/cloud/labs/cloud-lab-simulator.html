<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Access Control -->
    <script src="../../../components/AccessGuard.js"></script>
    <script>
        AccessGuard.require('sorted');
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Computing Lab Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-bg: #1e1e1e;
            --secondary-bg: #252526;
            --terminal-bg: #0d1117;
            --border-color: #333;
            --text-primary: #e0e0e0;
            --text-secondary: #9f9f9f;
            --accent-blue: #58a6ff;
            --accent-green: #3fb950;
            --accent-red: #f85149;
            --accent-yellow: #d29922;
            --accent-purple: #bc8cff;
            --prompt-color: #58a6ff;
            --output-color: #e0e0e0;
            --success-color: #3fb950;
            --error-color: #f85149;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* Header */
        header {
            background: var(--secondary-bg);
            padding: 1rem 2rem;
            border-bottom: 2px solid var(--border-color);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        header h1 {
            font-size: 1.5rem;
            color: var(--accent-blue);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        header h1::before {
            content: "‚òÅ";
            font-size: 1.8rem;
        }

        /* Main Layout */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 300px;
            background: var(--secondary-bg);
            border-right: 2px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .lab-tabs {
            display: flex;
            flex-direction: column;
            padding: 1rem;
        }

        .lab-tab {
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: var(--primary-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .lab-tab:hover {
            background: var(--terminal-bg);
            border-color: var(--accent-blue);
            transform: translateX(5px);
        }

        .lab-tab.active {
            background: var(--accent-blue);
            color: #000;
            border-color: var(--accent-blue);
            font-weight: bold;
        }

        .lab-tab-title {
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .lab-tab-desc {
            font-size: 0.75rem;
            opacity: 0.7;
        }

        .lab-tab.active .lab-tab-desc {
            opacity: 0.8;
        }

        .lab-progress {
            margin-top: 0.5rem;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .progress-bar {
            flex: 1;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--success-color);
            transition: width 0.3s ease;
        }

        /* Instructions Panel */
        .instructions-panel {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
        }

        .instruction-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .instruction-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .instruction-section h2 {
            color: var(--accent-blue);
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .instruction-section h3 {
            color: var(--accent-green);
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            font-size: 1rem;
        }

        .step {
            background: var(--terminal-bg);
            border-left: 3px solid var(--accent-blue);
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0 4px 4px 0;
        }

        .step.completed {
            border-left-color: var(--success-color);
            opacity: 0.7;
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .step-number {
            background: var(--accent-blue);
            color: #000;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .step.completed .step-number {
            background: var(--success-color);
        }

        .step.completed .step-number::after {
            content: "‚úì";
        }

        .step-title {
            font-weight: bold;
            font-size: 1rem;
        }

        .step-description {
            margin-bottom: 0.75rem;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .command-example {
            background: rgba(88, 166, 255, 0.1);
            border: 1px solid var(--accent-blue);
            padding: 0.75rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: var(--accent-blue);
            margin: 0.5rem 0;
            font-size: 0.9rem;
        }

        .expected-output {
            background: rgba(63, 185, 80, 0.1);
            border: 1px solid var(--accent-green);
            padding: 0.75rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: var(--accent-green);
            margin: 0.5rem 0;
            font-size: 0.85rem;
            white-space: pre-wrap;
        }

        .tip {
            background: rgba(210, 153, 34, 0.1);
            border-left: 3px solid var(--accent-yellow);
            padding: 0.75rem;
            margin: 0.75rem 0;
            border-radius: 0 4px 4px 0;
            font-size: 0.9rem;
        }

        .tip::before {
            content: "üí° Tip: ";
            font-weight: bold;
            color: var(--accent-yellow);
        }

        /* Terminal Section */
        .terminal-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--terminal-bg);
        }

        .terminal-header {
            background: var(--secondary-bg);
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .terminal-title {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: var(--accent-green);
        }

        .terminal-controls {
            display: flex;
            gap: 0.5rem;
        }

        .terminal-btn {
            background: var(--primary-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .terminal-btn:hover {
            background: var(--accent-blue);
            color: #000;
            border-color: var(--accent-blue);
        }

        .terminal-output {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .terminal-line {
            margin-bottom: 0.5rem;
        }

        .terminal-prompt {
            color: var(--prompt-color);
            font-weight: bold;
        }

        .terminal-command {
            color: var(--text-primary);
        }

        .terminal-output-line {
            color: var(--output-color);
        }

        .terminal-success {
            color: var(--success-color);
        }

        .terminal-error {
            color: var(--error-color);
        }

        .terminal-info {
            color: var(--accent-blue);
        }

        .terminal-warning {
            color: var(--accent-yellow);
        }

        .terminal-input-container {
            display: flex;
            padding: 1rem;
            border-top: 1px solid var(--border-color);
            background: var(--secondary-bg);
            align-items: center;
        }

        .terminal-prompt-text {
            color: var(--prompt-color);
            font-family: 'Courier New', monospace;
            margin-right: 0.5rem;
            font-weight: bold;
        }

        .terminal-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            outline: none;
            padding: 0.5rem;
        }

        /* Stats Bar */
        .stats-bar {
            background: var(--secondary-bg);
            padding: 0.75rem 2rem;
            border-top: 2px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
        }

        .stat-value {
            color: var(--accent-green);
            font-weight: bold;
        }

        /* Resource Tables */
        .resource-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.85rem;
        }

        .resource-table th,
        .resource-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .resource-table th {
            background: var(--secondary-bg);
            color: var(--accent-blue);
            font-weight: bold;
        }

        .resource-table tr:hover {
            background: rgba(88, 166, 255, 0.1);
        }

        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 3px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .status-running {
            background: rgba(63, 185, 80, 0.2);
            color: var(--success-color);
        }

        .status-stopped {
            background: rgba(248, 81, 73, 0.2);
            color: var(--error-color);
        }

        .status-active {
            background: rgba(88, 166, 255, 0.2);
            color: var(--accent-blue);
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--primary-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-blue);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                width: 250px;
            }
        }

        /* Welcome Message */
        .welcome-message {
            color: var(--accent-green);
            margin-bottom: 1rem;
        }

        .cursor-blink {
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Cloud Computing Lab Simulator</h1>
        </header>

        <div class="main-content">
            <!-- Sidebar with Lab Tabs -->
            <div class="sidebar">
                <div class="lab-tabs">
                    <div class="lab-tab active" data-lab="1">
                        <div class="lab-tab-title">Lab 1: Cloud Account Setup</div>
                        <div class="lab-tab-desc">Create projects, users, and roles</div>
                        <div class="lab-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" data-progress="1" style="width: 0%"></div>
                            </div>
                            <span class="progress-text">0%</span>
                        </div>
                    </div>
                    <div class="lab-tab" data-lab="2">
                        <div class="lab-tab-title">Lab 2: Virtual Machine Deployment</div>
                        <div class="lab-tab-desc">Create, list, and manage VMs</div>
                        <div class="lab-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" data-progress="2" style="width: 0%"></div>
                            </div>
                            <span class="progress-text">0%</span>
                        </div>
                    </div>
                    <div class="lab-tab" data-lab="3">
                        <div class="lab-tab-title">Lab 3: Storage Operations</div>
                        <div class="lab-tab-desc">Create buckets and manage objects</div>
                        <div class="lab-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" data-progress="3" style="width: 0%"></div>
                            </div>
                            <span class="progress-text">0%</span>
                        </div>
                    </div>
                    <div class="lab-tab" data-lab="4">
                        <div class="lab-tab-title">Lab 4: Network Configuration</div>
                        <div class="lab-tab-desc">Configure VPCs, subnets, security groups</div>
                        <div class="lab-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" data-progress="4" style="width: 0%"></div>
                            </div>
                            <span class="progress-text">0%</span>
                        </div>
                    </div>
                    <div class="lab-tab" data-lab="5">
                        <div class="lab-tab-title">Lab 5: Identity & Access Management</div>
                        <div class="lab-tab-desc">Manage users, roles, and permissions</div>
                        <div class="lab-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" data-progress="5" style="width: 0%"></div>
                            </div>
                            <span class="progress-text">0%</span>
                        </div>
                    </div>
                </div>

                <!-- Instructions Panel -->
                <div class="instructions-panel">
                    <!-- Lab 1 Instructions -->
                    <div class="instruction-section active" data-instructions="1">
                        <h2>Lab 1: Cloud Account Setup</h2>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                            Learn how to set up your cloud environment by creating projects, users, and assigning roles.
                        </p>

                        <div class="step" data-step="1-1">
                            <div class="step-header">
                                <span class="step-number">1</span>
                                <span class="step-title">List existing projects</span>
                            </div>
                            <div class="step-description">
                                Start by viewing all current projects in your cloud account.
                            </div>
                            <div class="command-example">cloud project list</div>
                            <div class="expected-output">PROJECT_ID          PROJECT_NAME        STATUS
default-project     Default Project     active</div>
                            <div class="tip">This command shows all projects you have access to.</div>
                        </div>

                        <div class="step" data-step="1-2">
                            <div class="step-header">
                                <span class="step-number">2</span>
                                <span class="step-title">Create a new project</span>
                            </div>
                            <div class="step-description">
                                Create a new project called "production" for your workloads.
                            </div>
                            <div class="command-example">cloud project create production</div>
                            <div class="expected-output">Project 'production' created successfully
PROJECT_ID: prod-12345
STATUS: active</div>
                        </div>

                        <div class="step" data-step="1-3">
                            <div class="step-header">
                                <span class="step-number">3</span>
                                <span class="step-title">List users</span>
                            </div>
                            <div class="step-description">
                                View all users in your cloud account.
                            </div>
                            <div class="command-example">cloud user list</div>
                            <div class="expected-output">USER_ID     USERNAME        EMAIL                   STATUS
admin-001   admin           admin@cloud.local       active</div>
                        </div>

                        <div class="step" data-step="1-4">
                            <div class="step-header">
                                <span class="step-number">4</span>
                                <span class="step-title">Create a new user</span>
                            </div>
                            <div class="step-description">
                                Create a user named "developer" for your development team.
                            </div>
                            <div class="command-example">cloud user create developer</div>
                            <div class="expected-output">User 'developer' created successfully
USER_ID: dev-67890
EMAIL: developer@cloud.local
STATUS: active</div>
                        </div>

                        <div class="step" data-step="1-5">
                            <div class="step-header">
                                <span class="step-number">5</span>
                                <span class="step-title">Assign a role to the user</span>
                            </div>
                            <div class="step-description">
                                Grant the "developer" user the "compute-admin" role.
                            </div>
                            <div class="command-example">cloud role assign developer compute-admin</div>
                            <div class="expected-output">Role 'compute-admin' assigned to user 'developer' successfully
Permissions granted:
  - compute.instances.create
  - compute.instances.delete
  - compute.instances.list</div>
                            <div class="tip">Users need appropriate roles to perform actions in the cloud.</div>
                        </div>
                    </div>

                    <!-- Lab 2 Instructions -->
                    <div class="instruction-section" data-instructions="2">
                        <h2>Lab 2: Virtual Machine Deployment</h2>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                            Deploy and manage virtual machines in your cloud environment.
                        </p>

                        <div class="step" data-step="2-1">
                            <div class="step-header">
                                <span class="step-number">1</span>
                                <span class="step-title">List existing VMs</span>
                            </div>
                            <div class="step-description">
                                Check what virtual machines are currently running.
                            </div>
                            <div class="command-example">cloud vm list</div>
                            <div class="expected-output">No virtual machines found.</div>
                        </div>

                        <div class="step" data-step="2-2">
                            <div class="step-header">
                                <span class="step-number">2</span>
                                <span class="step-title">Create a small VM</span>
                            </div>
                            <div class="step-description">
                                Deploy a small-sized VM named "web-server".
                            </div>
                            <div class="command-example">cloud vm create --name web-server --size small</div>
                            <div class="expected-output">Creating virtual machine 'web-server'...
VM created successfully!
INSTANCE_ID: vm-a1b2c3d4
NAME: web-server
SIZE: small (1 vCPU, 2GB RAM)
IP: 10.0.1.15
STATUS: running</div>
                            <div class="tip">Small VMs are perfect for lightweight applications and testing.</div>
                        </div>

                        <div class="step" data-step="2-3">
                            <div class="step-header">
                                <span class="step-number">3</span>
                                <span class="step-title">Create a medium VM</span>
                            </div>
                            <div class="step-description">
                                Deploy a medium-sized VM named "app-server".
                            </div>
                            <div class="command-example">cloud vm create --name app-server --size medium</div>
                            <div class="expected-output">Creating virtual machine 'app-server'...
VM created successfully!
INSTANCE_ID: vm-e5f6g7h8
NAME: app-server
SIZE: medium (2 vCPU, 4GB RAM)
IP: 10.0.1.16
STATUS: running</div>
                        </div>

                        <div class="step" data-step="2-4">
                            <div class="step-header">
                                <span class="step-number">4</span>
                                <span class="step-title">List all VMs</span>
                            </div>
                            <div class="step-description">
                                Verify both VMs are running.
                            </div>
                            <div class="command-example">cloud vm list</div>
                            <div class="expected-output">INSTANCE_ID    NAME          SIZE     IP           STATUS
vm-a1b2c3d4    web-server    small    10.0.1.15    running
vm-e5f6g7h8    app-server    medium   10.0.1.16    running</div>
                        </div>

                        <div class="step" data-step="2-5">
                            <div class="step-header">
                                <span class="step-number">5</span>
                                <span class="step-title">Delete a VM</span>
                            </div>
                            <div class="step-description">
                                Remove the web-server VM to free up resources.
                            </div>
                            <div class="command-example">cloud vm delete web-server</div>
                            <div class="expected-output">Deleting virtual machine 'web-server'...
VM 'web-server' deleted successfully!</div>
                            <div class="tip">Always delete unused VMs to avoid unnecessary charges.</div>
                        </div>
                    </div>

                    <!-- Lab 3 Instructions -->
                    <div class="instruction-section" data-instructions="3">
                        <h2>Lab 3: Storage Operations</h2>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                            Manage cloud storage buckets and objects for your applications.
                        </p>

                        <div class="step" data-step="3-1">
                            <div class="step-header">
                                <span class="step-number">1</span>
                                <span class="step-title">List storage buckets</span>
                            </div>
                            <div class="step-description">
                                Check existing storage buckets in your account.
                            </div>
                            <div class="command-example">cloud storage list</div>
                            <div class="expected-output">No storage buckets found.</div>
                        </div>

                        <div class="step" data-step="3-2">
                            <div class="step-header">
                                <span class="step-number">2</span>
                                <span class="step-title">Create a storage bucket</span>
                            </div>
                            <div class="step-description">
                                Create a bucket named "app-data" for application files.
                            </div>
                            <div class="command-example">cloud storage create app-data</div>
                            <div class="expected-output">Creating storage bucket 'app-data'...
Bucket created successfully!
BUCKET_NAME: app-data
REGION: us-east-1
SIZE: 0 GB
STATUS: active</div>
                            <div class="tip">Bucket names must be globally unique across all cloud accounts.</div>
                        </div>

                        <div class="step" data-step="3-3">
                            <div class="step-header">
                                <span class="step-number">3</span>
                                <span class="step-title">Create a backup bucket</span>
                            </div>
                            <div class="step-description">
                                Create another bucket named "backups" for storing backups.
                            </div>
                            <div class="command-example">cloud storage create backups</div>
                            <div class="expected-output">Creating storage bucket 'backups'...
Bucket created successfully!
BUCKET_NAME: backups
REGION: us-east-1
SIZE: 0 GB
STATUS: active</div>
                        </div>

                        <div class="step" data-step="3-4">
                            <div class="step-header">
                                <span class="step-number">4</span>
                                <span class="step-title">List all buckets</span>
                            </div>
                            <div class="step-description">
                                Verify both storage buckets have been created.
                            </div>
                            <div class="command-example">cloud storage list</div>
                            <div class="expected-output">BUCKET_NAME    REGION        SIZE     CREATED              STATUS
app-data       us-east-1     0 GB     2024-01-15 10:30     active
backups        us-east-1     0 GB     2024-01-15 10:31     active</div>
                        </div>

                        <div class="step" data-step="3-5">
                            <div class="step-header">
                                <span class="step-number">5</span>
                                <span class="step-title">Delete a bucket</span>
                            </div>
                            <div class="step-description">
                                Remove the "backups" bucket (make sure it's empty first).
                            </div>
                            <div class="command-example">cloud storage delete backups</div>
                            <div class="expected-output">Deleting storage bucket 'backups'...
Bucket 'backups' deleted successfully!</div>
                            <div class="tip">Buckets must be empty before they can be deleted.</div>
                        </div>
                    </div>

                    <!-- Lab 4 Instructions -->
                    <div class="instruction-section" data-instructions="4">
                        <h2>Lab 4: Network Configuration</h2>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                            Configure virtual networks, subnets, and security groups for your infrastructure.
                        </p>

                        <div class="step" data-step="4-1">
                            <div class="step-header">
                                <span class="step-number">1</span>
                                <span class="step-title">List VPCs</span>
                            </div>
                            <div class="step-description">
                                View existing Virtual Private Clouds in your account.
                            </div>
                            <div class="command-example">cloud network vpc list</div>
                            <div class="expected-output">VPC_ID         VPC_NAME        CIDR_BLOCK      STATUS
vpc-default    default-vpc     10.0.0.0/16     active</div>
                        </div>

                        <div class="step" data-step="4-2">
                            <div class="step-header">
                                <span class="step-number">2</span>
                                <span class="step-title">Create a VPC</span>
                            </div>
                            <div class="step-description">
                                Create a new VPC named "prod-vpc" with CIDR block 172.16.0.0/16.
                            </div>
                            <div class="command-example">cloud network vpc create --name prod-vpc --cidr 172.16.0.0/16</div>
                            <div class="expected-output">Creating VPC 'prod-vpc'...
VPC created successfully!
VPC_ID: vpc-a1b2c3d4
VPC_NAME: prod-vpc
CIDR_BLOCK: 172.16.0.0/16
STATUS: active</div>
                            <div class="tip">CIDR notation defines the IP address range for your VPC.</div>
                        </div>

                        <div class="step" data-step="4-3">
                            <div class="step-header">
                                <span class="step-number">3</span>
                                <span class="step-title">Create a subnet</span>
                            </div>
                            <div class="step-description">
                                Create a subnet named "web-subnet" in the prod-vpc.
                            </div>
                            <div class="command-example">cloud network subnet create --name web-subnet --vpc prod-vpc --cidr 172.16.1.0/24</div>
                            <div class="expected-output">Creating subnet 'web-subnet' in VPC 'prod-vpc'...
Subnet created successfully!
SUBNET_ID: subnet-e5f6g7h8
SUBNET_NAME: web-subnet
VPC_ID: vpc-a1b2c3d4
CIDR_BLOCK: 172.16.1.0/24
AVAILABLE_IPS: 251</div>
                        </div>

                        <div class="step" data-step="4-4">
                            <div class="step-header">
                                <span class="step-number">4</span>
                                <span class="step-title">Create a security group</span>
                            </div>
                            <div class="step-description">
                                Create a security group named "web-sg" to control traffic.
                            </div>
                            <div class="command-example">cloud network secgroup create --name web-sg --description "Web server security group"</div>
                            <div class="expected-output">Creating security group 'web-sg'...
Security group created successfully!
SECGROUP_ID: sg-i9j0k1l2
SECGROUP_NAME: web-sg
DESCRIPTION: Web server security group
DEFAULT_RULES:
  - EGRESS: All traffic allowed
  - INGRESS: Deny all (add rules to allow)</div>
                        </div>

                        <div class="step" data-step="4-5">
                            <div class="step-header">
                                <span class="step-number">5</span>
                                <span class="step-title">Add security group rule</span>
                            </div>
                            <div class="step-description">
                                Allow HTTP traffic (port 80) to the web-sg security group.
                            </div>
                            <div class="command-example">cloud network secgroup add-rule --name web-sg --port 80 --protocol tcp --source 0.0.0.0/0</div>
                            <div class="expected-output">Adding rule to security group 'web-sg'...
Rule added successfully!
RULE_ID: rule-m3n4o5p6
PROTOCOL: tcp
PORT: 80
SOURCE: 0.0.0.0/0 (anywhere)
ACTION: allow</div>
                            <div class="tip">Security groups act as virtual firewalls for your cloud resources.</div>
                        </div>
                    </div>

                    <!-- Lab 5 Instructions -->
                    <div class="instruction-section" data-instructions="5">
                        <h2>Lab 5: Identity & Access Management</h2>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                            Master IAM concepts by creating users, groups, and managing permissions.
                        </p>

                        <div class="step" data-step="5-1">
                            <div class="step-header">
                                <span class="step-number">1</span>
                                <span class="step-title">List IAM users</span>
                            </div>
                            <div class="step-description">
                                View all IAM users in your account.
                            </div>
                            <div class="command-example">cloud iam user list</div>
                            <div class="expected-output">USER_ID     USERNAME        CREATED              ROLES
admin-001   admin           2024-01-01 09:00     admin
dev-67890   developer       2024-01-15 10:15     compute-admin</div>
                        </div>

                        <div class="step" data-step="5-2">
                            <div class="step-header">
                                <span class="step-number">2</span>
                                <span class="step-title">Create a new IAM user</span>
                            </div>
                            <div class="step-description">
                                Create a user named "auditor" for compliance monitoring.
                            </div>
                            <div class="command-example">cloud iam user create auditor</div>
                            <div class="expected-output">Creating IAM user 'auditor'...
User created successfully!
USER_ID: aud-q7r8s9t0
USERNAME: auditor
EMAIL: auditor@cloud.local
STATUS: active
ACCESS_KEY_ID: AKIA1234567890ABCDEF</div>
                        </div>

                        <div class="step" data-step="5-3">
                            <div class="step-header">
                                <span class="step-number">3</span>
                                <span class="step-title">List available roles</span>
                            </div>
                            <div class="step-description">
                                Check what roles are available in the system.
                            </div>
                            <div class="command-example">cloud iam role list</div>
                            <div class="expected-output">ROLE_NAME           DESCRIPTION                      PERMISSIONS
admin               Full system access               All
compute-admin       VM management access             compute.*
storage-admin       Storage management access        storage.*
network-admin       Network management access        network.*
read-only           Read-only access to all          *.list, *.get</div>
                        </div>

                        <div class="step" data-step="5-4">
                            <div class="step-header">
                                <span class="step-number">4</span>
                                <span class="step-title">Assign read-only role</span>
                            </div>
                            <div class="step-description">
                                Grant the "auditor" user read-only access.
                            </div>
                            <div class="command-example">cloud iam role assign auditor read-only</div>
                            <div class="expected-output">Assigning role 'read-only' to user 'auditor'...
Role assigned successfully!
USER: auditor
ROLE: read-only
PERMISSIONS:
  - *.list (Can list all resources)
  - *.get (Can view resource details)
  - Deny: create, delete, update operations</div>
                        </div>

                        <div class="step" data-step="5-5">
                            <div class="step-header">
                                <span class="step-number">5</span>
                                <span class="step-title">Create a custom group</span>
                            </div>
                            <div class="step-description">
                                Create a group named "developers" for team management.
                            </div>
                            <div class="command-example">cloud iam group create developers</div>
                            <div class="expected-output">Creating IAM group 'developers'...
Group created successfully!
GROUP_ID: grp-u1v2w3x4
GROUP_NAME: developers
MEMBERS: 0
ATTACHED_ROLES: none</div>
                            <div class="tip">Groups make it easier to manage permissions for multiple users.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Terminal Section -->
            <div class="terminal-section">
                <div class="terminal-header">
                    <div class="terminal-title">cloud-cli@simulator:~$</div>
                    <div class="terminal-controls">
                        <button class="terminal-btn" id="clearBtn">Clear</button>
                        <button class="terminal-btn" id="resetBtn">Reset Lab</button>
                        <button class="terminal-btn" id="helpBtn">Help</button>
                    </div>
                </div>
                <div class="terminal-output" id="terminalOutput">
                    <div class="welcome-message">
                        <pre style="color: var(--accent-blue);">
 ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó     ‚ñà‚ñà‚ïó
‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó    ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë
‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë    ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë
‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë    ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë
‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù    ‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë
 ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù      ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù
</pre>
                        <div style="color: var(--accent-green); margin-top: 1rem;">
                            Welcome to the Cloud Computing Lab Simulator v1.0
                        </div>
                        <div style="color: var(--text-secondary); margin-top: 0.5rem;">
                            Type 'help' for available commands or follow the lab instructions on the left.
                        </div>
                        <div style="color: var(--accent-yellow); margin-top: 0.5rem;">
                            Tip: Commands are case-sensitive. Press TAB for auto-complete suggestions.
                        </div>
                        <div style="border-top: 1px solid var(--border-color); margin: 1rem 0;"></div>
                    </div>
                </div>
                <div class="terminal-input-container">
                    <span class="terminal-prompt-text">cloud-cli@simulator:~$</span>
                    <input type="text" class="terminal-input" id="terminalInput" placeholder="Type your command here..." autocomplete="off">
                </div>
            </div>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-item">
                <span class="stat-label">Current Lab:</span>
                <span class="stat-value" id="currentLab">Lab 1</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Overall Progress:</span>
                <span class="stat-value" id="overallProgress">0%</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Commands Executed:</span>
                <span class="stat-value" id="commandCount">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Resources Created:</span>
                <span class="stat-value" id="resourceCount">0</span>
            </div>
        </div>
    </div>

    <script>
        // Cloud Simulator State
        const cloudState = {
            projects: [
                { id: 'default-project', name: 'Default Project', status: 'active' }
            ],
            users: [
                { id: 'admin-001', username: 'admin', email: 'admin@cloud.local', status: 'active', roles: ['admin'] }
            ],
            vms: [],
            storage: [],
            vpcs: [
                { id: 'vpc-default', name: 'default-vpc', cidr: '10.0.0.0/16', status: 'active' }
            ],
            subnets: [],
            securityGroups: [],
            groups: [],
            commandCount: 0,
            currentLab: 1,
            labProgress: {
                1: { completed: new Set(), total: 5 },
                2: { completed: new Set(), total: 5 },
                3: { completed: new Set(), total: 5 },
                4: { completed: new Set(), total: 5 },
                5: { completed: new Set(), total: 5 }
            }
        };

        // Lab step tracking
        const labSteps = {
            1: ['1-1', '1-2', '1-3', '1-4', '1-5'],
            2: ['2-1', '2-2', '2-3', '2-4', '2-5'],
            3: ['3-1', '3-2', '3-3', '3-4', '3-5'],
            4: ['4-1', '4-2', '4-3', '4-4', '4-5'],
            5: ['5-1', '5-2', '5-3', '5-4', '5-5']
        };

        // Command history
        let commandHistory = [];
        let historyIndex = -1;

        // DOM Elements
        const terminalOutput = document.getElementById('terminalOutput');
        const terminalInput = document.getElementById('terminalInput');
        const currentLabEl = document.getElementById('currentLab');
        const overallProgressEl = document.getElementById('overallProgress');
        const commandCountEl = document.getElementById('commandCount');
        const resourceCountEl = document.getElementById('resourceCount');

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            terminalInput.focus();
            loadState();
            updateStats();
        });

        // Tab switching
        document.querySelectorAll('.lab-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const labNum = parseInt(tab.dataset.lab);
                switchLab(labNum);
            });
        });

        function switchLab(labNum) {
            // Update active tab
            document.querySelectorAll('.lab-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.lab-tab[data-lab="${labNum}"]`).classList.add('active');

            // Update active instructions
            document.querySelectorAll('.instruction-section').forEach(s => s.classList.remove('active'));
            document.querySelector(`.instruction-section[data-instructions="${labNum}"]`).classList.add('active');

            cloudState.currentLab = labNum;
            currentLabEl.textContent = `Lab ${labNum}`;
            saveState();
        }

        // Terminal input handling
        terminalInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const command = terminalInput.value.trim();
                if (command) {
                    executeCommand(command);
                    commandHistory.push(command);
                    historyIndex = commandHistory.length;
                    terminalInput.value = '';
                }
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (historyIndex > 0) {
                    historyIndex--;
                    terminalInput.value = commandHistory[historyIndex];
                }
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (historyIndex < commandHistory.length - 1) {
                    historyIndex++;
                    terminalInput.value = commandHistory[historyIndex];
                } else {
                    historyIndex = commandHistory.length;
                    terminalInput.value = '';
                }
            }
        });

        // Execute command
        function executeCommand(command) {
            addTerminalLine(`<span class="terminal-prompt">cloud-cli@simulator:~$</span> <span class="terminal-command">${escapeHtml(command)}</span>`);

            cloudState.commandCount++;
            commandCountEl.textContent = cloudState.commandCount;

            const parts = command.split(/\s+/);
            const mainCmd = parts[0];

            if (mainCmd !== 'cloud' && mainCmd !== 'help' && mainCmd !== 'clear') {
                addTerminalLine(`<span class="terminal-error">Error: Command not found: ${escapeHtml(mainCmd)}</span>`, 'terminal-error');
                addTerminalLine(`<span class="terminal-info">Hint: All commands start with 'cloud' (e.g., 'cloud project list')</span>`, 'terminal-info');
                return;
            }

            if (mainCmd === 'help') {
                showHelp();
                return;
            }

            if (mainCmd === 'clear') {
                clearTerminal();
                return;
            }

            const subCmd = parts[1];

            // Route commands
            if (subCmd === 'project') {
                handleProjectCommand(parts.slice(2));
            } else if (subCmd === 'user') {
                handleUserCommand(parts.slice(2));
            } else if (subCmd === 'role') {
                handleRoleCommand(parts.slice(2));
            } else if (subCmd === 'vm') {
                handleVMCommand(parts.slice(2));
            } else if (subCmd === 'storage') {
                handleStorageCommand(parts.slice(2));
            } else if (subCmd === 'network') {
                handleNetworkCommand(parts.slice(2));
            } else if (subCmd === 'iam') {
                handleIAMCommand(parts.slice(2));
            } else {
                addTerminalLine(`<span class="terminal-error">Error: Unknown subcommand '${escapeHtml(subCmd)}'</span>`, 'terminal-error');
                addTerminalLine(`<span class="terminal-info">Type 'help' for available commands.</span>`, 'terminal-info');
            }

            saveState();
            scrollToBottom();
        }

        // Project commands
        function handleProjectCommand(args) {
            const action = args[0];

            if (action === 'list') {
                if (cloudState.projects.length === 0) {
                    addTerminalLine('<span class="terminal-output-line">No projects found.</span>');
                } else {
                    addTerminalLine('<span class="terminal-success">PROJECT_ID          PROJECT_NAME        STATUS</span>', 'terminal-success');
                    cloudState.projects.forEach(p => {
                        addTerminalLine(`<span class="terminal-output-line">${p.id.padEnd(20)}${p.name.padEnd(20)}${p.status}</span>`);
                    });
                }
                markStepComplete('1-1');
            } else if (action === 'create') {
                const projectName = args[1];
                if (!projectName) {
                    addTerminalLine('<span class="terminal-error">Error: Project name required</span>', 'terminal-error');
                    addTerminalLine('<span class="terminal-info">Usage: cloud project create &lt;name&gt;</span>', 'terminal-info');
                    return;
                }

                const projectId = `${projectName.toLowerCase().substring(0, 4)}-${generateId()}`;
                cloudState.projects.push({
                    id: projectId,
                    name: projectName,
                    status: 'active'
                });

                addTerminalLine(`<span class="terminal-success">Project '${escapeHtml(projectName)}' created successfully</span>`, 'terminal-success');
                addTerminalLine(`<span class="terminal-info">PROJECT_ID: ${projectId}</span>`, 'terminal-info');
                addTerminalLine(`<span class="terminal-info">STATUS: active</span>`, 'terminal-info');

                if (projectName.toLowerCase() === 'production') {
                    markStepComplete('1-2');
                }
                updateResourceCount();
            } else {
                addTerminalLine(`<span class="terminal-error">Error: Unknown action '${escapeHtml(action)}'</span>`, 'terminal-error');
            }
        }

        // User commands
        function handleUserCommand(args) {
            const action = args[0];

            if (action === 'list') {
                if (cloudState.users.length === 0) {
                    addTerminalLine('<span class="terminal-output-line">No users found.</span>');
                } else {
                    addTerminalLine('<span class="terminal-success">USER_ID     USERNAME        EMAIL                   STATUS</span>', 'terminal-success');
                    cloudState.users.forEach(u => {
                        addTerminalLine(`<span class="terminal-output-line">${u.id.padEnd(12)}${u.username.padEnd(16)}${u.email.padEnd(24)}${u.status}</span>`);
                    });
                }
                markStepComplete('1-3');
            } else if (action === 'create') {
                const username = args[1];
                if (!username) {
                    addTerminalLine('<span class="terminal-error">Error: Username required</span>', 'terminal-error');
                    addTerminalLine('<span class="terminal-info">Usage: cloud user create &lt;username&gt;</span>', 'terminal-info');
                    return;
                }

                const userId = `${username.substring(0, 3).toLowerCase()}-${generateId()}`;
                cloudState.users.push({
                    id: userId,
                    username: username,
                    email: `${username}@cloud.local`,
                    status: 'active',
                    roles: []
                });

                addTerminalLine(`<span class="terminal-success">User '${escapeHtml(username)}' created successfully</span>`, 'terminal-success');
                addTerminalLine(`<span class="terminal-info">USER_ID: ${userId}</span>`, 'terminal-info');
                addTerminalLine(`<span class="terminal-info">EMAIL: ${username}@cloud.local</span>`, 'terminal-info');
                addTerminalLine(`<span class="terminal-info">STATUS: active</span>`, 'terminal-info');

                if (username.toLowerCase() === 'developer') {
                    markStepComplete('1-4');
                }
                updateResourceCount();
            } else {
                addTerminalLine(`<span class="terminal-error">Error: Unknown action '${escapeHtml(action)}'</span>`, 'terminal-error');
            }
        }

        // Role commands
        function handleRoleCommand(args) {
            const action = args[0];

            if (action === 'assign') {
                const username = args[1];
                const roleName = args[2];

                if (!username || !roleName) {
                    addTerminalLine('<span class="terminal-error">Error: Username and role required</span>', 'terminal-error');
                    addTerminalLine('<span class="terminal-info">Usage: cloud role assign &lt;user&gt; &lt;role&gt;</span>', 'terminal-info');
                    return;
                }

                const user = cloudState.users.find(u => u.username === username);
                if (!user) {
                    addTerminalLine(`<span class="terminal-error">Error: User '${escapeHtml(username)}' not found</span>`, 'terminal-error');
                    return;
                }

                if (!user.roles) user.roles = [];
                user.roles.push(roleName);

                addTerminalLine(`<span class="terminal-success">Role '${escapeHtml(roleName)}' assigned to user '${escapeHtml(username)}' successfully</span>`, 'terminal-success');
                addTerminalLine(`<span class="terminal-info">Permissions granted:</span>`, 'terminal-info');

                if (roleName === 'compute-admin') {
                    addTerminalLine(`<span class="terminal-info">  - compute.instances.create</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">  - compute.instances.delete</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">  - compute.instances.list</span>`, 'terminal-info');
                }

                if (username.toLowerCase() === 'developer' && roleName === 'compute-admin') {
                    markStepComplete('1-5');
                }
            } else {
                addTerminalLine(`<span class="terminal-error">Error: Unknown action '${escapeHtml(action)}'</span>`, 'terminal-error');
            }
        }

        // VM commands
        function handleVMCommand(args) {
            const action = args[0];

            if (action === 'list') {
                if (cloudState.vms.length === 0) {
                    addTerminalLine('<span class="terminal-output-line">No virtual machines found.</span>');
                } else {
                    addTerminalLine('<span class="terminal-success">INSTANCE_ID    NAME          SIZE     IP           STATUS</span>', 'terminal-success');
                    cloudState.vms.forEach(vm => {
                        addTerminalLine(`<span class="terminal-output-line">${vm.id.padEnd(15)}${vm.name.padEnd(14)}${vm.size.padEnd(9)}${vm.ip.padEnd(13)}${vm.status}</span>`);
                    });
                }

                if (cloudState.vms.length === 0) {
                    markStepComplete('2-1');
                } else {
                    markStepComplete('2-4');
                }
            } else if (action === 'create') {
                const nameIdx = args.indexOf('--name');
                const sizeIdx = args.indexOf('--size');

                if (nameIdx === -1 || sizeIdx === -1) {
                    addTerminalLine('<span class="terminal-error">Error: --name and --size flags required</span>', 'terminal-error');
                    addTerminalLine('<span class="terminal-info">Usage: cloud vm create --name &lt;name&gt; --size &lt;small|medium|large&gt;</span>', 'terminal-info');
                    return;
                }

                const vmName = args[nameIdx + 1];
                const vmSize = args[sizeIdx + 1];

                if (!vmName || !vmSize) {
                    addTerminalLine('<span class="terminal-error">Error: VM name and size required</span>', 'terminal-error');
                    return;
                }

                if (!['small', 'medium', 'large'].includes(vmSize)) {
                    addTerminalLine('<span class="terminal-error">Error: Size must be small, medium, or large</span>', 'terminal-error');
                    return;
                }

                const vmId = `vm-${generateId(8)}`;
                const vmIp = `10.0.1.${Math.floor(Math.random() * 240) + 10}`;

                const sizeSpecs = {
                    small: '1 vCPU, 2GB RAM',
                    medium: '2 vCPU, 4GB RAM',
                    large: '4 vCPU, 8GB RAM'
                };

                cloudState.vms.push({
                    id: vmId,
                    name: vmName,
                    size: vmSize,
                    ip: vmIp,
                    status: 'running'
                });

                addTerminalLine(`<span class="terminal-info">Creating virtual machine '${escapeHtml(vmName)}'...</span>`, 'terminal-info');
                addTerminalLine(`<span class="terminal-success">VM created successfully!</span>`, 'terminal-success');
                addTerminalLine(`<span class="terminal-info">INSTANCE_ID: ${vmId}</span>`, 'terminal-info');
                addTerminalLine(`<span class="terminal-info">NAME: ${vmName}</span>`, 'terminal-info');
                addTerminalLine(`<span class="terminal-info">SIZE: ${vmSize} (${sizeSpecs[vmSize]})</span>`, 'terminal-info');
                addTerminalLine(`<span class="terminal-info">IP: ${vmIp}</span>`, 'terminal-info');
                addTerminalLine(`<span class="terminal-info">STATUS: running</span>`, 'terminal-info');

                if (vmName.toLowerCase() === 'web-server') {
                    markStepComplete('2-2');
                } else if (vmName.toLowerCase() === 'app-server') {
                    markStepComplete('2-3');
                }
                updateResourceCount();
            } else if (action === 'delete') {
                const vmName = args[1];
                if (!vmName) {
                    addTerminalLine('<span class="terminal-error">Error: VM name required</span>', 'terminal-error');
                    addTerminalLine('<span class="terminal-info">Usage: cloud vm delete &lt;name&gt;</span>', 'terminal-info');
                    return;
                }

                const vmIndex = cloudState.vms.findIndex(vm => vm.name === vmName);
                if (vmIndex === -1) {
                    addTerminalLine(`<span class="terminal-error">Error: VM '${escapeHtml(vmName)}' not found</span>`, 'terminal-error');
                    return;
                }

                cloudState.vms.splice(vmIndex, 1);
                addTerminalLine(`<span class="terminal-info">Deleting virtual machine '${escapeHtml(vmName)}'...</span>`, 'terminal-info');
                addTerminalLine(`<span class="terminal-success">VM '${escapeHtml(vmName)}' deleted successfully!</span>`, 'terminal-success');

                if (vmName.toLowerCase() === 'web-server') {
                    markStepComplete('2-5');
                }
                updateResourceCount();
            } else {
                addTerminalLine(`<span class="terminal-error">Error: Unknown action '${escapeHtml(action)}'</span>`, 'terminal-error');
            }
        }

        // Storage commands
        function handleStorageCommand(args) {
            const action = args[0];

            if (action === 'list') {
                if (cloudState.storage.length === 0) {
                    addTerminalLine('<span class="terminal-output-line">No storage buckets found.</span>');
                } else {
                    addTerminalLine('<span class="terminal-success">BUCKET_NAME    REGION        SIZE     CREATED              STATUS</span>', 'terminal-success');
                    cloudState.storage.forEach(s => {
                        addTerminalLine(`<span class="terminal-output-line">${s.name.padEnd(15)}${s.region.padEnd(14)}${s.size.padEnd(9)}${s.created.padEnd(21)}${s.status}</span>`);
                    });
                }

                if (cloudState.storage.length === 0) {
                    markStepComplete('3-1');
                } else {
                    markStepComplete('3-4');
                }
            } else if (action === 'create') {
                const bucketName = args[1];
                if (!bucketName) {
                    addTerminalLine('<span class="terminal-error">Error: Bucket name required</span>', 'terminal-error');
                    addTerminalLine('<span class="terminal-info">Usage: cloud storage create &lt;bucket-name&gt;</span>', 'terminal-info');
                    return;
                }

                const now = new Date().toISOString().split('T')[0] + ' ' +
                            new Date().toTimeString().split(' ')[0].substring(0, 5);

                cloudState.storage.push({
                    name: bucketName,
                    region: 'us-east-1',
                    size: '0 GB',
                    created: now,
                    status: 'active'
                });

                addTerminalLine(`<span class="terminal-info">Creating storage bucket '${escapeHtml(bucketName)}'...</span>`, 'terminal-info');
                addTerminalLine(`<span class="terminal-success">Bucket created successfully!</span>`, 'terminal-success');
                addTerminalLine(`<span class="terminal-info">BUCKET_NAME: ${bucketName}</span>`, 'terminal-info');
                addTerminalLine(`<span class="terminal-info">REGION: us-east-1</span>`, 'terminal-info');
                addTerminalLine(`<span class="terminal-info">SIZE: 0 GB</span>`, 'terminal-info');
                addTerminalLine(`<span class="terminal-info">STATUS: active</span>`, 'terminal-info');

                if (bucketName.toLowerCase() === 'app-data') {
                    markStepComplete('3-2');
                } else if (bucketName.toLowerCase() === 'backups') {
                    markStepComplete('3-3');
                }
                updateResourceCount();
            } else if (action === 'delete') {
                const bucketName = args[1];
                if (!bucketName) {
                    addTerminalLine('<span class="terminal-error">Error: Bucket name required</span>', 'terminal-error');
                    addTerminalLine('<span class="terminal-info">Usage: cloud storage delete &lt;bucket-name&gt;</span>', 'terminal-info');
                    return;
                }

                const bucketIndex = cloudState.storage.findIndex(s => s.name === bucketName);
                if (bucketIndex === -1) {
                    addTerminalLine(`<span class="terminal-error">Error: Bucket '${escapeHtml(bucketName)}' not found</span>`, 'terminal-error');
                    return;
                }

                cloudState.storage.splice(bucketIndex, 1);
                addTerminalLine(`<span class="terminal-info">Deleting storage bucket '${escapeHtml(bucketName)}'...</span>`, 'terminal-info');
                addTerminalLine(`<span class="terminal-success">Bucket '${escapeHtml(bucketName)}' deleted successfully!</span>`, 'terminal-success');

                if (bucketName.toLowerCase() === 'backups') {
                    markStepComplete('3-5');
                }
                updateResourceCount();
            } else {
                addTerminalLine(`<span class="terminal-error">Error: Unknown action '${escapeHtml(action)}'</span>`, 'terminal-error');
            }
        }

        // Network commands
        function handleNetworkCommand(args) {
            const subCmd = args[0];

            if (subCmd === 'vpc') {
                const action = args[1];

                if (action === 'list') {
                    if (cloudState.vpcs.length === 0) {
                        addTerminalLine('<span class="terminal-output-line">No VPCs found.</span>');
                    } else {
                        addTerminalLine('<span class="terminal-success">VPC_ID         VPC_NAME        CIDR_BLOCK      STATUS</span>', 'terminal-success');
                        cloudState.vpcs.forEach(v => {
                            addTerminalLine(`<span class="terminal-output-line">${v.id.padEnd(15)}${v.name.padEnd(16)}${v.cidr.padEnd(16)}${v.status}</span>`);
                        });
                    }
                    markStepComplete('4-1');
                } else if (action === 'create') {
                    const nameIdx = args.indexOf('--name');
                    const cidrIdx = args.indexOf('--cidr');

                    if (nameIdx === -1 || cidrIdx === -1) {
                        addTerminalLine('<span class="terminal-error">Error: --name and --cidr flags required</span>', 'terminal-error');
                        addTerminalLine('<span class="terminal-info">Usage: cloud network vpc create --name &lt;name&gt; --cidr &lt;cidr&gt;</span>', 'terminal-info');
                        return;
                    }

                    const vpcName = args[nameIdx + 1];
                    const cidr = args[cidrIdx + 1];

                    const vpcId = `vpc-${generateId(8)}`;
                    cloudState.vpcs.push({
                        id: vpcId,
                        name: vpcName,
                        cidr: cidr,
                        status: 'active'
                    });

                    addTerminalLine(`<span class="terminal-info">Creating VPC '${escapeHtml(vpcName)}'...</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-success">VPC created successfully!</span>`, 'terminal-success');
                    addTerminalLine(`<span class="terminal-info">VPC_ID: ${vpcId}</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">VPC_NAME: ${vpcName}</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">CIDR_BLOCK: ${cidr}</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">STATUS: active</span>`, 'terminal-info');

                    if (vpcName.toLowerCase() === 'prod-vpc') {
                        markStepComplete('4-2');
                    }
                    updateResourceCount();
                }
            } else if (subCmd === 'subnet') {
                const action = args[1];

                if (action === 'create') {
                    const nameIdx = args.indexOf('--name');
                    const vpcIdx = args.indexOf('--vpc');
                    const cidrIdx = args.indexOf('--cidr');

                    if (nameIdx === -1 || vpcIdx === -1 || cidrIdx === -1) {
                        addTerminalLine('<span class="terminal-error">Error: --name, --vpc, and --cidr flags required</span>', 'terminal-error');
                        return;
                    }

                    const subnetName = args[nameIdx + 1];
                    const vpcName = args[vpcIdx + 1];
                    const cidr = args[cidrIdx + 1];

                    const vpc = cloudState.vpcs.find(v => v.name === vpcName);
                    if (!vpc) {
                        addTerminalLine(`<span class="terminal-error">Error: VPC '${escapeHtml(vpcName)}' not found</span>`, 'terminal-error');
                        return;
                    }

                    const subnetId = `subnet-${generateId(8)}`;
                    cloudState.subnets.push({
                        id: subnetId,
                        name: subnetName,
                        vpcId: vpc.id,
                        cidr: cidr
                    });

                    addTerminalLine(`<span class="terminal-info">Creating subnet '${escapeHtml(subnetName)}' in VPC '${escapeHtml(vpcName)}'...</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-success">Subnet created successfully!</span>`, 'terminal-success');
                    addTerminalLine(`<span class="terminal-info">SUBNET_ID: ${subnetId}</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">SUBNET_NAME: ${subnetName}</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">VPC_ID: ${vpc.id}</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">CIDR_BLOCK: ${cidr}</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">AVAILABLE_IPS: 251</span>`, 'terminal-info');

                    if (subnetName.toLowerCase() === 'web-subnet') {
                        markStepComplete('4-3');
                    }
                    updateResourceCount();
                }
            } else if (subCmd === 'secgroup') {
                const action = args[1];

                if (action === 'create') {
                    const nameIdx = args.indexOf('--name');
                    const descIdx = args.indexOf('--description');

                    if (nameIdx === -1) {
                        addTerminalLine('<span class="terminal-error">Error: --name flag required</span>', 'terminal-error');
                        return;
                    }

                    const sgName = args[nameIdx + 1];
                    const desc = descIdx !== -1 ? args.slice(descIdx + 1).join(' ').replace(/"/g, '') : '';

                    const sgId = `sg-${generateId(8)}`;
                    cloudState.securityGroups.push({
                        id: sgId,
                        name: sgName,
                        description: desc,
                        rules: []
                    });

                    addTerminalLine(`<span class="terminal-info">Creating security group '${escapeHtml(sgName)}'...</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-success">Security group created successfully!</span>`, 'terminal-success');
                    addTerminalLine(`<span class="terminal-info">SECGROUP_ID: ${sgId}</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">SECGROUP_NAME: ${sgName}</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">DESCRIPTION: ${desc}</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">DEFAULT_RULES:</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">  - EGRESS: All traffic allowed</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">  - INGRESS: Deny all (add rules to allow)</span>`, 'terminal-info');

                    if (sgName.toLowerCase() === 'web-sg') {
                        markStepComplete('4-4');
                    }
                    updateResourceCount();
                } else if (action === 'add-rule') {
                    const nameIdx = args.indexOf('--name');
                    const portIdx = args.indexOf('--port');
                    const protocolIdx = args.indexOf('--protocol');
                    const sourceIdx = args.indexOf('--source');

                    if (nameIdx === -1 || portIdx === -1) {
                        addTerminalLine('<span class="terminal-error">Error: --name and --port flags required</span>', 'terminal-error');
                        return;
                    }

                    const sgName = args[nameIdx + 1];
                    const port = args[portIdx + 1];
                    const protocol = protocolIdx !== -1 ? args[protocolIdx + 1] : 'tcp';
                    const source = sourceIdx !== -1 ? args[sourceIdx + 1] : '0.0.0.0/0';

                    const sg = cloudState.securityGroups.find(s => s.name === sgName);
                    if (!sg) {
                        addTerminalLine(`<span class="terminal-error">Error: Security group '${escapeHtml(sgName)}' not found</span>`, 'terminal-error');
                        return;
                    }

                    const ruleId = `rule-${generateId(8)}`;
                    sg.rules.push({ id: ruleId, port, protocol, source });

                    addTerminalLine(`<span class="terminal-info">Adding rule to security group '${escapeHtml(sgName)}'...</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-success">Rule added successfully!</span>`, 'terminal-success');
                    addTerminalLine(`<span class="terminal-info">RULE_ID: ${ruleId}</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">PROTOCOL: ${protocol}</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">PORT: ${port}</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">SOURCE: ${source} (anywhere)</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">ACTION: allow</span>`, 'terminal-info');

                    if (sgName.toLowerCase() === 'web-sg' && port === '80') {
                        markStepComplete('4-5');
                    }
                }
            } else {
                addTerminalLine(`<span class="terminal-error">Error: Unknown network subcommand '${escapeHtml(subCmd)}'</span>`, 'terminal-error');
            }
        }

        // IAM commands
        function handleIAMCommand(args) {
            const subCmd = args[0];

            if (subCmd === 'user') {
                const action = args[1];

                if (action === 'list') {
                    if (cloudState.users.length === 0) {
                        addTerminalLine('<span class="terminal-output-line">No IAM users found.</span>');
                    } else {
                        addTerminalLine('<span class="terminal-success">USER_ID     USERNAME        CREATED              ROLES</span>', 'terminal-success');
                        cloudState.users.forEach(u => {
                            const roles = u.roles && u.roles.length > 0 ? u.roles.join(', ') : 'none';
                            addTerminalLine(`<span class="terminal-output-line">${u.id.padEnd(12)}${u.username.padEnd(16)}2024-01-01 09:00     ${roles}</span>`);
                        });
                    }
                    markStepComplete('5-1');
                } else if (action === 'create') {
                    const username = args[2];
                    if (!username) {
                        addTerminalLine('<span class="terminal-error">Error: Username required</span>', 'terminal-error');
                        return;
                    }

                    const userId = `${username.substring(0, 3).toLowerCase()}-${generateId()}`;
                    const accessKey = `AKIA${generateId(16).toUpperCase()}`;

                    cloudState.users.push({
                        id: userId,
                        username: username,
                        email: `${username}@cloud.local`,
                        status: 'active',
                        roles: [],
                        accessKey: accessKey
                    });

                    addTerminalLine(`<span class="terminal-info">Creating IAM user '${escapeHtml(username)}'...</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-success">User created successfully!</span>`, 'terminal-success');
                    addTerminalLine(`<span class="terminal-info">USER_ID: ${userId}</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">USERNAME: ${username}</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">EMAIL: ${username}@cloud.local</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">STATUS: active</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">ACCESS_KEY_ID: ${accessKey}</span>`, 'terminal-info');

                    if (username.toLowerCase() === 'auditor') {
                        markStepComplete('5-2');
                    }
                    updateResourceCount();
                }
            } else if (subCmd === 'role') {
                const action = args[1];

                if (action === 'list') {
                    addTerminalLine('<span class="terminal-success">ROLE_NAME           DESCRIPTION                      PERMISSIONS</span>', 'terminal-success');
                    addTerminalLine('<span class="terminal-output-line">admin               Full system access               All</span>');
                    addTerminalLine('<span class="terminal-output-line">compute-admin       VM management access             compute.*</span>');
                    addTerminalLine('<span class="terminal-output-line">storage-admin       Storage management access        storage.*</span>');
                    addTerminalLine('<span class="terminal-output-line">network-admin       Network management access        network.*</span>');
                    addTerminalLine('<span class="terminal-output-line">read-only           Read-only access to all          *.list, *.get</span>');
                    markStepComplete('5-3');
                } else if (action === 'assign') {
                    const username = args[2];
                    const roleName = args[3];

                    if (!username || !roleName) {
                        addTerminalLine('<span class="terminal-error">Error: Username and role required</span>', 'terminal-error');
                        return;
                    }

                    const user = cloudState.users.find(u => u.username === username);
                    if (!user) {
                        addTerminalLine(`<span class="terminal-error">Error: User '${escapeHtml(username)}' not found</span>`, 'terminal-error');
                        return;
                    }

                    if (!user.roles) user.roles = [];
                    user.roles.push(roleName);

                    addTerminalLine(`<span class="terminal-info">Assigning role '${escapeHtml(roleName)}' to user '${escapeHtml(username)}'...</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-success">Role assigned successfully!</span>`, 'terminal-success');
                    addTerminalLine(`<span class="terminal-info">USER: ${username}</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">ROLE: ${roleName}</span>`, 'terminal-info');

                    if (roleName === 'read-only') {
                        addTerminalLine(`<span class="terminal-info">PERMISSIONS:</span>`, 'terminal-info');
                        addTerminalLine(`<span class="terminal-info">  - *.list (Can list all resources)</span>`, 'terminal-info');
                        addTerminalLine(`<span class="terminal-info">  - *.get (Can view resource details)</span>`, 'terminal-info');
                        addTerminalLine(`<span class="terminal-info">  - Deny: create, delete, update operations</span>`, 'terminal-info');
                    }

                    if (username.toLowerCase() === 'auditor' && roleName === 'read-only') {
                        markStepComplete('5-4');
                    }
                }
            } else if (subCmd === 'group') {
                const action = args[1];

                if (action === 'create') {
                    const groupName = args[2];
                    if (!groupName) {
                        addTerminalLine('<span class="terminal-error">Error: Group name required</span>', 'terminal-error');
                        return;
                    }

                    const groupId = `grp-${generateId(8)}`;
                    cloudState.groups.push({
                        id: groupId,
                        name: groupName,
                        members: [],
                        roles: []
                    });

                    addTerminalLine(`<span class="terminal-info">Creating IAM group '${escapeHtml(groupName)}'...</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-success">Group created successfully!</span>`, 'terminal-success');
                    addTerminalLine(`<span class="terminal-info">GROUP_ID: ${groupId}</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">GROUP_NAME: ${groupName}</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">MEMBERS: 0</span>`, 'terminal-info');
                    addTerminalLine(`<span class="terminal-info">ATTACHED_ROLES: none</span>`, 'terminal-info');

                    if (groupName.toLowerCase() === 'developers') {
                        markStepComplete('5-5');
                    }
                    updateResourceCount();
                }
            } else {
                addTerminalLine(`<span class="terminal-error">Error: Unknown IAM subcommand '${escapeHtml(subCmd)}'</span>`, 'terminal-error');
            }
        }

        // Help command
        function showHelp() {
            addTerminalLine('<span class="terminal-success">Available Commands:</span>', 'terminal-success');
            addTerminalLine('');
            addTerminalLine('<span class="terminal-info">Project Management:</span>', 'terminal-info');
            addTerminalLine('  <span class="terminal-command">cloud project list</span> - List all projects');
            addTerminalLine('  <span class="terminal-command">cloud project create &lt;name&gt;</span> - Create a new project');
            addTerminalLine('');
            addTerminalLine('<span class="terminal-info">User Management:</span>', 'terminal-info');
            addTerminalLine('  <span class="terminal-command">cloud user list</span> - List all users');
            addTerminalLine('  <span class="terminal-command">cloud user create &lt;username&gt;</span> - Create a new user');
            addTerminalLine('  <span class="terminal-command">cloud role assign &lt;user&gt; &lt;role&gt;</span> - Assign role to user');
            addTerminalLine('');
            addTerminalLine('<span class="terminal-info">Virtual Machines:</span>', 'terminal-info');
            addTerminalLine('  <span class="terminal-command">cloud vm list</span> - List all VMs');
            addTerminalLine('  <span class="terminal-command">cloud vm create --name &lt;name&gt; --size &lt;small|medium|large&gt;</span> - Create VM');
            addTerminalLine('  <span class="terminal-command">cloud vm delete &lt;name&gt;</span> - Delete a VM');
            addTerminalLine('');
            addTerminalLine('<span class="terminal-info">Storage:</span>', 'terminal-info');
            addTerminalLine('  <span class="terminal-command">cloud storage list</span> - List all storage buckets');
            addTerminalLine('  <span class="terminal-command">cloud storage create &lt;bucket-name&gt;</span> - Create a storage bucket');
            addTerminalLine('  <span class="terminal-command">cloud storage delete &lt;bucket-name&gt;</span> - Delete a storage bucket');
            addTerminalLine('');
            addTerminalLine('<span class="terminal-info">Networking:</span>', 'terminal-info');
            addTerminalLine('  <span class="terminal-command">cloud network vpc list</span> - List all VPCs');
            addTerminalLine('  <span class="terminal-command">cloud network vpc create --name &lt;name&gt; --cidr &lt;cidr&gt;</span> - Create VPC');
            addTerminalLine('  <span class="terminal-command">cloud network subnet create --name &lt;name&gt; --vpc &lt;vpc&gt; --cidr &lt;cidr&gt;</span> - Create subnet');
            addTerminalLine('  <span class="terminal-command">cloud network secgroup create --name &lt;name&gt; --description "&lt;desc&gt;"</span> - Create security group');
            addTerminalLine('  <span class="terminal-command">cloud network secgroup add-rule --name &lt;sg&gt; --port &lt;port&gt; --protocol &lt;tcp|udp&gt; --source &lt;cidr&gt;</span>');
            addTerminalLine('');
            addTerminalLine('<span class="terminal-info">Identity & Access Management:</span>', 'terminal-info');
            addTerminalLine('  <span class="terminal-command">cloud iam user list</span> - List IAM users');
            addTerminalLine('  <span class="terminal-command">cloud iam user create &lt;username&gt;</span> - Create IAM user');
            addTerminalLine('  <span class="terminal-command">cloud iam role list</span> - List available roles');
            addTerminalLine('  <span class="terminal-command">cloud iam role assign &lt;user&gt; &lt;role&gt;</span> - Assign role to user');
            addTerminalLine('  <span class="terminal-command">cloud iam group create &lt;groupname&gt;</span> - Create IAM group');
            addTerminalLine('');
            addTerminalLine('<span class="terminal-info">System:</span>', 'terminal-info');
            addTerminalLine('  <span class="terminal-command">help</span> - Show this help message');
            addTerminalLine('  <span class="terminal-command">clear</span> - Clear terminal output');
        }

        // Mark step as complete
        function markStepComplete(stepId) {
            const lab = parseInt(stepId.split('-')[0]);
            cloudState.labProgress[lab].completed.add(stepId);

            // Update step UI
            const stepEl = document.querySelector(`.step[data-step="${stepId}"]`);
            if (stepEl) {
                stepEl.classList.add('completed');
            }

            // Update progress
            updateLabProgress(lab);
            saveState();
        }

        // Update lab progress
        function updateLabProgress(labNum) {
            const progress = cloudState.labProgress[labNum];
            const percentage = Math.round((progress.completed.size / progress.total) * 100);

            const progressBar = document.querySelector(`[data-progress="${labNum}"]`);
            const progressText = progressBar.parentElement.nextElementSibling;

            progressBar.style.width = percentage + '%';
            progressText.textContent = percentage + '%';

            updateOverallProgress();
        }

        // Update overall progress
        function updateOverallProgress() {
            let totalSteps = 0;
            let completedSteps = 0;

            for (let lab in cloudState.labProgress) {
                totalSteps += cloudState.labProgress[lab].total;
                completedSteps += cloudState.labProgress[lab].completed.size;
            }

            const percentage = Math.round((completedSteps / totalSteps) * 100);
            overallProgressEl.textContent = percentage + '%';
        }

        // Update resource count
        function updateResourceCount() {
            const count = cloudState.projects.length +
                         cloudState.users.length +
                         cloudState.vms.length +
                         cloudState.storage.length +
                         cloudState.vpcs.length +
                         cloudState.subnets.length +
                         cloudState.securityGroups.length +
                         cloudState.groups.length;
            resourceCountEl.textContent = count;
        }

        // Update stats
        function updateStats() {
            commandCountEl.textContent = cloudState.commandCount;
            updateResourceCount();
            updateOverallProgress();

            for (let lab = 1; lab <= 5; lab++) {
                updateLabProgress(lab);
            }
        }

        // Add terminal line
        function addTerminalLine(content, className = '') {
            const line = document.createElement('div');
            line.className = 'terminal-line ' + className;
            line.innerHTML = content;
            terminalOutput.appendChild(line);
        }

        // Clear terminal
        function clearTerminal() {
            terminalOutput.innerHTML = '';
        }

        // Scroll to bottom
        function scrollToBottom() {
            terminalOutput.scrollTop = terminalOutput.scrollHeight;
        }

        // Generate random ID
        function generateId(length = 5) {
            const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        // Escape HTML
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // Save state to localStorage
        function saveState() {
            const state = {
                ...cloudState,
                labProgress: {
                    1: { completed: Array.from(cloudState.labProgress[1].completed), total: 5 },
                    2: { completed: Array.from(cloudState.labProgress[2].completed), total: 5 },
                    3: { completed: Array.from(cloudState.labProgress[3].completed), total: 5 },
                    4: { completed: Array.from(cloudState.labProgress[4].completed), total: 5 },
                    5: { completed: Array.from(cloudState.labProgress[5].completed), total: 5 }
                }
            };
            localStorage.setItem('cloudLabState', JSON.stringify(state));
        }

        // Load state from localStorage
        function loadState() {
            const saved = localStorage.getItem('cloudLabState');
            if (saved) {
                const state = JSON.parse(saved);

                // Restore state
                cloudState.projects = state.projects || cloudState.projects;
                cloudState.users = state.users || cloudState.users;
                cloudState.vms = state.vms || [];
                cloudState.storage = state.storage || [];
                cloudState.vpcs = state.vpcs || cloudState.vpcs;
                cloudState.subnets = state.subnets || [];
                cloudState.securityGroups = state.securityGroups || [];
                cloudState.groups = state.groups || [];
                cloudState.commandCount = state.commandCount || 0;
                cloudState.currentLab = state.currentLab || 1;

                // Restore progress
                if (state.labProgress) {
                    for (let lab in state.labProgress) {
                        cloudState.labProgress[lab].completed = new Set(state.labProgress[lab].completed);
                    }
                }

                // Update UI
                switchLab(cloudState.currentLab);

                // Mark completed steps
                for (let lab in cloudState.labProgress) {
                    cloudState.labProgress[lab].completed.forEach(stepId => {
                        const stepEl = document.querySelector(`.step[data-step="${stepId}"]`);
                        if (stepEl) {
                            stepEl.classList.add('completed');
                        }
                    });
                }
            }
        }

        // Button handlers
        document.getElementById('clearBtn').addEventListener('click', () => {
            clearTerminal();
            addTerminalLine('<span class="terminal-info">Terminal cleared.</span>', 'terminal-info');
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            if (confirm('Are you sure you want to reset this lab? All progress will be lost.')) {
                const lab = cloudState.currentLab;
                cloudState.labProgress[lab].completed.clear();

                // Remove completed class from steps
                document.querySelectorAll(`.instruction-section[data-instructions="${lab}"] .step`).forEach(step => {
                    step.classList.remove('completed');
                });

                // Reset lab-specific resources
                if (lab === 1) {
                    cloudState.projects = cloudState.projects.filter(p => p.id === 'default-project');
                    cloudState.users = cloudState.users.filter(u => u.id === 'admin-001');
                } else if (lab === 2) {
                    cloudState.vms = [];
                } else if (lab === 3) {
                    cloudState.storage = [];
                } else if (lab === 4) {
                    cloudState.vpcs = cloudState.vpcs.filter(v => v.id === 'vpc-default');
                    cloudState.subnets = [];
                    cloudState.securityGroups = [];
                } else if (lab === 5) {
                    cloudState.groups = [];
                }

                updateLabProgress(lab);
                updateResourceCount();
                saveState();

                addTerminalLine(`<span class="terminal-success">Lab ${lab} has been reset.</span>`, 'terminal-success');
            }
        });

        document.getElementById('helpBtn').addEventListener('click', () => {
            showHelp();
            scrollToBottom();
        });

        // Focus input when clicking terminal area
        terminalOutput.addEventListener('click', () => {
            terminalInput.focus();
        });
    </script>
</body>
</html>