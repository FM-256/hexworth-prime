<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Access Control -->
    <script src="../../../../components/AccessGuard.js"></script>
    <script>
        AccessGuard.require('sorted');
    </script>
    <!-- Achievement & Progress Integration -->
    <script src="../../../../components/AchievementManager.js"></script>
    <script src="../../../../components/ModuleProgress.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IAM & Security Quiz - Chapter 5 - Hexworth Prime</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #333;
            padding-bottom: 40px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 20px;
            color: white;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .home-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            font-size: 1em;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            z-index: 1000;
            text-decoration: none;
            transition: all 0.3s;
        }

        .home-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .quiz-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #e94560;
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .question-number {
            font-size: 1.1em;
            color: #666;
            font-weight: 600;
        }

        .question-text {
            font-size: 1.4em;
            font-weight: 600;
            color: #1a1a2e;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }

        .option {
            padding: 20px;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .option:hover {
            background: #e8f4f8;
            border-color: #4a90e2;
            transform: translateX(5px);
        }

        .option.selected {
            background: #e3f2fd;
            border-color: #2196F3;
        }

        .option.correct {
            background: #e8f5e9;
            border-color: #4caf50;
        }

        .option.incorrect {
            background: #ffebee;
            border-color: #f44336;
        }

        .option.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .option-label {
            font-weight: 600;
            color: #e94560;
            margin-right: 10px;
        }

        .feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 12px;
            display: none;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 500px;
            }
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: #e8f5e9;
            border: 2px solid #4caf50;
            color: #2e7d32;
        }

        .feedback.incorrect {
            background: #ffebee;
            border: 2px solid #f44336;
            color: #c62828;
        }

        .feedback-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .feedback-text {
            line-height: 1.6;
        }

        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 35px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: #e94560;
            color: white;
        }

        .btn-primary:hover {
            background: #d63651;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(233, 69, 96, 0.4);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .results {
            text-align: center;
            display: none;
        }

        .results.show {
            display: block;
        }

        .score-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #e94560 0%, #d63651 100%);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 30px auto;
            box-shadow: 0 10px 40px rgba(233, 69, 96, 0.3);
        }

        .score-number {
            font-size: 3.5em;
            font-weight: 700;
        }

        .score-label {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .results h2 {
            font-size: 2.2em;
            color: #1a1a2e;
            margin-bottom: 15px;
        }

        .results-message {
            font-size: 1.3em;
            color: #666;
            margin-bottom: 30px;
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
        }

        .stat-number {
            font-size: 2em;
            font-weight: 700;
            color: #e94560;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .question-review {
            text-align: left;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
        }

        .review-title {
            font-size: 1.5em;
            color: #1a1a2e;
            margin-bottom: 20px;
        }

        .review-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 4px solid #e0e0e0;
        }

        .review-item.correct {
            border-left-color: #4caf50;
        }

        .review-item.incorrect {
            border-left-color: #f44336;
        }

        .review-question {
            font-weight: 600;
            margin-bottom: 8px;
            color: #1a1a2e;
        }

        .review-answer {
            color: #666;
            font-size: 0.95em;
        }

        .start-screen {
            text-align: center;
        }

        .start-screen h2 {
            font-size: 2em;
            color: #1a1a2e;
            margin-bottom: 20px;
        }

        .quiz-info {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin: 30px 0;
            text-align: left;
        }

        .quiz-info h3 {
            color: #e94560;
            margin-bottom: 15px;
        }

        .quiz-info ul {
            list-style: none;
            padding-left: 0;
        }

        .quiz-info li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
        }

        .quiz-info li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #4caf50;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <a href="../../../../index.html" class="home-btn">üè† Home</a>

    <div class="container">
        <header>
            <h1>IAM & Security Quiz</h1>
            <p>Chapter 5: Securing Your AWS Resources</p>
        </header>

        <div class="quiz-container">
            <div id="startScreen" class="start-screen">
                <h2>Test Your AWS Security Knowledge</h2>
                <div class="quiz-info">
                    <h3>Quiz Information:</h3>
                    <ul>
                        <li>10 questions covering IAM, policies, MFA, and security groups</li>
                        <li>Multiple choice format with instant feedback</li>
                        <li>Detailed explanations for each answer</li>
                        <li>Score tracking and review at the end</li>
                        <li>No time limit - take your time to think</li>
                    </ul>
                </div>
                <button class="btn btn-primary" onclick="startQuiz()">Start Quiz</button>
            </div>

            <div id="quizScreen" style="display: none;">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar"></div>
                </div>

                <div class="question-header">
                    <div class="question-number" id="questionNumber">Question 1 of 10</div>
                </div>

                <div class="question-text" id="questionText"></div>

                <div class="options" id="optionsContainer"></div>

                <div class="feedback" id="feedback">
                    <div class="feedback-title" id="feedbackTitle"></div>
                    <div class="feedback-text" id="feedbackText"></div>
                </div>

                <div class="buttons">
                    <button class="btn btn-primary" id="submitBtn" onclick="submitAnswer()" disabled>Submit Answer</button>
                    <button class="btn btn-secondary" id="nextBtn" onclick="nextQuestion()" style="display: none;">Next Question</button>
                </div>
            </div>

            <div id="resultsScreen" class="results">
                <h2>Quiz Complete!</h2>
                <div class="score-circle">
                    <div class="score-number" id="scoreNumber">0%</div>
                    <div class="score-label">Score</div>
                </div>
                <div class="results-message" id="resultsMessage"></div>

                <div class="results-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="correctCount">0</div>
                        <div class="stat-label">Correct</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="incorrectCount">0</div>
                        <div class="stat-label">Incorrect</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="percentageScore">0%</div>
                        <div class="stat-label">Percentage</div>
                    </div>
                </div>

                <div class="question-review">
                    <h3 class="review-title">Question Review</h3>
                    <div id="reviewContainer"></div>
                </div>

                <div class="buttons">
                    <button class="btn btn-primary" onclick="restartQuiz()">Retake Quiz</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const questions = [
            {
                question: "What is the AWS Identity and Access Management (IAM) best practice for the root account?",
                options: [
                    "Use it for daily administrative tasks",
                    "Enable MFA and use it only for account setup and billing",
                    "Share the credentials with your team",
                    "Delete it after creating IAM users"
                ],
                correct: 1,
                explanation: "The root account has unlimited access to all AWS resources. Best practice is to enable MFA on it and use it only for initial account setup and billing tasks. Daily operations should be performed using IAM users or roles with appropriate permissions."
            },
            {
                question: "Which IAM policy type is attached directly to a user, group, or role?",
                options: [
                    "Service Control Policy (SCP)",
                    "Resource-based policy",
                    "Identity-based policy",
                    "Permission boundary"
                ],
                correct: 2,
                explanation: "Identity-based policies are attached directly to IAM identities (users, groups, or roles) and define what actions those identities can perform on which resources. Resource-based policies are attached to resources, not identities."
            },
            {
                question: "What does the principle of least privilege mean in IAM?",
                options: [
                    "Give users the minimum permissions needed to perform their job",
                    "Always deny access by default",
                    "Grant full administrator access to all users",
                    "Only allow read-only access to all resources"
                ],
                correct: 0,
                explanation: "The principle of least privilege means granting only the minimum permissions necessary for users to perform their job functions. This reduces the potential impact of security breaches and limits accidental damage from user errors."
            },
            {
                question: "Which AWS service provides Multi-Factor Authentication (MFA) for enhanced security?",
                options: [
                    "AWS Shield",
                    "AWS IAM",
                    "AWS WAF",
                    "AWS GuardDuty"
                ],
                correct: 1,
                explanation: "AWS IAM provides MFA capabilities that add an extra layer of security. MFA requires users to provide two forms of authentication: something they know (password) and something they have (MFA device code)."
            },
            {
                question: "What is the purpose of an IAM role?",
                options: [
                    "To permanently assign permissions to a user",
                    "To provide temporary credentials that can be assumed by trusted entities",
                    "To encrypt data at rest",
                    "To configure network access controls"
                ],
                correct: 1,
                explanation: "IAM roles provide temporary security credentials that can be assumed by trusted entities such as IAM users, applications, or AWS services. Unlike IAM users, roles don't have permanent credentials and are ideal for granting temporary access."
            },
            {
                question: "In a security group, what is the default behavior for inbound traffic?",
                options: [
                    "All traffic is allowed",
                    "All traffic is denied unless explicitly allowed",
                    "Only HTTP and HTTPS traffic is allowed",
                    "Traffic is allowed from the same VPC only"
                ],
                correct: 1,
                explanation: "Security groups are stateful firewalls with a default deny-all policy for inbound traffic. You must explicitly add rules to allow specific inbound traffic. This follows the security best practice of denying everything by default."
            },
            {
                question: "What is the difference between security groups and Network ACLs (NACLs)?",
                options: [
                    "Security groups are stateful, NACLs are stateless",
                    "Security groups are stateless, NACLs are stateful",
                    "There is no difference; they are the same",
                    "Security groups apply to VPCs, NACLs apply to regions"
                ],
                correct: 0,
                explanation: "Security groups are stateful (return traffic is automatically allowed), while NACLs are stateless (you must explicitly allow both inbound and outbound traffic). Security groups operate at the instance level, while NACLs operate at the subnet level."
            },
            {
                question: "Which IAM credential type should be used for programmatic access to AWS services?",
                options: [
                    "Username and password",
                    "Access keys (Access Key ID and Secret Access Key)",
                    "SSH key pairs",
                    "SSL certificates"
                ],
                correct: 1,
                explanation: "Access keys consisting of an Access Key ID and Secret Access Key are used for programmatic access to AWS via the CLI, SDKs, or APIs. Usernames and passwords are used for console access, while SSH keys are used for EC2 instance access."
            },
            {
                question: "What is an IAM policy statement's 'Effect' field used for?",
                options: [
                    "To specify the AWS region where the policy applies",
                    "To specify whether the statement allows or denies access",
                    "To specify the resource being accessed",
                    "To specify the user or group the policy applies to"
                ],
                correct: 1,
                explanation: "The 'Effect' field in an IAM policy statement specifies whether the statement results in an 'Allow' or 'Deny'. This determines whether the specified actions on specified resources are permitted or blocked."
            },
            {
                question: "What is the maximum number of security groups that can be attached to an EC2 instance?",
                options: [
                    "1",
                    "3",
                    "5",
                    "10"
                ],
                correct: 2,
                explanation: "AWS allows you to attach up to 5 security groups to an EC2 instance. The rules from all attached security groups are aggregated to determine what traffic is allowed. This provides flexibility in managing access controls."
            }
        ];

        let currentQuestion = 0;
        let score = 0;
        let userAnswers = [];
        let selectedOption = null;

        function startQuiz() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('quizScreen').style.display = 'block';
            currentQuestion = 0;
            score = 0;
            userAnswers = [];
            selectedOption = null;
            loadQuestion();
        }

        function loadQuestion() {
            const question = questions[currentQuestion];
            document.getElementById('questionNumber').textContent = `Question ${currentQuestion + 1} of ${questions.length}`;
            document.getElementById('questionText').textContent = question.question;

            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';

            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.innerHTML = `<span class="option-label">${String.fromCharCode(65 + index)}.</span>${option}`;
                optionDiv.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionDiv);
            });

            document.getElementById('feedback').classList.remove('show', 'correct', 'incorrect');
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('submitBtn').style.display = 'inline-block';
            document.getElementById('nextBtn').style.display = 'none';

            updateProgressBar();
        }

        function selectOption(index) {
            if (selectedOption !== null) return;

            const options = document.querySelectorAll('.option');
            options.forEach(opt => opt.classList.remove('selected'));
            options[index].classList.add('selected');
            selectedOption = index;
            document.getElementById('submitBtn').disabled = false;
        }

        function submitAnswer() {
            if (selectedOption === null) return;

            const question = questions[currentQuestion];
            const options = document.querySelectorAll('.option');
            const feedback = document.getElementById('feedback');
            const isCorrect = selectedOption === question.correct;

            options.forEach(opt => opt.classList.add('disabled'));
            options[question.correct].classList.add('correct');

            if (isCorrect) {
                score++;
                feedback.classList.add('correct');
                document.getElementById('feedbackTitle').textContent = '‚úì Correct!';
            } else {
                options[selectedOption].classList.add('incorrect');
                feedback.classList.add('incorrect');
                document.getElementById('feedbackTitle').textContent = '‚úó Incorrect';
            }

            document.getElementById('feedbackText').textContent = question.explanation;
            feedback.classList.add('show');

            userAnswers.push({
                question: question.question,
                userAnswer: question.options[selectedOption],
                correctAnswer: question.options[question.correct],
                isCorrect: isCorrect
            });

            document.getElementById('submitBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'inline-block';
        }

        function nextQuestion() {
            selectedOption = null;
            currentQuestion++;

            if (currentQuestion < questions.length) {
                loadQuestion();
            } else {
                showResults();
            }
        }

        function updateProgressBar() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function showResults() {
            document.getElementById('quizScreen').style.display = 'none';
            document.getElementById('resultsScreen').classList.add('show');

            const percentage = Math.round((score / questions.length) * 100);
            document.getElementById('scoreNumber').textContent = percentage + '%';
            document.getElementById('correctCount').textContent = score;
            document.getElementById('incorrectCount').textContent = questions.length - score;
            document.getElementById('percentageScore').textContent = percentage + '%';

            let message = '';
            if (percentage === 100) {
                message = 'Perfect score! You have mastered AWS IAM and Security!';
            } else if (percentage >= 80) {
                message = 'Excellent work! You have a strong understanding of AWS security.';
            } else if (percentage >= 60) {
                message = 'Good job! Review the explanations to strengthen your knowledge.';
            } else {
                message = 'Keep studying! Review the chapter and try again.';
            }
            document.getElementById('resultsMessage').textContent = message;

            const reviewContainer = document.getElementById('reviewContainer');
            reviewContainer.innerHTML = '';

            userAnswers.forEach((answer, index) => {
                const reviewItem = document.createElement('div');
                reviewItem.className = `review-item ${answer.isCorrect ? 'correct' : 'incorrect'}`;
                reviewItem.innerHTML = `
                    <div class="review-question"><strong>Q${index + 1}:</strong> ${answer.question}</div>
                    <div class="review-answer">
                        <strong>Your answer:</strong> ${answer.userAnswer}<br>
                        ${!answer.isCorrect ? `<strong>Correct answer:</strong> ${answer.correctAnswer}` : ''}
                    </div>
                `;
                reviewContainer.appendChild(reviewItem);
            });

            // Trigger achievement system
            if (typeof ModuleProgress !== 'undefined') {
                ModuleProgress.completeQuiz('cloud', 'ch05-iam-security-quiz', percentage, {
                    maxScore: 100,
                    showNotification: true
                });
            }
        }

        function restartQuiz() {
            document.getElementById('resultsScreen').classList.remove('show');
            document.getElementById('startScreen').style.display = 'block';
        }
    </script>
</body>
</html>