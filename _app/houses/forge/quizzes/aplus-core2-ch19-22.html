<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>A+ Core 2: Chapters 19-22 - Hexworth Prime</title>
  <style>
    :root {
      /* Hexworth Prime - Forge House Theme */
      --bg: #0a0a0f;
      --bg-secondary: #1c1917;
      --panel: #18181bee;
      --ink: #e0e0e0;
      --muted: #888;
      --accent: #fb923c;        /* Forge orange */
      --accent-2: #f97316;      /* Forge orange-dark */
      --accent-glow: rgba(251, 146, 60, 0.3);
      --good: #2ed573;
      --bad: #ff4757;
      --warn: #ffc107;
      --border: rgba(255, 255, 255, 0.1);
      --border-hover: rgba(251, 146, 60, 0.4);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }

    body {
      background: linear-gradient(135deg, #0a0a0f 0%, #1c1917 50%, #0a0a0f 100%);
      color: var(--ink);
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      line-height: 1.6;
    }

    /* Page Header */
    .page-header {
      padding: 15px 30px;
      background: rgba(0, 0, 0, 0.4);
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .page-header a {
      color: var(--muted);
      text-decoration: none;
      font-size: 0.9rem;
      transition: color 0.2s;
    }

    .page-header a:hover { color: var(--accent); }

    .brand {
      font-weight: 600;
      color: var(--ink);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .brand-icon {
      font-size: 1.2rem;
    }

    /* Main Container */
    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 28px;
    }

    header {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .title {
      font-weight: 700;
      font-size: clamp(20px, 2.2vw, 28px);
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .title-sub {
      opacity: 0.6;
      -webkit-text-fill-color: var(--muted);
    }

    /* Panels & Cards */
    .panel {
      background: linear-gradient(180deg, rgba(28, 25, 23, 0.9) 0%, rgba(10, 10, 15, 0.95) 100%);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
      overflow: hidden;
    }

    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
    }

    /* Buttons */
    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    button, .linkbtn {
      appearance: none;
      border: none;
      border-radius: 10px;
      padding: 10px 18px;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    button.primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color: #0a0a0f;
      box-shadow: 0 4px 15px var(--accent-glow);
    }

    button.primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px var(--accent-glow);
    }

    button.secondary {
      background: rgba(255, 255, 255, 0.08);
      color: var(--ink);
      border: 1px solid var(--border);
    }

    button.secondary:hover {
      background: rgba(255, 255, 255, 0.12);
      border-color: var(--border-hover);
    }

    button.ghost {
      background: transparent;
      color: var(--muted);
      border: 1px dashed var(--border);
    }

    button.ghost:hover {
      color: var(--ink);
      border-color: var(--border-hover);
    }

    button:active { transform: translateY(1px); }

    /* Layout */
    .row {
      display: flex;
      gap: 18px;
      flex-wrap: wrap;
    }

    .grid {
      display: grid;
      gap: 20px;
    }

    @media (min-width: 860px) {
      .grid { grid-template-columns: 1.2fr 0.8fr; }
    }

    /* Chips & Meta */
    .meta {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    .chip {
      padding: 5px 12px;
      border-radius: 20px;
      border: 1px solid var(--border);
      color: var(--muted);
      font-size: 0.8rem;
      font-weight: 500;
    }

    .chip.forge {
      border-color: rgba(251, 146, 60, 0.3);
      color: var(--accent);
      background: rgba(251, 146, 60, 0.1);
    }

    /* Progress Bar */
    .progress {
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      overflow: hidden;
      margin: 8px 0;
    }

    .progress > span {
      display: block;
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      width: 0;
      transition: width 0.3s ease;
      border-radius: 4px;
    }

    /* Timer */
    .timer {
      font-family: 'Fira Code', 'Courier New', monospace;
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--accent);
      padding: 8px 16px;
      background: rgba(251, 146, 60, 0.1);
      border: 1px solid rgba(251, 146, 60, 0.3);
      border-radius: 10px;
    }

    .timer.warning {
      color: var(--warn);
      background: rgba(255, 193, 7, 0.1);
      border-color: rgba(255, 193, 7, 0.3);
    }

    .timer.critical {
      color: var(--bad);
      background: rgba(255, 71, 87, 0.1);
      border-color: rgba(255, 71, 87, 0.3);
      animation: pulse-warning 0.5s ease-in-out infinite;
    }

    @keyframes pulse-warning {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    /* Questions */
    .q {
      font-size: 1.1rem;
      font-weight: 600;
      color: #fff;
      margin: 10px 0 15px;
      line-height: 1.5;
    }

    .opt {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      padding: 14px 16px;
      border: 2px solid var(--border);
      border-radius: 12px;
      margin: 10px 0;
      cursor: pointer;
      transition: all 0.2s ease;
      background: rgba(255, 255, 255, 0.03);
    }

    .opt:hover {
      background: rgba(251, 146, 60, 0.08);
      border-color: var(--border-hover);
      transform: translateX(4px);
    }

    .opt input { margin-top: 3px; accent-color: var(--accent); }

    .opt.correct {
      border-color: var(--good) !important;
      background: rgba(46, 213, 115, 0.15) !important;
    }

    .opt.wrong {
      border-color: var(--bad) !important;
      background: rgba(255, 71, 87, 0.15) !important;
    }

    /* Input Fields */
    .answer-input {
      width: 100%;
      padding: 14px 16px;
      border-radius: 10px;
      border: 2px solid var(--border);
      background: rgba(0, 0, 0, 0.3);
      color: var(--ink);
      font-size: 1rem;
      transition: all 0.2s ease;
    }

    .answer-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 15px var(--accent-glow);
    }

    .answer-input::placeholder { color: var(--muted); }

    /* Messages */
    .msg {
      font-size: 0.9rem;
      color: var(--muted);
    }

    /* Score Display */
    .score-display {
      font-size: 2.5rem;
      font-weight: 700;
    }

    .score-good { color: var(--good); }
    .score-mid { color: var(--warn); }
    .score-bad { color: var(--bad); }

    /* Utilities */
    .hidden { display: none; }

    .kbd {
      padding: 3px 8px;
      border: 1px solid var(--border);
      border-bottom-width: 3px;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.05);
      color: var(--ink);
      font-family: 'Fira Code', monospace;
      font-size: 0.8rem;
    }

    /* Footer */
    .footer {
      color: var(--muted);
      font-size: 0.85rem;
      margin-top: 20px;
      text-align: center;
    }

    .footer a {
      color: var(--accent);
      text-decoration: none;
    }

    .footer a:hover { text-decoration: underline; }

    /* Results Section */
    #results .card {
      border-left: 4px solid var(--border);
      margin-bottom: 15px;
    }

    #results .card.result-correct { border-left-color: var(--good); }
    #results .card.result-wrong { border-left-color: var(--bad); }

    /* Responsive */
    @media (max-width: 600px) {
      .container { padding: 16px; }
      .title { font-size: 1.2rem; }
      .timer { font-size: 1.2rem; }
      .opt { padding: 12px; }
    }

    /* Print Styles */
    @media print {
      .page-header, .toolbar, button { display: none !important; }
      body { background: white; color: black; }
      .panel, .card { border: 1px solid #ccc; box-shadow: none; }
    }
  </style>
</head>
<body>
  <!-- Hexworth Header -->
  <header class="page-header">
    <a href="../../index.html">‚Üê Back to Forge House</a>
    <span class="brand">
      <span class="brand-icon">üîß</span>
      Hexworth Prime
    </span>
  </header>

  <div class="container">
    <header>
      <div>
        <div class="title">CompTIA A+ Core 2 Quiz <span class="title-sub">‚Äî Chapters 19-22</span></div>
        <div class="meta" style="margin-top: 8px;">
          <span class="chip forge">Forge House</span>
          <span class="chip">220-1102</span>
          <span class="chip">10 Questions</span>
        </div>
      </div>
      <div class="toolbar">
        <button id="startBtn" class="primary">Start Quiz</button>
        <button id="resetBtn" class="secondary" title="Clear answers and restart">Reset</button>
        <button id="printBtn" class="ghost" title="Print or save results">Print</button>
      </div>
    </header>

    <div class="panel card" id="intro">
      <div class="row" style="align-items: flex-start">
        <div style="flex: 1; min-width: 260px">
          <h2 style="margin: 0 0 12px; color: #fff;">Instructions</h2>
          <ul style="margin: 0 0 16px; padding-left: 20px; line-height: 1.9;">
            <li>This quiz covers <strong>Chapters 19-22</strong> from the CompTIA A+ Complete Study Guide (220-1102)</li>
            <li>Total points: <strong>100</strong> (10 points each)</li>
            <li>Time limit: <strong>30 minutes</strong></li>
            <li>Your progress autosaves locally</li>
          </ul>
          <div class="meta">
            <span class="chip">Documentation</span>
            <span class="chip">Incident Response</span>
            <span class="chip">Professional Conduct</span>
          </div>
        </div>
        <div style="flex: 1; min-width: 260px">
          <div class="card" style="background: rgba(0,0,0,0.3)">
            <div class="row" style="justify-content: space-between; align-items: center">
              <div>
                <div class="msg">Timer</div>
                <div class="timer" id="timer">30:00</div>
              </div>
              <div style="flex: 1"></div>
              <div style="min-width: 55%">
                <div class="msg">Progress</div>
                <div class="progress">
                  <span id="progressBar" style="width: 0%"></span>
                </div>
                <div class="msg" id="progressText">0 / 10 answered</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <main class="grid" id="quizArea">
      <section id="questions"></section>
      <aside>
        <div class="card">
          <h3 style="margin: 0 0 12px; color: #fff;">Your Status</h3>
          <p class="msg" style="margin-bottom: 16px;">Answer all questions, then submit.</p>
          <div class="row" style="margin-bottom: 16px;">
            <button id="submitBtn" class="primary">Submit Quiz</button>
            <button id="reviewBtn" class="secondary">Review</button>
          </div>
          <hr style="border: none; border-top: 1px solid var(--border); margin: 16px 0">
          <div class="msg">Score</div>
          <div id="scoreDisplay" class="score-display">‚Äî</div>
          <div id="scoreNote" class="msg">Not graded yet</div>
        </div>
        <div class="card" style="margin-top: 16px">
          <h3 style="margin: 0 0 8px; color: #fff; font-size: 0.95rem;">Keyboard Tips</h3>
          <p class="msg">
            <span class="kbd">Tab</span> to navigate,
            <span class="kbd">‚Üë</span><span class="kbd">‚Üì</span> for choices,
            <span class="kbd">Enter</span> to select
          </p>
        </div>
      </aside>
    </main>

    <section class="panel card hidden" id="results">
      <h2 style="margin: 0 0 16px; color: #fff;">Results</h2>
      <p id="resultsSummary" style="font-size: 1.1rem; margin-bottom: 20px;"></p>
      <div id="resultsList"></div>
      <div class="row" style="margin-top: 20px">
        <button id="retryBtn" class="primary">Retry Quiz</button>
        <button id="showKeyBtn" class="secondary">Show Answer Key</button>
      </div>
    </section>

    <footer class="footer">
      <p>Part of <a href="../../../index.html">Hexworth Prime</a> | Forge House Certification Training</p>
    </footer>
  </div>

<script>
const STORAGE_KEY = "hexworth_aplus_core2_ch19_22_v1";
const TOTAL_TIME_SECONDS = 30 * 60;
let remaining = TOTAL_TIME_SECONDS;
let timerId = null;
let submitted = false;

/** QUIZ DATA **/
const quiz = [
  {
    id: 1,
    type: "mc",
    points: 10,
    stem: "Which of the following is a best practice when implementing documentation in support systems?",
    choices: [
      "Only document major system changes",
      "Use ticketing systems to track issues",
      "Avoid documenting user information for privacy reasons",
      "Keep all documentation in a single shared file"
    ],
    answer: 1
  },
  {
    id: 2,
    type: "tf",
    points: 10,
    stem: "When following the chain of custody for incident response, it's only necessary to document who obtained the evidence, not who controlled it throughout the process.",
    answer: false
  },
  {
    id: 3,
    type: "mc",
    points: 10,
    stem: "Which of the following is considered appropriate professional behavior in a technical support role?",
    choices: [
      "Texting while interacting with customers",
      "Taking personal calls during customer interactions",
      "Maintaining confidentiality",
      "Discussing personal opinions about customer issues"
    ],
    answer: 2
  },
  {
    id: 4,
    type: "fitb",
    points: 10,
    stem: "In incident response, the _____________ refers to the sequence in which evidence should be collected based on how quickly it might be lost or changed.",
    acceptable: ["order of volatility", "the order of volatility", "order-of-volatility", "evidence order of volatility"],
    normalizer: normalizeText
  },
  {
    id: 5,
    type: "mc",
    points: 10,
    stem: "Which of the following is a key component of change management best practices?",
    choices: [
      "Implementing changes without documentation",
      "Having a rollback plan",
      "Avoiding business process documentation",
      "Making changes during peak business hours"
    ],
    answer: 1
  },
  {
    id: 6,
    type: "mc",
    points: 10,
    stem: "When responding to a security incident, which of the following approaches involves actively looking for security incidents?",
    choices: [
      "Passive response",
      "Active response",
      "Proactive response",
      "Reactive response"
    ],
    answer: 1
  },
  {
    id: 7,
    type: "tf",
    points: 10,
    stem: "When dealing with a difficult customer, it is better to validate someone's feelings rather than react to them.",
    answer: true
  },
  {
    id: 8,
    type: "mc",
    points: 10,
    stem: "Which of the following is considered regulated data that requires special handling?",
    choices: [
      "Public company information",
      "Personal government-issued information",
      "Open-source licensed software",
      "Public website content"
    ],
    answer: 1
  },
  {
    id: 9,
    type: "fitb",
    points: 10,
    stem: "After recovering from an incident, a(n) _____________ meeting should be held to review all documents and findings related to the incident.",
    acceptable: ["hot wash", "hotwash"],
    normalizer: normalizeText
  },
  {
    id: 10,
    type: "mc",
    points: 10,
    stem: "Which of the following remote access technologies is mentioned in the CompTIA A+ study materials?",
    choices: [
      "SSH",
      "RDP",
      "FTP",
      "HTTP"
    ],
    answer: 1
  }
];

function normalizeText(s) {
  return s.toLowerCase().replace(/\s+/g, ' ').trim().replace(/[\.,;:!?'\-"]/g, '');
}

/** DOM HELPERS **/
const el = sel => document.querySelector(sel);
const els = sel => Array.from(document.querySelectorAll(sel));

function renderQuestions() {
  const container = el('#questions');
  container.innerHTML = '';
  quiz.forEach((q, idx) => {
    const wrap = document.createElement('article');
    wrap.className = 'card';
    wrap.setAttribute('data-qid', q.id);

    const header = document.createElement('div');
    header.className = 'meta';
    header.innerHTML = `<span class="chip">Question ${idx + 1}</span><span class="chip">${q.points} pts</span>`;

    const h = document.createElement('h3');
    h.className = 'q';
    h.textContent = q.stem;

    const area = document.createElement('div');

    if (q.type === 'mc') {
      q.choices.forEach((c, i) => {
        const id = `q${q.id}_opt${i}`;
        const lab = document.createElement('label');
        lab.className = 'opt';
        lab.innerHTML = `<input type="radio" name="q${q.id}" id="${id}" value="${i}"><div>${String.fromCharCode(65 + i)}) ${c}</div>`;
        area.appendChild(lab);
      });
    }
    if (q.type === 'tf') {
      ["True", "False"].forEach((c, i) => {
        const id = `q${q.id}_tf${i}`;
        const lab = document.createElement('label');
        lab.className = 'opt';
        lab.innerHTML = `<input type="radio" name="q${q.id}" id="${id}" value="${i === 0}"><div>${c}</div>`;
        area.appendChild(lab);
      });
    }
    if (q.type === 'fitb') {
      const inp = document.createElement('input');
      inp.type = 'text';
      inp.className = 'answer-input';
      inp.placeholder = 'Type your answer...';
      inp.setAttribute('name', `q${q.id}`);
      area.appendChild(inp);
      const hint = document.createElement('div');
      hint.className = 'msg';
      hint.style.marginTop = '8px';
      hint.textContent = 'Short answer (not case sensitive)';
      area.appendChild(hint);
    }

    wrap.appendChild(header);
    wrap.appendChild(h);
    wrap.appendChild(area);
    container.appendChild(wrap);
  });
}

function getAnswers() {
  const answers = {};
  quiz.forEach(q => {
    if (q.type === 'fitb') {
      const v = el(`[name="q${q.id}"]`).value || '';
      answers[q.id] = v;
    } else {
      const picked = el(`input[name="q${q.id}"]:checked`);
      answers[q.id] = picked ? picked.value : null;
    }
  });
  return answers;
}

function setAnswers(answers) {
  quiz.forEach(q => {
    if (q.type === 'fitb') {
      el(`[name="q${q.id}"]`).value = answers?.[q.id] ?? '';
    } else if (q.type === 'tf') {
      const val = String(answers?.[q.id]);
      if (val !== 'null') {
        const inp = el(`input[name="q${q.id}"][value="${val}"]`);
        if (inp) inp.checked = true;
      }
    } else {
      const val = answers?.[q.id];
      if (val !== null && val !== undefined) {
        const inp = el(`input[name="q${q.id}"][value="${val}"]`);
        if (inp) inp.checked = true;
      }
    }
  });
}

function updateProgress() {
  const a = getAnswers();
  const answered = quiz.filter(q => {
    const v = a[q.id];
    if (q.type === 'fitb') return (v || '').trim().length > 0;
    return v !== null && v !== undefined;
  }).length;
  const pct = Math.round((answered / quiz.length) * 100);
  el('#progressBar').style.width = pct + '%';
  el('#progressText').textContent = `${answered} / ${quiz.length} answered`;
}

function grade() {
  const a = getAnswers();
  let total = 0;
  const details = [];

  quiz.forEach(q => {
    let correct = false;
    let correctVal = null;

    if (q.type === 'mc') {
      correct = String(a[q.id]) === String(q.answer);
      correctVal = q.choices[q.answer];
    } else if (q.type === 'tf') {
      correct = String(a[q.id]) === String(q.answer);
      correctVal = q.answer ? 'True' : 'False';
    } else if (q.type === 'fitb') {
      const user = q.normalizer ? q.normalizer(a[q.id] || '') : (a[q.id] || '').trim().toLowerCase();
      correct = q.acceptable.map(v => q.normalizer ? q.normalizer(v) : v.trim().toLowerCase()).includes(user);
      correctVal = q.acceptable[0];
    }

    const earned = correct ? q.points : 0;
    total += earned;
    details.push({
      id: q.id,
      correct,
      earned,
      points: q.points,
      stem: q.stem,
      user: a[q.id],
      correctVal
    });
  });

  return { total, details };
}

function showResults(r) {
  el('#results').classList.remove('hidden');
  const pct = Math.round((r.total / 100) * 100);
  el('#resultsSummary').innerHTML = `<strong>Final Score:</strong> ${r.total}/100 (${pct}%)`;
  const sd = el('#scoreDisplay');
  sd.textContent = `${r.total} / 100`;
  sd.className = 'score-display ' + (r.total >= 90 ? 'score-good' : r.total >= 70 ? 'score-mid' : 'score-bad');
  el('#scoreNote').textContent = 'Submitted';

  const list = el('#resultsList');
  list.innerHTML = '';
  r.details.forEach((d, i) => {
    const div = document.createElement('div');
    div.className = 'card ' + (d.correct ? 'result-correct' : 'result-wrong');
    const mark = d.correct
      ? `<span class="score-good">‚úî Correct</span>`
      : `<span class="score-bad">‚úñ Incorrect</span>`;

    const userLabel = (function() {
      const q = quiz.find(x => x.id === d.id);
      if (q.type === 'mc') {
        const idx = parseInt(d.user, 10);
        if (Number.isInteger(idx)) return `${String.fromCharCode(65 + idx)}) ${q.choices[idx]}`;
        return '<em>No answer</em>';
      }
      if (q.type === 'tf') {
        if (d.user === null || d.user === undefined) return '<em>No answer</em>';
        return (String(d.user) === 'true') ? 'True' : 'False';
      }
      if (q.type === 'fitb') {
        return d.user ? String(d.user) : '<em>No answer</em>';
      }
    })();

    const correctLabel = (function() {
      const q = quiz.find(x => x.id === d.id);
      if (q.type === 'mc') return `${String.fromCharCode(65 + q.answer)}) ${q.choices[q.answer]}`;
      if (q.type === 'tf') return q.answer ? 'True' : 'False';
      return d.correctVal;
    })();

    div.innerHTML = `
      <div class="meta"><span class="chip">Question ${i + 1}</span><span class="chip">${d.points} pts</span></div>
      <div class="q" style="font-size: 1rem;">${d.stem}</div>
      <div class="msg">Your answer: ${userLabel}</div>
      <div class="msg">Correct answer: <strong style="color: var(--good)">${correctLabel}</strong></div>
      <div style="margin-top: 8px">${mark} ‚Äî <span class="msg">${d.earned} / ${d.points} pts</span></div>
    `;
    list.appendChild(div);
  });
  window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
}

function reviewMode() {
  const r = grade();
  r.details.forEach(d => {
    const q = quiz.find(x => x.id === d.id);
    const holder = document.querySelector(`[data-qid="${d.id}"]`);
    if (q.type === 'mc' || q.type === 'tf') {
      const opts = holder.querySelectorAll('.opt');
      opts.forEach((lab, idx) => {
        lab.classList.remove('correct', 'wrong');
        if (q.type === 'mc') {
          if (idx === q.answer) lab.classList.add('correct');
          const radio = lab.querySelector('input');
          if (radio.checked && idx !== q.answer) lab.classList.add('wrong');
        } else if (q.type === 'tf') {
          const truth = idx === 0;
          if (truth === q.answer) lab.classList.add('correct');
          const radio = lab.querySelector('input');
          if (String(radio.value) !== String(q.answer) && radio.checked) lab.classList.add('wrong');
        }
      });
    } else if (q.type === 'fitb') {
      const inp = holder.querySelector('.answer-input');
      inp.style.borderColor = d.correct ? 'var(--good)' : 'var(--bad)';
    }
  });
}

function persist() {
  const payload = {
    remaining,
    answers: getAnswers(),
    submitted
  };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
}

function restore() {
  const raw = localStorage.getItem(STORAGE_KEY);
  if (!raw) return;
  try {
    const data = JSON.parse(raw);
    if (data.answers) setAnswers(data.answers);
    if (Number.isInteger(data.remaining)) remaining = data.remaining;
    submitted = !!data.submitted;
  } catch {}
}

function startTimer() {
  clearInterval(timerId);
  updateTimerDisplay();
  timerId = setInterval(() => {
    remaining--;
    if (remaining < 0) {
      remaining = 0;
      clearInterval(timerId);
      autoSubmit();
    }
    updateTimerDisplay();
    persist();
  }, 1000);
}

function updateTimerDisplay() {
  const m = String(Math.floor(remaining / 60)).padStart(2, '0');
  const s = String(remaining % 60).padStart(2, '0');
  const timerEl = el('#timer');
  timerEl.textContent = `${m}:${s}`;

  // Warning colors
  timerEl.classList.remove('warning', 'critical');
  if (remaining <= 60 && remaining > 30) timerEl.classList.add('warning');
  if (remaining <= 30) timerEl.classList.add('critical');
}

function autoSubmit() {
  if (submitted) return;
  const r = grade();
  submitted = true;
  showResults(r);
  reviewMode();
  persist();
  alert('Time is up! Your quiz has been submitted.');
}

function submitQuiz() {
  const r = grade();
  submitted = true;
  showResults(r);
  reviewMode();
  persist();
}

function resetAll() {
  if (!confirm('Reset quiz and clear saved progress?')) return;
  localStorage.removeItem(STORAGE_KEY);
  remaining = TOTAL_TIME_SECONDS;
  submitted = false;
  clearInterval(timerId);
  el('#timer').textContent = '30:00';
  el('#timer').classList.remove('warning', 'critical');
  renderQuestions();
  updateProgress();
  el('#results').classList.add('hidden');
  el('#scoreDisplay').textContent = '‚Äî';
  el('#scoreDisplay').className = 'score-display';
  el('#scoreNote').textContent = 'Not graded yet';
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function showAnswerKey() {
  const list = el('#resultsList');
  list.innerHTML = '';
  quiz.forEach((q, i) => {
    const div = document.createElement('div');
    div.className = 'card';
    const correct = (function() {
      if (q.type === 'mc') return `${String.fromCharCode(65 + q.answer)}) ${q.choices[q.answer]}`;
      if (q.type === 'tf') return q.answer ? 'True' : 'False';
      return q.acceptable[0];
    })();
    div.innerHTML = `
      <div class="meta"><span class="chip">Question ${i + 1}</span><span class="chip">${q.points} pts</span></div>
      <div class="q" style="font-size: 1rem;">${q.stem}</div>
      <div class="msg">Correct answer: <strong style="color: var(--good)">${correct}</strong></div>
    `;
    list.appendChild(div);
  });
}

/** EVENTS **/
window.addEventListener('load', () => {
  renderQuestions();
  restore();
  updateProgress();
  els('input, .answer-input').forEach(x => x.addEventListener('input', updateProgress));
});

addEventListener('input', e => {
  if (e.target.matches('input')) {
    updateProgress();
    persist();
  }
});

el('#startBtn').addEventListener('click', () => {
  if (timerId) {
    if (confirm('Timer is already running. Restart timer?')) {
      remaining = TOTAL_TIME_SECONDS;
    }
  }
  startTimer();
});

el('#submitBtn').addEventListener('click', submitQuiz);
el('#reviewBtn').addEventListener('click', () => { reviewMode(); window.scrollTo({ top: 0, behavior: 'smooth' }); });
el('#resetBtn').addEventListener('click', resetAll);
el('#retryBtn').addEventListener('click', () => { submitted = false; el('#results').classList.add('hidden'); reviewMode(); persist(); window.scrollTo({ top: 0, behavior: 'smooth' }); });
el('#showKeyBtn').addEventListener('click', showAnswerKey);
el('#printBtn').addEventListener('click', () => { window.print(); });

setInterval(updateProgress, 1500);
</script>
<script src="../../../components/FluxCapacitor.js"></script>
</body>
</html>
