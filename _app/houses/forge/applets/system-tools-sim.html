<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Tools Simulator - House of the Forge</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #0d0d12 0%, #1a1520 50%, #0d0d12 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #c4b5d4;
        }

        /* Header */
        .app-header {
            padding: 20px 40px;
            background: rgba(10, 10, 15, 0.9);
            border-bottom: 1px solid rgba(139, 92, 246, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn {
            padding: 8px 16px;
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 6px;
            color: #a78bfa;
            text-decoration: none;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(139, 92, 246, 0.2);
        }

        .app-title {
            font-size: 1.1rem;
            color: #e8d5f5;
            font-weight: 400;
        }

        .house-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75rem;
            color: #8b7a9e;
            letter-spacing: 0.1em;
        }

        /* Main Content */
        .main-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Mode Selector */
        .mode-bar {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 12px 24px;
            background: rgba(30, 25, 40, 0.6);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 8px;
            color: #c4b5d4;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn:hover {
            background: rgba(139, 92, 246, 0.1);
            border-color: rgba(139, 92, 246, 0.4);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            border-color: transparent;
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(20, 15, 30, 0.6);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 12px;
            flex-wrap: wrap;
        }

        .stat-item {
            flex: 1;
            text-align: center;
            min-width: 150px;
        }

        .stat-value {
            font-size: 1.5rem;
            color: #a78bfa;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #6b5b7e;
            letter-spacing: 0.1em;
        }

        /* Mode Containers */
        .mode-container {
            display: none;
        }

        .mode-container.active {
            display: block;
        }

        /* ==================== TASK MANAGER ==================== */

        .window-container {
            background: rgba(20, 15, 30, 0.9);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .window-title-bar {
            background: linear-gradient(180deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.1));
            border-bottom: 1px solid rgba(139, 92, 246, 0.3);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .window-title {
            font-size: 0.9rem;
            color: #e8d5f5;
        }

        .window-controls {
            display: flex;
            gap: 8px;
        }

        .window-control-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .window-control-btn.minimize { background: #fbbf24; }
        .window-control-btn.maximize { background: #34d399; }
        .window-control-btn.close { background: #ef4444; }

        .window-control-btn:hover {
            opacity: 0.7;
        }

        .tabs-container {
            background: rgba(10, 10, 15, 0.8);
            border-bottom: 1px solid rgba(139, 92, 246, 0.2);
            padding: 0 15px;
            display: flex;
            gap: 5px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            color: #8b7a9e;
            font-size: 0.85rem;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab:hover {
            background: rgba(139, 92, 246, 0.1);
            color: #a78bfa;
        }

        .tab.active {
            color: #e8d5f5;
            border-bottom-color: #8b5cf6;
        }

        .tab-content {
            display: none;
            padding: 20px;
        }

        .tab-content.active {
            display: block;
        }

        /* Process Table */
        .process-table-container {
            background: rgba(10, 10, 15, 0.5);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 8px;
            overflow: hidden;
        }

        .process-table {
            width: 100%;
            border-collapse: collapse;
        }

        .process-table thead {
            background: rgba(139, 92, 246, 0.1);
            position: sticky;
            top: 0;
        }

        .process-table th {
            padding: 12px;
            text-align: left;
            font-size: 0.85rem;
            color: #a78bfa;
            font-weight: 500;
            border-bottom: 1px solid rgba(139, 92, 246, 0.2);
            cursor: pointer;
            user-select: none;
        }

        .process-table th:hover {
            background: rgba(139, 92, 246, 0.15);
        }

        .process-table th::after {
            content: ' ▼';
            font-size: 0.7rem;
            opacity: 0.3;
        }

        .process-table th.sort-asc::after {
            content: ' ▲';
            opacity: 1;
        }

        .process-table th.sort-desc::after {
            content: ' ▼';
            opacity: 1;
        }

        .process-table tbody tr {
            border-bottom: 1px solid rgba(139, 92, 246, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .process-table tbody tr:hover {
            background: rgba(139, 92, 246, 0.05);
        }

        .process-table tbody tr.selected {
            background: rgba(139, 92, 246, 0.2);
        }

        .process-table tbody tr.high-cpu {
            background: rgba(239, 68, 68, 0.1);
        }

        .process-table td {
            padding: 10px 12px;
            font-size: 0.8rem;
            color: #c4b5d4;
        }

        .process-name {
            font-weight: 500;
            color: #e8d5f5;
        }

        .cpu-high {
            color: #ef4444;
            font-weight: 600;
        }

        .cpu-medium {
            color: #fbbf24;
        }

        .cpu-low {
            color: #34d399;
        }

        /* Process Actions */
        .process-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .action-btn {
            padding: 8px 16px;
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 6px;
            color: #a78bfa;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn:hover:not(:disabled) {
            background: rgba(139, 92, 246, 0.2);
            border-color: rgba(139, 92, 246, 0.5);
        }

        .action-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .action-btn.danger {
            border-color: rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        .action-btn.danger:hover:not(:disabled) {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.5);
        }

        /* Performance Graphs */
        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .performance-card {
            background: rgba(10, 10, 15, 0.5);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 8px;
            padding: 20px;
        }

        .performance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .performance-title {
            font-size: 0.9rem;
            color: #a78bfa;
            font-weight: 500;
        }

        .performance-value {
            font-size: 1.5rem;
            color: #e8d5f5;
            font-weight: 600;
        }

        .graph-canvas {
            width: 100%;
            height: 150px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(139, 92, 246, 0.1);
            border-radius: 6px;
        }

        .performance-stats {
            margin-top: 15px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            padding: 5px 0;
        }

        .stat-row .label {
            color: #8b7a9e;
        }

        .stat-row .value {
            color: #e8d5f5;
            font-weight: 500;
        }

        /* Startup Apps */
        .startup-list {
            background: rgba(10, 10, 15, 0.5);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 8px;
            overflow: hidden;
        }

        .startup-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid rgba(139, 92, 246, 0.1);
            transition: all 0.2s ease;
        }

        .startup-item:hover {
            background: rgba(139, 92, 246, 0.05);
        }

        .startup-info {
            flex: 1;
        }

        .startup-name {
            font-size: 0.9rem;
            color: #e8d5f5;
            font-weight: 500;
            margin-bottom: 3px;
        }

        .startup-publisher {
            font-size: 0.75rem;
            color: #8b7a9e;
        }

        .startup-impact {
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-right: 15px;
        }

        .impact-high {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .impact-medium {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .impact-low {
            background: rgba(52, 211, 153, 0.2);
            color: #34d399;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: rgba(139, 92, 246, 0.2);
            border-radius: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .toggle-switch.active {
            background: rgba(52, 211, 153, 0.3);
            border-color: rgba(52, 211, 153, 0.5);
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: #8b7a9e;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .toggle-switch.active .toggle-slider {
            left: 26px;
            background: #34d399;
        }

        /* Resource Monitor */
        .resource-monitor-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .resource-tab {
            padding: 10px 20px;
            background: rgba(30, 25, 40, 0.6);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 6px;
            color: #c4b5d4;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .resource-tab:hover {
            background: rgba(139, 92, 246, 0.1);
        }

        .resource-tab.active {
            background: rgba(139, 92, 246, 0.2);
            border-color: rgba(139, 92, 246, 0.5);
            color: #e8d5f5;
        }

        /* System Information */
        .sysinfo-grid {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
            height: 600px;
        }

        .sysinfo-tree {
            background: rgba(10, 10, 15, 0.5);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 8px;
            padding: 15px;
            overflow-y: auto;
        }

        .tree-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.85rem;
            color: #c4b5d4;
            border-radius: 4px;
            transition: all 0.2s ease;
            user-select: none;
        }

        .tree-item:hover {
            background: rgba(139, 92, 246, 0.1);
        }

        .tree-item.active {
            background: rgba(139, 92, 246, 0.2);
            color: #e8d5f5;
        }

        .tree-item.expandable::before {
            content: '▶ ';
            display: inline-block;
            transition: transform 0.2s ease;
        }

        .tree-item.expandable.expanded::before {
            transform: rotate(90deg);
        }

        .tree-item.child {
            margin-left: 20px;
        }

        .sysinfo-details {
            background: rgba(10, 10, 15, 0.5);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 8px;
            padding: 20px;
            overflow-y: auto;
        }

        .info-section {
            margin-bottom: 20px;
        }

        .info-section-title {
            font-size: 1rem;
            color: #a78bfa;
            font-weight: 500;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(139, 92, 246, 0.2);
        }

        .info-row {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 15px;
            padding: 8px 0;
            font-size: 0.85rem;
        }

        .info-label {
            color: #8b7a9e;
        }

        .info-value {
            color: #e8d5f5;
            font-weight: 500;
        }

        /* Scenarios */
        .scenarios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .scenario-card {
            background: rgba(30, 25, 40, 0.6);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 12px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scenario-card:hover {
            background: rgba(139, 92, 246, 0.1);
            border-color: rgba(139, 92, 246, 0.4);
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(139, 92, 246, 0.2);
        }

        .scenario-card.completed {
            border-color: rgba(52, 211, 153, 0.3);
        }

        .scenario-icon {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .scenario-title {
            font-size: 1rem;
            color: #e8d5f5;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .scenario-desc {
            font-size: 0.85rem;
            color: #8b7a9e;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .scenario-difficulty {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(139, 92, 246, 0.2);
            border-radius: 4px;
            font-size: 0.75rem;
            color: #a78bfa;
        }

        .scenario-difficulty.easy {
            background: rgba(52, 211, 153, 0.2);
            color: #34d399;
        }

        .scenario-difficulty.medium {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .scenario-difficulty.hard {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        /* Tooltip */
        .tooltip {
            position: fixed;
            background: rgba(139, 92, 246, 0.95);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            pointer-events: none;
            z-index: 10000;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1520, #0d0d12);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .modal-title {
            font-size: 1.2rem;
            color: #e8d5f5;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .modal-body {
            color: #c4b5d4;
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(10, 10, 15, 0.5);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(139, 92, 246, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(139, 92, 246, 0.5);
        }
    </style>
</head>
<body>
    <div class="app-header">
        <div class="header-left">
            <a href="../forge-dashboard.html" class="back-btn">← Back to Forge</a>
            <h1 class="app-title">System Tools Simulator</h1>
        </div>
        <div class="house-badge">
            <span>⚒️</span>
            <span>HOUSE OF THE FORGE</span>
        </div>
    </div>

    <div class="main-content">
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="toolsExplored">0</div>
                <div class="stat-label">TOOLS EXPLORED</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="scenariosCompleted">0</div>
                <div class="stat-label">SCENARIOS COMPLETED</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="processesEnded">0</div>
                <div class="stat-label">PROCESSES ENDED</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="progressPercent">0%</div>
                <div class="stat-label">OVERALL PROGRESS</div>
            </div>
        </div>

        <div class="mode-bar">
            <button class="mode-btn active" onclick="switchMode('taskmanager')">Task Manager</button>
            <button class="mode-btn" onclick="switchMode('resourcemonitor')">Resource Monitor</button>
            <button class="mode-btn" onclick="switchMode('systeminfo')">System Information</button>
            <button class="mode-btn" onclick="switchMode('scenarios')">Interactive Scenarios</button>
        </div>

        <!-- TASK MANAGER MODE -->
        <div id="taskmanager" class="mode-container active">
            <div class="window-container">
                <div class="window-title-bar">
                    <div class="window-title">Task Manager</div>
                    <div class="window-controls">
                        <div class="window-control-btn minimize"></div>
                        <div class="window-control-btn maximize"></div>
                        <div class="window-control-btn close"></div>
                    </div>
                </div>

                <div class="tabs-container">
                    <div class="tab active" onclick="switchTaskManagerTab('processes')">Processes</div>
                    <div class="tab" onclick="switchTaskManagerTab('performance')">Performance</div>
                    <div class="tab" onclick="switchTaskManagerTab('startup')">Startup</div>
                    <div class="tab" onclick="switchTaskManagerTab('users')">Users</div>
                </div>

                <!-- Processes Tab -->
                <div id="processes-tab" class="tab-content active">
                    <div class="process-table-container">
                        <table class="process-table">
                            <thead>
                                <tr>
                                    <th onclick="sortProcesses('name')">Name</th>
                                    <th onclick="sortProcesses('cpu')">CPU</th>
                                    <th onclick="sortProcesses('memory')">Memory</th>
                                    <th onclick="sortProcesses('disk')">Disk</th>
                                    <th onclick="sortProcesses('network')">Network</th>
                                    <th onclick="sortProcesses('pid')">PID</th>
                                </tr>
                            </thead>
                            <tbody id="processTableBody">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <div class="process-actions">
                        <button class="action-btn" id="detailsBtn" onclick="showProcessDetails()" disabled>Details</button>
                        <button class="action-btn danger" id="endTaskBtn" onclick="endTask()" disabled>End Task</button>
                    </div>
                </div>

                <!-- Performance Tab -->
                <div id="performance-tab" class="tab-content">
                    <div class="performance-grid">
                        <div class="performance-card">
                            <div class="performance-header">
                                <div class="performance-title">CPU</div>
                                <div class="performance-value" id="cpuValue">0%</div>
                            </div>
                            <canvas id="cpuGraph" class="graph-canvas"></canvas>
                            <div class="performance-stats">
                                <div class="stat-row">
                                    <span class="label">Utilization</span>
                                    <span class="value" id="cpuUtilization">0%</span>
                                </div>
                                <div class="stat-row">
                                    <span class="label">Speed</span>
                                    <span class="value">3.60 GHz</span>
                                </div>
                                <div class="stat-row">
                                    <span class="label">Processes</span>
                                    <span class="value" id="processCount">0</span>
                                </div>
                                <div class="stat-row">
                                    <span class="label">Threads</span>
                                    <span class="value" id="threadCount">0</span>
                                </div>
                            </div>
                        </div>

                        <div class="performance-card">
                            <div class="performance-header">
                                <div class="performance-title">Memory</div>
                                <div class="performance-value" id="memoryValue">0 GB</div>
                            </div>
                            <canvas id="memoryGraph" class="graph-canvas"></canvas>
                            <div class="performance-stats">
                                <div class="stat-row">
                                    <span class="label">In Use</span>
                                    <span class="value" id="memoryInUse">0 GB</span>
                                </div>
                                <div class="stat-row">
                                    <span class="label">Available</span>
                                    <span class="value" id="memoryAvailable">0 GB</span>
                                </div>
                                <div class="stat-row">
                                    <span class="label">Committed</span>
                                    <span class="value" id="memoryCommitted">0 GB</span>
                                </div>
                                <div class="stat-row">
                                    <span class="label">Cached</span>
                                    <span class="value" id="memoryCached">0 GB</span>
                                </div>
                            </div>
                        </div>

                        <div class="performance-card">
                            <div class="performance-header">
                                <div class="performance-title">Disk</div>
                                <div class="performance-value" id="diskValue">0%</div>
                            </div>
                            <canvas id="diskGraph" class="graph-canvas"></canvas>
                            <div class="performance-stats">
                                <div class="stat-row">
                                    <span class="label">Active Time</span>
                                    <span class="value" id="diskActiveTime">0%</span>
                                </div>
                                <div class="stat-row">
                                    <span class="label">Read Speed</span>
                                    <span class="value" id="diskRead">0 MB/s</span>
                                </div>
                                <div class="stat-row">
                                    <span class="label">Write Speed</span>
                                    <span class="value" id="diskWrite">0 MB/s</span>
                                </div>
                                <div class="stat-row">
                                    <span class="label">Capacity</span>
                                    <span class="value">512 GB</span>
                                </div>
                            </div>
                        </div>

                        <div class="performance-card">
                            <div class="performance-header">
                                <div class="performance-title">Network</div>
                                <div class="performance-value" id="networkValue">0 Mbps</div>
                            </div>
                            <canvas id="networkGraph" class="graph-canvas"></canvas>
                            <div class="performance-stats">
                                <div class="stat-row">
                                    <span class="label">Send</span>
                                    <span class="value" id="networkSend">0 Mbps</span>
                                </div>
                                <div class="stat-row">
                                    <span class="label">Receive</span>
                                    <span class="value" id="networkReceive">0 Mbps</span>
                                </div>
                                <div class="stat-row">
                                    <span class="label">Adapter</span>
                                    <span class="value">Ethernet</span>
                                </div>
                                <div class="stat-row">
                                    <span class="label">Link Speed</span>
                                    <span class="value">1 Gbps</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Startup Tab -->
                <div id="startup-tab" class="tab-content">
                    <div class="startup-list" id="startupList">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Users Tab -->
                <div id="users-tab" class="tab-content">
                    <div class="process-table-container">
                        <table class="process-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Status</th>
                                    <th>CPU</th>
                                    <th>Memory</th>
                                    <th>Session ID</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="process-name">Hexworth\Student</td>
                                    <td>Active</td>
                                    <td class="cpu-low">5%</td>
                                    <td>2.4 GB</td>
                                    <td>1</td>
                                </tr>
                                <tr>
                                    <td class="process-name">SYSTEM</td>
                                    <td>Running</td>
                                    <td class="cpu-low">1%</td>
                                    <td>0.5 GB</td>
                                    <td>0</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- RESOURCE MONITOR MODE -->
        <div id="resourcemonitor" class="mode-container">
            <div class="window-container">
                <div class="window-title-bar">
                    <div class="window-title">Resource Monitor</div>
                    <div class="window-controls">
                        <div class="window-control-btn minimize"></div>
                        <div class="window-control-btn maximize"></div>
                        <div class="window-control-btn close"></div>
                    </div>
                </div>

                <div class="resource-monitor-tabs">
                    <button class="resource-tab active" onclick="switchResourceTab('overview')">Overview</button>
                    <button class="resource-tab" onclick="switchResourceTab('cpu')">CPU</button>
                    <button class="resource-tab" onclick="switchResourceTab('memory')">Memory</button>
                    <button class="resource-tab" onclick="switchResourceTab('disk')">Disk</button>
                    <button class="resource-tab" onclick="switchResourceTab('network')">Network</button>
                </div>

                <div id="overview-resource" class="tab-content active">
                    <div class="performance-grid">
                        <div class="performance-card">
                            <div class="performance-header">
                                <div class="performance-title">CPU Usage</div>
                                <div class="performance-value" id="rmCpuValue">0%</div>
                            </div>
                            <canvas id="rmCpuGraph" class="graph-canvas"></canvas>
                        </div>
                        <div class="performance-card">
                            <div class="performance-header">
                                <div class="performance-title">Disk I/O</div>
                                <div class="performance-value" id="rmDiskValue">0 KB/s</div>
                            </div>
                            <canvas id="rmDiskGraph" class="graph-canvas"></canvas>
                        </div>
                        <div class="performance-card">
                            <div class="performance-header">
                                <div class="performance-title">Network Activity</div>
                                <div class="performance-value" id="rmNetworkValue">0 KB/s</div>
                            </div>
                            <canvas id="rmNetworkGraph" class="graph-canvas"></canvas>
                        </div>
                        <div class="performance-card">
                            <div class="performance-header">
                                <div class="performance-title">Memory Usage</div>
                                <div class="performance-value" id="rmMemoryValue">0 GB</div>
                            </div>
                            <canvas id="rmMemoryGraph" class="graph-canvas"></canvas>
                        </div>
                    </div>
                </div>

                <div id="cpu-resource" class="tab-content">
                    <div class="process-table-container">
                        <table class="process-table">
                            <thead>
                                <tr>
                                    <th>Process</th>
                                    <th>PID</th>
                                    <th>CPU</th>
                                    <th>Average CPU</th>
                                    <th>Threads</th>
                                </tr>
                            </thead>
                            <tbody id="cpuResourceTable">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="memory-resource" class="tab-content">
                    <div class="process-table-container">
                        <table class="process-table">
                            <thead>
                                <tr>
                                    <th>Process</th>
                                    <th>PID</th>
                                    <th>Working Set (MB)</th>
                                    <th>Private (MB)</th>
                                    <th>Shareable (MB)</th>
                                </tr>
                            </thead>
                            <tbody id="memoryResourceTable">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="disk-resource" class="tab-content">
                    <div class="process-table-container">
                        <table class="process-table">
                            <thead>
                                <tr>
                                    <th>Process</th>
                                    <th>PID</th>
                                    <th>Read (B/sec)</th>
                                    <th>Write (B/sec)</th>
                                    <th>Total (B/sec)</th>
                                </tr>
                            </thead>
                            <tbody id="diskResourceTable">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="network-resource" class="tab-content">
                    <div class="process-table-container">
                        <table class="process-table">
                            <thead>
                                <tr>
                                    <th>Process</th>
                                    <th>PID</th>
                                    <th>Send (B/sec)</th>
                                    <th>Receive (B/sec)</th>
                                    <th>Total (B/sec)</th>
                                </tr>
                            </thead>
                            <tbody id="networkResourceTable">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- SYSTEM INFORMATION MODE -->
        <div id="systeminfo" class="mode-container">
            <div class="window-container">
                <div class="window-title-bar">
                    <div class="window-title">System Information</div>
                    <div class="window-controls">
                        <div class="window-control-btn minimize"></div>
                        <div class="window-control-btn maximize"></div>
                        <div class="window-control-btn close"></div>
                    </div>
                </div>

                <div class="tab-content active" style="display: block;">
                    <div class="sysinfo-grid">
                        <div class="sysinfo-tree" id="sysinfoTree">
                            <!-- Populated by JavaScript -->
                        </div>
                        <div class="sysinfo-details" id="sysinfoDetails">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SCENARIOS MODE -->
        <div id="scenarios" class="mode-container">
            <div class="scenarios-grid" id="scenariosGrid">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle"></div>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-actions">
                <button class="action-btn" onclick="closeModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== STATE ====================

        let processes = [];
        let selectedProcess = null;
        let exploredTools = new Set();
        let completedScenarios = new Set();
        let processesEnded = 0;
        let currentSort = { column: 'cpu', direction: 'desc' };

        // Performance graph data
        const graphData = {
            cpu: [],
            memory: [],
            disk: [],
            network: []
        };

        const maxGraphPoints = 60;

        // ==================== INITIALIZATION ====================

        function init() {
            loadProgress();
            generateProcesses();
            renderProcessTable();
            renderStartupApps();
            renderSystemInfo();
            renderScenarios();
            renderResourceTables();
            updateStats();
            initGraphs();
            startPerformanceMonitoring();

            // Mark task manager as explored on load
            exploredTools.add('taskmanager');
            saveProgress();
        }

        // ==================== PROCESS GENERATION ====================

        function generateProcesses() {
            const processTemplates = [
                { name: 'System', cpu: 0.5, memory: 512, disk: 0, network: 0, critical: true },
                { name: 'svchost.exe', cpu: 1.2, memory: 128, disk: 0.1, network: 0.5 },
                { name: 'chrome.exe', cpu: 8.5, memory: 1024, disk: 0.3, network: 2.5 },
                { name: 'explorer.exe', cpu: 2.1, memory: 256, disk: 0.2, network: 0 },
                { name: 'Discord.exe', cpu: 3.2, memory: 512, disk: 0.4, network: 1.2 },
                { name: 'Code.exe', cpu: 15.4, memory: 768, disk: 0.8, network: 0.3 },
                { name: 'MalwareX.exe', cpu: 87.3, memory: 2048, disk: 5.2, network: 8.7, malware: true },
                { name: 'Windows Defender', cpu: 1.8, memory: 384, disk: 0.5, network: 0.1 },
                { name: 'Steam.exe', cpu: 4.2, memory: 640, disk: 1.1, network: 0.8 },
                { name: 'spotify.exe', cpu: 2.5, memory: 320, disk: 0.2, network: 0.6 },
                { name: 'dwm.exe', cpu: 3.1, memory: 192, disk: 0, network: 0 },
                { name: 'csrss.exe', cpu: 0.8, memory: 64, disk: 0, network: 0, critical: true },
                { name: 'lsass.exe', cpu: 0.3, memory: 32, disk: 0, network: 0, critical: true },
                { name: 'RuntimeBroker.exe', cpu: 1.5, memory: 128, disk: 0.1, network: 0 },
                { name: 'SearchIndexer.exe', cpu: 2.8, memory: 256, disk: 1.5, network: 0 },
                { name: 'OneDrive.exe', cpu: 1.2, memory: 192, disk: 0.3, network: 0.4 },
                { name: 'Teams.exe', cpu: 5.6, memory: 896, disk: 0.4, network: 1.8 },
                { name: 'winlogon.exe', cpu: 0.2, memory: 16, disk: 0, network: 0, critical: true },
                { name: 'taskhostw.exe', cpu: 0.9, memory: 64, disk: 0.1, network: 0 },
                { name: 'spoolsv.exe', cpu: 0.4, memory: 48, disk: 0.2, network: 0 }
            ];

            processes = processTemplates.map((template, index) => ({
                ...template,
                pid: 1000 + index * 4,
                startTime: Date.now() - Math.random() * 3600000,
                threads: Math.floor(Math.random() * 20) + 4
            }));
        }

        // ==================== PROCESS TABLE ====================

        function renderProcessTable() {
            const tbody = document.getElementById('processTableBody');
            tbody.innerHTML = '';

            // Sort processes
            const sorted = [...processes].sort((a, b) => {
                const col = currentSort.column;
                const dir = currentSort.direction === 'asc' ? 1 : -1;

                if (col === 'name') {
                    return a.name.localeCompare(b.name) * dir;
                } else {
                    return (a[col] - b[col]) * dir;
                }
            });

            sorted.forEach(process => {
                const tr = document.createElement('tr');
                tr.onclick = () => selectProcess(process);

                if (process.malware) {
                    tr.classList.add('high-cpu');
                }

                if (selectedProcess && selectedProcess.pid === process.pid) {
                    tr.classList.add('selected');
                }

                const cpuClass = process.cpu > 50 ? 'cpu-high' : process.cpu > 10 ? 'cpu-medium' : 'cpu-low';

                tr.innerHTML = `
                    <td class="process-name">${process.name}</td>
                    <td class="${cpuClass}">${process.cpu.toFixed(1)}%</td>
                    <td>${(process.memory / 1024).toFixed(1)} GB</td>
                    <td>${process.disk.toFixed(1)} MB/s</td>
                    <td>${process.network.toFixed(1)} Mbps</td>
                    <td>${process.pid}</td>
                `;

                tbody.appendChild(tr);
            });
        }

        function selectProcess(process) {
            selectedProcess = process;
            renderProcessTable();

            document.getElementById('detailsBtn').disabled = false;
            document.getElementById('endTaskBtn').disabled = false;
        }

        function sortProcesses(column) {
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'desc';
            }

            // Update header classes
            document.querySelectorAll('.process-table th').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });

            const th = event.target;
            th.classList.add(currentSort.direction === 'asc' ? 'sort-asc' : 'sort-desc');

            renderProcessTable();
        }

        function showProcessDetails() {
            if (!selectedProcess) return;

            const uptime = Math.floor((Date.now() - selectedProcess.startTime) / 1000);
            const hours = Math.floor(uptime / 3600);
            const minutes = Math.floor((uptime % 3600) / 60);
            const seconds = uptime % 60;

            showModal('Process Details', `
                <div class="info-section">
                    <div class="info-row">
                        <div class="info-label">Process Name</div>
                        <div class="info-value">${selectedProcess.name}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">PID</div>
                        <div class="info-value">${selectedProcess.pid}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">CPU Usage</div>
                        <div class="info-value">${selectedProcess.cpu.toFixed(1)}%</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Memory</div>
                        <div class="info-value">${(selectedProcess.memory / 1024).toFixed(2)} GB</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Threads</div>
                        <div class="info-value">${selectedProcess.threads}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Uptime</div>
                        <div class="info-value">${hours}h ${minutes}m ${seconds}s</div>
                    </div>
                    ${selectedProcess.malware ? '<div class="info-row"><div class="info-label">Status</div><div class="info-value" style="color: #ef4444;">⚠️ Suspicious Activity Detected</div></div>' : ''}
                </div>
            `);
        }

        function endTask() {
            if (!selectedProcess) return;

            if (selectedProcess.critical) {
                showModal('Cannot End Task', 'This is a critical system process. Ending it would cause system instability.');
                return;
            }

            if (selectedProcess.malware) {
                completedScenarios.add('find-high-cpu');
                checkScenarioCompletion('find-high-cpu');
            }

            const processName = selectedProcess.name;
            processes = processes.filter(p => p.pid !== selectedProcess.pid);
            selectedProcess = null;

            processesEnded++;
            saveProgress();
            updateStats();
            renderProcessTable();

            document.getElementById('detailsBtn').disabled = true;
            document.getElementById('endTaskBtn').disabled = true;

            showTooltip(event, `${processName} has been terminated`);
        }

        // ==================== STARTUP APPS ====================

        const startupApps = [
            { name: 'Discord', publisher: 'Discord Inc.', impact: 'medium', enabled: true },
            { name: 'Steam', publisher: 'Valve Corporation', impact: 'high', enabled: true },
            { name: 'OneDrive', publisher: 'Microsoft Corporation', impact: 'medium', enabled: true },
            { name: 'Adobe Creative Cloud', publisher: 'Adobe Systems', impact: 'high', enabled: false },
            { name: 'Spotify', publisher: 'Spotify AB', impact: 'low', enabled: true },
            { name: 'Windows Security', publisher: 'Microsoft Corporation', impact: 'low', enabled: true },
            { name: 'NVIDIA GeForce Experience', publisher: 'NVIDIA Corporation', impact: 'medium', enabled: true },
            { name: 'Malicious Autostart', publisher: 'Unknown Publisher', impact: 'high', enabled: true, malware: true },
            { name: 'Realtek HD Audio Manager', publisher: 'Realtek', impact: 'low', enabled: false },
            { name: 'Intel Graphics Command Center', publisher: 'Intel Corporation', impact: 'medium', enabled: true }
        ];

        function renderStartupApps() {
            const list = document.getElementById('startupList');
            list.innerHTML = '';

            startupApps.forEach((app, index) => {
                const item = document.createElement('div');
                item.className = 'startup-item';

                item.innerHTML = `
                    <div class="startup-info">
                        <div class="startup-name">${app.name}${app.malware ? ' ⚠️' : ''}</div>
                        <div class="startup-publisher">${app.publisher}</div>
                    </div>
                    <div class="startup-impact impact-${app.impact}">${app.impact.charAt(0).toUpperCase() + app.impact.slice(1)} impact</div>
                    <div class="toggle-switch ${app.enabled ? 'active' : ''}" onclick="toggleStartup(${index})">
                        <div class="toggle-slider"></div>
                    </div>
                `;

                list.appendChild(item);
            });
        }

        function toggleStartup(index) {
            startupApps[index].enabled = !startupApps[index].enabled;
            renderStartupApps();

            if (startupApps[index].malware && !startupApps[index].enabled) {
                completedScenarios.add('disable-malware-startup');
                checkScenarioCompletion('disable-malware-startup');
            }

            const action = startupApps[index].enabled ? 'enabled' : 'disabled';
            showTooltip(event, `${startupApps[index].name} ${action}`);
        }

        // ==================== PERFORMANCE GRAPHS ====================

        function initGraphs() {
            // Initialize graph data
            for (let i = 0; i < maxGraphPoints; i++) {
                graphData.cpu.push(Math.random() * 20 + 5);
                graphData.memory.push(Math.random() * 4 + 2);
                graphData.disk.push(Math.random() * 10);
                graphData.network.push(Math.random() * 5);
            }

            drawGraph('cpuGraph', graphData.cpu, '#8b5cf6', 100);
            drawGraph('memoryGraph', graphData.memory, '#34d399', 16);
            drawGraph('diskGraph', graphData.disk, '#fbbf24', 100);
            drawGraph('networkGraph', graphData.network, '#06b6d4', 100);

            drawGraph('rmCpuGraph', graphData.cpu, '#8b5cf6', 100);
            drawGraph('rmMemoryGraph', graphData.memory, '#34d399', 16);
            drawGraph('rmDiskGraph', graphData.disk, '#fbbf24', 100);
            drawGraph('rmNetworkGraph', graphData.network, '#06b6d4', 100);
        }

        function drawGraph(canvasId, data, color, max) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = canvas.offsetHeight;

            ctx.clearRect(0, 0, width, height);

            // Draw grid
            ctx.strokeStyle = 'rgba(139, 92, 246, 0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = (height / 4) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }

            // Draw graph line
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.beginPath();

            const pointSpacing = width / (data.length - 1);

            data.forEach((value, index) => {
                const x = index * pointSpacing;
                const y = height - (value / max) * height;

                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });

            ctx.stroke();

            // Fill area under line
            ctx.lineTo(width, height);
            ctx.lineTo(0, height);
            ctx.closePath();
            ctx.fillStyle = color.replace(')', ', 0.1)').replace('rgb', 'rgba');
            ctx.fill();
        }

        function startPerformanceMonitoring() {
            setInterval(() => {
                // Update CPU
                const totalCpu = processes.reduce((sum, p) => sum + p.cpu, 0);
                const cpuValue = Math.min(totalCpu, 100);
                graphData.cpu.shift();
                graphData.cpu.push(cpuValue);

                // Update Memory
                const totalMemory = processes.reduce((sum, p) => sum + p.memory, 0) / 1024;
                graphData.memory.shift();
                graphData.memory.push(totalMemory);

                // Update Disk
                const totalDisk = processes.reduce((sum, p) => sum + p.disk, 0);
                graphData.disk.shift();
                graphData.disk.push(totalDisk);

                // Update Network
                const totalNetwork = processes.reduce((sum, p) => sum + p.network, 0);
                graphData.network.shift();
                graphData.network.push(totalNetwork);

                // Simulate fluctuations in processes
                processes.forEach(p => {
                    if (!p.malware) {
                        p.cpu = Math.max(0, p.cpu + (Math.random() - 0.5) * 2);
                        p.memory = Math.max(0, p.memory + (Math.random() - 0.5) * 10);
                        p.disk = Math.max(0, p.disk + (Math.random() - 0.5) * 0.5);
                        p.network = Math.max(0, p.network + (Math.random() - 0.5) * 0.3);
                    }
                });

                // Update displays
                updatePerformanceDisplays();
                renderProcessTable();

                // Redraw graphs
                drawGraph('cpuGraph', graphData.cpu, '#8b5cf6', 100);
                drawGraph('memoryGraph', graphData.memory, '#34d399', 16);
                drawGraph('diskGraph', graphData.disk, '#fbbf24', 100);
                drawGraph('networkGraph', graphData.network, '#06b6d4', 100);

                drawGraph('rmCpuGraph', graphData.cpu, '#8b5cf6', 100);
                drawGraph('rmMemoryGraph', graphData.memory, '#34d399', 16);
                drawGraph('rmDiskGraph', graphData.disk, '#fbbf24', 100);
                drawGraph('rmNetworkGraph', graphData.network, '#06b6d4', 100);

            }, 1000);
        }

        function updatePerformanceDisplays() {
            const cpu = graphData.cpu[graphData.cpu.length - 1];
            const memory = graphData.memory[graphData.memory.length - 1];
            const disk = graphData.disk[graphData.disk.length - 1];
            const network = graphData.network[graphData.network.length - 1];

            document.getElementById('cpuValue').textContent = cpu.toFixed(1) + '%';
            document.getElementById('cpuUtilization').textContent = cpu.toFixed(1) + '%';
            document.getElementById('processCount').textContent = processes.length;
            document.getElementById('threadCount').textContent = processes.reduce((sum, p) => sum + p.threads, 0);

            document.getElementById('memoryValue').textContent = memory.toFixed(1) + ' GB';
            document.getElementById('memoryInUse').textContent = memory.toFixed(1) + ' GB';
            document.getElementById('memoryAvailable').textContent = (16 - memory).toFixed(1) + ' GB';
            document.getElementById('memoryCommitted').textContent = (memory * 1.2).toFixed(1) + ' GB';
            document.getElementById('memoryCached').textContent = (memory * 0.3).toFixed(1) + ' GB';

            document.getElementById('diskValue').textContent = disk.toFixed(1) + '%';
            document.getElementById('diskActiveTime').textContent = disk.toFixed(1) + '%';
            document.getElementById('diskRead').textContent = (disk * 0.6).toFixed(1) + ' MB/s';
            document.getElementById('diskWrite').textContent = (disk * 0.4).toFixed(1) + ' MB/s';

            document.getElementById('networkValue').textContent = network.toFixed(1) + ' Mbps';
            document.getElementById('networkSend').textContent = (network * 0.3).toFixed(1) + ' Mbps';
            document.getElementById('networkReceive').textContent = (network * 0.7).toFixed(1) + ' Mbps';

            // Resource Monitor displays
            document.getElementById('rmCpuValue').textContent = cpu.toFixed(1) + '%';
            document.getElementById('rmMemoryValue').textContent = memory.toFixed(1) + ' GB';
            document.getElementById('rmDiskValue').textContent = disk.toFixed(1) + ' KB/s';
            document.getElementById('rmNetworkValue').textContent = network.toFixed(1) + ' KB/s';
        }

        // ==================== RESOURCE MONITOR ====================

        function renderResourceTables() {
            // CPU Resource Table
            const cpuTable = document.getElementById('cpuResourceTable');
            cpuTable.innerHTML = '';

            processes.forEach(p => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="process-name">${p.name}</td>
                    <td>${p.pid}</td>
                    <td class="${p.cpu > 50 ? 'cpu-high' : p.cpu > 10 ? 'cpu-medium' : 'cpu-low'}">${p.cpu.toFixed(1)}%</td>
                    <td>${(p.cpu * 0.8).toFixed(1)}%</td>
                    <td>${p.threads}</td>
                `;
                cpuTable.appendChild(tr);
            });

            // Memory Resource Table
            const memTable = document.getElementById('memoryResourceTable');
            memTable.innerHTML = '';

            processes.forEach(p => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="process-name">${p.name}</td>
                    <td>${p.pid}</td>
                    <td>${p.memory.toFixed(0)}</td>
                    <td>${(p.memory * 0.7).toFixed(0)}</td>
                    <td>${(p.memory * 0.3).toFixed(0)}</td>
                `;
                memTable.appendChild(tr);
            });

            // Disk Resource Table
            const diskTable = document.getElementById('diskResourceTable');
            diskTable.innerHTML = '';

            processes.forEach(p => {
                const tr = document.createElement('tr');
                const read = (p.disk * 1024 * 0.6).toFixed(0);
                const write = (p.disk * 1024 * 0.4).toFixed(0);
                const total = (p.disk * 1024).toFixed(0);

                tr.innerHTML = `
                    <td class="process-name">${p.name}</td>
                    <td>${p.pid}</td>
                    <td>${read}</td>
                    <td>${write}</td>
                    <td>${total}</td>
                `;
                diskTable.appendChild(tr);
            });

            // Network Resource Table
            const netTable = document.getElementById('networkResourceTable');
            netTable.innerHTML = '';

            processes.forEach(p => {
                const tr = document.createElement('tr');
                const send = (p.network * 1024 * 0.3).toFixed(0);
                const receive = (p.network * 1024 * 0.7).toFixed(0);
                const total = (p.network * 1024).toFixed(0);

                tr.innerHTML = `
                    <td class="process-name">${p.name}</td>
                    <td>${p.pid}</td>
                    <td>${send}</td>
                    <td>${receive}</td>
                    <td>${total}</td>
                `;
                netTable.appendChild(tr);
            });
        }

        function switchResourceTab(tab) {
            document.querySelectorAll('.resource-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('#resourcemonitor .tab-content').forEach(c => c.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tab + '-resource').classList.add('active');

            renderResourceTables();
        }

        // ==================== SYSTEM INFORMATION ====================

        const systemInfoData = {
            'System Summary': {
                'OS Name': 'Microsoft Windows 11 Pro',
                'Version': '10.0.22621 Build 22621',
                'System Manufacturer': 'Hexworth Technologies',
                'System Model': 'Prime Workstation X1',
                'System Type': 'x64-based PC',
                'Processor': 'Intel Core i7-12700K @ 3.60GHz',
                'BIOS Version': 'UEFI 2.7.0',
                'Total Physical Memory': '16.0 GB',
                'Available Physical Memory': '8.2 GB',
                'Virtual Memory': '32.0 GB',
                'Page File Space': '16.0 GB'
            },
            'Hardware Resources': {
                'IRQs': '23 active',
                'DMA Channels': '4 channels',
                'I/O Port Addresses': '512 ranges',
                'Memory Addresses': '128 ranges'
            },
            'Components': {
                'Display': 'NVIDIA GeForce RTX 3080',
                'Sound Device': 'Realtek High Definition Audio',
                'Network Adapter': 'Intel Ethernet Connection I225-V'
            },
            'Software Environment': {
                'Environment Variables': '48 variables',
                'System Drivers': '203 drivers loaded',
                'Running Tasks': processes.length + ' processes',
                'Windows Directory': 'C:\\Windows',
                'System Directory': 'C:\\Windows\\system32'
            }
        };

        function renderSystemInfo() {
            const tree = document.getElementById('sysinfoTree');
            const categories = Object.keys(systemInfoData);

            tree.innerHTML = '';

            categories.forEach((category, index) => {
                const item = document.createElement('div');
                item.className = 'tree-item expandable';
                item.textContent = category;
                item.onclick = () => {
                    item.classList.toggle('expanded');
                    showSystemInfoDetails(category);
                };

                if (index === 0) {
                    item.classList.add('active', 'expanded');
                }

                tree.appendChild(item);
            });

            showSystemInfoDetails('System Summary');
        }

        function showSystemInfoDetails(category) {
            const details = document.getElementById('sysinfoDetails');
            const data = systemInfoData[category];

            details.innerHTML = `
                <div class="info-section">
                    <div class="info-section-title">${category}</div>
                    ${Object.entries(data).map(([key, value]) => `
                        <div class="info-row">
                            <div class="info-label">${key}</div>
                            <div class="info-value">${value}</div>
                        </div>
                    `).join('')}
                </div>
            `;

            document.querySelectorAll('.tree-item').forEach(item => {
                item.classList.remove('active');
                if (item.textContent === category) {
                    item.classList.add('active');
                }
            });

            if (category === 'System Summary') {
                completedScenarios.add('check-ram');
                checkScenarioCompletion('check-ram');
            }
        }

        // ==================== SCENARIOS ====================

        const scenarios = [
            {
                id: 'find-high-cpu',
                icon: '🔍',
                title: 'Find the High CPU Process',
                desc: 'A process is consuming excessive CPU resources. Identify and terminate it.',
                difficulty: 'easy',
                hint: 'Look for processes with CPU usage above 80%'
            },
            {
                id: 'check-ram',
                icon: '💾',
                title: 'Check Available RAM',
                desc: 'Use System Information to determine how much RAM is available on the system.',
                difficulty: 'easy',
                hint: 'Navigate to System Summary in System Information'
            },
            {
                id: 'disable-malware-startup',
                icon: '⚠️',
                title: 'Disable Suspicious Startup',
                desc: 'A suspicious program is set to run at startup. Find and disable it.',
                difficulty: 'medium',
                hint: 'Check the Startup tab for programs from unknown publishers'
            },
            {
                id: 'monitor-network',
                icon: '🌐',
                title: 'Monitor Network Activity',
                desc: 'Use Resource Monitor to identify which process is using the most network bandwidth.',
                difficulty: 'medium',
                hint: 'Check the Network tab in Resource Monitor'
            },
            {
                id: 'sort-by-memory',
                icon: '📊',
                title: 'Sort by Memory Usage',
                desc: 'Organize processes by memory consumption to identify memory hogs.',
                difficulty: 'easy',
                hint: 'Click on the Memory column header in Task Manager'
            },
            {
                id: 'check-disk-performance',
                icon: '💿',
                title: 'Analyze Disk Performance',
                desc: 'View the disk performance graphs to understand I/O activity.',
                difficulty: 'easy',
                hint: 'Go to the Performance tab and look at Disk metrics'
            }
        ];

        function renderScenarios() {
            const grid = document.getElementById('scenariosGrid');
            grid.innerHTML = '';

            scenarios.forEach(scenario => {
                const card = document.createElement('div');
                card.className = 'scenario-card';

                if (completedScenarios.has(scenario.id)) {
                    card.classList.add('completed');
                }

                card.innerHTML = `
                    <div class="scenario-icon">${scenario.icon}</div>
                    <div class="scenario-title">${scenario.title}</div>
                    <div class="scenario-desc">${scenario.desc}</div>
                    <div class="scenario-difficulty ${scenario.difficulty}">${scenario.difficulty}</div>
                    ${completedScenarios.has(scenario.id) ? '<div style="margin-top: 10px; color: #34d399;">✓ Completed</div>' : ''}
                `;

                card.onclick = () => showScenarioHint(scenario);

                grid.appendChild(card);
            });
        }

        function showScenarioHint(scenario) {
            if (completedScenarios.has(scenario.id)) {
                showModal('Scenario Completed!', `
                    <div style="text-align: center; color: #34d399; font-size: 3rem; margin: 20px 0;">✓</div>
                    <p>You've already completed this scenario!</p>
                `);
                return;
            }

            showModal(scenario.title, `
                <p style="margin-bottom: 15px;">${scenario.desc}</p>
                <p style="color: #fbbf24;"><strong>Hint:</strong> ${scenario.hint}</p>
            `);
        }

        function checkScenarioCompletion(scenarioId) {
            renderScenarios();
            saveProgress();
            updateStats();

            const scenario = scenarios.find(s => s.id === scenarioId);
            if (scenario) {
                showTooltip(event, `Scenario completed: ${scenario.title}`);
            }
        }

        // ==================== MODE SWITCHING ====================

        function switchMode(mode) {
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.mode-container').forEach(container => container.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(mode).classList.add('active');

            exploredTools.add(mode);
            saveProgress();
            updateStats();
        }

        function switchTaskManagerTab(tab) {
            document.querySelectorAll('.tabs-container .tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('#taskmanager .tab-content').forEach(c => c.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tab + '-tab').classList.add('active');
        }

        // ==================== UTILITIES ====================

        function showModal(title, body) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = body;
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        function showTooltip(event, text) {
            const tooltip = document.getElementById('tooltip');
            tooltip.textContent = text;
            tooltip.style.display = 'block';
            tooltip.style.left = event.clientX + 10 + 'px';
            tooltip.style.top = event.clientY + 10 + 'px';

            setTimeout(() => {
                tooltip.style.display = 'none';
            }, 2000);
        }

        function updateStats() {
            document.getElementById('toolsExplored').textContent = exploredTools.size;
            document.getElementById('scenariosCompleted').textContent = completedScenarios.size;
            document.getElementById('processesEnded').textContent = processesEnded;

            const totalItems = 4 + scenarios.length; // 4 tools + scenarios
            const completed = exploredTools.size + completedScenarios.size;
            const progress = Math.round((completed / totalItems) * 100);
            document.getElementById('progressPercent').textContent = progress + '%';
        }

        // ==================== PROGRESS PERSISTENCE ====================

        function saveProgress() {
            const progress = {
                exploredTools: Array.from(exploredTools),
                completedScenarios: Array.from(completedScenarios),
                processesEnded: processesEnded,
                date: new Date().toISOString()
            };
            localStorage.setItem('systemToolsProgress', JSON.stringify(progress));

            // Save to global Hexworth progress
            const hexworthProgress = JSON.parse(localStorage.getItem('hexworth_progress') || '{}');
            hexworthProgress.forge = hexworthProgress.forge || {};
            hexworthProgress.forge.systemToolsSim = {
                completed: completedScenarios.size > 0 || exploredTools.size > 1,
                toolsExplored: exploredTools.size,
                scenariosCompleted: completedScenarios.size,
                processesEnded: processesEnded,
                date: new Date().toISOString()
            };
            localStorage.setItem('hexworth_progress', JSON.stringify(hexworthProgress));
        }

        function loadProgress() {
            const saved = localStorage.getItem('systemToolsProgress');
            if (saved) {
                const progress = JSON.parse(saved);
                exploredTools = new Set(progress.exploredTools || []);
                completedScenarios = new Set(progress.completedScenarios || []);
                processesEnded = progress.processesEnded || 0;
            }
        }

        // ==================== START ====================

        init();
    </script>
</body>
</html>
