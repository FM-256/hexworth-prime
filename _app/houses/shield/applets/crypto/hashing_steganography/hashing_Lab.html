<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Interactive Hashing Lab ‚Äî MD5 ¬∑ SHA-1 ¬∑ SHA-256 ¬∑ SHA-384 ¬∑ SHA-512</title>
<style>
  :root{--bg:#0f1222;--panel:#171a2f;--panel-2:#1f2340;--ink:#e8ebff;--muted:#9aa4d6;--accent:#6cd4ff;--ok:#41e2a0;--warn:#ffd166;--bad:#ff6b6b}
  *{box-sizing:border-box;font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#0f1222,#0b1023);color:var(--ink)}
  .wrap{display:grid;grid-template-columns:360px 1fr 420px;grid-template-rows:auto 1fr;gap:12px;height:100%;padding:12px}
  header{grid-column:1/4;background:var(--panel);border:1px solid #2a2f57;border-radius:14px;padding:10px 14px;display:flex;align-items:center;justify-content:space-between}
  header h1{margin:0;font-size:18px}
  .badge{font-size:11px;color:var(--muted)}
  .pane{background:var(--panel);border:1px solid #2a2f57;border-radius:14px;padding:12px;display:flex;flex-direction:column;gap:10px;min-height:0}
  .row{display:flex;gap:10px;align-items:center}
  .row label{width:110px;color:var(--muted);font-size:12px}
  input[type="text"], input[type="number"], textarea, select{flex:1;background:#0c1128;border:1px solid #2d3466;color:var(--ink);padding:8px;border-radius:8px}
  textarea{min-height:88px;resize:vertical}
  .btn{background:var(--panel-2);border:1px solid #31386a;color:var(--ink);padding:8px 12px;border-radius:10px;cursor:pointer}
  .btn:hover{border-color:#4450a8}
  .out{background:#0c1128;border:1px solid #2d3466;border-radius:10px;padding:10px;min-height:90px;overflow:auto;line-height:1.35}
  .tabs{display:flex;gap:6px}
  .tabs .tab{padding:6px 10px;border-radius:999px;border:1px solid #31386a;background:#0c1128;color:var(--muted);cursor:pointer}
  .tabs .tab.active{color:var(--ink);border-color:#6cd4ff}
  code{word-break:break-all}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .pill{display:inline-block;padding:3px 8px;border-radius:999px;background:#0c1128;border:1px solid #2d3466;color:var(--muted);font-size:12px}
  .small{font-size:12px;color:var(--muted)}
  .kv{display:grid;grid-template-columns:auto 1fr;gap:8px 10px}
  .kv div:nth-child(odd){color:var(--muted)}
  .diff span{padding:2px 1px;border-radius:3px}
  .diff .chg{background:#2a334f}
  .diff .chg2{background:#3b1f36}
  .toast{position:fixed;right:14px;bottom:14px;background:#11152f;border:1px solid #2d3466;padding:10px 12px;border-radius:10px;color:var(--ink);opacity:0;transform:translateY(8px);transition:.25s;z-index:9999}
  .toast.show{opacity:1;transform:translateY(0)}
  /* tutorial */
  .tutorial-tip{position:absolute;background:#11152f;border:2px solid var(--accent);border-radius:10px;padding:10px 14px;color:var(--ink);z-index:9999;max-width:300px;box-shadow:0 0 12px rgba(108,212,255,0.4)}
  .tutorial-tip .nav{display:flex;gap:6px;margin-top:8px}
  .tutorial-tip button{background:var(--accent);border:none;color:#0b0f27;padding:6px 10px;border-radius:6px;cursor:pointer}
  .highlight{position:absolute;border:2px solid var(--accent);border-radius:6px;pointer-events:none;z-index:9998;animation:pulse 1s infinite alternate}
  @keyframes pulse{0%{box-shadow:0 0 4px var(--accent)}100%{box-shadow:0 0 20px var(--accent)}}
</style>
</head>
<body>
<div class="hexworth-wrapper" style="font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #0a0a0a 0%, #1a0a0a 50%, #0a0a0a 100%); min-height: 100vh; margin: 0; padding: 0;">
    <header style="background: linear-gradient(135deg, #1a0a0a 0%, #8b0000 50%, #dc143c 100%); padding: 12px 20px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 4px 20px rgba(220, 20, 60, 0.3);">
        <a href="../../../catalog.html?theme=academy" style="display: flex; align-items: center; gap: 12px; color: white; text-decoration: none;">
            <span style="font-size: 28px;">üè∞</span>
            <span style="font-size: 18px; font-weight: 600; letter-spacing: 1px;">Hexworth Academy</span>
        </a>
        <span style="background: linear-gradient(135deg, #1a1a1a, #333333); color: #dc143c; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; border: 1px solid #dc143c;">üõ°Ô∏è House of Shield</span>
    </header>
    <div style="display: flex; justify-content: center; padding: 20px;">

  <div class="wrap">
    <header>
      <h1>Interactive Hashing Lab <span class="badge">v1.0 ‚Äî MD5 ¬∑ SHA-1 ¬∑ SHA-256 ¬∑ SHA-384 ¬∑ SHA-512</span></h1>
      <div class="row" style="gap:8px">
        <button id="helpBtn" class="btn">‚ùì Guided Tutorial</button>
        <button id="exportBtn" class="btn">üì• Export Results</button>
      </div>
    </header>

    <!-- Left: Inputs -->
    <section class="pane">
      <div class="row"><label>Algorithm</label>
        <select id="algo">
          <option>SHA-256</option>
          <option>SHA-1</option>
          <option>SHA-384</option>
          <option>SHA-512</option>
          <option>MD5</option>
        </select>
      </div>

      <div class="row"><label>Input text</label><textarea id="textIn" placeholder="Type or paste text‚Ä¶">password</textarea></div>
      <div class="row"><label>Salt</label><input type="text" id="salt" placeholder="Optional (appended)" /></div>
      <div class="row"><label>File</label><input type="file" id="fileIn" /></div>

      <div class="row">
        <button id="hashBtn" class="btn">Generate Hash</button>
        <button id="copyBtn" class="btn">Copy</button>
        <span class="pill" id="sizeInfo">0 bytes</span>
      </div>

      <div class="tabs">
        <div class="tab active" data-mode="hex">Hex</div>
        <div class="tab" data-mode="base64">Base64</div>
      </div>
      <div class="out" id="hashOut"><code id="hashCode">‚Äî</code></div>

      <div class="kv small">
        <div>Length</div><div id="lenOut">‚Äî</div>
        <div>Time</div><div id="timeOut">‚Äî</div>
      </div>
    </section>

    <!-- Center: Avalanche effect / comparison -->
    <section class="pane">
      <h3 style="margin:0">Avalanche Effect</h3>
      <div class="grid2">
        <div>
          <div class="small">Original</div>
          <textarea id="avA">password</textarea>
          <div class="small">Hash A</div>
          <div class="out diff" id="avHashA"></div>
        </div>
        <div>
          <div class="small">Modified</div>
          <textarea id="avB">passw0rd</textarea>
          <div class="small">Hash B</div>
          <div class="out diff" id="avHashB"></div>
        </div>
      </div>
      <div class="row">
        <button id="avRun" class="btn">Compare</button>
        <span class="pill" id="bitDiff">‚Äî bit difference</span>
        <span class="pill" id="hexDiff">‚Äî hex difference</span>
      </div>
    </section>

    <!-- Right: Utilities / Identify / Notes -->
    <section class="pane">
      <h3 style="margin:0">Utilities</h3>
      <div class="row"><label>Identify Hash</label><input type="text" id="guessIn" placeholder="Paste a hash to identify" /></div>
      <div class="row"><button id="guessBtn" class="btn">Identify</button><span id="guessOut" class="pill">‚Äî</span></div>

      <h3 style="margin:6px 0 0">Notes</h3>
      <div class="small">‚Ä¢ Hashes are one-way and fixed-length. ‚Ä¢ Small input changes produce large output changes (avalanche effect). ‚Ä¢ Add salt to resist rainbow tables.</div>
      <div class="small" style="margin-top:6px">Algorithms provided via Web Crypto API (SHA family) and a built-in MD5 fallback for instructional use.</div>
      <div class="small" style="margin-top:6px">‚ö†Ô∏è MD5 and SHA‚Äë1 are considered broken/weak for collision resistance and should not be used for new systems.</div>
    </section>
  </div>

  <div class="toast" id="toast"></div>

<script>
// ====== Helpers ======
const el = id => document.getElementById(id);
const toast = (msg)=>{const t=el('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1500)};
const toHex = (buf)=> Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
const toBase64 = (buf)=> btoa(String.fromCharCode(...new Uint8Array(buf)));
const utf8 = (s)=> new TextEncoder().encode(s);

// ====== MD5 Fallback (educational; not for production security) ======
// Lightweight MD5 implementation (public domain/CC0 blend, trimmed for clarity)
function md5bytes(inputBytes){
  function toUint32(x){return x>>>0}
  function rotl(x,c){return (x<<c)|(x>>> (32-c))}
  function ff(a,b,c,d,x,s,t){return toUint32(rotl(toUint32(a + ((b & c) | (~b & d)) + x + t), s) + b)}
  function gg(a,b,c,d,x,s,t){return toUint32(rotl(toUint32(a + ((b & d) | (c & ~d)) + x + t), s) + b)}
  function hh(a,b,c,d,x,s,t){return toUint32(rotl(toUint32(a + (b ^ c ^ d) + x + t), s) + b)}
  function ii(a,b,c,d,x,s,t){return toUint32(rotl(toUint32(a + (c ^ (b | ~d)) + x + t), s) + b)}
  const origLen = inputBytes.length;
  const withOne = new Uint8Array(((origLen + 9 + 63) >> 6) << 6);
  withOne.set(inputBytes);
  withOne[origLen] = 0x80;
  const bitLen = origLen * 8;
  new DataView(withOne.buffer).setUint32(withOne.length-8, bitLen >>> 0, true);
  new DataView(withOne.buffer).setUint32(withOne.length-4, Math.floor(bitLen/0x100000000), true);
  let a=0x67452301, b=0xefcdab89, c=0x98badcfe, d=0x10325476;
  const K=[
    0xd76aa478,0xe8c7b756,0x242070db,0xc1bdceee,0xf57c0faf,0x4787c62a,0xa8304613,0xfd469501,0x698098d8,0x8b44f7af,0xffff5bb1,0x895cd7be,0x6b901122,0xfd987193,0xa679438e,0x49b40821,
    0xf61e2562,0xc040b340,0x265e5a51,0xe9b6c7aa,0xd62f105d,0x02441453,0xd8a1e681,0xe7d3fbc8,0x21e1cde6,0xc33707d6,0xf4d50d87,0x455a14ed,0xa9e3e905,0xfcefa3f8,0x676f02d9,0x8d2a4c8a,
    0xfffa3942,0x8771f681,0x6d9d6122,0xfde5380c,0xa4beea44,0x4bdecfa9,0xf6bb4b60,0xbebfbc70,0x289b7ec6,0xeaa127fa,0xd4ef3085,0x04881d05,0xd9d4d039,0xe6db99e5,0x1fa27cf8,0xc4ac5665,
    0xf4292244,0x432aff97,0xab9423a7,0xfc93a039,0x655b59c3,0x8f0ccc92,0xffeff47d,0x85845dd1,0x6fa87e4f,0xfe2ce6e0,0xa3014314,0x4e0811a1,0xf7537e82,0xbd3af235,0x2ad7d2bb,0xeb86d391
  ];
  const S=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21];
  for(let i=0;i<withOne.length;i+=64){
    const X=new Uint32Array(16); const dv=new DataView(withOne.buffer,i,64);
    for(let j=0;j<16;j++) X[j]=dv.getUint32(j*4,true);
    let A=a,B=b,C=c,D=d;
    for(let j=0;j<64;j++){
      let f, g;
      if(j<16){ f=ff(A,B,C,D,X[j],S[j],K[j]); A=D; D=C; C=B; B=f; }
      else if(j<32){ g=(5*j+1)%16; f=gg(A,B,C,D,X[g],S[j],K[j]); A=D; D=C; C=B; B=f; }
      else if(j<48){ g=(3*j+5)%16; f=hh(A,B,C,D,X[g],S[j],K[j]); A=D; D=C; C=B; B=f; }
      else { g=(7*j)%16; f=ii(A,B,C,D,X[g],S[j],K[j]); A=D; D=C; C=B; B=f; }
    }
    a=toUint32(a+A); b=toUint32(b+B); c=toUint32(c+C); d=toUint32(d+D);
  }
  const out=new Uint8Array(16); const dv=new DataView(out.buffer);
  dv.setUint32(0,a,true); dv.setUint32(4,b,true); dv.setUint32(8,c,true); dv.setUint32(12,d,true);
  return out;
}

// ====== Hash Core ======
async function digest(algorithm, data){
  const algo = algorithm.toUpperCase();
  if(algo === 'MD5') return md5bytes(data);
  const buf = await crypto.subtle.digest(algo, data);
  return new Uint8Array(buf);
}

// ====== Main Hashing ======
let mode = 'hex'; // hex | base64
const algoSel = el('algo');
const textIn = el('textIn');
const saltIn = el('salt');
const fileIn = el('fileIn');
const outBox = el('hashOut');
const outCode = el('hashCode');
const sizeInfo = el('sizeInfo');
const lenOut = el('lenOut');
const timeOut = el('timeOut');

async function runHash(){
  let bytes;
  if(fileIn.files[0]){
    const ab = await fileIn.files[0].arrayBuffer();
    const salt = utf8(saltIn.value||'');
    const merged = new Uint8Array(ab.byteLength + salt.length);
    merged.set(new Uint8Array(ab), 0); merged.set(salt, ab.byteLength);
    bytes = merged;
    sizeInfo.textContent = fileIn.files[0].size + ' bytes';
  } else {
    const msg = textIn.value + (saltIn.value||'');
    bytes = utf8(msg);
    sizeInfo.textContent = bytes.length + ' bytes';
  }
  const t0=performance.now();
  const h = await digest(algoSel.value, bytes);
  const t1=performance.now();
  const display = (mode==='hex') ? Array.from(h).map(b=>b.toString(16).padStart(2,'0')).join('') : toBase64(h);
  outCode.textContent = display;
  lenOut.textContent = h.length*8 + ' bits';
  timeOut.textContent = (t1-t0).toFixed(2) + ' ms';
}

el('hashBtn').onclick = runHash;

// Copy & mode tabs
el('copyBtn').onclick = ()=>{ navigator.clipboard.writeText(outCode.textContent||''); toast('Copied'); };
Array.from(document.querySelectorAll('.tab')).forEach(t=>{
  t.onclick=()=>{
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    t.classList.add('active'); mode=t.dataset.mode; runHash();
  };
});

// ====== Avalanche Effect ======
const avA=el('avA'), avB=el('avB'), avHashA=el('avHashA'), avHashB=el('avHashB');
async function runAvalanche(){
  const a=await digest(algoSel.value, utf8(avA.value));
  const b=await digest(algoSel.value, utf8(avB.value));
  // Render hex with diff highlights
  function hexSpans(bytes, other){
    let html='';
    for(let i=0;i<bytes.length;i++){
      const h=bytes[i].toString(16).padStart(2,'0');
      const cls = (other && other[i]!==bytes[i])? 'chg' : '';
      html += `<span class="${cls}">${h}</span>`;
    }
    return html;
  }
  avHashA.innerHTML=hexSpans(a,b);
  avHashB.innerHTML=hexSpans(b,a);
  // Bit diff percentage
  let bits=0, diff=0; for(let i=0;i<a.length;i++){ let x=a[i]^b[i]; bits+=8; while(x){ diff++; x&=x-1; } }
  el('bitDiff').textContent = ((diff/bits*100).toFixed(2)) + '% bit difference';
  let hx=0; for(let i=0;i<a.length;i++){ if(a[i]!==b[i]) hx++; }
  el('hexDiff').textContent = hx + ' / ' + a.length + ' bytes differ';
}
el('avRun').onclick = runAvalanche;

// ====== Identify Hash ======
function identifyHash(s){
  const len = s.trim().length;
  // crude guesser by length
  const map = {
    32:'MD5 (128-bit)',
    40:'SHA-1 (160-bit)',
    56:'SHA-224 (not in this demo)',
    64:'SHA-256 (256-bit)',
    96:'SHA-384 (384-bit)',
    128:'SHA-512 (512-bit)'
  };
  return map[len] || 'Unknown length';
}
el('guessBtn').onclick=()=>{ el('guessOut').textContent = identifyHash(el('guessIn').value) };

// ====== Export ======
el('exportBtn').onclick=()=>{
  const data={
    algorithm: algoSel.value,
    inputText: textIn.value,
    salt: saltIn.value,
    fileBytes: fileIn.files[0]? fileIn.files[0].size : 0,
    output: outCode.textContent,
    avalanche:{A:avA.value,B:avB.value,bitDiff:el('bitDiff').textContent,hexDiff:el('hexDiff').textContent}
  };
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='hashing_lab_results.json'; a.click();
};

// ====== Guided Tutorial ======
const steps=[
  {target:'#algo', text:'Choose a hash algorithm. Start with SHA-256.'},
  {target:'#textIn', text:'Type some text ‚Äî try "password".'},
  {target:'#hashBtn', text:'Click Generate Hash to compute the digest.'},
  {target:'.tabs', text:'Switch between Hex and Base64 views.'},
  {target:'#salt', text:'Add a salt (e.g., schoollab) and hash again to see how the output changes.'},
  {target:'#fileIn', text:'Optionally pick a file ‚Äî we will hash the file bytes (with salt appended).'},
  {target:'#avA', text:'Avalanche: left is original text.'},
  {target:'#avB', text:'Change one character here, then click Compare to visualize differences.'},
  {target:'#exportBtn', text:'Export your results for your lab submission.'}
];
function showStep(i){
  const s=steps[i]; if(!s) return;
  const tgt=document.querySelector(s.target); if(!tgt) return;
  const r=tgt.getBoundingClientRect();
  const tip=document.createElement('div'); tip.className='tutorial-tip';
  tip.style.top=(r.bottom+10)+'px'; tip.style.left=r.left+'px';
  tip.innerHTML=`<div>${s.text}</div><div class='nav'><button id='nextT'>Next ‚ñ∂</button><button id='closeT' style='background:#9aa4d6;color:#0b0f27'>Close</button></div>`;
  document.body.appendChild(tip);
  const hl=document.createElement('div'); hl.className='highlight'; hl.style.top=(r.top-4)+'px'; hl.style.left=(r.left-4)+'px'; hl.style.width=(r.width+8)+'px'; hl.style.height=(r.height+8)+'px'; document.body.appendChild(hl);
  el('nextT').onclick=()=>{ tip.remove(); hl.remove(); showStep(i+1); };
  el('closeT').onclick=()=>{ tip.remove(); hl.remove(); };
}
el('helpBtn').onclick=()=> showStep(0);

// Boot defaults
runHash(); runAvalanche();
</script>
    </div>
    <footer style="background: rgba(26, 10, 10, 0.8); color: rgba(255,255,255,0.7); text-align: center; padding: 12px; font-size: 12px;">
        <p>Educational content | <a href="../../../catalog.html" style="color: #dc143c; text-decoration: none;">‚Üê Back to Catalog</a></p>
    </footer>
</div>
</body>
</html>
