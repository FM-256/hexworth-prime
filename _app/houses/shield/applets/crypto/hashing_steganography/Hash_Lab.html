<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Cryptography & Steganography Lab</title>
<style>
  * {box-sizing: border-box;}
  body {font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #1a1a2e; min-height: 100vh; padding: 20px;}
  .container {max-width: 1000px; margin: auto;}
  .progress-bar {background: rgba(255,255,255,0.2); height: 8px; border-radius: 10px; margin-bottom: 30px; overflow: hidden;}
  .progress-fill {background: linear-gradient(90deg, #4ade80, #22c55e); height: 100%; width: 0%; transition: width 0.3s ease;}
  section {display: none; padding: 40px; background: white; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); margin: 20px 0; position: relative; overflow: hidden;}
  section.active {display: block; animation: slideIn 0.5s ease-out;}
  @keyframes slideIn {from {opacity: 0; transform: translateX(20px);} to {opacity: 1; transform: translateX(0);}}
  h1 {color: #1e3a8a; text-align: center; font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.1);}
  h2 {color: #1e40af; border-bottom: 3px solid #3b82f6; padding-bottom: 10px; margin-top: 0;}
  h3 {color: #2563eb; margin-top: 25px;}
  .badge {display: inline-block; padding: 4px 12px; background: #dbeafe; color: #1e40af; border-radius: 20px; font-size: 0.85em; font-weight: 600; margin: 5px;}
  .controls {position: fixed; top: 20px; right: 20px; display: flex; gap: 10px; z-index: 999;}
  .nav {position: fixed; bottom: 20px; right: 20px; display: flex; gap: 10px; z-index: 999;}
  button {padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; color: white; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 6px rgba(0,0,0,0.1);} 
  button:hover {transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.2);} 
  button:active {transform: translateY(0);} 
  #next {background: linear-gradient(135deg, #16a34a, #15803d);} 
  #prev {background: linear-gradient(135deg, #d97706, #b45309);} 
  #random {background: linear-gradient(135deg, #2563eb, #1d4ed8);} 
  #reset {background: linear-gradient(135deg, #dc2626, #b91c1c);} 
  textarea, input[type="text"], input[type="password"] {width: 100%; margin-top: 8px; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 14px; transition: border 0.3s;}
  textarea:focus, input:focus {outline: none; border-color: #3b82f6;}
  input[type="file"] {margin-top: 8px; padding: 8px;}
  .interactive {background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: 20px; border: 2px solid #bae6fd; border-radius: 12px; margin: 20px 0;}
  .demo-box {background: white; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #3b82f6;}
  pre {background: #1e293b; color: #e2e8f0; padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 13px; line-height: 1.6; box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);}
  .result {background: #ecfdf5; border: 2px solid #6ee7b7; padding: 15px; border-radius: 8px; margin-top: 15px; word-break: break-all;}
  .error {background: #fef2f2; border: 2px solid #fca5a5; color: #991b1b;}
  .comparison {display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;}
  .comparison-item {padding: 15px; background: #f8fafc; border-radius: 8px; border: 2px solid #cbd5e1;}
  .visual-demo {display: flex; align-items: center; justify-content: space-around; margin: 20px 0; padding: 20px; background: #f8fafc; border-radius: 12px;}
  .visual-box {padding: 20px; background: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center; min-width: 150px;}
  .arrow {font-size: 2em; color: #3b82f6;}
  .algo-selector {display: flex; gap: 10px; margin: 15px 0; flex-wrap: wrap;}
  .algo-btn {padding: 8px 16px; background: white; color: #3b82f6; border: 2px solid #3b82f6; border-radius: 6px; cursor: pointer; transition: all 0.3s;}
  .algo-btn.active {background: #3b82f6; color: white;}
  .canvas-container {text-align: center; margin: 20px 0;}
  canvas {border: 2px solid #cbd5e1; border-radius: 8px; max-width: 100%; background: white;}
  .info-box {background: #fffbeb; border-left: 4px solid #fbbf24; padding: 15px; border-radius: 8px; margin: 15px 0;}
  .success-box {background: #f0fdf4; border-left: 4px solid #22c55e; padding: 15px; border-radius: 8px; margin: 15px 0;}
  .slide-number {position: absolute; top: 15px; right: 15px; background: #3b82f6; color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.9em; font-weight: 600;}
  ul {line-height: 1.8;}
  li {margin: 8px 0;}
  @media (max-width: 768px) {.comparison {grid-template-columns: 1fr;} .visual-demo {flex-direction: column; gap: 20px;} .controls, .nav {position: static; margin: 10px 0; justify-content: center;}}
</style>
</head>
<body>
<div class="hexworth-wrapper" style="font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #0a0a0a 0%, #1a0a0a 50%, #0a0a0a 100%); min-height: 100vh; margin: 0; padding: 0;">
    <header style="background: linear-gradient(135deg, #1a0a0a 0%, #8b0000 50%, #dc143c 100%); padding: 12px 20px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 4px 20px rgba(220, 20, 60, 0.3);">
        <a href="../../../catalog.html?theme=academy" style="display: flex; align-items: center; gap: 12px; color: white; text-decoration: none;">
            <span style="font-size: 28px;">üè∞</span>
            <span style="font-size: 18px; font-weight: 600; letter-spacing: 1px;">Hexworth Academy</span>
        </a>
        <span style="background: linear-gradient(135deg, #1a1a1a, #333333); color: #dc143c; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; border: 1px solid #dc143c;">üõ°Ô∏è House of Shield</span>
    </header>
    <div style="display: flex; justify-content: center; padding: 20px;">

<div class="controls">
  <button id="random">üé® Theme</button>
  <button id="reset">üîÅ Reset</button>
</div>

<div class="container">
  <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
  
  <section id="slide1" class="active">
    <div class="slide-number">1/10</div>
    <h1>üîê Cryptography & Steganography Lab</h1>
    <p style="text-align: center; font-size: 1.2em; color: #64748b;">A Progressive, Hands-On Journey into Data Security</p>
    
    <div class="comparison">
      <div class="comparison-item">
        <h4>üîí Cryptography</h4>
        <p>Transforms data into an unreadable format. Everyone knows the data exists, but only authorized parties can read it.</p>
        <div class="badge">Encryption</div>
        <div class="badge">Hashing</div>
        <div class="badge">Digital Signatures</div>
      </div>
      <div class="comparison-item">
        <h4>üé≠ Steganography</h4>
        <p>Hides data within other files. The existence of the secret message is concealed from observers.</p>
        <div class="badge">Image Hiding</div>
        <div class="badge">Watermarking</div>
        <div class="badge">Covert Channels</div>
      </div>
    </div>
    
    <div class="info-box">
      <strong>üí° Learning Path:</strong> This lesson progressively builds your understanding through 10 interactive modules, from basic concepts to advanced encryption and steganography techniques.
    </div>
  </section>

  <section id="slide2">
    <div class="slide-number">2/10</div>
    <h2>üîë Introduction to Hashing</h2>
    
    <div class="visual-demo">
      <div class="visual-box">
        <strong>Input</strong><br>
        "Hello World"<br>
        (any size)
      </div>
      <div class="arrow">‚Üí</div>
      <div class="visual-box">
        <strong>Hash Function</strong><br>
        SHA-256
      </div>
      <div class="arrow">‚Üí</div>
      <div class="visual-box">
        <strong>Output</strong><br>
        a591a6d4...<br>
        (fixed 256 bits)
      </div>
    </div>
    
    <h3>Key Properties:</h3>
    <ul>
      <li><strong>Deterministic:</strong> Same input always produces the same hash</li>
      <li><strong>One-way:</strong> Cannot reverse the hash to get original data</li>
      <li><strong>Avalanche Effect:</strong> Tiny input change = completely different hash</li>
      <li><strong>Collision Resistant:</strong> Nearly impossible to find two inputs with same hash</li>
      <li><strong>Fixed Size:</strong> Output is always the same length regardless of input</li>
    </ul>
    
    <div class="info-box">
      <strong>üéØ Use Cases:</strong> Password storage, file integrity verification, blockchain, digital signatures, data deduplication
    </div>
  </section>

  <section id="slide3">
    <div class="slide-number">3/10</div>
    <h2>üß™ Lab 1: Hash Function Explorer</h2>
    <p>Experience the avalanche effect firsthand. Try changing just one character and see how drastically the hash changes!</p>
    
    <div class="interactive">
      <label><strong>Select Hash Algorithm:</strong></label>
      <div class="algo-selector">
        <button class="algo-btn active" data-algo="SHA-256">SHA-256</button>
        <button class="algo-btn" data-algo="SHA-512">SHA-512</button>
        <button class="algo-btn" data-algo="SHA-1">SHA-1 (Legacy)</button>
      </div>
      
      <label for="hashInput"><strong>Enter text to hash:</strong></label>
      <textarea id="hashInput" rows="3" placeholder="Type anything...">Hello World</textarea>
      
      <button id="hashBtn" style="background:#2563eb;margin-top:10px;width:100%;">üîê Compute Hash</button>
      
      <div id="hashResult" class="result" style="display:none;">
        <strong>Hash Output:</strong>
        <pre id="hashOutput" style="margin:10px 0;"></pre>
        <small><strong>Length:</strong> <span id="hashLength"></span> bits</small>
      </div>
    </div>
    
    <div class="demo-box">
      <strong>üí° Try This:</strong>
      <ol>
        <li>Hash the word "password"</li>
        <li>Now hash "Password" (capital P)</li>
        <li>Compare the outputs - completely different, right?</li>
      </ol>
    </div>
  </section>

  <section id="slide4">
    <div class="slide-number">4/10</div>
    <h2>üîê Lab 2: Password Hashing & Salting</h2>
    <p>Learn why we never store passwords in plain text and how salting prevents rainbow table attacks.</p>
    
    <div class="interactive">
      <label for="password"><strong>Enter a password:</strong></label>
      <input type="password" id="password" placeholder="Your password">
      
      <label for="salt"><strong>Salt (random value added for security):</strong></label>
      <input type="text" id="salt" placeholder="Auto-generated" readonly>
      <button id="genSalt" style="background:#10b981;margin-top:5px;">Generate Random Salt</button>
      
      <button id="hashPassword" style="background:#2563eb;margin-top:15px;width:100%;">üîí Hash Password with Salt</button>
      
      <div id="passwordResult" class="result" style="display:none;">
        <strong>Stored in Database:</strong>
        <pre id="passwordHash"></pre>
        <div class="info-box" style="margin-top:10px;">
          ‚úÖ This is what gets stored. Even if hackers steal the database, they can't reverse the hash!
        </div>
      </div>
    </div>
    
    <div class="comparison">
      <div class="comparison-item error">
        <h4>‚ùå Bad: Plain Text</h4>
        <code>password123</code>
        <p><small>If database is breached, all passwords exposed!</small></p>
      </div>
      <div class="comparison-item" style="background:#f0fdf4;border-color:#22c55e;">
        <h4>‚úÖ Good: Hashed + Salted</h4>
        <code>$2b$10$N9qo...</code>
        <p><small>Even if breached, passwords remain secure</small></p>
      </div>
    </div>
  </section>

  <section id="slide5">
    <div class="slide-number">5/10</div>
    <h2>üîÑ Lab 3: File Integrity Checker</h2>
    <p>Hash functions verify that files haven't been tampered with. This is crucial for software downloads and data transmission.</p>
    
    <div class="interactive">
      <label><strong>Upload a file to generate its hash:</strong></label>
      <input type="file" id="fileInput">
      
      <button id="hashFile" style="background:#2563eb;margin-top:10px;">üìÑ Calculate File Hash</button>
      
      <div id="fileHashResult" class="result" style="display:none;">
        <strong>File:</strong> <span id="fileName"></span><br>
        <strong>Size:</strong> <span id="fileSize"></span><br>
        <strong>SHA-256 Hash:</strong>
        <pre id="fileHash"></pre>
      </div>
    </div>
    
    <div class="demo-box">
      <strong>üîç Real-World Example:</strong>
      <p>When you download software, websites often provide hash checksums like:</p>
      <pre>ubuntu-22.04.iso
SHA256: a435bfb7... </pre>
      <p>You calculate the hash of your downloaded file and compare it to verify the file wasn't corrupted or tampered with.</p>
    </div>
  </section>

  <section id="slide6">
    <div class="slide-number">6/10</div>
    <h2>üé≠ Introduction to Steganography</h2>
    
    <p>Unlike cryptography which makes data unreadable, steganography makes data invisible. The secret is hidden in plain sight!</p>
    
    <div class="visual-demo">
      <div class="visual-box">
        <strong>Cover Media</strong><br>
        üñºÔ∏è<br>
        Normal Image
      </div>
      <div class="arrow">+</div>
      <div class="visual-box">
        <strong>Secret Data</strong><br>
        üìù<br>
        Hidden Message
      </div>
      <div class="arrow">=</div>
      <div class="visual-box">
        <strong>Stego Media</strong><br>
        üñºÔ∏è<br>
        Looks Identical!
      </div>
    </div>
    
    <h3>Common Techniques:</h3>
    <div class="comparison">
      <div class="comparison-item">
        <h4>LSB (Least Significant Bit)</h4>
        <p>Hide data in the last bit of pixel color values. Changes are invisible to human eye.</p>
      </div>
      <div class="comparison-item">
        <h4>Metadata Injection</h4>
        <p>Store data in EXIF tags, comments, or headers of files.</p>
      </div>
      <div class="comparison-item">
        <h4>Text Steganography</h4>
        <p>Use invisible Unicode characters or whitespace patterns.</p>
      </div>
      <div class="comparison-item">
        <h4>Audio/Video</h4>
        <p>Embed data in high-frequency components that humans can't detect.</p>
      </div>
    </div>
  </section>

  <section id="slide7">
    <div class="slide-number">7/10</div>
    <h2>üñºÔ∏è Lab 4: Image Steganography Simulator</h2>
    <p>Hide secret messages in images using LSB (Least Significant Bit) technique.</p>
    
    <div class="interactive">
      <h3>Encode: Hide a Message</h3>
      <div class="canvas-container">
        <canvas id="coverCanvas" width="400" height="300"></canvas>
      </div>
      
      <label for="secretMsg"><strong>Secret Message to Hide:</strong></label>
      <input type="text" id="secretMsg" placeholder="Enter your secret message..." maxlength="100">
      
      <button id="generateCover" style="background:#10b981;margin-top:10px;">üé® Generate Random Cover Image</button>
      <button id="encodeMsg" style="background:#2563eb;margin-top:10px;">üîí Hide Message in Image</button>
      
      <div id="encodeResult" class="success-box" style="display:none;">
        ‚úÖ Message successfully hidden! The image looks identical but contains your secret.
      </div>
      
      <h3 style="margin-top:30px;">Decode: Reveal Hidden Message</h3>
      <button id="decodeMsg" style="background:#d97706;">üîç Extract Hidden Message</button>
      
      <div id="decodeResult" class="result" style="display:none;">
        <strong>Decoded Message:</strong>
        <pre id="decodedText"></pre>
      </div>
    </div>
  </section>

  <section id="slide8">
    <div class="slide-number">8/10</div>
    <h2>üìù Lab 5: Text Steganography</h2>
    <p>Hide secret messages using invisible Unicode characters between regular text.</p>
    
    <div class="interactive">
      <h3>Hide Message in Text</h3>
      <label for="coverText"><strong>Cover Text (visible message):</strong></label>
      <textarea id="coverText" rows="3" placeholder="This is the normal text everyone will see...">Meeting scheduled for tomorrow at 3 PM.</textarea>
      
      <label for="hiddenText"><strong>Hidden Message (secret):</strong></label>
      <input type="text" id="hiddenText" placeholder="Your secret message...">
      
      <button id="encodeText" style="background:#2563eb;margin-top:10px;width:100%;">üîê Encode Secret</button>
      
      <div id="textEncodeResult" class="result" style="display:none;">
        <strong>Stego Text (copy this):</strong>
        <textarea id="stegoText" rows="3" readonly></textarea>
        <small>üëÜ This text looks normal but contains hidden data!</small>
      </div>
      
      <h3 style="margin-top:30px;">Decode Hidden Message</h3>
      <label for="decodeTextInput"><strong>Paste stego text:</strong></label>
      <textarea id="decodeTextInput" rows="3" placeholder="Paste the encoded text here..."></textarea>
      
      <button id="decodeText" style="background:#d97706;width:100%;">üîç Extract Secret</button>
      
      <div id="textDecodeResult" class="result" style="display:none;">
        <strong>Hidden Message:</strong>
        <pre id="extractedSecret"></pre>
      </div>
    </div>
  </section>

  <section id="slide9">
    <div class="slide-number">9/10</div>
    <h2>üõ°Ô∏è Combining Techniques: Crypto + Stego</h2>
    <p>For maximum security, combine both approaches: encrypt your message, then hide it!</p>
    
    <div class="interactive">
      <label for="plainMessage"><strong>Your Message:</strong></label>
      <textarea id="plainMessage" rows="3" placeholder="Top secret information..."></textarea>
      
      <label for="encKey"><strong>Encryption Key:</strong></label>
      <input type="password" id="encKey" placeholder="Choose a strong key...">
      
      <button id="cryptoStego" style="background:#7c3aed;margin-top:10px;width:100%;">üîê Encrypt & Hide</button>
      
      <div id="cryptoStegoResult" class="result" style="display:none;">
        <strong>Step 1 - Encrypted:</strong>
        <pre id="encrypted"></pre>
        <strong>Step 2 - Hidden in Text:</strong>
        <textarea id="finalStego" rows="3" readonly></textarea>
        <div class="success-box" style="margin-top:10px;">
          ‚úÖ Your message is now encrypted AND hidden. Maximum security!
        </div>
      </div>
      
      <h3 style="margin-top:30px;">Decrypt & Extract</h3>
      <label for="extractInput"><strong>Stego Text:</strong></label>
      <textarea id="extractInput" rows="3" placeholder="Paste the encoded text..."></textarea>
      
      <label for="decKey"><strong>Decryption Key:</strong></label>
      <input type="password" id="decKey" placeholder="Enter the key...">
      
      <button id="extractDecrypt" style="background:#d97706;width:100%;">üîì Extract & Decrypt</button>
      
      <div id="extractResult" class="result" style="display:none;">
        <strong>Decrypted Message:</strong>
        <pre id="finalMessage"></pre>
      </div>
    </div>
  </section>

  <section id="slide10">
    <div class="slide-number">10/10</div>
    <h2>üéì Summary & Applications</h2>
    
    <div class="success-box">
      <h3 style="margin-top:0;">üéâ Congratulations! You've completed the Cryptography & Steganography Lab!</h3>
    </div>
    
    <h3>What You've Learned:</h3>
    <ul>
      <li>‚úÖ Hash functions and their properties (SHA-256, SHA-512)</li>
      <li>‚úÖ Password hashing with salting for security</li>
      <li>‚úÖ File integrity verification using hashes</li>
      <li>‚úÖ Steganography techniques (LSB, text-based)</li>
      <li>‚úÖ Combining encryption and steganography</li>
    </ul>
    
    <h3>Real-World Applications:</h3>
    <div class="comparison">
      <div class="comparison-item">
        <h4>üîê Cryptography</h4>
        <ul style="text-align:left;padding-left:20px;">
          <li>Secure password storage</li>
          <li>Blockchain & cryptocurrencies</li>
          <li>Digital signatures</li>
          <li>SSL/TLS certificates</li>
          <li>Software integrity checks</li>
        </ul>
      </div>
      <div class="comparison-item">
        <h4>üé≠ Steganography</h4>
        <ul style="text-align:left;padding-left:20px;">
          <li>Digital watermarking</li>
          <li>Covert communication</li>
          <li>Copyright protection</li>
          <li>Anti-counterfeiting</li>
          <li>Forensic analysis</li>
        </ul>
      </div>
    </div>
    
    <div class="info-box">
      <strong>üöÄ Next Steps:</strong> Try deploying this lab on GitHub Pages or Netlify to share with others. Experiment with combining multiple techniques for even stronger security!
    </div>
    
    <div style="text-align:center;margin-top:30px;">
      <button id="restart" style="background:linear-gradient(135deg,#7c3aed,#6d28d9);font-size:1.1em;">üîÑ Restart Lesson</button>
    </div>
  </section>
</div>

<div class="nav">
  <button id="prev">‚¨Ö Previous</button>
  <button id="next">Next ‚û°</button>
</div>

<script>
let slide = 1;
const total = 10;
let selectedAlgo = 'SHA-256';
let coverImageData = null;

function showSlide(n) {
  document.querySelectorAll('section').forEach((s, i) => {
    s.classList.toggle('active', i === n - 1);
  });
  document.getElementById('progressFill').style.width = (n / total * 100) + '%';
}

document.getElementById('next').onclick = () => {
  slide = slide < total ? slide + 1 : 1;
  showSlide(slide);
  window.scrollTo(0, 0);
};

document.getElementById('prev').onclick = () => {
  slide = slide > 1 ? slide - 1 : total;
  showSlide(slide);
  window.scrollTo(0, 0);
};

const restartBtn = document.getElementById('restart');
if (restartBtn) {
  restartBtn.addEventListener('click', () => {
    slide = 1;
    showSlide(slide);
    window.scrollTo(0, 0);
  });
}

// Theme switching
const themes = [
  {bg: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', label: 'Default'},
  {bg: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', label: 'Sunset'},
  {bg: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', label: 'Ocean'},
  {bg: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)', label: 'Mint'},
  {bg: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', label: 'Warm'}
];
let currentTheme = 0;

document.getElementById('random').onclick = () => {
  currentTheme = (currentTheme + 1) % themes.length;
  document.body.style.background = themes[currentTheme].bg;
};

document.getElementById('reset').onclick = () => {
  currentTheme = 0;
  document.body.style.background = themes[0].bg;
};

// Hash algorithm selection
Array.from(document.querySelectorAll('.algo-btn')).forEach(btn => {
  btn.onclick = function() {
    Array.from(document.querySelectorAll('.algo-btn')).forEach(b => b.classList.remove('active'));
    this.classList.add('active');
    selectedAlgo = this.dataset.algo;
  };
});

// Hash computation using Web Crypto
async function computeHash(str, algo) {
  const encoder = new TextEncoder();
  const data = encoder.encode(str);
  const hashBuffer = await crypto.subtle.digest(algo, data); // algo must be like 'SHA-256'
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

document.getElementById('hashBtn').onclick = async () => {
  const input = document.getElementById('hashInput').value;
  if (!input) {
    alert('Please enter some text to hash');
    return;
  }
  try {
    const hash = await computeHash(input, selectedAlgo);
    document.getElementById('hashOutput').textContent = hash;
    document.getElementById('hashLength').textContent = hash.length * 4;
    document.getElementById('hashResult').style.display = 'block';
  } catch (e) {
    alert('Hashing failed: ' + e.message);
  }
};

// Password hashing with salt
function generateSalt() {
  const array = new Uint8Array(16);
  crypto.getRandomValues(array);
  return Array.from(array, b => b.toString(16).padStart(2, '0')).join('');
}

document.getElementById('genSalt').onclick = () => {
  document.getElementById('salt').value = generateSalt();
};

document.getElementById('hashPassword').onclick = async () => {
  const password = document.getElementById('password').value;
  let salt = document.getElementById('salt').value;
  
  if (!password) {
    alert('Please enter a password');
    return;
  }
  
  if (!salt) {
    salt = generateSalt();
    document.getElementById('salt').value = salt;
  }
  
  const combined = salt + password;
  try {
    const hash = await computeHash(combined, 'SHA-256');
    document.getElementById('passwordHash').textContent = `Salt: ${salt}\nHash: ${hash}\n\nStore both safely (salt + hash)`;
    document.getElementById('passwordResult').style.display = 'block';
  } catch (e) {
    alert('Password hashing failed: ' + e.message);
  }
};

// File hashing (SHA-256 of raw bytes)
document.getElementById('hashFile').onclick = async () => {
  const file = document.getElementById('fileInput').files[0];
  if (!file) { alert('Please select a file first'); return; }
  try {
    const arrayBuffer = await file.arrayBuffer();
    const hashBuffer = await crypto.subtle.digest('SHA-256', arrayBuffer);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    const hex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    document.getElementById('fileName').textContent = file.name;
    document.getElementById('fileSize').textContent = `${(file.size / 1024).toFixed(2)} KB`;
    document.getElementById('fileHash').textContent = hex;
    document.getElementById('fileHashResult').style.display = 'block';
  } catch (e) {
    alert('File hashing failed: ' + e.message);
  }
};

// Image steganography (LSB on Red channel)
const canvas = document.getElementById('coverCanvas');
const ctx = canvas.getContext('2d');

function drawNoise() {
  const imgData = ctx.createImageData(canvas.width, canvas.height);
  const d = imgData.data;
  for (let i = 0; i < d.length; i += 4) {
    d[i] = Math.random() * 256 | 0;      // R
    d[i+1] = Math.random() * 256 | 0;    // G
    d[i+2] = Math.random() * 256 | 0;    // B
    d[i+3] = 255;                        // A
  }
  ctx.putImageData(imgData, 0, 0);
  coverImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
}

document.getElementById('generateCover').onclick = () => {
  drawNoise();
};

function stringToBytes(str) {
  return new TextEncoder().encode(str);
}

function bytesToString(bytes) {
  return new TextDecoder().decode(bytes);
}

function embedLSB(message) {
  if (!coverImageData) { throw new Error('Generate a cover image first.'); }
  const msgBytes = stringToBytes(message);
  // store length (16 bits) + data bits
  const totalBits = 16 + msgBytes.length * 8;
  const capacity = (coverImageData.data.length / 4); // bits if using 1 bit per pixel (red channel)
  if (totalBits > capacity) { throw new Error('Message too long for this image.'); }

  const data = coverImageData.data;
  // write length (16-bit unsigned)
  const len = msgBytes.length;
  for (let i = 0; i < 16; i++) {
    const bit = (len >> (15 - i)) & 1;
    const idx = i * 4; // red channel of pixel i
    data[idx] = (data[idx] & 0xFE) | bit;
  }
  // write message bits
  let bitIndex = 16; // start after length bits
  for (let b = 0; b < msgBytes.length; b++) {
    for (let i = 7; i >= 0; i--) {
      const bit = (msgBytes[b] >> i) & 1;
      const pixel = bitIndex++;
      const idx = pixel * 4;
      data[idx] = (data[idx] & 0xFE) | bit;
    }
  }
  ctx.putImageData(coverImageData, 0, 0);
}

function extractLSB() {
  if (!coverImageData) { throw new Error('No image to decode from.'); }
  const data = coverImageData.data;
  // read 16-bit length
  let len = 0;
  for (let i = 0; i < 16; i++) {
    const idx = i * 4;
    len = (len << 1) | (data[idx] & 1);
  }
  const bytes = new Uint8Array(len);
  let bitIndex = 16;
  for (let b = 0; b < len; b++) {
    let byte = 0;
    for (let i = 0; i < 8; i++) {
      const idx = (bitIndex++) * 4;
      byte = (byte << 1) | (data[idx] & 1);
    }
    bytes[b] = byte;
  }
  return bytesToString(bytes);
}

document.getElementById('encodeMsg').onclick = () => {
  try {
    if (!coverImageData) { drawNoise(); }
    const msg = document.getElementById('secretMsg').value || '';
    if (!msg) { alert('Enter a secret message'); return; }
    embedLSB(msg);
    document.getElementById('encodeResult').style.display = 'block';
  } catch (e) {
    alert('Encoding failed: ' + e.message);
  }
};

document.getElementById('decodeMsg').onclick = () => {
  try {
    const out = extractLSB();
    document.getElementById('decodedText').textContent = out || '(none)';
    document.getElementById('decodeResult').style.display = 'block';
  } catch (e) {
    alert('Decoding failed: ' + e.message);
  }
};

// Text steganography via zero-width chars (ZWS: \u200B=0, \u200C=1)
function encodeInvisible(msg) {
  const bits = Array.from(stringToBytes(msg)).map(b => b.toString(2).padStart(8, '0')).join('');
  return bits.replace(/0/g, '\u200B').replace(/1/g, '\u200C');
}

function decodeInvisible(zws) {
  const bits = Array.from(zws).map(c => c === '\u200B' ? '0' : (c === '\u200C' ? '1' : '')).join('');
  if (!bits) { return ''; }
  const len = Math.floor(bits.length / 8);
  const out = new Uint8Array(len);
  for (let i = 0; i < len; i++) {
    out[i] = parseInt(bits.slice(i * 8, i * 8 + 8), 2) || 0;
  }
  return bytesToString(out);
}

document.getElementById('encodeText').onclick = () => {
  const cover = document.getElementById('coverText').value || '';
  const secret = document.getElementById('hiddenText').value || '';
  if (!secret) { alert('Enter hidden text'); return; }
  const encoded = cover + encodeInvisible(secret);
  document.getElementById('stegoText').value = encoded;
  document.getElementById('textEncodeResult').style.display = 'block';
};

document.getElementById('decodeText').onclick = () => {
  const input = document.getElementById('decodeTextInput').value || '';
  const decoded = decodeInvisible(input);
  document.getElementById('extractedSecret').textContent = decoded || '(none found)';
  document.getElementById('textDecodeResult').style.display = 'block';
};

// Crypto + Stego helpers (UTF-8 safe XOR + Base64)
function xorBytes(dataBytes, keyBytes) {
  const out = new Uint8Array(dataBytes.length);
  for (let i = 0; i < dataBytes.length; i++) {
    out[i] = dataBytes[i] ^ keyBytes[i % keyBytes.length];
  }
  return out;
}

function bytesToBase64(bytes) {
  let bin = '';
  bytes.forEach(b => bin += String.fromCharCode(b));
  return btoa(bin);
}

function base64ToBytes(b64) {
  const bin = atob(b64);
  const out = new Uint8Array(bin.length);
  for (let i = 0; i < bin.length; i++) out[i] = bin.charCodeAt(i);
  return out;
}

document.getElementById('cryptoStego').onclick = () => {
  const msg = document.getElementById('plainMessage').value || '';
  const key = document.getElementById('encKey').value || '';
  if (!msg || !key) { alert('Enter message and key'); return; }
  const msgBytes = stringToBytes(msg);
  const keyBytes = stringToBytes(key);
  const encBytes = xorBytes(msgBytes, keyBytes);
  const encB64 = bytesToBase64(encBytes);
  const stego = encodeInvisible(encB64);
  document.getElementById('encrypted').textContent = encB64;
  document.getElementById('finalStego').value = stego;
  document.getElementById('cryptoStegoResult').style.display = 'block';
};

document.getElementById('extractDecrypt').onclick = () => {
  const stego = document.getElementById('extractInput').value || '';
  const key = document.getElementById('decKey').value || '';
  if (!stego || !key) { alert('Paste stego text and enter key'); return; }
  try {
    const encB64 = decodeInvisible(stego);
    const encBytes = base64ToBytes(encB64);
    const keyBytes = stringToBytes(key);
    const decBytes = xorBytes(encBytes, keyBytes);
    const dec = bytesToString(decBytes);
    document.getElementById('finalMessage').textContent = dec;
    document.getElementById('extractResult').style.display = 'block';
  } catch (e) {
    alert('Extract/decrypt failed: ' + e.message);
  }
};

// Initialize first slide progress
showSlide(slide);
</script>
    </div>
    <footer style="background: rgba(26, 10, 10, 0.8); color: rgba(255,255,255,0.7); text-align: center; padding: 12px; font-size: 12px;">
        <p>Educational content | <a href="../../../catalog.html" style="color: #dc143c; text-decoration: none;">‚Üê Back to Catalog</a></p>
    </footer>
</div>
</body>
</html>
