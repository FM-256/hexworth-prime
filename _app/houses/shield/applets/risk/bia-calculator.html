<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIA Calculator | Shield House</title>
    <style>
        :root {
            --shield-primary: #f87171;
            --shield-secondary: #fca5a5;
            --shield-accent: #dc2626;
            --bg-dark: #0f0f0f;
            --bg-card: #1a1a1a;
            --bg-elevated: #242424;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --border-color: #333;
            --success: #22c55e;
            --warning: #eab308;
            --danger: #ef4444;
            --info: #3b82f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--shield-primary), var(--shield-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        /* Back Link */
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            margin-bottom: 1rem;
            transition: color 0.3s ease;
        }

        .back-link:hover {
            color: var(--shield-primary);
        }

        /* Concepts Section */
        .concepts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .concept-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: help;
        }

        .concept-card:hover {
            transform: translateY(-2px);
            border-color: var(--shield-primary);
        }

        .concept-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .concept-name {
            font-weight: 600;
            color: var(--shield-primary);
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        .concept-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Calculator Section */
        .calculator-section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.25rem;
            color: var(--shield-primary);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .process-form {
            display: grid;
            gap: 1.5rem;
        }

        .form-group {
            display: grid;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group label .hint {
            font-weight: 400;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.75rem;
            background: var(--bg-elevated);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--shield-primary);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .time-input {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .time-input input {
            width: 80px;
        }

        .time-input select {
            flex: 1;
        }

        /* Impact Sliders */
        .impact-group {
            background: var(--bg-elevated);
            border-radius: 8px;
            padding: 1rem;
        }

        .impact-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .impact-value {
            font-weight: 600;
            color: var(--shield-primary);
        }

        .impact-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--bg-card);
            appearance: none;
            cursor: pointer;
        }

        .impact-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--shield-primary);
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .impact-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .impact-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 0.25rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Results Section */
        .results-section {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-elevated));
            border: 2px solid var(--shield-primary);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .result-card {
            background: var(--bg-dark);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
        }

        .result-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .result-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .result-value.critical {
            color: var(--danger);
        }

        .result-value.high {
            color: var(--warning);
        }

        .result-value.medium {
            color: var(--info);
        }

        .result-value.low {
            color: var(--success);
        }

        .result-unit {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Timeline Visualization */
        .timeline-section {
            margin-top: 2rem;
        }

        .timeline-visual {
            background: var(--bg-elevated);
            border-radius: 8px;
            padding: 1.5rem;
            position: relative;
            margin-top: 1rem;
        }

        .timeline-bar {
            height: 40px;
            background: var(--bg-card);
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }

        .timeline-segment {
            position: absolute;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
        }

        .timeline-segment.rto {
            background: var(--info);
            left: 0;
        }

        .timeline-segment.wrt {
            background: var(--warning);
        }

        .timeline-segment.mtd {
            background: var(--danger);
            opacity: 0.3;
        }

        .timeline-markers {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .timeline-legend {
            display: flex;
            gap: 1.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        /* Process List */
        .process-list {
            margin-top: 2rem;
        }

        .process-table {
            width: 100%;
            border-collapse: collapse;
        }

        .process-table th,
        .process-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .process-table th {
            background: var(--bg-elevated);
            color: var(--shield-primary);
            font-weight: 600;
        }

        .process-table tr:hover td {
            background: rgba(248, 113, 113, 0.05);
        }

        .priority-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .priority-badge.critical {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .priority-badge.high {
            background: rgba(234, 179, 8, 0.2);
            color: var(--warning);
        }

        .priority-badge.medium {
            background: rgba(59, 130, 246, 0.2);
            color: var(--info);
        }

        .priority-badge.low {
            background: rgba(34, 197, 94, 0.2);
            color: var(--success);
        }

        .action-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .action-btn.primary {
            background: var(--shield-primary);
            color: white;
        }

        .action-btn.primary:hover {
            background: var(--shield-accent);
        }

        .action-btn.secondary {
            background: var(--bg-elevated);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .action-btn.secondary:hover {
            border-color: var(--shield-primary);
        }

        .action-btn.danger {
            background: transparent;
            color: var(--danger);
        }

        .button-group {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 1.5rem;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        /* Export Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-close:hover {
            color: var(--shield-primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            h1 {
                font-size: 1.75rem;
            }

            .concepts-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../../index.html" class="back-link">‚Üê Back to Shield House</a>

        <header>
            <h1>üìä Business Impact Analysis Calculator</h1>
            <p class="subtitle">Calculate MTD, RTO, RPO, WRT and prioritize business processes for continuity planning</p>
        </header>

        <!-- Key Concepts -->
        <div class="concepts-grid">
            <div class="concept-card" title="Maximum Tolerable Downtime - Longest time a process can be down before significant damage">
                <div class="concept-icon">‚è∞</div>
                <div class="concept-name">MTD</div>
                <div class="concept-desc">Max Tolerable Downtime</div>
            </div>
            <div class="concept-card" title="Recovery Time Objective - Target time to restore a process after disruption">
                <div class="concept-icon">üîÑ</div>
                <div class="concept-name">RTO</div>
                <div class="concept-desc">Recovery Time Objective</div>
            </div>
            <div class="concept-card" title="Recovery Point Objective - Maximum acceptable data loss measured in time">
                <div class="concept-icon">üíæ</div>
                <div class="concept-name">RPO</div>
                <div class="concept-desc">Recovery Point Objective</div>
            </div>
            <div class="concept-card" title="Work Recovery Time - Time to catch up on backlog after systems are restored">
                <div class="concept-icon">üìã</div>
                <div class="concept-name">WRT</div>
                <div class="concept-desc">Work Recovery Time</div>
            </div>
            <div class="concept-card" title="Mean Time Between Failures - Average time a system runs before failing">
                <div class="concept-icon">üìà</div>
                <div class="concept-name">MTBF</div>
                <div class="concept-desc">Mean Time Between Failures</div>
            </div>
            <div class="concept-card" title="Mean Time To Repair - Average time to fix a failed component">
                <div class="concept-icon">üîß</div>
                <div class="concept-name">MTTR</div>
                <div class="concept-desc">Mean Time To Repair</div>
            </div>
        </div>

        <!-- Add Process Form -->
        <div class="calculator-section">
            <h2 class="section-title">üìù Add Business Process</h2>
            <form class="process-form" id="processForm">
                <div class="form-group">
                    <label>Process Name <span class="hint">(e.g., "Customer Order Processing")</span></label>
                    <input type="text" id="processName" placeholder="Enter business process name" required>
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <textarea id="processDesc" rows="2" placeholder="Brief description of the process"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Department</label>
                        <select id="processDept">
                            <option value="operations">Operations</option>
                            <option value="finance">Finance</option>
                            <option value="sales">Sales</option>
                            <option value="hr">Human Resources</option>
                            <option value="it">IT</option>
                            <option value="legal">Legal</option>
                            <option value="marketing">Marketing</option>
                            <option value="customer-service">Customer Service</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Dependencies</label>
                        <input type="text" id="processDeps" placeholder="e.g., ERP, Database, Email">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>MTD <span class="hint">(Max Tolerable Downtime)</span></label>
                        <div class="time-input">
                            <input type="number" id="mtdValue" min="0" value="24" required>
                            <select id="mtdUnit">
                                <option value="minutes">Minutes</option>
                                <option value="hours" selected>Hours</option>
                                <option value="days">Days</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>RTO <span class="hint">(Recovery Time Objective)</span></label>
                        <div class="time-input">
                            <input type="number" id="rtoValue" min="0" value="4" required>
                            <select id="rtoUnit">
                                <option value="minutes">Minutes</option>
                                <option value="hours" selected>Hours</option>
                                <option value="days">Days</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>RPO <span class="hint">(Max Acceptable Data Loss)</span></label>
                        <div class="time-input">
                            <input type="number" id="rpoValue" min="0" value="1" required>
                            <select id="rpoUnit">
                                <option value="minutes">Minutes</option>
                                <option value="hours" selected>Hours</option>
                                <option value="days">Days</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>WRT <span class="hint">(Work Recovery Time)</span></label>
                        <div class="time-input">
                            <input type="number" id="wrtValue" min="0" value="8" required>
                            <select id="wrtUnit">
                                <option value="minutes">Minutes</option>
                                <option value="hours" selected>Hours</option>
                                <option value="days">Days</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Impact Assessment -->
                <h3 style="color: var(--shield-secondary); margin-top: 1rem;">Impact Assessment</h3>

                <div class="impact-group">
                    <div class="impact-header">
                        <span>Financial Impact</span>
                        <span class="impact-value" id="financialLabel">Moderate</span>
                    </div>
                    <input type="range" class="impact-slider" id="financialImpact" min="1" max="5" value="3">
                    <div class="impact-labels">
                        <span>Minimal</span>
                        <span>Low</span>
                        <span>Moderate</span>
                        <span>High</span>
                        <span>Severe</span>
                    </div>
                </div>

                <div class="impact-group">
                    <div class="impact-header">
                        <span>Operational Impact</span>
                        <span class="impact-value" id="operationalLabel">Moderate</span>
                    </div>
                    <input type="range" class="impact-slider" id="operationalImpact" min="1" max="5" value="3">
                    <div class="impact-labels">
                        <span>Minimal</span>
                        <span>Low</span>
                        <span>Moderate</span>
                        <span>High</span>
                        <span>Severe</span>
                    </div>
                </div>

                <div class="impact-group">
                    <div class="impact-header">
                        <span>Reputational Impact</span>
                        <span class="impact-value" id="reputationalLabel">Moderate</span>
                    </div>
                    <input type="range" class="impact-slider" id="reputationalImpact" min="1" max="5" value="3">
                    <div class="impact-labels">
                        <span>Minimal</span>
                        <span>Low</span>
                        <span>Moderate</span>
                        <span>High</span>
                        <span>Severe</span>
                    </div>
                </div>

                <div class="impact-group">
                    <div class="impact-header">
                        <span>Legal/Compliance Impact</span>
                        <span class="impact-value" id="legalLabel">Moderate</span>
                    </div>
                    <input type="range" class="impact-slider" id="legalImpact" min="1" max="5" value="3">
                    <div class="impact-labels">
                        <span>Minimal</span>
                        <span>Low</span>
                        <span>Moderate</span>
                        <span>High</span>
                        <span>Severe</span>
                    </div>
                </div>

                <div class="button-group">
                    <button type="submit" class="action-btn primary">‚ûï Add Process</button>
                    <button type="button" class="action-btn secondary" onclick="clearForm()">Clear Form</button>
                </div>
            </form>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection" style="display: none;">
            <h2 class="section-title">üìà BIA Analysis Results</h2>
            <div class="results-grid" id="summaryResults"></div>

            <!-- Timeline Visualization -->
            <div class="timeline-section">
                <h3 style="color: var(--shield-secondary);">Recovery Timeline (Highest Priority Process)</h3>
                <div class="timeline-visual" id="timelineVisual">
                    <div class="timeline-bar" id="timelineBar"></div>
                    <div class="timeline-markers" id="timelineMarkers"></div>
                    <div class="timeline-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: var(--info)"></div>
                            <span>RTO (Recovery Time)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: var(--warning)"></div>
                            <span>WRT (Work Recovery)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: var(--danger); opacity: 0.3"></div>
                            <span>MTD Buffer Zone</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Process List -->
        <div class="process-list">
            <h2 class="section-title">üìã Business Processes (Priority Order)</h2>
            <div id="processList">
                <div class="empty-state">
                    <div class="empty-state-icon">üìù</div>
                    <p>No processes added yet. Use the form above to add business processes for analysis.</p>
                </div>
            </div>
            <div class="button-group" id="exportButtons" style="display: none;">
                <button class="action-btn primary" onclick="exportReport()">üìÑ Export Report</button>
                <button class="action-btn secondary" onclick="clearAllProcesses()">üóëÔ∏è Clear All</button>
            </div>
        </div>

        <!-- Export Modal -->
        <div class="modal-overlay" id="exportModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üìÑ BIA Report</h3>
                    <button class="modal-close" onclick="closeModal()">&times;</button>
                </div>
                <pre id="reportContent" style="background: var(--bg-elevated); padding: 1rem; border-radius: 8px; overflow-x: auto; white-space: pre-wrap; font-size: 0.85rem;"></pre>
                <div class="button-group">
                    <button class="action-btn primary" onclick="copyReport()">üìã Copy to Clipboard</button>
                    <button class="action-btn secondary" onclick="closeModal()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State
        let processes = [];

        // Load saved data
        document.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('bia_processes');
            if (saved) {
                try {
                    processes = JSON.parse(saved);
                    renderProcessList();
                } catch(e) {}
            }
            setupSliders();
        });

        // Setup impact sliders
        function setupSliders() {
            const labels = ['Minimal', 'Low', 'Moderate', 'High', 'Severe'];

            ['financial', 'operational', 'reputational', 'legal'].forEach(type => {
                const slider = document.getElementById(type + 'Impact');
                const label = document.getElementById(type + 'Label');

                slider.addEventListener('input', () => {
                    label.textContent = labels[slider.value - 1];
                });
            });
        }

        // Convert time to hours
        function toHours(value, unit) {
            switch(unit) {
                case 'minutes': return value / 60;
                case 'hours': return value;
                case 'days': return value * 24;
                default: return value;
            }
        }

        // Format hours for display
        function formatTime(hours) {
            if (hours < 1) return `${Math.round(hours * 60)} min`;
            if (hours < 24) return `${hours.toFixed(1)} hrs`;
            return `${(hours / 24).toFixed(1)} days`;
        }

        // Calculate priority score
        function calculatePriority(process) {
            // Weight factors
            const weights = {
                mtd: 0.3,      // Lower MTD = higher priority
                impact: 0.5,   // Higher impact = higher priority
                rto: 0.2       // Lower RTO = higher priority
            };

            // Normalize MTD (inverse - lower is more critical)
            const mtdScore = Math.max(0, 100 - (process.mtdHours / 24) * 10);

            // Average impact score
            const impactScore = (process.financial + process.operational +
                               process.reputational + process.legal) / 4 * 20;

            // RTO urgency (inverse)
            const rtoScore = Math.max(0, 100 - (process.rtoHours / 24) * 10);

            return Math.round(
                mtdScore * weights.mtd +
                impactScore * weights.impact +
                rtoScore * weights.rto
            );
        }

        // Get priority level
        function getPriorityLevel(score) {
            if (score >= 75) return 'critical';
            if (score >= 50) return 'high';
            if (score >= 25) return 'medium';
            return 'low';
        }

        // Form submission
        document.getElementById('processForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const mtdHours = toHours(
                parseFloat(document.getElementById('mtdValue').value),
                document.getElementById('mtdUnit').value
            );
            const rtoHours = toHours(
                parseFloat(document.getElementById('rtoValue').value),
                document.getElementById('rtoUnit').value
            );
            const rpoHours = toHours(
                parseFloat(document.getElementById('rpoValue').value),
                document.getElementById('rpoUnit').value
            );
            const wrtHours = toHours(
                parseFloat(document.getElementById('wrtValue').value),
                document.getElementById('wrtUnit').value
            );

            // Validation: RTO + WRT should be less than MTD
            if (rtoHours + wrtHours > mtdHours) {
                alert('‚ö†Ô∏è Warning: RTO + WRT exceeds MTD. This means you cannot fully recover before maximum tolerable downtime.');
            }

            const process = {
                id: Date.now(),
                name: document.getElementById('processName').value,
                description: document.getElementById('processDesc').value,
                department: document.getElementById('processDept').value,
                dependencies: document.getElementById('processDeps').value,
                mtdHours,
                rtoHours,
                rpoHours,
                wrtHours,
                financial: parseInt(document.getElementById('financialImpact').value),
                operational: parseInt(document.getElementById('operationalImpact').value),
                reputational: parseInt(document.getElementById('reputationalImpact').value),
                legal: parseInt(document.getElementById('legalImpact').value)
            };

            process.priorityScore = calculatePriority(process);
            process.priorityLevel = getPriorityLevel(process.priorityScore);

            processes.push(process);
            saveProcesses();
            renderProcessList();
            clearForm();
        });

        function clearForm() {
            document.getElementById('processForm').reset();
            // Reset slider labels
            ['financial', 'operational', 'reputational', 'legal'].forEach(type => {
                document.getElementById(type + 'Label').textContent = 'Moderate';
            });
        }

        function saveProcesses() {
            localStorage.setItem('bia_processes', JSON.stringify(processes));
        }

        function renderProcessList() {
            const container = document.getElementById('processList');
            const resultsSection = document.getElementById('resultsSection');
            const exportButtons = document.getElementById('exportButtons');

            if (processes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <p>No processes added yet. Use the form above to add business processes for analysis.</p>
                    </div>
                `;
                resultsSection.style.display = 'none';
                exportButtons.style.display = 'none';
                return;
            }

            // Sort by priority score (descending)
            const sorted = [...processes].sort((a, b) => b.priorityScore - a.priorityScore);

            // Render summary
            resultsSection.style.display = 'block';
            exportButtons.style.display = 'flex';

            const criticalCount = sorted.filter(p => p.priorityLevel === 'critical').length;
            const highCount = sorted.filter(p => p.priorityLevel === 'high').length;
            const avgRto = sorted.reduce((sum, p) => sum + p.rtoHours, 0) / sorted.length;
            const minMtd = Math.min(...sorted.map(p => p.mtdHours));

            document.getElementById('summaryResults').innerHTML = `
                <div class="result-card">
                    <div class="result-label">Total Processes</div>
                    <div class="result-value">${sorted.length}</div>
                </div>
                <div class="result-card">
                    <div class="result-label">Critical Priority</div>
                    <div class="result-value critical">${criticalCount}</div>
                </div>
                <div class="result-card">
                    <div class="result-label">High Priority</div>
                    <div class="result-value high">${highCount}</div>
                </div>
                <div class="result-card">
                    <div class="result-label">Avg RTO</div>
                    <div class="result-value medium">${formatTime(avgRto)}</div>
                </div>
                <div class="result-card">
                    <div class="result-label">Shortest MTD</div>
                    <div class="result-value critical">${formatTime(minMtd)}</div>
                </div>
            `;

            // Render timeline for top priority process
            const topProcess = sorted[0];
            const totalTime = topProcess.mtdHours;
            const rtoPercent = (topProcess.rtoHours / totalTime) * 100;
            const wrtPercent = (topProcess.wrtHours / totalTime) * 100;
            const bufferPercent = 100 - rtoPercent - wrtPercent;

            document.getElementById('timelineBar').innerHTML = `
                <div class="timeline-segment rto" style="width: ${rtoPercent}%">RTO</div>
                <div class="timeline-segment wrt" style="left: ${rtoPercent}%; width: ${wrtPercent}%">WRT</div>
                ${bufferPercent > 0 ? `<div class="timeline-segment mtd" style="left: ${rtoPercent + wrtPercent}%; width: ${bufferPercent}%"></div>` : ''}
            `;

            document.getElementById('timelineMarkers').innerHTML = `
                <span>0</span>
                <span>${formatTime(topProcess.rtoHours)}</span>
                <span>${formatTime(topProcess.rtoHours + topProcess.wrtHours)}</span>
                <span>MTD: ${formatTime(topProcess.mtdHours)}</span>
            `;

            // Render table
            container.innerHTML = `
                <table class="process-table">
                    <thead>
                        <tr>
                            <th>Priority</th>
                            <th>Process</th>
                            <th>Department</th>
                            <th>MTD</th>
                            <th>RTO</th>
                            <th>RPO</th>
                            <th>Score</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${sorted.map((p, i) => `
                            <tr>
                                <td><span class="priority-badge ${p.priorityLevel}">#${i + 1} ${p.priorityLevel.toUpperCase()}</span></td>
                                <td>
                                    <strong>${p.name}</strong>
                                    ${p.description ? `<br><small style="color: var(--text-secondary)">${p.description}</small>` : ''}
                                </td>
                                <td>${p.department}</td>
                                <td>${formatTime(p.mtdHours)}</td>
                                <td>${formatTime(p.rtoHours)}</td>
                                <td>${formatTime(p.rpoHours)}</td>
                                <td><strong>${p.priorityScore}</strong>/100</td>
                                <td>
                                    <button class="action-btn danger" onclick="deleteProcess(${p.id})">üóëÔ∏è</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function deleteProcess(id) {
            if (confirm('Delete this process?')) {
                processes = processes.filter(p => p.id !== id);
                saveProcesses();
                renderProcessList();
            }
        }

        function clearAllProcesses() {
            if (confirm('Delete all processes? This cannot be undone.')) {
                processes = [];
                saveProcesses();
                renderProcessList();
            }
        }

        function exportReport() {
            const sorted = [...processes].sort((a, b) => b.priorityScore - a.priorityScore);
            const date = new Date().toLocaleDateString();

            let report = `BUSINESS IMPACT ANALYSIS REPORT
Generated: ${date}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

EXECUTIVE SUMMARY
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Total Business Processes Analyzed: ${sorted.length}
Critical Priority: ${sorted.filter(p => p.priorityLevel === 'critical').length}
High Priority: ${sorted.filter(p => p.priorityLevel === 'high').length}
Medium Priority: ${sorted.filter(p => p.priorityLevel === 'medium').length}
Low Priority: ${sorted.filter(p => p.priorityLevel === 'low').length}

KEY METRICS
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Shortest MTD: ${formatTime(Math.min(...sorted.map(p => p.mtdHours)))}
Average RTO: ${formatTime(sorted.reduce((sum, p) => sum + p.rtoHours, 0) / sorted.length)}
Average RPO: ${formatTime(sorted.reduce((sum, p) => sum + p.rpoHours, 0) / sorted.length)}

PROCESS PRIORITY LIST
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
`;

            sorted.forEach((p, i) => {
                report += `
${i + 1}. ${p.name.toUpperCase()} [${p.priorityLevel.toUpperCase()}]
   Department: ${p.department}
   Priority Score: ${p.priorityScore}/100
   MTD: ${formatTime(p.mtdHours)} | RTO: ${formatTime(p.rtoHours)} | RPO: ${formatTime(p.rpoHours)} | WRT: ${formatTime(p.wrtHours)}
   Impact Scores: Financial(${p.financial}) | Operational(${p.operational}) | Reputational(${p.reputational}) | Legal(${p.legal})
   ${p.dependencies ? `Dependencies: ${p.dependencies}` : ''}
   ${p.description ? `Description: ${p.description}` : ''}
`;
            });

            report += `
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
RECOMMENDATIONS
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1. Prioritize recovery resources for Critical and High priority processes
2. Ensure backup solutions meet RPO requirements for each process
3. Test recovery procedures regularly to validate RTO targets
4. Review and update BIA annually or when significant changes occur

Generated by Hexworth Prime Shield House - BIA Calculator
`;

            document.getElementById('reportContent').textContent = report;
            document.getElementById('exportModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('exportModal').classList.remove('active');
        }

        function copyReport() {
            const report = document.getElementById('reportContent').textContent;
            navigator.clipboard.writeText(report).then(() => {
                alert('Report copied to clipboard!');
            });
        }
    </script>
</body>
</html>
