<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRISC Risk Calculator | Shield House</title>
    <style>
        :root {
            --shield-primary: #f87171;
            --shield-secondary: #fca5a5;
            --bg-dark: #0f0f0f;
            --bg-card: #1a1a1a;
            --bg-elevated: #242424;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --border-color: #333;
            --success: #22c55e;
            --warning: #eab308;
            --danger: #ef4444;
            --info: #3b82f6;
            --purple: #a855f7;
            --cyan: #06b6d4;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--shield-primary), var(--shield-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .subtitle { color: var(--text-secondary); }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            margin-bottom: 1rem;
            transition: color 0.3s ease;
        }

        .back-link:hover { color: var(--shield-primary); }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .tab-btn:hover { background: var(--bg-elevated); color: var(--text-primary); }
        .tab-btn.active { background: var(--shield-primary); color: white; border-color: var(--shield-primary); }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Risk Appetite Section */
        .appetite-section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
        }

        .appetite-visual {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 2rem;
            margin: 2rem 0;
            height: 300px;
        }

        .appetite-bar {
            width: 100px;
            border-radius: 8px 8px 0 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            padding-bottom: 1rem;
            transition: height 0.5s ease;
            position: relative;
        }

        .appetite-bar.capacity {
            height: 100%;
            background: linear-gradient(to top, var(--danger), #991b1b);
        }

        .appetite-bar.tolerance {
            height: 70%;
            background: linear-gradient(to top, var(--warning), #a16207);
        }

        .appetite-bar.appetite {
            height: 50%;
            background: linear-gradient(to top, var(--success), #166534);
        }

        .appetite-label {
            color: white;
            font-weight: 700;
            text-align: center;
            font-size: 0.9rem;
        }

        .appetite-value {
            font-size: 1.5rem;
            margin-top: 0.5rem;
        }

        .appetite-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .control-card {
            background: var(--bg-elevated);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }

        .control-card h4 {
            margin-bottom: 1rem;
        }

        .control-card.capacity h4 { color: var(--danger); }
        .control-card.tolerance h4 { color: var(--warning); }
        .control-card.appetite h4 { color: var(--success); }

        .slider-container {
            margin: 1rem 0;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            appearance: none;
            cursor: pointer;
        }

        .slider.capacity { background: rgba(239, 68, 68, 0.3); }
        .slider.capacity::-webkit-slider-thumb { background: var(--danger); }
        .slider.tolerance { background: rgba(234, 179, 8, 0.3); }
        .slider.tolerance::-webkit-slider-thumb { background: var(--warning); }
        .slider.appetite { background: rgba(34, 197, 94, 0.3); }
        .slider.appetite::-webkit-slider-thumb { background: var(--success); }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
        }

        .control-value {
            font-size: 2rem;
            font-weight: 700;
        }

        /* Three Lines of Defense */
        .defense-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }

        .defense-line {
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .defense-line:hover {
            transform: translateY(-4px);
        }

        .defense-line.first { border-color: var(--info); }
        .defense-line.first:hover { box-shadow: 0 8px 24px rgba(59, 130, 246, 0.2); }
        .defense-line.second { border-color: var(--warning); }
        .defense-line.second:hover { box-shadow: 0 8px 24px rgba(234, 179, 8, 0.2); }
        .defense-line.third { border-color: var(--purple); }
        .defense-line.third:hover { box-shadow: 0 8px 24px rgba(168, 85, 247, 0.2); }

        .line-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .line-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .defense-line.first .line-title { color: var(--info); }
        .defense-line.second .line-title { color: var(--warning); }
        .defense-line.third .line-title { color: var(--purple); }

        .line-role {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .line-responsibilities {
            background: var(--bg-elevated);
            border-radius: 8px;
            padding: 1rem;
            text-align: left;
        }

        .line-responsibilities ul {
            list-style: none;
            font-size: 0.85rem;
        }

        .line-responsibilities li {
            padding: 0.25rem 0;
            padding-left: 1.25rem;
            position: relative;
        }

        .line-responsibilities li::before {
            content: '‚Üí';
            position: absolute;
            left: 0;
            color: var(--shield-primary);
        }

        /* Risk Matrix */
        .risk-matrix {
            display: grid;
            grid-template-columns: 60px repeat(5, 1fr);
            gap: 4px;
            margin: 2rem 0;
        }

        .matrix-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .matrix-cell.header {
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .matrix-cell.low { background: rgba(34, 197, 94, 0.3); color: var(--success); }
        .matrix-cell.medium { background: rgba(234, 179, 8, 0.3); color: var(--warning); }
        .matrix-cell.high { background: rgba(249, 115, 22, 0.3); color: #f97316; }
        .matrix-cell.critical { background: rgba(239, 68, 68, 0.3); color: var(--danger); }

        .matrix-cell:not(.header):hover {
            transform: scale(1.1);
            z-index: 10;
        }

        .matrix-cell.selected {
            outline: 3px solid var(--shield-primary);
            transform: scale(1.1);
        }

        /* Risk Calculator Form */
        .calculator-section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .calc-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .form-section {
            background: var(--bg-elevated);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .section-title {
            color: var(--shield-secondary);
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--shield-primary);
        }

        /* Results Display */
        .result-display {
            text-align: center;
            padding: 2rem;
            background: var(--bg-elevated);
            border-radius: 12px;
        }

        .risk-score {
            font-size: 5rem;
            font-weight: 700;
            line-height: 1;
        }

        .risk-score.low { color: var(--success); }
        .risk-score.medium { color: var(--warning); }
        .risk-score.high { color: #f97316; }
        .risk-score.critical { color: var(--danger); }

        .risk-level {
            font-size: 1.5rem;
            margin-top: 0.5rem;
        }

        .risk-treatment {
            margin-top: 1.5rem;
            text-align: left;
            background: var(--bg-card);
            border-radius: 8px;
            padding: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .btn.primary { background: var(--shield-primary); color: white; }
        .btn.primary:hover { background: #dc2626; }

        .button-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
        }

        /* Risk Register */
        .register-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .register-table th, .register-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .register-table th {
            background: var(--bg-card);
            color: var(--shield-primary);
        }

        .risk-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .risk-badge.low { background: rgba(34, 197, 94, 0.2); color: var(--success); }
        .risk-badge.medium { background: rgba(234, 179, 8, 0.2); color: var(--warning); }
        .risk-badge.high { background: rgba(249, 115, 22, 0.2); color: #f97316; }
        .risk-badge.critical { background: rgba(239, 68, 68, 0.2); color: var(--danger); }

        @media (max-width: 900px) {
            .defense-container { grid-template-columns: 1fr; }
            .appetite-controls { grid-template-columns: 1fr; }
            .calc-grid { grid-template-columns: 1fr; }
            .appetite-visual { flex-direction: row; height: auto; }
            .appetite-bar { height: 150px !important; width: 80px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../../index.html" class="back-link">‚Üê Back to Shield House</a>

        <header>
            <h1>üìä CRISC Risk Calculator</h1>
            <p class="subtitle">Risk Appetite, Three Lines of Defense, and Risk Assessment Tools</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" data-tab="appetite">üìà Risk Appetite</button>
            <button class="tab-btn" data-tab="defense">üõ°Ô∏è Three Lines</button>
            <button class="tab-btn" data-tab="matrix">üéØ Risk Matrix</button>
            <button class="tab-btn" data-tab="register">üìã Risk Register</button>
        </div>

        <!-- Risk Appetite Tab -->
        <div id="appetite" class="tab-content active">
            <div class="appetite-section">
                <h2 style="color: var(--shield-primary); text-align: center; margin-bottom: 1rem;">Risk Appetite, Tolerance & Capacity</h2>
                <p style="text-align: center; color: var(--text-secondary); margin-bottom: 2rem;">
                    Visualize the relationship between how much risk your organization CAN take, WILL take, and ALLOWS to vary
                </p>

                <div class="appetite-visual">
                    <div class="appetite-bar appetite" id="appetiteBar">
                        <span class="appetite-label">APPETITE<br><span class="appetite-value" id="appetiteValue">50%</span></span>
                    </div>
                    <div class="appetite-bar tolerance" id="toleranceBar">
                        <span class="appetite-label">TOLERANCE<br><span class="appetite-value" id="toleranceValue">70%</span></span>
                    </div>
                    <div class="appetite-bar capacity" id="capacityBar">
                        <span class="appetite-label">CAPACITY<br><span class="appetite-value" id="capacityValue">100%</span></span>
                    </div>
                </div>

                <div class="appetite-controls">
                    <div class="control-card appetite">
                        <h4>üü¢ Risk Appetite</h4>
                        <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1rem;">
                            Amount of risk the organization is <strong>willing to accept</strong>. Set by Board/Owners.
                        </p>
                        <div class="slider-container">
                            <input type="range" class="slider appetite" id="appetiteSlider" min="10" max="90" value="50" oninput="updateAppetite()">
                        </div>
                        <div class="control-value" id="appetiteDisplay">50%</div>
                    </div>

                    <div class="control-card tolerance">
                        <h4>üü° Risk Tolerance</h4>
                        <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1rem;">
                            Acceptable <strong>variation</strong> from appetite. Allows occasional approved deviations.
                        </p>
                        <div class="slider-container">
                            <input type="range" class="slider tolerance" id="toleranceSlider" min="10" max="90" value="70" oninput="updateAppetite()">
                        </div>
                        <div class="control-value" id="toleranceDisplay">70%</div>
                    </div>

                    <div class="control-card capacity">
                        <h4>üî¥ Risk Capacity</h4>
                        <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1rem;">
                            Maximum loss the org can take <strong>without failing</strong>. The absolute limit.
                        </p>
                        <div class="slider-container">
                            <input type="range" class="slider capacity" id="capacitySlider" min="50" max="100" value="100" oninput="updateAppetite()">
                        </div>
                        <div class="control-value" id="capacityDisplay">100%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Three Lines Tab -->
        <div id="defense" class="tab-content">
            <h2 style="color: var(--shield-primary); text-align: center; margin-bottom: 2rem;">Three Lines of Defense Model</h2>

            <div class="defense-container">
                <div class="defense-line first">
                    <div class="line-icon">‚öôÔ∏è</div>
                    <div class="line-title">First Line</div>
                    <div class="line-role">Operational Management</div>
                    <div class="line-responsibilities">
                        <ul>
                            <li>Owns and manages risks</li>
                            <li>Implements internal controls</li>
                            <li>Day-to-day risk decisions</li>
                            <li>Maintains control environment</li>
                            <li>Business unit level responsibility</li>
                        </ul>
                    </div>
                </div>

                <div class="defense-line second">
                    <div class="line-icon">üìã</div>
                    <div class="line-title">Second Line</div>
                    <div class="line-role">Risk & Compliance Functions</div>
                    <div class="line-responsibilities">
                        <ul>
                            <li>Oversees risk management</li>
                            <li>Develops policies & frameworks</li>
                            <li>Monitors first line controls</li>
                            <li>Compliance monitoring</li>
                            <li>Risk practitioner operates here</li>
                        </ul>
                    </div>
                </div>

                <div class="defense-line third">
                    <div class="line-icon">üîç</div>
                    <div class="line-title">Third Line</div>
                    <div class="line-role">Internal Audit</div>
                    <div class="line-responsibilities">
                        <ul>
                            <li>Independent assurance</li>
                            <li>Objective reviews</li>
                            <li>Evaluates 1st & 2nd lines</li>
                            <li>Reports to Board/Audit Committee</li>
                            <li>Validates risk management design</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div style="background: var(--bg-card); border-radius: 12px; padding: 1.5rem; margin-top: 2rem; text-align: center;">
                <p style="color: var(--text-secondary);">
                    <strong>Key Insight:</strong> Risk practitioners work across the first TWO lines of defense.
                    Auditors in the third line provide information TO risk practitioners for board reporting.
                </p>
            </div>
        </div>

        <!-- Risk Matrix Tab -->
        <div id="matrix" class="tab-content">
            <div class="calculator-section">
                <h2 style="color: var(--shield-primary); text-align: center; margin-bottom: 1rem;">Risk Assessment Calculator</h2>
                <p style="text-align: center; color: var(--text-secondary); margin-bottom: 2rem;">
                    Risk Score = Likelihood √ó Impact. Click on the matrix or use the form below.
                </p>

                <div class="risk-matrix" id="riskMatrix"></div>

                <div class="calc-grid">
                    <div class="form-section">
                        <h3 class="section-title">üìù Risk Details</h3>
                        <div class="form-group">
                            <label>Risk Name</label>
                            <input type="text" id="riskName" placeholder="e.g., Data breach via phishing">
                        </div>
                        <div class="form-group">
                            <label>Likelihood (1-5)</label>
                            <select id="likelihood" onchange="calculateRisk()">
                                <option value="1">1 - Rare (< 5%)</option>
                                <option value="2">2 - Unlikely (5-25%)</option>
                                <option value="3" selected>3 - Possible (25-50%)</option>
                                <option value="4">4 - Likely (50-75%)</option>
                                <option value="5">5 - Almost Certain (> 75%)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Impact (1-5)</label>
                            <select id="impact" onchange="calculateRisk()">
                                <option value="1">1 - Negligible</option>
                                <option value="2">2 - Minor</option>
                                <option value="3" selected>3 - Moderate</option>
                                <option value="4">4 - Major</option>
                                <option value="5">5 - Catastrophic</option>
                            </select>
                        </div>
                        <div class="button-group">
                            <button class="btn primary" onclick="addToRegister()">Add to Register</button>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3 class="section-title">üìä Risk Result</h3>
                        <div class="result-display">
                            <div class="risk-score medium" id="riskScoreDisplay">9</div>
                            <div class="risk-level" id="riskLevelDisplay">MEDIUM RISK</div>
                            <div class="risk-treatment" id="riskTreatment">
                                <strong>Recommended Treatment:</strong>
                                <p id="treatmentText">Monitor and review regularly. Consider mitigation controls.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Risk Register Tab -->
        <div id="register" class="tab-content">
            <h2 style="color: var(--shield-primary); margin-bottom: 1rem;">üìã Risk Register</h2>
            <p style="color: var(--text-secondary); margin-bottom: 1rem;">Track and manage identified risks. Add risks from the Risk Matrix tab.</p>

            <div id="registerList">
                <table class="register-table">
                    <thead>
                        <tr>
                            <th>Risk ID</th>
                            <th>Risk Name</th>
                            <th>Likelihood</th>
                            <th>Impact</th>
                            <th>Score</th>
                            <th>Level</th>
                            <th>Treatment</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="registerBody">
                        <tr>
                            <td colspan="8" style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                                No risks registered yet. Go to the Risk Matrix tab to add risks.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let risks = [];
        let riskIdCounter = 1;

        // Tab Navigation
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tabId = btn.dataset.tab;
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Risk Appetite
        function updateAppetite() {
            const appetite = document.getElementById('appetiteSlider').value;
            const tolerance = document.getElementById('toleranceSlider').value;
            const capacity = document.getElementById('capacitySlider').value;

            document.getElementById('appetiteDisplay').textContent = appetite + '%';
            document.getElementById('toleranceDisplay').textContent = tolerance + '%';
            document.getElementById('capacityDisplay').textContent = capacity + '%';

            document.getElementById('appetiteValue').textContent = appetite + '%';
            document.getElementById('toleranceValue').textContent = tolerance + '%';
            document.getElementById('capacityValue').textContent = capacity + '%';

            document.getElementById('appetiteBar').style.height = appetite + '%';
            document.getElementById('toleranceBar').style.height = tolerance + '%';
            document.getElementById('capacityBar').style.height = capacity + '%';
        }

        // Risk Matrix
        function initMatrix() {
            const matrix = document.getElementById('riskMatrix');
            const levels = ['', 'Negligible', 'Minor', 'Moderate', 'Major', 'Catastrophic'];
            const likelihoods = ['Almost Certain', 'Likely', 'Possible', 'Unlikely', 'Rare'];

            matrix.innerHTML = '';

            // Header row
            for (let i = 0; i < 6; i++) {
                const cell = document.createElement('div');
                cell.className = 'matrix-cell header';
                cell.textContent = i === 0 ? 'L / I' : levels[i];
                matrix.appendChild(cell);
            }

            // Matrix rows
            for (let l = 5; l >= 1; l--) {
                // Row header
                const header = document.createElement('div');
                header.className = 'matrix-cell header';
                header.textContent = likelihoods[5 - l];
                matrix.appendChild(header);

                // Risk cells
                for (let i = 1; i <= 5; i++) {
                    const score = l * i;
                    const cell = document.createElement('div');
                    cell.className = 'matrix-cell ' + getRiskLevel(score);
                    cell.textContent = score;
                    cell.dataset.likelihood = l;
                    cell.dataset.impact = i;
                    cell.onclick = () => selectMatrixCell(l, i, cell);
                    matrix.appendChild(cell);
                }
            }
        }

        function selectMatrixCell(l, i, cell) {
            document.querySelectorAll('.matrix-cell').forEach(c => c.classList.remove('selected'));
            cell.classList.add('selected');
            document.getElementById('likelihood').value = l;
            document.getElementById('impact').value = i;
            calculateRisk();
        }

        function getRiskLevel(score) {
            if (score <= 4) return 'low';
            if (score <= 9) return 'medium';
            if (score <= 16) return 'high';
            return 'critical';
        }

        function getRiskLevelText(score) {
            if (score <= 4) return 'LOW';
            if (score <= 9) return 'MEDIUM';
            if (score <= 16) return 'HIGH';
            return 'CRITICAL';
        }

        function getTreatment(score) {
            if (score <= 4) return 'Accept the risk. Monitor periodically for changes.';
            if (score <= 9) return 'Monitor regularly. Consider implementing additional controls.';
            if (score <= 16) return 'Implement risk mitigation controls. Escalate to management.';
            return 'Immediate action required. Avoid, transfer, or implement urgent controls.';
        }

        function calculateRisk() {
            const l = parseInt(document.getElementById('likelihood').value);
            const i = parseInt(document.getElementById('impact').value);
            const score = l * i;
            const level = getRiskLevel(score);

            document.getElementById('riskScoreDisplay').textContent = score;
            document.getElementById('riskScoreDisplay').className = 'risk-score ' + level;
            document.getElementById('riskLevelDisplay').textContent = getRiskLevelText(score) + ' RISK';
            document.getElementById('treatmentText').textContent = getTreatment(score);

            // Highlight in matrix
            document.querySelectorAll('.matrix-cell').forEach(cell => {
                cell.classList.remove('selected');
                if (cell.dataset.likelihood == l && cell.dataset.impact == i) {
                    cell.classList.add('selected');
                }
            });
        }

        function addToRegister() {
            const name = document.getElementById('riskName').value || 'Unnamed Risk';
            const l = parseInt(document.getElementById('likelihood').value);
            const i = parseInt(document.getElementById('impact').value);
            const score = l * i;

            risks.push({
                id: 'R-' + String(riskIdCounter++).padStart(3, '0'),
                name: name,
                likelihood: l,
                impact: i,
                score: score,
                level: getRiskLevel(score),
                treatment: 'Mitigate'
            });

            renderRegister();
            document.getElementById('riskName').value = '';

            // Switch to register tab
            document.querySelector('[data-tab="register"]').click();
        }

        function renderRegister() {
            const body = document.getElementById('registerBody');

            if (risks.length === 0) {
                body.innerHTML = `<tr><td colspan="8" style="text-align: center; color: var(--text-secondary); padding: 2rem;">No risks registered yet.</td></tr>`;
                return;
            }

            body.innerHTML = risks.sort((a, b) => b.score - a.score).map(r => `
                <tr>
                    <td>${r.id}</td>
                    <td>${r.name}</td>
                    <td>${r.likelihood}</td>
                    <td>${r.impact}</td>
                    <td><strong>${r.score}</strong></td>
                    <td><span class="risk-badge ${r.level}">${r.level.toUpperCase()}</span></td>
                    <td>
                        <select style="padding: 0.25rem; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary);">
                            <option>Mitigate</option>
                            <option>Accept</option>
                            <option>Transfer</option>
                            <option>Avoid</option>
                        </select>
                    </td>
                    <td><button onclick="deleteRisk('${r.id}')" style="background: transparent; border: none; color: var(--danger); cursor: pointer;">üóëÔ∏è</button></td>
                </tr>
            `).join('');
        }

        function deleteRisk(id) {
            risks = risks.filter(r => r.id !== id);
            renderRegister();
        }

        // Initialize
        initMatrix();
        calculateRisk();

        // Load saved risks
        const savedRisks = localStorage.getItem('crisc_risks');
        if (savedRisks) {
            try {
                risks = JSON.parse(savedRisks);
                riskIdCounter = risks.length > 0 ? parseInt(risks[risks.length - 1].id.split('-')[1]) + 1 : 1;
                renderRegister();
            } catch(e) {}
        }

        // Save on change
        setInterval(() => {
            localStorage.setItem('crisc_risks', JSON.stringify(risks));
        }, 5000);
    </script>
</body>
</html>
