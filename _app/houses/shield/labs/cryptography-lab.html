<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cryptography Lab - Shield House</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(248, 113, 113, 0.1), rgba(248, 113, 113, 0.05));
            border-radius: 16px;
            border: 1px solid rgba(248, 113, 113, 0.3);
        }

        .header h1 {
            font-size: 2.2rem;
            color: #f87171;
            margin-bottom: 10px;
        }

        .header p {
            color: #a0a0a0;
            font-size: 1.1rem;
        }

        .progress-bar {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            height: 12px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f87171, #fb923c);
            border-radius: 10px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .progress-text {
            text-align: center;
            color: #888;
            font-size: 0.9rem;
        }

        .exercise {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 25px;
            overflow: hidden;
        }

        .exercise-header {
            background: rgba(248, 113, 113, 0.1);
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .exercise-header:hover {
            background: rgba(248, 113, 113, 0.15);
        }

        .exercise-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .exercise-number {
            background: #f87171;
            color: #000;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .exercise-name {
            font-size: 1.2rem;
            color: #fff;
        }

        .exercise-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
        }

        .status-pending {
            background: rgba(100, 100, 100, 0.3);
            color: #888;
        }

        .status-complete {
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
        }

        .exercise-content {
            padding: 25px;
            display: none;
        }

        .exercise.active .exercise-content {
            display: block;
        }

        .scenario {
            background: rgba(59, 130, 246, 0.1);
            border-left: 4px solid #3b82f6;
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
        }

        .scenario h4 {
            color: #60a5fa;
            margin-bottom: 8px;
        }

        .task-list {
            list-style: none;
            margin: 20px 0;
        }

        .task-item {
            padding: 12px 15px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .task-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #f87171;
        }

        .task-item.checked {
            background: rgba(74, 222, 128, 0.05);
            border-color: rgba(74, 222, 128, 0.2);
        }

        .task-item.checked label {
            text-decoration: line-through;
            color: #666;
        }

        .applet-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(248, 113, 113, 0.15);
            color: #f87171;
            padding: 10px 18px;
            border-radius: 8px;
            text-decoration: none;
            margin: 10px 10px 10px 0;
            border: 1px solid rgba(248, 113, 113, 0.3);
            transition: all 0.3s;
        }

        .applet-link:hover {
            background: rgba(248, 113, 113, 0.25);
            transform: translateY(-2px);
        }

        .question-section {
            background: rgba(168, 85, 247, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .question-section h4 {
            color: #a855f7;
            margin-bottom: 15px;
        }

        .question-section textarea {
            width: 100%;
            min-height: 100px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: #e0e0e0;
            font-family: inherit;
            resize: vertical;
        }

        .question-section textarea:focus {
            outline: none;
            border-color: #a855f7;
        }

        .complete-btn {
            background: linear-gradient(135deg, #f87171, #fb923c);
            color: #000;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .complete-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(248, 113, 113, 0.4);
        }

        .complete-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .diagram {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            white-space: pre;
            color: #4ade80;
        }

        .concept-box {
            background: rgba(251, 191, 36, 0.1);
            border-left: 3px solid #fbbf24;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        .concept-box h4 {
            color: #fbbf24;
            margin-bottom: 10px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .comparison-table th, .comparison-table td {
            border: 1px solid rgba(255,255,255,0.1);
            padding: 10px;
            text-align: left;
        }

        .comparison-table th {
            background: rgba(248, 113, 113, 0.2);
            color: #f87171;
        }

        .comparison-table tr:nth-child(even) {
            background: rgba(255,255,255,0.02);
        }

        .completion-badge {
            display: none;
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.1), rgba(34, 197, 94, 0.05));
            border-radius: 16px;
            border: 2px solid rgba(74, 222, 128, 0.3);
            margin-top: 30px;
        }

        .completion-badge.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .completion-badge h2 {
            color: #4ade80;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .badge-icon {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .next-steps {
            margin-top: 20px;
        }

        .next-steps a {
            display: inline-block;
            background: #f87171;
            color: #000;
            padding: 12px 25px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            margin: 5px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #888;
            text-decoration: none;
            margin-bottom: 20px;
        }

        .back-link:hover {
            color: #f87171;
        }

        .code-block {
            background: #0d1117;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .math-formula {
            background: rgba(139, 92, 246, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            text-align: center;
            font-size: 1.1rem;
            color: #a78bfa;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† Back to Shield House</a>

        <div class="header">
            <h1>ğŸ” Cryptography Lab</h1>
            <p>Hands-on exercises in encryption, hashing, key exchange, and digital signatures</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text"><span id="completedCount">0</span> of 6 exercises completed</div>
        </div>

        <!-- Exercise 1: Symmetric vs Asymmetric -->
        <div class="exercise active" data-exercise="1">
            <div class="exercise-header" onclick="toggleExercise(1)">
                <div class="exercise-title">
                    <div class="exercise-number">1</div>
                    <div class="exercise-name">Symmetric vs Asymmetric Encryption</div>
                </div>
                <span class="exercise-status status-pending" id="status1">Pending</span>
            </div>
            <div class="exercise-content">
                <div class="scenario">
                    <h4>ğŸ“‹ Concept Overview</h4>
                    <p>Understanding the fundamental difference between symmetric and asymmetric cryptography is essential for designing secure systems.</p>
                </div>

                <table class="comparison-table">
                    <tr>
                        <th>Aspect</th>
                        <th>Symmetric</th>
                        <th>Asymmetric</th>
                    </tr>
                    <tr>
                        <td>Keys</td>
                        <td>Single shared key</td>
                        <td>Public/Private key pair</td>
                    </tr>
                    <tr>
                        <td>Speed</td>
                        <td>Fast (1000x faster)</td>
                        <td>Slower (computationally intensive)</td>
                    </tr>
                    <tr>
                        <td>Key Distribution</td>
                        <td>Challenging (must be secure)</td>
                        <td>Easy (public key shareable)</td>
                    </tr>
                    <tr>
                        <td>Examples</td>
                        <td>AES, 3DES, ChaCha20</td>
                        <td>RSA, ECC, Diffie-Hellman</td>
                    </tr>
                    <tr>
                        <td>Use Case</td>
                        <td>Bulk data encryption</td>
                        <td>Key exchange, digital signatures</td>
                    </tr>
                </table>

                <h4>ğŸ¯ Tasks</h4>
                <ul class="task-list">
                    <li class="task-item">
                        <input type="checkbox" id="t1-1" onchange="checkTask(1)">
                        <label for="t1-1">Explore the Encryption Visualizer to see symmetric encryption in action</label>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="t1-2" onchange="checkTask(1)">
                        <label for="t1-2">Use the RSA Visualizer to understand public/private key relationships</label>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="t1-3" onchange="checkTask(1)">
                        <label for="t1-3">Compare the key lengths: AES-256 vs RSA-2048 - why the difference?</label>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="t1-4" onchange="checkTask(1)">
                        <label for="t1-4">Identify which type is used for TLS session keys vs certificate verification</label>
                    </li>
                </ul>

                <a href="../applets/crypto/encryption/encryption.html" class="applet-link">ğŸ”’ Encryption Visualizer</a>
                <a href="../applets/crypto/rsa/RSAVisualizer.html" class="applet-link">ğŸ”‘ RSA Visualizer</a>

                <div class="question-section">
                    <h4>ğŸ’­ Analysis Question</h4>
                    <p>In TLS/HTTPS, we use asymmetric cryptography first, then switch to symmetric. Why is this hybrid approach necessary?</p>
                    <textarea id="q1" placeholder="Explain the hybrid approach..."></textarea>
                </div>

                <button class="complete-btn" onclick="completeExercise(1)" id="btn1">Mark Complete</button>
            </div>
        </div>

        <!-- Exercise 2: Hashing and Integrity -->
        <div class="exercise" data-exercise="2">
            <div class="exercise-header" onclick="toggleExercise(2)">
                <div class="exercise-title">
                    <div class="exercise-number">2</div>
                    <div class="exercise-name">Hashing and Data Integrity</div>
                </div>
                <span class="exercise-status status-pending" id="status2">Pending</span>
            </div>
            <div class="exercise-content">
                <div class="scenario">
                    <h4>ğŸ“‹ Scenario</h4>
                    <p>Hash functions are one-way functions that convert any input into a fixed-size output. They're critical for password storage, file integrity, and digital signatures.</p>
                </div>

                <div class="concept-box">
                    <h4>Hash Properties</h4>
                    <ul style="margin-left: 20px;">
                        <li><strong>Deterministic:</strong> Same input always produces same output</li>
                        <li><strong>One-way:</strong> Cannot reverse the hash to get original input</li>
                        <li><strong>Collision-resistant:</strong> Hard to find two inputs with same hash</li>
                        <li><strong>Avalanche effect:</strong> Small change = completely different hash</li>
                    </ul>
                </div>

                <div class="diagram">
Input: "Hello World"
       â†“
   SHA-256
       â†“
Hash: a591a6d40bf420404a011733cfb7b190d62c65bf0bcda32b...

Input: "Hello World!"  (just added !)
       â†“
   SHA-256
       â†“
Hash: 7f83b1657ff1fc53b92dc18148a1d65dfc2d4b1fa3d67728... (completely different!)
                </div>

                <h4>ğŸ¯ Tasks</h4>
                <ul class="task-list">
                    <li class="task-item">
                        <input type="checkbox" id="t2-1" onchange="checkTask(2)">
                        <label for="t2-1">Use the Hashing Visualizer to generate hashes of sample text</label>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="t2-2" onchange="checkTask(2)">
                        <label for="t2-2">Demonstrate the avalanche effect by changing one character</label>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="t2-3" onchange="checkTask(2)">
                        <label for="t2-3">Use the Checksum Verifier to validate file integrity</label>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="t2-4" onchange="checkTask(2)">
                        <label for="t2-4">Compare MD5, SHA-1, and SHA-256 output lengths and security levels</label>
                    </li>
                </ul>

                <a href="../applets/crypto/hashing/hashing.html" class="applet-link">#ï¸âƒ£ Hashing Visualizer</a>
                <a href="../applets/crypto/checksum-verifier.html" class="applet-link">âœ… Checksum Verifier</a>

                <table class="comparison-table">
                    <tr>
                        <th>Algorithm</th>
                        <th>Output Size</th>
                        <th>Status</th>
                    </tr>
                    <tr>
                        <td>MD5</td>
                        <td>128 bits (32 hex chars)</td>
                        <td style="color:#f87171;">âŒ Broken - collisions found</td>
                    </tr>
                    <tr>
                        <td>SHA-1</td>
                        <td>160 bits (40 hex chars)</td>
                        <td style="color:#fbbf24;">âš ï¸ Deprecated - avoid for security</td>
                    </tr>
                    <tr>
                        <td>SHA-256</td>
                        <td>256 bits (64 hex chars)</td>
                        <td style="color:#4ade80;">âœ… Secure - recommended</td>
                    </tr>
                    <tr>
                        <td>SHA-3</td>
                        <td>Variable (224-512 bits)</td>
                        <td style="color:#22c55e;">âœ… Latest standard</td>
                    </tr>
                </table>

                <div class="question-section">
                    <h4>ğŸ’­ Application Question</h4>
                    <p>Why do we use password hashing with salt instead of encryption for storing passwords? What additional protection does salting provide?</p>
                    <textarea id="q2" placeholder="Explain password hashing vs encryption..."></textarea>
                </div>

                <button class="complete-btn" onclick="completeExercise(2)" id="btn2">Mark Complete</button>
            </div>
        </div>

        <!-- Exercise 3: Key Exchange -->
        <div class="exercise" data-exercise="3">
            <div class="exercise-header" onclick="toggleExercise(3)">
                <div class="exercise-title">
                    <div class="exercise-number">3</div>
                    <div class="exercise-name">Diffie-Hellman Key Exchange</div>
                </div>
                <span class="exercise-status status-pending" id="status3">Pending</span>
            </div>
            <div class="exercise-content">
                <div class="scenario">
                    <h4>ğŸ“‹ The Key Distribution Problem</h4>
                    <p>How can two parties who have never met agree on a shared secret key over an insecure channel? Diffie-Hellman solves this elegantly using the mathematics of modular exponentiation.</p>
                </div>

                <div class="diagram">
Alice                              Eve (Eavesdropper)                    Bob
  â”‚                                        â”‚                              â”‚
  â”‚  Generate private: a                   â”‚      Generate private: b     â”‚
  â”‚  Compute public: A = g^a mod p         â”‚      Compute public: B = g^b mod p
  â”‚                                        â”‚                              â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Send A â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Send B â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                                        â”‚                              â”‚
  â”‚  Eve sees: g, p, A, B                  â”‚                              â”‚
  â”‚  But cannot compute: g^(ab) mod p      â”‚                              â”‚
  â”‚                                        â”‚                              â”‚
  â”‚  Compute: s = B^a mod p = g^(ab) mod p â”‚      s = A^b mod p = g^(ab) mod p
  â”‚                                        â”‚                              â”‚
  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SAME SHARED SECRET! â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
                </div>

                <div class="math-formula">
                    Shared Secret: s = g<sup>ab</sup> mod p
                </div>

                <h4>ğŸ¯ Tasks</h4>
                <ul class="task-list">
                    <li class="task-item">
                        <input type="checkbox" id="t3-1" onchange="checkTask(3)">
                        <label for="t3-1">Use the Diffie-Hellman Visualizer to step through the exchange process</label>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="t3-2" onchange="checkTask(3)">
                        <label for="t3-2">Verify that both parties arrive at the same shared secret</label>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="t3-3" onchange="checkTask(3)">
                        <label for="t3-3">Understand why Eve cannot compute the secret even with all public values</label>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="t3-4" onchange="checkTask(3)">
                        <label for="t3-4">Explore the Prime Factorization tool to understand why large primes matter</label>
                    </li>
                </ul>

                <a href="../applets/crypto/diffie_hellman/diffie-hellman.html" class="applet-link">ğŸ”„ Diffie-Hellman Visualizer</a>
                <a href="../applets/crypto/factor_prime/factor-prime.html" class="applet-link">ğŸ”¢ Prime Factorization</a>

                <div class="concept-box">
                    <h4>Security Note</h4>
                    <p>Basic Diffie-Hellman is vulnerable to man-in-the-middle attacks! That's why TLS uses authenticated DH variants (DHE with certificates or ECDHE with ephemeral keys).</p>
                </div>

                <div class="question-section">
                    <h4>ğŸ’­ Security Analysis</h4>
                    <p>How could a man-in-the-middle attack work against basic Diffie-Hellman? How does certificate authentication prevent this?</p>
                    <textarea id="q3" placeholder="Describe the MITM attack scenario..."></textarea>
                </div>

                <button class="complete-btn" onclick="completeExercise(3)" id="btn3">Mark Complete</button>
            </div>
        </div>

        <!-- Exercise 4: Digital Signatures -->
        <div class="exercise" data-exercise="4">
            <div class="exercise-header" onclick="toggleExercise(4)">
                <div class="exercise-title">
                    <div class="exercise-number">4</div>
                    <div class="exercise-name">Digital Signatures</div>
                </div>
                <span class="exercise-status status-pending" id="status4">Pending</span>
            </div>
            <div class="exercise-content">
                <div class="scenario">
                    <h4>ğŸ“‹ Authentication and Non-Repudiation</h4>
                    <p>Digital signatures prove that a message came from a specific sender and hasn't been modified. They combine hashing with asymmetric cryptography.</p>
                </div>

                <div class="diagram">
SIGNING (Sender)                         VERIFICATION (Receiver)

Document: "Contract..."                  Received: Document + Signature
     â”‚                                        â”‚
     â–¼                                        â”‚
  SHA-256                                     â”‚
     â”‚                                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â–¼                                        â”‚                      â”‚
Hash: 7f83b16...                         Document                 Signature
     â”‚                                        â”‚                      â”‚
     â–¼                                        â–¼                      â–¼
Private Key Encrypt                      SHA-256              Public Key Decrypt
     â”‚                                        â”‚                      â”‚
     â–¼                                        â–¼                      â–¼
Signature: Ax7Kp2...                    Hash: 7f83b16...      Hash: 7f83b16...
                                              â”‚                      â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€ = â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â†“
                                              âœ… VALID SIGNATURE
                </div>

                <h4>ğŸ¯ Tasks</h4>
                <ul class="task-list">
                    <li class="task-item">
                        <input type="checkbox" id="t4-1" onchange="checkTask(4)">
                        <label for="t4-1">Use the Digital Signatures Visualizer to sign a sample message</label>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="t4-2" onchange="checkTask(4)">
                        <label for="t4-2">Verify the signature using the sender's public key</label>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="t4-3" onchange="checkTask(4)">
                        <label for="t4-3">Modify the message and observe the verification failure</label>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="t4-4" onchange="checkTask(4)">
                        <label for="t4-4">Compare signing (private key) vs encryption (public key) operations</label>
                    </li>
                </ul>

                <a href="../applets/crypto/digital_signatures/digital-signatures.html" class="applet-link">âœï¸ Digital Signatures</a>
                <a href="../applets/crypto/gpg-encryption-lab.html" class="applet-link">ğŸ” GPG Encryption Lab</a>

                <div class="question-section">
                    <h4>ğŸ’­ Real-World Application</h4>
                    <p>How do digital signatures enable code signing for software distribution? What would happen if an attacker modified a signed Windows update?</p>
                    <textarea id="q4" placeholder="Explain code signing and its protections..."></textarea>
                </div>

                <button class="complete-btn" onclick="completeExercise(4)" id="btn4">Mark Complete</button>
            </div>
        </div>

        <!-- Exercise 5: PKI and Certificates -->
        <div class="exercise" data-exercise="5">
            <div class="exercise-header" onclick="toggleExercise(5)">
                <div class="exercise-title">
                    <div class="exercise-number">5</div>
                    <div class="exercise-name">PKI and Certificates</div>
                </div>
                <span class="exercise-status status-pending" id="status5">Pending</span>
            </div>
            <div class="exercise-content">
                <div class="scenario">
                    <h4>ğŸ“‹ Trust Hierarchies</h4>
                    <p>Public Key Infrastructure (PKI) solves the trust problem: how do you know a public key really belongs to who claims to own it? Certificate Authorities (CAs) vouch for identities.</p>
                </div>

                <div class="diagram">
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   Root CA       â”‚  Self-signed (Pre-installed in browsers/OS)
                        â”‚   (Trust Anchor)â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚ Signs
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Intermediate CA â”‚  Signed by Root CA
                        â”‚                 â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚ Signs
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  End-Entity     â”‚  Website certificate
                        â”‚  Certificate    â”‚  (e.g., google.com)
                        â”‚  CN=google.com  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                </div>

                <h4>ğŸ¯ Tasks</h4>
                <ul class="task-list">
                    <li class="task-item">
                        <input type="checkbox" id="t5-1" onchange="checkTask(5)">
                        <label for="t5-1">Explore the PKI Visualizer to understand certificate chains</label>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="t5-2" onchange="checkTask(5)">
                        <label for="t5-2">Examine a real website certificate (click the lock icon in your browser)</label>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="t5-3" onchange="checkTask(5)">
                        <label for="t5-3">Identify the Root CA, Intermediate CA, and end-entity certificate</label>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="t5-4" onchange="checkTask(5)">
                        <label for="t5-4">Understand Certificate Revocation Lists (CRL) and OCSP</label>
                    </li>
                </ul>

                <a href="../applets/crypto/pki/PKIExplorer.html" class="applet-link">ğŸ“œ PKI Explorer</a>

                <div class="concept-box">
                    <h4>Certificate Fields</h4>
                    <ul style="margin-left: 20px;">
                        <li><strong>Subject:</strong> Who the certificate identifies (CN, O, OU)</li>
                        <li><strong>Issuer:</strong> CA that signed the certificate</li>
                        <li><strong>Validity:</strong> Not Before and Not After dates</li>
                        <li><strong>Public Key:</strong> The subject's public key</li>
                        <li><strong>Signature:</strong> CA's digital signature</li>
                        <li><strong>Extensions:</strong> Key Usage, SAN, CRL Distribution Points</li>
                    </ul>
                </div>

                <div class="question-section">
                    <h4>ğŸ’­ Security Implications</h4>
                    <p>What happens if a Certificate Authority is compromised or issues a fraudulent certificate? How do Certificate Transparency logs help detect this?</p>
                    <textarea id="q5" placeholder="Discuss CA compromise scenarios..."></textarea>
                </div>

                <button class="complete-btn" onclick="completeExercise(5)" id="btn5">Mark Complete</button>
            </div>
        </div>

        <!-- Exercise 6: Block Cipher Modes -->
        <div class="exercise" data-exercise="6">
            <div class="exercise-header" onclick="toggleExercise(6)">
                <div class="exercise-title">
                    <div class="exercise-number">6</div>
                    <div class="exercise-name">Block Cipher Modes of Operation</div>
                </div>
                <span class="exercise-status status-pending" id="status6">Pending</span>
            </div>
            <div class="exercise-content">
                <div class="scenario">
                    <h4>ğŸ“‹ Beyond Basic Encryption</h4>
                    <p>Block ciphers like AES work on fixed-size blocks (128 bits). Modes of operation determine how to encrypt messages larger than one block securely.</p>
                </div>

                <table class="comparison-table">
                    <tr>
                        <th>Mode</th>
                        <th>Description</th>
                        <th>Security</th>
                    </tr>
                    <tr>
                        <td>ECB</td>
                        <td>Each block encrypted independently</td>
                        <td style="color:#f87171;">âŒ Reveals patterns - NEVER use!</td>
                    </tr>
                    <tr>
                        <td>CBC</td>
                        <td>Each block XORed with previous ciphertext</td>
                        <td style="color:#4ade80;">âœ… Good with random IV</td>
                    </tr>
                    <tr>
                        <td>CTR</td>
                        <td>Counter mode - turns block into stream cipher</td>
                        <td style="color:#4ade80;">âœ… Parallelizable, fast</td>
                    </tr>
                    <tr>
                        <td>GCM</td>
                        <td>Galois/Counter Mode - authenticated encryption</td>
                        <td style="color:#22c55e;">âœ…âœ… Best - includes integrity</td>
                    </tr>
                </table>

                <h4>ğŸ¯ Tasks</h4>
                <ul class="task-list">
                    <li class="task-item">
                        <input type="checkbox" id="t6-1" onchange="checkTask(6)">
                        <label for="t6-1">Use the Block Cipher Modes Visualizer to compare ECB vs CBC encryption</label>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="t6-2" onchange="checkTask(6)">
                        <label for="t6-2">Observe how patterns are preserved in ECB mode (the penguin problem)</label>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="t6-3" onchange="checkTask(6)">
                        <label for="t6-3">Understand why IVs (Initialization Vectors) must be random and unique</label>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="t6-4" onchange="checkTask(6)">
                        <label for="t6-4">Explore why GCM is preferred (provides both encryption AND authentication)</label>
                    </li>
                </ul>

                <a href="../applets/crypto/block_mode/BlockModes.html" class="applet-link">ğŸ§± Block Cipher Modes</a>
                <a href="../applets/crypto/encrypt_data/EncryptData.html" class="applet-link">ğŸ” Data Encryption</a>

                <div class="question-section">
                    <h4>ğŸ’­ Final Challenge</h4>
                    <p>You're designing a secure messaging app. Which cipher mode would you choose and why? What other cryptographic primitives would you need for a complete solution?</p>
                    <textarea id="q6" placeholder="Design your secure messaging crypto..."></textarea>
                </div>

                <button class="complete-btn" onclick="completeExercise(6)" id="btn6">Mark Complete</button>
            </div>
        </div>

        <!-- Completion Badge -->
        <div class="completion-badge" id="completionBadge">
            <div class="badge-icon">ğŸ†</div>
            <h2>Cryptography Lab Complete!</h2>
            <p>You've mastered encryption, hashing, key exchange, digital signatures, PKI, and cipher modes.</p>
            <div class="next-steps">
                <a href="../quizzes/cryptography-quiz.html">ğŸ“ Take the Quiz</a>
                <a href="../index.html">ğŸ›¡ï¸ Back to Shield</a>
            </div>
        </div>
    </div>

    <script>
        const TOTAL_EXERCISES = 6;
        let completedExercises = new Set();

        document.addEventListener('DOMContentLoaded', () => {
            loadProgress();
            updateProgressBar();
        });

        function toggleExercise(num) {
            const exercise = document.querySelector(`[data-exercise="${num}"]`);
            const wasActive = exercise.classList.contains('active');
            document.querySelectorAll('.exercise').forEach(ex => ex.classList.remove('active'));
            if (!wasActive) exercise.classList.add('active');
        }

        function checkTask(exerciseNum) {
            const exercise = document.querySelector(`[data-exercise="${exerciseNum}"]`);
            exercise.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                const taskItem = cb.closest('.task-item');
                taskItem.classList.toggle('checked', cb.checked);
            });
            saveProgress();
        }

        function completeExercise(num) {
            completedExercises.add(num);
            document.getElementById(`status${num}`).textContent = 'Complete';
            document.getElementById(`status${num}`).className = 'exercise-status status-complete';
            document.getElementById(`btn${num}`).textContent = 'âœ“ Completed';
            document.getElementById(`btn${num}`).disabled = true;
            updateProgressBar();
            saveProgress();
            if (num < TOTAL_EXERCISES) setTimeout(() => toggleExercise(num + 1), 500);
            if (completedExercises.size === TOTAL_EXERCISES) {
                document.getElementById('completionBadge').classList.add('show');
            }
        }

        function updateProgressBar() {
            const progress = (completedExercises.size / TOTAL_EXERCISES) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('completedCount').textContent = completedExercises.size;
        }

        function saveProgress() {
            const data = {
                completed: Array.from(completedExercises),
                checkboxes: {},
                answers: {}
            };
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                data.checkboxes[cb.id] = cb.checked;
            });
            document.querySelectorAll('textarea').forEach(ta => {
                data.answers[ta.id] = ta.value;
            });
            localStorage.setItem('shield_crypto_lab', JSON.stringify(data));
        }

        function loadProgress() {
            const saved = localStorage.getItem('shield_crypto_lab');
            if (!saved) return;
            const data = JSON.parse(saved);
            if (data.completed) {
                data.completed.forEach(num => {
                    completedExercises.add(num);
                    document.getElementById(`status${num}`).textContent = 'Complete';
                    document.getElementById(`status${num}`).className = 'exercise-status status-complete';
                    document.getElementById(`btn${num}`).textContent = 'âœ“ Completed';
                    document.getElementById(`btn${num}`).disabled = true;
                });
            }
            if (data.checkboxes) {
                Object.entries(data.checkboxes).forEach(([id, checked]) => {
                    const cb = document.getElementById(id);
                    if (cb) {
                        cb.checked = checked;
                        if (checked) cb.closest('.task-item').classList.add('checked');
                    }
                });
            }
            if (data.answers) {
                Object.entries(data.answers).forEach(([id, value]) => {
                    const ta = document.getElementById(id);
                    if (ta) ta.value = value;
                });
            }
            if (completedExercises.size === TOTAL_EXERCISES) {
                document.getElementById('completionBadge').classList.add('show');
            }
        }
    </script>
</body>
</html>
