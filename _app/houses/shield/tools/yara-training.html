<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YARA Rules Training Lab - Shield House | Hexworth Prime</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a1628 0%, #1e3a5f 100%);
            min-height: 100vh;
            padding: 20px;
            color: #e0e0e0;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(10, 22, 40, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 2px solid rgba(59, 130, 246, 0.3);
        }

        .header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            padding: 30px;
            text-align: center;
            border-bottom: 3px solid #60a5fa;
        }

        .header h1 {
            color: #ffffff;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            color: #dbeafe;
            font-size: 1.1em;
        }

        .back-link {
            display: inline-block;
            margin-top: 15px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .back-link:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 0;
            min-height: calc(100vh - 200px);
        }

        .workspace {
            display: flex;
            flex-direction: column;
            border-right: 2px solid rgba(59, 130, 246, 0.3);
        }

        .tab-container {
            display: flex;
            background: rgba(10, 22, 40, 0.9);
            border-bottom: 2px solid rgba(59, 130, 246, 0.3);
            padding: 10px 20px 0;
            gap: 5px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 20px;
            background: rgba(30, 64, 175, 0.3);
            color: #60a5fa;
            border: none;
            cursor: pointer;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s ease;
            font-size: 0.95em;
            font-weight: 500;
            border: 2px solid transparent;
            border-bottom: none;
        }

        .tab:hover {
            background: rgba(59, 130, 246, 0.3);
            color: #e0e0e0;
        }

        .tab.active {
            background: rgba(30, 64, 175, 0.6);
            color: #ffffff;
            border-color: #60a5fa;
        }

        .tab-content {
            display: none;
            flex: 1;
            overflow: hidden;
            flex-direction: column;
        }

        .tab-content.active {
            display: flex;
        }

        /* Learn Tab Styles */
        .learn-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .learn-section {
            margin-bottom: 30px;
        }

        .learn-section h2 {
            color: #60a5fa;
            font-size: 1.8em;
            margin-bottom: 15px;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 10px;
        }

        .learn-section h3 {
            color: #3b82f6;
            font-size: 1.3em;
            margin: 20px 0 10px;
        }

        .learn-section p {
            line-height: 1.8;
            margin-bottom: 15px;
            color: #d0d0d0;
        }

        .learn-section ul, .learn-section ol {
            margin-left: 25px;
            margin-bottom: 15px;
        }

        .learn-section li {
            line-height: 1.8;
            margin-bottom: 8px;
            color: #d0d0d0;
        }

        .info-box {
            background: rgba(59, 130, 246, 0.15);
            border-left: 4px solid #3b82f6;
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        .info-box.warning {
            background: rgba(251, 146, 60, 0.15);
            border-left-color: #fb923c;
        }

        .info-box.success {
            background: rgba(34, 197, 94, 0.15);
            border-left-color: #22c55e;
        }

        .info-box strong {
            color: #3b82f6;
            display: block;
            margin-bottom: 5px;
        }

        .info-box.warning strong {
            color: #fb923c;
        }

        .info-box.success strong {
            color: #22c55e;
        }

        code {
            background: rgba(30, 64, 175, 0.3);
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #60a5fa;
        }

        .code-block {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
            border: 1px solid rgba(59, 130, 246, 0.3);
            font-size: 0.9em;
            line-height: 1.6;
        }

        .code-block .comment {
            color: #6b7280;
        }

        .code-block .keyword {
            color: #fb923c;
        }

        .code-block .string {
            color: #22c55e;
        }

        .code-block .section {
            color: #60a5fa;
        }

        /* Rule Builder Styles */
        .rule-builder {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
        }

        .builder-section {
            background: rgba(30, 64, 175, 0.15);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .builder-section h3 {
            color: #60a5fa;
            font-size: 1.2em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .builder-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(59, 130, 246, 0.3);
            color: #e0e0e0;
            padding: 10px 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            margin-bottom: 10px;
        }

        .builder-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
        }

        .builder-textarea {
            min-height: 150px;
            resize: vertical;
            font-family: 'Courier New', monospace;
        }

        .builder-textarea.rule-editor {
            min-height: 300px;
            background: #0a0e1a;
            color: #22c55e;
        }

        .add-item-btn {
            background: rgba(59, 130, 246, 0.3);
            border: 2px solid #3b82f6;
            color: #60a5fa;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .add-item-btn:hover {
            background: rgba(59, 130, 246, 0.5);
        }

        .string-item, .meta-item {
            background: rgba(0, 0, 0, 0.4);
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            display: grid;
            grid-template-columns: 1fr 2fr auto;
            gap: 10px;
            align-items: center;
        }

        .string-item input, .meta-item input {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #e0e0e0;
            padding: 8px 12px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }

        .string-item select {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #e0e0e0;
            padding: 8px 12px;
            border-radius: 4px;
        }

        .remove-btn {
            background: rgba(239, 68, 68, 0.3);
            border: none;
            color: #ef4444;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
        }

        .remove-btn:hover {
            background: rgba(239, 68, 68, 0.5);
        }

        .test-rule-btn {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .test-rule-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4);
        }

        .test-results {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .test-results h4 {
            color: #60a5fa;
            margin-bottom: 10px;
        }

        .match-result {
            background: rgba(34, 197, 94, 0.2);
            border-left: 4px solid #22c55e;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 6px 6px 0;
        }

        .no-match-result {
            background: rgba(239, 68, 68, 0.2);
            border-left: 4px solid #ef4444;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 6px 6px 0;
        }

        .error-result {
            background: rgba(251, 146, 60, 0.2);
            border-left: 4px solid #fb923c;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 6px 6px 0;
        }

        /* Challenges Tab */
        .challenges-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .challenge-card {
            background: rgba(30, 64, 175, 0.15);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .challenge-card:hover {
            border-color: #60a5fa;
            transform: translateX(5px);
        }

        .challenge-card.completed {
            border-color: #22c55e;
            background: rgba(34, 197, 94, 0.1);
        }

        .challenge-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .challenge-title {
            color: #60a5fa;
            font-size: 1.1em;
            font-weight: 600;
        }

        .challenge-card.completed .challenge-title {
            color: #22c55e;
        }

        .challenge-points {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .challenge-desc {
            color: #b0b0b0;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .challenge-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(59, 130, 246, 0.3);
            color: #22c55e;
            padding: 12px 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin: 10px 0;
            min-height: 80px;
            resize: vertical;
        }

        .challenge-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .status-badge {
            padding: 5px 15px;
            border-radius: 5px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-pending {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid #fbbf24;
        }

        .status-complete {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid #22c55e;
        }

        .submit-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            border: none;
            color: white;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .hint-btn {
            background: rgba(30, 64, 175, 0.3);
            border: none;
            color: #60a5fa;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s ease;
        }

        .hint-btn:hover {
            background: rgba(30, 64, 175, 0.5);
        }

        .hint-text {
            display: none;
            margin-top: 10px;
            padding: 10px 15px;
            background: rgba(59, 130, 246, 0.1);
            border-left: 3px solid #3b82f6;
            color: #a0a0a0;
            font-size: 0.9em;
        }

        .hint-text.show {
            display: block;
        }

        /* Reference Tab */
        .reference-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .ref-category {
            margin-bottom: 25px;
        }

        .ref-category h3 {
            color: #60a5fa;
            font-size: 1.2em;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid rgba(59, 130, 246, 0.3);
        }

        .ref-item {
            background: rgba(30, 64, 175, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 8px;
            padding: 12px 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .ref-item:hover {
            border-color: #60a5fa;
            background: rgba(30, 64, 175, 0.2);
        }

        .ref-item .syntax {
            color: #22c55e;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            margin-bottom: 5px;
            display: block;
        }

        .ref-item .explanation {
            color: #888;
            font-size: 0.85em;
        }

        /* Sidebar */
        .sidebar {
            background: rgba(10, 15, 25, 0.9);
            padding: 20px;
            overflow-y: auto;
            border-left: 2px solid rgba(59, 130, 246, 0.3);
        }

        .sidebar h3 {
            color: #60a5fa;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(59, 130, 246, 0.3);
            font-size: 1.2em;
        }

        .sidebar h4 {
            color: #3b82f6;
            margin: 15px 0 10px;
            font-size: 1em;
        }

        .sidebar p {
            color: #b0b0b0;
            line-height: 1.6;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .sidebar ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .sidebar li {
            color: #b0b0b0;
            font-size: 0.9em;
            line-height: 1.6;
            margin-bottom: 5px;
        }

        .tip-box {
            background: rgba(59, 130, 246, 0.15);
            border-left: 4px solid #3b82f6;
            padding: 12px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }

        .tip-box strong {
            color: #3b82f6;
            display: block;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .tip-box p {
            margin: 0;
            font-size: 0.85em;
        }

        .sample-files {
            margin: 15px 0;
        }

        .sample-file {
            background: rgba(30, 64, 175, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sample-file:hover {
            border-color: #60a5fa;
            background: rgba(30, 64, 175, 0.3);
        }

        .sample-file .filename {
            color: #60a5fa;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .sample-file .file-desc {
            color: #888;
            font-size: 0.8em;
        }

        /* Settings Panel */
        .settings-panel {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .settings-section {
            background: rgba(30, 64, 175, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .settings-section h3 {
            color: #60a5fa;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .settings-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(59, 130, 246, 0.1);
        }

        .settings-row:last-child {
            border-bottom: none;
        }

        .settings-row label {
            color: #b0b0b0;
        }

        .settings-btn {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .settings-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .settings-btn.secondary {
            background: rgba(30, 64, 175, 0.2);
            border: 2px solid #1e40af;
        }

        .settings-btn.danger {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
            color: #ef4444;
        }

        .settings-btn.danger:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .progress-section {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .progress-bar-container {
            background: rgba(30, 64, 175, 0.2);
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-bar {
            background: linear-gradient(90deg, #22c55e 0%, #3b82f6 100%);
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: #888;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .sidebar {
                border-left: none;
                border-top: 2px solid rgba(59, 130, 246, 0.3);
                max-height: 350px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(10, 22, 40, 0.5);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #60a5fa;
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .processing {
            animation: pulse 1s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è YARA Rules Training Lab</h1>
            <p>Master Malware Detection Through Pattern Matching</p>
            <a href="../index.html" class="back-link">‚Üê Back to Shield House</a>
        </div>

        <div class="main-content">
            <div class="workspace">
                <div class="tab-container">
                    <button class="tab active" onclick="switchTab('learn')">üìö Learn</button>
                    <button class="tab" onclick="switchTab('rule-builder')">üîß Rule Builder</button>
                    <button class="tab" onclick="switchTab('challenges')">üéØ Challenges</button>
                    <button class="tab" onclick="switchTab('reference')">üìñ Reference</button>
                    <button class="tab" onclick="switchTab('settings')">‚öôÔ∏è Settings</button>
                </div>

                <!-- LEARN TAB -->
                <div id="learn" class="tab-content active">
                    <div class="learn-content">
                        <div class="learn-section">
                            <h2>What is YARA?</h2>
                            <p>YARA (Yet Another Ridiculous Acronym) is a pattern-matching tool designed to help malware researchers identify and classify malware samples. Think of it as a <strong>"malware detection fingerprint system"</strong> that allows you to create custom signatures for identifying malicious files based on textual or binary patterns.</p>

                            <div class="info-box">
                                <strong>üéØ Key Concept</strong>
                                <p>YARA rules are like "if-then" statements for file analysis: "If a file contains these specific strings or byte patterns, then it's likely this type of malware." Security teams use YARA rules to scan filesystems, memory, and network traffic for indicators of compromise.</p>
                            </div>

                            <h3>Why Do We Need YARA?</h3>
                            <ul>
                                <li><strong>Malware Detection:</strong> Identify known malware families and variants</li>
                                <li><strong>Threat Hunting:</strong> Proactively search for indicators of compromise across systems</li>
                                <li><strong>Incident Response:</strong> Quickly triage and classify suspicious files</li>
                                <li><strong>Custom Signatures:</strong> Create detection rules tailored to your environment</li>
                                <li><strong>Integration:</strong> Works with VirusTotal, Cuckoo Sandbox, SIEM tools, and more</li>
                            </ul>

                            <h3>The Three Core Components of YARA Rules</h3>
                            <ol>
                                <li><strong>Meta:</strong> Descriptive information about the rule (author, date, description)</li>
                                <li><strong>Strings:</strong> The patterns to search for (text, hex, regex)</li>
                                <li><strong>Condition:</strong> The logic that determines when a file matches</li>
                            </ol>
                        </div>

                        <div class="learn-section">
                            <h2>YARA Rule Structure</h2>
                            <p>Every YARA rule follows a consistent structure. Understanding this anatomy is essential for writing effective detection rules.</p>

                            <div class="code-block">
<span class="keyword">rule</span> <span class="section">ExampleMalware</span>
{
    <span class="section">meta:</span>
        <span class="comment">// Descriptive metadata about the rule</span>
        description = <span class="string">"Detects Example malware family"</span>
        author = <span class="string">"Your Name"</span>
        date = <span class="string">"2025-01-15"</span>
        reference = <span class="string">"https://example.com/analysis"</span>

    <span class="section">strings:</span>
        <span class="comment">// Patterns to search for</span>
        $text_string = <span class="string">"malicious_function"</span> <span class="keyword">nocase</span>
        $hex_pattern = { 4D 5A 90 00 }
        $regex_pattern = /https?:\/\/evil[0-9]+\.com/ <span class="keyword">wide</span>

    <span class="section">condition:</span>
        <span class="comment">// Boolean logic determining when the rule matches</span>
        <span class="keyword">any of them</span>
}</div>

                            <div class="info-box success">
                                <strong>‚úÖ Best Practice</strong>
                                <p>Always include meaningful metadata. When a rule triggers during incident response, knowing the author, date, and purpose helps prioritize and investigate alerts effectively.</p>
                            </div>

                            <h3>Rule Naming Conventions</h3>
                            <ul>
                                <li>Use descriptive names that indicate malware family or behavior</li>
                                <li>Follow naming patterns: <code>APT_GroupName_ToolName</code>, <code>Trojan_FamilyName</code></li>
                                <li>Avoid special characters except underscores</li>
                                <li>Examples: <code>APT28_Sofacy_XAgent</code>, <code>Ransomware_WannaCry</code>, <code>WebShell_Generic</code></li>
                            </ul>
                        </div>

                        <div class="learn-section">
                            <h2>String Types in YARA</h2>
                            <p>YARA supports three types of strings, each suited for different detection scenarios.</p>

                            <h3>1. Text Strings</h3>
                            <p>The most common type - searches for ASCII or Unicode text sequences.</p>
                            <div class="code-block">
<span class="section">strings:</span>
    $s1 = <span class="string">"C:\\Windows\\System32\\evil.exe"</span>
    $s2 = <span class="string">"http://malicious-c2.com"</span> <span class="keyword">nocase</span>
    $s3 = <span class="string">"password123"</span> <span class="keyword">wide ascii</span>
    $s4 = <span class="string">"This is a"</span> <span class="keyword">fullword</span></div>

                            <h3>2. Hexadecimal Patterns</h3>
                            <p>Used for byte sequences, often for file headers, shellcode, or obfuscated data.</p>
                            <div class="code-block">
<span class="section">strings:</span>
    $mz_header = { 4D 5A }                    <span class="comment">// PE executable header "MZ"</span>
    $shellcode = { 90 90 90 EB 0E }           <span class="comment">// NOP sled + jump</span>
    $pattern = { 48 89 ?? 48 8B ?? }          <span class="comment">// Wildcards with ??</span>
    $ranged = { AA BB CC [4-8] DD EE }        <span class="comment">// Variable byte gap</span>
    $alternative = { ( 55 | AA ) 8B EC }      <span class="comment">// Alternatives with |</span></div>

                            <h3>3. Regular Expressions</h3>
                            <p>Powerful pattern matching for complex or variable strings.</p>
                            <div class="code-block">
<span class="section">strings:</span>
    $email = /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/
    $ip = /\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b/
    $url = /https?:\/\/[a-z0-9\-]+\.(com|net|org)/i</div>

                            <div class="info-box warning">
                                <strong>‚ö†Ô∏è Performance Warning</strong>
                                <p>Regular expressions can be slow on large files. Use them judiciously and prefer text/hex patterns when possible. Avoid overly complex regex that can cause catastrophic backtracking.</p>
                            </div>
                        </div>

                        <div class="learn-section">
                            <h2>String Modifiers</h2>
                            <p>Modifiers change how YARA interprets and searches for strings.</p>

                            <h3>Common Modifiers</h3>
                            <ul>
                                <li><code>nocase</code> - Case-insensitive matching (e.g., "PASSWORD" matches "password")</li>
                                <li><code>wide</code> - Match Unicode (UTF-16) encoded strings</li>
                                <li><code>ascii</code> - Match ASCII strings (default for text strings)</li>
                                <li><code>wide ascii</code> - Match both encodings</li>
                                <li><code>fullword</code> - Match only complete words (bounded by non-alphanumeric chars)</li>
                                <li><code>private</code> - Don't include in output (for helper strings)</li>
                                <li><code>xor</code> - Match XOR-encoded strings with specified key range</li>
                            </ul>

                            <div class="code-block">
<span class="section">strings:</span>
    $cmd = <span class="string">"cmd.exe"</span> <span class="keyword">nocase wide ascii</span>
    $func = <span class="string">"CreateRemoteThread"</span> <span class="keyword">fullword</span>
    $hidden = <span class="string">"internal_check"</span> <span class="keyword">private</span>
    $encoded = <span class="string">"malware"</span> <span class="keyword">xor(0x01-0xff)</span></div>
                        </div>

                        <div class="learn-section">
                            <h2>Conditions and Boolean Logic</h2>
                            <p>The condition section determines when a file matches your rule. It uses boolean expressions combining string matches and file properties.</p>

                            <h3>Basic Conditions</h3>
                            <div class="code-block">
<span class="section">condition:</span>
    $s1                           <span class="comment">// File contains $s1</span>
    <span class="keyword">all of them</span>                  <span class="comment">// All defined strings present</span>
    <span class="keyword">any of them</span>                  <span class="comment">// At least one string present</span>
    <span class="keyword">2 of them</span>                    <span class="comment">// At least 2 strings present</span>
    <span class="keyword">all of</span> ($s*)                 <span class="comment">// All strings starting with $s</span>
    <span class="keyword">3 of</span> ($api*)                 <span class="comment">// At least 3 of $api group</span></div>

                            <h3>Boolean Operators</h3>
                            <div class="code-block">
<span class="section">condition:</span>
    $s1 <span class="keyword">and</span> $s2                  <span class="comment">// Both strings present</span>
    $s1 <span class="keyword">or</span> $s2                   <span class="comment">// Either string present</span>
    $s1 <span class="keyword">and not</span> $s2              <span class="comment">// $s1 present but not $s2</span>
    ($s1 <span class="keyword">or</span> $s2) <span class="keyword">and</span> $s3        <span class="comment">// Grouping with parentheses</span></div>

                            <h3>String Count and Position</h3>
                            <div class="code-block">
<span class="section">condition:</span>
    #s1 > 5                       <span class="comment">// String $s1 appears more than 5 times</span>
    #s1 == 3                      <span class="comment">// String $s1 appears exactly 3 times</span>
    @s1 < 1024                    <span class="comment">// $s1 appears within first 1KB</span>
    @s1[1] < 100                  <span class="comment">// First occurrence of $s1 before byte 100</span>
    $s1 <span class="keyword">at</span> 0                     <span class="comment">// String at file offset 0</span>
    $s1 <span class="keyword">in</span> (0..1024)             <span class="comment">// String within first 1024 bytes</span></div>

                            <h3>File Size Conditions</h3>
                            <div class="code-block">
<span class="section">condition:</span>
    filesize < 1MB                <span class="comment">// File smaller than 1 megabyte</span>
    filesize > 10KB <span class="keyword">and</span> filesize < 500KB
    uint16(0) == 0x5A4D           <span class="comment">// Check "MZ" header at offset 0</span></div>

                            <div class="info-box">
                                <strong>üéì Advanced Tip</strong>
                                <p>Use <code>uint8()</code>, <code>uint16()</code>, <code>uint32()</code> functions to read integers at specific file offsets. This is invaluable for checking file headers, magic bytes, or structure fields in PE/ELF files.</p>
                            </div>
                        </div>

                        <div class="learn-section">
                            <h2>Using YARA with External Tools</h2>

                            <h3>Command-Line Scanning</h3>
                            <div class="code-block">
<span class="comment"># Scan a single file</span>
yara my_rules.yar suspicious_file.exe

<span class="comment"># Scan a directory recursively</span>
yara -r my_rules.yar /path/to/scan/

<span class="comment"># Print matching strings</span>
yara -s my_rules.yar sample.bin

<span class="comment"># Tag-based filtering</span>
yara -t malware my_rules.yar sample.bin</div>

                            <h3>Integration with Other Tools</h3>
                            <ul>
                                <li><strong>yarGen:</strong> Automatically generate YARA rules from malware samples</li>
                                <li><strong>YARA-L (Chronicle):</strong> Detection rules for Google Chronicle SIEM</li>
                                <li><strong>VirusTotal:</strong> Search for files matching your YARA rules across millions of samples</li>
                                <li><strong>Cuckoo Sandbox:</strong> Automated malware analysis with YARA signature matching</li>
                                <li><strong>osquery:</strong> Use YARA rules for endpoint detection queries</li>
                                <li><strong>THOR/Loki:</strong> APT scanner leveraging YARA for IOC detection</li>
                            </ul>

                            <h3>Python Integration</h3>
                            <div class="code-block">
<span class="keyword">import</span> yara

<span class="comment"># Compile and scan</span>
rules = yara.compile(filepath=<span class="string">'my_rules.yar'</span>)
matches = rules.match(<span class="string">'suspicious.exe'</span>)

<span class="keyword">for</span> match <span class="keyword">in</span> matches:
    print(f<span class="string">"Rule matched: {match.rule}"</span>)
    print(f<span class="string">"Strings found: {match.strings}"</span>)</div>
                        </div>

                        <div class="learn-section">
                            <h2>Writing Effective Detection Rules</h2>

                            <h3>Best Practices</h3>
                            <ul>
                                <li><strong>Be Specific but Flexible:</strong> Balance precision (avoid false positives) with recall (catch variants)</li>
                                <li><strong>Use Multiple Indicators:</strong> Combine strings, file properties, and behavioral patterns</li>
                                <li><strong>Avoid Common Strings:</strong> Don't use strings that appear in legitimate software</li>
                                <li><strong>Test Thoroughly:</strong> Validate against both malicious samples and clean files</li>
                                <li><strong>Document Well:</strong> Clear metadata helps incident responders understand alerts</li>
                                <li><strong>Version Control:</strong> Track rule changes and effectiveness over time</li>
                            </ul>

                            <h3>False Positive Management</h3>
                            <div class="info-box warning">
                                <strong>‚ö†Ô∏è Common Pitfall</strong>
                                <p>Generic strings like "Microsoft", "Windows", or "password" will trigger on countless legitimate files. Always test rules against a corpus of known-good files before deployment.</p>
                            </div>

                            <h3>Rule Tuning Strategies</h3>
                            <ul>
                                <li>Add file size constraints to exclude obviously wrong files</li>
                                <li>Require multiple string matches instead of single indicators</li>
                                <li>Use <code>fullword</code> modifier to prevent substring matches</li>
                                <li>Leverage PE module to check for compiler stamps, sections, imports</li>
                                <li>Combine static strings with entropy checks for packed samples</li>
                            </ul>

                            <div class="code-block">
<span class="comment">// Example: Well-tuned rule with multiple safeguards</span>
<span class="keyword">rule</span> <span class="section">Ransomware_Generic_Indicators</span>
{
    <span class="section">meta:</span>
        description = <span class="string">"Generic ransomware behavior indicators"</span>
        confidence = <span class="string">"medium"</span>

    <span class="section">strings:</span>
        $encrypt1 = <span class="string">"CryptEncrypt"</span> <span class="keyword">fullword nocase</span>
        $encrypt2 = <span class="string">"AES"</span> <span class="keyword">fullword</span>
        $ransom1 = <span class="string">"bitcoin"</span> <span class="keyword">nocase</span>
        $ransom2 = <span class="string">"decrypt"</span> <span class="keyword">nocase</span>
        $extension = <span class="string">".encrypted"</span> <span class="keyword">nocase</span>

    <span class="section">condition:</span>
        filesize < 5MB <span class="keyword">and</span>
        uint16(0) == 0x5A4D <span class="keyword">and</span>  <span class="comment">// PE file</span>
        <span class="keyword">2 of</span> ($encrypt*) <span class="keyword">and</span>
        <span class="keyword">2 of</span> ($ransom*, $extension)
}</div>
                        </div>

                        <div class="learn-section">
                            <h2>PE Module - Advanced Malware Detection</h2>
                            <p>YARA's PE module provides access to Portable Executable (Windows) file structures, enabling sophisticated analysis of compiled binaries.</p>

                            <h3>Common PE Module Features</h3>
                            <div class="code-block">
<span class="keyword">import</span> <span class="string">"pe"</span>

<span class="section">condition:</span>
    pe.number_of_sections > 5
    pe.imports(<span class="string">"kernel32.dll"</span>, <span class="string">"CreateRemoteThread"</span>)
    pe.exports(<span class="string">"StartService"</span>)
    pe.entry_point < 0x1000
    pe.sections[0].name == <span class="string">".text"</span>
    pe.timestamp > 1609459200  <span class="comment">// After 2021-01-01</span>
    pe.is_dll()
    pe.characteristics & pe.DLL</div>

                            <div class="info-box">
                                <strong>üéØ Use Case: Detecting Packers</strong>
                                <p>Malware often uses packers to obfuscate code. The PE module can detect unusual section names (.UPX, .aspack), high entropy sections, or suspicious entry points that indicate packing.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- RULE BUILDER TAB -->
                <div id="rule-builder" class="tab-content">
                    <div class="rule-builder">
                        <div class="builder-section">
                            <h3>üèóÔ∏è Rule Editor</h3>
                            <textarea id="ruleEditor" class="builder-input builder-textarea rule-editor" placeholder="Write your YARA rule here...">rule MyFirstRule
{
    meta:
        author = "Your Name"
        description = "Describe what this rule detects"
        date = "2025-01-15"

    strings:
        $string1 = "malicious"
        $hex1 = { 4D 5A 90 00 }

    condition:
        any of them
}</textarea>
                            <button class="test-rule-btn" onclick="testYaraRule()">üîç Test Rule Against Sample Files</button>
                        </div>

                        <div class="builder-section">
                            <h3>üìã Quick Rule Builder</h3>
                            <label style="color: #888; font-size: 0.9em; display: block; margin-bottom: 5px;">Rule Name</label>
                            <input type="text" id="ruleName" class="builder-input" placeholder="ExampleMalware" value="MyDetectionRule">

                            <h4 style="color: #60a5fa; margin-top: 20px; margin-bottom: 10px;">Metadata</h4>
                            <div id="metaItems">
                                <div class="meta-item">
                                    <input type="text" placeholder="Key" value="author">
                                    <input type="text" placeholder="Value" value="Your Name">
                                    <button class="remove-btn" onclick="this.parentElement.remove()">‚úï</button>
                                </div>
                                <div class="meta-item">
                                    <input type="text" placeholder="Key" value="description">
                                    <input type="text" placeholder="Value" value="Describe the detection">
                                    <button class="remove-btn" onclick="this.parentElement.remove()">‚úï</button>
                                </div>
                            </div>
                            <button class="add-item-btn" onclick="addMetaItem()">+ Add Metadata</button>

                            <h4 style="color: #60a5fa; margin-top: 20px; margin-bottom: 10px;">Strings</h4>
                            <div id="stringItems">
                                <div class="string-item">
                                    <input type="text" placeholder="Variable (e.g., $s1)" value="$s1">
                                    <input type="text" placeholder="String or pattern" value="malicious">
                                    <select>
                                        <option value="text">Text</option>
                                        <option value="hex">Hex</option>
                                        <option value="regex">Regex</option>
                                    </select>
                                    <button class="remove-btn" onclick="this.parentElement.remove()">‚úï</button>
                                </div>
                            </div>
                            <button class="add-item-btn" onclick="addStringItem()">+ Add String</button>

                            <h4 style="color: #60a5fa; margin-top: 20px; margin-bottom: 10px;">Condition</h4>
                            <input type="text" id="conditionInput" class="builder-input" placeholder="e.g., any of them" value="any of them">

                            <button class="test-rule-btn" onclick="generateRule()">üî® Generate Rule from Builder</button>
                        </div>

                        <div id="testResults" class="test-results" style="display: none;">
                            <h4>Test Results</h4>
                            <div id="testResultsContent"></div>
                        </div>
                    </div>
                </div>

                <!-- CHALLENGES TAB -->
                <div id="challenges" class="tab-content">
                    <div class="challenges-container">
                        <div class="challenge-card" data-challenge="1">
                            <div class="challenge-header">
                                <div class="challenge-title">Challenge 1: Basic String Detection</div>
                                <div class="challenge-points">10 pts</div>
                            </div>
                            <div class="challenge-desc">
                                Write a YARA rule that detects a file containing the exact string <code>"MALWARE_SIGNATURE_2025"</code>.
                                Name your rule <code>BasicStringDetection</code>.
                            </div>
                            <textarea class="challenge-input" placeholder="Write your YARA rule here..."></textarea>
                            <div class="challenge-status">
                                <button class="submit-btn" onclick="checkChallenge(1)">Submit Answer</button>
                                <button class="hint-btn" onclick="toggleHint(1)">üí° Hint</button>
                                <span class="status-badge status-pending">Pending</span>
                            </div>
                            <div class="hint-text" id="hint-1">
                                Remember the basic structure: rule name, strings section with a string variable, and a condition that checks if that string exists. Use <code>$variableName = "your string"</code> syntax.
                            </div>
                        </div>

                        <div class="challenge-card" data-challenge="2">
                            <div class="challenge-header">
                                <div class="challenge-title">Challenge 2: Hexadecimal Pattern</div>
                                <div class="challenge-points">15 pts</div>
                            </div>
                            <div class="challenge-desc">
                                Detect the PE executable header by matching the hex bytes <code>4D 5A</code> (the "MZ" signature) at the start of a file.
                                Name your rule <code>PE_Header_Detection</code>.
                            </div>
                            <textarea class="challenge-input" placeholder="Write your YARA rule here..."></textarea>
                            <div class="challenge-status">
                                <button class="submit-btn" onclick="checkChallenge(2)">Submit Answer</button>
                                <button class="hint-btn" onclick="toggleHint(2)">üí° Hint</button>
                                <span class="status-badge status-pending">Pending</span>
                            </div>
                            <div class="hint-text" id="hint-2">
                                Use hex patterns with curly braces: <code>{ 4D 5A }</code>. For position checking, use the <code>at</code> keyword: <code>$pattern at 0</code> means the pattern must be at file offset 0.
                            </div>
                        </div>

                        <div class="challenge-card" data-challenge="3">
                            <div class="challenge-header">
                                <div class="challenge-title">Challenge 3: Multiple String Conditions</div>
                                <div class="challenge-points">20 pts</div>
                            </div>
                            <div class="challenge-desc">
                                Write a rule named <code>MultiString_Ransomware</code> that detects files containing at least 2 of these strings:
                                <code>"encrypt"</code>, <code>"decrypt"</code>, <code>"bitcoin"</code>, <code>"ransom"</code> (case-insensitive).
                            </div>
                            <textarea class="challenge-input" placeholder="Write your YARA rule here..."></textarea>
                            <div class="challenge-status">
                                <button class="submit-btn" onclick="checkChallenge(3)">Submit Answer</button>
                                <button class="hint-btn" onclick="toggleHint(3)">üí° Hint</button>
                                <span class="status-badge status-pending">Pending</span>
                            </div>
                            <div class="hint-text" id="hint-3">
                                Use the <code>nocase</code> modifier for case-insensitive matching. In the condition, use <code>2 of them</code> to require at least 2 string matches.
                            </div>
                        </div>

                        <div class="challenge-card" data-challenge="4">
                            <div class="challenge-header">
                                <div class="challenge-title">Challenge 4: Regular Expression</div>
                                <div class="challenge-points">25 pts</div>
                            </div>
                            <div class="challenge-desc">
                                Create a rule named <code>Regex_IP_Detection</code> that uses a regular expression to detect IPv4 addresses in the format
                                <code>192.168.x.x</code> where x is any number 0-255.
                            </div>
                            <textarea class="challenge-input" placeholder="Write your YARA rule here..."></textarea>
                            <div class="challenge-status">
                                <button class="submit-btn" onclick="checkChallenge(4)">Submit Answer</button>
                                <button class="hint-btn" onclick="toggleHint(4)">üí° Hint</button>
                                <span class="status-badge status-pending">Pending</span>
                            </div>
                            <div class="hint-text" id="hint-4">
                                Regex patterns use forward slashes: <code>/pattern/</code>. For IP detection, try: <code>/192\.168\.\d{1,3}\.\d{1,3}/</code>. Remember to escape the dots!
                            </div>
                        </div>

                        <div class="challenge-card" data-challenge="5">
                            <div class="challenge-header">
                                <div class="challenge-title">Challenge 5: File Size Constraints</div>
                                <div class="challenge-points">20 pts</div>
                            </div>
                            <div class="challenge-desc">
                                Write a rule named <code>SmallFile_Detector</code> that matches files smaller than 10KB (10240 bytes)
                                and containing the string <code>"dropper"</code>.
                            </div>
                            <textarea class="challenge-input" placeholder="Write your YARA rule here..."></textarea>
                            <div class="challenge-status">
                                <button class="submit-btn" onclick="checkChallenge(5)">Submit Answer</button>
                                <button class="hint-btn" onclick="toggleHint(5)">üí° Hint</button>
                                <span class="status-badge status-pending">Pending</span>
                            </div>
                            <div class="hint-text" id="hint-5">
                                Use <code>filesize</code> in your condition with comparison operators. Combine it with string matching using <code>and</code>.
                            </div>
                        </div>

                        <div class="challenge-card" data-challenge="6">
                            <div class="challenge-header">
                                <div class="challenge-title">Challenge 6: String Modifiers</div>
                                <div class="challenge-points">25 pts</div>
                            </div>
                            <div class="challenge-desc">
                                Create a rule named <code>Unicode_String_Hunter</code> that detects the string <code>"password"</code>
                                in both ASCII and wide (Unicode UTF-16) encodings, case-insensitive.
                            </div>
                            <textarea class="challenge-input" placeholder="Write your YARA rule here..."></textarea>
                            <div class="challenge-status">
                                <button class="submit-btn" onclick="checkChallenge(6)">Submit Answer</button>
                                <button class="hint-btn" onclick="toggleHint(6)">üí° Hint</button>
                                <span class="status-badge status-pending">Pending</span>
                            </div>
                            <div class="hint-text" id="hint-6">
                                Combine multiple modifiers: <code>wide ascii nocase</code>. This makes YARA search for both Unicode and ASCII representations, ignoring case.
                            </div>
                        </div>

                        <div class="challenge-card" data-challenge="7">
                            <div class="challenge-header">
                                <div class="challenge-title">Challenge 7: Metadata Documentation</div>
                                <div class="challenge-points">15 pts</div>
                            </div>
                            <div class="challenge-desc">
                                Write a rule named <code>WellDocumented_Rule</code> with metadata including: author (your name),
                                description ("Test rule for training"), date ("2025-01-15"), and a string <code>"test"</code>.
                            </div>
                            <textarea class="challenge-input" placeholder="Write your YARA rule here..."></textarea>
                            <div class="challenge-status">
                                <button class="submit-btn" onclick="checkChallenge(7)">Submit Answer</button>
                                <button class="hint-btn" onclick="toggleHint(7)">üí° Hint</button>
                                <span class="status-badge status-pending">Pending</span>
                            </div>
                            <div class="hint-text" id="hint-7">
                                The meta section uses <code>key = "value"</code> format. Include author, description, and date fields.
                            </div>
                        </div>

                        <div class="challenge-card" data-challenge="8">
                            <div class="challenge-header">
                                <div class="challenge-title">Challenge 8: String Count</div>
                                <div class="challenge-points">30 pts</div>
                            </div>
                            <div class="challenge-desc">
                                Create a rule named <code>HighFrequency_String</code> that detects files where the string
                                <code>"cmd.exe"</code> appears more than 3 times (use the count operator).
                            </div>
                            <textarea class="challenge-input" placeholder="Write your YARA rule here..."></textarea>
                            <div class="challenge-status">
                                <button class="submit-btn" onclick="checkChallenge(8)">Submit Answer</button>
                                <button class="hint-btn" onclick="toggleHint(8)">üí° Hint</button>
                                <span class="status-badge status-pending">Pending</span>
                            </div>
                            <div class="hint-text" id="hint-8">
                                Use the <code>#</code> operator to count string occurrences. Example: <code>#stringvar > 3</code> checks if the string appears more than 3 times.
                            </div>
                        </div>

                        <div class="challenge-card" data-challenge="9">
                            <div class="challenge-header">
                                <div class="challenge-title">Challenge 9: Hex Wildcards</div>
                                <div class="challenge-points">30 pts</div>
                            </div>
                            <div class="challenge-desc">
                                Write a rule named <code>Wildcard_Pattern</code> that matches the hex pattern <code>90 90 ?? EB</code>
                                where <code>??</code> represents any single byte (NOP sled with wildcard).
                            </div>
                            <textarea class="challenge-input" placeholder="Write your YARA rule here..."></textarea>
                            <div class="challenge-status">
                                <button class="submit-btn" onclick="checkChallenge(9)">Submit Answer</button>
                                <button class="hint-btn" onclick="toggleHint(9)">üí° Hint</button>
                                <span class="status-badge status-pending">Pending</span>
                            </div>
                            <div class="hint-text" id="hint-9">
                                In hex patterns, <code>??</code> acts as a wildcard for any byte. Use it within curly braces: <code>{ 90 90 ?? EB }</code>
                            </div>
                        </div>

                        <div class="challenge-card" data-challenge="10">
                            <div class="challenge-header">
                                <div class="challenge-title">Challenge 10: Complex Condition Logic</div>
                                <div class="challenge-points">40 pts</div>
                            </div>
                            <div class="challenge-desc">
                                Create a comprehensive rule named <code>Advanced_Malware_Detection</code> with strings for <code>"CreateProcess"</code>,
                                <code>"WriteProcessMemory"</code>, and <code>"VirtualAlloc"</code>. The condition should require all three strings AND file size less than 1MB.
                            </div>
                            <textarea class="challenge-input" placeholder="Write your YARA rule here..."></textarea>
                            <div class="challenge-status">
                                <button class="submit-btn" onclick="checkChallenge(10)">Submit Answer</button>
                                <button class="hint-btn" onclick="toggleHint(10)">üí° Hint</button>
                                <span class="status-badge status-pending">Pending</span>
                            </div>
                            <div class="hint-text" id="hint-10">
                                Combine conditions with <code>and</code>. Use <code>all of them</code> for all strings, and add <code>filesize < 1MB</code>. Remember: 1MB = 1048576 bytes.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- REFERENCE TAB -->
                <div id="reference" class="tab-content">
                    <div class="reference-container">
                        <div class="ref-category">
                            <h3>Rule Structure Template</h3>
                            <div class="ref-item">
                                <span class="syntax">rule RuleName { meta: ... strings: ... condition: ... }</span>
                                <span class="explanation">Basic YARA rule structure with three main sections</span>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>String Modifiers</h3>
                            <div class="ref-item">
                                <span class="syntax">nocase</span>
                                <span class="explanation">Case-insensitive string matching</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">wide</span>
                                <span class="explanation">Match Unicode UTF-16 encoded strings</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">ascii</span>
                                <span class="explanation">Match ASCII strings (default for text)</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">wide ascii</span>
                                <span class="explanation">Match both Unicode and ASCII encodings</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">fullword</span>
                                <span class="explanation">Match complete words only (bounded by non-alphanumeric)</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">private</span>
                                <span class="explanation">Don't include string in match output</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">xor(0x01-0xff)</span>
                                <span class="explanation">Match XOR-encoded strings with specified key range</span>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>Condition Keywords</h3>
                            <div class="ref-item">
                                <span class="syntax">all of them</span>
                                <span class="explanation">All defined strings must be present</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">any of them</span>
                                <span class="explanation">At least one string must be present</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">2 of them</span>
                                <span class="explanation">At least 2 strings must be present</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">all of ($s*)</span>
                                <span class="explanation">All strings matching pattern (e.g., $s1, $s2, $s3)</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">and</span>
                                <span class="explanation">Boolean AND operator</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">or</span>
                                <span class="explanation">Boolean OR operator</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">not</span>
                                <span class="explanation">Boolean NOT operator</span>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>Special Variables & Operators</h3>
                            <div class="ref-item">
                                <span class="syntax">#stringvar</span>
                                <span class="explanation">Count of how many times a string appears</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">@stringvar</span>
                                <span class="explanation">First offset where string appears</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">@stringvar[n]</span>
                                <span class="explanation">Offset of nth occurrence of string</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">!stringvar</span>
                                <span class="explanation">Length of matched string</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">$stringvar at offset</span>
                                <span class="explanation">String appears at specific file offset</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">$stringvar in (start..end)</span>
                                <span class="explanation">String appears within byte range</span>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>File Properties</h3>
                            <div class="ref-item">
                                <span class="syntax">filesize</span>
                                <span class="explanation">Size of file being scanned (in bytes)</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">uint8(offset)</span>
                                <span class="explanation">Read 8-bit unsigned integer at offset</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">uint16(offset)</span>
                                <span class="explanation">Read 16-bit unsigned integer at offset</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">uint32(offset)</span>
                                <span class="explanation">Read 32-bit unsigned integer at offset</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">uint16(0) == 0x5A4D</span>
                                <span class="explanation">Check for PE "MZ" header at file start</span>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>PE Module (import "pe")</h3>
                            <div class="ref-item">
                                <span class="syntax">pe.imports("dll", "function")</span>
                                <span class="explanation">Check if PE imports specific function from DLL</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">pe.exports("function")</span>
                                <span class="explanation">Check if PE exports a specific function</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">pe.number_of_sections</span>
                                <span class="explanation">Number of sections in PE file</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">pe.sections[n].name</span>
                                <span class="explanation">Name of nth section</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">pe.entry_point</span>
                                <span class="explanation">Entry point offset of PE file</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">pe.timestamp</span>
                                <span class="explanation">Compilation timestamp (Unix epoch)</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">pe.is_dll()</span>
                                <span class="explanation">True if file is a DLL</span>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>Common Malware Detection Patterns</h3>
                            <div class="ref-item">
                                <span class="syntax">{ 4D 5A }</span>
                                <span class="explanation">PE executable "MZ" header</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">{ 7F 45 4C 46 }</span>
                                <span class="explanation">ELF (Linux) executable header</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">/https?:\/\/[a-z0-9\-\.]+/</span>
                                <span class="explanation">Regex for URLs (C2 domains)</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">/\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/</span>
                                <span class="explanation">Regex for IPv4 addresses</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">"CreateRemoteThread" fullword</span>
                                <span class="explanation">Process injection API call</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">"VirtualAlloc" fullword</span>
                                <span class="explanation">Memory allocation (common in shellcode)</span>
                            </div>
                        </div>

                        <div class="ref-category">
                            <h3>Size Constants</h3>
                            <div class="ref-item">
                                <span class="syntax">KB</span>
                                <span class="explanation">Kilobyte (1024 bytes)</span>
                            </div>
                            <div class="ref-item">
                                <span class="syntax">MB</span>
                                <span class="explanation">Megabyte (1048576 bytes)</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SETTINGS TAB -->
                <div id="settings" class="tab-content">
                    <div class="settings-panel">
                        <div class="progress-section">
                            <h3 style="color: #60a5fa; margin-bottom: 10px;">Your Progress</h3>
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                            </div>
                            <div class="progress-text">
                                <span>Challenges Completed: <span id="completedCount">0</span>/10</span>
                                <span>Total Points: <span id="totalPoints">0</span>/240</span>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>Statistics</h3>
                            <div class="settings-row">
                                <label>Rules Tested:</label>
                                <span style="color: #60a5fa; font-weight: 600;" id="rulesTestedCount">0</span>
                            </div>
                            <div class="settings-row">
                                <label>Successful Matches:</label>
                                <span style="color: #22c55e; font-weight: 600;" id="successfulMatchesCount">0</span>
                            </div>
                            <div class="settings-row">
                                <label>Time Spent:</label>
                                <span style="color: #60a5fa; font-weight: 600;" id="timeSpent">0 minutes</span>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>Data Management</h3>
                            <div class="settings-row">
                                <label>Export your progress to a file</label>
                                <button class="settings-btn" onclick="exportProgress()">üì• Export Progress</button>
                            </div>
                            <div class="settings-row">
                                <label>Import progress from a file</label>
                                <button class="settings-btn secondary" onclick="document.getElementById('importFile').click()">üì§ Import Progress</button>
                                <input type="file" id="importFile" style="display: none;" accept=".json" onchange="importProgress(event)">
                            </div>
                            <div class="settings-row">
                                <label>Reset all progress and start over</label>
                                <button class="settings-btn danger" onclick="resetProgress()">üîÑ Reset All Progress</button>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>About YARA Training Lab</h3>
                            <p style="color: #b0b0b0; line-height: 1.6; margin-bottom: 10px;">
                                This interactive training lab teaches you how to write YARA rules for malware detection and threat hunting.
                                YARA is an essential tool for security analysts, incident responders, and malware researchers.
                            </p>
                            <p style="color: #888; font-size: 0.9em;">
                                Version 1.0.0 | Shield House | Hexworth Prime
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SIDEBAR -->
            <div class="sidebar">
                <h3>üí° Quick Tips</h3>

                <div class="tip-box">
                    <strong>Rule Syntax Basics</strong>
                    <p>Every YARA rule needs: a name, optional meta section, strings section, and condition section. The condition determines when the rule matches.</p>
                </div>

                <h4>Sample Files for Testing</h4>
                <div class="sample-files">
                    <div class="sample-file" onclick="showSampleInfo('malware1')">
                        <div class="filename">malware_sample_1.exe</div>
                        <div class="file-desc">Contains: MALWARE_SIGNATURE_2025, PE header</div>
                    </div>
                    <div class="sample-file" onclick="showSampleInfo('malware2')">
                        <div class="filename">ransomware_sample.bin</div>
                        <div class="file-desc">Contains: encrypt, decrypt, bitcoin, ransom</div>
                    </div>
                    <div class="sample-file" onclick="showSampleInfo('suspicious')">
                        <div class="filename">suspicious_dropper.exe</div>
                        <div class="file-desc">8KB, contains "dropper", PE header</div>
                    </div>
                    <div class="sample-file" onclick="showSampleInfo('process')">
                        <div class="filename">process_injector.dll</div>
                        <div class="file-desc">CreateProcess, WriteProcessMemory, VirtualAlloc</div>
                    </div>
                    <div class="sample-file" onclick="showSampleInfo('network')">
                        <div class="filename">network_tool.exe</div>
                        <div class="file-desc">Contains IP: 192.168.1.100, cmd.exe x5</div>
                    </div>
                </div>

                <h4>Common Mistakes</h4>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li style="margin-bottom: 8px;">Forgetting curly braces around hex patterns</li>
                    <li style="margin-bottom: 8px;">Missing quotes around text strings</li>
                    <li style="margin-bottom: 8px;">Not escaping special regex characters</li>
                    <li style="margin-bottom: 8px;">Using generic strings that match benign files</li>
                </ul>

                <div class="tip-box" style="margin-top: 15px;">
                    <strong>Testing Your Rules</strong>
                    <p>Always test rules against both malicious samples AND clean files to ensure you're not creating false positives.</p>
                </div>

                <h4>Helpful Resources</h4>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li style="margin-bottom: 8px;">YARA Documentation (official)</li>
                    <li style="margin-bottom: 8px;">VirusTotal for rule testing</li>
                    <li style="margin-bottom: 8px;">yarGen for auto-generation</li>
                    <li style="margin-bottom: 8px;">YARA community rules on GitHub</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let progressData = {
            completedChallenges: [],
            totalPoints: 0,
            rulesTestQD: 0,
            successfulMatches: 0,
            startTime: Date.now()
        };

        // Sample file database
        const sampleFiles = {
            malware1: {
                name: "malware_sample_1.exe",
                size: 45056,
                content: "This is a simulated malware sample containing MALWARE_SIGNATURE_2025 and other data",
                hexHeader: "4D5A",
                strings: ["MALWARE_SIGNATURE_2025", "test", "sample"],
                peHeader: true
            },
            malware2: {
                name: "ransomware_sample.bin",
                size: 102400,
                content: "Ransomware simulation with encrypt decrypt bitcoin ransom keywords",
                strings: ["encrypt", "decrypt", "bitcoin", "ransom", "payment"],
                peHeader: false
            },
            suspicious: {
                name: "suspicious_dropper.exe",
                size: 8192,
                content: "Small dropper file with malicious payload",
                hexHeader: "4D5A",
                strings: ["dropper", "payload"],
                peHeader: true
            },
            process: {
                name: "process_injector.dll",
                size: 524288,
                content: "DLL with process injection capabilities using CreateProcess WriteProcessMemory VirtualAlloc",
                strings: ["CreateProcess", "WriteProcessMemory", "VirtualAlloc", "OpenProcess"],
                peHeader: true
            },
            network: {
                name: "network_tool.exe",
                size: 65536,
                content: "Network tool with cmd.exe cmd.exe cmd.exe cmd.exe cmd.exe and IP 192.168.1.100",
                strings: ["cmd.exe", "192.168.1.100"],
                cmdCount: 5,
                peHeader: true
            },
            unicode: {
                name: "unicode_strings.exe",
                size: 32768,
                content: "File with password in both ASCII and Unicode",
                strings: ["password"],
                hasUnicode: true,
                peHeader: true
            }
        };

        // Challenge validation rules
        const challengeValidation = {
            1: {
                requiredStrings: ["MALWARE_SIGNATURE_2025"],
                requiredRuleName: "BasicStringDetection",
                testFile: "malware1"
            },
            2: {
                requiredHex: "4D5A",
                requiredRuleName: "PE_Header_Detection",
                requiresAtZero: true,
                testFile: "malware1"
            },
            3: {
                requiredStrings: ["encrypt", "decrypt", "bitcoin", "ransom"],
                requiredRuleName: "MultiString_Ransomware",
                requiresNocase: true,
                requiresMinCount: 2,
                testFile: "malware2"
            },
            4: {
                requiresRegex: true,
                requiredRuleName: "Regex_IP_Detection",
                regexPattern: "192\\.168",
                testFile: "network"
            },
            5: {
                requiredStrings: ["dropper"],
                requiredRuleName: "SmallFile_Detector",
                requiresFilesize: 10240,
                testFile: "suspicious"
            },
            6: {
                requiredStrings: ["password"],
                requiredRuleName: "Unicode_String_Hunter",
                requiresWide: true,
                requiresNocase: true,
                testFile: "unicode"
            },
            7: {
                requiredRuleName: "WellDocumented_Rule",
                requiresMeta: ["author", "description", "date"],
                requiredStrings: ["test"]
            },
            8: {
                requiredStrings: ["cmd.exe"],
                requiredRuleName: "HighFrequency_String",
                requiresCount: true,
                minCount: 3,
                testFile: "network"
            },
            9: {
                requiredHex: "909090EB",
                requiredRuleName: "Wildcard_Pattern",
                hasWildcard: true
            },
            10: {
                requiredStrings: ["CreateProcess", "WriteProcessMemory", "VirtualAlloc"],
                requiredRuleName: "Advanced_Malware_Detection",
                requiresAllStrings: true,
                requiresFilesize: 1048576,
                testFile: "process"
            }
        };

        // Load progress from localStorage
        function loadProgress() {
            const saved = localStorage.getItem('yaraTrainingProgress');
            if (saved) {
                progressData = JSON.parse(saved);
            }
            updateProgressDisplay();
        }

        // Save progress to localStorage
        function saveProgress() {
            localStorage.setItem('yaraTrainingProgress', JSON.stringify(progressData));
            updateProgressDisplay();
        }

        // Update progress display
        function updateProgressDisplay() {
            const completed = progressData.completedChallenges.length;
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('totalPoints').textContent = progressData.totalPoints;
            document.getElementById('progressBar').style.width = (completed / 10 * 100) + '%';
            document.getElementById('rulesTestedCount').textContent = progressData.rulesTestQD;
            document.getElementById('successfulMatchesCount').textContent = progressData.successfulMatches;

            const timeMinutes = Math.floor((Date.now() - progressData.startTime) / 60000);
            document.getElementById('timeSpent').textContent = timeMinutes + ' minutes';

            // Update challenge cards
            progressData.completedChallenges.forEach(challengeNum => {
                const card = document.querySelector(`.challenge-card[data-challenge="${challengeNum}"]`);
                if (card) {
                    card.classList.add('completed');
                    const badge = card.querySelector('.status-badge');
                    badge.className = 'status-badge status-complete';
                    badge.textContent = 'Completed';
                }
            });
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Rule Builder Functions
        function addMetaItem() {
            const container = document.getElementById('metaItems');
            const item = document.createElement('div');
            item.className = 'meta-item';
            item.innerHTML = `
                <input type="text" placeholder="Key">
                <input type="text" placeholder="Value">
                <button class="remove-btn" onclick="this.parentElement.remove()">‚úï</button>
            `;
            container.appendChild(item);
        }

        function addStringItem() {
            const container = document.getElementById('stringItems');
            const item = document.createElement('div');
            item.className = 'string-item';
            item.innerHTML = `
                <input type="text" placeholder="Variable (e.g., $s1)">
                <input type="text" placeholder="String or pattern">
                <select>
                    <option value="text">Text</option>
                    <option value="hex">Hex</option>
                    <option value="regex">Regex</option>
                </select>
                <button class="remove-btn" onclick="this.parentElement.remove()">‚úï</button>
            `;
            container.appendChild(item);
        }

        function generateRule() {
            const ruleName = document.getElementById('ruleName').value || 'GeneratedRule';
            let rule = `rule ${ruleName}\n{\n`;

            // Meta section
            const metaItems = document.querySelectorAll('#metaItems .meta-item');
            if (metaItems.length > 0) {
                rule += '    meta:\n';
                metaItems.forEach(item => {
                    const inputs = item.querySelectorAll('input');
                    if (inputs[0].value && inputs[1].value) {
                        rule += `        ${inputs[0].value} = "${inputs[1].value}"\n`;
                    }
                });
                rule += '        \n';
            }

            // Strings section
            const stringItems = document.querySelectorAll('#stringItems .string-item');
            if (stringItems.length > 0) {
                rule += '    strings:\n';
                stringItems.forEach(item => {
                    const inputs = item.querySelectorAll('input');
                    const select = item.querySelector('select');
                    const varName = inputs[0].value || '$s';
                    const value = inputs[1].value || '';
                    const type = select.value;

                    if (value) {
                        if (type === 'text') {
                            rule += `        ${varName} = "${value}"\n`;
                        } else if (type === 'hex') {
                            rule += `        ${varName} = { ${value} }\n`;
                        } else if (type === 'regex') {
                            rule += `        ${varName} = /${value}/\n`;
                        }
                    }
                });
                rule += '        \n';
            }

            // Condition section
            const condition = document.getElementById('conditionInput').value || 'any of them';
            rule += '    condition:\n';
            rule += `        ${condition}\n`;
            rule += '}';

            document.getElementById('ruleEditor').value = rule;
        }

        // Test YARA rule function
        function testYaraRule() {
            const ruleText = document.getElementById('ruleEditor').value;
            progressData.rulesTestQD++;

            const results = document.getElementById('testResultsContent');
            results.innerHTML = '';
            document.getElementById('testResults').style.display = 'block';

            // Simple validation
            if (!ruleText.trim() || !ruleText.includes('rule ')) {
                results.innerHTML = '<div class="error-result">Error: Invalid rule format. Rules must start with "rule RuleName"</div>';
                saveProgress();
                return;
            }

            // Extract rule name
            const ruleNameMatch = ruleText.match(/rule\s+(\w+)/);
            if (!ruleNameMatch) {
                results.innerHTML = '<div class="error-result">Error: Cannot parse rule name</div>';
                saveProgress();
                return;
            }

            // Test against sample files
            let matchFound = false;
            for (const [key, file] of Object.entries(sampleFiles)) {
                const matched = simulateYaraMatch(ruleText, file);
                if (matched) {
                    matchFound = true;
                    progressData.successfulMatches++;
                    results.innerHTML += `
                        <div class="match-result">
                            <strong>‚úì Match:</strong> ${file.name}<br>
                            <small>File size: ${file.size} bytes | Matched strings detected</small>
                        </div>
                    `;
                } else {
                    results.innerHTML += `
                        <div class="no-match-result">
                            <strong>‚úó No Match:</strong> ${file.name}<br>
                            <small>Rule conditions not satisfied</small>
                        </div>
                    `;
                }
            }

            if (!matchFound) {
                results.innerHTML += '<div class="error-result"><strong>‚ö† Warning:</strong> No files matched this rule. Verify your strings and conditions.</div>';
            }

            saveProgress();
        }

        // Simulate YARA matching (simplified)
        function simulateYaraMatch(ruleText, file) {
            const ruleLower = ruleText.toLowerCase();

            // Check for file size conditions
            if (ruleText.includes('filesize <')) {
                const sizeMatch = ruleText.match(/filesize\s*<\s*(\d+)/);
                if (sizeMatch && file.size >= parseInt(sizeMatch[1])) {
                    return false;
                }
            }
            if (ruleText.includes('filesize >')) {
                const sizeMatch = ruleText.match(/filesize\s*>\s*(\d+)/);
                if (sizeMatch && file.size <= parseInt(sizeMatch[1])) {
                    return false;
                }
            }

            // Check for string matches
            const stringMatches = [];
            if (file.strings) {
                file.strings.forEach(str => {
                    if (ruleLower.includes(str.toLowerCase()) ||
                        (ruleLower.includes('nocase') && ruleLower.includes(str.toLowerCase()))) {
                        stringMatches.push(str);
                    }
                });
            }

            // Check hex patterns
            if (file.hexHeader && (ruleText.includes('4D 5A') || ruleText.includes('4D5A'))) {
                stringMatches.push('MZ_header');
            }

            // Check condition logic
            if (ruleText.includes('any of them') && stringMatches.length > 0) {
                return true;
            }
            if (ruleText.includes('all of them')) {
                const stringCount = (ruleText.match(/\$\w+\s*=/g) || []).length;
                return stringMatches.length >= stringCount;
            }
            if (ruleText.match(/(\d+)\s+of\s+them/)) {
                const countMatch = ruleText.match(/(\d+)\s+of\s+them/);
                const required = parseInt(countMatch[1]);
                return stringMatches.length >= required;
            }

            // Check for count conditions
            if (ruleText.includes('#') && file.cmdCount) {
                const countMatch = ruleText.match(/#\w+\s*>\s*(\d+)/);
                if (countMatch) {
                    const required = parseInt(countMatch[1]);
                    return file.cmdCount > required;
                }
            }

            // Default: check if at least one string matches
            return stringMatches.length > 0;
        }

        // Challenge checking
        function checkChallenge(challengeNum) {
            const card = document.querySelector(`.challenge-card[data-challenge="${challengeNum}"]`);
            const input = card.querySelector('.challenge-input');
            const ruleText = input.value.trim();
            const validation = challengeValidation[challengeNum];

            if (!ruleText) {
                alert('Please write a YARA rule first!');
                return;
            }

            // Check rule name
            if (validation.requiredRuleName) {
                const nameMatch = ruleText.match(/rule\s+(\w+)/);
                if (!nameMatch || nameMatch[1] !== validation.requiredRuleName) {
                    alert(`Incorrect rule name. Expected: ${validation.requiredRuleName}`);
                    return;
                }
            }

            // Check required strings
            if (validation.requiredStrings) {
                const allPresent = validation.requiredStrings.every(str =>
                    ruleText.toLowerCase().includes(str.toLowerCase())
                );
                if (!allPresent) {
                    alert('Missing required strings. Check the challenge description.');
                    return;
                }
            }

            // Check for metadata
            if (validation.requiresMeta) {
                const hasMetaSection = ruleText.includes('meta:');
                const hasAllMeta = validation.requiresMeta.every(key =>
                    ruleText.includes(key)
                );
                if (!hasMetaSection || !hasAllMeta) {
                    alert('Missing required metadata fields.');
                    return;
                }
            }

            // Check for modifiers
            if (validation.requiresNocase && !ruleText.includes('nocase')) {
                alert('This challenge requires the "nocase" modifier.');
                return;
            }

            if (validation.requiresWide && !ruleText.includes('wide')) {
                alert('This challenge requires the "wide" modifier.');
                return;
            }

            // Check hex patterns
            if (validation.requiredHex) {
                const hasHex = ruleText.includes('{') && ruleText.includes('}');
                if (!hasHex) {
                    alert('This challenge requires a hexadecimal pattern.');
                    return;
                }
            }

            // Check for count operator
            if (validation.requiresCount && !ruleText.includes('#')) {
                alert('This challenge requires using the count operator (#).');
                return;
            }

            // Check for file size
            if (validation.requiresFilesize && !ruleText.includes('filesize')) {
                alert('This challenge requires a filesize condition.');
                return;
            }

            // Check for regex
            if (validation.requiresRegex && !(ruleText.includes('/') && ruleText.match(/\/.*\//))) {
                alert('This challenge requires a regular expression pattern.');
                return;
            }

            // If we got here, challenge passed!
            if (!progressData.completedChallenges.includes(challengeNum)) {
                progressData.completedChallenges.push(challengeNum);
                const points = parseInt(card.querySelector('.challenge-points').textContent);
                progressData.totalPoints += points;

                card.classList.add('completed');
                const badge = card.querySelector('.status-badge');
                badge.className = 'status-badge status-complete';
                badge.textContent = 'Completed';

                saveProgress();
                alert(`üéâ Congratulations! Challenge ${challengeNum} completed! (+${points} points)`);
            } else {
                alert('You have already completed this challenge!');
            }
        }

        // Hint toggle
        function toggleHint(challengeNum) {
            const hint = document.getElementById(`hint-${challengeNum}`);
            hint.classList.toggle('show');
        }

        // Sample file info
        function showSampleInfo(fileKey) {
            const file = sampleFiles[fileKey];
            alert(`File: ${file.name}\nSize: ${file.size} bytes\n\nContains:\n${file.strings ? file.strings.join(', ') : 'Various content'}\n\nPE Header: ${file.peHeader ? 'Yes' : 'No'}`);
        }

        // Export/Import/Reset functions
        function exportProgress() {
            const dataStr = JSON.stringify(progressData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'yara-training-progress.json';
            link.click();
        }

        function importProgress(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const imported = JSON.parse(e.target.result);
                        if (confirm('This will overwrite your current progress. Continue?')) {
                            progressData = imported;
                            saveProgress();
                            location.reload();
                        }
                    } catch (err) {
                        alert('Error importing file: Invalid format');
                    }
                };
                reader.readAsText(file);
            }
        }

        function resetProgress() {
            if (confirm('Are you sure you want to reset ALL progress? This cannot be undone!')) {
                localStorage.removeItem('yaraTrainingProgress');
                location.reload();
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadProgress();
        });
    </script>
<script src="../../../components/FluxCapacitor.js"></script>
</body>
</html>
