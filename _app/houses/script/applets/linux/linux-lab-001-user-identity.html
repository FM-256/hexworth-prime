<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Access Control -->
    <script src="../../../../components/AccessGuard.js"></script>
    <script>AccessGuard.require('sorted');</script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L-001: User Identity - House of Script</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #052e16 0%, #14532d 100%);
            min-height: 100vh;
            color: #86efac;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 400px;
            min-height: 100vh;
        }

        /* Left Panel - Terminal & Tasks */
        .main-panel {
            display: flex;
            flex-direction: column;
            border-right: 2px solid #166534;
        }

        .header {
            background: linear-gradient(135deg, #166534 0%, #22c55e 100%);
            padding: 20px 30px;
            border-bottom: 3px solid #22c55e;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .lab-badge {
            background: rgba(0,0,0,0.3);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            color: #bbf7d0;
        }

        .header h1 {
            color: white;
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .header p {
            color: #d1fae5;
            font-size: 0.95em;
        }

        .back-link {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            transition: all 0.3s;
        }

        .back-link:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Terminal */
        .terminal-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #0a0a0a;
        }

        .terminal-header {
            background: #1a1a1a;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #333;
        }

        .terminal-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .dot-red { background: #ff5f56; }
        .dot-yellow { background: #ffbd2e; }
        .dot-green { background: #27ca3f; }

        .terminal-title {
            color: #888;
            font-size: 0.9em;
            margin-left: 10px;
        }

        .terminal {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            font-family: 'Cascadia Code', 'Fira Code', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
        }

        .terminal-line {
            margin-bottom: 5px;
        }

        .prompt { color: #22c55e; font-weight: bold; }
        .command { color: #86efac; }
        .output { color: #d1d5db; }
        .error { color: #f87171; }
        .success { color: #4ade80; }
        .highlight { color: #fbbf24; }

        .input-line {
            display: flex;
            align-items: center;
            padding: 10px 20px 20px;
            background: #0a0a0a;
        }

        .input-prompt {
            color: #22c55e;
            font-weight: bold;
            font-family: 'Cascadia Code', 'Courier New', monospace;
            margin-right: 8px;
        }

        #commandInput {
            flex: 1;
            background: transparent;
            border: none;
            color: #86efac;
            font-family: 'Cascadia Code', 'Courier New', monospace;
            font-size: 14px;
            outline: none;
        }

        /* Task Panel */
        .task-panel {
            background: rgba(5, 46, 22, 0.95);
            border-top: 2px solid #166534;
            padding: 20px;
            max-height: 250px;
            overflow-y: auto;
        }

        .task-panel h3 {
            color: #22c55e;
            margin-bottom: 15px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar {
            height: 8px;
            background: #0a3a1f;
            border-radius: 4px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #22c55e, #4ade80);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .task-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            background: rgba(22, 101, 52, 0.2);
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid #166534;
            transition: all 0.3s;
        }

        .task-item.active {
            border-left-color: #fbbf24;
            background: rgba(251, 191, 36, 0.1);
        }

        .task-item.completed {
            border-left-color: #22c55e;
            background: rgba(34, 197, 94, 0.1);
        }

        .task-check {
            width: 24px;
            height: 24px;
            border: 2px solid #166534;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 14px;
            transition: all 0.3s;
        }

        .task-item.completed .task-check {
            background: #22c55e;
            border-color: #22c55e;
            color: white;
        }

        .task-item.active .task-check {
            border-color: #fbbf24;
            color: #fbbf24;
        }

        .task-content h4 {
            color: #bbf7d0;
            font-size: 0.95em;
            margin-bottom: 4px;
        }

        .task-content p {
            color: #6b8068;
            font-size: 0.85em;
        }

        /* Right Panel - Learning */
        .learning-panel {
            background: rgba(10, 58, 31, 0.95);
            padding: 25px;
            overflow-y: auto;
        }

        .learning-panel h2 {
            color: #22c55e;
            font-size: 1.3em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #166534;
        }

        .learning-section {
            margin-bottom: 25px;
        }

        .learning-section h3 {
            color: #4ade80;
            font-size: 1.05em;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .learning-section p {
            color: #bbf7d0;
            line-height: 1.7;
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .code-box {
            background: #0a0a0a;
            border: 1px solid #166534;
            border-radius: 8px;
            padding: 15px;
            margin: 12px 0;
            font-family: 'Cascadia Code', monospace;
            font-size: 0.9em;
        }

        .code-box .cmd {
            color: #22c55e;
        }

        .code-box .output {
            color: #9ca3af;
            margin-top: 8px;
        }

        .info-box {
            background: rgba(34, 197, 94, 0.1);
            border-left: 4px solid #22c55e;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin: 15px 0;
        }

        .info-box strong {
            color: #22c55e;
            display: block;
            margin-bottom: 8px;
        }

        .warning-box {
            background: rgba(251, 191, 36, 0.1);
            border-left: 4px solid #fbbf24;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin: 15px 0;
        }

        .warning-box strong {
            color: #fbbf24;
            display: block;
            margin-bottom: 8px;
        }

        .output-breakdown {
            background: #0a0a0a;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .output-breakdown code {
            display: block;
            padding: 8px 12px;
            margin: 5px 0;
            background: rgba(22, 101, 52, 0.3);
            border-radius: 4px;
            font-family: 'Cascadia Code', monospace;
        }

        .output-breakdown .label {
            color: #fbbf24;
            font-size: 0.85em;
            margin-top: 10px;
            margin-bottom: 5px;
        }

        /* Completion Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: linear-gradient(135deg, #052e16, #14532d);
            border: 2px solid #22c55e;
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            max-width: 500px;
            animation: modalPop 0.3s ease;
        }

        @keyframes modalPop {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal h2 {
            color: #22c55e;
            font-size: 2em;
            margin-bottom: 15px;
        }

        .modal p {
            color: #bbf7d0;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .modal-btn {
            background: #22c55e;
            color: #052e16;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
        }

        .modal-btn:hover {
            background: #4ade80;
            transform: translateY(-2px);
        }

        .modal-btn.secondary {
            background: transparent;
            color: #22c55e;
            border: 2px solid #22c55e;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #052e16; }
        ::-webkit-scrollbar-thumb { background: #166534; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #22c55e; }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
            .learning-panel {
                border-top: 2px solid #166534;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-panel">
            <div class="header">
                <div class="header-content">
                    <div>
                        <span class="lab-badge">L-001 | Linux Fundamentals</span>
                        <h1>User Identity</h1>
                        <p>Learn to identify your user and group memberships</p>
                    </div>
                    <a href="../../index.html" class="back-link">← Back to House</a>
                </div>
            </div>

            <div class="terminal-container">
                <div class="terminal-header">
                    <span class="terminal-dot dot-red"></span>
                    <span class="terminal-dot dot-yellow"></span>
                    <span class="terminal-dot dot-green"></span>
                    <span class="terminal-title">student@hexworth:~</span>
                </div>
                <div class="terminal" id="terminal">
                    <div class="terminal-line output">Welcome to Hexworth Linux Lab L-001!</div>
                    <div class="terminal-line output">This lab teaches you how to identify your user account and group memberships.</div>
                    <div class="terminal-line output" style="margin-top: 10px;">Type commands below and press Enter to execute.</div>
                    <div class="terminal-line output">Start with <span class="highlight">whoami</span> to see your username.</div>
                    <div class="terminal-line" style="margin-top: 10px;"></div>
                </div>
                <div class="input-line">
                    <span class="input-prompt">student@hexworth:~$</span>
                    <input type="text" id="commandInput" autocomplete="off" autofocus placeholder="Type a command...">
                </div>
            </div>

            <div class="task-panel">
                <h3>
                    <span>Lab Tasks</span>
                    <span id="progressText" style="margin-left: auto; font-weight: normal; font-size: 0.9em;">0/3 Complete</span>
                </h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div id="taskList">
                    <div class="task-item active" id="task-1">
                        <div class="task-check">1</div>
                        <div class="task-content">
                            <h4>Display Your Username</h4>
                            <p>Use the whoami command to show your current user identity</p>
                        </div>
                    </div>
                    <div class="task-item" id="task-2">
                        <div class="task-check">2</div>
                        <div class="task-content">
                            <h4>View Detailed User Information</h4>
                            <p>Use the id command to see your UID, GID, and group memberships</p>
                        </div>
                    </div>
                    <div class="task-item" id="task-3">
                        <div class="task-check">3</div>
                        <div class="task-content">
                            <h4>List Your Groups</h4>
                            <p>Use the groups command to see all groups you belong to</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="learning-panel">
            <h2>Learning Guide</h2>

            <div class="learning-section">
                <h3>Why User Identity Matters</h3>
                <p>In Linux, every process runs as a specific user. Knowing your identity helps you understand:</p>
                <ul style="margin-left: 20px; color: #bbf7d0; line-height: 1.8;">
                    <li>What files you can access</li>
                    <li>What commands you can run</li>
                    <li>What permissions you have</li>
                </ul>
            </div>

            <div class="learning-section">
                <h3>Command: whoami</h3>
                <p>The simplest way to check your username. Returns just the username - nothing more.</p>
                <div class="code-box">
                    <div class="cmd">$ whoami</div>
                    <div class="output">student</div>
                </div>
            </div>

            <div class="learning-section">
                <h3>Command: id</h3>
                <p>Shows your User ID (UID), primary Group ID (GID), and all group memberships.</p>
                <div class="code-box">
                    <div class="cmd">$ id</div>
                    <div class="output">uid=1000(student) gid=1000(student) groups=1000(student),27(sudo),100(users)</div>
                </div>

                <div class="output-breakdown">
                    <div class="label">Breaking Down the Output:</div>
                    <code><span style="color:#4ade80">uid=1000(student)</span> - Your User ID and username</code>
                    <code><span style="color:#fbbf24">gid=1000(student)</span> - Your primary Group ID</code>
                    <code><span style="color:#60a5fa">groups=...</span> - All groups you belong to</code>
                </div>
            </div>

            <div class="learning-section">
                <h3>Command: groups</h3>
                <p>Lists all groups you're a member of in a simple format.</p>
                <div class="code-box">
                    <div class="cmd">$ groups</div>
                    <div class="output">student sudo users docker</div>
                </div>
            </div>

            <div class="info-box">
                <strong>Real-World Use</strong>
                <p>System administrators use these commands to verify user permissions before troubleshooting access issues. If a user can't access a file, checking <code>id</code> reveals if they're in the required group.</p>
            </div>

            <div class="warning-box">
                <strong>Security Note</strong>
                <p>The <code>sudo</code> group grants administrative privileges. If you see it in your groups, you can run commands as root using <code>sudo</code>.</p>
            </div>
        </div>
    </div>

    <!-- Completion Modal -->
    <div class="modal-overlay" id="completionModal">
        <div class="modal">
            <h2>Lab Complete!</h2>
            <p>Excellent work! You've mastered the basics of Linux user identity. You now know how to check your username, UID, GID, and group memberships.</p>
            <button class="modal-btn" onclick="goToNextLab()">Next Lab →</button>
            <button class="modal-btn secondary" onclick="closeModal()">Practice More</button>
        </div>
    </div>

    <script>
        // User data simulation
        const userData = {
            username: 'student',
            uid: 1000,
            gid: 1000,
            groups: [
                { gid: 1000, name: 'student' },
                { gid: 27, name: 'sudo' },
                { gid: 100, name: 'users' },
                { gid: 999, name: 'docker' }
            ],
            hostname: 'hexworth'
        };

        // Task completion state
        const tasks = {
            1: { completed: false, check: (cmd) => cmd.trim() === 'whoami' },
            2: { completed: false, check: (cmd) => cmd.trim() === 'id' || cmd.startsWith('id ') },
            3: { completed: false, check: (cmd) => cmd.trim() === 'groups' || cmd.startsWith('groups ') }
        };

        let commandHistory = [];
        let historyIndex = -1;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            const input = document.getElementById('commandInput');

            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    executeCommand(input.value);
                    input.value = '';
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (historyIndex > 0) {
                        historyIndex--;
                        input.value = commandHistory[historyIndex];
                    }
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (historyIndex < commandHistory.length - 1) {
                        historyIndex++;
                        input.value = commandHistory[historyIndex];
                    } else {
                        historyIndex = commandHistory.length;
                        input.value = '';
                    }
                }
            });

            // Keep input focused
            document.addEventListener('click', () => input.focus());
        });

        function executeCommand(cmdLine) {
            cmdLine = cmdLine.trim();
            if (!cmdLine) return;

            commandHistory.push(cmdLine);
            historyIndex = commandHistory.length;

            const terminal = document.getElementById('terminal');

            // Show command
            appendLine(`<span class="prompt">student@hexworth:~$</span> <span class="command">${escapeHtml(cmdLine)}</span>`);

            // Parse command
            const parts = cmdLine.split(/\s+/);
            const cmd = parts[0];
            const args = parts.slice(1);

            // Execute
            let output = '';

            switch(cmd) {
                case 'whoami':
                    output = userData.username;
                    checkTask(1, cmdLine);
                    break;

                case 'id':
                    if (args.length === 0) {
                        const groupStr = userData.groups.map(g => `${g.gid}(${g.name})`).join(',');
                        output = `uid=${userData.uid}(${userData.username}) gid=${userData.gid}(${userData.username}) groups=${groupStr}`;
                        checkTask(2, cmdLine);
                    } else if (args[0] === '-u') {
                        output = userData.uid.toString();
                    } else if (args[0] === '-g') {
                        output = userData.gid.toString();
                    } else if (args[0] === '-n') {
                        output = userData.username;
                    } else if (args[0] === '-G') {
                        output = userData.groups.map(g => g.gid).join(' ');
                    } else if (args[0] === '--help') {
                        output = `Usage: id [OPTION]... [USER]
Print user and group information.

  -u    print only the effective user ID
  -g    print only the effective group ID
  -G    print all group IDs
  -n    print a name instead of a number (with -ugG)`;
                    } else {
                        output = `<span class="error">id: invalid option '${args[0]}'</span>`;
                    }
                    break;

                case 'groups':
                    output = userData.groups.map(g => g.name).join(' ');
                    checkTask(3, cmdLine);
                    break;

                case 'help':
                    output = `Available commands for this lab:
  <span class="highlight">whoami</span>  - Display current username
  <span class="highlight">id</span>      - Display user and group IDs
  <span class="highlight">groups</span>  - Display group memberships
  <span class="highlight">clear</span>   - Clear terminal
  <span class="highlight">help</span>    - Show this help message`;
                    break;

                case 'clear':
                    terminal.innerHTML = '';
                    return;

                case 'man':
                    if (args[0] === 'whoami') {
                        output = `WHOAMI(1)                   User Commands

NAME
       whoami - print effective userid

SYNOPSIS
       whoami [OPTION]...

DESCRIPTION
       Print the user name associated with the current effective user ID.`;
                    } else if (args[0] === 'id') {
                        output = `ID(1)                       User Commands

NAME
       id - print real and effective user and group IDs

SYNOPSIS
       id [OPTION]... [USER]

DESCRIPTION
       Print user and group information for the specified USER,
       or (when USER omitted) for the current user.

OPTIONS
       -g     print only the effective group ID
       -G     print all group IDs
       -u     print only the effective user ID`;
                    } else if (args[0] === 'groups') {
                        output = `GROUPS(1)                   User Commands

NAME
       groups - print the groups a user is in

SYNOPSIS
       groups [OPTION]... [USERNAME]...

DESCRIPTION
       Print group memberships for each USERNAME or,
       if no USERNAME is specified, for the current process.`;
                    } else {
                        output = `<span class="error">No manual entry for ${args[0] || '?'}</span>`;
                    }
                    break;

                default:
                    output = `<span class="error">Command not found: ${escapeHtml(cmd)}</span>
<span class="output">Type 'help' for available commands in this lab.</span>`;
            }

            if (output) {
                appendLine(`<span class="output">${output}</span>`);
            }

            terminal.scrollTop = terminal.scrollHeight;
        }

        function appendLine(html) {
            const terminal = document.getElementById('terminal');
            const line = document.createElement('div');
            line.className = 'terminal-line';
            line.innerHTML = html;
            terminal.appendChild(line);
        }

        function checkTask(taskNum, cmdLine) {
            if (tasks[taskNum] && !tasks[taskNum].completed && tasks[taskNum].check(cmdLine)) {
                tasks[taskNum].completed = true;

                // Update UI
                const taskEl = document.getElementById(`task-${taskNum}`);
                taskEl.classList.remove('active');
                taskEl.classList.add('completed');
                taskEl.querySelector('.task-check').innerHTML = '✓';

                // Activate next task
                const nextTask = document.getElementById(`task-${taskNum + 1}`);
                if (nextTask && !tasks[taskNum + 1]?.completed) {
                    nextTask.classList.add('active');
                }

                // Show success message
                appendLine(`<span class="success">✓ Task ${taskNum} completed!</span>`);

                // Update progress
                updateProgress();
            }
        }

        function updateProgress() {
            const completed = Object.values(tasks).filter(t => t.completed).length;
            const total = Object.keys(tasks).length;
            const percent = (completed / total) * 100;

            document.getElementById('progressFill').style.width = `${percent}%`;
            document.getElementById('progressText').textContent = `${completed}/${total} Complete`;

            // Check if all complete
            if (completed === total) {
                setTimeout(() => {
                    document.getElementById('completionModal').classList.add('show');
                    saveProgress();
                }, 500);
            }
        }

        function saveProgress() {
            // Save to localStorage for progress tracking
            const progress = JSON.parse(localStorage.getItem('hexworth_progress') || '{}');
            if (!progress.script) progress.script = {};
            progress.script['linux-lab-001'] = {
                completed: true,
                completedAt: new Date().toISOString()
            };
            localStorage.setItem('hexworth_progress', JSON.stringify(progress));
        }

        function closeModal() {
            document.getElementById('completionModal').classList.remove('show');
        }

        function goToNextLab() {
            // Navigate to next lab when it exists
            window.location.href = 'linux-lab-002-files.html';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
    <script src="../../../../components/FluxCapacitor.js"></script>
</body>
</html>
