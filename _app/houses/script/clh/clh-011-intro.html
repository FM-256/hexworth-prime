<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLH-011: Network Reconnaissance - Hexworth Prime</title>
    <style>
        :root { --house-primary: #a78bfa; --house-secondary: #8b5cf6; --terminal-green: #4ade80; --terminal-bg: #0d1117; --danger: #ef4444; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { min-height: 100vh; background: #0a0a0f; font-family: 'Segoe UI', sans-serif; color: #e0e0e0; }
        .module-header { padding: 20px 40px; border-bottom: 1px solid rgba(167, 139, 250, 0.2); background: rgba(10, 10, 15, 0.95); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        .back-btn { padding: 8px 16px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: #888; text-decoration: none; }
        .module-badge { display: flex; align-items: center; gap: 12px; padding: 10px 20px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 25px; }
        .module-badge-text { font-size: 0.75rem; letter-spacing: 0.15em; color: var(--danger); text-transform: uppercase; }
        .content-wrapper { max-width: 900px; margin: 0 auto; padding: 40px 20px; }
        .module-title { font-size: 2.5rem; margin-bottom: 10px; background: linear-gradient(135deg, var(--danger), var(--house-primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .module-subtitle { color: #888; font-size: 1.1rem; margin-bottom: 30px; }
        .section { background: rgba(15, 15, 20, 0.6); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 30px; margin-bottom: 30px; }
        .section h2 { color: var(--house-primary); font-size: 1.4rem; margin-bottom: 20px; }
        .section p { line-height: 1.8; margin-bottom: 15px; color: #ccc; }
        .terminal { background: var(--terminal-bg); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 8px; padding: 20px; font-family: 'Consolas', monospace; margin: 20px 0; position: relative; }
        .terminal::before { content: '$ recon.sh'; position: absolute; top: -10px; left: 15px; background: var(--terminal-bg); padding: 0 10px; font-size: 0.7rem; color: var(--terminal-green); }
        .terminal code { color: var(--terminal-green); display: block; line-height: 1.6; white-space: pre-wrap; font-size: 0.85rem; }
        .terminal .comment { color: #666; }
        .terminal .keyword { color: #c084fc; }
        .terminal .string { color: #fbbf24; }
        .terminal .output { color: #888; }
        .terminal .danger { color: #ef4444; }
        .command-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .command-table th, .command-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .command-table th { background: rgba(167, 139, 250, 0.1); color: var(--house-primary); }
        .command-table code { background: rgba(74, 222, 128, 0.1); color: var(--terminal-green); padding: 2px 8px; border-radius: 4px; font-family: 'Consolas', monospace; }
        .warning-box { background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 20px; margin: 20px 0; }
        .warning-box h4 { color: var(--danger); margin-bottom: 10px; }
        .key-points { display: grid; gap: 15px; margin: 20px 0; }
        .key-point { display: flex; align-items: flex-start; gap: 15px; padding: 15px; background: rgba(167, 139, 250, 0.05); border-left: 3px solid var(--house-primary); border-radius: 0 8px 8px 0; }
        .key-point-icon { font-size: 1.5rem; }
        .key-point-content h4 { color: var(--house-primary); margin-bottom: 5px; }
        .key-point-content p { margin: 0; font-size: 0.9rem; }
        .progress-section { text-align: center; padding: 40px; background: rgba(167, 139, 250, 0.05); border-radius: 12px; margin-top: 40px; }
        .module-nav { display: flex; gap: 15px; justify-content: center; }
        .nav-btn { padding: 12px 30px; border-radius: 8px; text-decoration: none; }
        .nav-btn.primary { background: linear-gradient(135deg, var(--house-primary), var(--house-secondary)); color: #fff; }
        .nav-btn.secondary { background: rgba(255, 255, 255, 0.05); color: #ccc; border: 1px solid rgba(255, 255, 255, 0.1); }
        .title-badge { display: inline-block; background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(167, 139, 250, 0.2)); border: 1px solid rgba(239, 68, 68, 0.5); padding: 8px 20px; border-radius: 20px; font-size: 0.85rem; color: var(--danger); margin-top: 15px; }
        /* Lab Styles */
        .lab-section { background: linear-gradient(135deg, rgba(74, 222, 128, 0.1), rgba(167, 139, 250, 0.1)); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 12px; padding: 25px; margin: 30px 0; }
        .lab-section h3 { color: var(--terminal-green); margin-bottom: 15px; }
        .interactive-terminal { background: var(--terminal-bg); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 8px; overflow: hidden; margin: 20px 0; }
        .terminal-header { background: rgba(255, 255, 255, 0.05); padding: 8px 15px; display: flex; align-items: center; gap: 8px; }
        .terminal-dot { width: 12px; height: 12px; border-radius: 50%; } .terminal-dot.red { background: #ef4444; } .terminal-dot.yellow { background: #fbbf24; } .terminal-dot.green { background: #22c55e; }
        .terminal-body { padding: 15px; }
        .terminal-output { color: #888; font-family: 'Consolas', monospace; font-size: 0.85rem; line-height: 1.6; min-height: 280px; max-height: 400px; overflow-y: auto; margin-bottom: 10px; white-space: pre-wrap; }
        .terminal-input-line { display: flex; align-items: center; gap: 10px; }
        .terminal-prompt { color: var(--terminal-green); font-family: 'Consolas', monospace; }
        .terminal-input { flex: 1; background: transparent; border: none; color: #fff; font-family: 'Consolas', monospace; font-size: 0.9rem; outline: none; }
        .run-btn { padding: 8px 20px; background: var(--terminal-green); color: #000; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; }
        .objectives { display: grid; gap: 8px; margin: 15px 0; }
        .objective { display: flex; align-items: center; gap: 10px; padding: 8px 12px; background: rgba(0, 0, 0, 0.2); border-radius: 6px; font-size: 0.9rem; }
        .objective.complete { background: rgba(34, 197, 94, 0.15); color: #4ade80; }
        .objective-icon { width: 20px; text-align: center; }
        .success-message { display: none; background: rgba(34, 197, 94, 0.2); border: 1px solid #22c55e; border-radius: 8px; padding: 15px; margin-top: 15px; }
        .success-message.show { display: block; }
        .port-open { color: #4ade80; }
        .port-filtered { color: #f59e0b; }
    </style>
</head>
<body>
    <header class="module-header">
        <div style="display: flex; align-items: center; gap: 20px;">
            <a href="../index.html" class="back-btn">&larr; Script House</a>
            <div class="module-badge"><span style="font-size: 1.5rem;">üîé</span><span class="module-badge-text">Recon</span></div>
        </div>
        <span style="color: #666; font-size: 0.8rem;">CLH-011 of 015</span>
    </header>

    <main class="content-wrapper">
        <h1 class="module-title">Network Reconnaissance</h1>
        <p class="module-subtitle">Map the network. Find open ports. Identify services. Know your target.</p>

        <div class="warning-box">
            <h4>‚ö†Ô∏è Authorization Required</h4>
            <p style="color: #ccc; margin: 0;">Only scan networks you own or have explicit written permission to test. Unauthorized scanning is illegal and unethical.</p>
        </div>

        <section class="section">
            <h2>üéØ The Recon Methodology</h2>
            <p>Network reconnaissance is the first phase of any security assessment. Before you can test a system, you need to understand what's there.</p>
            <div class="key-points">
                <div class="key-point">
                    <span class="key-point-icon">1Ô∏è‚É£</span>
                    <div class="key-point-content">
                        <h4>Host Discovery</h4>
                        <p>Find live systems on the network. What's actually online?</p>
                    </div>
                </div>
                <div class="key-point">
                    <span class="key-point-icon">2Ô∏è‚É£</span>
                    <div class="key-point-content">
                        <h4>Port Scanning</h4>
                        <p>Which ports are open? What services are listening?</p>
                    </div>
                </div>
                <div class="key-point">
                    <span class="key-point-icon">3Ô∏è‚É£</span>
                    <div class="key-point-content">
                        <h4>Service Enumeration</h4>
                        <p>What versions are running? Are they vulnerable?</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>üîç Nmap - The Network Mapper</h2>
            <p>Nmap is the industry standard for network discovery and security auditing.</p>
            <table class="command-table">
                <tr><th>Command</th><th>Purpose</th></tr>
                <tr><td><code>nmap 192.168.1.1</code></td><td>Basic scan (top 1000 ports)</td></tr>
                <tr><td><code>nmap -sn 192.168.1.0/24</code></td><td>Ping sweep - find live hosts</td></tr>
                <tr><td><code>nmap -p 1-65535 target</code></td><td>Scan ALL ports</td></tr>
                <tr><td><code>nmap -sV target</code></td><td>Version detection</td></tr>
                <tr><td><code>nmap -O target</code></td><td>OS detection</td></tr>
                <tr><td><code>nmap -A target</code></td><td>Aggressive scan (OS, version, scripts)</td></tr>
            </table>
            <div class="terminal">
                <code><span class="comment"># Find live hosts on a subnet</span>
<span class="keyword">nmap</span> -sn 192.168.1.0/24

<span class="output">Nmap scan report for 192.168.1.1
Host is up (0.0015s latency).
Nmap scan report for 192.168.1.50
Host is up (0.0023s latency).
Nmap scan report for 192.168.1.100
Host is up (0.0031s latency).</span>

<span class="comment"># Scan specific target with version detection</span>
<span class="keyword">nmap</span> -sV -p 22,80,443 192.168.1.100

<span class="output">PORT    STATE SERVICE VERSION
22/tcp  open  ssh     OpenSSH 8.2p1
80/tcp  open  http    Apache httpd 2.4.41
443/tcp open  ssl     OpenSSL 1.1.1f</span></code>
            </div>
        </section>

        <section class="section">
            <h2>üîå Netcat - The Swiss Army Knife</h2>
            <p>Netcat (nc) reads and writes data across network connections. Essential for testing connectivity and grabbing banners.</p>
            <div class="terminal">
                <code><span class="comment"># Check if a port is open</span>
<span class="keyword">nc</span> -zv 192.168.1.100 22
<span class="output">Connection to 192.168.1.100 22 port [tcp/ssh] succeeded!</span>

<span class="comment"># Grab a service banner</span>
<span class="keyword">nc</span> 192.168.1.100 22
<span class="output">SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.1</span>

<span class="comment"># Scan a range of ports</span>
<span class="keyword">nc</span> -zv 192.168.1.100 20-25 2>&1 | grep succeeded

<span class="comment"># Listen on a port (for testing)</span>
<span class="keyword">nc</span> -lvp 4444</code>
            </div>
        </section>

        <section class="section">
            <h2>üìã Common Ports to Know</h2>
            <table class="command-table">
                <tr><th>Port</th><th>Service</th><th>Security Note</th></tr>
                <tr><td><code>21</code></td><td>FTP</td><td>Often allows anonymous login</td></tr>
                <tr><td><code>22</code></td><td>SSH</td><td>Check for weak credentials</td></tr>
                <tr><td><code>23</code></td><td>Telnet</td><td>Cleartext - should be disabled</td></tr>
                <tr><td><code>25</code></td><td>SMTP</td><td>Email server, check for relay</td></tr>
                <tr><td><code>80/443</code></td><td>HTTP/HTTPS</td><td>Web apps, many attack vectors</td></tr>
                <tr><td><code>445</code></td><td>SMB</td><td>File sharing, EternalBlue</td></tr>
                <tr><td><code>3306</code></td><td>MySQL</td><td>Database, check remote access</td></tr>
                <tr><td><code>3389</code></td><td>RDP</td><td>Remote desktop, brute force target</td></tr>
            </table>
        </section>

        <section class="section">
            <h2>üìù Documenting Your Recon</h2>
            <div class="terminal">
                <code><span class="comment"># Save nmap output in all formats</span>
<span class="keyword">nmap</span> -sV -oA scan_results 192.168.1.0/24

<span class="comment"># Creates:</span>
<span class="output"># scan_results.nmap  (normal output)
# scan_results.xml   (XML for tools)
# scan_results.gnmap (greppable)</span>

<span class="comment"># Quick grep for open ports</span>
<span class="keyword">grep</span> "open" scan_results.nmap

<span class="comment"># Parse XML with grep</span>
<span class="keyword">grep</span> -oP 'portid="\K[^"]+' scan_results.xml</code>
            </div>
        </section>

        <!-- Interactive Lab -->
        <div class="lab-section">
            <h3>üéØ LAB: Network Recon Simulator</h3>
            <p style="color: #ccc; margin-bottom: 15px;">
                You have permission to scan the 10.0.0.0/24 network. Find live hosts, discover open ports, and identify running services.
            </p>

            <div class="objectives">
                <div class="objective" id="obj-ping"><span class="objective-icon">‚òê</span><span>Perform a ping sweep to find live hosts</span></div>
                <div class="objective" id="obj-scan"><span class="objective-icon">‚òê</span><span>Scan a target for open ports</span></div>
                <div class="objective" id="obj-version"><span class="objective-icon">‚òê</span><span>Identify service versions with -sV</span></div>
                <div class="objective" id="obj-nc"><span class="objective-icon">‚òê</span><span>Use netcat to grab a banner</span></div>
            </div>

            <div class="interactive-terminal">
                <div class="terminal-header">
                    <span class="terminal-dot red"></span><span class="terminal-dot yellow"></span><span class="terminal-dot green"></span>
                    <span style="color: #888; margin-left: 10px; font-size: 0.8rem;">recon-lab</span>
                </div>
                <div class="terminal-body">
                    <div class="terminal-output" id="terminalOutput">Network Reconnaissance Lab
===========================
Target Network: 10.0.0.0/24 (authorized)

Try: nmap -sn 10.0.0.0/24
     nmap -sV 10.0.0.10
     nc -v 10.0.0.10 22
</div>
                    <div class="terminal-input-line">
                        <span class="terminal-prompt">hacker@kali:~$</span>
                        <input type="text" class="terminal-input" id="terminalInput" autocomplete="off" placeholder="nmap...">
                        <button class="run-btn" onclick="runCommand()">Run</button>
                    </div>
                </div>
            </div>

            <div class="success-message" id="successMessage">
                <strong style="color: #22c55e;">üéâ RECON COMPLETE!</strong>
                <p style="margin-top: 10px; color: #ccc;">You've successfully mapped the network and enumerated services!</p>
            </div>
        </div>

        <div class="progress-section">
            <h3 style="color: var(--house-primary); margin-bottom: 20px;">Ready to Test Your Skills?</h3>
            <div class="module-nav">
                <a href="clh-011-quiz.html" class="nav-btn primary">Take the Quiz &rarr;</a>
                <a href="../index.html" class="nav-btn secondary">Back to Script House</a>
            </div>
            <div class="title-badge">üéñÔ∏è Completing CLH-010 to CLH-012 earns: CLI Engineer</div>
        </div>
    </main>
    <script src="../../../components/TrailHunter.js"></script>
    <script src="../../../components/ModuleProgress.js"></script>

    <script>
        let completed = { ping: false, scan: false, version: false, nc: false };

        const hosts = {
            '10.0.0.1': { up: true, ports: { 22: 'ssh', 80: 'http' }, versions: { 22: 'OpenSSH 8.2p1', 80: 'nginx 1.18.0' } },
            '10.0.0.10': { up: true, ports: { 22: 'ssh', 80: 'http', 443: 'https', 3306: 'mysql' }, versions: { 22: 'OpenSSH 7.9p1', 80: 'Apache 2.4.41', 443: 'Apache 2.4.41', 3306: 'MySQL 5.7.32' } },
            '10.0.0.25': { up: true, ports: { 22: 'ssh', 21: 'ftp', 445: 'smb' }, versions: { 22: 'OpenSSH 8.4p1', 21: 'vsftpd 3.0.3', 445: 'Samba 4.11' } },
            '10.0.0.50': { up: true, ports: { 80: 'http', 8080: 'http-proxy' }, versions: { 80: 'Apache 2.4.46', 8080: 'Apache Tomcat 9.0' } }
        };

        function runCommand() {
            const input = document.getElementById('terminalInput');
            const output = document.getElementById('terminalOutput');
            const cmd = input.value.trim();

            if (!cmd) return;
            output.innerHTML += `\nhacker@kali:~$ ${cmd}\n`;

            // Ping sweep
            if (cmd.includes('nmap') && cmd.includes('-sn') && cmd.includes('/24')) {
                output.innerHTML += `Starting Nmap ping sweep...\n\n`;
                Object.entries(hosts).forEach(([ip, data]) => {
                    if (data.up) output.innerHTML += `Nmap scan report for ${ip}\nHost is up (0.00${Math.floor(Math.random()*9)+1}s latency).\n\n`;
                });
                output.innerHTML += `Nmap done: 256 IP addresses (${Object.keys(hosts).length} hosts up)\n`;
                markComplete('ping');
            }
            // Version scan
            else if (cmd.includes('nmap') && cmd.includes('-sV')) {
                const ip = cmd.match(/(\d+\.\d+\.\d+\.\d+)/)?.[1];
                if (ip && hosts[ip]) {
                    output.innerHTML += `Starting Nmap version scan for ${ip}...\n\nPORT     STATE SERVICE VERSION\n`;
                    Object.entries(hosts[ip].ports).forEach(([port, service]) => {
                        output.innerHTML += `<span class="port-open">${port}/tcp  open  ${service.padEnd(8)} ${hosts[ip].versions[port]}</span>\n`;
                    });
                    output.innerHTML += `\nService detection performed.\n`;
                    markComplete('version');
                } else {
                    output.innerHTML += `Host seems down or not in range.\n`;
                }
            }
            // Basic scan
            else if (cmd.includes('nmap') && cmd.match(/\d+\.\d+\.\d+\.\d+/)) {
                const ip = cmd.match(/(\d+\.\d+\.\d+\.\d+)/)[1];
                if (hosts[ip]) {
                    output.innerHTML += `Starting Nmap for ${ip}...\n\nPORT     STATE SERVICE\n`;
                    Object.entries(hosts[ip].ports).forEach(([port, service]) => {
                        output.innerHTML += `<span class="port-open">${port}/tcp  open  ${service}</span>\n`;
                    });
                    output.innerHTML += `\nNmap done: 1 IP address (1 host up)\n`;
                    markComplete('scan');
                } else {
                    output.innerHTML += `Host seems down.\n`;
                }
            }
            // Netcat
            else if (cmd.includes('nc ') || cmd.includes('netcat')) {
                const ip = cmd.match(/(\d+\.\d+\.\d+\.\d+)/)?.[1];
                const port = cmd.match(/\s(\d+)\s*$/)?.[1];
                if (ip && port && hosts[ip]?.ports[port]) {
                    output.innerHTML += `Connection to ${ip} ${port} port [tcp/${hosts[ip].ports[port]}] succeeded!\n`;
                    if (port === '22') output.innerHTML += `SSH-2.0-${hosts[ip].versions[port]}\n`;
                    if (port === '21') output.innerHTML += `220 ${hosts[ip].versions[port]} ready.\n`;
                    markComplete('nc');
                } else {
                    output.innerHTML += `Connection refused or host down.\n`;
                }
            }
            // Clear
            else if (cmd === 'clear') {
                output.innerHTML = '';
            }
            // Help
            else if (cmd === 'help') {
                output.innerHTML += `Commands: nmap, nc/netcat, clear\nTarget: 10.0.0.0/24\n`;
            }
            else {
                output.innerHTML += `Try: nmap -sn 10.0.0.0/24 or nmap -sV 10.0.0.10\n`;
            }

            checkAllComplete();
            output.scrollTop = output.scrollHeight;
            input.value = '';
        }

        function markComplete(obj) {
            if (!completed[obj]) {
                completed[obj] = true;
                const el = document.getElementById(`obj-${obj}`);
                if (el) { el.classList.add('complete'); el.querySelector('.objective-icon').textContent = '‚úì'; }
            }
        }

        function checkAllComplete() {
            if (Object.values(completed).every(v => v)) {
                document.getElementById('successMessage').classList.add('show');
            }
        }

        document.getElementById('terminalInput').addEventListener('keypress', e => { if (e.key === 'Enter') runCommand(); });
    </script>
<script src="../../../components/FluxCapacitor.js"></script>
</body>
</html>
