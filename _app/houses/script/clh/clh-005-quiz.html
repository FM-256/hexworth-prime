<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLH-005 Quiz: Process Investigation - Hexworth Prime</title>
    <style>
        :root {
            --house-primary: #a78bfa;
            --house-secondary: #8b5cf6;
            --house-glow: rgba(167, 139, 250, 0.3);
            --terminal-green: #4ade80;
            --correct: #22c55e;
            --incorrect: #ef4444;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { min-height: 100vh; background: #0a0a0f; font-family: 'Segoe UI', sans-serif; color: #e0e0e0; }
        .quiz-header { padding: 20px 40px; border-bottom: 1px solid rgba(167, 139, 250, 0.2); background: rgba(10, 10, 15, 0.95); display: flex; justify-content: space-between; align-items: center; }
        .back-btn { padding: 8px 16px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: #888; font-size: 0.8rem; text-decoration: none; }
        .back-btn:hover { background: rgba(255, 255, 255, 0.1); color: #fff; }
        .progress-bar { width: 200px; height: 6px; background: rgba(255, 255, 255, 0.1); border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--house-primary), var(--terminal-green)); width: 0%; transition: width 0.5s ease; }
        .quiz-container { max-width: 800px; margin: 40px auto; padding: 0 20px; }
        .quiz-title { text-align: center; margin-bottom: 40px; }
        .quiz-title h1 { font-size: 2rem; color: var(--house-primary); margin-bottom: 10px; }
        .quiz-title p { color: #666; }
        .question-card { background: rgba(15, 15, 20, 0.6); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 30px; display: none; }
        .question-card.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .question-number { color: var(--house-primary); font-size: 0.85rem; letter-spacing: 0.1em; margin-bottom: 15px; }
        .question-text { font-size: 1.2rem; margin-bottom: 25px; line-height: 1.6; }
        .question-text code { background: rgba(74, 222, 128, 0.1); color: var(--terminal-green); padding: 2px 8px; border-radius: 4px; font-family: 'Consolas', monospace; }
        .options { display: grid; gap: 12px; }
        .option { padding: 15px 20px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 12px; }
        .option:hover:not(.disabled) { background: rgba(167, 139, 250, 0.1); border-color: var(--house-primary); }
        .option.correct { background: rgba(34, 197, 94, 0.2); border-color: var(--correct); }
        .option.incorrect { background: rgba(239, 68, 68, 0.2); border-color: var(--incorrect); }
        .option.disabled { pointer-events: none; opacity: 0.7; }
        .option-letter { width: 28px; height: 28px; border-radius: 50%; background: rgba(255, 255, 255, 0.1); display: flex; align-items: center; justify-content: center; font-size: 0.85rem; font-weight: 600; flex-shrink: 0; }
        .feedback { margin-top: 20px; padding: 15px; border-radius: 8px; display: none; }
        .feedback.show { display: block; }
        .feedback.correct { background: rgba(34, 197, 94, 0.1); border-left: 3px solid var(--correct); }
        .feedback.incorrect { background: rgba(239, 68, 68, 0.1); border-left: 3px solid var(--incorrect); }
        .nav-buttons { display: flex; justify-content: flex-end; margin-top: 30px; }
        .nav-btn { padding: 12px 30px; border-radius: 8px; font-size: 0.9rem; cursor: pointer; border: none; background: linear-gradient(135deg, var(--house-primary), var(--house-secondary)); color: #fff; }
        .nav-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 20px var(--house-glow); }
        .nav-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .results-card { background: rgba(15, 15, 20, 0.6); border: 1px solid rgba(167, 139, 250, 0.3); border-radius: 12px; padding: 50px; text-align: center; display: none; }
        .results-card.show { display: block; }
        .score-circle { width: 150px; height: 150px; border-radius: 50%; background: linear-gradient(135deg, var(--house-primary), var(--terminal-green)); display: flex; align-items: center; justify-content: center; margin: 0 auto 30px; font-size: 3rem; font-weight: bold; color: #fff; }
        .results-title { font-size: 1.8rem; color: var(--house-primary); margin-bottom: 15px; }
        .results-subtitle { color: #888; margin-bottom: 30px; }
        .results-actions { display: flex; gap: 15px; justify-content: center; }
        .action-btn { padding: 12px 30px; border-radius: 8px; text-decoration: none; font-size: 0.9rem; }
        .action-btn.primary { background: linear-gradient(135deg, var(--house-primary), var(--house-secondary)); color: #fff; }
        .action-btn.secondary { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); color: #ccc; }
    </style>
</head>
<body>
    <header class="quiz-header">
        <a href="clh-005-intro.html" class="back-btn">&larr; Back to Lesson</a>
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        <span id="questionCounter" style="color: #666; font-size: 0.85rem;">1 / 5</span>
    </header>

    <div class="quiz-container">
        <div class="quiz-title">
            <h1>CLH-005: Process Investigation Quiz</h1>
            <p>Test your process hunting skills</p>
        </div>
        <div id="questionsContainer"></div>
        <div class="results-card" id="resultsCard">
            <div class="score-circle" id="scoreCircle">0%</div>
            <h2 class="results-title" id="resultsTitle">Quiz Complete!</h2>
            <p class="results-subtitle" id="resultsSubtitle"></p>
            <div class="results-actions">
                <a href="clh-005-intro.html" class="action-btn secondary">Review Lesson</a>
                <a href="clh-006-intro.html" class="action-btn primary" id="nextModuleBtn">Next Module &rarr;</a>
            </div>
        </div>
    </div>

    <script src="../../../components/TrailHunter.js"></script>
    <script src="../../../components/ModuleProgress.js"></script>
    <script>
        const questions = [
            {
                question: 'Which command shows all running processes with CPU and memory usage?',
                options: ['<code>ls -la</code>', '<code>ps aux</code>', '<code>top -n 1</code>', '<code>cat /proc</code>'],
                correct: 1,
                feedback: { correct: 'Correct! ps aux shows all processes (a), for all users (u), with extended info (x) including CPU and memory.', incorrect: 'ps aux lists all processes with user, CPU%, MEM%, and command information.' }
            },
            {
                question: 'What is a red flag when examining a process list?',
                options: ['Process running as www-data', 'Firefox using 2% CPU', 'Unknown process with high CPU from /tmp', 'systemd as PID 1'],
                correct: 2,
                feedback: { correct: 'Correct! Unknown processes, especially from /tmp or with high resource usage, are major red flags indicating potential malware.', incorrect: 'Suspicious indicators include: unknown names, unusual paths (/tmp, /dev/shm), and unexplained high resource usage.' }
            },
            {
                question: 'Which command forcefully terminates a process?',
                options: ['<code>stop [PID]</code>', '<code>end [PID]</code>', '<code>kill -9 [PID]</code>', '<code>terminate [PID]</code>'],
                correct: 2,
                feedback: { correct: 'Correct! kill -9 sends SIGKILL, which forcefully terminates a process immediately without cleanup.', incorrect: 'kill -9 [PID] sends SIGKILL to forcefully terminate a process. -9 means "cannot be ignored".' }
            },
            {
                question: 'What does <code>lsof -p [PID]</code> show?',
                options: ['Process memory usage', 'Files opened by that process', 'Network connections only', 'Process start time'],
                correct: 1,
                feedback: { correct: 'Correct! lsof (list open files) shows all files, sockets, and resources a process has open - essential for understanding what it\'s doing.', incorrect: 'lsof -p shows all files opened by a process, including network sockets, which reveals what the process is accessing.' }
            },
            {
                question: 'A crypto miner on a compromised system would likely show:',
                options: ['Low CPU, low memory', 'High CPU usage, unknown process name', 'Normal network traffic only', 'No visible processes'],
                correct: 1,
                feedback: { correct: 'Correct! Crypto miners consume massive CPU resources and often have generic or obfuscated names to avoid detection.', incorrect: 'Crypto miners are CPU-intensive and typically appear as unknown or oddly-named processes consuming high CPU.' }
            }
        ];

        let currentQuestion = 0, score = 0, answered = new Array(questions.length).fill(false);

        function initQuiz() {
            const container = document.getElementById('questionsContainer');
            questions.forEach((q, idx) => { container.innerHTML += createQuestionHTML(q, idx); });
            showQuestion(0);
        }

        function createQuestionHTML(q, idx) {
            const letters = ['A', 'B', 'C', 'D'];
            return `<div class="question-card" id="question${idx}">
                <div class="question-number">QUESTION ${idx + 1} OF ${questions.length}</div>
                <div class="question-text">${q.question}</div>
                <div class="options">${q.options.map((opt, i) => `<div class="option" onclick="selectOption(${idx}, ${i})"><span class="option-letter">${letters[i]}</span><span>${opt}</span></div>`).join('')}</div>
                <div class="feedback" id="feedback${idx}"></div>
                <div class="nav-buttons"><button class="nav-btn" id="nextBtn${idx}" onclick="nextQuestion()" disabled>${idx === questions.length - 1 ? 'See Results' : 'Next &rarr;'}</button></div>
            </div>`;
        }

        function showQuestion(idx) {
            document.querySelectorAll('.question-card').forEach(c => c.classList.remove('active'));
            document.getElementById(`question${idx}`).classList.add('active');
            document.getElementById('progressFill').style.width = `${((idx + 1) / questions.length) * 100}%`;
            document.getElementById('questionCounter').textContent = `${idx + 1} / ${questions.length}`;
        }

        function selectOption(qIdx, optIdx) {
            if (answered[qIdx]) return;
            answered[qIdx] = true;
            const q = questions[qIdx];
            const options = document.querySelectorAll(`#question${qIdx} .option`);
            const feedback = document.getElementById(`feedback${qIdx}`);
            options.forEach((opt, i) => { opt.classList.add('disabled'); if (i === q.correct) opt.classList.add('correct'); else if (i === optIdx) opt.classList.add('incorrect'); });
            if (optIdx === q.correct) { score++; feedback.className = 'feedback show correct'; feedback.innerHTML = `&#10003; ${q.feedback.correct}`; }
            else { feedback.className = 'feedback show incorrect'; feedback.innerHTML = `&#10007; ${q.feedback.incorrect}`; }
            document.getElementById(`nextBtn${qIdx}`).disabled = false;
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) { currentQuestion++; showQuestion(currentQuestion); }
            else { showResults(); }
        }

        function showResults() {
            document.querySelectorAll('.question-card').forEach(c => c.classList.remove('active'));
            document.getElementById('resultsCard').classList.add('show');
            const pct = Math.round((score / questions.length) * 100);
            document.getElementById('scoreCircle').textContent = `${pct}%`;
            document.getElementById('resultsSubtitle').textContent = `You scored ${score} out of ${questions.length} correct`;
            if (pct >= 80) { document.getElementById('resultsTitle').textContent = 'Process Hunter!'; if (typeof ModuleProgress !== 'undefined') ModuleProgress.completeQuiz('script', 'clh-005-quiz', pct, { returnToDashboard: false }); }
            else if (pct >= 60) { document.getElementById('resultsTitle').textContent = 'Good Detection!'; }
            else { document.getElementById('resultsTitle').textContent = 'Keep Hunting!'; document.getElementById('nextModuleBtn').textContent = 'Retry Quiz'; document.getElementById('nextModuleBtn').href = 'clh-005-quiz.html'; }
        }

        initQuiz();
    </script>
</body>
</html>
