<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLH-006: Permissions & Access Control - Hexworth Prime</title>
    <style>
        :root { --house-primary: #a78bfa; --house-secondary: #8b5cf6; --house-glow: rgba(167, 139, 250, 0.3); --terminal-green: #4ade80; --terminal-bg: #0d1117; --danger: #ef4444; --warning: #f59e0b; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { min-height: 100vh; background: #0a0a0f; font-family: 'Segoe UI', sans-serif; color: #e0e0e0; }
        .module-header { padding: 20px 40px; border-bottom: 1px solid rgba(167, 139, 250, 0.2); background: rgba(10, 10, 15, 0.95); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px); }
        .header-left { display: flex; align-items: center; gap: 20px; }
        .back-btn { display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: #888; font-size: 0.8rem; text-decoration: none; }
        .back-btn:hover { background: rgba(255, 255, 255, 0.1); color: #fff; }
        .module-badge { display: flex; align-items: center; gap: 12px; padding: 10px 20px; background: rgba(167, 139, 250, 0.1); border: 1px solid rgba(167, 139, 250, 0.3); border-radius: 25px; }
        .module-badge-text { font-size: 0.75rem; letter-spacing: 0.15em; color: var(--house-primary); text-transform: uppercase; }
        .content-wrapper { max-width: 900px; margin: 0 auto; padding: 40px 20px; }
        .module-title { font-size: 2.5rem; margin-bottom: 10px; background: linear-gradient(135deg, var(--house-primary), var(--terminal-green)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .module-subtitle { color: #888; font-size: 1.1rem; margin-bottom: 30px; }
        .section { background: rgba(15, 15, 20, 0.6); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 30px; margin-bottom: 30px; }
        .section h2 { color: var(--house-primary); font-size: 1.4rem; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .section p { line-height: 1.8; margin-bottom: 15px; color: #ccc; }
        .terminal { background: var(--terminal-bg); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 8px; padding: 20px; font-family: 'Consolas', monospace; margin: 20px 0; position: relative; overflow-x: auto; }
        .terminal::before { content: '$ terminal'; position: absolute; top: -10px; left: 15px; background: var(--terminal-bg); padding: 0 10px; font-size: 0.7rem; color: var(--terminal-green); }
        .terminal code { color: var(--terminal-green); display: block; line-height: 1.6; white-space: pre-wrap; font-size: 0.85rem; }
        .terminal .prompt { color: #60a5fa; }
        .terminal .command { color: #fff; }
        .terminal .output { color: #888; }
        .terminal .perm-r { color: #4ade80; }
        .terminal .perm-w { color: #f59e0b; }
        .terminal .perm-x { color: #ef4444; }
        .command-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .command-table th, .command-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .command-table th { background: rgba(167, 139, 250, 0.1); color: var(--house-primary); }
        .command-table code { background: rgba(74, 222, 128, 0.1); color: var(--terminal-green); padding: 2px 8px; border-radius: 4px; font-family: 'Consolas', monospace; }
        .perm-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0; }
        .perm-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 20px; text-align: center; }
        .perm-symbol { font-size: 2rem; font-family: monospace; margin-bottom: 10px; }
        .perm-name { color: var(--house-primary); font-weight: 600; margin-bottom: 5px; }
        .perm-desc { font-size: 0.85rem; color: #888; }
        .key-points { display: grid; gap: 15px; margin: 20px 0; }
        .key-point { display: flex; align-items: flex-start; gap: 15px; padding: 15px; background: rgba(167, 139, 250, 0.05); border-left: 3px solid var(--house-primary); border-radius: 0 8px 8px 0; }
        .key-point-icon { font-size: 1.5rem; flex-shrink: 0; }
        .key-point-content h4 { color: var(--house-primary); margin-bottom: 5px; }
        .key-point-content p { margin: 0; font-size: 0.9rem; }
        .octal-table { width: 100%; border-collapse: collapse; margin: 20px 0; font-family: monospace; }
        .octal-table th, .octal-table td { padding: 10px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.1); }
        .octal-table th { background: rgba(167, 139, 250, 0.1); color: var(--house-primary); }
        .progress-section { text-align: center; padding: 40px; background: rgba(167, 139, 250, 0.05); border-radius: 12px; margin-top: 40px; }
        .progress-section h3 { color: var(--house-primary); margin-bottom: 20px; }
        .module-nav { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
        .nav-btn { padding: 12px 30px; border-radius: 8px; font-size: 0.9rem; text-decoration: none; cursor: pointer; }
        .nav-btn.primary { background: linear-gradient(135deg, var(--house-primary), var(--house-secondary)); color: #fff; border: none; }
        .nav-btn.primary:hover { transform: translateY(-2px); box-shadow: 0 5px 20px var(--house-glow); }
        .nav-btn.secondary { background: rgba(255, 255, 255, 0.05); color: #ccc; border: 1px solid rgba(255, 255, 255, 0.1); }
        .title-badge { display: inline-block; background: linear-gradient(135deg, rgba(74, 222, 128, 0.2), rgba(167, 139, 250, 0.2)); border: 1px solid rgba(74, 222, 128, 0.5); padding: 8px 20px; border-radius: 20px; font-size: 0.85rem; color: var(--terminal-green); margin-top: 15px; }

        /* Interactive Lab */
        .lab-section { background: linear-gradient(135deg, rgba(74, 222, 128, 0.1), rgba(167, 139, 250, 0.1)); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 12px; padding: 25px; margin: 30px 0; }
        .lab-section h3 { color: var(--terminal-green); margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .interactive-terminal { background: var(--terminal-bg); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 8px; overflow: hidden; margin: 20px 0; }
        .terminal-header { background: rgba(255, 255, 255, 0.05); padding: 8px 15px; display: flex; align-items: center; gap: 8px; }
        .terminal-dot { width: 12px; height: 12px; border-radius: 50%; }
        .terminal-dot.red { background: #ef4444; }
        .terminal-dot.yellow { background: #fbbf24; }
        .terminal-dot.green { background: #22c55e; }
        .terminal-body { padding: 15px; }
        .terminal-output { color: #888; font-family: 'Consolas', monospace; font-size: 0.85rem; line-height: 1.6; min-height: 220px; max-height: 350px; overflow-y: auto; margin-bottom: 10px; white-space: pre-wrap; }
        .terminal-input-line { display: flex; align-items: center; gap: 10px; }
        .terminal-prompt { color: var(--terminal-green); font-family: 'Consolas', monospace; }
        .terminal-input { flex: 1; background: transparent; border: none; color: #fff; font-family: 'Consolas', monospace; font-size: 0.9rem; outline: none; }
        .run-btn { padding: 8px 20px; background: var(--terminal-green); color: #000; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; }
        .run-btn:hover { background: #22c55e; }
        .success-message { display: none; background: rgba(34, 197, 94, 0.2); border: 1px solid #22c55e; border-radius: 8px; padding: 15px; margin-top: 15px; }
        .success-message.show { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .objectives { display: grid; gap: 8px; margin: 15px 0; }
        .objective { display: flex; align-items: center; gap: 10px; padding: 8px 12px; background: rgba(0, 0, 0, 0.2); border-radius: 6px; font-size: 0.9rem; }
        .objective.complete { background: rgba(34, 197, 94, 0.15); color: #4ade80; }
        .objective-icon { width: 20px; text-align: center; }
        .perm-rr { color: #4ade80; }
        .perm-ww { color: #f59e0b; }
        .perm-xx { color: #ef4444; }
        .perm-suid { color: #f472b6; font-weight: bold; }
    </style>
</head>
<body>
    <header class="module-header">
        <div class="header-left">
            <a href="../index.html" class="back-btn"><span>&larr;</span> Script House</a>
            <div class="module-badge">
                <span style="font-size: 1.5rem;">üîê</span>
                <span class="module-badge-text">Permissions</span>
            </div>
        </div>
        <div class="header-right"><span style="color: #666; font-size: 0.8rem;">CLH-006 of 015</span></div>
    </header>

    <main class="content-wrapper">
        <h1 class="module-title">Permissions & Access Control</h1>
        <p class="module-subtitle">Control who can read, write, and execute. The foundation of Linux security.</p>

        <section class="section">
            <h2>üîí The Linux Permission Model</h2>
            <p>Every file and directory in Linux has three permission types for three user categories. Understanding this model is essential for both securing systems and finding privilege escalation vulnerabilities.</p>

            <div class="perm-grid">
                <div class="perm-card">
                    <div class="perm-symbol" style="color: #4ade80;">r</div>
                    <div class="perm-name">Read (4)</div>
                    <div class="perm-desc">View file contents or list directory</div>
                </div>
                <div class="perm-card">
                    <div class="perm-symbol" style="color: #f59e0b;">w</div>
                    <div class="perm-name">Write (2)</div>
                    <div class="perm-desc">Modify file or create/delete in directory</div>
                </div>
                <div class="perm-card">
                    <div class="perm-symbol" style="color: #ef4444;">x</div>
                    <div class="perm-name">Execute (1)</div>
                    <div class="perm-desc">Run as program or enter directory</div>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>üìä Reading Permission Strings</h2>
            <div class="terminal">
                <code><span class="prompt">user@linux:~$</span> <span class="command">ls -la /etc/shadow</span>
<span class="output">-<span class="perm-r">r</span><span class="perm-w">w</span>-<span class="perm-r">r</span>----- 1 root shadow 1423 Dec 18 16:30 /etc/shadow</span>

<span class="output"># Breaking it down:</span>
<span class="output"># -        = regular file (d = directory, l = link)</span>
<span class="output"># rw-      = owner (root) can read and write</span>
<span class="output"># r--      = group (shadow) can read only</span>
<span class="output"># ---      = others have NO access</span></code>
            </div>

            <table class="octal-table">
                <tr><th>Octal</th><th>Binary</th><th>Permission</th><th>Meaning</th></tr>
                <tr><td>7</td><td>111</td><td>rwx</td><td>Full access</td></tr>
                <tr><td>6</td><td>110</td><td>rw-</td><td>Read + Write</td></tr>
                <tr><td>5</td><td>101</td><td>r-x</td><td>Read + Execute</td></tr>
                <tr><td>4</td><td>100</td><td>r--</td><td>Read only</td></tr>
                <tr><td>0</td><td>000</td><td>---</td><td>No access</td></tr>
            </table>
        </section>

        <section class="section">
            <h2>üõ†Ô∏è Permission Commands</h2>
            <table class="command-table">
                <tr><th>Command</th><th>Purpose</th><th>Example</th></tr>
                <tr><td><code>chmod 755 file</code></td><td>Set permissions (octal)</td><td>rwxr-xr-x</td></tr>
                <tr><td><code>chmod u+x file</code></td><td>Add execute for user</td><td>Symbolic mode</td></tr>
                <tr><td><code>chown user:group file</code></td><td>Change owner and group</td><td>chown root:www-data</td></tr>
                <tr><td><code>chgrp group file</code></td><td>Change group only</td><td>chgrp developers</td></tr>
            </table>
        </section>

        <section class="section">
            <h2>üö® Security Implications</h2>
            <div class="key-points">
                <div class="key-point">
                    <span class="key-point-icon">‚ö†Ô∏è</span>
                    <div class="key-point-content">
                        <h4>World-Writable Files</h4>
                        <p><code>chmod 777</code> = anyone can modify. Never use on scripts or configs!</p>
                    </div>
                </div>
                <div class="key-point">
                    <span class="key-point-icon">üîë</span>
                    <div class="key-point-content">
                        <h4>SUID Bit</h4>
                        <p>Files with SUID run as the owner, not the user. Prime privilege escalation targets.</p>
                    </div>
                </div>
                <div class="key-point">
                    <span class="key-point-icon">üìÅ</span>
                    <div class="key-point-content">
                        <h4>Sticky Bit</h4>
                        <p>On directories (like /tmp), only owner can delete their files.</p>
                    </div>
                </div>
            </div>

            <div class="terminal">
                <code><span class="prompt">hacker@target:~$</span> <span class="command">find / -perm -4000 2>/dev/null</span>
<span class="output"># Find all SUID binaries - potential privesc vectors!</span>
<span class="output">/usr/bin/passwd</span>
<span class="output">/usr/bin/sudo</span>
<span class="output">/usr/bin/pkexec</span></code>
            </div>
        </section>

        <!-- Interactive Lab -->
        <div class="lab-section">
            <h3>üéØ LAB: Permission Hunter</h3>
            <p style="color: #ccc; margin-bottom: 15px;">
                You've gained access to a system. Your mission: analyze file permissions, identify security issues, and find SUID binaries that could be used for privilege escalation.
            </p>

            <div class="objectives" id="objectives">
                <div class="objective" id="obj-ls">
                    <span class="objective-icon">‚òê</span>
                    <span>List files with permissions in /var/www</span>
                </div>
                <div class="objective" id="obj-chmod">
                    <span class="objective-icon">‚òê</span>
                    <span>Fix an insecure world-writable config file</span>
                </div>
                <div class="objective" id="obj-suid">
                    <span class="objective-icon">‚òê</span>
                    <span>Find SUID binaries on the system</span>
                </div>
                <div class="objective" id="obj-stat">
                    <span class="objective-icon">‚òê</span>
                    <span>Get detailed info on a suspicious binary</span>
                </div>
            </div>

            <div class="interactive-terminal">
                <div class="terminal-header">
                    <span class="terminal-dot red"></span>
                    <span class="terminal-dot yellow"></span>
                    <span class="terminal-dot green"></span>
                    <span style="color: #888; margin-left: 10px; font-size: 0.8rem;">perm-hunter</span>
                </div>
                <div class="terminal-body">
                    <div class="terminal-output" id="terminalOutput">Permission Hunter Lab
=====================
You have shell access. Hunt for permission issues!

Current directory: /home/user
Commands: ls, chmod, find, stat, cd, pwd, help

Hint: Check /var/www for web server files...
</div>
                    <div class="terminal-input-line">
                        <span class="terminal-prompt" id="promptDisplay">user@target:~$</span>
                        <input type="text" class="terminal-input" id="terminalInput" placeholder="type command..." autocomplete="off">
                        <button class="run-btn" onclick="runCommand()">Run</button>
                    </div>
                </div>
            </div>

            <div class="success-message" id="successMessage">
                <strong style="color: #22c55e;">üéâ PERMISSION HUNT COMPLETE!</strong>
                <p style="margin-top: 10px; color: #ccc;">You've identified security issues and found privilege escalation vectors!</p>
                <p style="color: #888; font-size: 0.9rem; margin-top: 5px;">
                    Skills demonstrated: Permission analysis, SUID hunting, secure file practices.
                </p>
            </div>
        </div>

        <div class="progress-section">
            <h3>Ready to Test Your Skills?</h3>
            <p style="color: #888; margin-bottom: 20px;">Complete the quiz to prove your permission mastery.</p>
            <div class="module-nav">
                <a href="clh-006-quiz.html" class="nav-btn primary">Take the Quiz &rarr;</a>
                <a href="../index.html" class="nav-btn secondary">Back to Script House</a>
            </div>
            <div class="title-badge">üéñÔ∏è Completing CLH-004 to CLH-006 earns: CLI Analyst</div>
        </div>
    </main>

    <script src="../../../components/TrailHunter.js"></script>
    <script src="../../../components/ModuleProgress.js"></script>

    <script>
        // Virtual filesystem with permissions
        const fileSystem = {
            '/': { type: 'dir', perm: 'drwxr-xr-x', owner: 'root', group: 'root' },
            '/home': { type: 'dir', perm: 'drwxr-xr-x', owner: 'root', group: 'root' },
            '/home/user': { type: 'dir', perm: 'drwxr-xr-x', owner: 'user', group: 'user', contents: ['notes.txt', '.ssh'] },
            '/home/user/notes.txt': { type: 'file', perm: '-rw-r--r--', owner: 'user', group: 'user' },
            '/home/user/.ssh': { type: 'dir', perm: 'drwx------', owner: 'user', group: 'user', contents: ['id_rsa'] },
            '/var': { type: 'dir', perm: 'drwxr-xr-x', owner: 'root', group: 'root' },
            '/var/www': { type: 'dir', perm: 'drwxr-xr-x', owner: 'www-data', group: 'www-data', contents: ['index.html', 'config.php', 'uploads'] },
            '/var/www/index.html': { type: 'file', perm: '-rw-r--r--', owner: 'www-data', group: 'www-data' },
            '/var/www/config.php': { type: 'file', perm: '-rw-rw-rw-', owner: 'www-data', group: 'www-data', insecure: true },
            '/var/www/uploads': { type: 'dir', perm: 'drwxrwxrwx', owner: 'www-data', group: 'www-data' },
            '/usr': { type: 'dir', perm: 'drwxr-xr-x', owner: 'root', group: 'root' },
            '/usr/bin': { type: 'dir', perm: 'drwxr-xr-x', owner: 'root', group: 'root' },
            '/usr/bin/sudo': { type: 'file', perm: '-rwsr-xr-x', owner: 'root', group: 'root', suid: true },
            '/usr/bin/passwd': { type: 'file', perm: '-rwsr-xr-x', owner: 'root', group: 'root', suid: true },
            '/usr/bin/pkexec': { type: 'file', perm: '-rwsr-xr-x', owner: 'root', group: 'root', suid: true },
            '/usr/local': { type: 'dir', perm: 'drwxr-xr-x', owner: 'root', group: 'root' },
            '/usr/local/bin': { type: 'dir', perm: 'drwxr-xr-x', owner: 'root', group: 'root' },
            '/usr/local/bin/backup': { type: 'file', perm: '-rwsr-xr-x', owner: 'root', group: 'root', suid: true, suspicious: true },
            '/tmp': { type: 'dir', perm: 'drwxrwxrwt', owner: 'root', group: 'root', contents: ['sess_abc'] }
        };

        let currentPath = '/home/user';
        let completed = { ls: false, chmod: false, suid: false, stat: false };

        function colorPerm(perm) {
            return perm.split('').map((c, i) => {
                if (i === 0) return c;
                if (c === 'r') return `<span class="perm-rr">${c}</span>`;
                if (c === 'w') return `<span class="perm-ww">${c}</span>`;
                if (c === 'x') return `<span class="perm-xx">${c}</span>`;
                if (c === 's' || c === 'S') return `<span class="perm-suid">${c}</span>`;
                if (c === 't' || c === 'T') return `<span class="perm-xx">${c}</span>`;
                return c;
            }).join('');
        }

        function resolvePath(path) {
            if (path.startsWith('/')) return path;
            if (path === '..') {
                const parts = currentPath.split('/').filter(p => p);
                parts.pop();
                return '/' + parts.join('/') || '/';
            }
            if (path === '.') return currentPath;
            return currentPath === '/' ? '/' + path : currentPath + '/' + path;
        }

        function runCommand() {
            const input = document.getElementById('terminalInput');
            const output = document.getElementById('terminalOutput');
            const command = input.value.trim();
            const prompt = document.getElementById('promptDisplay').textContent;

            if (!command) return;

            output.innerHTML += `\n${prompt} ${command}\n`;

            const parts = command.split(/\s+/);
            const cmd = parts[0];
            const args = parts.slice(1);

            switch(cmd) {
                case 'pwd':
                    output.innerHTML += currentPath + '\n';
                    break;
                case 'ls':
                    handleLs(args, output);
                    break;
                case 'cd':
                    handleCd(args, output);
                    break;
                case 'chmod':
                    handleChmod(args, output);
                    break;
                case 'find':
                    handleFind(args, output);
                    break;
                case 'stat':
                    handleStat(args, output);
                    break;
                case 'clear':
                    output.innerHTML = '';
                    break;
                case 'help':
                    output.innerHTML += `Commands:
  ls -la [path]     - List files with permissions
  cd [path]         - Change directory
  chmod MODE FILE   - Change file permissions (e.g., chmod 644 file)
  find PATH OPTIONS - Find files (e.g., find / -perm -4000)
  stat FILE         - Show detailed file info
  pwd               - Print working directory
  clear             - Clear screen\n`;
                    break;
                default:
                    output.innerHTML += `${cmd}: command not found\n`;
            }

            checkAllComplete();
            output.scrollTop = output.scrollHeight;
            input.value = '';
        }

        function handleLs(args, output) {
            let path = currentPath;
            let longFormat = false;
            let showHidden = false;

            args.forEach(arg => {
                if (arg.includes('l')) longFormat = true;
                if (arg.includes('a')) showHidden = true;
                if (!arg.startsWith('-')) path = resolvePath(arg);
            });

            const node = fileSystem[path];
            if (!node) {
                output.innerHTML += `ls: cannot access '${path}': No such file or directory\n`;
                return;
            }

            if (node.type !== 'dir') {
                output.innerHTML += `${longFormat ? colorPerm(node.perm) + '  1 ' + node.owner + ' ' + node.group + '  ' : ''}${path.split('/').pop()}\n`;
                return;
            }

            const contents = node.contents || Object.keys(fileSystem).filter(p => {
                const parts = p.split('/');
                const parentPath = parts.slice(0, -1).join('/') || '/';
                return parentPath === path && p !== path;
            }).map(p => p.split('/').pop());

            let files = showHidden ? ['.', '..', ...contents] : contents.filter(f => !f.startsWith('.'));

            if (longFormat) {
                output.innerHTML += `total ${files.length * 4}\n`;
                files.forEach(f => {
                    if (f === '.' || f === '..') {
                        output.innerHTML += `drwxr-xr-x  .${f === '..' ? '.' : ''}\n`;
                        return;
                    }
                    const fullPath = path === '/' ? '/' + f : path + '/' + f;
                    const child = fileSystem[fullPath];
                    if (child) {
                        output.innerHTML += `${colorPerm(child.perm)}  1 ${child.owner} ${child.group}  4096 Dec 25 10:00 ${f}\n`;
                    }
                });

                if (path === '/var/www' || path.includes('/var/www')) {
                    markComplete('ls');
                }
            } else {
                output.innerHTML += files.join('  ') + '\n';
            }
        }

        function handleCd(args, output) {
            if (args.length === 0) {
                currentPath = '/home/user';
            } else {
                const newPath = resolvePath(args[0]);
                const node = fileSystem[newPath];
                if (node && node.type === 'dir') {
                    currentPath = newPath;
                } else if (node && node.type === 'file') {
                    output.innerHTML += `cd: ${args[0]}: Not a directory\n`;
                    return;
                } else {
                    output.innerHTML += `cd: ${args[0]}: No such directory\n`;
                    return;
                }
            }
            const shortPath = currentPath === '/home/user' ? '~' : currentPath;
            document.getElementById('promptDisplay').textContent = `user@target:${shortPath}$`;
        }

        function handleChmod(args, output) {
            if (args.length < 2) {
                output.innerHTML += 'chmod: missing operand\n';
                return;
            }

            const mode = args[0];
            const path = resolvePath(args[1]);
            const node = fileSystem[path];

            if (!node) {
                output.innerHTML += `chmod: cannot access '${args[1]}': No such file\n`;
                return;
            }

            // Check if it's the insecure config file and user is fixing it
            if (path === '/var/www/config.php' && (mode === '644' || mode === '640' || mode === '600')) {
                node.perm = '-rw-r--r--';
                node.insecure = false;
                output.innerHTML += `<span style="color: #4ade80;">‚úì Fixed! config.php is now secure.</span>\n`;
                markComplete('chmod');
            } else if (node.owner !== 'user' && node.owner !== 'www-data') {
                output.innerHTML += `chmod: changing permissions of '${args[1]}': Operation not permitted\n`;
            } else {
                output.innerHTML += `(permissions updated)\n`;
            }
        }

        function handleFind(args, output) {
            // Looking for SUID: find / -perm -4000 or find / -perm -u=s
            const isSuidSearch = args.some(a => a.includes('4000') || a.includes('u=s') || a.includes('+s'));

            if (isSuidSearch) {
                output.innerHTML += `<span style="color: #888;"># Finding SUID binaries...</span>\n`;
                Object.entries(fileSystem).forEach(([path, node]) => {
                    if (node.suid) {
                        const color = node.suspicious ? '#f472b6' : '#888';
                        const note = node.suspicious ? ' <span style="color: #ef4444;">&larr; SUSPICIOUS!</span>' : '';
                        output.innerHTML += `<span style="color: ${color}">${path}</span>${note}\n`;
                    }
                });
                markComplete('suid');
            } else if (args.length === 0) {
                output.innerHTML += 'find: missing path\nUsage: find / -perm -4000\n';
            } else {
                output.innerHTML += '(no matches)\n';
            }
        }

        function handleStat(args, output) {
            if (args.length === 0) {
                output.innerHTML += 'stat: missing operand\n';
                return;
            }

            const path = resolvePath(args[0]);
            const node = fileSystem[path];

            if (!node) {
                output.innerHTML += `stat: cannot stat '${args[0]}': No such file\n`;
                return;
            }

            const name = path.split('/').pop();
            output.innerHTML += `  File: ${name}\n`;
            output.innerHTML += `  Size: 4096\tBlocks: 8\n`;
            output.innerHTML += `Access: (${node.perm.substring(1)})  Uid: (${node.owner === 'root' ? '0' : '1000'}/${node.owner})   Gid: (${node.group === 'root' ? '0' : '1000'}/${node.group})\n`;

            if (node.suid) {
                output.innerHTML += `<span style="color: #f472b6;">‚ö† SUID bit is set - runs as owner (${node.owner})</span>\n`;
                if (node.suspicious) {
                    output.innerHTML += `<span style="color: #ef4444;">‚ö† Custom binary with SUID - potential backdoor!</span>\n`;
                }
                markComplete('stat');
            }
        }

        function markComplete(objective) {
            if (!completed[objective]) {
                completed[objective] = true;
                const el = document.getElementById(`obj-${objective}`);
                if (el) {
                    el.classList.add('complete');
                    el.querySelector('.objective-icon').textContent = '‚úì';
                }
            }
        }

        function checkAllComplete() {
            if (completed.ls && completed.chmod && completed.suid && completed.stat) {
                document.getElementById('successMessage').classList.add('show');
            }
        }

        document.getElementById('terminalInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') runCommand();
        });

        document.querySelector('.terminal-body').addEventListener('click', function() {
            document.getElementById('terminalInput').focus();
        });
    </script>
<script src="../../../components/FluxCapacitor.js"></script>
</body>
</html>
