<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Access Control -->
    <script src="../../../components/AccessGuard.js"></script>
    <script>AccessGuard.require('sorted');</script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLH-009: System Administration - Hexworth Prime</title>
    <style>
        :root { --house-primary: #a78bfa; --house-secondary: #8b5cf6; --terminal-green: #4ade80; --terminal-bg: #0d1117; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { min-height: 100vh; background: #0a0a0f; font-family: 'Segoe UI', sans-serif; color: #e0e0e0; }
        .module-header { padding: 20px 40px; border-bottom: 1px solid rgba(167, 139, 250, 0.2); background: rgba(10, 10, 15, 0.95); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        .back-btn { padding: 8px 16px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: #888; text-decoration: none; }
        .module-badge { display: flex; align-items: center; gap: 12px; padding: 10px 20px; background: rgba(74, 222, 128, 0.1); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 25px; }
        .module-badge-text { font-size: 0.75rem; letter-spacing: 0.15em; color: var(--terminal-green); text-transform: uppercase; }
        .content-wrapper { max-width: 900px; margin: 0 auto; padding: 40px 20px; }
        .module-title { font-size: 2.5rem; margin-bottom: 10px; background: linear-gradient(135deg, var(--terminal-green), var(--house-primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .module-subtitle { color: #888; font-size: 1.1rem; margin-bottom: 30px; }
        .section { background: rgba(15, 15, 20, 0.6); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 30px; margin-bottom: 30px; }
        .section h2 { color: var(--house-primary); font-size: 1.4rem; margin-bottom: 20px; }
        .section p { line-height: 1.8; margin-bottom: 15px; color: #ccc; }
        .terminal { background: var(--terminal-bg); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 8px; padding: 20px; font-family: 'Consolas', monospace; margin: 20px 0; position: relative; }
        .terminal::before { content: '$ sysadmin'; position: absolute; top: -10px; left: 15px; background: var(--terminal-bg); padding: 0 10px; font-size: 0.7rem; color: var(--terminal-green); }
        .terminal code { color: var(--terminal-green); display: block; line-height: 1.6; white-space: pre-wrap; font-size: 0.85rem; }
        .terminal .comment { color: #666; }
        .terminal .keyword { color: #c084fc; }
        .terminal .string { color: #fbbf24; }
        .terminal .variable { color: #60a5fa; }
        .terminal .output { color: #888; }
        .command-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .command-table th, .command-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .command-table th { background: rgba(167, 139, 250, 0.1); color: var(--house-primary); }
        .command-table code { background: rgba(74, 222, 128, 0.1); color: var(--terminal-green); padding: 2px 8px; border-radius: 4px; font-family: 'Consolas', monospace; }
        .key-points { display: grid; gap: 15px; margin: 20px 0; }
        .key-point { display: flex; align-items: flex-start; gap: 15px; padding: 15px; background: rgba(167, 139, 250, 0.05); border-left: 3px solid var(--house-primary); border-radius: 0 8px 8px 0; }
        .key-point-icon { font-size: 1.5rem; }
        .key-point-content h4 { color: var(--house-primary); margin-bottom: 5px; }
        .key-point-content p { margin: 0; font-size: 0.9rem; }
        .progress-section { text-align: center; padding: 40px; background: rgba(167, 139, 250, 0.05); border-radius: 12px; margin-top: 40px; }
        .module-nav { display: flex; gap: 15px; justify-content: center; }
        .nav-btn { padding: 12px 30px; border-radius: 8px; text-decoration: none; }
        .nav-btn.primary { background: linear-gradient(135deg, var(--house-primary), var(--house-secondary)); color: #fff; }
        .nav-btn.secondary { background: rgba(255, 255, 255, 0.05); color: #ccc; border: 1px solid rgba(255, 255, 255, 0.1); }
        .title-badge { display: inline-block; background: linear-gradient(135deg, rgba(74, 222, 128, 0.2), rgba(167, 139, 250, 0.2)); border: 1px solid rgba(74, 222, 128, 0.5); padding: 8px 20px; border-radius: 20px; font-size: 0.85rem; color: var(--terminal-green); margin-top: 15px; }
        /* Lab Styles */
        .lab-section { background: linear-gradient(135deg, rgba(74, 222, 128, 0.1), rgba(167, 139, 250, 0.1)); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 12px; padding: 25px; margin: 30px 0; }
        .lab-section h3 { color: var(--terminal-green); margin-bottom: 15px; }
        .interactive-terminal { background: var(--terminal-bg); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 8px; overflow: hidden; margin: 20px 0; }
        .terminal-header { background: rgba(255, 255, 255, 0.05); padding: 8px 15px; display: flex; align-items: center; gap: 8px; }
        .terminal-dot { width: 12px; height: 12px; border-radius: 50%; } .terminal-dot.red { background: #ef4444; } .terminal-dot.yellow { background: #fbbf24; } .terminal-dot.green { background: #22c55e; }
        .terminal-body { padding: 15px; }
        .terminal-output { color: #888; font-family: 'Consolas', monospace; font-size: 0.85rem; line-height: 1.6; min-height: 250px; max-height: 350px; overflow-y: auto; margin-bottom: 10px; white-space: pre-wrap; }
        .terminal-input-line { display: flex; align-items: center; gap: 10px; }
        .terminal-prompt { color: var(--terminal-green); font-family: 'Consolas', monospace; }
        .terminal-input { flex: 1; background: transparent; border: none; color: #fff; font-family: 'Consolas', monospace; font-size: 0.9rem; outline: none; }
        .run-btn { padding: 8px 20px; background: var(--terminal-green); color: #000; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; }
        .objectives { display: grid; gap: 8px; margin: 15px 0; }
        .objective { display: flex; align-items: center; gap: 10px; padding: 8px 12px; background: rgba(0, 0, 0, 0.2); border-radius: 6px; font-size: 0.9rem; }
        .objective.complete { background: rgba(34, 197, 94, 0.15); color: #4ade80; }
        .objective-icon { width: 20px; text-align: center; }
        .success-message { display: none; background: rgba(34, 197, 94, 0.2); border: 1px solid #22c55e; border-radius: 8px; padding: 15px; margin-top: 15px; }
        .success-message.show { display: block; }
    </style>
</head>
<body>
    <header class="module-header">
        <div style="display: flex; align-items: center; gap: 20px;">
            <a href="../index.html" class="back-btn">&larr; Script House</a>
            <div class="module-badge"><span style="font-size: 1.5rem;">üñ•Ô∏è</span><span class="module-badge-text">SysAdmin</span></div>
        </div>
        <span style="color: #666; font-size: 0.8rem;">CLH-009 of 015</span>
    </header>

    <main class="content-wrapper">
        <h1 class="module-title">System Administration</h1>
        <p class="module-subtitle">Manage users, services, and scheduled tasks. Control the machine.</p>

        <section class="section">
            <h2>üë• User & Group Management</h2>
            <p>Managing users is fundamental to security. Know how to create, modify, and investigate user accounts.</p>
            <table class="command-table">
                <tr><th>Command</th><th>Purpose</th></tr>
                <tr><td><code>useradd -m username</code></td><td>Create user with home directory</td></tr>
                <tr><td><code>passwd username</code></td><td>Set/change user password</td></tr>
                <tr><td><code>usermod -aG group user</code></td><td>Add user to group</td></tr>
                <tr><td><code>userdel -r username</code></td><td>Delete user and home directory</td></tr>
                <tr><td><code>groups username</code></td><td>Show user's groups</td></tr>
                <tr><td><code>id username</code></td><td>Show UID, GID, groups</td></tr>
            </table>
            <div class="terminal">
                <code><span class="comment"># Check who has sudo access</span>
<span class="keyword">cat</span> /etc/sudoers
<span class="keyword">getent</span> group sudo
<span class="keyword">getent</span> group wheel  <span class="comment"># On RHEL/CentOS</span>

<span class="comment"># Important files</span>
<span class="output">/etc/passwd  - User accounts (world-readable)</span>
<span class="output">/etc/shadow  - Password hashes (root only)</span>
<span class="output">/etc/group   - Group definitions</span></code>
            </div>
        </section>

        <section class="section">
            <h2>‚öôÔ∏è Service Management (systemd)</h2>
            <p>Modern Linux uses systemd to manage services. Critical for both administration and incident response.</p>
            <div class="terminal">
                <code><span class="comment"># Service control</span>
<span class="keyword">systemctl</span> start nginx      <span class="comment"># Start service</span>
<span class="keyword">systemctl</span> stop nginx       <span class="comment"># Stop service</span>
<span class="keyword">systemctl</span> restart nginx    <span class="comment"># Restart service</span>
<span class="keyword">systemctl</span> status nginx     <span class="comment"># Check status</span>
<span class="keyword">systemctl</span> enable nginx     <span class="comment"># Start on boot</span>
<span class="keyword">systemctl</span> disable nginx    <span class="comment"># Don't start on boot</span>

<span class="comment"># List all services</span>
<span class="keyword">systemctl</span> list-units --type=service

<span class="comment"># Find suspicious services (security recon)</span>
<span class="keyword">systemctl</span> list-units --type=service --state=running</code>
            </div>
        </section>

        <section class="section">
            <h2>‚è∞ Scheduled Tasks (Cron)</h2>
            <p>Cron runs scheduled tasks. Both legitimate admins and attackers use it for persistence.</p>
            <div class="key-points">
                <div class="key-point">
                    <span class="key-point-icon">üìÖ</span>
                    <div class="key-point-content">
                        <h4>Cron Syntax</h4>
                        <p><code>* * * * *</code> = minute hour day month weekday</p>
                    </div>
                </div>
                <div class="key-point">
                    <span class="key-point-icon">üîç</span>
                    <div class="key-point-content">
                        <h4>Security Audit</h4>
                        <p>Check <code>/etc/crontab</code>, <code>/var/spool/cron/</code>, and <code>/etc/cron.d/</code></p>
                    </div>
                </div>
            </div>
            <div class="terminal">
                <code><span class="comment"># Edit your crontab</span>
<span class="keyword">crontab</span> -e

<span class="comment"># View your crontab</span>
<span class="keyword">crontab</span> -l

<span class="comment"># Examples</span>
<span class="output">0 * * * *   /script.sh    # Every hour</span>
<span class="output">0 0 * * *   /backup.sh    # Daily at midnight</span>
<span class="output">*/5 * * * * /check.sh     # Every 5 minutes</span>

<span class="comment"># Audit ALL cron jobs (security recon)</span>
<span class="keyword">for</span> user <span class="keyword">in</span> $(cut -f1 -d: /etc/passwd); <span class="keyword">do</span>
    <span class="keyword">echo</span> <span class="string">"=== $user ==="</span>
    <span class="keyword">crontab</span> -u <span class="variable">$user</span> -l 2>/dev/null
<span class="keyword">done</span></code>
            </div>
        </section>

        <section class="section">
            <h2>üìä System Monitoring</h2>
            <div class="terminal">
                <code><span class="comment"># Disk usage</span>
<span class="keyword">df</span> -h                <span class="comment"># Filesystem usage</span>
<span class="keyword">du</span> -sh /var/log/*    <span class="comment"># Directory sizes</span>

<span class="comment"># Memory</span>
<span class="keyword">free</span> -h              <span class="comment"># Memory usage</span>

<span class="comment"># System info</span>
<span class="keyword">uptime</span>               <span class="comment"># Load average</span>
<span class="keyword">uname</span> -a             <span class="comment"># Kernel info</span>
<span class="keyword">hostnamectl</span>          <span class="comment"># OS info</span>

<span class="comment"># Who's logged in?</span>
<span class="keyword">w</span>                    <span class="comment"># Logged in users + activity</span>
<span class="keyword">last</span>                 <span class="comment"># Login history</span>
<span class="keyword">lastlog</span>              <span class="comment"># Last login per user</span></code>
            </div>
        </section>

        <!-- Interactive Lab -->
        <div class="lab-section">
            <h3>üéØ LAB: SysAdmin Console</h3>
            <p style="color: #ccc; margin-bottom: 15px;">
                You're the new sysadmin. Audit this server for security issues: check users, services, cron jobs, and system health.
            </p>

            <div class="objectives">
                <div class="objective" id="obj-users"><span class="objective-icon">‚òê</span><span>List users with sudo access</span></div>
                <div class="objective" id="obj-services"><span class="objective-icon">‚òê</span><span>Check running services</span></div>
                <div class="objective" id="obj-cron"><span class="objective-icon">‚òê</span><span>Review scheduled tasks</span></div>
                <div class="objective" id="obj-disk"><span class="objective-icon">‚òê</span><span>Check disk space</span></div>
            </div>

            <div class="interactive-terminal">
                <div class="terminal-header">
                    <span class="terminal-dot red"></span><span class="terminal-dot yellow"></span><span class="terminal-dot green"></span>
                    <span style="color: #888; margin-left: 10px; font-size: 0.8rem;">sysadmin-console</span>
                </div>
                <div class="terminal-body">
                    <div class="terminal-output" id="terminalOutput">SysAdmin Console - Security Audit
===================================
You have root access. Audit this server.

Commands: getent, groups, id, systemctl, crontab, df, free, w, uptime
Hint: Try 'getent group sudo' or 'systemctl list-units --type=service'
</div>
                    <div class="terminal-input-line">
                        <span class="terminal-prompt">root@server:~#</span>
                        <input type="text" class="terminal-input" id="terminalInput" placeholder="enter command..." autocomplete="off">
                        <button class="run-btn" onclick="runCommand()">Run</button>
                    </div>
                </div>
            </div>

            <div class="success-message" id="successMessage">
                <strong style="color: #22c55e;">üéâ SYSADMIN AUDIT COMPLETE!</strong>
                <p style="margin-top: 10px; color: #ccc;">You've successfully audited the server's security posture!</p>
            </div>
        </div>

        <div class="progress-section">
            <h3 style="color: var(--house-primary); margin-bottom: 20px;">Ready to Test Your Skills?</h3>
            <div class="module-nav">
                <a href="clh-009-quiz.html" class="nav-btn primary">Take the Quiz &rarr;</a>
                <a href="../index.html" class="nav-btn secondary">Back to Script House</a>
            </div>
            <div class="title-badge">üéñÔ∏è Completing CLH-007 to CLH-009 earns: CLI Specialist</div>
        </div>
    </main>
    <script src="../../../components/TrailHunter.js"></script>
    <script src="../../../components/ModuleProgress.js"></script>

    <script>
        let completed = { users: false, services: false, cron: false, disk: false };

        const responses = {
            'getent group sudo': 'sudo:x:27:admin,backup_user',
            'getent group wheel': 'wheel:x:10:admin',
            'groups admin': 'admin : admin sudo docker',
            'groups root': 'root : root',
            'id admin': 'uid=1000(admin) gid=1000(admin) groups=1000(admin),27(sudo),999(docker)',
            'w': `USER     TTY      FROM             LOGIN@   IDLE   WHAT
root     pts/0    192.168.1.50     09:15    0.00s  bash
admin    pts/1    192.168.1.100    08:30    1:23   vim config.php`,
            'uptime': ' 10:30:15 up 45 days, 3:22, 2 users, load average: 0.15, 0.20, 0.18',
            'free -h': `              total        used        free      shared  buff/cache   available
Mem:           7.8Gi       2.1Gi       3.2Gi       256Mi       2.5Gi       5.2Gi
Swap:          2.0Gi          0B       2.0Gi`,
            'df -h': `Filesystem      Size  Used Avail Use% Mounted on
/dev/sda1       100G   45G   50G  48% /
/dev/sda2       200G  180G   10G  95% /var  <-- WARNING: Low space!
tmpfs           3.9G  256M  3.7G   7% /tmp`,
            'crontab -l': `# Crontab for root
0 2 * * * /usr/local/bin/backup.sh
*/5 * * * * /tmp/.hidden/update.sh  <-- SUSPICIOUS!
0 * * * * /var/log/rotate.sh`,
            'systemctl list-units --type=service': `UNIT                    LOAD   ACTIVE SUB     DESCRIPTION
ssh.service             loaded active running OpenSSH server
nginx.service           loaded active running nginx web server
mysql.service           loaded active running MySQL Server
cron.service            loaded active running cron scheduler
backdoor.service        loaded active running unknown  <-- SUSPICIOUS!`,
            'systemctl status ssh': `‚óè ssh.service - OpenSSH server
     Loaded: loaded (/lib/systemd/system/ssh.service; enabled)
     Active: active (running) since Mon 2025-12-01 09:15:00 UTC
   Main PID: 1234 (sshd)`,
        };

        function runCommand() {
            const input = document.getElementById('terminalInput');
            const output = document.getElementById('terminalOutput');
            const cmd = input.value.trim().toLowerCase();

            if (!cmd) return;

            output.innerHTML += `\nroot@server:~# ${input.value}\n`;

            // Check for matches
            let found = false;
            for (const [key, val] of Object.entries(responses)) {
                if (cmd.includes(key.toLowerCase()) || key.toLowerCase().includes(cmd)) {
                    output.innerHTML += val + '\n';
                    found = true;

                    // Mark objectives
                    if (key.includes('sudo') || key.includes('wheel') || key.includes('groups')) markComplete('users');
                    if (key.includes('systemctl')) markComplete('services');
                    if (key.includes('crontab')) markComplete('cron');
                    if (key.includes('df')) markComplete('disk');
                    break;
                }
            }

            if (!found) {
                if (cmd === 'help') {
                    output.innerHTML += 'Commands: getent, groups, id, systemctl, crontab, df, free, w, uptime\n';
                } else if (cmd === 'clear') {
                    output.innerHTML = '';
                } else {
                    output.innerHTML += `${cmd}: command output simulated\n`;
                }
            }

            checkAllComplete();
            output.scrollTop = output.scrollHeight;
            input.value = '';
        }

        function markComplete(obj) {
            if (!completed[obj]) {
                completed[obj] = true;
                const el = document.getElementById(`obj-${obj}`);
                if (el) { el.classList.add('complete'); el.querySelector('.objective-icon').textContent = '‚úì'; }
            }
        }

        function checkAllComplete() {
            if (completed.users && completed.services && completed.cron && completed.disk) {
                document.getElementById('successMessage').classList.add('show');
            }
        }

        document.getElementById('terminalInput').addEventListener('keypress', e => { if (e.key === 'Enter') runCommand(); });
        document.querySelector('.terminal-body').addEventListener('click', () => document.getElementById('terminalInput').focus());
    </script>
<script src="../../../components/FluxCapacitor.js"></script>
</body>
</html>
