<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Administration & Automation Lab | Script House</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1025 50%, #0d0d15 100%);
            color: #e0e0e0;
            min-height: 100vh;
            line-height: 1.6;
        }

        .lab-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }

        .lab-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(167, 139, 250, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%);
            border-radius: 16px;
            border: 1px solid rgba(167, 139, 250, 0.3);
        }

        .lab-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .lab-title {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .lab-subtitle {
            color: #9ca3af;
            font-size: 1.1rem;
        }

        .lab-meta {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #a78bfa;
            font-size: 0.9rem;
        }

        .objectives-section {
            background: rgba(167, 139, 250, 0.08);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-left: 4px solid #a78bfa;
        }

        .objectives-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #a78bfa;
            margin-bottom: 1rem;
        }

        .objectives-list {
            list-style: none;
        }

        .objectives-list li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .objectives-list li::before {
            content: "üéØ";
            position: absolute;
            left: 0;
        }

        .exercise {
            background: rgba(30, 30, 40, 0.6);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(167, 139, 250, 0.2);
            transition: all 0.3s ease;
        }

        .exercise:hover {
            border-color: rgba(167, 139, 250, 0.4);
            box-shadow: 0 4px 20px rgba(167, 139, 250, 0.1);
        }

        .exercise-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .exercise-number {
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .exercise-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #fff;
        }

        .exercise-difficulty {
            margin-left: auto;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .difficulty-beginner { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .difficulty-intermediate { background: rgba(234, 179, 8, 0.2); color: #eab308; }
        .difficulty-advanced { background: rgba(239, 68, 68, 0.2); color: #ef4444; }

        .exercise-content h4 {
            color: #a78bfa;
            margin: 1.5rem 0 0.75rem 0;
            font-size: 1rem;
        }

        .exercise-content p {
            color: #d1d5db;
            margin-bottom: 1rem;
        }

        .code-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0;
        }

        .code-tab {
            padding: 0.5rem 1rem;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            border-bottom: none;
        }

        .code-tab.bash { background: rgba(34, 197, 94, 0.1); color: #22c55e; }
        .code-tab.powershell { background: rgba(56, 189, 248, 0.1); color: #38bdf8; }
        .code-tab.python { background: rgba(234, 179, 8, 0.1); color: #eab308; }

        .code-tab.active { border: 1px solid; border-bottom: none; }
        .code-tab.active.bash { background: rgba(34, 197, 94, 0.2); border-color: rgba(34, 197, 94, 0.3); }
        .code-tab.active.powershell { background: rgba(56, 189, 248, 0.2); border-color: rgba(56, 189, 248, 0.3); }
        .code-tab.active.python { background: rgba(234, 179, 8, 0.2); border-color: rgba(234, 179, 8, 0.3); }

        .code-block {
            background: #0d1117;
            border-radius: 0 8px 8px 8px;
            padding: 1rem;
            margin: 0 0 1rem 0;
            overflow-x: auto;
            border: 1px solid rgba(167, 139, 250, 0.2);
            display: none;
        }

        .code-block.active {
            display: block;
        }

        .code-block code {
            font-family: 'Fira Code', 'Consolas', monospace;
            color: #e6edf3;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .code-block .comment { color: #6a9955; }
        .code-block .string { color: #ce9178; }
        .code-block .keyword { color: #569cd6; }
        .code-block .variable { color: #9cdcfe; }
        .code-block .function { color: #dcdcaa; }

        .task-list {
            list-style: none;
            margin: 1rem 0;
        }

        .task-list li {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.5rem 0;
        }

        .task-list input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-top: 3px;
            accent-color: #a78bfa;
            cursor: pointer;
        }

        .hint-box {
            background: rgba(234, 179, 8, 0.1);
            border: 1px solid rgba(234, 179, 8, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .hint-box summary {
            cursor: pointer;
            color: #eab308;
            font-weight: 500;
        }

        .hint-box p {
            margin-top: 0.75rem;
            color: #fef3c7;
        }

        .applet-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, rgba(167, 139, 250, 0.2) 0%, rgba(139, 92, 246, 0.1) 100%);
            color: #a78bfa;
            padding: 0.75rem 1.25rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            margin: 0.5rem 0.5rem 0.5rem 0;
            border: 1px solid rgba(167, 139, 250, 0.3);
            transition: all 0.3s ease;
        }

        .applet-link:hover {
            background: linear-gradient(135deg, rgba(167, 139, 250, 0.3) 0%, rgba(139, 92, 246, 0.2) 100%);
            transform: translateY(-2px);
        }

        .reflection-section {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(167, 139, 250, 0.05) 100%);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px dashed rgba(167, 139, 250, 0.3);
        }

        .reflection-section h4 {
            color: #a78bfa;
            margin-bottom: 1rem;
        }

        .reflection-section textarea {
            width: 100%;
            min-height: 100px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(167, 139, 250, 0.3);
            border-radius: 8px;
            padding: 1rem;
            color: #e0e0e0;
            font-family: inherit;
            resize: vertical;
        }

        .reflection-section textarea:focus {
            outline: none;
            border-color: #a78bfa;
        }

        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(167, 139, 250, 0.2);
            z-index: 1000;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #a78bfa 0%, #8b5cf6 100%);
            transition: width 0.3s ease;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(167, 139, 250, 0.2);
        }

        .nav-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-btn-back {
            background: rgba(107, 114, 128, 0.2);
            color: #9ca3af;
            border: 1px solid rgba(107, 114, 128, 0.3);
        }

        .nav-btn-back:hover {
            background: rgba(107, 114, 128, 0.3);
        }

        .nav-btn-next {
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
            color: white;
            border: none;
        }

        .nav-btn-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(167, 139, 250, 0.4);
        }

        .concept-callout {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .concept-callout h5 {
            color: #a78bfa;
            margin-bottom: 0.5rem;
        }

        .scenario-box {
            background: rgba(56, 189, 248, 0.1);
            border: 1px solid rgba(56, 189, 248, 0.3);
            border-radius: 8px;
            padding: 1.25rem;
            margin: 1rem 0;
        }

        .scenario-box h5 {
            color: #38bdf8;
            margin-bottom: 0.75rem;
            font-size: 1rem;
        }

        @media (max-width: 768px) {
            .lab-container { padding: 1rem; }
            .lab-title { font-size: 1.8rem; }
            .exercise { padding: 1.5rem; }
            .meta-item { font-size: 0.8rem; }
            .code-tabs { flex-wrap: wrap; }
        }
    </style>
</head>
<body>
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>

    <div class="lab-container">
        <header class="lab-header">
            <div class="lab-icon">‚öôÔ∏è</div>
            <h1 class="lab-title">System Administration & Automation Lab</h1>
            <p class="lab-subtitle">Automate repetitive tasks and manage systems efficiently</p>
            <div class="lab-meta">
                <span class="meta-item">üìö 6 Exercises</span>
                <span class="meta-item">‚è±Ô∏è 120 minutes</span>
                <span class="meta-item">üéØ Intermediate to Advanced</span>
            </div>
        </header>

        <section class="objectives-section">
            <h2 class="objectives-title">Learning Objectives</h2>
            <ul class="objectives-list">
                <li>Identify tasks suitable for automation</li>
                <li>Create scripts for log analysis and monitoring</li>
                <li>Implement scheduled/cron tasks</li>
                <li>Build backup and maintenance automation</li>
                <li>Develop user and system management scripts</li>
                <li>Apply cross-platform automation strategies</li>
            </ul>
        </section>

        <!-- Exercise 1: Automation Fundamentals -->
        <article class="exercise" data-exercise="1">
            <div class="exercise-header">
                <div class="exercise-number">1</div>
                <h3 class="exercise-title">Automation Fundamentals</h3>
                <span class="exercise-difficulty difficulty-beginner">Beginner</span>
            </div>
            <div class="exercise-content">
                <p>Before automating, learn to identify good candidates for automation and structure your scripts properly.</p>

                <div class="concept-callout">
                    <h5>ü§î When to Automate?</h5>
                    <p><strong>Good candidates:</strong> Repetitive tasks, error-prone manual processes, scheduled maintenance, data collection/reporting.</p>
                    <p><strong>Bad candidates:</strong> One-time tasks, tasks requiring human judgment, tasks that change frequently.</p>
                    <p><strong>Rule of thumb:</strong> If you do it more than twice, automate it!</p>
                </div>

                <h4>üìñ Script Structure Best Practices</h4>
                <div class="code-tabs">
                    <span class="code-tab bash active" onclick="showTab(this, 'bash1')">üêß Bash</span>
                    <span class="code-tab powershell" onclick="showTab(this, 'ps1')">üí† PowerShell</span>
                    <span class="code-tab python" onclick="showTab(this, 'py1')">üêç Python</span>
                </div>
                <div class="code-block active" id="bash1">
                    <code><span class="comment">#!/bin/bash</span>
<span class="comment"># Script: system_health.sh</span>
<span class="comment"># Purpose: Daily system health check</span>
<span class="comment"># Author: SysAdmin</span>
<span class="comment"># Version: 1.0</span>

<span class="keyword">set</span> -e  <span class="comment"># Exit on error</span>
<span class="keyword">set</span> -u  <span class="comment"># Error on undefined vars</span>

<span class="comment"># Configuration</span>
<span class="variable">LOG_DIR</span>=<span class="string">"/var/log/health"</span>
<span class="variable">DATE</span>=$(<span class="function">date</span> +%Y-%m-%d)
<span class="variable">LOG_FILE</span>=<span class="string">"${LOG_DIR}/health_${DATE}.log"</span>

<span class="comment"># Functions</span>
<span class="function">log_message</span>() {
    <span class="keyword">echo</span> <span class="string">"[$(date '+%H:%M:%S')] $1"</span> | tee -a <span class="string">"$LOG_FILE"</span>
}

<span class="function">check_disk</span>() {
    log_message <span class="string">"Checking disk usage..."</span>
    <span class="function">df</span> -h | tee -a <span class="string">"$LOG_FILE"</span>
}

<span class="comment"># Main execution</span>
<span class="function">main</span>() {
    log_message <span class="string">"=== Health Check Started ==="</span>
    check_disk
    log_message <span class="string">"=== Health Check Complete ==="</span>
}

main</code>
                </div>
                <div class="code-block" id="ps1">
                    <code><span class="comment"># Script: System-Health.ps1</span>
<span class="comment"># Purpose: Daily system health check</span>
<span class="comment"># Author: SysAdmin</span>

<span class="comment"># Configuration</span>
<span class="variable">$LogDir</span> = <span class="string">"C:\Logs\Health"</span>
<span class="variable">$Date</span> = Get-Date -Format <span class="string">"yyyy-MM-dd"</span>
<span class="variable">$LogFile</span> = <span class="string">"$LogDir\health_$Date.log"</span>

<span class="comment"># Ensure log directory exists</span>
<span class="keyword">if</span> (-not (Test-Path <span class="variable">$LogDir</span>)) {
    New-Item -ItemType Directory -Path <span class="variable">$LogDir</span> -Force
}

<span class="comment"># Functions</span>
<span class="keyword">function</span> <span class="function">Write-Log</span> {
    <span class="keyword">param</span>([<span class="keyword">string</span>]<span class="variable">$Message</span>)
    <span class="variable">$Timestamp</span> = Get-Date -Format <span class="string">"HH:mm:ss"</span>
    <span class="string">"[$Timestamp] $Message"</span> | Tee-Object -FilePath <span class="variable">$LogFile</span> -Append
}

<span class="keyword">function</span> <span class="function">Get-DiskHealth</span> {
    Write-Log <span class="string">"Checking disk usage..."</span>
    Get-WmiObject Win32_LogicalDisk -Filter <span class="string">"DriveType=3"</span> |
        Select-Object DeviceID,
            @{N=<span class="string">'Size(GB)'</span>;E={[math]::Round(<span class="variable">$_</span>.Size/1GB,2)}},
            @{N=<span class="string">'Free(GB)'</span>;E={[math]::Round(<span class="variable">$_</span>.FreeSpace/1GB,2)}} |
        Tee-Object -FilePath <span class="variable">$LogFile</span> -Append
}

<span class="comment"># Main</span>
Write-Log <span class="string">"=== Health Check Started ==="</span>
Get-DiskHealth
Write-Log <span class="string">"=== Health Check Complete ==="</span></code>
                </div>
                <div class="code-block" id="py1">
                    <code><span class="comment">#!/usr/bin/env python3</span>
<span class="string">"""
Script: system_health.py
Purpose: Daily system health check
Author: SysAdmin
"""</span>

<span class="keyword">import</span> os
<span class="keyword">import</span> shutil
<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime
<span class="keyword">from</span> pathlib <span class="keyword">import</span> Path

<span class="comment"># Configuration</span>
LOG_DIR = Path(<span class="string">"/var/log/health"</span>)
DATE = datetime.now().strftime(<span class="string">"%Y-%m-%d"</span>)
LOG_FILE = LOG_DIR / <span class="string">f"health_{DATE}.log"</span>

<span class="keyword">def</span> <span class="function">log_message</span>(message: str) -> None:
    <span class="string">"""Log a message with timestamp."""</span>
    timestamp = datetime.now().strftime(<span class="string">"%H:%M:%S"</span>)
    log_line = <span class="string">f"[{timestamp}] {message}"</span>
    <span class="function">print</span>(log_line)
    <span class="keyword">with</span> <span class="function">open</span>(LOG_FILE, <span class="string">'a'</span>) <span class="keyword">as</span> f:
        f.write(log_line + <span class="string">"\n"</span>)

<span class="keyword">def</span> <span class="function">check_disk</span>() -> None:
    <span class="string">"""Check disk usage."""</span>
    log_message(<span class="string">"Checking disk usage..."</span>)
    total, used, free = shutil.disk_usage(<span class="string">"/"</span>)
    log_message(<span class="string">f"Total: {total // (2**30)} GB"</span>)
    log_message(<span class="string">f"Used: {used // (2**30)} GB"</span>)
    log_message(<span class="string">f"Free: {free // (2**30)} GB"</span>)

<span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:
    LOG_DIR.mkdir(parents=<span class="keyword">True</span>, exist_ok=<span class="keyword">True</span>)
    log_message(<span class="string">"=== Health Check Started ==="</span>)
    check_disk()
    log_message(<span class="string">"=== Health Check Complete ==="</span>)</code>
                </div>

                <h4>üîß Tasks</h4>
                <ul class="task-list">
                    <li><input type="checkbox" id="t1-1"> Identify 5 tasks in your environment that could be automated</li>
                    <li><input type="checkbox" id="t1-2"> Create a script template with proper header, configuration section, and functions</li>
                    <li><input type="checkbox" id="t1-3"> Implement logging that records timestamps and outputs to file</li>
                    <li><input type="checkbox" id="t1-4"> Add error handling to your script template</li>
                    <li><input type="checkbox" id="t1-5"> Document your script with comments explaining each section</li>
                </ul>

                <h4>üîó Related Visualizers</h4>
                <a href="../applets/automation-intro.html" class="applet-link">‚öôÔ∏è Automation Introduction</a>
            </div>
        </article>

        <!-- Exercise 2: Log Analysis -->
        <article class="exercise" data-exercise="2">
            <div class="exercise-header">
                <div class="exercise-number">2</div>
                <h3 class="exercise-title">Log Analysis & Monitoring</h3>
                <span class="exercise-difficulty difficulty-intermediate">Intermediate</span>
            </div>
            <div class="exercise-content">
                <p>Automate log analysis to detect issues before they become problems.</p>

                <div class="scenario-box">
                    <h5>üìã Scenario</h5>
                    <p>Your web server generates thousands of log entries daily. You need to automatically detect failed login attempts, 500 errors, and unusual traffic patterns.</p>
                </div>

                <h4>üìñ Log Parsing Examples</h4>
                <div class="code-tabs">
                    <span class="code-tab bash active" onclick="showTab(this, 'bash2')">üêß Bash</span>
                    <span class="code-tab powershell" onclick="showTab(this, 'ps2')">üí† PowerShell</span>
                    <span class="code-tab python" onclick="showTab(this, 'py2')">üêç Python</span>
                </div>
                <div class="code-block active" id="bash2">
                    <code><span class="comment">#!/bin/bash</span>
<span class="comment"># Analyze auth.log for failed SSH attempts</span>

<span class="variable">LOG_FILE</span>=<span class="string">"/var/log/auth.log"</span>
<span class="variable">THRESHOLD</span>=<span class="number">5</span>

<span class="keyword">echo</span> <span class="string">"=== Failed SSH Attempts ==="</span>

<span class="comment"># Count failed attempts per IP</span>
grep <span class="string">"Failed password"</span> <span class="string">"$LOG_FILE"</span> | \
    awk <span class="string">'{print $(NF-3)}'</span> | \
    sort | uniq -c | sort -rn | \
    <span class="keyword">while</span> read count ip; <span class="keyword">do</span>
        <span class="keyword">if</span> [ <span class="string">"$count"</span> -ge <span class="string">"$THRESHOLD"</span> ]; <span class="keyword">then</span>
            <span class="keyword">echo</span> <span class="string">"‚ö†Ô∏è  ALERT: $ip has $count failed attempts"</span>
        <span class="keyword">fi</span>
    <span class="keyword">done</span>

<span class="comment"># Find 500 errors in web logs</span>
<span class="keyword">echo</span> <span class="string">""</span>
<span class="keyword">echo</span> <span class="string">"=== HTTP 500 Errors (Last Hour) ==="</span>
<span class="variable">ONE_HOUR_AGO</span>=$(<span class="function">date</span> -d <span class="string">'1 hour ago'</span> +<span class="string">'%d/%b/%Y:%H'</span>)
grep <span class="string">" 500 "</span> /var/log/nginx/access.log | \
    grep <span class="string">"$ONE_HOUR_AGO"</span> | \
    awk <span class="string">'{print $7}'</span> | sort | uniq -c | sort -rn</code>
                </div>
                <div class="code-block" id="ps2">
                    <code><span class="comment"># Analyze Windows Security Log for failed logins</span>

<span class="variable">$Hours</span> = <span class="number">24</span>
<span class="variable">$Threshold</span> = <span class="number">5</span>
<span class="variable">$StartTime</span> = (Get-Date).AddHours(-<span class="variable">$Hours</span>)

Write-Host <span class="string">"=== Failed Login Attempts (Last $Hours Hours) ==="</span>

<span class="comment"># Event ID 4625 = Failed login</span>
<span class="variable">$FailedLogins</span> = Get-WinEvent -FilterHashtable @{
    LogName = <span class="string">'Security'</span>
    Id = <span class="number">4625</span>
    StartTime = <span class="variable">$StartTime</span>
} -ErrorAction SilentlyContinue

<span class="variable">$FailedLogins</span> | Group-Object {
    <span class="variable">$_</span>.Properties[<span class="number">19</span>].Value  <span class="comment"># Source IP</span>
} | Where-Object Count -ge <span class="variable">$Threshold</span> | ForEach-Object {
    Write-Host <span class="string">"‚ö†Ô∏è  ALERT: $($_.Name) has $($_.Count) failed attempts"</span>
}

<span class="comment"># Check for locked accounts</span>
Write-Host <span class="string">""</span>
Write-Host <span class="string">"=== Locked Accounts ==="</span>
Search-ADAccount -LockedOut | Select-Object Name, LockedOut</code>
                </div>
                <div class="code-block" id="py2">
                    <code><span class="comment">#!/usr/bin/env python3</span>
<span class="string">"""Analyze logs for security events."""</span>

<span class="keyword">import</span> re
<span class="keyword">from</span> collections <span class="keyword">import</span> Counter
<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta
<span class="keyword">from</span> pathlib <span class="keyword">import</span> Path

<span class="keyword">def</span> <span class="function">analyze_auth_log</span>(log_path: str, threshold: int = <span class="number">5</span>):
    <span class="string">"""Find IPs with multiple failed SSH attempts."""</span>
    pattern = re.compile(r<span class="string">'Failed password.*from (\d+\.\d+\.\d+\.\d+)'</span>)
    ip_counts = Counter()

    <span class="keyword">with</span> <span class="function">open</span>(log_path) <span class="keyword">as</span> f:
        <span class="keyword">for</span> line <span class="keyword">in</span> f:
            match = pattern.search(line)
            <span class="keyword">if</span> match:
                ip_counts[match.group(<span class="number">1</span>)] += <span class="number">1</span>

    <span class="function">print</span>(<span class="string">"=== Failed SSH Attempts ==="</span>)
    <span class="keyword">for</span> ip, count <span class="keyword">in</span> ip_counts.most_common():
        <span class="keyword">if</span> count >= threshold:
            <span class="function">print</span>(<span class="string">f"‚ö†Ô∏è  ALERT: {ip} has {count} failed attempts"</span>)

<span class="keyword">def</span> <span class="function">analyze_web_log</span>(log_path: str):
    <span class="string">"""Find 500 errors in access logs."""</span>
    pattern = re.compile(r<span class="string">'"[A-Z]+ (\S+).*" 500'</span>)
    error_paths = Counter()

    <span class="keyword">with</span> <span class="function">open</span>(log_path) <span class="keyword">as</span> f:
        <span class="keyword">for</span> line <span class="keyword">in</span> f:
            match = pattern.search(line)
            <span class="keyword">if</span> match:
                error_paths[match.group(<span class="number">1</span>)] += <span class="number">1</span>

    <span class="function">print</span>(<span class="string">"\n=== HTTP 500 Errors ==="</span>)
    <span class="keyword">for</span> path, count <span class="keyword">in</span> error_paths.most_common(<span class="number">10</span>):
        <span class="function">print</span>(<span class="string">f"{count:4d} errors: {path}"</span>)

<span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:
    analyze_auth_log(<span class="string">"/var/log/auth.log"</span>)
    analyze_web_log(<span class="string">"/var/log/nginx/access.log"</span>)</code>
                </div>

                <h4>üîß Tasks</h4>
                <ul class="task-list">
                    <li><input type="checkbox" id="t2-1"> Create a script that counts failed login attempts by IP</li>
                    <li><input type="checkbox" id="t2-2"> Add email alerting when threshold is exceeded</li>
                    <li><input type="checkbox" id="t2-3"> Parse web server logs to find top 10 requested URLs</li>
                    <li><input type="checkbox" id="t2-4"> Identify unique visitors by IP in the last hour</li>
                    <li><input type="checkbox" id="t2-5"> Generate a daily summary report of key metrics</li>
                </ul>

                <details class="hint-box">
                    <summary>üí° Regular Expression Tips</summary>
                    <p>Use regex101.com to test patterns. Common patterns: IP address: <code>\d+\.\d+\.\d+\.\d+</code>, HTTP status: <code>" (\d{3}) "</code></p>
                </details>

                <h4>üîó Related Visualizers</h4>
                <a href="../applets/log-analysis.html" class="applet-link">üìä Log Analysis</a>
            </div>
        </article>

        <!-- Exercise 3: Scheduled Tasks -->
        <article class="exercise" data-exercise="3">
            <div class="exercise-header">
                <div class="exercise-number">3</div>
                <h3 class="exercise-title">Scheduled Tasks & Cron Jobs</h3>
                <span class="exercise-difficulty difficulty-intermediate">Intermediate</span>
            </div>
            <div class="exercise-content">
                <p>Run scripts automatically at specified times using schedulers.</p>

                <h4>üìñ Cron Syntax (Linux)</h4>
                <div class="code-block active">
                    <code><span class="comment"># Cron format: minute hour day month weekday command</span>
<span class="comment"># ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ minute (0 - 59)</span>
<span class="comment"># ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ hour (0 - 23)</span>
<span class="comment"># ‚îÇ ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ day of month (1 - 31)</span>
<span class="comment"># ‚îÇ ‚îÇ ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ month (1 - 12)</span>
<span class="comment"># ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ day of week (0 - 6) (Sunday=0)</span>
<span class="comment"># ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ</span>
<span class="comment"># * * * * * command</span>

<span class="comment"># Examples:</span>
<span class="number">0</span> <span class="number">2</span> * * * /scripts/backup.sh        <span class="comment"># Daily at 2:00 AM</span>
*/15 * * * * /scripts/check.sh       <span class="comment"># Every 15 minutes</span>
<span class="number">0</span> <span class="number">9</span> * * 1-5 /scripts/report.sh     <span class="comment"># Weekdays at 9 AM</span>
<span class="number">0</span> <span class="number">0</span> <span class="number">1</span> * * /scripts/monthly.sh      <span class="comment"># First day of month</span>

<span class="comment"># Edit crontab:</span>
crontab -e     <span class="comment"># Edit current user's crontab</span>
crontab -l     <span class="comment"># List current crontab</span></code>
                </div>

                <h4>üìñ Task Scheduler (Windows PowerShell)</h4>
                <div class="code-block active">
                    <code><span class="comment"># Create a scheduled task</span>
<span class="variable">$Action</span> = New-ScheduledTaskAction `
    -Execute <span class="string">"PowerShell.exe"</span> `
    -Argument <span class="string">"-File C:\Scripts\backup.ps1"</span>

<span class="variable">$Trigger</span> = New-ScheduledTaskTrigger `
    -Daily -At <span class="string">"2:00AM"</span>

<span class="variable">$Settings</span> = New-ScheduledTaskSettingsSet `
    -ExecutionTimeLimit (New-TimeSpan -Hours <span class="number">1</span>) `
    -RestartCount <span class="number">3</span>

Register-ScheduledTask `
    -TaskName <span class="string">"DailyBackup"</span> `
    -Action <span class="variable">$Action</span> `
    -Trigger <span class="variable">$Trigger</span> `
    -Settings <span class="variable">$Settings</span> `
    -Description <span class="string">"Daily backup at 2 AM"</span>

<span class="comment"># View scheduled tasks</span>
Get-ScheduledTask | Where-Object State -eq <span class="string">'Ready'</span></code>
                </div>

                <h4>üîß Tasks</h4>
                <ul class="task-list">
                    <li><input type="checkbox" id="t3-1"> Schedule your health check script to run daily</li>
                    <li><input type="checkbox" id="t3-2"> Create a weekly cleanup job for temporary files</li>
                    <li><input type="checkbox" id="t3-3"> Set up an hourly monitoring script with output logging</li>
                    <li><input type="checkbox" id="t3-4"> Configure email notifications for task failures</li>
                    <li><input type="checkbox" id="t3-5"> Document all scheduled tasks in a tracking sheet</li>
                </ul>

                <div class="reflection-section">
                    <h4>üìù Reflection</h4>
                    <p>What time should maintenance tasks run? Consider user activity, system load, and dependencies.</p>
                    <textarea placeholder="Write your scheduling strategy here..."></textarea>
                </div>
            </div>
        </article>

        <!-- Exercise 4: Backup Automation -->
        <article class="exercise" data-exercise="4">
            <div class="exercise-header">
                <div class="exercise-number">4</div>
                <h3 class="exercise-title">Backup & Recovery Automation</h3>
                <span class="exercise-difficulty difficulty-intermediate">Intermediate</span>
            </div>
            <div class="exercise-content">
                <p>Implement automated backup solutions with verification and rotation.</p>

                <h4>üìñ Backup Script Example</h4>
                <div class="code-tabs">
                    <span class="code-tab bash active" onclick="showTab(this, 'bash4')">üêß Bash</span>
                    <span class="code-tab powershell" onclick="showTab(this, 'ps4')">üí† PowerShell</span>
                </div>
                <div class="code-block active" id="bash4">
                    <code><span class="comment">#!/bin/bash</span>
<span class="comment"># Incremental backup with rotation</span>

<span class="variable">SOURCE</span>=<span class="string">"/home"</span>
<span class="variable">DEST</span>=<span class="string">"/backup"</span>
<span class="variable">DATE</span>=$(<span class="function">date</span> +%Y-%m-%d)
<span class="variable">RETENTION</span>=<span class="number">7</span>  <span class="comment"># Keep 7 days</span>

<span class="comment"># Create backup with rsync</span>
rsync -avz --delete \
    --link-dest=<span class="string">"${DEST}/latest"</span> \
    <span class="string">"${SOURCE}"</span> \
    <span class="string">"${DEST}/${DATE}"</span>

<span class="comment"># Update 'latest' symlink</span>
rm -f <span class="string">"${DEST}/latest"</span>
ln -s <span class="string">"${DEST}/${DATE}"</span> <span class="string">"${DEST}/latest"</span>

<span class="comment"># Remove old backups</span>
find <span class="string">"${DEST}"</span> -maxdepth <span class="number">1</span> -type d -mtime +<span class="variable">${RETENTION}</span> -exec rm -rf {} \;

<span class="comment"># Verify backup</span>
<span class="keyword">if</span> [ -d <span class="string">"${DEST}/${DATE}"</span> ]; <span class="keyword">then</span>
    <span class="keyword">echo</span> <span class="string">"‚úÖ Backup completed: ${DEST}/${DATE}"</span>
    <span class="function">du</span> -sh <span class="string">"${DEST}/${DATE}"</span>
<span class="keyword">else</span>
    <span class="keyword">echo</span> <span class="string">"‚ùå Backup FAILED!"</span>
    exit <span class="number">1</span>
<span class="keyword">fi</span></code>
                </div>
                <div class="code-block" id="ps4">
                    <code><span class="comment"># Windows backup with robocopy</span>

<span class="variable">$Source</span> = <span class="string">"C:\Users"</span>
<span class="variable">$Dest</span> = <span class="string">"D:\Backup"</span>
<span class="variable">$Date</span> = Get-Date -Format <span class="string">"yyyy-MM-dd"</span>
<span class="variable">$Retention</span> = <span class="number">7</span>

<span class="variable">$BackupPath</span> = <span class="string">"$Dest\$Date"</span>

<span class="comment"># Create backup with robocopy</span>
robocopy <span class="variable">$Source</span> <span class="variable">$BackupPath</span> /MIR /XA:SH /R:<span class="number">3</span> /W:<span class="number">5</span> /LOG:<span class="string">"$Dest\backup_$Date.log"</span>

<span class="comment"># Check robocopy exit code</span>
<span class="keyword">if</span> (<span class="variable">$LASTEXITCODE</span> -le <span class="number">3</span>) {
    Write-Host <span class="string">"‚úÖ Backup completed: $BackupPath"</span> -ForegroundColor Green
    (Get-ChildItem <span class="variable">$BackupPath</span> -Recurse | Measure-Object -Property Length -Sum).Sum / <span class="number">1GB</span>
} <span class="keyword">else</span> {
    Write-Host <span class="string">"‚ùå Backup FAILED! Exit code: $LASTEXITCODE"</span> -ForegroundColor Red
    <span class="keyword">exit</span> <span class="number">1</span>
}

<span class="comment"># Remove old backups</span>
Get-ChildItem <span class="variable">$Dest</span> -Directory |
    Where-Object { <span class="variable">$_</span>.CreationTime -lt (Get-Date).AddDays(-<span class="variable">$Retention</span>) } |
    Remove-Item -Recurse -Force</code>
                </div>

                <h4>üîß Tasks</h4>
                <ul class="task-list">
                    <li><input type="checkbox" id="t4-1"> Create a backup script with configurable source/destination</li>
                    <li><input type="checkbox" id="t4-2"> Implement backup rotation (keep last N backups)</li>
                    <li><input type="checkbox" id="t4-3"> Add backup verification (check file count, size)</li>
                    <li><input type="checkbox" id="t4-4"> Create a restore script that can recover from any backup</li>
                    <li><input type="checkbox" id="t4-5"> Add notification on backup success/failure</li>
                </ul>

                <h4>üîó Related Visualizers</h4>
                <a href="../applets/backup-strategies.html" class="applet-link">üíæ Backup Strategies</a>
            </div>
        </article>

        <!-- Exercise 5: User Management -->
        <article class="exercise" data-exercise="5">
            <div class="exercise-header">
                <div class="exercise-number">5</div>
                <h3 class="exercise-title">User & Permission Management</h3>
                <span class="exercise-difficulty difficulty-advanced">Advanced</span>
            </div>
            <div class="exercise-content">
                <p>Automate user account lifecycle: creation, modification, and deprovisioning.</p>

                <h4>üìñ Bulk User Management</h4>
                <div class="code-tabs">
                    <span class="code-tab bash active" onclick="showTab(this, 'bash5')">üêß Bash</span>
                    <span class="code-tab powershell" onclick="showTab(this, 'ps5')">üí† PowerShell</span>
                </div>
                <div class="code-block active" id="bash5">
                    <code><span class="comment">#!/bin/bash</span>
<span class="comment"># Create users from CSV: username,fullname,department</span>

<span class="variable">CSV_FILE</span>=<span class="string">"new_users.csv"</span>
<span class="variable">DEFAULT_PASS</span>=<span class="string">"ChangeMeNow123!"</span>

<span class="keyword">while</span> IFS=<span class="string">','</span> read -r username fullname department; <span class="keyword">do</span>
    <span class="comment"># Skip header</span>
    [ <span class="string">"$username"</span> = <span class="string">"username"</span> ] && <span class="keyword">continue</span>

    <span class="comment"># Create user</span>
    <span class="keyword">if</span> ! id <span class="string">"$username"</span> &>/dev/null; <span class="keyword">then</span>
        useradd -m -c <span class="string">"$fullname"</span> -G <span class="string">"$department"</span> <span class="string">"$username"</span>
        <span class="keyword">echo</span> <span class="string">"$username:$DEFAULT_PASS"</span> | chpasswd
        chage -d <span class="number">0</span> <span class="string">"$username"</span>  <span class="comment"># Force password change</span>
        <span class="keyword">echo</span> <span class="string">"‚úÖ Created: $username"</span>
    <span class="keyword">else</span>
        <span class="keyword">echo</span> <span class="string">"‚ö†Ô∏è  Exists: $username"</span>
    <span class="keyword">fi</span>
<span class="keyword">done</span> < <span class="string">"$CSV_FILE"</span>

<span class="comment"># Disable inactive users (no login in 90 days)</span>
lastlog -b <span class="number">90</span> | awk <span class="string">'NR>1 {print $1}'</span> | <span class="keyword">while</span> read user; <span class="keyword">do</span>
    usermod -L <span class="string">"$user"</span>
    <span class="keyword">echo</span> <span class="string">"üîí Locked: $user (inactive)"</span>
<span class="keyword">done</span></code>
                </div>
                <div class="code-block" id="ps5">
                    <code><span class="comment"># Create AD users from CSV</span>

<span class="variable">$CsvFile</span> = <span class="string">"new_users.csv"</span>
<span class="variable">$DefaultPass</span> = ConvertTo-SecureString <span class="string">"ChangeMeNow123!"</span> -AsPlainText -Force
<span class="variable">$Domain</span> = <span class="string">"contoso.com"</span>

Import-Csv <span class="variable">$CsvFile</span> | ForEach-Object {
    <span class="variable">$Username</span> = <span class="variable">$_</span>.username
    <span class="variable">$Name</span> = <span class="variable">$_</span>.fullname
    <span class="variable">$Dept</span> = <span class="variable">$_</span>.department

    <span class="keyword">try</span> {
        New-ADUser `
            -Name <span class="variable">$Name</span> `
            -SamAccountName <span class="variable">$Username</span> `
            -UserPrincipalName <span class="string">"$Username@$Domain"</span> `
            -Department <span class="variable">$Dept</span> `
            -AccountPassword <span class="variable">$DefaultPass</span> `
            -ChangePasswordAtLogon <span class="variable">$true</span> `
            -Enabled <span class="variable">$true</span>

        Write-Host <span class="string">"‚úÖ Created: $Username"</span> -ForegroundColor Green
    } <span class="keyword">catch</span> {
        Write-Host <span class="string">"‚ùå Failed: $Username - $_"</span> -ForegroundColor Red
    }
}

<span class="comment"># Find and disable inactive users</span>
<span class="variable">$InactiveDate</span> = (Get-Date).AddDays(-<span class="number">90</span>)
Get-ADUser -Filter {LastLogonDate -lt <span class="variable">$InactiveDate</span>} | ForEach-Object {
    Disable-ADAccount <span class="variable">$_</span>
    Write-Host <span class="string">"üîí Disabled: $($_.SamAccountName)"</span>
}</code>
                </div>

                <h4>üîß Tasks</h4>
                <ul class="task-list">
                    <li><input type="checkbox" id="t5-1"> Create a script to provision new users from a CSV file</li>
                    <li><input type="checkbox" id="t5-2"> Implement password policy enforcement</li>
                    <li><input type="checkbox" id="t5-3"> Build a user deprovisioning script (disable, archive, remove)</li>
                    <li><input type="checkbox" id="t5-4"> Create a permission audit report</li>
                    <li><input type="checkbox" id="t5-5"> Automate group membership based on department</li>
                </ul>
            </div>
        </article>

        <!-- Exercise 6: Integration & Reporting -->
        <article class="exercise" data-exercise="6">
            <div class="exercise-header">
                <div class="exercise-number">6</div>
                <h3 class="exercise-title">Integration & Automated Reporting</h3>
                <span class="exercise-difficulty difficulty-advanced">Advanced</span>
            </div>
            <div class="exercise-content">
                <p>Combine multiple automation scripts into comprehensive solutions with reporting.</p>

                <div class="scenario-box">
                    <h5>üéØ Capstone Project</h5>
                    <p>Build a "Daily Operations Dashboard" that collects data from multiple sources and generates an HTML report sent via email.</p>
                </div>

                <h4>üìñ Report Generation</h4>
                <div class="code-block active">
                    <code><span class="comment">#!/usr/bin/env python3</span>
<span class="string">"""Generate HTML system report."""</span>

<span class="keyword">import</span> os
<span class="keyword">import</span> psutil
<span class="keyword">import</span> smtplib
<span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText
<span class="keyword">from</span> email.mime.multipart <span class="keyword">import</span> MIMEMultipart
<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime

<span class="keyword">def</span> <span class="function">generate_html_report</span>():
    <span class="variable">cpu</span> = psutil.cpu_percent(interval=<span class="number">1</span>)
    <span class="variable">memory</span> = psutil.virtual_memory()
    <span class="variable">disk</span> = psutil.disk_usage(<span class="string">'/'</span>)

    <span class="variable">html</span> = <span class="string">f"""
    &lt;html&gt;
    &lt;head&gt;&lt;style&gt;
        body {{ font-family: Arial; padding: 20px; }}
        .metric {{ margin: 10px 0; padding: 15px; background: #f5f5f5; }}
        .warning {{ background: #fff3cd; }}
        .critical {{ background: #f8d7da; }}
    &lt;/style&gt;&lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;System Report - {datetime.now().strftime('%Y-%m-%d %H:%M')}&lt;/h1&gt;
        &lt;div class="metric {'warning' if cpu > 70 else ''}"&gt;
            &lt;h3&gt;CPU: {cpu}%&lt;/h3&gt;
        &lt;/div&gt;
        &lt;div class="metric {'warning' if memory.percent > 80 else ''}"&gt;
            &lt;h3&gt;Memory: {memory.percent}%&lt;/h3&gt;
        &lt;/div&gt;
        &lt;div class="metric {'critical' if disk.percent > 90 else ''}"&gt;
            &lt;h3&gt;Disk: {disk.percent}%&lt;/h3&gt;
        &lt;/div&gt;
    &lt;/body&gt;
    &lt;/html&gt;
    """</span>
    <span class="keyword">return</span> html

<span class="keyword">def</span> <span class="function">send_report</span>(html_content, to_email):
    msg = MIMEMultipart(<span class="string">'alternative'</span>)
    msg[<span class="string">'Subject'</span>] = <span class="string">f"Daily System Report - {datetime.now().strftime('%Y-%m-%d')}"</span>
    msg[<span class="string">'From'</span>] = <span class="string">"reports@example.com"</span>
    msg[<span class="string">'To'</span>] = to_email
    msg.attach(MIMEText(html_content, <span class="string">'html'</span>))

    <span class="keyword">with</span> smtplib.SMTP(<span class="string">'smtp.example.com'</span>) <span class="keyword">as</span> server:
        server.send_message(msg)

<span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:
    report = generate_html_report()
    <span class="comment"># send_report(report, "admin@example.com")</span>
    <span class="function">print</span>(report)</code>
                </div>

                <h4>üîß Tasks</h4>
                <ul class="task-list">
                    <li><input type="checkbox" id="t6-1"> Create an HTML report template with CSS styling</li>
                    <li><input type="checkbox" id="t6-2"> Integrate data from health checks, backups, and security logs</li>
                    <li><input type="checkbox" id="t6-3"> Add conditional formatting (green/yellow/red) for metrics</li>
                    <li><input type="checkbox" id="t6-4"> Implement email delivery of the report</li>
                    <li><input type="checkbox" id="t6-5"> Schedule the report to run daily and archive historical reports</li>
                </ul>

                <h4>üîó Related Visualizers</h4>
                <a href="../applets/reporting-automation.html" class="applet-link">üìà Reporting Automation</a>

                <div class="reflection-section">
                    <h4>üìù Final Reflection</h4>
                    <p>What repetitive tasks in your current role could you automate? Estimate the time savings per week.</p>
                    <textarea placeholder="List tasks and estimated time savings..."></textarea>
                </div>
            </div>
        </article>

        <nav class="nav-buttons">
            <a href="../index.html" class="nav-btn nav-btn-back">‚Üê Back to Script House</a>
            <a href="sysadmin-quiz.html" class="nav-btn nav-btn-next">Take the Quiz ‚Üí</a>
        </nav>
    </div>

    <script>
        // Tab switching
        function showTab(tab, blockId) {
            const parent = tab.closest('.exercise-content');
            parent.querySelectorAll('.code-tab').forEach(t => t.classList.remove('active'));
            parent.querySelectorAll('.code-block').forEach(b => b.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById(blockId).classList.add('active');
        }

        // Progress tracking
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        const progressFill = document.getElementById('progressFill');
        const STORAGE_KEY = 'hexworth_sysadmin_lab_progress';

        function loadProgress() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const progress = JSON.parse(saved);
                checkboxes.forEach(cb => {
                    if (progress[cb.id]) {
                        cb.checked = true;
                    }
                });
            }
            updateProgress();
        }

        function saveProgress() {
            const progress = {};
            checkboxes.forEach(cb => {
                progress[cb.id] = cb.checked;
            });
            localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
            updateProgress();
        }

        function updateProgress() {
            const total = checkboxes.length;
            const completed = Array.from(checkboxes).filter(cb => cb.checked).length;
            const percentage = (completed / total) * 100;
            progressFill.style.width = percentage + '%';
        }

        checkboxes.forEach(cb => {
            cb.addEventListener('change', saveProgress);
        });

        // Save reflections
        const textareas = document.querySelectorAll('textarea');
        textareas.forEach((ta, index) => {
            const key = `hexworth_sysadmin_lab_reflection_${index}`;
            ta.value = localStorage.getItem(key) || '';
            ta.addEventListener('input', () => {
                localStorage.setItem(key, ta.value);
            });
        });

        loadProgress();
    </script>
</body>
</html>
