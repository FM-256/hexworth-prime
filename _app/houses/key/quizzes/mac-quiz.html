<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Access Control -->
    <script src="../../../../components/AccessGuard.js"></script>
    <script>
        AccessGuard.require('sorted');
    </script>
    <!-- Achievement & Progress Integration -->
    <script src="../../../../components/AchievementManager.js"></script>
    <script src="../../../../components/ModuleProgress.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAC & HMAC Quiz - House of the Key</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --house-color: #06b6d4;
            --house-glow: rgba(6, 182, 212, 0.4);
            --bg-dark: #0a0a12;
            --bg-card: rgba(15, 15, 25, 0.8);
            --text-primary: #e8e8f0;
            --text-secondary: #8888aa;
            --success-green: #10b981;
            --warning-red: #ef4444;
            --info-blue: #3b82f6;
        }

        body {
            min-height: 100vh;
            background: var(--bg-dark);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* Header */
        .module-header {
            padding: 20px 30px;
            background: rgba(10, 10, 18, 0.95);
            border-bottom: 1px solid rgba(6, 182, 212, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 1px solid rgba(6, 182, 212, 0.3);
            background: transparent;
            color: var(--house-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .back-btn:hover {
            background: rgba(6, 182, 212, 0.1);
        }

        .module-title {
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .house-badge {
            font-size: 0.7rem;
            padding: 4px 12px;
            background: rgba(6, 182, 212, 0.15);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 20px;
            color: var(--house-color);
            letter-spacing: 0.1em;
        }

        /* Container */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 30px;
        }

        /* Intro */
        .intro {
            text-align: center;
            margin-bottom: 40px;
        }

        .intro-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 15px var(--house-glow));
        }

        .intro-title {
            font-size: 2rem;
            font-weight: 300;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #fff, var(--house-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .intro-subtitle {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .quiz-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }

        .quiz-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--house-color);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Question Card */
        .question-card {
            background: var(--bg-card);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 25px;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .question-number {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .question-badge {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, var(--house-color), #22d3ee);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.95rem;
            color: #0a0a12;
        }

        .question-text {
            font-size: 1.1rem;
            color: var(--text-primary);
            line-height: 1.6;
            flex: 1;
        }

        .question-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            background: rgba(6, 182, 212, 0.05);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: 8px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .option:hover {
            background: rgba(6, 182, 212, 0.1);
            border-color: rgba(6, 182, 212, 0.4);
        }

        .option.selected {
            background: rgba(6, 182, 212, 0.15);
            border-color: var(--house-color);
        }

        .option.correct {
            background: rgba(16, 185, 129, 0.15);
            border-color: var(--success-green);
        }

        .option.incorrect {
            background: rgba(239, 68, 68, 0.15);
            border-color: var(--warning-red);
        }

        .option.disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .option-letter {
            width: 28px;
            height: 28px;
            background: rgba(6, 182, 212, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--house-color);
            flex-shrink: 0;
        }

        .option.correct .option-letter {
            background: rgba(16, 185, 129, 0.3);
            color: var(--success-green);
        }

        .option.incorrect .option-letter {
            background: rgba(239, 68, 68, 0.3);
            color: var(--warning-red);
        }

        .option-text {
            color: var(--text-primary);
            line-height: 1.5;
        }

        /* Explanation */
        .explanation {
            background: rgba(6, 182, 212, 0.05);
            border-left: 3px solid var(--house-color);
            border-radius: 4px;
            padding: 15px 20px;
            margin-top: 15px;
            display: none;
        }

        .explanation.visible {
            display: block;
        }

        .explanation-title {
            font-weight: 600;
            color: var(--house-color);
            margin-bottom: 8px;
        }

        .explanation-text {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Submit Button */
        .submit-section {
            text-align: center;
            margin: 40px 0;
        }

        .submit-btn {
            background: linear-gradient(135deg, var(--house-color), #22d3ee);
            border: none;
            border-radius: 8px;
            padding: 15px 40px;
            color: #0a0a12;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px var(--house-glow);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--house-glow);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Results */
        .results-card {
            background: var(--bg-card);
            border: 2px solid var(--house-color);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            display: none;
        }

        .results-card.visible {
            display: block;
        }

        .results-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .results-score {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--house-color), #22d3ee);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
        }

        .results-message {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .results-breakdown {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .breakdown-item {
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: 8px;
            padding: 20px;
        }

        .breakdown-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--house-color);
        }

        .breakdown-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 5px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--house-color), #22d3ee);
            border: none;
            border-radius: 8px;
            padding: 12px 30px;
            color: #0a0a12;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 8px;
            padding: 12px 30px;
            color: var(--house-color);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-secondary:hover {
            background: rgba(6, 182, 212, 0.2);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 30px 20px;
            }

            .quiz-info {
                flex-direction: column;
                gap: 15px;
            }

            .results-breakdown {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="module-header">
        <div class="header-left">
            <button class="back-btn" onclick="window.location.href='../../index.html'" title="Back to Key House">‚Üê</button>
            <h1 class="module-title">MAC & HMAC Quiz</h1>
            <span class="house-badge">KEY HOUSE</span>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Intro -->
        <div class="intro">
            <div class="intro-icon">üìù</div>
            <h1 class="intro-title">Message Authentication Quiz</h1>
            <p class="intro-subtitle">
                Test your understanding of HMAC, message authentication codes, and authenticated encryption.
            </p>
            <div class="quiz-info">
                <div class="quiz-stat">
                    <div class="stat-value">10</div>
                    <div class="stat-label">Questions</div>
                </div>
                <div class="quiz-stat">
                    <div class="stat-value">70%</div>
                    <div class="stat-label">To Pass</div>
                </div>
                <div class="quiz-stat">
                    <div class="stat-value">~15</div>
                    <div class="stat-label">Minutes</div>
                </div>
            </div>
        </div>

        <!-- Questions -->
        <div id="quiz-questions">
            <!-- Question 1 -->
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">
                        <div class="question-badge">1</div>
                        <div class="question-text">What is the primary difference between a hash function and an HMAC?</div>
                    </div>
                </div>
                <div class="question-options">
                    <div class="option" onclick="selectOption(1, 0)">
                        <div class="option-letter">A</div>
                        <div class="option-text">HMAC is faster than a hash function</div>
                    </div>
                    <div class="option" onclick="selectOption(1, 1)">
                        <div class="option-letter">B</div>
                        <div class="option-text">HMAC incorporates a secret key, providing authentication</div>
                    </div>
                    <div class="option" onclick="selectOption(1, 2)">
                        <div class="option-letter">C</div>
                        <div class="option-text">HMAC produces longer output than hash functions</div>
                    </div>
                    <div class="option" onclick="selectOption(1, 3)">
                        <div class="option-letter">D</div>
                        <div class="option-text">Hash functions can only be used for password storage</div>
                    </div>
                </div>
                <div class="explanation">
                    <div class="explanation-title">Explanation:</div>
                    <div class="explanation-text">
                        HMAC (Hash-based Message Authentication Code) uses a secret key combined with a hash function.
                        This key makes it cryptographically secure for authentication‚Äîwithout the key, an attacker
                        cannot forge a valid HMAC. Plain hash functions have no key and can't provide authentication.
                    </div>
                </div>
            </div>

            <!-- Question 2 -->
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">
                        <div class="question-badge">2</div>
                        <div class="question-text">Why is constant-time comparison critical when verifying MACs?</div>
                    </div>
                </div>
                <div class="question-options">
                    <div class="option" onclick="selectOption(2, 0)">
                        <div class="option-letter">A</div>
                        <div class="option-text">It improves performance by skipping unnecessary comparisons</div>
                    </div>
                    <div class="option" onclick="selectOption(2, 1)">
                        <div class="option-letter">B</div>
                        <div class="option-text">It prevents timing attacks where attackers measure execution time differences</div>
                    </div>
                    <div class="option" onclick="selectOption(2, 2)">
                        <div class="option-letter">C</div>
                        <div class="option-text">It ensures the MAC is computed correctly</div>
                    </div>
                    <div class="option" onclick="selectOption(2, 3)">
                        <div class="option-letter">D</div>
                        <div class="option-text">It's only required for HMAC-SHA1, not SHA-256</div>
                    </div>
                </div>
                <div class="explanation">
                    <div class="explanation-title">Explanation:</div>
                    <div class="explanation-text">
                        Timing attacks exploit the fact that early-exit comparisons take different amounts of time
                        based on where the first mismatch occurs. By measuring response times statistically, attackers
                        can forge valid MACs byte by byte. Constant-time comparison examines every byte regardless
                        of matches, providing consistent execution time.
                    </div>
                </div>
            </div>

            <!-- Question 3 -->
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">
                        <div class="question-badge">3</div>
                        <div class="question-text">Which authenticated encryption composition method is recommended?</div>
                    </div>
                </div>
                <div class="question-options">
                    <div class="option" onclick="selectOption(3, 0)">
                        <div class="option-letter">A</div>
                        <div class="option-text">MAC-then-Encrypt: MAC(plaintext), then encrypt both</div>
                    </div>
                    <div class="option" onclick="selectOption(3, 1)">
                        <div class="option-letter">B</div>
                        <div class="option-text">Encrypt-then-MAC: Encrypt(plaintext), then MAC(ciphertext)</div>
                    </div>
                    <div class="option" onclick="selectOption(3, 2)">
                        <div class="option-letter">C</div>
                        <div class="option-text">Encrypt-and-MAC: Compute both independently on plaintext</div>
                    </div>
                    <div class="option" onclick="selectOption(3, 3)">
                        <div class="option-letter">D</div>
                        <div class="option-text">All methods are equally secure</div>
                    </div>
                </div>
                <div class="explanation">
                    <div class="explanation-title">Explanation:</div>
                    <div class="explanation-text">
                        Encrypt-then-MAC is the recommended approach because the MAC is verified before decryption,
                        preventing padding oracle attacks and other decryption-based exploits. MAC-then-Encrypt is
                        vulnerable to several attack classes. Encrypt-and-MAC can leak plaintext information.
                    </div>
                </div>
            </div>

            <!-- Question 4 -->
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">
                        <div class="question-badge">4</div>
                        <div class="question-text">What does AEAD stand for, and what does it provide?</div>
                    </div>
                </div>
                <div class="question-options">
                    <div class="option" onclick="selectOption(4, 0)">
                        <div class="option-letter">A</div>
                        <div class="option-text">Advanced Encryption and Decryption</div>
                    </div>
                    <div class="option" onclick="selectOption(4, 1)">
                        <div class="option-letter">B</div>
                        <div class="option-text">Authenticated Encryption with Associated Data</div>
                    </div>
                    <div class="option" onclick="selectOption(4, 2)">
                        <div class="option-letter">C</div>
                        <div class="option-text">Asymmetric Encryption and Authentication Device</div>
                    </div>
                    <div class="option" onclick="selectOption(4, 3)">
                        <div class="option-letter">D</div>
                        <div class="option-text">Automatic Error Detection and Decryption</div>
                    </div>
                </div>
                <div class="explanation">
                    <div class="explanation-title">Explanation:</div>
                    <div class="explanation-text">
                        AEAD (Authenticated Encryption with Associated Data) modes like AES-GCM and ChaCha20-Poly1305
                        provide integrated encryption and authentication in a single operation. They can also authenticate
                        additional data (like protocol headers) that isn't encrypted, preventing header manipulation attacks.
                    </div>
                </div>
            </div>

            <!-- Question 5 -->
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">
                        <div class="question-badge">5</div>
                        <div class="question-text">What is the CRITICAL requirement for AES-GCM nonce management?</div>
                    </div>
                </div>
                <div class="question-options">
                    <div class="option" onclick="selectOption(5, 0)">
                        <div class="option-letter">A</div>
                        <div class="option-text">Nonce must be at least 256 bits long</div>
                    </div>
                    <div class="option" onclick="selectOption(5, 1)">
                        <div class="option-letter">B</div>
                        <div class="option-text">Nonce must NEVER be reused with the same key</div>
                    </div>
                    <div class="option" onclick="selectOption(5, 2)">
                        <div class="option-letter">C</div>
                        <div class="option-text">Nonce must be kept secret from attackers</div>
                    </div>
                    <div class="option" onclick="selectOption(5, 3)">
                        <div class="option-letter">D</div>
                        <div class="option-text">Nonce should be derived from the message content</div>
                    </div>
                </div>
                <div class="explanation">
                    <div class="explanation-title">Explanation:</div>
                    <div class="explanation-text">
                        Nonce reuse in AES-GCM is catastrophic‚Äîit can allow attackers to recover the authentication
                        key and forge messages. The nonce doesn't need to be secret (it can be transmitted in the clear),
                        but it must be unique for every encryption operation with the same key. 96-bit nonces are standard,
                        not 256-bit.
                    </div>
                </div>
            </div>

            <!-- Question 6 -->
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">
                        <div class="question-badge">6</div>
                        <div class="question-text">Why should encryption keys and MAC keys be different?</div>
                    </div>
                </div>
                <div class="question-options">
                    <div class="option" onclick="selectOption(6, 0)">
                        <div class="option-letter">A</div>
                        <div class="option-text">It's faster to use two different keys</div>
                    </div>
                    <div class="option" onclick="selectOption(6, 1)">
                        <div class="option-letter">B</div>
                        <div class="option-text">Key separation limits the impact if one key is compromised</div>
                    </div>
                    <div class="option" onclick="selectOption(6, 2)">
                        <div class="option-letter">C</div>
                        <div class="option-text">MAC keys must be shorter than encryption keys</div>
                    </div>
                    <div class="option" onclick="selectOption(6, 3)">
                        <div class="option-letter">D</div>
                        <div class="option-text">They don't need to be different; this is a myth</div>
                    </div>
                </div>
                <div class="explanation">
                    <div class="explanation-title">Explanation:</div>
                    <div class="explanation-text">
                        Using separate keys for different cryptographic operations is a fundamental security principle.
                        If the same key is used for both encryption and MAC, a weakness or compromise in one system
                        affects both. Key derivation functions (like HKDF) can generate separate keys from a master key.
                    </div>
                </div>
            </div>

            <!-- Question 7 -->
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">
                        <div class="question-badge">7</div>
                        <div class="question-text">Which hash algorithm should NOT be used with HMAC in new systems?</div>
                    </div>
                </div>
                <div class="question-options">
                    <div class="option" onclick="selectOption(7, 0)">
                        <div class="option-letter">A</div>
                        <div class="option-text">SHA-256</div>
                    </div>
                    <div class="option" onclick="selectOption(7, 1)">
                        <div class="option-letter">B</div>
                        <div class="option-text">SHA-512</div>
                    </div>
                    <div class="option" onclick="selectOption(7, 2)">
                        <div class="option-letter">C</div>
                        <div class="option-text">SHA-1</div>
                    </div>
                    <div class="option" onclick="selectOption(7, 3)">
                        <div class="option-letter">D</div>
                        <div class="option-text">SHA-384</div>
                    </div>
                </div>
                <div class="explanation">
                    <div class="explanation-title">Explanation:</div>
                    <div class="explanation-text">
                        SHA-1 is cryptographically broken and should not be used in new systems, even with HMAC.
                        While HMAC provides some protection against hash weaknesses, it's best practice to use
                        modern hash functions like SHA-256, SHA-384, or SHA-512 for new deployments.
                    </div>
                </div>
            </div>

            <!-- Question 8 -->
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">
                        <div class="question-badge">8</div>
                        <div class="question-text">In AWS Signature Version 4, what is the primary purpose of signing API requests?</div>
                    </div>
                </div>
                <div class="question-options">
                    <div class="option" onclick="selectOption(8, 0)">
                        <div class="option-letter">A</div>
                        <div class="option-text">To encrypt the request data</div>
                    </div>
                    <div class="option" onclick="selectOption(8, 1)">
                        <div class="option-letter">B</div>
                        <div class="option-text">To prove the requester has the secret key without transmitting it</div>
                    </div>
                    <div class="option" onclick="selectOption(8, 2)">
                        <div class="option-letter">C</div>
                        <div class="option-text">To compress the request for faster transmission</div>
                    </div>
                    <div class="option" onclick="selectOption(8, 3)">
                        <div class="option-letter">D</div>
                        <div class="option-text">To generate a unique session ID</div>
                    </div>
                </div>
                <div class="explanation">
                    <div class="explanation-title">Explanation:</div>
                    <div class="explanation-text">
                        AWS Signature V4 uses HMAC to sign API requests, proving the caller possesses the secret
                        access key without transmitting it over the network. The signature covers the request method,
                        path, headers, and body, ensuring integrity and authenticity. This is a standard pattern for
                        API authentication.
                    </div>
                </div>
            </div>

            <!-- Question 9 -->
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">
                        <div class="question-badge">9</div>
                        <div class="question-text">What is the main difference between MAC and digital signatures?</div>
                    </div>
                </div>
                <div class="question-options">
                    <div class="option" onclick="selectOption(9, 0)">
                        <div class="option-letter">A</div>
                        <div class="option-text">MACs use symmetric keys; digital signatures use asymmetric keys</div>
                    </div>
                    <div class="option" onclick="selectOption(9, 1)">
                        <div class="option-letter">B</div>
                        <div class="option-text">MACs are faster but digital signatures are more secure</div>
                    </div>
                    <div class="option" onclick="selectOption(9, 2)">
                        <div class="option-letter">C</div>
                        <div class="option-text">Digital signatures can only be used for emails</div>
                    </div>
                    <div class="option" onclick="selectOption(9, 3)">
                        <div class="option-letter">D</div>
                        <div class="option-text">There is no difference; they're the same thing</div>
                    </div>
                </div>
                <div class="explanation">
                    <div class="explanation-title">Explanation:</div>
                    <div class="explanation-text">
                        MACs use symmetric keys (both parties share the same secret), while digital signatures use
                        asymmetric cryptography (private key to sign, public key to verify). This means digital
                        signatures provide non-repudiation (only the private key holder can sign), while both MAC
                        parties can generate valid tags. MACs are much faster than signatures.
                    </div>
                </div>
            </div>

            <!-- Question 10 -->
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">
                        <div class="question-badge">10</div>
                        <div class="question-text">Why does HMAC use nested hashing with ipad and opad?</div>
                    </div>
                </div>
                <div class="question-options">
                    <div class="option" onclick="selectOption(10, 0)">
                        <div class="option-letter">A</div>
                        <div class="option-text">To make computation slower and more secure</div>
                    </div>
                    <div class="option" onclick="selectOption(10, 1)">
                        <div class="option-letter">B</div>
                        <div class="option-text">To protect against length extension attacks</div>
                    </div>
                    <div class="option" onclick="selectOption(10, 2)">
                        <div class="option-letter">C</div>
                        <div class="option-text">To allow multiple keys in a single HMAC</div>
                    </div>
                    <div class="option" onclick="selectOption(10, 3)">
                        <div class="option-letter">D</div>
                        <div class="option-text">To compress the output to save space</div>
                    </div>
                </div>
                <div class="explanation">
                    <div class="explanation-title">Explanation:</div>
                    <div class="explanation-text">
                        The nested construction H((K ‚äï opad) || H((K ‚äï ipad) || m)) protects against length extension
                        attacks that affect simple H(K || m) constructions. With Merkle-Damg√•rd hashes like SHA-256,
                        attackers could extend H(K || m) without knowing K. HMAC's double hashing prevents this,
                        providing proven security even if the underlying hash has some weaknesses.
                    </div>
                </div>
            </div>
        </div>

        <!-- Submit Button -->
        <div class="submit-section">
            <button class="submit-btn" id="submit-btn" onclick="submitQuiz()">Submit Quiz</button>
        </div>

        <!-- Results -->
        <div class="results-card" id="results-card">
            <div class="results-icon" id="results-icon"></div>
            <div class="results-title" id="results-title"></div>
            <div class="results-score" id="results-score"></div>
            <div class="results-message" id="results-message"></div>

            <div class="results-breakdown">
                <div class="breakdown-item">
                    <div class="breakdown-value" id="correct-count">0</div>
                    <div class="breakdown-label">Correct</div>
                </div>
                <div class="breakdown-item">
                    <div class="breakdown-value" id="incorrect-count">0</div>
                    <div class="breakdown-label">Incorrect</div>
                </div>
                <div class="breakdown-item">
                    <div class="breakdown-value" id="percentage">0%</div>
                    <div class="breakdown-label">Score</div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn-primary" onclick="window.location.href='../../index.html'">Return to Key House</button>
                <button class="btn-secondary" onclick="retakeQuiz()">Retake Quiz</button>
            </div>
        </div>
    </div>

    <script>
        // Quiz data
        const correctAnswers = [1, 1, 1, 1, 1, 1, 2, 1, 0, 1];
        let selectedAnswers = Array(10).fill(null);
        let quizSubmitted = false;

        // Select option
        function selectOption(questionNum, optionNum) {
            if (quizSubmitted) return;

            const questionCard = document.querySelectorAll('.question-card')[questionNum - 1];
            const options = questionCard.querySelectorAll('.option');

            // Deselect all options
            options.forEach(opt => opt.classList.remove('selected'));

            // Select clicked option
            options[optionNum].classList.add('selected');

            // Store answer
            selectedAnswers[questionNum - 1] = optionNum;
        }

        // Submit quiz
        function submitQuiz() {
            // Check if all questions answered
            if (selectedAnswers.includes(null)) {
                alert('Please answer all questions before submitting.');
                return;
            }

            quizSubmitted = true;

            // Calculate score
            let correctCount = 0;
            selectedAnswers.forEach((answer, index) => {
                if (answer === correctAnswers[index]) {
                    correctCount++;
                }
            });

            const percentage = Math.round((correctCount / correctAnswers.length) * 100);
            const passed = percentage >= 70;

            // Show correct/incorrect answers
            document.querySelectorAll('.question-card').forEach((card, index) => {
                const options = card.querySelectorAll('.option');
                const userAnswer = selectedAnswers[index];
                const correctAnswer = correctAnswers[index];

                // Mark correct answer
                options[correctAnswer].classList.add('correct');

                // Mark incorrect answer if wrong
                if (userAnswer !== correctAnswer) {
                    options[userAnswer].classList.add('incorrect');
                }

                // Disable all options
                options.forEach(opt => opt.classList.add('disabled'));

                // Show explanation
                card.querySelector('.explanation').classList.add('visible');
            });

            // Hide submit button
            document.getElementById('submit-btn').style.display = 'none';

            // Show results
            const resultsCard = document.getElementById('results-card');
            document.getElementById('results-icon').textContent = passed ? 'üéâ' : 'üìö';
            document.getElementById('results-title').textContent = passed ? 'Congratulations!' : 'Keep Learning';
            document.getElementById('results-score').textContent = percentage + '%';
            document.getElementById('results-message').textContent = passed ?
                'You\'ve demonstrated strong understanding of message authentication codes and HMAC. Well done!' :
                'Review the explanations below and try again. Understanding MAC fundamentals is crucial for secure systems.';

            document.getElementById('correct-count').textContent = correctCount;
            document.getElementById('incorrect-count').textContent = correctAnswers.length - correctCount;
            document.getElementById('percentage').textContent = percentage + '%';

            resultsCard.classList.add('visible');

            // Scroll to results
            resultsCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

            // Complete quiz if passed
            if (passed) {
                ModuleProgress.completeQuiz('key', 'mac-quiz');
            }
        }

        // Retake quiz
        function retakeQuiz() {
            quizSubmitted = false;
            selectedAnswers = Array(10).fill(null);

            // Reset all questions
            document.querySelectorAll('.question-card').forEach(card => {
                const options = card.querySelectorAll('.option');
                options.forEach(opt => {
                    opt.classList.remove('selected', 'correct', 'incorrect', 'disabled');
                });
                card.querySelector('.explanation').classList.remove('visible');
            });

            // Hide results
            document.getElementById('results-card').classList.remove('visible');

            // Show submit button
            document.getElementById('submit-btn').style.display = 'inline-block';

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
