<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Access Control -->
    <script src="../../../components/AccessGuard.js"></script>
    <script>
        AccessGuard.require('sorted');
    </script>
    <!-- Achievement & Progress Integration -->
    <script src="../../../components/AchievementManager.js"></script>
    <script src="../../../components/ModuleProgress.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSM & Key Management Quiz - House of the Key</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --house-color: #f59e0b;
            --house-glow: rgba(245, 158, 11, 0.4);
            --bg-dark: #0a0a12;
            --bg-card: rgba(15, 15, 25, 0.8);
            --text-primary: #e8e8f0;
            --text-secondary: #8888aa;
            --success-green: #10b981;
            --warning-red: #ef4444;
            --info-blue: #3b82f6;
        }

        body {
            min-height: 100vh;
            background: var(--bg-dark);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* Header */
        .module-header {
            padding: 20px 30px;
            background: rgba(10, 10, 18, 0.95);
            border-bottom: 1px solid rgba(245, 158, 11, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 1px solid rgba(245, 158, 11, 0.3);
            background: transparent;
            color: var(--house-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .back-btn:hover {
            background: rgba(245, 158, 11, 0.1);
        }

        .module-title {
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .house-badge {
            font-size: 0.7rem;
            padding: 4px 12px;
            background: rgba(245, 158, 11, 0.15);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 20px;
            color: var(--house-color);
            letter-spacing: 0.1em;
        }

        /* Container */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 30px;
        }

        /* Intro */
        .intro {
            text-align: center;
            margin-bottom: 40px;
        }

        .intro-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .intro-title {
            font-size: 2rem;
            font-weight: 300;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #fff, var(--house-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .intro-subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
        }

        /* Quiz Card */
        .quiz-card {
            background: var(--bg-card);
            border: 1px solid rgba(245, 158, 11, 0.2);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 25px;
            transition: all 0.3s ease;
        }

        .quiz-card.answered {
            opacity: 0.7;
        }

        .quiz-card.correct {
            border-color: var(--success-green);
            background: rgba(16, 185, 129, 0.05);
        }

        .quiz-card.incorrect {
            border-color: var(--warning-red);
            background: rgba(239, 68, 68, 0.05);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
        }

        .question-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: rgba(245, 158, 11, 0.2);
            border: 2px solid var(--house-color);
            border-radius: 50%;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--house-color);
            flex-shrink: 0;
        }

        .quiz-card.correct .question-number {
            background: rgba(16, 185, 129, 0.2);
            border-color: var(--success-green);
            color: var(--success-green);
        }

        .quiz-card.incorrect .question-number {
            background: rgba(239, 68, 68, 0.2);
            border-color: var(--warning-red);
            color: var(--warning-red);
        }

        .question-text {
            font-size: 1.1rem;
            line-height: 1.6;
            color: var(--text-primary);
            flex: 1;
            padding-left: 20px;
        }

        .options {
            margin: 20px 0;
        }

        .option {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px 20px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .option:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--house-color);
        }

        .option input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .option-text {
            flex: 1;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .option.correct {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--success-green);
        }

        .option.incorrect {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--warning-red);
        }

        .option.correct .option-text {
            color: var(--success-green);
        }

        .option.incorrect .option-text {
            color: var(--warning-red);
        }

        /* Explanation */
        .explanation {
            background: rgba(59, 130, 246, 0.1);
            border-left: 3px solid var(--info-blue);
            padding: 15px 20px;
            margin-top: 20px;
            border-radius: 6px;
            display: none;
        }

        .explanation.show {
            display: block;
        }

        .explanation-title {
            color: var(--info-blue);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .explanation-text {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Submit Button */
        .submit-btn {
            width: 100%;
            padding: 15px;
            background: var(--house-color);
            color: #000;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
        }

        .submit-btn:hover {
            background: #06b6d4;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3);
        }

        .submit-btn:disabled {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
        }

        /* Results */
        .results {
            background: var(--bg-card);
            border: 2px solid var(--house-color);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            margin: 30px 0;
            display: none;
        }

        .results.show {
            display: block;
        }

        .results-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .results-score {
            font-size: 3rem;
            font-weight: 300;
            background: linear-gradient(135deg, #fff, var(--house-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
        }

        .results-message {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
        }

        .results-breakdown {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .breakdown-item {
            text-align: center;
        }

        .breakdown-value {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .breakdown-value.correct {
            color: var(--success-green);
        }

        .breakdown-value.incorrect {
            color: var(--warning-red);
        }

        .breakdown-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .retry-btn {
            padding: 12px 30px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .retry-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 30px 20px;
            }

            .question-header {
                flex-direction: column;
                gap: 15px;
            }

            .question-text {
                padding-left: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="module-header">
        <div class="header-left">
            <button class="back-btn" onclick="window.location.href='../../../index.html'">‚Üê</button>
            <div>
                <div class="module-title">HSM & Key Management Quiz</div>
                <div class="house-badge">HOUSE OF THE KEY</div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Intro -->
        <div class="intro">
            <div class="intro-icon">üìù</div>
            <h1 class="intro-title">Test Your Knowledge</h1>
            <p class="intro-subtitle">
                10 questions covering HSMs, key lifecycle, envelope encryption, and enterprise key management.
            </p>
        </div>

        <!-- Quiz Questions -->
        <div id="quiz-container">
            <!-- Question 1 -->
            <div class="quiz-card" data-question="1" data-correct="b">
                <div class="question-header">
                    <div class="question-number">1</div>
                    <div class="question-text">
                        What is the primary purpose of a Hardware Security Module (HSM)?
                    </div>
                </div>
                <div class="options">
                    <label class="option">
                        <input type="radio" name="q1" value="a">
                        <span class="option-text">To encrypt data faster than software-based encryption</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q1" value="b">
                        <span class="option-text">To provide tamper-resistant storage and cryptographic operations for keys</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q1" value="c">
                        <span class="option-text">To generate random numbers for encryption algorithms</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q1" value="d">
                        <span class="option-text">To serve as a backup storage device for encryption keys</span>
                    </label>
                </div>
                <div class="explanation">
                    <div class="explanation-title">Explanation</div>
                    <div class="explanation-text">
                        HSMs are specialized hardware devices designed to protect cryptographic keys from compromise.
                        They provide tamper-resistant/tamper-evident physical security, ensuring keys never exist in
                        plaintext outside the HSM boundary. Physical attacks trigger automatic key zeroization (destruction).
                        While HSMs do offer performance benefits and include TRNGs, their primary purpose is secure key protection.
                    </div>
                </div>
            </div>

            <!-- Question 2 -->
            <div class="quiz-card" data-question="2" data-correct="c">
                <div class="question-header">
                    <div class="question-number">2</div>
                    <div class="question-text">
                        FIPS 140-2 Level 3 certification requires which of the following?
                    </div>
                </div>
                <div class="options">
                    <label class="option">
                        <input type="radio" name="q2" value="a">
                        <span class="option-text">Software-based encryption with strong passwords</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q2" value="b">
                        <span class="option-text">Tamper-evident seals and role-based authentication</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q2" value="c">
                        <span class="option-text">Tamper-detection circuits that trigger key zeroization and identity-based authentication</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q2" value="d">
                        <span class="option-text">Protection against environmental attacks (voltage, temperature manipulation)</span>
                    </label>
                </div>
                <div class="explanation">
                    <div class="explanation-title">Explanation</div>
                    <div class="explanation-text">
                        FIPS 140-2 has four security levels:<br>
                        <strong>Level 1:</strong> Software cryptography, basic security<br>
                        <strong>Level 2:</strong> Tamper-evident seals, role-based authentication<br>
                        <strong>Level 3:</strong> Tamper-detection circuits + identity-based auth (physical attacks trigger zeroization)<br>
                        <strong>Level 4:</strong> Environmental attack protection (voltage, temperature, radiation)<br><br>
                        Level 3 is required for most high-security applications like payment processing and PKI root CAs.
                    </div>
                </div>
            </div>

            <!-- Question 3 -->
            <div class="quiz-card" data-question="3" data-correct="c">
                <div class="question-header">
                    <div class="question-number">3</div>
                    <div class="question-text">
                        In a key hierarchy, what is the primary benefit of using Key Encryption Keys (KEKs) to protect Data Encryption Keys (DEKs)?
                    </div>
                </div>
                <div class="options">
                    <label class="option">
                        <input type="radio" name="q3" value="a">
                        <span class="option-text">KEKs are faster to use than master keys for encryption operations</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q3" value="b">
                        <span class="option-text">KEKs eliminate the need for key rotation</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q3" value="c">
                        <span class="option-text">You can rotate KEKs without re-encrypting all data‚Äîjust re-wrap the DEKs</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q3" value="d">
                        <span class="option-text">KEKs provide stronger encryption than master keys</span>
                    </label>
                </div>
                <div class="explanation">
                    <div class="explanation-title">Explanation</div>
                    <div class="explanation-text">
                        The key hierarchy (Master ‚Üí KEK ‚Üí DEK) allows for efficient key rotation. When you rotate a KEK,
                        you only need to re-wrap (re-encrypt) the DEKs with the new KEK. The actual encrypted data doesn't
                        need to be touched. This is much faster than re-encrypting terabytes of data. Additionally, if a
                        DEK is compromised, only data encrypted with that specific DEK is affected‚Äînot all data encrypted
                        with the KEK or master key. This is called "limiting the blast radius."
                    </div>
                </div>
            </div>

            <!-- Question 4 -->
            <div class="quiz-card" data-question="4" data-correct="b">
                <div class="question-header">
                    <div class="question-number">4</div>
                    <div class="question-text">
                        In envelope encryption, what should be stored alongside the encrypted data?
                    </div>
                </div>
                <div class="options">
                    <label class="option">
                        <input type="radio" name="q4" value="a">
                        <span class="option-text">The plaintext Data Encryption Key (DEK)</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q4" value="b">
                        <span class="option-text">The wrapped (encrypted) DEK and KMS key ID</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q4" value="c">
                        <span class="option-text">The master encryption key</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q4" value="d">
                        <span class="option-text">Nothing‚Äîkeys should never be stored with data</span>
                    </label>
                </div>
                <div class="explanation">
                    <div class="explanation-title">Explanation</div>
                    <div class="explanation-text">
                        Envelope encryption stores:<br>
                        1. <strong>Encrypted data</strong> (encrypted with plaintext DEK)<br>
                        2. <strong>Wrapped DEK</strong> (DEK encrypted by KEK/master key)<br>
                        3. <strong>KMS key ID</strong> (reference to which KEK was used)<br><br>
                        To decrypt: Send wrapped DEK to KMS ‚Üí KMS unwraps it using master key ‚Üí Use plaintext DEK to decrypt data ‚Üí
                        Delete plaintext DEK from memory.<br><br>
                        The plaintext DEK is NEVER stored‚Äîonly the wrapped (encrypted) version. The master key never leaves the HSM/KMS.
                    </div>
                </div>
            </div>

            <!-- Question 5 -->
            <div class="quiz-card" data-question="5" data-correct="d">
                <div class="question-header">
                    <div class="question-number">5</div>
                    <div class="question-text">
                        What is the main difference between BYOK (Bring Your Own Key) and HYOK (Hold Your Own Key)?
                    </div>
                </div>
                <div class="options">
                    <label class="option">
                        <input type="radio" name="q5" value="a">
                        <span class="option-text">BYOK is for AWS, HYOK is for Azure</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q5" value="b">
                        <span class="option-text">BYOK uses software keys, HYOK uses hardware keys</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q5" value="c">
                        <span class="option-text">BYOK is for symmetric keys, HYOK is for asymmetric keys</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q5" value="d">
                        <span class="option-text">BYOK imports keys to cloud KMS; HYOK keeps keys on-premises with cloud calling back</span>
                    </label>
                </div>
                <div class="explanation">
                    <div class="explanation-title">Explanation</div>
                    <div class="explanation-text">
                        <strong>BYOK (Bring Your Own Key):</strong> You generate keys in your on-premises HSM, then securely
                        import them into cloud KMS. Keys now reside in cloud but you control the source.<br><br>
                        <strong>HYOK (Hold Your Own Key):</strong> Keys NEVER leave your on-premises infrastructure. Cloud
                        services call back to your key management server for crypto operations. Maximum control but adds
                        latency and operational complexity.<br><br>
                        HYOK is used in highly regulated industries (government, defense, banking) where keys must never
                        leave customer-controlled infrastructure.
                    </div>
                </div>
            </div>

            <!-- Question 6 -->
            <div class="quiz-card" data-question="6" data-correct="a">
                <div class="question-header">
                    <div class="question-number">6</div>
                    <div class="question-text">
                        PCI-DSS requires encryption keys to be rotated at least how frequently?
                    </div>
                </div>
                <div class="options">
                    <label class="option">
                        <input type="radio" name="q6" value="a">
                        <span class="option-text">Annually (every 365 days)</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q6" value="b">
                        <span class="option-text">Quarterly (every 90 days)</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q6" value="c">
                        <span class="option-text">Monthly (every 30 days)</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q6" value="d">
                        <span class="option-text">Only when compromised</span>
                    </label>
                </div>
                <div class="explanation">
                    <div class="explanation-title">Explanation</div>
                    <div class="explanation-text">
                        PCI-DSS Requirement 3.6.4 mandates cryptographic key rotation at least annually (every 365 days).
                        Many organizations rotate more frequently based on data sensitivity:<br>
                        ‚Ä¢ <strong>High-value keys (master keys):</strong> 365 days<br>
                        ‚Ä¢ <strong>Payment KEKs:</strong> 180-365 days<br>
                        ‚Ä¢ <strong>DEKs:</strong> 90-180 days<br>
                        ‚Ä¢ <strong>Emergency rotation:</strong> Immediately upon suspected compromise<br><br>
                        Regular rotation limits the "blast radius" if a key is compromised‚Äîolder data encrypted with
                        previous keys remains protected.
                    </div>
                </div>
            </div>

            <!-- Question 7 -->
            <div class="quiz-card" data-question="7" data-correct="c">
                <div class="question-header">
                    <div class="question-number">7</div>
                    <div class="question-text">
                        Which AWS KMS API call is used to generate a new Data Encryption Key (DEK) for envelope encryption?
                    </div>
                </div>
                <div class="options">
                    <label class="option">
                        <input type="radio" name="q7" value="a">
                        <span class="option-text">CreateKey</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q7" value="b">
                        <span class="option-text">Encrypt</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q7" value="c">
                        <span class="option-text">GenerateDataKey</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q7" value="d">
                        <span class="option-text">GenerateRandom</span>
                    </label>
                </div>
                <div class="explanation">
                    <div class="explanation-title">Explanation</div>
                    <div class="explanation-text">
                        <strong>GenerateDataKey</strong> returns both:<br>
                        1. <strong>Plaintext DEK</strong> (use this to encrypt data locally)<br>
                        2. <strong>Wrapped DEK</strong> (encrypted DEK to store with data)<br><br>
                        Other API calls:<br>
                        ‚Ä¢ <strong>CreateKey:</strong> Creates a new customer master key (CMK) in KMS<br>
                        ‚Ä¢ <strong>Encrypt:</strong> Encrypts small data (< 4KB) directly with CMK<br>
                        ‚Ä¢ <strong>GenerateRandom:</strong> Returns cryptographically secure random bytes (not keys)<br>
                        ‚Ä¢ <strong>Decrypt:</strong> Unwraps an encrypted DEK to get plaintext DEK back
                    </div>
                </div>
            </div>

            <!-- Question 8 -->
            <div class="quiz-card" data-question="8" data-correct="b">
                <div class="question-header">
                    <div class="question-number">8</div>
                    <div class="question-text">
                        In a properly designed access control matrix, which role should NOT have decrypt permissions on encryption keys?
                    </div>
                </div>
                <div class="options">
                    <label class="option">
                        <input type="radio" name="q8" value="a">
                        <span class="option-text">Application services that process encrypted data</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q8" value="b">
                        <span class="option-text">Key administrators who manage key lifecycle</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q8" value="c">
                        <span class="option-text">Backup and restore services</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q8" value="d">
                        <span class="option-text">Analytics services with read-only access</span>
                    </label>
                </div>
                <div class="explanation">
                    <div class="explanation-title">Explanation</div>
                    <div class="explanation-text">
                        <strong>Separation of duties:</strong> Key administrators should manage keys (create, rotate, delete)
                        but NOT use them for encryption/decryption. This prevents a single compromised admin account from
                        both managing keys and accessing all encrypted data.<br><br>
                        Proper access control:<br>
                        ‚Ä¢ <strong>Application services:</strong> Encrypt, Decrypt, GenerateDataKey<br>
                        ‚Ä¢ <strong>Key administrators:</strong> Rotate, ScheduleKeyDeletion, UpdateKeyDescription (NO decrypt)<br>
                        ‚Ä¢ <strong>Backup services:</strong> Decrypt (to restore encrypted data)<br>
                        ‚Ä¢ <strong>Analytics (read-only):</strong> Decrypt only<br>
                        ‚Ä¢ <strong>Delete operations:</strong> Require MFA + manual approval
                    </div>
                </div>
            </div>

            <!-- Question 9 -->
            <div class="quiz-card" data-question="9" data-correct="d">
                <div class="question-header">
                    <div class="question-number">9</div>
                    <div class="question-text">
                        What is the recommended disaster recovery strategy for HSM master keys in a production e-commerce environment?
                    </div>
                </div>
                <div class="options">
                    <label class="option">
                        <input type="radio" name="q9" value="a">
                        <span class="option-text">Export keys to S3 with versioning enabled</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q9" value="b">
                        <span class="option-text">Print keys on paper and store in a safe</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q9" value="c">
                        <span class="option-text">No backup needed‚Äîregenerate keys if HSM fails</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q9" value="d">
                        <span class="option-text">Multi-region HSM replication or Shamir secret sharing (M-of-N) with geographically distributed custodians</span>
                    </label>
                </div>
                <div class="explanation">
                    <div class="explanation-title">Explanation</div>
                    <div class="explanation-text">
                        Best practices for HSM key backup:<br><br>
                        <strong>1. Multi-region HSM replication:</strong> AWS CloudHSM can replicate to backup HSMs in different regions.
                        Automatic failover.<br><br>
                        <strong>2. Shamir Secret Sharing (3-of-5):</strong> Master key split into 5 shares. Any 3 shares can reconstruct
                        the key. Shares held by different executives in different locations. Prevents single-person compromise.<br><br>
                        <strong>3. HSM smartcard backup:</strong> Export wrapped keys to FIPS-certified smartcards. Store in physical
                        safe with M-of-N access control.<br><br>
                        ‚ùå Exporting to S3 defeats the purpose of HSM (keys leave secure boundary)<br>
                        ‚ùå Printing keys is insecure and difficult to restore<br>
                        ‚ùå Not backing up keys means data loss if HSM fails
                    </div>
                </div>
            </div>

            <!-- Question 10 -->
            <div class="quiz-card" data-question="10" data-correct="c">
                <div class="question-header">
                    <div class="question-number">10</div>
                    <div class="question-text">
                        A security audit reveals hardcoded encryption keys in your application's Git repository. What is the FIRST action you should take?
                    </div>
                </div>
                <div class="options">
                    <label class="option">
                        <input type="radio" name="q10" value="a">
                        <span class="option-text">Delete the repository and create a new one</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q10" value="b">
                        <span class="option-text">Remove the keys from the latest commit</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q10" value="c">
                        <span class="option-text">Immediately rotate the compromised keys</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q10" value="d">
                        <span class="option-text">Run BFG Repo-Cleaner to remove keys from git history</span>
                    </label>
                </div>
                <div class="explanation">
                    <div class="explanation-title">Explanation</div>
                    <div class="explanation-text">
                        <strong>Remediation Priority:</strong><br><br>
                        <strong>1. Immediately rotate compromised keys</strong> (stop the bleeding). Assume keys are already compromised.
                        Re-encrypt all affected data with new keys.<br><br>
                        <strong>2. Remove keys from git history</strong> (BFG Repo-Cleaner, git filter-branch). Even after deletion,
                        keys remain in git history forever.<br><br>
                        <strong>3. Scan for forks and pull requests</strong> that may contain the keys. GitHub secret scanning can help.<br><br>
                        <strong>4. Implement proper key management</strong> (AWS Secrets Manager, Azure Key Vault, environment variables)<br><br>
                        <strong>5. Add pre-commit hooks</strong> (git-secrets, truffleHog) to prevent future key commits<br><br>
                        <strong>6. Assess notification requirements</strong> (GDPR, state breach laws if PII/payment data affected)<br><br>
                        Just removing from the latest commit doesn't help‚Äîkeys are still in git history accessible to anyone who clones the repo.
                    </div>
                </div>
            </div>
        </div>

        <!-- Submit Button -->
        <button class="submit-btn" id="submit-btn" onclick="submitQuiz()">Submit Quiz</button>

        <!-- Results -->
        <div class="results" id="results">
            <div class="results-icon">üéâ</div>
            <div class="results-score" id="score-display">0/10</div>
            <div class="results-message" id="results-message"></div>
            <div class="results-breakdown">
                <div class="breakdown-item">
                    <div class="breakdown-value correct" id="correct-count">0</div>
                    <div class="breakdown-label">Correct</div>
                </div>
                <div class="breakdown-item">
                    <div class="breakdown-value incorrect" id="incorrect-count">0</div>
                    <div class="breakdown-label">Incorrect</div>
                </div>
            </div>
            <button class="retry-btn" onclick="retryQuiz()">Retry Quiz</button>
            <button class="retry-btn" onclick="window.location.href='../../../index.html'">Back to Key House</button>
        </div>
    </div>

    <script>
        let quizSubmitted = false;

        function submitQuiz() {
            if (quizSubmitted) return;

            // Check if all questions answered
            const totalQuestions = 10;
            let answeredCount = 0;
            for (let i = 1; i <= totalQuestions; i++) {
                const selected = document.querySelector(`input[name="q${i}"]:checked`);
                if (selected) answeredCount++;
            }

            if (answeredCount < totalQuestions) {
                alert(`Please answer all questions. You've answered ${answeredCount}/${totalQuestions}.`);
                return;
            }

            quizSubmitted = true;
            let correctCount = 0;

            // Grade each question
            for (let i = 1; i <= totalQuestions; i++) {
                const card = document.querySelector(`[data-question="${i}"]`);
                const correctAnswer = card.dataset.correct;
                const selected = document.querySelector(`input[name="q${i}"]:checked`);
                const selectedValue = selected ? selected.value : null;

                card.classList.add('answered');

                // Mark correct/incorrect
                if (selectedValue === correctAnswer) {
                    correctCount++;
                    card.classList.add('correct');
                    selected.closest('.option').classList.add('correct');
                } else {
                    card.classList.add('incorrect');
                    if (selected) {
                        selected.closest('.option').classList.add('incorrect');
                    }
                    // Highlight correct answer
                    const correctOption = card.querySelector(`input[value="${correctAnswer}"]`);
                    if (correctOption) {
                        correctOption.closest('.option').classList.add('correct');
                    }
                }

                // Show explanation
                card.querySelector('.explanation').classList.add('show');
            }

            // Calculate percentage
            const percentage = (correctCount / totalQuestions) * 100;

            // Display results
            document.getElementById('score-display').textContent = `${correctCount}/${totalQuestions}`;
            document.getElementById('correct-count').textContent = correctCount;
            document.getElementById('incorrect-count').textContent = totalQuestions - correctCount;

            let message = '';
            let resultsIcon = 'üéâ';

            if (percentage === 100) {
                message = 'Perfect Score! You\'ve mastered enterprise key management!';
                resultsIcon = 'üëë';
            } else if (percentage >= 80) {
                message = 'Excellent! You have a strong understanding of HSM and key management.';
                resultsIcon = 'üéâ';
            } else if (percentage >= 60) {
                message = 'Good effort! Review the explanations to strengthen your knowledge.';
                resultsIcon = 'üìö';
            } else {
                message = 'Keep learning! Review the presentation and try again.';
                resultsIcon = 'üí™';
            }

            document.getElementById('results-message').textContent = message;
            document.querySelector('.results-icon').textContent = resultsIcon;
            document.getElementById('results').classList.add('show');

            // Disable submit button
            document.getElementById('submit-btn').disabled = true;

            // Scroll to results
            document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'center' });

            // Mark quiz complete and award achievement
            if (typeof ModuleProgress !== 'undefined') {
                ModuleProgress.completeQuiz('key', 'hsm-quiz', percentage);
            }

            if (percentage >= 80 && typeof AchievementManager !== 'undefined') {
                AchievementManager.unlock('hsm_expert');
            }
        }

        function retryQuiz() {
            location.reload();
        }

        // Prevent accidental navigation
        window.addEventListener('beforeunload', (e) => {
            if (!quizSubmitted) {
                const confirmationMessage = 'You haven\'t submitted the quiz yet. Are you sure you want to leave?';
                e.returnValue = confirmationMessage;
                return confirmationMessage;
            }
        });
    </script>
<script src="../../../components/FluxCapacitor.js"></script>
</body>
</html>
