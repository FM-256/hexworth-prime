<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Access Control -->
    <script src="../../../components/AccessGuard.js"></script>
    <script>
        AccessGuard.require('sorted');
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificate Hands-On Lab - House of the Key</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsrsasign/10.8.6/jsrsasign-all-min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --house-color: #06b6d4;
            --house-glow: rgba(6, 182, 212, 0.4);
            --bg-dark: #0a0a12;
            --bg-card: rgba(15, 15, 25, 0.8);
            --text-primary: #e8e8f0;
            --text-secondary: #8888aa;
            --input-bg: rgba(20, 20, 30, 0.8);
            --success-green: #10b981;
            --warning-red: #ef4444;
            --info-blue: #3b82f6;
            --accent-orange: #f59e0b;
        }

        body {
            min-height: 100vh;
            background: var(--bg-dark);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* Header */
        .module-header {
            padding: 20px 30px;
            background: rgba(10, 10, 18, 0.95);
            border-bottom: 1px solid rgba(6, 182, 212, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 1px solid rgba(6, 182, 212, 0.3);
            background: transparent;
            color: var(--house-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 1.2rem;
        }

        .back-btn:hover {
            background: rgba(6, 182, 212, 0.1);
        }

        .module-title {
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .house-badge {
            font-size: 0.7rem;
            padding: 4px 12px;
            background: rgba(6, 182, 212, 0.15);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 20px;
            color: var(--house-color);
            letter-spacing: 0.1em;
        }

        /* Container */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 30px;
        }

        /* Intro */
        .intro {
            text-align: center;
            margin-bottom: 40px;
        }

        .intro-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 20px var(--house-glow));
        }

        .intro-title {
            font-size: 2rem;
            font-weight: 300;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #fff, var(--house-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .intro-subtitle {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Exercise Card */
        .exercise-card {
            background: var(--bg-card);
            border: 2px solid rgba(6, 182, 212, 0.2);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }

        .exercise-card.completed {
            border-color: var(--success-green);
            background: rgba(16, 185, 129, 0.05);
        }

        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .exercise-number {
            background: rgba(6, 182, 212, 0.2);
            color: var(--house-color);
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .exercise-card.completed .exercise-number {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success-green);
        }

        .exercise-status {
            font-size: 1.5rem;
            display: none;
        }

        .exercise-card.completed .exercise-status {
            display: block;
        }

        .exercise-title {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 15px;
        }

        .exercise-description {
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 20px;
        }

        /* Scenario Box */
        .scenario-box {
            background: rgba(59, 130, 246, 0.1);
            border-left: 4px solid var(--info-blue);
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .scenario-title {
            font-weight: 600;
            color: var(--info-blue);
            margin-bottom: 8px;
        }

        .scenario-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Task List */
        .task-list {
            margin: 20px 0;
        }

        .task-item {
            display: flex;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid rgba(6, 182, 212, 0.1);
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--house-color);
            border-radius: 4px;
            cursor: pointer;
            flex-shrink: 0;
            margin-top: 2px;
            position: relative;
        }

        .task-checkbox.checked {
            background: var(--success-green);
            border-color: var(--success-green);
        }

        .task-checkbox.checked::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        .task-text {
            color: var(--text-secondary);
            line-height: 1.6;
            flex: 1;
        }

        /* Code Block */
        .code-block {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            overflow-x: auto;
        }

        .code-block pre {
            color: var(--text-primary);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .code-comment {
            color: #6b7280;
        }

        .code-command {
            color: var(--house-color);
        }

        .code-output {
            color: var(--success-green);
        }

        .code-error {
            color: var(--warning-red);
        }

        /* Input Area */
        .input-area {
            margin: 20px 0;
        }

        .input-label {
            display: block;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .input-field {
            width: 100%;
            background: var(--input-bg);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 8px;
            padding: 15px;
            color: var(--text-primary);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            min-height: 150px;
            resize: vertical;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--house-color);
        }

        /* Button */
        .action-btn {
            padding: 12px 28px;
            background: rgba(6, 182, 212, 0.2);
            border: 1px solid var(--house-color);
            color: var(--house-color);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-top: 10px;
        }

        .action-btn:hover {
            background: rgba(6, 182, 212, 0.3);
            transform: translateY(-2px);
        }

        .action-btn.secondary {
            background: rgba(136, 136, 170, 0.1);
            border-color: var(--text-secondary);
            color: var(--text-secondary);
        }

        .action-btn.secondary:hover {
            background: rgba(136, 136, 170, 0.2);
        }

        /* Feedback */
        .feedback {
            margin-top: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            display: none;
        }

        .feedback.success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--success-green);
            color: var(--success-green);
            display: block;
        }

        .feedback.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--warning-red);
            color: var(--warning-red);
            display: block;
        }

        .feedback.info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid var(--info-blue);
            color: var(--text-secondary);
            display: block;
        }

        /* Hint Box */
        .hint-box {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid var(--accent-orange);
            border-radius: 8px;
            padding: 15px 20px;
            margin: 15px 0;
        }

        .hint-toggle {
            color: var(--accent-orange);
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hint-toggle:hover {
            opacity: 0.8;
        }

        .hint-content {
            display: none;
            margin-top: 10px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .hint-content.visible {
            display: block;
        }

        /* Progress Bar */
        .progress-section {
            background: var(--bg-card);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 40px;
        }

        .progress-title {
            color: var(--house-color);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .progress-bar {
            background: rgba(0, 0, 0, 0.3);
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--house-color), var(--success-green));
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.85rem;
        }

        /* Certificate Display */
        .cert-display {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .cert-field {
            padding: 5px 0;
            display: grid;
            grid-template-columns: 180px 1fr;
            gap: 15px;
        }

        .cert-field-name {
            color: var(--house-color);
            font-weight: 600;
        }

        .cert-field-value {
            color: var(--text-secondary);
            word-break: break-all;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="module-header">
        <div class="header-left">
            <button class="back-btn" onclick="window.location.href='../index.html'">‚Üê</button>
            <div>
                <div class="module-title">Certificate Hands-On Lab</div>
            </div>
        </div>
        <div class="house-badge">HOUSE OF THE KEY</div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Intro -->
        <div class="intro">
            <div class="intro-icon">üî¨</div>
            <h1 class="intro-title">Certificate Operations Lab</h1>
            <p class="intro-subtitle">
                Practice real-world certificate tasks through hands-on exercises
            </p>
        </div>

        <!-- Progress -->
        <div class="progress-section">
            <div class="progress-title">Lab Progress</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar">0%</div>
            </div>
            <div style="color: var(--text-secondary); margin-top: 10px; text-align: center;" id="progressText">
                0 of 8 exercises completed
            </div>
        </div>

        <!-- Exercise 1: Parse and Decode Certificate -->
        <div class="exercise-card" id="exercise1">
            <div class="exercise-header">
                <div class="exercise-number">Exercise 1</div>
                <div class="exercise-status">‚úì</div>
            </div>
            <h2 class="exercise-title">Parse and Decode an X.509 Certificate</h2>
            <p class="exercise-description">
                You've been given a PEM-encoded certificate. Extract and identify key fields to understand
                who it was issued to, who issued it, and when it expires.
            </p>

            <div class="scenario-box">
                <div class="scenario-title">Scenario</div>
                <div class="scenario-content">
                    A developer hands you a certificate file and asks: "Is this still valid? Who issued it?
                    What domains does it cover?" You need to quickly inspect it.
                </div>
            </div>

            <div class="input-area">
                <label class="input-label">Certificate (PEM format):</label>
                <textarea id="ex1Input" class="input-field" readonly>-----BEGIN CERTIFICATE-----
MIIDSzCCAjOgAwIBAgIQfkVkB7JqEaPmXNrKWbJHvDANBgkqhkiG9w0BAQsFADBe
MQswCQYDVQQGEwJVUzEXMBUGA1UEChMOSGV4d29ydGggUHJpbWUxFTATBgNVBAsT
DFRyYWluaW5nIExhYjEfMB0GA1UEAxMWSGV4d29ydGggVHJhaW5pbmcgQ0EwHhcN
MjUwMTAxMDAwMDAwWhcNMjUxMjMxMjM1OTU5WjBZMQswCQYDVQQGEwJVUzEXMBUG
A1UEChMOSGV4d29ydGggUHJpbWUxFTATBgNVBAsTDFRyYWluaW5nIExhYjEaMBgG
A1UEAxMRbGFiLmhleHdvcnRoLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC
AQoCggEBALVqX9h3KqnH8mWJVGKBYqHnFZQHGqJnLPGHqYqP7TvCLqvjKHnJpQqV
YnHqPqJnLVGHKqnH8mWJVGKBYqHnFZQHGqJnLPGHqYqP7TvCLqvjKHnJpQqVYnHq
PqJnLVGHKqnH8mWJVGKBYqHnFZQHGqJnLPGHqYqP7TvCLqvjKHnJpQqVYnHqPqJn
LVGHKqnH8mWJVGKBYqHnFZQHGqJnLPGHqYqP7TvCLqvjKHnJpQqVYnHqPqJnLVGH
KqnH8mWJVGKBYqHnFZQHGqJnLPGHqYqP7TvCLqvjKHnJpQqVYnHqPqJnLVGHKqnH
8mWJVGKBYqHnFZQHGqJnLPGHqYqP7TvCLqvjKHnJpQqVYnHqPqJnLQIDAQABo0Uw
QzAOBgNVHQ8BAf8EBAMCBaAwEwYDVR0lBAwwCgYIKwYBBQUHAwEwHAYDVR0RBBUw
E4IRbGFiLmhleHdvcnRoLmNvbTANBgkqhkiG9w0BAQsFAAOCAQEAXqP7nHqJVGHK
qnH8mWJVGKBYqHnFZQHGqJnLPGHqYqP7TvCLqvjKHnJpQqVYnHqPqJnLVGHKqnH8
mWJVGKBYqHnFZQHGqJnLPGHqYqP7TvCLqvjKHnJpQqVYnHqPqJnLVGHKqnH8mWJV
GKBYqHnFZQHGqJnLPGHqYqP7TvCLqvjKHnJpQqVYnHqPqJnLVGHKqnH8mWJVGKBY
qHnFZQHGqJnLPGHqYqP7TvCLqvjKHnJpQqVYnHqPqJnLVGHKqnH8mWJVGKBY==
-----END CERTIFICATE-----</textarea>
            </div>

            <div class="task-list">
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 1, 1)"></div>
                    <div class="task-text">Identify the Subject (who the certificate was issued to)</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 1, 2)"></div>
                    <div class="task-text">Identify the Issuer (who issued the certificate)</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 1, 3)"></div>
                    <div class="task-text">Check the validity period (Not Before / Not After)</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 1, 4)"></div>
                    <div class="task-text">Determine if the certificate is currently valid</div>
                </div>
            </div>

            <button class="action-btn" onclick="parseCert1()">Parse Certificate</button>
            <button class="action-btn secondary" onclick="showHint(1)">Show Hint</button>

            <div class="hint-box" id="hint1">
                <div class="hint-toggle" onclick="toggleHint(1)">
                    <span>üí°</span> Hint
                </div>
                <div class="hint-content">
                    In the real world, you'd use:<br>
                    <code>openssl x509 -in cert.pem -text -noout</code><br><br>
                    Look for these fields:<br>
                    - <strong>Subject:</strong> The entity this certificate identifies<br>
                    - <strong>Issuer:</strong> The CA that signed this certificate<br>
                    - <strong>Validity:</strong> Not Before and Not After dates<br>
                    Click "Parse Certificate" to see the decoded values.
                </div>
            </div>

            <div id="ex1Output"></div>
        </div>

        <!-- Exercise 2: Validate Certificate Chain -->
        <div class="exercise-card" id="exercise2">
            <div class="exercise-header">
                <div class="exercise-number">Exercise 2</div>
                <div class="exercise-status">‚úì</div>
            </div>
            <h2 class="exercise-title">Validate a Certificate Chain</h2>
            <p class="exercise-description">
                You have three certificates forming a chain. Verify that each certificate is properly
                signed by its parent, forming a valid trust path.
            </p>

            <div class="scenario-box">
                <div class="scenario-title">Scenario</div>
                <div class="scenario-content">
                    A web server is failing TLS handshakes. You suspect the certificate chain is misconfigured.
                    You need to verify the chain links from leaf to root.
                </div>
            </div>

            <div class="task-list">
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 2, 1)"></div>
                    <div class="task-text">Verify the leaf certificate's issuer matches the intermediate's subject</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 2, 2)"></div>
                    <div class="task-text">Verify the intermediate's issuer matches the root's subject</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 2, 3)"></div>
                    <div class="task-text">Confirm the root certificate is self-signed</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 2, 4)"></div>
                    <div class="task-text">Identify any broken links in the chain</div>
                </div>
            </div>

            <button class="action-btn" onclick="validateChain()">Validate Chain</button>
            <button class="action-btn secondary" onclick="showHint(2)">Show Hint</button>

            <div class="hint-box" id="hint2">
                <div class="hint-toggle" onclick="toggleHint(2)">
                    <span>üí°</span> Hint
                </div>
                <div class="hint-content">
                    OpenSSL command for chain verification:<br>
                    <code>openssl verify -CAfile root.crt -untrusted intermediate.crt leaf.crt</code><br><br>
                    Chain validation rules:<br>
                    - Each certificate's Issuer must match the next certificate's Subject<br>
                    - Root certificate is self-signed (Subject = Issuer)<br>
                    - All certificates must be within their validity period
                </div>
            </div>

            <div id="ex2Output"></div>
        </div>

        <!-- Exercise 3: Check Revocation Status -->
        <div class="exercise-card" id="exercise3">
            <div class="exercise-header">
                <div class="exercise-number">Exercise 3</div>
                <div class="exercise-status">‚úì</div>
            </div>
            <h2 class="exercise-title">Check Certificate Revocation Status</h2>
            <p class="exercise-description">
                A certificate might be valid but revoked. Learn how to check revocation status using
                CRL and OCSP methods.
            </p>

            <div class="scenario-box">
                <div class="scenario-title">Scenario</div>
                <div class="scenario-content">
                    Security team suspects a certificate was compromised. Before taking action, you need
                    to verify if it's been revoked by the CA.
                </div>
            </div>

            <div class="code-block">
                <pre><span class="code-comment"># Check OCSP status (real command):</span>
<span class="code-command">openssl ocsp -issuer issuer.crt -cert server.crt \
  -url http://ocsp.example.com -resp_text</span>

<span class="code-comment"># Download and check CRL:</span>
<span class="code-command">wget http://crl.example.com/example.crl
openssl crl -in example.crl -text -noout</span>

<span class="code-comment"># Test with OCSP stapling:</span>
<span class="code-command">openssl s_client -connect example.com:443 -status</span></pre>
            </div>

            <div class="task-list">
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 3, 1)"></div>
                    <div class="task-text">Understand the difference between CRL and OCSP</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 3, 2)"></div>
                    <div class="task-text">Identify which method is more real-time</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 3, 3)"></div>
                    <div class="task-text">Understand OCSP stapling benefits</div>
                </div>
            </div>

            <button class="action-btn" onclick="completeExercise(3)">Mark Complete</button>
            <button class="action-btn secondary" onclick="showHint(3)">Show Explanation</button>

            <div class="hint-box" id="hint3">
                <div class="hint-toggle" onclick="toggleHint(3)">
                    <span>üí°</span> Explanation
                </div>
                <div class="hint-content">
                    <strong>CRL (Certificate Revocation List):</strong><br>
                    - Large file containing all revoked certificate serial numbers<br>
                    - Downloaded periodically (stale data risk)<br>
                    - Works offline once cached<br>
                    - Privacy-preserving (no live queries)<br><br>

                    <strong>OCSP (Online Certificate Status Protocol):</strong><br>
                    - Real-time query for specific certificate status<br>
                    - Returns: good, revoked, or unknown<br>
                    - Privacy issue: CA knows which sites you visit<br>
                    - Adds latency to connections<br><br>

                    <strong>OCSP Stapling:</strong><br>
                    - Server queries OCSP for its own cert<br>
                    - Staples signed response to TLS handshake<br>
                    - Client verifies without contacting CA<br>
                    - Best of both worlds: real-time + privacy
                </div>
            </div>

            <div id="ex3Output"></div>
        </div>

        <!-- Exercise 4: Generate a CSR -->
        <div class="exercise-card" id="exercise4">
            <div class="exercise-header">
                <div class="exercise-number">Exercise 4</div>
                <div class="exercise-status">‚úì</div>
            </div>
            <h2 class="exercise-title">Generate a Certificate Signing Request</h2>
            <p class="exercise-description">
                Create a CSR with proper subject fields and extensions for submitting to a Certificate Authority.
            </p>

            <div class="scenario-box">
                <div class="scenario-title">Scenario</div>
                <div class="scenario-content">
                    You're deploying a new web application at api.hexworth.com. Generate a CSR to submit
                    to your CA for certificate issuance. Include SAN for both api.hexworth.com and *.api.hexworth.com.
                </div>
            </div>

            <div class="code-block">
                <pre><span class="code-comment"># Generate private key and CSR (RSA):</span>
<span class="code-command">openssl req -new -newkey rsa:2048 -nodes \
  -keyout api.hexworth.com.key \
  -out api.hexworth.com.csr \
  -subj "/C=US/ST=California/L=San Francisco/O=Hexworth Prime/CN=api.hexworth.com"</span>

<span class="code-comment"># Better: ECDSA P-256 (faster, smaller):</span>
<span class="code-command">openssl ecparam -genkey -name prime256v1 -out api.hexworth.com.key
openssl req -new -key api.hexworth.com.key \
  -out api.hexworth.com.csr \
  -subj "/C=US/ST=California/L=San Francisco/O=Hexworth Prime/CN=api.hexworth.com" \
  -addext "subjectAltName = DNS:api.hexworth.com,DNS:*.api.hexworth.com"</span>

<span class="code-comment"># Verify CSR contents:</span>
<span class="code-command">openssl req -in api.hexworth.com.csr -text -noout</span></pre>
            </div>

            <div class="task-list">
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 4, 1)"></div>
                    <div class="task-text">Generate private key (keep this secure!)</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 4, 2)"></div>
                    <div class="task-text">Create CSR with correct Subject DN</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 4, 3)"></div>
                    <div class="task-text">Include Subject Alternative Names extension</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 4, 4)"></div>
                    <div class="task-text">Verify CSR before submitting to CA</div>
                </div>
            </div>

            <button class="action-btn" onclick="completeExercise(4)">Mark Complete</button>
            <button class="action-btn secondary" onclick="showHint(4)">Show Best Practices</button>

            <div class="hint-box" id="hint4">
                <div class="hint-toggle" onclick="toggleHint(4)">
                    <span>üí°</span> CSR Best Practices
                </div>
                <div class="hint-content">
                    <strong>Key Algorithm Choice:</strong><br>
                    - RSA 2048: Widely compatible, slower<br>
                    - RSA 4096: More secure, even slower (overkill for most)<br>
                    - ECDSA P-256: Fast, small, modern (recommended)<br>
                    - ECDSA P-384: Extra paranoia for top-secret stuff<br><br>

                    <strong>Subject DN Fields:</strong><br>
                    - CN (Common Name): Primary domain - DEPRECATED, use SAN<br>
                    - SAN: Required by modern browsers<br>
                    - O (Organization): Required for OV/EV certs<br>
                    - C (Country): 2-letter code (US, GB, etc.)<br><br>

                    <strong>Security:</strong><br>
                    - Never share private key with anyone, including CA<br>
                    - CSR can be public (only contains public key)<br>
                    - Use -nodes flag with caution (unencrypted key)
                </div>
            </div>

            <div id="ex4Output"></div>
        </div>

        <!-- Exercise 5: Identify Certificate Issues -->
        <div class="exercise-card" id="exercise5">
            <div class="exercise-header">
                <div class="exercise-number">Exercise 5</div>
                <div class="exercise-status">‚úì</div>
            </div>
            <h2 class="exercise-title">Troubleshoot Certificate Problems</h2>
            <p class="exercise-description">
                Diagnose common certificate errors and determine the root cause and fix.
            </p>

            <div class="scenario-box">
                <div class="scenario-title">Scenario</div>
                <div class="scenario-content">
                    Users report they can't access https://shop.example.com. Browser shows:
                    "NET::ERR_CERT_COMMON_NAME_INVALID". What's wrong and how do you fix it?
                </div>
            </div>

            <div class="task-list">
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 5, 1)"></div>
                    <div class="task-text">Identify the error: Hostname mismatch</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 5, 2)"></div>
                    <div class="task-text">Likely cause: Certificate issued for different domain</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 5, 3)"></div>
                    <div class="task-text">Check certificate's CN and SAN fields</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 5, 4)"></div>
                    <div class="task-text">Solution: Issue new cert with shop.example.com in SAN</div>
                </div>
            </div>

            <div class="code-block">
                <pre><span class="code-comment"># Check what domain the certificate is for:</span>
<span class="code-command">echo | openssl s_client -connect shop.example.com:443 -servername shop.example.com 2>/dev/null | \
  openssl x509 -noout -text | grep -A1 "Subject Alternative Name"</span>

<span class="code-output">X509v3 Subject Alternative Name:
    DNS:www.example.com, DNS:example.com</span>

<span class="code-comment"># Problem: Certificate is for www.example.com and example.com,
# but NOT for shop.example.com!</span>

<span class="code-comment"># Solutions:
# 1. Add shop.example.com to SAN and reissue
# 2. Use wildcard cert: *.example.com
# 3. Use SAN cert covering all subdomains</span></pre>
            </div>

            <button class="action-btn" onclick="checkError()">Diagnose Error</button>
            <button class="action-btn secondary" onclick="showHint(5)">Show Common Errors</button>

            <div class="hint-box" id="hint5">
                <div class="hint-toggle" onclick="toggleHint(5)">
                    <span>üí°</span> Common Certificate Errors
                </div>
                <div class="hint-content">
                    <strong>ERR_CERT_DATE_INVALID:</strong> Certificate expired or not yet valid<br>
                    ‚Üí Check system clock, renew certificate<br><br>

                    <strong>ERR_CERT_COMMON_NAME_INVALID:</strong> Hostname mismatch<br>
                    ‚Üí Reissue with correct SAN, use wildcard, or fix server config<br><br>

                    <strong>ERR_CERT_AUTHORITY_INVALID:</strong> Untrusted CA or broken chain<br>
                    ‚Üí Include intermediate certs, verify chain order<br><br>

                    <strong>ERR_CERT_REVOKED:</strong> Certificate has been revoked<br>
                    ‚Üí Issue new certificate (old key compromised)<br><br>

                    <strong>ERR_CERT_WEAK_SIGNATURE_ALGORITHM:</strong> Using SHA-1 or MD5<br>
                    ‚Üí Reissue with SHA-256 or stronger
                </div>
            </div>

            <div id="ex5Output"></div>
        </div>

        <!-- Exercise 6: Configure Web Server Certificate -->
        <div class="exercise-card" id="exercise6">
            <div class="exercise-header">
                <div class="exercise-number">Exercise 6</div>
                <div class="exercise-status">‚úì</div>
            </div>
            <h2 class="exercise-title">Configure Certificate for Web Server</h2>
            <p class="exercise-description">
                Install a certificate on a web server (Nginx or Apache) with proper configuration.
            </p>

            <div class="scenario-box">
                <div class="scenario-title">Scenario</div>
                <div class="scenario-content">
                    You've received a certificate from Let's Encrypt. Configure your Nginx server to use
                    it with TLS 1.2+, strong ciphers, and OCSP stapling.
                </div>
            </div>

            <div class="code-block">
                <pre><span class="code-comment"># Nginx configuration (secure HTTPS):</span>
<span class="code-command">server {
    listen 443 ssl http2;
    server_name example.com www.example.com;

    <span class="code-comment"># Certificate files</span>
    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;
    ssl_trusted_certificate /etc/letsencrypt/live/example.com/chain.pem;

    <span class="code-comment"># TLS protocols (disable old versions)</span>
    ssl_protocols TLSv1.2 TLSv1.3;

    <span class="code-comment"># Cipher suites (strong only)</span>
    ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384';
    ssl_prefer_server_ciphers off;

    <span class="code-comment"># OCSP stapling</span>
    ssl_stapling on;
    ssl_stapling_verify on;
    resolver 8.8.8.8 8.8.4.4 valid=300s;

    <span class="code-comment"># Security headers</span>
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

    <span class="code-comment"># Your application</span>
    location / {
        proxy_pass http://localhost:3000;
    }
}</span></pre>
            </div>

            <div class="task-list">
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 6, 1)"></div>
                    <div class="task-text">Point to correct certificate files (fullchain.pem, not cert.pem!)</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 6, 2)"></div>
                    <div class="task-text">Disable TLS 1.0 and 1.1 (only use TLS 1.2+)</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 6, 3)"></div>
                    <div class="task-text">Enable OCSP stapling for better performance</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 6, 4)"></div>
                    <div class="task-text">Add HSTS header for security</div>
                </div>
            </div>

            <button class="action-btn" onclick="completeExercise(6)">Mark Complete</button>
            <button class="action-btn secondary" onclick="showHint(6)">Show Apache Config</button>

            <div class="hint-box" id="hint6">
                <div class="hint-toggle" onclick="toggleHint(6)">
                    <span>üí°</span> Apache Configuration
                </div>
                <div class="hint-content">
                    <strong>Apache VirtualHost:</strong>
                    <pre>&lt;VirtualHost *:443&gt;
    ServerName example.com
    ServerAlias www.example.com

    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/example.com/cert.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/example.com/privkey.pem
    SSLCertificateChainFile /etc/letsencrypt/live/example.com/chain.pem

    SSLProtocol -all +TLSv1.2 +TLSv1.3
    SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256
    SSLHonorCipherOrder off

    SSLUseStapling on
    SSLStaplingCache "shmcb:ssl_stapling(32768)"

    Header always set Strict-Transport-Security "max-age=31536000"
&lt;/VirtualHost&gt;</pre>

                    <strong>Common Mistake:</strong> Using <code>cert.pem</code> instead of <code>fullchain.pem</code>
                    causes "ERR_CERT_AUTHORITY_INVALID" because intermediate cert is missing!
                </div>
            </div>

            <div id="ex6Output"></div>
        </div>

        <!-- Exercise 7: Implement Certificate Pinning (Conceptual) -->
        <div class="exercise-card" id="exercise7">
            <div class="exercise-header">
                <div class="exercise-number">Exercise 7</div>
                <div class="exercise-status">‚úì</div>
            </div>
            <h2 class="exercise-title">Understand Certificate Pinning</h2>
            <p class="exercise-description">
                Learn how certificate pinning works and when to use it in mobile applications.
            </p>

            <div class="scenario-box">
                <div class="scenario-title">Scenario</div>
                <div class="scenario-content">
                    You're developing a mobile banking app. Security team wants to implement certificate
                    pinning to prevent MITM attacks even if a CA is compromised.
                </div>
            </div>

            <div class="code-block">
                <pre><span class="code-comment"># Generate public key hash for pinning:</span>
<span class="code-command">openssl x509 -in server.crt -pubkey -noout | \
  openssl pkey -pubin -outform der | \
  openssl dgst -sha256 -binary | \
  base64</span>

<span class="code-output">n5Z9hPQh8bZ4m9tMFqKjLQZhR7P9VqkW3jNHx8cT1aQ=</span>

<span class="code-comment"># Android implementation:</span>
<span class="code-command">CertificatePinner pinner = new CertificatePinner.Builder()
    .add("api.hexworth.com", "sha256/n5Z9hPQh8bZ4m9tMFqKjLQZhR7P9VqkW3jNHx8cT1aQ=")
    .add("api.hexworth.com", "sha256/BACKUP_KEY_HASH_HERE=")  // Always pin backup!
    .build();

OkHttpClient client = new OkHttpClient.Builder()
    .certificatePinner(pinner)
    .build();</span>

<span class="code-comment"># iOS implementation:</span>
<span class="code-command">let publicKeyHash = "n5Z9hPQh8bZ4m9tMFqKjLQZhR7P9VqkW3jNHx8cT1aQ="
// Implement in URLSession delegate...</span></pre>
            </div>

            <div class="task-list">
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 7, 1)"></div>
                    <div class="task-text">Understand pinning defends against compromised CAs</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 7, 2)"></div>
                    <div class="task-text">Always pin backup key (to avoid bricking app)</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 7, 3)"></div>
                    <div class="task-text">Understand the risk: wrong pin = app breaks</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 7, 4)"></div>
                    <div class="task-text">Know when NOT to pin (frequent cert rotation)</div>
                </div>
            </div>

            <button class="action-btn" onclick="completeExercise(7)">Mark Complete</button>
            <button class="action-btn secondary" onclick="showHint(7)">Show Pinning Strategy</button>

            <div class="hint-box" id="hint7">
                <div class="hint-toggle" onclick="toggleHint(7)">
                    <span>üí°</span> Pinning Strategy
                </div>
                <div class="hint-content">
                    <strong>What to Pin:</strong><br>
                    - Leaf certificate: Changes every 90 days (Let's Encrypt), high maintenance<br>
                    - Intermediate CA: Better, changes every few years<br>
                    - Public key: Best, survives certificate renewal with same key<br>
                    - Root CA: Too broad, defeats purpose<br><br>

                    <strong>Best Practices:</strong><br>
                    1. Always pin at least 2 keys (production + backup)<br>
                    2. Monitor CT logs for your domain<br>
                    3. Have key rotation plan BEFORE deploying app<br>
                    4. Consider report-only mode first<br>
                    5. Include certificate expiry reminder in app<br><br>

                    <strong>When NOT to pin:</strong><br>
                    - Short-lived certificates (Let's Encrypt)<br>
                    - Shared hosting / CDN (you don't control certs)<br>
                    - Websites (use Certificate Transparency instead)<br>
                    - Internal apps where you control CA
                </div>
            </div>

            <div id="ex7Output"></div>
        </div>

        <!-- Exercise 8: Troubleshoot TLS Connection Failure -->
        <div class="exercise-card" id="exercise8">
            <div class="exercise-header">
                <div class="exercise-number">Exercise 8</div>
                <div class="exercise-status">‚úì</div>
            </div>
            <h2 class="exercise-title">Troubleshoot TLS Connection Failure</h2>
            <p class="exercise-description">
                Systematically diagnose and fix a TLS handshake failure using OpenSSL debugging tools.
            </p>

            <div class="scenario-box">
                <div class="scenario-title">Scenario</div>
                <div class="scenario-content">
                    A legacy system can't connect to your new web server. Modern browsers work fine.
                    Error: "SSL_ERROR_NO_CYPHER_OVERLAP". Diagnose and fix.
                </div>
            </div>

            <div class="code-block">
                <pre><span class="code-comment"># Test TLS connection with detailed output:</span>
<span class="code-command">openssl s_client -connect example.com:443 -servername example.com</span>

<span class="code-error">SSL_ERROR_NO_CYPHER_OVERLAP
no peer certificate available
No client certificate CA names sent</span>

<span class="code-comment"># Test specific TLS version:</span>
<span class="code-command">openssl s_client -connect example.com:443 -tls1</span>
<span class="code-error">error:1409442E:SSL routines:ssl3_read_bytes:tlsv1 alert protocol version</span>

<span class="code-comment"># Server only supports TLS 1.2+, client trying TLS 1.0!</span>

<span class="code-comment"># Test with TLS 1.2:</span>
<span class="code-command">openssl s_client -connect example.com:443 -tls1_2</span>
<span class="code-output">Cipher    : ECDHE-RSA-AES128-GCM-SHA256
SSL-Session:
    Protocol  : TLSv1.2
    Cipher    : ECDHE-RSA-AES128-GCM-SHA256
Verify return code: 0 (ok)</span>

<span class="code-comment"># Solution: Upgrade legacy client or enable TLS 1.0 (not recommended!)</span></pre>
            </div>

            <div class="task-list">
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 8, 1)"></div>
                    <div class="task-text">Test connection with OpenSSL s_client</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 8, 2)"></div>
                    <div class="task-text">Identify TLS version mismatch</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 8, 3)"></div>
                    <div class="task-text">Check cipher suite compatibility</div>
                </div>
                <div class="task-item">
                    <div class="task-checkbox" onclick="toggleTask(this, 8, 4)"></div>
                    <div class="task-text">Recommend solution (upgrade client vs. downgrade server)</div>
                </div>
            </div>

            <button class="action-btn" onclick="completeExercise(8)">Mark Complete</button>
            <button class="action-btn secondary" onclick="showHint(8)">Show Debug Commands</button>

            <div class="hint-box" id="hint8">
                <div class="hint-toggle" onclick="toggleHint(8)">
                    <span>üí°</span> TLS Debugging Toolkit
                </div>
                <div class="hint-content">
                    <strong>Essential OpenSSL Commands:</strong><br><br>

                    Test connection:<br>
                    <code>openssl s_client -connect host:443 -servername host</code><br><br>

                    Test specific TLS version:<br>
                    <code>openssl s_client -connect host:443 -tls1_2</code><br><br>

                    Show server certificate:<br>
                    <code>openssl s_client -connect host:443 -showcerts</code><br><br>

                    Check OCSP stapling:<br>
                    <code>openssl s_client -connect host:443 -status</code><br><br>

                    Enumerate cipher suites:<br>
                    <code>nmap --script ssl-enum-ciphers -p 443 host</code><br><br>

                    Test with specific cipher:<br>
                    <code>openssl s_client -connect host:443 -cipher ECDHE-RSA-AES128-GCM-SHA256</code>
                </div>
            </div>

            <div id="ex8Output"></div>
        </div>
    </div>

    <script>
        // Exercise state tracking
        const exerciseState = {
            1: { completed: false, tasks: [false, false, false, false] },
            2: { completed: false, tasks: [false, false, false, false] },
            3: { completed: false, tasks: [false, false, false] },
            4: { completed: false, tasks: [false, false, false, false] },
            5: { completed: false, tasks: [false, false, false, false] },
            6: { completed: false, tasks: [false, false, false, false] },
            7: { completed: false, tasks: [false, false, false, false] },
            8: { completed: false, tasks: [false, false, false, false] }
        };

        // Toggle task completion
        function toggleTask(element, exerciseNum, taskNum) {
            element.classList.toggle('checked');
            exerciseState[exerciseNum].tasks[taskNum - 1] = element.classList.contains('checked');

            // Check if all tasks completed
            const allCompleted = exerciseState[exerciseNum].tasks.every(t => t === true);
            if (allCompleted && !exerciseState[exerciseNum].completed) {
                completeExercise(exerciseNum);
            }
        }

        // Toggle hint visibility
        function toggleHint(num) {
            const content = document.querySelector(`#hint${num} .hint-content`);
            content.classList.toggle('visible');
        }

        function showHint(num) {
            const content = document.querySelector(`#hint${num} .hint-content`);
            content.classList.add('visible');
        }

        // Complete exercise
        function completeExercise(num) {
            if (!exerciseState[num].completed) {
                exerciseState[num].completed = true;
                document.getElementById(`exercise${num}`).classList.add('completed');
                updateProgress();
            }
        }

        // Update progress bar
        function updateProgress() {
            const completed = Object.values(exerciseState).filter(e => e.completed).length;
            const total = Object.keys(exerciseState).length;
            const percentage = Math.round((completed / total) * 100);

            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');

            progressBar.style.width = percentage + '%';
            progressBar.textContent = percentage + '%';
            progressText.textContent = `${completed} of ${total} exercises completed`;

            if (completed === total) {
                progressText.innerHTML = `<strong style="color: var(--success-green);">üéâ All exercises completed! You've mastered certificate operations!</strong>`;
            }
        }

        // Exercise 1: Parse certificate
        function parseCert1() {
            const output = document.getElementById('ex1Output');

            const certInfo = {
                subject: 'CN=lab.hexworth.com, OU=Training Lab, O=Hexworth Prime, C=US',
                issuer: 'CN=Hexworth Training CA, OU=Training Lab, O=Hexworth Prime, C=US',
                notBefore: '2025-01-01 00:00:00 UTC',
                notAfter: '2025-12-31 23:59:59 UTC',
                valid: true
            };

            let html = '<div class="feedback success">';
            html += '<strong>‚úì Certificate Parsed Successfully</strong>';
            html += '</div>';

            html += '<div class="cert-display">';
            html += '<div class="cert-field">';
            html += '<div class="cert-field-name">Subject:</div>';
            html += `<div class="cert-field-value">${certInfo.subject}</div>`;
            html += '</div>';
            html += '<div class="cert-field">';
            html += '<div class="cert-field-name">Issuer:</div>';
            html += `<div class="cert-field-value">${certInfo.issuer}</div>`;
            html += '</div>';
            html += '<div class="cert-field">';
            html += '<div class="cert-field-name">Not Before:</div>';
            html += `<div class="cert-field-value">${certInfo.notBefore}</div>`;
            html += '</div>';
            html += '<div class="cert-field">';
            html += '<div class="cert-field-name">Not After:</div>';
            html += `<div class="cert-field-value">${certInfo.notAfter}</div>`;
            html += '</div>';
            html += '<div class="cert-field">';
            html += '<div class="cert-field-name">Status:</div>';
            html += `<div class="cert-field-value" style="color: var(--success-green);">‚úì Currently Valid</div>`;
            html += '</div>';
            html += '</div>';

            html += '<div class="feedback info" style="margin-top: 20px;">';
            html += '<strong>Analysis:</strong><br>';
            html += '‚Ä¢ This is a leaf certificate (identifies a server)<br>';
            html += '‚Ä¢ Issued by Hexworth Training CA<br>';
            html += '‚Ä¢ Valid for the entire year of 2025<br>';
            html += '‚Ä¢ Common Name: lab.hexworth.com';
            html += '</div>';

            output.innerHTML = html;

            // Auto-complete tasks
            const checkboxes = document.querySelectorAll('#exercise1 .task-checkbox');
            checkboxes.forEach((cb, idx) => {
                if (!cb.classList.contains('checked')) {
                    cb.classList.add('checked');
                    exerciseState[1].tasks[idx] = true;
                }
            });

            completeExercise(1);
        }

        // Exercise 2: Validate chain
        function validateChain() {
            const output = document.getElementById('ex2Output');

            let html = '<div class="feedback success">';
            html += '<strong>‚úì Certificate Chain Validated</strong>';
            html += '</div>';

            html += '<div class="cert-display">';
            html += '<div style="color: var(--house-color); font-weight: 600; margin-bottom: 15px;">Chain Structure:</div>';

            html += '<div style="margin-bottom: 15px;">';
            html += '<div style="color: var(--text-primary); font-weight: 600;">üåê Leaf Certificate</div>';
            html += '<div style="color: var(--text-secondary); font-size: 0.85rem;">Subject: CN=lab.hexworth.com</div>';
            html += '<div style="color: var(--text-secondary); font-size: 0.85rem;">Issuer: CN=Hexworth Training CA</div>';
            html += '<div style="color: var(--success-green); font-size: 0.85rem;">‚úì Issuer matches next certificate</div>';
            html += '</div>';

            html += '<div style="margin: 15px 0; text-align: center; color: var(--house-color);">‚Üì</div>';

            html += '<div style="margin-bottom: 15px;">';
            html += '<div style="color: var(--text-primary); font-weight: 600;">üîó Intermediate CA</div>';
            html += '<div style="color: var(--text-secondary); font-size: 0.85rem;">Subject: CN=Hexworth Training CA</div>';
            html += '<div style="color: var(--text-secondary); font-size: 0.85rem;">Issuer: CN=Hexworth Root CA</div>';
            html += '<div style="color: var(--success-green); font-size: 0.85rem;">‚úì Issuer matches next certificate</div>';
            html += '</div>';

            html += '<div style="margin: 15px 0; text-align: center; color: var(--house-color);">‚Üì</div>';

            html += '<div>';
            html += '<div style="color: var(--text-primary); font-weight: 600;">üèõÔ∏è Root CA</div>';
            html += '<div style="color: var(--text-secondary); font-size: 0.85rem;">Subject: CN=Hexworth Root CA</div>';
            html += '<div style="color: var(--text-secondary); font-size: 0.85rem;">Issuer: CN=Hexworth Root CA</div>';
            html += '<div style="color: var(--success-green); font-size: 0.85rem;">‚úì Self-signed (Subject = Issuer)</div>';
            html += '</div>';

            html += '</div>';

            html += '<div class="feedback info" style="margin-top: 20px;">';
            html += '<strong>Verification Result:</strong><br>';
            html += '‚úì All signatures valid<br>';
            html += '‚úì Chain links properly (each Issuer matches next Subject)<br>';
            html += '‚úì Root certificate is self-signed<br>';
            html += '‚úì Trust path established from leaf to root';
            html += '</div>';

            output.innerHTML = html;

            // Auto-complete tasks
            const checkboxes = document.querySelectorAll('#exercise2 .task-checkbox');
            checkboxes.forEach((cb, idx) => {
                if (!cb.classList.contains('checked')) {
                    cb.classList.add('checked');
                    exerciseState[2].tasks[idx] = true;
                }
            });

            completeExercise(2);
        }

        // Exercise 5: Check error
        function checkError() {
            const output = document.getElementById('ex5Output');

            let html = '<div class="feedback error">';
            html += '<strong>‚ö† Error Identified: NET::ERR_CERT_COMMON_NAME_INVALID</strong>';
            html += '</div>';

            html += '<div class="cert-display">';
            html += '<div style="color: var(--warning-red); font-weight: 600; margin-bottom: 15px;">Problem Diagnosis:</div>';

            html += '<div class="cert-field">';
            html += '<div class="cert-field-name">Requested URL:</div>';
            html += '<div class="cert-field-value">https://shop.example.com</div>';
            html += '</div>';

            html += '<div class="cert-field">';
            html += '<div class="cert-field-name">Certificate CN:</div>';
            html += '<div class="cert-field-value">www.example.com</div>';
            html += '</div>';

            html += '<div class="cert-field">';
            html += '<div class="cert-field-name">Certificate SAN:</div>';
            html += '<div class="cert-field-value">DNS:www.example.com, DNS:example.com</div>';
            html += '</div>';

            html += '<div class="cert-field">';
            html += '<div class="cert-field-name">Match Status:</div>';
            html += '<div class="cert-field-value" style="color: var(--warning-red);">‚úó shop.example.com NOT in SAN</div>';
            html += '</div>';

            html += '</div>';

            html += '<div class="feedback info" style="margin-top: 20px;">';
            html += '<strong>Root Cause:</strong> Certificate does not include shop.example.com in Subject Alternative Names<br><br>';
            html += '<strong>Solutions:</strong><br>';
            html += '1. Reissue certificate with shop.example.com in SAN<br>';
            html += '2. Use wildcard certificate (*.example.com)<br>';
            html += '3. Use multi-domain SAN certificate covering all subdomains<br><br>';
            html += '<strong>Prevention:</strong> Always list all domains in SAN when requesting certificate';
            html += '</div>';

            output.innerHTML = html;

            // Auto-complete tasks
            const checkboxes = document.querySelectorAll('#exercise5 .task-checkbox');
            checkboxes.forEach((cb, idx) => {
                if (!cb.classList.contains('checked')) {
                    cb.classList.add('checked');
                    exerciseState[5].tasks[idx] = true;
                }
            });

            completeExercise(5);
        }

        // Initialize
        updateProgress();
    </script>
<script src="../../../components/FluxCapacitor.js"></script>
</body>
</html>
