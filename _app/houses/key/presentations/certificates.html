<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Access Control -->
    <script src="../../../../components/AccessGuard.js"></script>
    <script>
        AccessGuard.require('sorted');
    </script>
    <!-- Achievement & Progress Integration -->
    <script src="../../../../components/AchievementManager.js"></script>
    <script src="../../../../components/ModuleProgress.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X.509 Certificates & PKI Deep Dive - House of the Key</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --house-color: #06b6d4;
            --house-glow: rgba(6, 182, 212, 0.4);
            --bg-dark: #0a0a12;
            --bg-card: rgba(15, 15, 25, 0.8);
            --text-primary: #e8e8f0;
            --text-secondary: #8888aa;
            --accent-cyan: #06b6d4;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-orange: #f59e0b;
        }

        body {
            min-height: 100vh;
            background: var(--bg-dark);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* Header */
        .module-header {
            padding: 20px 30px;
            background: rgba(10, 10, 18, 0.95);
            border-bottom: 1px solid rgba(6, 182, 212, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 1px solid rgba(6, 182, 212, 0.3);
            background: transparent;
            color: var(--house-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 1.2rem;
        }

        .back-btn:hover {
            background: rgba(6, 182, 212, 0.1);
        }

        .module-title {
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .house-badge {
            font-size: 0.7rem;
            padding: 4px 12px;
            background: rgba(6, 182, 212, 0.15);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 20px;
            color: var(--house-color);
            letter-spacing: 0.1em;
        }

        /* Main Content */
        .module-content {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 30px;
        }

        .intro-section {
            text-align: center;
            margin-bottom: 50px;
        }

        .intro-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 20px var(--house-glow));
        }

        .intro-title {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #fff, var(--house-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .intro-subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            line-height: 1.6;
        }

        /* Section */
        .section {
            margin-bottom: 50px;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 400;
            margin-bottom: 20px;
            color: var(--house-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-icon {
            font-size: 1.5rem;
        }

        .section-content {
            background: var(--bg-card);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: 12px;
            padding: 30px;
        }

        .subsection {
            margin-bottom: 30px;
        }

        .subsection:last-child {
            margin-bottom: 0;
        }

        .subsection-title {
            font-size: 1.3rem;
            font-weight: 500;
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .content-text {
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 15px;
        }

        /* Certificate Structure Visual */
        .cert-structure {
            background: rgba(6, 182, 212, 0.05);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .cert-field {
            display: flex;
            padding: 8px 0;
            border-bottom: 1px solid rgba(6, 182, 212, 0.1);
        }

        .cert-field:last-child {
            border-bottom: none;
        }

        .field-name {
            color: var(--accent-cyan);
            font-weight: 600;
            min-width: 200px;
        }

        .field-value {
            color: var(--text-secondary);
            flex: 1;
        }

        /* Info Box */
        .info-box {
            background: rgba(59, 130, 246, 0.1);
            border-left: 4px solid var(--accent-blue);
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .info-box-title {
            font-weight: 600;
            color: var(--accent-blue);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-box-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Warning Box */
        .warning-box {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid var(--accent-red);
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .warning-box-title {
            font-weight: 600;
            color: var(--accent-red);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Success Box */
        .success-box {
            background: rgba(16, 185, 129, 0.1);
            border-left: 4px solid var(--accent-green);
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .success-box-title {
            font-weight: 600;
            color: var(--accent-green);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Certificate Chain Visual */
        .chain-visual {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .chain-cert {
            background: var(--bg-card);
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 8px;
            padding: 20px;
            position: relative;
        }

        .chain-cert::after {
            content: '‚Üì';
            position: absolute;
            bottom: -22px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--accent-cyan);
            font-size: 1.5rem;
        }

        .chain-cert:last-child::after {
            display: none;
        }

        .chain-cert-title {
            font-weight: 600;
            color: var(--house-color);
            margin-bottom: 8px;
        }

        .chain-cert-info {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* List Styles */
        .feature-list {
            list-style: none;
            margin: 15px 0;
        }

        .feature-list li {
            padding: 8px 0 8px 30px;
            position: relative;
            color: var(--text-secondary);
        }

        .feature-list li::before {
            content: '‚ñ∏';
            position: absolute;
            left: 10px;
            color: var(--house-color);
        }

        /* Table Styles */
        .cert-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .cert-table th {
            background: rgba(6, 182, 212, 0.1);
            color: var(--house-color);
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid rgba(6, 182, 212, 0.3);
        }

        .cert-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(6, 182, 212, 0.1);
            color: var(--text-secondary);
        }

        .cert-table tr:hover {
            background: rgba(6, 182, 212, 0.05);
        }

        /* Code Block */
        .code-block {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .code-block pre {
            color: var(--text-secondary);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .code-comment {
            color: #6b7280;
        }

        .code-command {
            color: var(--accent-cyan);
        }

        .code-output {
            color: var(--accent-green);
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 40px;
            margin: 30px 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: rgba(6, 182, 212, 0.3);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 30px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -34px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--house-color);
            border: 3px solid var(--bg-dark);
        }

        .timeline-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .timeline-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Interactive Elements */
        .interactive-demo {
            background: rgba(6, 182, 212, 0.05);
            border: 2px dashed rgba(6, 182, 212, 0.3);
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            text-align: center;
        }

        .demo-title {
            font-size: 1.2rem;
            color: var(--house-color);
            margin-bottom: 15px;
        }

        .demo-btn {
            background: rgba(6, 182, 212, 0.2);
            border: 1px solid var(--house-color);
            color: var(--house-color);
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .demo-btn:hover {
            background: rgba(6, 182, 212, 0.3);
            transform: translateY(-2px);
        }

        .demo-output {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        /* Comparison Grid */
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .comparison-card {
            background: var(--bg-card);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: 8px;
            padding: 20px;
        }

        .comparison-card-title {
            font-weight: 600;
            color: var(--house-color);
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .comparison-card-content {
            color: var(--text-secondary);
            line-height: 1.6;
            font-size: 0.95rem;
        }

        /* Completion Section */
        .completion-section {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.1), rgba(6, 182, 212, 0.05));
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin-top: 50px;
        }

        .complete-btn {
            background: var(--house-color);
            color: var(--bg-dark);
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .complete-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px var(--house-glow);
        }

        .complete-btn:disabled {
            background: rgba(6, 182, 212, 0.3);
            cursor: not-allowed;
            transform: none;
        }

        /* Incident Box */
        .incident-box {
            background: rgba(239, 68, 68, 0.08);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .incident-title {
            font-weight: 600;
            color: var(--accent-red);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .incident-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="module-header">
        <div class="header-left">
            <button class="back-btn" onclick="window.location.href='../index.html'">‚Üê</button>
            <div>
                <div class="module-title">X.509 Certificates & PKI Deep Dive</div>
            </div>
        </div>
        <div class="house-badge">HOUSE OF THE KEY</div>
    </header>

    <!-- Main Content -->
    <main class="module-content">
        <!-- Introduction -->
        <section class="intro-section">
            <div class="intro-icon">üîê</div>
            <h1 class="intro-title">X.509 Certificates & PKI</h1>
            <p class="intro-subtitle">
                Understanding the trust infrastructure that secures the modern internet
            </p>
        </section>

        <!-- Section 1: Why Certificates Matter -->
        <section class="section">
            <h2 class="section-title">
                <span class="section-icon">üéØ</span>
                Why Certificates Matter
            </h2>
            <div class="section-content">
                <div class="subsection">
                    <p class="content-text">
                        Every time you visit an HTTPS website, check your email, or connect to a VPN,
                        digital certificates are working behind the scenes to establish trust. But what
                        exactly are they solving?
                    </p>

                    <div class="info-box">
                        <div class="info-box-title">
                            <span>üí°</span> The Trust Problem
                        </div>
                        <div class="info-box-content">
                            When you connect to a server, how do you know it's really who it claims to be?
                            Without certificates, anyone could impersonate a website, intercept your traffic,
                            or launch a man-in-the-middle attack. Certificates solve this by binding a
                            cryptographic identity to a real-world entity.
                        </div>
                    </div>

                    <h3 class="subsection-title">Certificates Provide Three Core Guarantees</h3>
                    <ul class="feature-list">
                        <li><strong>Authentication:</strong> Proves the identity of a server, person, or organization</li>
                        <li><strong>Integrity:</strong> Ensures data hasn't been tampered with during transmission</li>
                        <li><strong>Confidentiality:</strong> Enables encrypted communication channels (via public key exchange)</li>
                    </ul>

                    <div class="success-box">
                        <div class="success-box-title">
                            <span>‚úì</span> Real-World Impact
                        </div>
                        <div class="info-box-content">
                            Without PKI, e-commerce would be impossible, online banking would be a joke,
                            and secure government communications wouldn't exist. The green padlock in your
                            browser represents billions of dollars of infrastructure ensuring your connection is legitimate.
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: X.509 Certificate Structure -->
        <section class="section">
            <h2 class="section-title">
                <span class="section-icon">üìã</span>
                X.509 Certificate Structure
            </h2>
            <div class="section-content">
                <div class="subsection">
                    <p class="content-text">
                        X.509 is the standard format for public key certificates. Think of it as a
                        passport for the digital world - it contains identifying information and is
                        cryptographically signed by a trusted authority.
                    </p>

                    <h3 class="subsection-title">Certificate Anatomy</h3>
                    <div class="cert-structure">
                        <div class="cert-field">
                            <div class="field-name">Version</div>
                            <div class="field-value">v3 (most common, supports extensions)</div>
                        </div>
                        <div class="cert-field">
                            <div class="field-name">Serial Number</div>
                            <div class="field-value">Unique identifier within CA's system</div>
                        </div>
                        <div class="cert-field">
                            <div class="field-name">Signature Algorithm</div>
                            <div class="field-value">sha256WithRSAEncryption, ecdsa-with-SHA256, etc.</div>
                        </div>
                        <div class="cert-field">
                            <div class="field-name">Issuer DN</div>
                            <div class="field-value">Who issued this certificate (CA identity)</div>
                        </div>
                        <div class="cert-field">
                            <div class="field-name">Validity Period</div>
                            <div class="field-value">Not Before / Not After timestamps</div>
                        </div>
                        <div class="cert-field">
                            <div class="field-name">Subject DN</div>
                            <div class="field-value">Who this certificate identifies</div>
                        </div>
                        <div class="cert-field">
                            <div class="field-name">Public Key Info</div>
                            <div class="field-value">Algorithm + public key data</div>
                        </div>
                        <div class="cert-field">
                            <div class="field-name">Extensions (v3)</div>
                            <div class="field-value">Key Usage, SAN, Basic Constraints, etc.</div>
                        </div>
                        <div class="cert-field">
                            <div class="field-name">Signature</div>
                            <div class="field-value">CA's digital signature over all above fields</div>
                        </div>
                    </div>

                    <h3 class="subsection-title">Distinguished Names (DN)</h3>
                    <p class="content-text">
                        The Issuer and Subject fields use Distinguished Names, a hierarchical naming structure:
                    </p>
                    <div class="code-block">
                        <pre>Subject: CN=www.example.com, O=Example Corp, L=San Francisco, ST=California, C=US

Breakdown:
  CN = Common Name (the primary identifier)
  O  = Organization
  OU = Organizational Unit (optional)
  L  = Locality (city)
  ST = State/Province
  C  = Country (2-letter code)</pre>
                    </div>

                    <h3 class="subsection-title">Critical Extensions Explained</h3>

                    <div class="info-box">
                        <div class="info-box-title">
                            <span>üîë</span> Key Usage
                        </div>
                        <div class="info-box-content">
                            Specifies what cryptographic operations this key can be used for:
                            <ul class="feature-list">
                                <li><strong>digitalSignature:</strong> For signing data (TLS handshake, code signing)</li>
                                <li><strong>keyEncipherment:</strong> For encrypting keys (RSA key transport)</li>
                                <li><strong>keyAgreement:</strong> For key exchange (ECDH)</li>
                                <li><strong>keyCertSign:</strong> For signing other certificates (CA only)</li>
                                <li><strong>cRLSign:</strong> For signing certificate revocation lists</li>
                            </ul>
                        </div>
                    </div>

                    <div class="info-box">
                        <div class="info-box-title">
                            <span>üåê</span> Subject Alternative Name (SAN)
                        </div>
                        <div class="info-box-content">
                            Modern certificates use SAN instead of CN for domain names. Allows multiple
                            identities in one certificate:
                            <div class="code-block">
                                <pre>X509v3 Subject Alternative Name:
    DNS:example.com
    DNS:www.example.com
    DNS:api.example.com
    IP:192.0.2.1</pre>
                            </div>
                            This single certificate works for all listed domains and IPs.
                        </div>
                    </div>

                    <div class="info-box">
                        <div class="info-box-title">
                            <span>üèóÔ∏è</span> Basic Constraints
                        </div>
                        <div class="info-box-content">
                            Indicates whether this certificate is a CA certificate or an end-entity certificate:
                            <div class="code-block">
                                <pre><span class="code-comment"># For a CA certificate:</span>
X509v3 Basic Constraints: critical
    CA:TRUE, pathlen:0

<span class="code-comment"># For an end-entity (leaf) certificate:</span>
X509v3 Basic Constraints: critical
    CA:FALSE</pre>
                            </div>
                            The <code>pathlen</code> parameter limits how deep the certificate chain can go.
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: Certificate Types -->
        <section class="section">
            <h2 class="section-title">
                <span class="section-icon">üìÇ</span>
                Certificate Types
            </h2>
            <div class="section-content">
                <div class="subsection">
                    <h3 class="subsection-title">Validation Levels</h3>
                    <div class="comparison-grid">
                        <div class="comparison-card">
                            <div class="comparison-card-title">DV (Domain Validated)</div>
                            <div class="comparison-card-content">
                                <strong>Validation:</strong> Only proves you control the domain (via email, DNS, or HTTP challenge)<br><br>
                                <strong>Issuance Time:</strong> Minutes<br>
                                <strong>Cost:</strong> Free to $50/year<br>
                                <strong>Use Cases:</strong> Blogs, personal sites, internal tools<br>
                                <strong>Example:</strong> Let's Encrypt certificates
                            </div>
                        </div>
                        <div class="comparison-card">
                            <div class="comparison-card-title">OV (Organization Validated)</div>
                            <div class="comparison-card-content">
                                <strong>Validation:</strong> Verifies organization identity through business registries and phone calls<br><br>
                                <strong>Issuance Time:</strong> 1-3 days<br>
                                <strong>Cost:</strong> $40-$150/year<br>
                                <strong>Use Cases:</strong> Corporate websites, SaaS platforms<br>
                                <strong>Display:</strong> Organization name in certificate details
                            </div>
                        </div>
                        <div class="comparison-card">
                            <div class="comparison-card-title">EV (Extended Validation)</div>
                            <div class="comparison-card-content">
                                <strong>Validation:</strong> Rigorous vetting including legal existence, physical address, operational status<br><br>
                                <strong>Issuance Time:</strong> 1-2 weeks<br>
                                <strong>Cost:</strong> $150-$300/year<br>
                                <strong>Use Cases:</strong> Banks, e-commerce, high-security sites<br>
                                <strong>Note:</strong> Green bar removed by browsers in 2019
                            </div>
                        </div>
                    </div>

                    <h3 class="subsection-title">Scope-Based Types</h3>
                    <table class="cert-table">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Coverage</th>
                                <th>Example</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Single Domain</strong></td>
                                <td>One FQDN only</td>
                                <td>www.example.com</td>
                                <td>Doesn't cover example.com (no www)</td>
                            </tr>
                            <tr>
                                <td><strong>Wildcard</strong></td>
                                <td>All subdomains (one level)</td>
                                <td>*.example.com</td>
                                <td>Covers api.example.com but not sub.api.example.com</td>
                            </tr>
                            <tr>
                                <td><strong>Multi-Domain (SAN)</strong></td>
                                <td>Multiple specific domains</td>
                                <td>example.com, example.net, example.org</td>
                                <td>Can mix domains, subdomains, and IPs</td>
                            </tr>
                            <tr>
                                <td><strong>Self-Signed</strong></td>
                                <td>Any (but untrusted)</td>
                                <td>Internal testing</td>
                                <td>Subject = Issuer, not trusted by browsers</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="warning-box">
                        <div class="warning-box-title">
                            <span>‚ö†Ô∏è</span> Wildcard Certificate Limitation
                        </div>
                        <div class="info-box-content">
                            A certificate for <code>*.example.com</code> will match <code>api.example.com</code>
                            and <code>cdn.example.com</code>, but NOT <code>example.com</code> (apex domain) or
                            <code>www.api.example.com</code> (nested subdomain). Plan your certificate strategy accordingly!
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: Certificate Chain Validation -->
        <section class="section">
            <h2 class="section-title">
                <span class="section-icon">üîó</span>
                Certificate Chain Validation
            </h2>
            <div class="section-content">
                <div class="subsection">
                    <p class="content-text">
                        Trust isn't instantaneous - it's built through a chain of verification. When your
                        browser connects to an HTTPS site, it performs a complex validation process.
                    </p>

                    <h3 class="subsection-title">The Trust Hierarchy</h3>
                    <div class="chain-visual">
                        <div class="chain-cert">
                            <div class="chain-cert-title">üèõÔ∏è Root CA Certificate</div>
                            <div class="chain-cert-info">
                                Self-signed, lives in browser/OS trust store<br>
                                Example: DigiCert Global Root CA<br>
                                Validity: 20-30 years, kept offline for security
                            </div>
                        </div>
                        <div class="chain-cert">
                            <div class="chain-cert-title">üîó Intermediate CA Certificate</div>
                            <div class="chain-cert-info">
                                Signed by Root CA, does the actual signing<br>
                                Example: DigiCert SHA2 Secure Server CA<br>
                                Validity: 5-10 years, can be revoked if compromised
                            </div>
                        </div>
                        <div class="chain-cert">
                            <div class="chain-cert-title">üåê Leaf (End-Entity) Certificate</div>
                            <div class="chain-cert-info">
                                Signed by Intermediate CA, identifies the server<br>
                                Example: www.example.com<br>
                                Validity: 90 days (Let's Encrypt) to 398 days (maximum allowed)
                            </div>
                        </div>
                    </div>

                    <h3 class="subsection-title">Validation Steps (What Your Browser Does)</h3>
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-title">1. Signature Verification</div>
                            <div class="timeline-content">
                                Verify each certificate's signature using the issuer's public key.
                                If signature is invalid, the chain is broken.
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-title">2. Validity Period Check</div>
                            <div class="timeline-content">
                                Ensure current time is between NotBefore and NotAfter timestamps.
                                Expired or not-yet-valid certificates are rejected.
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-title">3. Revocation Status</div>
                            <div class="timeline-content">
                                Check if certificate has been revoked (via CRL or OCSP).
                                Revoked certificates are immediately untrusted.
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-title">4. Hostname Verification</div>
                            <div class="timeline-content">
                                Match requested domain against CN or SAN fields.
                                Mismatch triggers "NET::ERR_CERT_COMMON_NAME_INVALID" error.
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-title">5. Trust Anchor Check</div>
                            <div class="timeline-content">
                                Walk up the chain until finding a root CA in the system trust store.
                                If no trusted root is found, connection fails.
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-title">6. Extension Validation</div>
                            <div class="timeline-content">
                                Verify critical extensions (Key Usage, Basic Constraints).
                                Ensure leaf certificate isn't marked as CA.
                            </div>
                        </div>
                    </div>

                    <div class="code-block">
                        <pre><span class="code-comment"># Manually verify certificate chain with OpenSSL:</span>
<span class="code-command">openssl s_client -connect example.com:443 -showcerts</span>

<span class="code-comment"># Verify specific certificate against CA bundle:</span>
<span class="code-command">openssl verify -CAfile ca-bundle.crt server.crt</span>

<span class="code-output">server.crt: OK</span>

<span class="code-comment"># Check certificate expiration:</span>
<span class="code-command">openssl x509 -in server.crt -noout -enddate</span>
<span class="code-output">notAfter=Dec 25 23:59:59 2025 GMT</span></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 5: Certificate Revocation -->
        <section class="section">
            <h2 class="section-title">
                <span class="section-icon">üö´</span>
                Certificate Revocation
            </h2>
            <div class="section-content">
                <div class="subsection">
                    <p class="content-text">
                        What happens when a certificate is compromised before it expires? Private key stolen,
                        employee leaves company, or CA discovers it was mis-issued? Revocation mechanisms
                        allow certificates to be invalidated immediately.
                    </p>

                    <h3 class="subsection-title">CRL (Certificate Revocation Lists)</h3>
                    <div class="info-box">
                        <div class="info-box-title">
                            <span>üìú</span> How CRLs Work
                        </div>
                        <div class="info-box-content">
                            CAs publish signed lists of revoked certificate serial numbers. Clients download
                            and cache these lists periodically.
                            <div class="code-block">
                                <pre><span class="code-comment"># Download and inspect a CRL:</span>
<span class="code-command">wget http://crl.example.com/example.crl</span>
<span class="code-command">openssl crl -in example.crl -text -noout</span>

<span class="code-output">Certificate Revocation List (CRL):
    Version 2 (0x1)
    Signature Algorithm: sha256WithRSAEncryption
    Issuer: /CN=Example CA
    Last Update: Dec 20 00:00:00 2025 GMT
    Next Update: Dec 21 00:00:00 2025 GMT
Revoked Certificates:
    Serial Number: 1A2B3C4D5E6F
        Revocation Date: Dec 19 15:30:00 2025 GMT
    Serial Number: FEDCBA987654
        Revocation Date: Dec 18 10:15:00 2025 GMT</span></pre>
                            </div>
                            <strong>Pros:</strong> Simple, works offline once downloaded<br>
                            <strong>Cons:</strong> Large file sizes, privacy concerns (reveals all revoked certs),
                            stale data between updates
                        </div>
                    </div>

                    <h3 class="subsection-title">OCSP (Online Certificate Status Protocol)</h3>
                    <div class="info-box">
                        <div class="info-box-title">
                            <span>üîç</span> How OCSP Works
                        </div>
                        <div class="info-box-content">
                            Real-time revocation checking. Client sends certificate serial number to OCSP
                            responder, gets back "good", "revoked", or "unknown" status.
                            <div class="code-block">
                                <pre><span class="code-comment"># Check certificate status via OCSP:</span>
<span class="code-command">openssl ocsp -issuer issuer.crt -cert server.crt \
    -url http://ocsp.example.com -resp_text</span>

<span class="code-output">Response:
    Certificate Status: good
    This Update: Dec 20 12:00:00 2025 GMT
    Next Update: Dec 21 12:00:00 2025 GMT</span></pre>
                            </div>
                            <strong>Pros:</strong> Real-time status, smaller responses, individual certificate queries<br>
                            <strong>Cons:</strong> Privacy leak (CA knows which sites you visit), adds latency,
                            requires internet connection
                        </div>
                    </div>

                    <h3 class="subsection-title">OCSP Stapling</h3>
                    <div class="success-box">
                        <div class="success-box-title">
                            <span>‚úì</span> The Elegant Solution
                        </div>
                        <div class="info-box-content">
                            Server queries OCSP for its own certificate, caches the signed response, and
                            "staples" it to the TLS handshake. Client verifies the stapled response without
                            contacting the CA.
                            <ul class="feature-list">
                                <li><strong>Privacy:</strong> CA doesn't see client connections</li>
                                <li><strong>Performance:</strong> No additional client request needed</li>
                                <li><strong>Reliability:</strong> Works even if OCSP responder is down</li>
                                <li><strong>Caching:</strong> Server handles OCSP query, not client</li>
                            </ul>
                            Configuration example:
                            <div class="code-block">
                                <pre><span class="code-comment"># Nginx configuration:</span>
ssl_stapling on;
ssl_stapling_verify on;
ssl_trusted_certificate /path/to/ca-bundle.crt;

<span class="code-comment"># Apache configuration:</span>
SSLUseStapling on
SSLStaplingCache "shmcb:ssl_stapling(32768)"</pre>
                            </div>
                        </div>
                    </div>

                    <h3 class="subsection-title">Modern Alternatives</h3>
                    <div class="comparison-grid">
                        <div class="comparison-card">
                            <div class="comparison-card-title">CRLite (Mozilla)</div>
                            <div class="comparison-card-content">
                                Space-efficient data structure bundled with Firefox. Contains all revoked
                                certificates in a compact bloom filter. Updated daily, checked locally.
                                <strong>Status:</strong> Deployed in Firefox since 2020.
                            </div>
                        </div>
                        <div class="comparison-card">
                            <div class="comparison-card-title">Short-Lived Certificates</div>
                            <div class="comparison-card-content">
                                Issue certificates with very short validity (1-7 days). Revocation becomes
                                unnecessary - just wait for expiration. Requires automated renewal.
                                <strong>Example:</strong> Let's Encrypt 90-day validity.
                            </div>
                        </div>
                        <div class="comparison-card">
                            <div class="comparison-card-title">OCSP Must-Staple</div>
                            <div class="comparison-card-content">
                                Certificate extension requiring server to provide OCSP response. If missing,
                                client rejects connection. Prevents downgrade attacks when OCSP is unavailable.
                                <strong>Adoption:</strong> Low (breaks if OCSP responder fails).
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 6: Certificate Transparency -->
        <section class="section">
            <h2 class="section-title">
                <span class="section-icon">üî¨</span>
                Certificate Transparency
            </h2>
            <div class="section-content">
                <div class="subsection">
                    <p class="content-text">
                        Certificate Transparency (CT) is a framework for publicly logging all issued certificates.
                        It solves the problem of rogue or mis-issued certificates going undetected.
                    </p>

                    <div class="info-box">
                        <div class="info-box-title">
                            <span>üìù</span> Why CT Exists
                        </div>
                        <div class="info-box-content">
                            Before CT, a compromised CA could silently issue fraudulent certificates.
                            Domain owners had no way to know if unauthorized certificates were issued for their domains.
                            CT makes all certificates public, enabling detection and accountability.
                        </div>
                    </div>

                    <h3 class="subsection-title">How CT Works</h3>
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-title">1. Certificate Issuance</div>
                            <div class="timeline-content">
                                CA issues a certificate and submits it to multiple CT logs (append-only, cryptographically assured databases).
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-title">2. Log Returns SCT</div>
                            <div class="timeline-content">
                                CT log returns a Signed Certificate Timestamp (SCT), a promise that the certificate will be logged within 24 hours.
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-title">3. SCT Delivered to Client</div>
                            <div class="timeline-content">
                                SCT can be embedded in the certificate, provided via TLS extension, or stapled with OCSP response.
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-title">4. Browser Verification</div>
                            <div class="timeline-content">
                                Browser requires valid SCTs from multiple logs. If missing, certificate is rejected (Chrome since 2018).
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-title">5. Monitoring</div>
                            <div class="timeline-content">
                                Domain owners monitor CT logs for unauthorized certificates using tools like crt.sh or Facebook's CT monitoring.
                            </div>
                        </div>
                    </div>

                    <div class="interactive-demo">
                        <div class="demo-title">Try It: Search CT Logs</div>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">
                            Enter a domain to see all publicly logged certificates:
                        </p>
                        <input type="text" id="ctDomain" placeholder="example.com"
                            style="padding: 10px; width: 300px; background: rgba(0,0,0,0.3); border: 1px solid var(--house-color);
                            border-radius: 6px; color: var(--text-primary); margin-right: 10px;">
                        <button class="demo-btn" onclick="searchCTLogs()">Search Logs</button>
                        <div id="ctOutput" class="demo-output"></div>
                    </div>

                    <div class="success-box">
                        <div class="success-box-title">
                            <span>‚úì</span> Real-World Impact
                        </div>
                        <div class="info-box-content">
                            CT has detected numerous mis-issuances including:
                            <ul class="feature-list">
                                <li>Symantec issuing 30,000+ certificates without proper validation (2015-2017)</li>
                                <li>Let's Encrypt accidentally issuing duplicate certificates</li>
                                <li>Phishing campaigns immediately visible when attackers obtain certificates</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 7: Common Certificate Issues -->
        <section class="section">
            <h2 class="section-title">
                <span class="section-icon">‚ö†Ô∏è</span>
                Common Certificate Issues
            </h2>
            <div class="section-content">
                <div class="subsection">
                    <table class="cert-table">
                        <thead>
                            <tr>
                                <th>Error</th>
                                <th>Cause</th>
                                <th>Solution</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>NET::ERR_CERT_DATE_INVALID</strong></td>
                                <td>Certificate expired or not yet valid</td>
                                <td>Renew certificate, check system clock, verify NotBefore/NotAfter dates</td>
                            </tr>
                            <tr>
                                <td><strong>NET::ERR_CERT_COMMON_NAME_INVALID</strong></td>
                                <td>Hostname doesn't match certificate CN/SAN</td>
                                <td>Issue certificate with correct SAN, use wildcard cert, or update server config</td>
                            </tr>
                            <tr>
                                <td><strong>NET::ERR_CERT_AUTHORITY_INVALID</strong></td>
                                <td>Untrusted root CA or incomplete chain</td>
                                <td>Include intermediate certificates, add root CA to trust store, fix chain order</td>
                            </tr>
                            <tr>
                                <td><strong>NET::ERR_CERT_REVOKED</strong></td>
                                <td>Certificate has been revoked</td>
                                <td>Issue new certificate with new private key (old key likely compromised)</td>
                            </tr>
                            <tr>
                                <td><strong>NET::ERR_CERT_WEAK_SIGNATURE_ALGORITHM</strong></td>
                                <td>Using SHA-1 or MD5</td>
                                <td>Reissue certificate with SHA-256 or stronger</td>
                            </tr>
                            <tr>
                                <td><strong>SSL_ERROR_NO_CYPHER_OVERLAP</strong></td>
                                <td>No common cipher suites between client/server</td>
                                <td>Update TLS configuration, enable modern ciphers, disable SSLv3/TLS 1.0</td>
                            </tr>
                            <tr>
                                <td><strong>ERR_SSL_VERSION_OR_CIPHER_MISMATCH</strong></td>
                                <td>Outdated TLS version or weak ciphers</td>
                                <td>Enable TLS 1.2+, disable deprecated ciphers (3DES, RC4, export ciphers)</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3 class="subsection-title">Debugging Certificate Problems</h3>
                    <div class="code-block">
                        <pre><span class="code-comment"># View certificate details in browser:</span>
1. Click the padlock icon in address bar
2. Click "Certificate" or "Connection is secure"
3. Review issuer, validity, SAN fields

<span class="code-comment"># Test TLS connection and certificate chain:</span>
<span class="code-command">openssl s_client -connect example.com:443 -servername example.com</span>

<span class="code-comment"># Verify certificate matches private key:</span>
<span class="code-command">openssl x509 -noout -modulus -in server.crt | openssl md5
openssl rsa -noout -modulus -in server.key | openssl md5</span>
<span class="code-output"># If hashes match, certificate and key are a pair</span>

<span class="code-comment"># Check what cipher suites are available:</span>
<span class="code-command">nmap --script ssl-enum-ciphers -p 443 example.com</span>

<span class="code-comment"># Test specific TLS version:</span>
<span class="code-command">openssl s_client -connect example.com:443 -tls1_2</span></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 8: Let's Encrypt and ACME -->
        <section class="section">
            <h2 class="section-title">
                <span class="section-icon">ü§ñ</span>
                Let's Encrypt & ACME Protocol
            </h2>
            <div class="section-content">
                <div class="subsection">
                    <p class="content-text">
                        Let's Encrypt revolutionized PKI by offering free, automated certificates.
                        It uses the ACME (Automatic Certificate Management Environment) protocol to
                        handle the entire certificate lifecycle without human intervention.
                    </p>

                    <h3 class="subsection-title">ACME Challenge Types</h3>
                    <div class="comparison-grid">
                        <div class="comparison-card">
                            <div class="comparison-card-title">HTTP-01 Challenge</div>
                            <div class="comparison-card-content">
                                <strong>Method:</strong> Place specific file at http://domain/.well-known/acme-challenge/<br><br>
                                <strong>Pros:</strong> Simple, works with any HTTP server<br>
                                <strong>Cons:</strong> Requires port 80, can't issue wildcard certs<br>
                                <strong>Use Case:</strong> Standard web servers
                            </div>
                        </div>
                        <div class="comparison-card">
                            <div class="comparison-card-title">DNS-01 Challenge</div>
                            <div class="comparison-card-content">
                                <strong>Method:</strong> Create TXT record at _acme-challenge.domain<br><br>
                                <strong>Pros:</strong> Supports wildcards, no HTTP server needed<br>
                                <strong>Cons:</strong> Requires DNS API access, slower propagation<br>
                                <strong>Use Case:</strong> Wildcard certs, internal servers
                            </div>
                        </div>
                        <div class="comparison-card">
                            <div class="comparison-card-title">TLS-ALPN-01 Challenge</div>
                            <div class="comparison-card-content">
                                <strong>Method:</strong> Present challenge via TLS handshake on port 443<br><br>
                                <strong>Pros:</strong> Works when port 80 blocked, no extra infrastructure<br>
                                <strong>Cons:</strong> Requires TLS-capable server<br>
                                <strong>Use Case:</strong> Restricted environments
                            </div>
                        </div>
                    </div>

                    <h3 class="subsection-title">Certbot Usage</h3>
                    <div class="code-block">
                        <pre><span class="code-comment"># Install Certbot (Ubuntu/Debian):</span>
<span class="code-command">sudo apt install certbot python3-certbot-nginx</span>

<span class="code-comment"># Obtain certificate (automatic Nginx configuration):</span>
<span class="code-command">sudo certbot --nginx -d example.com -d www.example.com</span>

<span class="code-comment"># Obtain certificate only (manual configuration):</span>
<span class="code-command">sudo certbot certonly --webroot -w /var/www/html -d example.com</span>

<span class="code-comment"># Wildcard certificate (requires DNS challenge):</span>
<span class="code-command">sudo certbot certonly --manual --preferred-challenges dns \
    -d example.com -d *.example.com</span>

<span class="code-comment"># Test renewal (dry run):</span>
<span class="code-command">sudo certbot renew --dry-run</span>

<span class="code-comment"># Auto-renewal is configured via systemd timer:</span>
<span class="code-command">systemctl status certbot.timer</span>
<span class="code-output">‚óè certbot.timer - Run certbot twice daily
   Loaded: loaded
   Active: active (waiting)</span></pre>
                    </div>

                    <div class="info-box">
                        <div class="info-box-title">
                            <span>üí°</span> Let's Encrypt Rate Limits
                        </div>
                        <div class="info-box-content">
                            <ul class="feature-list">
                                <li><strong>Certificates per Registered Domain:</strong> 50 per week</li>
                                <li><strong>Duplicate Certificate:</strong> 5 per week (same exact set of domains)</li>
                                <li><strong>Failed Validations:</strong> 5 per hour per account per hostname</li>
                                <li><strong>New Orders:</strong> 300 per 3 hours per account</li>
                            </ul>
                            Use staging environment for testing: <code>--test-cert</code> flag
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 9: Certificate Pinning -->
        <section class="section">
            <h2 class="section-title">
                <span class="section-icon">üìå</span>
                Certificate Pinning
            </h2>
            <div class="section-content">
                <div class="subsection">
                    <p class="content-text">
                        Certificate pinning is a security technique where applications enforce that only
                        specific certificates or public keys are trusted for a domain, regardless of what
                        the system trust store says.
                    </p>

                    <h3 class="subsection-title">Why Pin Certificates?</h3>
                    <div class="info-box">
                        <div class="info-box-title">
                            <span>üéØ</span> The Threat Model
                        </div>
                        <div class="info-box-content">
                            Standard PKI trusts any certificate signed by any CA in the trust store (~100+ CAs).
                            If any CA is compromised or compelled by a government, they could issue fraudulent
                            certificates for your domain. Pinning prevents this by:
                            <ul class="feature-list">
                                <li>Trusting only your specific certificate or public key</li>
                                <li>Detecting CA compromise or MITM attacks</li>
                                <li>Providing defense-in-depth against CA failures</li>
                            </ul>
                        </div>
                    </div>

                    <h3 class="subsection-title">HPKP (Deprecated)</h3>
                    <div class="warning-box">
                        <div class="warning-box-title">
                            <span>‚ö†Ô∏è</span> HTTP Public Key Pinning (HPKP) - Discontinued
                        </div>
                        <div class="info-box-content">
                            HPKP allowed websites to tell browsers "only trust these public key hashes for my domain."
                            Removed from browsers in 2018 due to:
                            <ul class="feature-list">
                                <li><strong>Bricking risk:</strong> Misconfiguration could permanently lock users out</li>
                                <li><strong>Hostile pinning:</strong> Attackers could pin their own keys</li>
                                <li><strong>Operational complexity:</strong> Difficult to manage key rotation</li>
                            </ul>
                            Example header (no longer supported):
                            <div class="code-block">
                                <pre>Public-Key-Pins:
    pin-sha256="base64-encoded-key-hash-1";
    pin-sha256="base64-encoded-backup-key-hash";
    max-age=5184000; includeSubDomains</pre>
                            </div>
                        </div>
                    </div>

                    <h3 class="subsection-title">Modern Pinning Approaches</h3>
                    <div class="comparison-grid">
                        <div class="comparison-card">
                            <div class="comparison-card-title">Mobile App Pinning</div>
                            <div class="comparison-card-content">
                                Hardcode expected certificate or public key hash in app code.
                                Network libraries verify on each connection.
                                <div class="code-block">
                                    <pre><span class="code-comment">// Android example:</span>
CertificatePinner pinner =
  new CertificatePinner.Builder()
    .add("api.example.com",
      "sha256/AAAA...")
    .build();</pre>
                                </div>
                                <strong>Risk:</strong> Must update app to change pins
                            </div>
                        </div>
                        <div class="comparison-card">
                            <div class="comparison-card-title">Certificate Transparency Enforcement</div>
                            <div class="comparison-card-content">
                                Require certificates to be logged in CT. Browsers reject certs without valid SCTs.
                                Provides visibility without the bricking risk of HPKP.
                                <strong>Status:</strong> Mandatory in Chrome since 2018, Safari since 2021
                            </div>
                        </div>
                        <div class="comparison-card">
                            <div class="comparison-card-title">Expect-CT Header</div>
                            <div class="comparison-card-content">
                                Report or enforce CT compliance via HTTP header.
                                <div class="code-block">
                                    <pre>Expect-CT: max-age=86400,
  enforce,
  report-uri="https://..."</pre>
                                </div>
                                <strong>Note:</strong> Being phased out as CT is now mandatory
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 10: Real-World Incidents -->
        <section class="section">
            <h2 class="section-title">
                <span class="section-icon">üö®</span>
                Real-World PKI Failures
            </h2>
            <div class="section-content">
                <div class="subsection">
                    <p class="content-text">
                        Learning from failures is critical. Here are three major PKI incidents that shaped
                        modern certificate security.
                    </p>

                    <div class="incident-box">
                        <div class="incident-title">DigiNotar Breach (2011)</div>
                        <div class="incident-content">
                            <strong>What Happened:</strong> Dutch CA DigiNotar was compromised. Attackers issued
                            fraudulent certificates for google.com, CIA, Mossad, and other high-value targets.<br><br>

                            <strong>Impact:</strong> Used for MITM attacks against Iranian dissidents. Government
                            intercepted Gmail, Facebook, and other services.<br><br>

                            <strong>Response:</strong> DigiNotar declared bankruptcy. All major browsers removed
                            their root certificate. ~300,000 Dutch government smartcards became useless overnight.<br><br>

                            <strong>Lessons Learned:</strong>
                            <ul class="feature-list">
                                <li>Single compromised CA can break trust for entire ecosystem</li>
                                <li>Need for certificate transparency to detect mis-issuance</li>
                                <li>Importance of rapid revocation mechanisms</li>
                            </ul>
                        </div>
                    </div>

                    <div class="incident-box">
                        <div class="incident-title">Symantec Distrust (2017-2018)</div>
                        <div class="incident-content">
                            <strong>What Happened:</strong> Google discovered Symantec (one of the largest CAs)
                            had issued 30,000+ certificates without proper validation. Included test certificates
                            for google.com and opera.com.<br><br>

                            <strong>Impact:</strong> Chrome progressively distrusted all Symantec certificates
                            (including Thawte, VeriSign, GeoTrust, RapidSSL brands). Affected ~30% of HTTPS websites.<br><br>

                            <strong>Response:</strong> Symantec sold certificate business to DigiCert. All
                            Symantec-issued certificates had to be replaced.<br><br>

                            <strong>Lessons Learned:</strong>
                            <ul class="feature-list">
                                <li>Validation shortcuts have massive consequences</li>
                                <li>Browser vendors will aggressively distrust unreliable CAs</li>
                                <li>Certificate transparency catches violations</li>
                                <li>Need for automated certificate management (mass replacement is painful)</li>
                            </ul>
                        </div>
                    </div>

                    <div class="incident-box">
                        <div class="incident-title">Kazakhstan Government MITM (2019)</div>
                        <div class="incident-content">
                            <strong>What Happened:</strong> Kazakhstan government forced ISPs to install a
                            government root CA on all citizens' devices to intercept HTTPS traffic. Claimed it
                            was for "security."<br><br>

                            <strong>Impact:</strong> Government could decrypt all TLS traffic, read encrypted
                            messages, and impersonate any website.<br><br>

                            <strong>Response:</strong> Chrome, Firefox, Safari all blacklisted the government's
                            root certificate. Kazakhstan backed down after international pressure.<br><br>

                            <strong>Lessons Learned:</strong>
                            <ul class="feature-list">
                                <li>PKI can be weaponized by authoritarian regimes</li>
                                <li>Browser vendors must actively monitor for state-level attacks</li>
                                <li>Certificate pinning in apps provides defense against government CAs</li>
                                <li>Trust store management is a political as well as technical issue</li>
                            </ul>
                        </div>
                    </div>

                    <div class="success-box">
                        <div class="success-box-title">
                            <span>‚úì</span> What These Incidents Drove
                        </div>
                        <div class="info-box-content">
                            These failures directly led to:
                            <ul class="feature-list">
                                <li><strong>Certificate Transparency:</strong> Mandatory logging of all certificates</li>
                                <li><strong>CA/Browser Forum:</strong> Stricter validation requirements</li>
                                <li><strong>Reduced certificate validity:</strong> Max 398 days (from 5 years)</li>
                                <li><strong>Automated certificate management:</strong> Let's Encrypt, ACME protocol</li>
                                <li><strong>CT monitoring tools:</strong> crt.sh, Facebook CT monitor, SSLMate</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Completion Section -->
        <section class="completion-section">
            <h2 style="margin-bottom: 15px; color: var(--text-primary);">Module Complete</h2>
            <p style="color: var(--text-secondary); margin-bottom: 25px;">
                You've mastered X.509 certificates, PKI infrastructure, and certificate management.
                Ready to test your knowledge in the quiz?
            </p>
            <button class="complete-btn" onclick="completeModule()">Mark Module Complete</button>
        </section>
    </main>

    <script>
        // Certificate Transparency search demo
        function searchCTLogs() {
            const domain = document.getElementById('ctDomain').value.trim();
            const output = document.getElementById('ctOutput');

            if (!domain) {
                output.style.display = 'block';
                output.innerHTML = '<span style="color: var(--accent-red);">Please enter a domain name</span>';
                return;
            }

            output.style.display = 'block';
            output.innerHTML = `
<span style="color: var(--accent-cyan);">Searching Certificate Transparency logs for: ${domain}</span>

<span style="color: var(--text-secondary);">This demo shows where to find CT data. In production:</span>

1. Visit: https://crt.sh/?q=${encodeURIComponent(domain)}
2. Or use: curl "https://crt.sh/?q=${encodeURIComponent(domain)}&output=json"
3. Or certstream: wss://certstream.calidog.io/

<span style="color: var(--accent-green);">CT Logs reveal:</span>
  - All certificates ever issued for this domain
  - Issuing CAs
  - Validity periods
  - Subject Alternative Names
  - Serial numbers

<span style="color: var(--accent-orange);">Use cases:</span>
  - Detect unauthorized certificates
  - Monitor subdomain enumeration
  - Track CA migration
  - Identify phishing domains (typosquatting)

<span style="color: var(--text-secondary);">Try it in your browser: <a href="https://crt.sh/?q=${encodeURIComponent(domain)}" target="_blank" style="color: var(--accent-cyan);">https://crt.sh/?q=${encodeURIComponent(domain)}</a></span>
            `;
        }

        // Handle Enter key in CT search
        document.getElementById('ctDomain').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchCTLogs();
            }
        });

        // Module completion
        function completeModule() {
            try {
                // Mark module as complete
                ModuleProgress.complete('key', 'key-certificates');

                // Award achievement
                AchievementManager.unlock('certificate-master');

                // Visual feedback
                const btn = document.querySelector('.complete-btn');
                btn.textContent = 'Module Completed!';
                btn.disabled = true;

                // Redirect after brief delay
                setTimeout(() => {
                    window.location.href = '../index.html';
                }, 2000);
            } catch (error) {
                console.error('Error completing module:', error);
                alert('Module completion recorded locally. Continue to the quiz!');
            }
        }

        // Check if already completed
        window.addEventListener('load', () => {
            try {
                const progress = ModuleProgress.getHouseProgress('key');
                if (progress && progress.modules && progress.modules.includes('key-certificates')) {
                    const btn = document.querySelector('.complete-btn');
                    btn.textContent = 'Already Completed - Return to House';
                }
            } catch (error) {
                console.log('Progress check unavailable');
            }
        });
    </script>
</body>
</html>
