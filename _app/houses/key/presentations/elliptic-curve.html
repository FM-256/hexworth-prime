<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Access Control -->
    <script src="../../../components/AccessGuard.js"></script>
    <script>
        AccessGuard.require('sorted');
    </script>
    <!-- Achievement & Progress Integration -->
    <script src="../../../components/AchievementManager.js"></script>
    <script src="../../../components/ModuleProgress.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elliptic Curve Cryptography - House of the Key</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --house-color: #06b6d4;
            --house-glow: rgba(6, 182, 212, 0.4);
            --bg-dark: #0a0a12;
            --bg-card: rgba(15, 15, 25, 0.8);
            --text-primary: #e8e8f0;
            --text-secondary: #8888aa;
            --accent-cyan: #22d3ee;
            --accent-navy: #1e3a8a;
            --code-bg: rgba(10, 20, 30, 0.9);
        }

        body {
            min-height: 100vh;
            background: var(--bg-dark);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.03;
            pointer-events: none;
            z-index: 0;
            background-image:
                radial-gradient(circle at 20% 50%, var(--house-color) 1px, transparent 1px),
                radial-gradient(circle at 80% 80%, var(--accent-cyan) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: drifting 20s linear infinite;
        }

        @keyframes drifting {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        /* Header */
        .module-header {
            padding: 20px 30px;
            background: rgba(10, 10, 18, 0.95);
            border-bottom: 1px solid rgba(6, 182, 212, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 1px solid rgba(6, 182, 212, 0.3);
            background: transparent;
            color: var(--house-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 1.2rem;
        }

        .back-btn:hover {
            background: rgba(6, 182, 212, 0.1);
            box-shadow: 0 0 15px var(--house-glow);
        }

        .module-title {
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .house-badge {
            font-size: 0.7rem;
            padding: 4px 12px;
            background: rgba(6, 182, 212, 0.15);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 20px;
            color: var(--house-color);
            letter-spacing: 0.1em;
        }

        .progress-bar {
            height: 3px;
            background: rgba(6, 182, 212, 0.1);
            position: relative;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--house-color), var(--accent-cyan));
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px var(--house-glow);
        }

        /* Main Content */
        .module-content {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 30px;
            position: relative;
            z-index: 1;
        }

        .intro-section {
            text-align: center;
            padding: 40px 20px;
            margin-bottom: 50px;
        }

        .intro-section h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--house-color), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .intro-section .subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Content Sections */
        .content-section {
            margin-bottom: 50px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s ease forwards;
        }

        .content-section:nth-child(1) { animation-delay: 0.1s; }
        .content-section:nth-child(2) { animation-delay: 0.2s; }
        .content-section:nth-child(3) { animation-delay: 0.3s; }
        .content-section:nth-child(4) { animation-delay: 0.4s; }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--house-color);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 30px;
            background: linear-gradient(180deg, var(--house-color), var(--accent-cyan));
            border-radius: 2px;
        }

        .section-content {
            background: var(--bg-card);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: 12px;
            padding: 30px;
            line-height: 1.8;
        }

        .section-content p {
            margin-bottom: 15px;
            color: var(--text-secondary);
        }

        .section-content ul, .section-content ol {
            margin-left: 25px;
            margin-bottom: 15px;
            color: var(--text-secondary);
        }

        .section-content li {
            margin-bottom: 10px;
        }

        .section-content strong {
            color: var(--house-color);
        }

        /* Info Boxes */
        .info-box {
            background: rgba(6, 182, 212, 0.05);
            border-left: 4px solid var(--house-color);
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .info-box.warning {
            background: rgba(239, 68, 68, 0.05);
            border-left-color: #ef4444;
        }

        .info-box.success {
            background: rgba(16, 185, 129, 0.05);
            border-left-color: #10b981;
        }

        .info-box-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Comparison Table */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .comparison-table th {
            background: rgba(6, 182, 212, 0.1);
            padding: 15px;
            text-align: left;
            color: var(--house-color);
            border-bottom: 2px solid rgba(6, 182, 212, 0.3);
        }

        .comparison-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(6, 182, 212, 0.1);
            color: var(--text-secondary);
        }

        .comparison-table tr:hover {
            background: rgba(6, 182, 212, 0.05);
        }

        /* Code Block */
        .code-block {
            background: var(--code-bg);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            position: relative;
        }

        .code-block::before {
            content: attr(data-lang);
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 0.7rem;
            color: var(--house-color);
            opacity: 0.5;
        }

        .code-block pre {
            margin: 0;
            color: var(--accent-cyan);
        }

        /* Curve Cards */
        .curve-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .curve-card {
            background: var(--bg-card);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .curve-card:hover {
            border-color: var(--house-color);
            box-shadow: 0 5px 20px var(--house-glow);
            transform: translateY(-5px);
        }

        .curve-card-title {
            font-size: 1.2rem;
            color: var(--house-color);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .curve-card-equation {
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: var(--accent-cyan);
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(6, 182, 212, 0.05);
            border-radius: 4px;
        }

        .curve-card-details {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .curve-card-details .detail-item {
            margin-bottom: 8px;
        }

        .curve-card-details .label {
            color: var(--house-color);
            font-weight: 500;
        }

        /* Visual Diagram */
        .visual-diagram {
            background: var(--code-bg);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: 12px;
            padding: 30px;
            margin: 20px 0;
            text-align: center;
        }

        .diagram-canvas {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }

        /* Navigation Footer */
        .nav-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 0;
            margin-top: 50px;
            border-top: 1px solid rgba(6, 182, 212, 0.2);
        }

        .nav-btn {
            padding: 12px 24px;
            border: 1px solid rgba(6, 182, 212, 0.3);
            background: rgba(6, 182, 212, 0.1);
            color: var(--house-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            background: rgba(6, 182, 212, 0.2);
            box-shadow: 0 0 15px var(--house-glow);
        }

        .nav-btn.primary {
            background: var(--house-color);
            color: var(--bg-dark);
        }

        .nav-btn.primary:hover {
            background: var(--accent-cyan);
        }

        /* Interactive Elements */
        .interactive-demo {
            background: var(--code-bg);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: 12px;
            padding: 30px;
            margin: 20px 0;
        }

        .demo-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .demo-button {
            padding: 10px 20px;
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid rgba(6, 182, 212, 0.3);
            color: var(--house-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .demo-button:hover {
            background: rgba(6, 182, 212, 0.2);
        }

        .demo-button.active {
            background: var(--house-color);
            color: var(--bg-dark);
        }

        .demo-output {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: var(--accent-cyan);
            min-height: 100px;
        }

        /* Completion Banner */
        .completion-banner {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.1), rgba(34, 211, 238, 0.1));
            border: 1px solid var(--house-color);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin-top: 50px;
            display: none;
        }

        .completion-banner.show {
            display: block;
            animation: slideInUp 0.5s ease;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .completion-banner h3 {
            font-size: 1.5rem;
            color: var(--house-color);
            margin-bottom: 15px;
        }

        .completion-banner p {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .intro-section h1 {
                font-size: 2rem;
            }

            .section-title {
                font-size: 1.5rem;
            }

            .curve-grid {
                grid-template-columns: 1fr;
            }

            .nav-footer {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>

    <!-- Header -->
    <header class="module-header">
        <div class="header-left">
            <button class="back-btn" onclick="window.location.href='../../../index.html'" title="Back to Key House">‚Üê</button>
            <h1 class="module-title">Elliptic Curve Cryptography</h1>
        </div>
        <div class="house-badge">HOUSE OF THE KEY</div>
    </header>

    <!-- Progress Bar -->
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>

    <!-- Main Content -->
    <main class="module-content">
        <!-- Introduction -->
        <section class="intro-section">
            <h1>Elliptic Curve Cryptography</h1>
            <p class="subtitle">
                Discover the mathematics behind modern cryptography. ECC provides equivalent security to RSA with significantly smaller key sizes, making it the foundation of modern TLS, SSH, cryptocurrencies, and mobile security.
            </p>
        </section>

        <!-- Mathematical Foundations -->
        <section class="content-section">
            <h2 class="section-title">Mathematical Foundations</h2>
            <div class="section-content">
                <p>
                    Elliptic Curve Cryptography is built on the mathematical properties of elliptic curves over finite fields. Despite the name, elliptic curves have nothing to do with ellipses‚Äîthey are cubic curves with special algebraic properties.
                </p>

                <div class="info-box">
                    <div class="info-box-title">The Elliptic Curve Equation</div>
                    <p>The general Weierstrass form of an elliptic curve is:</p>
                    <div class="code-block" data-lang="math">
                        <pre>y¬≤ = x¬≥ + ax + b</pre>
                    </div>
                    <p>Where 4a¬≥ + 27b¬≤ ‚â† 0 (ensuring the curve has no singularities)</p>
                </div>

                <h3 style="color: var(--house-color); margin-top: 30px; margin-bottom: 15px;">Point Addition</h3>
                <p>
                    The fundamental operation in ECC is <strong>point addition</strong>. Given two points P and Q on the curve, we can define P + Q geometrically:
                </p>
                <ol>
                    <li>Draw a line through points P and Q</li>
                    <li>This line will intersect the curve at a third point R'</li>
                    <li>Reflect R' across the x-axis to get R = P + Q</li>
                </ol>

                <div class="visual-diagram">
                    <svg class="diagram-canvas" width="600" height="400" viewBox="0 0 600 400">
                        <!-- Grid -->
                        <defs>
                            <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                                <path d="M 40 0 L 0 0 0 40" fill="none" stroke="rgba(6, 182, 212, 0.1)" stroke-width="1"/>
                            </pattern>
                        </defs>
                        <rect width="600" height="400" fill="url(#grid)"/>

                        <!-- Axes -->
                        <line x1="0" y1="200" x2="600" y2="200" stroke="rgba(6, 182, 212, 0.3)" stroke-width="2"/>
                        <line x1="300" y1="0" x2="300" y2="400" stroke="rgba(6, 182, 212, 0.3)" stroke-width="2"/>

                        <!-- Elliptic Curve (simplified visual representation) -->
                        <path d="M 100,200 Q 150,100 250,120 T 400,200 Q 450,280 500,200"
                              fill="none" stroke="var(--house-color)" stroke-width="3" opacity="0.8"/>
                        <path d="M 100,200 Q 150,300 250,280 T 400,200 Q 450,120 500,200"
                              fill="none" stroke="var(--house-color)" stroke-width="3" opacity="0.8"/>

                        <!-- Points P and Q -->
                        <circle cx="200" cy="150" r="6" fill="var(--accent-cyan)"/>
                        <text x="200" y="135" fill="var(--accent-cyan)" text-anchor="middle" font-size="16">P</text>

                        <circle cx="350" cy="250" r="6" fill="var(--accent-cyan)"/>
                        <text x="350" y="270" fill="var(--accent-cyan)" text-anchor="middle" font-size="16">Q</text>

                        <!-- Line through P and Q -->
                        <line x1="150" y1="120" x2="450" y2="280" stroke="rgba(239, 68, 68, 0.6)" stroke-width="2" stroke-dasharray="5,5"/>

                        <!-- Intersection point R' -->
                        <circle cx="420" cy="265" r="6" fill="#ef4444"/>
                        <text x="420" y="250" fill="#ef4444" text-anchor="middle" font-size="16">R'</text>

                        <!-- Reflected point R -->
                        <circle cx="420" cy="135" r="6" fill="#10b981"/>
                        <text x="420" y="120" fill="#10b981" text-anchor="middle" font-size="16">R = P + Q</text>

                        <!-- Vertical reflection line -->
                        <line x1="420" y1="265" x2="420" y2="135" stroke="rgba(16, 185, 129, 0.4)" stroke-width="2" stroke-dasharray="3,3"/>
                    </svg>
                    <p style="color: var(--text-secondary); margin-top: 15px; font-size: 0.9rem;">
                        Geometric point addition on an elliptic curve
                    </p>
                </div>

                <h3 style="color: var(--house-color); margin-top: 30px; margin-bottom: 15px;">Scalar Multiplication</h3>
                <p>
                    <strong>Scalar multiplication</strong> is the basis of ECC security. Given a point G and an integer k, we compute:
                </p>
                <div class="code-block" data-lang="math">
                    <pre>Q = k √ó G = G + G + G + ... + G  (k times)</pre>
                </div>
                <p>
                    The <strong>discrete logarithm problem</strong>: Given Q and G, finding k is computationally infeasible for large k. This one-way function is the foundation of ECC security.
                </p>

                <div class="info-box warning">
                    <div class="info-box-title">‚ö† The Hard Problem</div>
                    <p>
                        Computing Q = k √ó G is fast (using double-and-add algorithms).<br>
                        Computing k given Q and G is extremely difficult (the Elliptic Curve Discrete Logarithm Problem).
                    </p>
                </div>
            </div>
        </section>

        <!-- ECC vs RSA -->
        <section class="content-section">
            <h2 class="section-title">ECC vs RSA: Key Size Comparison</h2>
            <div class="section-content">
                <p>
                    The primary advantage of ECC is that it provides equivalent security with much smaller key sizes. This translates to faster computations, less bandwidth, and lower storage requirements‚Äîcritical for mobile devices and IoT.
                </p>

                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Security Level (bits)</th>
                            <th>RSA Key Size</th>
                            <th>ECC Key Size</th>
                            <th>Size Ratio</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>80</td>
                            <td>1024 bits</td>
                            <td>160 bits</td>
                            <td>6.4:1</td>
                        </tr>
                        <tr>
                            <td>112</td>
                            <td>2048 bits</td>
                            <td>224 bits</td>
                            <td>9.1:1</td>
                        </tr>
                        <tr>
                            <td>128</td>
                            <td>3072 bits</td>
                            <td>256 bits</td>
                            <td>12:1</td>
                        </tr>
                        <tr>
                            <td>192</td>
                            <td>7680 bits</td>
                            <td>384 bits</td>
                            <td>20:1</td>
                        </tr>
                        <tr>
                            <td>256</td>
                            <td>15360 bits</td>
                            <td>521 bits</td>
                            <td>29.5:1</td>
                        </tr>
                    </tbody>
                </table>

                <div class="info-box success">
                    <div class="info-box-title">Performance Benefits</div>
                    <ul>
                        <li><strong>Faster key generation:</strong> ECC-256 is ~10x faster than RSA-3072</li>
                        <li><strong>Faster signing:</strong> ECDSA signatures are faster to create</li>
                        <li><strong>Smaller certificates:</strong> Reduced bandwidth for TLS handshakes</li>
                        <li><strong>Lower power consumption:</strong> Critical for mobile and IoT devices</li>
                        <li><strong>Quantum resistance comparison:</strong> Both are vulnerable, but ECC degrades more gracefully</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- ECDH -->
        <section class="content-section">
            <h2 class="section-title">ECDH: Elliptic Curve Diffie-Hellman</h2>
            <div class="section-content">
                <p>
                    <strong>ECDH</strong> is a key exchange protocol that allows two parties to establish a shared secret over an insecure channel. It's the elliptic curve variant of the classic Diffie-Hellman protocol.
                </p>

                <h3 style="color: var(--house-color); margin-top: 30px; margin-bottom: 15px;">How ECDH Works</h3>

                <div class="interactive-demo">
                    <h4 style="color: var(--house-color); margin-bottom: 15px;">ECDH Key Exchange Simulation</h4>
                    <div class="demo-output" id="ecdhOutput">
Click "Start ECDH" to see the key exchange process...
                    </div>
                    <div class="demo-controls">
                        <button class="demo-button" onclick="runECDH()">Start ECDH</button>
                        <button class="demo-button" onclick="clearECDH()">Clear</button>
                    </div>
                </div>

                <div style="margin-top: 30px;">
                    <h4 style="color: var(--house-color); margin-bottom: 15px;">Protocol Steps</h4>
                    <ol>
                        <li><strong>Agree on parameters:</strong> Both parties agree on an elliptic curve and a base point G</li>
                        <li><strong>Alice generates her key pair:</strong>
                            <ul>
                                <li>Private key: a (random large integer)</li>
                                <li>Public key: A = a √ó G</li>
                            </ul>
                        </li>
                        <li><strong>Bob generates his key pair:</strong>
                            <ul>
                                <li>Private key: b (random large integer)</li>
                                <li>Public key: B = b √ó G</li>
                            </ul>
                        </li>
                        <li><strong>Exchange public keys:</strong> Alice sends A to Bob, Bob sends B to Alice</li>
                        <li><strong>Compute shared secret:</strong>
                            <ul>
                                <li>Alice computes: S = a √ó B = a √ó (b √ó G)</li>
                                <li>Bob computes: S = b √ó A = b √ó (a √ó G)</li>
                                <li>Both arrive at the same point S because a √ó (b √ó G) = b √ó (a √ó G)</li>
                            </ul>
                        </li>
                    </ol>
                </div>

                <div class="info-box">
                    <div class="info-box-title">Real-World Usage</div>
                    <p>ECDH is used in:</p>
                    <ul>
                        <li><strong>TLS 1.3:</strong> Forward secrecy in HTTPS connections</li>
                        <li><strong>Signal Protocol:</strong> End-to-end encrypted messaging</li>
                        <li><strong>SSH:</strong> Secure shell key exchange</li>
                        <li><strong>VPNs:</strong> IPsec and WireGuard</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- ECDSA -->
        <section class="content-section">
            <h2 class="section-title">ECDSA: Elliptic Curve Digital Signature Algorithm</h2>
            <div class="section-content">
                <p>
                    <strong>ECDSA</strong> is the elliptic curve variant of the Digital Signature Algorithm (DSA). It provides authentication, integrity, and non-repudiation for digital messages and documents.
                </p>

                <h3 style="color: var(--house-color); margin-top: 30px; margin-bottom: 15px;">Signature Generation</h3>
                <div class="code-block" data-lang="algorithm">
                    <pre>Given:
  - Message m
  - Private key d
  - Curve parameters and base point G

Steps:
  1. Compute hash: e = hash(m)
  2. Generate random k (nonce)
  3. Compute point: (x, y) = k √ó G
  4. Compute r = x mod n
  5. Compute s = k‚Åª¬π(e + dr) mod n

Signature: (r, s)</pre>
                </div>

                <h3 style="color: var(--house-color); margin-top: 30px; margin-bottom: 15px;">Signature Verification</h3>
                <div class="code-block" data-lang="algorithm">
                    <pre>Given:
  - Message m
  - Signature (r, s)
  - Public key Q

Steps:
  1. Compute hash: e = hash(m)
  2. Compute w = s‚Åª¬π mod n
  3. Compute u‚ÇÅ = ew mod n
  4. Compute u‚ÇÇ = rw mod n
  5. Compute point: (x, y) = u‚ÇÅ √ó G + u‚ÇÇ √ó Q
  6. Verify: r ‚â° x (mod n)

If equal, signature is valid</pre>
                </div>

                <div class="info-box warning">
                    <div class="info-box-title">‚ö† Critical Security: Nonce Reuse</div>
                    <p>
                        <strong>Never reuse the nonce k!</strong> If the same k is used for two different messages with the same private key, an attacker can recover the private key.
                    </p>
                    <p>
                        This vulnerability famously compromised the PlayStation 3's signing key and has led to Bitcoin wallet thefts. Modern implementations use deterministic k generation (RFC 6979).
                    </p>
                </div>

                <h3 style="color: var(--house-color); margin-top: 30px; margin-bottom: 15px;">ECDSA Applications</h3>
                <ul>
                    <li><strong>Bitcoin & Cryptocurrencies:</strong> Transaction signing (secp256k1 curve)</li>
                    <li><strong>Code Signing:</strong> Apple iOS app signatures</li>
                    <li><strong>TLS Certificates:</strong> Website authentication</li>
                    <li><strong>SSH Keys:</strong> Server authentication</li>
                    <li><strong>Document Signing:</strong> PDF and email signatures</li>
                </ul>
            </div>
        </section>

        <!-- Common Curves -->
        <section class="content-section">
            <h2 class="section-title">Common Elliptic Curves</h2>
            <div class="section-content">
                <p>
                    Not all elliptic curves are created equal. Different curves offer different security properties, performance characteristics, and compatibility. Here are the most widely used curves in production systems.
                </p>

                <div class="curve-grid">
                    <div class="curve-card">
                        <div class="curve-card-title">P-256 (secp256r1)</div>
                        <div class="curve-card-equation">y¬≤ = x¬≥ - 3x + b (mod p)</div>
                        <div class="curve-card-details">
                            <div class="detail-item">
                                <span class="label">Also known as:</span> prime256v1, NIST P-256
                            </div>
                            <div class="detail-item">
                                <span class="label">Security:</span> 128-bit
                            </div>
                            <div class="detail-item">
                                <span class="label">Usage:</span> TLS, US Government (FIPS 186)
                            </div>
                            <div class="detail-item">
                                <span class="label">Status:</span> Widely supported, industry standard
                            </div>
                            <div class="detail-item">
                                <span class="label">Controversy:</span> NIST curve with potential NSA influence concerns
                            </div>
                        </div>
                    </div>

                    <div class="curve-card">
                        <div class="curve-card-title">P-384 (secp384r1)</div>
                        <div class="curve-card-equation">y¬≤ = x¬≥ - 3x + b (mod p)</div>
                        <div class="curve-card-details">
                            <div class="detail-item">
                                <span class="label">Security:</span> 192-bit
                            </div>
                            <div class="detail-item">
                                <span class="label">Usage:</span> High-security TLS, government applications
                            </div>
                            <div class="detail-item">
                                <span class="label">Performance:</span> Slower than P-256 but more secure
                            </div>
                            <div class="detail-item">
                                <span class="label">Compliance:</span> Suite B Cryptography (NSA)
                            </div>
                        </div>
                    </div>

                    <div class="curve-card">
                        <div class="curve-card-title">Curve25519</div>
                        <div class="curve-card-equation">y¬≤ = x¬≥ + 486662x¬≤ + x (Montgomery form)</div>
                        <div class="curve-card-details">
                            <div class="detail-item">
                                <span class="label">Security:</span> 128-bit
                            </div>
                            <div class="detail-item">
                                <span class="label">Designer:</span> Daniel J. Bernstein (DJB)
                            </div>
                            <div class="detail-item">
                                <span class="label">Usage:</span> SSH, Signal, TLS 1.3, WireGuard VPN
                            </div>
                            <div class="detail-item">
                                <span class="label">Advantages:</span> Fast, side-channel resistant, no trusted setup
                            </div>
                            <div class="detail-item">
                                <span class="label">Note:</span> Designed for ECDH (X25519), Ed25519 for signatures
                            </div>
                        </div>
                    </div>

                    <div class="curve-card">
                        <div class="curve-card-title">secp256k1</div>
                        <div class="curve-card-equation">y¬≤ = x¬≥ + 7 (mod p)</div>
                        <div class="curve-card-details">
                            <div class="detail-item">
                                <span class="label">Security:</span> 128-bit
                            </div>
                            <div class="detail-item">
                                <span class="label">Usage:</span> Bitcoin, Ethereum, cryptocurrencies
                            </div>
                            <div class="detail-item">
                                <span class="label">Special property:</span> Koblitz curve (efficient implementation)
                            </div>
                            <div class="detail-item">
                                <span class="label">Controversy:</span> Less common in non-crypto applications
                            </div>
                            <div class="detail-item">
                                <span class="label">Note:</span> Simple equation (a=0, b=7) aids verification
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <div class="info-box-title">Choosing a Curve</div>
                    <p><strong>For new applications in 2024+:</strong></p>
                    <ul>
                        <li><strong>General use:</strong> Curve25519 (X25519/Ed25519) - fast, secure, modern</li>
                        <li><strong>Government/compliance:</strong> P-256 or P-384 - FIPS approved</li>
                        <li><strong>Cryptocurrency:</strong> secp256k1 - ecosystem compatibility</li>
                        <li><strong>Maximum security:</strong> P-384 or Ed448 - higher security margins</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Security Considerations -->
        <section class="content-section">
            <h2 class="section-title">Security Considerations & Implementation Pitfalls</h2>
            <div class="section-content">
                <p>
                    ECC's mathematical elegance doesn't guarantee secure implementations. Numerous real-world attacks have exploited subtle implementation flaws rather than breaking the underlying mathematics.
                </p>

                <h3 style="color: var(--house-color); margin-top: 30px; margin-bottom: 15px;">Common Vulnerabilities</h3>

                <div class="info-box warning">
                    <div class="info-box-title">1. Side-Channel Attacks</div>
                    <p>
                        <strong>Timing attacks:</strong> Variations in computation time can leak private key bits. Constant-time implementations are essential.
                    </p>
                    <p>
                        <strong>Power analysis:</strong> Measuring power consumption during scalar multiplication can reveal the private key.
                    </p>
                    <p>
                        <strong>Cache-timing attacks:</strong> CPU cache behavior can leak information about secret data.
                    </p>
                    <p><strong>Mitigation:</strong> Use constant-time algorithms, blinding techniques, and hardware protections.</p>
                </div>

                <div class="info-box warning">
                    <div class="info-box-title">2. Invalid Curve Attacks</div>
                    <p>
                        An attacker sends a point that's not actually on the curve. If the implementation doesn't validate points, the attacker can learn information about the private key.
                    </p>
                    <p><strong>Mitigation:</strong> Always validate that received points are on the curve before using them.</p>
                </div>

                <div class="info-box warning">
                    <div class="info-box-title">3. Weak Random Number Generation</div>
                    <p>
                        Predictable nonces in ECDSA allow private key recovery. The PlayStation 3 hack exploited a constant nonce (k always = 4).
                    </p>
                    <p>
                        Android Bitcoin wallet bug (2013): Weak RNG led to $5.8M in stolen Bitcoin.
                    </p>
                    <p><strong>Mitigation:</strong> Use cryptographically secure RNG or deterministic nonce generation (RFC 6979).</p>
                </div>

                <div class="info-box warning">
                    <div class="info-box-title">4. Small Subgroup Attacks</div>
                    <p>
                        If the curve has a small subgroup, an attacker can force computations into that subgroup to leak key information.
                    </p>
                    <p><strong>Mitigation:</strong> Use cofactor multiplication or validate subgroup membership.</p>
                </div>

                <h3 style="color: var(--house-color); margin-top: 30px; margin-bottom: 15px;">Implementation Best Practices</h3>
                <ul>
                    <li><strong>Use established libraries:</strong> OpenSSL, libsodium, BoringSSL - don't roll your own crypto</li>
                    <li><strong>Point validation:</strong> Verify all incoming points are on the curve</li>
                    <li><strong>Constant-time operations:</strong> Prevent timing side-channels</li>
                    <li><strong>Secure RNG:</strong> Use /dev/urandom or OS crypto APIs</li>
                    <li><strong>Deterministic signatures:</strong> RFC 6979 for ECDSA nonce generation</li>
                    <li><strong>Reject weak curves:</strong> Avoid curves with known vulnerabilities</li>
                    <li><strong>Regular updates:</strong> Crypto libraries need security patches</li>
                    <li><strong>Proper key storage:</strong> Hardware security modules for high-value keys</li>
                </ul>

                <div class="info-box success">
                    <div class="info-box-title">Recommended Libraries</div>
                    <ul>
                        <li><strong>libsodium:</strong> Modern, audited, easy to use correctly</li>
                        <li><strong>OpenSSL 3.x:</strong> Industry standard, comprehensive features</li>
                        <li><strong>BoringSSL:</strong> Google's fork, used in Chrome/Android</li>
                        <li><strong>mbedTLS:</strong> Lightweight, good for embedded systems</li>
                        <li><strong>cryptography (Python):</strong> High-level, well-maintained</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Real-World Usage -->
        <section class="content-section">
            <h2 class="section-title">Real-World ECC Usage</h2>
            <div class="section-content">
                <h3 style="color: var(--house-color); margin-bottom: 15px;">TLS/HTTPS</h3>
                <p>
                    Modern HTTPS connections use ECDHE (Ephemeral ECDH) for key exchange and ECDSA for certificate signatures.
                </p>
                <div class="code-block" data-lang="openssl">
                    <pre># View ECC cipher suites in your browser's connection
openssl s_client -connect github.com:443 -brief

# Example output showing ECDHE:
# Cipher: TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</pre>
                </div>

                <h3 style="color: var(--house-color); margin-top: 30px; margin-bottom: 15px;">SSH</h3>
                <p>
                    SSH supports ECDSA and Ed25519 keys for authentication. Ed25519 is increasingly preferred.
                </p>
                <div class="code-block" data-lang="bash">
                    <pre># Generate Ed25519 SSH key
ssh-keygen -t ed25519 -C "your_email@example.com"

# Generate ECDSA SSH key (P-256)
ssh-keygen -t ecdsa -b 256</pre>
                </div>

                <h3 style="color: var(--house-color); margin-top: 30px; margin-bottom: 15px;">Cryptocurrencies</h3>
                <p>
                    Bitcoin uses secp256k1 for all transaction signatures. Your Bitcoin address is derived from your public key.
                </p>
                <div class="code-block" data-lang="flow">
                    <pre>Private Key (256 bits)
    ‚Üì
Public Key = Private Key √ó G  (secp256k1)
    ‚Üì
Hash (SHA-256 + RIPEMD-160)
    ‚Üì
Base58Check Encoding
    ‚Üì
Bitcoin Address (1... or 3... or bc1...)</pre>
                </div>

                <h3 style="color: var(--house-color); margin-top: 30px; margin-bottom: 15px;">Code Signing</h3>
                <p>
                    Apple requires all iOS apps to be signed with ECDSA (P-256). Android also supports ECDSA for APK signing.
                </p>

                <h3 style="color: var(--house-color); margin-top: 30px; margin-bottom: 15px;">Messaging</h3>
                <p>
                    Signal Protocol (WhatsApp, Signal app) uses X25519 for key exchange and Ed25519 for signatures, providing end-to-end encryption for billions of users.
                </p>

                <div class="info-box">
                    <div class="info-box-title">Industry Adoption Timeline</div>
                    <ul>
                        <li><strong>2005:</strong> NSA Suite B endorses ECC (P-256, P-384)</li>
                        <li><strong>2008:</strong> Bitcoin launches using secp256k1</li>
                        <li><strong>2013:</strong> Snowden revelations spur interest in Curve25519</li>
                        <li><strong>2014:</strong> Apple requires ECDSA for iOS code signing</li>
                        <li><strong>2016:</strong> Let's Encrypt supports ECDSA certificates</li>
                        <li><strong>2018:</strong> TLS 1.3 mandates ECC support</li>
                        <li><strong>2024:</strong> ECC dominates new TLS connections (>80%)</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Completion Banner -->
        <div class="completion-banner" id="completionBanner">
            <h3>Module Complete!</h3>
            <p>You've mastered the foundations of Elliptic Curve Cryptography. You now understand the mathematics behind the security protocols that protect billions of devices worldwide.</p>
            <div class="nav-footer">
                <a href="../tools/ecc-visualizer.html" class="nav-btn">
                    Explore ECC Visualizer
                </a>
                <a href="../labs/ecc-lab.html" class="nav-btn">
                    Try the Hands-On Lab
                </a>
                <a href="../quizzes/ecc-quiz.html" class="nav-btn primary">
                    Test Your Knowledge
                </a>
            </div>
        </div>

        <!-- Navigation Footer -->
        <nav class="nav-footer">
            <a href="../../../index.html" class="nav-btn">‚Üê Back to Key House</a>
            <button class="nav-btn primary" onclick="markComplete()">Mark Complete & Continue ‚Üí</button>
        </nav>
    </main>

    <script>
        // Progress tracking
        let currentProgress = 0;
        const progressFill = document.getElementById('progressFill');
        const completionBanner = document.getElementById('completionBanner');

        // Update progress based on scroll
        window.addEventListener('scroll', () => {
            const windowHeight = window.innerHeight;
            const documentHeight = document.documentElement.scrollHeight - windowHeight;
            const scrolled = window.scrollY;
            const progress = (scrolled / documentHeight) * 100;

            currentProgress = Math.min(progress, 100);
            progressFill.style.width = currentProgress + '%';

            // Show completion banner when scrolled near bottom
            if (currentProgress > 95) {
                completionBanner.classList.add('show');
            }
        });

        // ECDH Simulation
        function runECDH() {
            const output = document.getElementById('ecdhOutput');
            let steps = `<span style="color: var(--house-color); font-weight: 600;">ECDH Key Exchange Simulation</span>
<span style="color: var(--text-secondary);">‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</span>

<span style="color: var(--accent-cyan);">Step 1: Curve Parameters (using P-256)</span>
Curve: y¬≤ = x¬≥ - 3x + b (mod p)
Base Point G: (predefined generator point)

<span style="color: var(--accent-cyan);">Step 2: Alice generates her key pair</span>
Private key a: 0x${generateRandomHex(64)}
Public key A = a √ó G:
  x: 0x${generateRandomHex(64)}
  y: 0x${generateRandomHex(64)}

<span style="color: var(--accent-cyan);">Step 3: Bob generates his key pair</span>
Private key b: 0x${generateRandomHex(64)}
Public key B = b √ó G:
  x: 0x${generateRandomHex(64)}
  y: 0x${generateRandomHex(64)}

<span style="color: var(--accent-cyan);">Step 4: Public key exchange (over insecure channel)</span>
Alice ‚Üí Bob: Sends public key A
Bob ‚Üí Alice: Sends public key B

<span style="color: var(--accent-cyan);">Step 5: Both compute shared secret</span>
Alice computes: S = a √ó B
Bob computes:   S = b √ó A

<span style="color: #10b981; font-weight: 600;">Shared Secret S (x-coordinate):</span>
0x${generateRandomHex(64)}

<span style="color: #10b981;">‚úì Both parties now share the same secret!</span>
<span style="color: var(--text-secondary);">This secret can be used to derive symmetric encryption keys.</span>`;

            output.innerHTML = steps;
        }

        function clearECDH() {
            const output = document.getElementById('ecdhOutput');
            output.textContent = 'Click "Start ECDH" to see the key exchange process...';
        }

        function generateRandomHex(length) {
            let result = '';
            const chars = '0123456789abcdef';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        // Mark module complete
        function markComplete() {
            try {
                ModuleProgress.complete('key', 'key-elliptic-curve');

                // Show completion banner
                completionBanner.classList.add('show');

                // Scroll to banner
                completionBanner.scrollIntoView({ behavior: 'smooth', block: 'center' });

                // Optional: Unlock achievement
                if (typeof AchievementManager !== 'undefined') {
                    AchievementManager.unlock('ecc-master');
                }
            } catch (error) {
                console.warn('Progress tracking not available:', error);
                // Fallback: still show completion
                completionBanner.classList.add('show');
                alert('Module completed! Continue to the next section.');
            }
        }

        // Auto-mark complete if user reaches the bottom
        window.addEventListener('scroll', () => {
            if (currentProgress >= 99 && !completionBanner.classList.contains('show')) {
                setTimeout(markComplete, 1000);
            }
        });

        // Console message for curious students
        console.log('%cüîê Elliptic Curve Cryptography', 'color: #06b6d4; font-size: 16px; font-weight: bold;');
        console.log('%cThe mathematics of modern security', 'color: #8888aa; font-size: 12px;');
        console.log('%cFun fact: A 256-bit ECC key provides the same security as a 3072-bit RSA key!', 'color: #22d3ee; font-size: 11px;');
    </script>
</body>
</html>
