<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Access Control -->
    <script src="../../../../components/AccessGuard.js"></script>
    <script>
        AccessGuard.require('sorted');
    </script>
    <!-- Achievement & Progress Integration -->
    <script src="../../../../components/AchievementManager.js"></script>
    <script src="../../../../components/ModuleProgress.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Symmetric Encryption - House of the Key</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --house-color: #f59e0b;
            --house-glow: rgba(245, 158, 11, 0.4);
            --bg-dark: #0a0a12;
            --bg-card: rgba(15, 15, 25, 0.8);
            --text-primary: #e8e8f0;
            --text-secondary: #8888aa;
            --aes-blue: #3b82f6;
            --warning-red: #ef4444;
            --success-green: #10b981;
        }

        body {
            min-height: 100vh;
            background: var(--bg-dark);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* Header */
        .module-header {
            padding: 20px 30px;
            background: rgba(10, 10, 18, 0.95);
            border-bottom: 1px solid rgba(245, 158, 11, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 1px solid rgba(245, 158, 11, 0.3);
            background: transparent;
            color: var(--house-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .back-btn:hover {
            background: rgba(245, 158, 11, 0.1);
        }

        .module-title {
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .house-badge {
            font-size: 0.7rem;
            padding: 4px 12px;
            background: rgba(245, 158, 11, 0.15);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 20px;
            color: var(--house-color);
            letter-spacing: 0.1em;
        }

        /* Main Content */
        .module-content {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 30px;
        }

        .intro-section {
            text-align: center;
            margin-bottom: 50px;
        }

        .intro-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .intro-title {
            font-size: 2.2rem;
            font-weight: 300;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #fff, var(--house-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .intro-subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Section Styles */
        .content-section {
            background: var(--bg-card);
            border: 1px solid rgba(245, 158, 11, 0.2);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-icon {
            font-size: 1.8rem;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 400;
        }

        .section-content {
            line-height: 1.8;
            color: var(--text-secondary);
        }

        .section-content p {
            margin-bottom: 15px;
        }

        .section-content strong {
            color: var(--text-primary);
        }

        /* Key Concepts Grid */
        .concept-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .concept-card {
            background: rgba(245, 158, 11, 0.05);
            border: 1px solid rgba(245, 158, 11, 0.2);
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .concept-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(245, 158, 11, 0.2);
        }

        .concept-title {
            font-size: 1.1rem;
            color: var(--house-color);
            margin-bottom: 10px;
            font-weight: 500;
        }

        .concept-text {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* Code Blocks */
        .code-block {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .code-block code {
            font-family: 'Courier New', monospace;
            color: #10b981;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .code-label {
            color: var(--house-color);
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 10px;
            display: block;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Visual Diagram Styles */
        .diagram-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
            position: relative;
        }

        .diagram-title {
            text-align: center;
            color: var(--house-color);
            font-size: 1.1rem;
            margin-bottom: 25px;
            font-weight: 500;
        }

        .block-mode-diagram {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .encryption-row {
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .block-box {
            min-width: 100px;
            padding: 15px 20px;
            background: rgba(59, 130, 246, 0.2);
            border: 2px solid var(--aes-blue);
            border-radius: 8px;
            text-align: center;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--aes-blue);
        }

        .block-box.plaintext {
            background: rgba(245, 158, 11, 0.2);
            border-color: var(--house-color);
            color: var(--house-color);
        }

        .block-box.ciphertext {
            background: rgba(16, 185, 129, 0.2);
            border-color: var(--success-green);
            color: var(--success-green);
        }

        .block-box.iv {
            background: rgba(168, 85, 247, 0.2);
            border-color: #a855f7;
            color: #a855f7;
        }

        .arrow {
            color: var(--text-secondary);
            font-size: 1.5rem;
        }

        .operation {
            padding: 10px 20px;
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 6px;
            font-size: 0.85rem;
            color: var(--house-color);
            font-weight: 500;
        }

        /* Warning Box */
        .warning-box {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid var(--warning-red);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .warning-title {
            color: var(--warning-red);
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .warning-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Info Box */
        .info-box {
            background: rgba(59, 130, 246, 0.1);
            border-left: 4px solid var(--aes-blue);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .info-title {
            color: var(--aes-blue);
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Success Box */
        .success-box {
            background: rgba(16, 185, 129, 0.1);
            border-left: 4px solid var(--success-green);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .success-title {
            color: var(--success-green);
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .success-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Table Styles */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .comparison-table th {
            background: rgba(245, 158, 11, 0.1);
            color: var(--house-color);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .comparison-table td {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .comparison-table tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        /* List Styles */
        .feature-list {
            list-style: none;
            margin: 20px 0;
        }

        .feature-list li {
            padding: 10px 0 10px 30px;
            position: relative;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .feature-list li:before {
            content: "‚ñ∏";
            position: absolute;
            left: 0;
            color: var(--house-color);
            font-size: 1.2rem;
        }

        /* Complete Button */
        .complete-section {
            text-align: center;
            margin-top: 50px;
            padding: 30px;
            background: var(--bg-card);
            border: 1px solid rgba(245, 158, 11, 0.2);
            border-radius: 12px;
        }

        .complete-btn {
            padding: 15px 40px;
            background: linear-gradient(135deg, var(--house-color), #ea580c);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .complete-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(245, 158, 11, 0.4);
        }

        .complete-text {
            margin-bottom: 20px;
            color: var(--text-secondary);
        }

        /* ECB Penguin Visualization */
        .penguin-demo {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 25px 0;
        }

        .penguin-box {
            text-align: center;
        }

        .penguin-label {
            font-size: 0.9rem;
            color: var(--house-color);
            margin-bottom: 15px;
            font-weight: 500;
        }

        .penguin-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 4px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
        }

        .penguin-block {
            aspect-ratio: 1;
            border-radius: 3px;
        }

        @media (max-width: 768px) {
            .penguin-demo {
                grid-template-columns: 1fr;
            }

            .concept-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="module-header">
        <div class="header-left">
            <button class="back-btn" onclick="window.location.href='../index.html'">‚Üê</button>
            <h1 class="module-title">Advanced Symmetric Encryption</h1>
        </div>
        <div class="house-badge">HOUSE OF THE KEY</div>
    </header>

    <!-- Main Content -->
    <main class="module-content">
        <!-- Intro -->
        <section class="intro-section">
            <div class="intro-icon">üîê</div>
            <h2 class="intro-title">Advanced Symmetric Encryption</h2>
            <p class="intro-subtitle">
                Master the intricacies of AES, block cipher modes, and authenticated encryption.
                Go beyond Security+ fundamentals to understand real-world cryptographic implementations.
            </p>
        </section>

        <!-- Review of Symmetric Encryption -->
        <section class="content-section">
            <div class="section-header">
                <span class="section-icon">üîÑ</span>
                <h3 class="section-title">Symmetric Encryption Review</h3>
            </div>
            <div class="section-content">
                <p>
                    <strong>Symmetric encryption</strong> uses the same key for both encryption and decryption.
                    It's fast, efficient, and ideal for bulk data encryption. Unlike asymmetric encryption,
                    both parties must securely share the secret key beforehand.
                </p>

                <div class="concept-grid">
                    <div class="concept-card">
                        <div class="concept-title">Key Characteristics</div>
                        <div class="concept-text">
                            Single shared secret key, very fast performance, suitable for large data volumes,
                            requires secure key exchange mechanism.
                        </div>
                    </div>
                    <div class="concept-card">
                        <div class="concept-title">Common Algorithms</div>
                        <div class="concept-text">
                            AES (Rijndael), DES (deprecated), 3DES (legacy), ChaCha20 (modern stream cipher),
                            Blowfish, Twofish.
                        </div>
                    </div>
                    <div class="concept-card">
                        <div class="concept-title">Use Cases</div>
                        <div class="concept-text">
                            File encryption, disk encryption, VPN tunnels, TLS session encryption,
                            database encryption, secure messaging.
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- AES Deep Dive -->
        <section class="content-section">
            <div class="section-header">
                <span class="section-icon">üõ°Ô∏è</span>
                <h3 class="section-title">AES Deep Dive: The Rijndael Algorithm</h3>
            </div>
            <div class="section-content">
                <p>
                    <strong>AES (Advanced Encryption Standard)</strong> is the world's most widely used
                    symmetric encryption algorithm. Originally known as <strong>Rijndael</strong>, it was
                    selected by NIST in 2001 to replace DES after a rigorous competition.
                </p>

                <div class="info-box">
                    <div class="info-title">
                        <span>‚ÑπÔ∏è</span>
                        Historical Context
                    </div>
                    <div class="info-content">
                        Rijndael was created by Belgian cryptographers Joan Daemen and Vincent Rijmen.
                        NIST evaluated 15 candidates over 3 years. Rijndael won due to its security,
                        performance, and implementation flexibility across different platforms.
                    </div>
                </div>

                <h4 style="color: var(--house-color); margin: 25px 0 15px;">Key Sizes and Security</h4>

                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Key Size</th>
                            <th>Rounds</th>
                            <th>Security Level</th>
                            <th>Use Case</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong style="color: var(--house-color)">AES-128</strong></td>
                            <td>10 rounds</td>
                            <td>128-bit (2<sup>128</sup> combinations)</td>
                            <td>Standard use, TLS, general encryption</td>
                        </tr>
                        <tr>
                            <td><strong style="color: var(--house-color)">AES-192</strong></td>
                            <td>12 rounds</td>
                            <td>192-bit (2<sup>192</sup> combinations)</td>
                            <td>Enhanced security, government use</td>
                        </tr>
                        <tr>
                            <td><strong style="color: var(--house-color)">AES-256</strong></td>
                            <td>14 rounds</td>
                            <td>256-bit (2<sup>256</sup> combinations)</td>
                            <td>Top Secret data, maximum security</td>
                        </tr>
                    </tbody>
                </table>

                <h4 style="color: var(--house-color); margin: 25px 0 15px;">AES Round Operations</h4>
                <p>Each AES round performs four transformations:</p>

                <ul class="feature-list">
                    <li><strong>SubBytes:</strong> Non-linear substitution using S-box (confusion)</li>
                    <li><strong>ShiftRows:</strong> Cyclic shift of rows in the state matrix</li>
                    <li><strong>MixColumns:</strong> Matrix multiplication for diffusion (skipped in final round)</li>
                    <li><strong>AddRoundKey:</strong> XOR with round key derived from key schedule</li>
                </ul>

                <div class="success-box">
                    <div class="success-title">
                        <span>‚úì</span>
                        Why AES is Secure
                    </div>
                    <div class="success-content">
                        AES combines <strong>confusion</strong> (SubBytes makes relationship between key and ciphertext complex)
                        and <strong>diffusion</strong> (ShiftRows and MixColumns spread plaintext influence across ciphertext).
                        Multiple rounds ensure avalanche effect: changing 1 bit in plaintext changes ~50% of ciphertext bits.
                    </div>
                </div>
            </div>
        </section>

        <!-- Block Cipher Modes -->
        <section class="content-section">
            <div class="section-header">
                <span class="section-icon">üîó</span>
                <h3 class="section-title">Block Cipher Modes of Operation</h3>
            </div>
            <div class="section-content">
                <p>
                    AES operates on fixed 128-bit (16-byte) blocks. To encrypt larger messages, we use
                    <strong>modes of operation</strong> that define how to apply the cipher to multiple blocks.
                    Mode selection critically impacts security.
                </p>

                <!-- ECB Mode -->
                <h4 style="color: var(--warning-red); margin: 25px 0 15px;">‚ö†Ô∏è ECB (Electronic Codebook) - NEVER USE</h4>

                <div class="diagram-container">
                    <div class="diagram-title">ECB Mode: Each Block Encrypted Independently</div>
                    <div class="block-mode-diagram">
                        <div class="encryption-row">
                            <div class="block-box plaintext">Block 1</div>
                            <span class="arrow">‚Üí</span>
                            <div class="operation">AES Encrypt</div>
                            <span class="arrow">‚Üí</span>
                            <div class="block-box ciphertext">Cipher 1</div>
                        </div>
                        <div class="encryption-row">
                            <div class="block-box plaintext">Block 2</div>
                            <span class="arrow">‚Üí</span>
                            <div class="operation">AES Encrypt</div>
                            <span class="arrow">‚Üí</span>
                            <div class="block-box ciphertext">Cipher 2</div>
                        </div>
                        <div class="encryption-row">
                            <div class="block-box plaintext">Block 3</div>
                            <span class="arrow">‚Üí</span>
                            <div class="operation">AES Encrypt</div>
                            <span class="arrow">‚Üí</span>
                            <div class="block-box ciphertext">Cipher 3</div>
                        </div>
                    </div>
                </div>

                <div class="warning-box">
                    <div class="warning-title">
                        <span>‚ö†Ô∏è</span>
                        ECB Penguin Problem
                    </div>
                    <div class="warning-content">
                        <p>
                            Identical plaintext blocks produce identical ciphertext blocks. This reveals patterns
                            in the original data. The famous "ECB Penguin" demonstrates this: encrypting a bitmap
                            image with ECB preserves the visible outline of the penguin.
                        </p>

                        <div class="penguin-demo">
                            <div class="penguin-box">
                                <div class="penguin-label">Original Pattern</div>
                                <div class="penguin-grid" id="original-penguin"></div>
                            </div>
                            <div class="penguin-box">
                                <div class="penguin-label">ECB Encrypted (Pattern Visible!)</div>
                                <div class="penguin-grid" id="ecb-penguin"></div>
                            </div>
                        </div>

                        <p style="margin-top: 15px;">
                            <strong>Never use ECB for any real-world encryption.</strong> It's only acceptable
                            for encrypting random keys, never structured data.
                        </p>
                    </div>
                </div>

                <!-- CBC Mode -->
                <h4 style="color: var(--house-color); margin: 25px 0 15px;">CBC (Cipher Block Chaining)</h4>

                <div class="diagram-container">
                    <div class="diagram-title">CBC Mode: Each Block XORed with Previous Ciphertext</div>
                    <div class="block-mode-diagram">
                        <div class="encryption-row">
                            <div class="block-box iv">IV</div>
                            <span class="arrow">‚äï</span>
                            <div class="block-box plaintext">Block 1</div>
                            <span class="arrow">‚Üí</span>
                            <div class="operation">AES Encrypt</div>
                            <span class="arrow">‚Üí</span>
                            <div class="block-box ciphertext">Cipher 1</div>
                        </div>
                        <div class="encryption-row">
                            <div class="block-box ciphertext">Cipher 1</div>
                            <span class="arrow">‚äï</span>
                            <div class="block-box plaintext">Block 2</div>
                            <span class="arrow">‚Üí</span>
                            <div class="operation">AES Encrypt</div>
                            <span class="arrow">‚Üí</span>
                            <div class="block-box ciphertext">Cipher 2</div>
                        </div>
                        <div class="encryption-row">
                            <div class="block-box ciphertext">Cipher 2</div>
                            <span class="arrow">‚äï</span>
                            <div class="block-box plaintext">Block 3</div>
                            <span class="arrow">‚Üí</span>
                            <div class="operation">AES Encrypt</div>
                            <span class="arrow">‚Üí</span>
                            <div class="block-box ciphertext">Cipher 3</div>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <div class="info-title">
                        <span>‚ÑπÔ∏è</span>
                        CBC Characteristics
                    </div>
                    <div class="info-content">
                        <ul class="feature-list">
                            <li>Requires unpredictable IV (Initialization Vector)</li>
                            <li>IV doesn't need to be secret, but must be unique per message</li>
                            <li>Encryption cannot be parallelized (each block depends on previous)</li>
                            <li>Decryption can be parallelized</li>
                            <li>Vulnerable to padding oracle attacks if not implemented correctly</li>
                        </ul>
                    </div>
                </div>

                <!-- CTR Mode -->
                <h4 style="color: var(--house-color); margin: 25px 0 15px;">CTR (Counter Mode)</h4>

                <div class="diagram-container">
                    <div class="diagram-title">CTR Mode: Encrypt Counter, XOR with Plaintext</div>
                    <div class="block-mode-diagram">
                        <div class="encryption-row">
                            <div class="block-box iv">Nonce + 0</div>
                            <span class="arrow">‚Üí</span>
                            <div class="operation">AES Encrypt</div>
                            <span class="arrow">‚äï</span>
                            <div class="block-box plaintext">Block 1</div>
                            <span class="arrow">‚Üí</span>
                            <div class="block-box ciphertext">Cipher 1</div>
                        </div>
                        <div class="encryption-row">
                            <div class="block-box iv">Nonce + 1</div>
                            <span class="arrow">‚Üí</span>
                            <div class="operation">AES Encrypt</div>
                            <span class="arrow">‚äï</span>
                            <div class="block-box plaintext">Block 2</div>
                            <span class="arrow">‚Üí</span>
                            <div class="block-box ciphertext">Cipher 2</div>
                        </div>
                        <div class="encryption-row">
                            <div class="block-box iv">Nonce + 2</div>
                            <span class="arrow">‚Üí</span>
                            <div class="operation">AES Encrypt</div>
                            <span class="arrow">‚äï</span>
                            <div class="block-box plaintext">Block 3</div>
                            <span class="arrow">‚Üí</span>
                            <div class="block-box ciphertext">Cipher 3</div>
                        </div>
                    </div>
                </div>

                <div class="success-box">
                    <div class="success-title">
                        <span>‚úì</span>
                        CTR Advantages
                    </div>
                    <div class="success-content">
                        <ul class="feature-list">
                            <li>Turns block cipher into stream cipher</li>
                            <li>Full parallelization for both encryption and decryption</li>
                            <li>No padding required</li>
                            <li>Random access decryption (can decrypt any block independently)</li>
                            <li>Nonce + counter must never repeat with same key</li>
                        </ul>
                    </div>
                </div>

                <!-- GCM Mode -->
                <h4 style="color: var(--success-green); margin: 25px 0 15px;">‚úì GCM (Galois/Counter Mode) - RECOMMENDED</h4>

                <p>
                    <strong>GCM combines CTR mode encryption with GMAC authentication.</strong> It provides both
                    confidentiality AND integrity/authenticity in a single operation. This is called
                    <strong>Authenticated Encryption with Associated Data (AEAD)</strong>.
                </p>

                <div class="success-box">
                    <div class="success-title">
                        <span>üîí</span>
                        GCM Features (Why It's the Gold Standard)
                    </div>
                    <div class="success-content">
                        <ul class="feature-list">
                            <li><strong>Encryption:</strong> Uses CTR mode for speed and parallelization</li>
                            <li><strong>Authentication:</strong> GMAC produces authentication tag (MAC)</li>
                            <li><strong>Associated Data:</strong> Can authenticate additional data without encrypting it</li>
                            <li><strong>Tag Verification:</strong> Decryption fails if data or tag is tampered with</li>
                            <li><strong>Performance:</strong> Hardware acceleration available (AES-NI + PCLMULQDQ)</li>
                            <li><strong>Standard:</strong> Required for TLS 1.3, used in IPsec, SSH</li>
                        </ul>
                    </div>
                </div>

                <div class="code-block">
                    <span class="code-label">GCM Output Components</span>
                    <code>
ciphertext = AES-GCM-Encrypt(plaintext, key, nonce, aad)<br>
<br>
// Output includes:<br>
// - Ciphertext (same length as plaintext)<br>
// - Authentication Tag (typically 128 bits)<br>
// - Nonce (96 bits recommended)<br>
<br>
// To decrypt:<br>
plaintext = AES-GCM-Decrypt(ciphertext, tag, key, nonce, aad)<br>
// Decryption FAILS if tag doesn't match (tampering detected)
                    </code>
                </div>
            </div>
        </section>

        <!-- Initialization Vectors and Nonces -->
        <section class="content-section">
            <div class="section-header">
                <span class="section-icon">üé≤</span>
                <h3 class="section-title">Initialization Vectors (IV) and Nonces</h3>
            </div>
            <div class="section-content">
                <p>
                    IVs and nonces prevent identical plaintexts from producing identical ciphertexts.
                    They're critical for semantic security - ensuring an attacker can't tell if the
                    same message was encrypted twice.
                </p>

                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Term</th>
                            <th>Requirements</th>
                            <th>Used In</th>
                            <th>Typical Size</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong style="color: var(--house-color)">IV</strong></td>
                            <td>Unpredictable, unique per message</td>
                            <td>CBC, CFB, OFB</td>
                            <td>Block size (128 bits for AES)</td>
                        </tr>
                        <tr>
                            <td><strong style="color: var(--house-color)">Nonce</strong></td>
                            <td>Unique per message (can be counter)</td>
                            <td>CTR, GCM</td>
                            <td>96 bits (GCM), varies</td>
                        </tr>
                        <tr>
                            <td><strong style="color: var(--house-color)">Salt</strong></td>
                            <td>Unique, prevents rainbow tables</td>
                            <td>Password hashing (KDF)</td>
                            <td>128+ bits</td>
                        </tr>
                    </tbody>
                </table>

                <div class="warning-box">
                    <div class="warning-title">
                        <span>‚ö†Ô∏è</span>
                        Critical IV/Nonce Rules
                    </div>
                    <div class="warning-content">
                        <ul class="feature-list">
                            <li><strong>NEVER reuse IV/nonce with same key</strong> - catastrophic security failure</li>
                            <li>CBC requires cryptographically random IV (not just unique)</li>
                            <li>CTR/GCM can use sequential counter as nonce (must never wrap)</li>
                            <li>GCM is particularly sensitive to nonce reuse (breaks authentication)</li>
                            <li>Store IV/nonce with ciphertext (it's not secret, just unique)</li>
                        </ul>
                    </div>
                </div>

                <div class="code-block">
                    <span class="code-label">Proper IV Generation (Python)</span>
                    <code>
import os<br>
from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes<br>
<br>
# CORRECT: Generate random IV for CBC<br>
iv = os.urandom(16)  # 16 bytes = 128 bits<br>
<br>
# CORRECT: Generate random nonce for GCM<br>
nonce = os.urandom(12)  # 12 bytes = 96 bits (recommended for GCM)<br>
<br>
# WRONG: Predictable IV<br>
iv = b'\x00' * 16  # NEVER DO THIS<br>
<br>
# WRONG: Reusing IV<br>
# Using same IV for multiple messages with same key
                    </code>
                </div>
            </div>
        </section>

        <!-- Key Scheduling -->
        <section class="content-section">
            <div class="section-header">
                <span class="section-icon">üóùÔ∏è</span>
                <h3 class="section-title">Key Scheduling and Expansion</h3>
            </div>
            <div class="section-content">
                <p>
                    AES doesn't use the original key directly in each round. Instead, it derives a unique
                    <strong>round key</strong> for each round through a process called <strong>key expansion</strong>
                    or <strong>key scheduling</strong>.
                </p>

                <div class="info-box">
                    <div class="info-title">
                        <span>üîß</span>
                        Key Expansion Process
                    </div>
                    <div class="info-content">
                        <p>The original key is expanded into an array of round keys:</p>
                        <ul class="feature-list">
                            <li>AES-128: 10 rounds ‚Üí 11 round keys (176 bytes total)</li>
                            <li>AES-192: 12 rounds ‚Üí 13 round keys (208 bytes total)</li>
                            <li>AES-256: 14 rounds ‚Üí 15 round keys (240 bytes total)</li>
                        </ul>
                        <p style="margin-top: 15px;">
                            Each round key is derived from previous keys using rotations, S-box substitutions,
                            and XOR with round constants. This creates avalanche effect in the key space.
                        </p>
                    </div>
                </div>

                <div class="success-box">
                    <div class="success-title">
                        <span>üõ°Ô∏è</span>
                        Security Properties
                    </div>
                    <div class="success-content">
                        Key scheduling ensures that:
                        <ul class="feature-list">
                            <li>Each round uses different key material</li>
                            <li>Attacker can't derive master key from single round key</li>
                            <li>Related-key attacks are prevented</li>
                            <li>All key bits influence all round keys (diffusion)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Padding Schemes -->
        <section class="content-section">
            <div class="section-header">
                <span class="section-icon">üì¶</span>
                <h3 class="section-title">Padding Schemes</h3>
            </div>
            <div class="section-content">
                <p>
                    Block ciphers require input to be a multiple of the block size (16 bytes for AES).
                    <strong>Padding</strong> adds bytes to the final block to reach the required length.
                    Improper padding can create vulnerabilities.
                </p>

                <h4 style="color: var(--house-color); margin: 25px 0 15px;">PKCS#7 Padding (Most Common)</h4>

                <div class="code-block">
                    <span class="code-label">PKCS#7 Padding Examples</span>
                    <code>
// If 5 bytes short of block size, add 5 bytes of value 0x05<br>
Plaintext:  "HELLO WORLD" (11 bytes)<br>
Padded:     "HELLO WORLD\x05\x05\x05\x05\x05" (16 bytes)<br>
<br>
// If exactly block size, add full block of padding<br>
Plaintext:  "EXACTLY 16 BYTES" (16 bytes)<br>
Padded:     "EXACTLY 16 BYTES\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10" (32 bytes)<br>
<br>
// Last byte indicates number of padding bytes<br>
To remove: Read last byte N, remove last N bytes, verify all are value N
                    </code>
                </div>

                <div class="warning-box">
                    <div class="warning-title">
                        <span>‚ö†Ô∏è</span>
                        Padding Oracle Attacks
                    </div>
                    <div class="warning-content">
                        <p>
                            If an application reveals whether padding is valid (through error messages, timing,
                            or behavior), an attacker can decrypt ciphertext without the key. This is called a
                            <strong>padding oracle attack</strong>.
                        </p>
                        <p style="margin-top: 10px;"><strong>Defense:</strong></p>
                        <ul class="feature-list">
                            <li>Use authenticated encryption (GCM) - verify tag before decrypting</li>
                            <li>Never reveal padding errors to untrusted parties</li>
                            <li>Use constant-time padding validation</li>
                            <li>Return same error for all decryption failures</li>
                        </ul>
                    </div>
                </div>

                <h4 style="color: var(--house-color); margin: 25px 0 15px;">No Padding Needed</h4>
                <p>
                    Some modes don't require padding:
                </p>
                <ul class="feature-list">
                    <li><strong>CTR mode:</strong> Generates keystream, XOR works on any length</li>
                    <li><strong>GCM mode:</strong> Based on CTR, no padding needed</li>
                    <li><strong>CFB/OFB modes:</strong> Stream cipher modes, no padding</li>
                </ul>
            </div>
        </section>

        <!-- Performance Considerations -->
        <section class="content-section">
            <div class="section-header">
                <span class="section-icon">‚ö°</span>
                <h3 class="section-title">Performance Considerations</h3>
            </div>
            <div class="section-content">
                <h4 style="color: var(--house-color); margin-bottom: 15px;">Hardware Acceleration</h4>

                <div class="info-box">
                    <div class="info-title">
                        <span>üöÄ</span>
                        AES-NI (AES New Instructions)
                    </div>
                    <div class="info-content">
                        <p>
                            Modern CPUs include AES-NI instructions that accelerate AES encryption by 3-10x.
                            These instructions perform AES rounds in hardware, dramatically improving performance
                            and reducing timing attack surface.
                        </p>
                        <p style="margin-top: 10px;">
                            <strong>Check if enabled:</strong> Most crypto libraries automatically use AES-NI if available.
                            On Linux: <code style="color: var(--house-color)">grep aes /proc/cpuinfo</code>
                        </p>
                    </div>
                </div>

                <h4 style="color: var(--house-color); margin: 25px 0 15px;">Mode Comparison</h4>

                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Mode</th>
                            <th>Parallelizable</th>
                            <th>Random Access</th>
                            <th>Padding</th>
                            <th>Performance</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong style="color: var(--warning-red)">ECB</strong></td>
                            <td>Yes</td>
                            <td>Yes</td>
                            <td>Required</td>
                            <td>Fast (but insecure)</td>
                        </tr>
                        <tr>
                            <td><strong style="color: var(--house-color)">CBC</strong></td>
                            <td>Decrypt only</td>
                            <td>Decrypt only</td>
                            <td>Required</td>
                            <td>Moderate</td>
                        </tr>
                        <tr>
                            <td><strong style="color: var(--house-color)">CTR</strong></td>
                            <td>Yes</td>
                            <td>Yes</td>
                            <td>Not needed</td>
                            <td>Fast</td>
                        </tr>
                        <tr>
                            <td><strong style="color: var(--success-green)">GCM</strong></td>
                            <td>Yes</td>
                            <td>No</td>
                            <td>Not needed</td>
                            <td>Fast (with PCLMULQDQ)</td>
                        </tr>
                    </tbody>
                </table>

                <div class="success-box">
                    <div class="success-title">
                        <span>‚úì</span>
                        Recommendations
                    </div>
                    <div class="success-content">
                        <ul class="feature-list">
                            <li><strong>Default choice:</strong> AES-256-GCM (confidentiality + authenticity)</li>
                            <li><strong>High performance:</strong> ChaCha20-Poly1305 (software-optimized alternative)</li>
                            <li><strong>Legacy systems:</strong> AES-256-CBC with HMAC-SHA256 (encrypt-then-MAC)</li>
                            <li><strong>Key size:</strong> AES-256 for long-term security, AES-128 acceptable for most uses</li>
                            <li><strong>Avoid:</strong> ECB (always), CBC without MAC (padding oracle risk)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Summary -->
        <section class="content-section">
            <div class="section-header">
                <span class="section-icon">üìö</span>
                <h3 class="section-title">Key Takeaways</h3>
            </div>
            <div class="section-content">
                <div class="concept-grid">
                    <div class="concept-card">
                        <div class="concept-title">AES is the Standard</div>
                        <div class="concept-text">
                            Rijndael won NIST competition. Use AES-128 for general use, AES-256 for high-security.
                            Hardware acceleration available on modern CPUs.
                        </div>
                    </div>
                    <div class="concept-card">
                        <div class="concept-title">Mode Matters</div>
                        <div class="concept-text">
                            Never use ECB. Prefer GCM for authenticated encryption. CBC requires care
                            (random IV, padding oracle defense). CTR is fast and parallelizable.
                        </div>
                    </div>
                    <div class="concept-card">
                        <div class="concept-title">IV/Nonce Uniqueness</div>
                        <div class="concept-text">
                            Never reuse IV or nonce with the same key. CBC needs random IV.
                            GCM can use counter but nonce reuse breaks authentication.
                        </div>
                    </div>
                    <div class="concept-card">
                        <div class="concept-title">Use AEAD</div>
                        <div class="concept-text">
                            Authenticated Encryption with Associated Data (GCM, ChaCha20-Poly1305) provides
                            confidentiality AND integrity. Detect tampering before decrypting.
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Complete Module -->
        <section class="complete-section">
            <p class="complete-text">Ready to test your knowledge?</p>
            <button class="complete-btn" onclick="completeModule()">Mark Complete & Continue</button>
        </section>
    </main>

    <script>
        // Generate ECB Penguin Visualization
        function generatePenguinPattern() {
            const pattern = [
                0,0,0,1,1,0,0,0,
                0,0,1,1,1,1,0,0,
                0,1,1,0,0,1,1,0,
                0,1,1,1,1,1,1,0,
                1,1,1,1,1,1,1,1,
                1,1,0,1,1,0,1,1,
                0,1,1,1,1,1,1,0,
                0,0,1,0,0,1,0,0
            ];

            const colors = ['#1a1a2e', '#f59e0b'];

            // Original pattern
            const originalGrid = document.getElementById('original-penguin');
            pattern.forEach(bit => {
                const block = document.createElement('div');
                block.className = 'penguin-block';
                block.style.background = colors[bit];
                originalGrid.appendChild(block);
            });

            // ECB "encrypted" - same pattern shows through
            const ecbGrid = document.getElementById('ecb-penguin');
            pattern.forEach(bit => {
                const block = document.createElement('div');
                block.className = 'penguin-block';
                // Identical blocks get identical "ciphertext"
                block.style.background = bit ? '#ef4444' : '#1e293b';
                ecbGrid.appendChild(block);
            });
        }

        // Complete module
        function completeModule() {
            ModuleProgress.complete('key', 'advanced-symmetric', {
                silent: false,
                returnToDashboard: true,
                timeSpent: 0
            });
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', function() {
            generatePenguinPattern();
        });
    </script>
</body>
</html>
